var S2=Object.defineProperty;var k2=(t,e,n)=>e in t?S2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var j2=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Gl=(t,e,n)=>k2(t,typeof e!="symbol"?e+"":e,n);var XW=j2((ur,hr)=>{function C2(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();var Us=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function jl(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function E2(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var s=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:function(){return t[r]}})}),n}var ev={exports:{}},Pd={},tv={exports:{}},vt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Cl=Symbol.for("react.element"),T2=Symbol.for("react.portal"),N2=Symbol.for("react.fragment"),P2=Symbol.for("react.strict_mode"),R2=Symbol.for("react.profiler"),O2=Symbol.for("react.provider"),A2=Symbol.for("react.context"),M2=Symbol.for("react.forward_ref"),$2=Symbol.for("react.suspense"),L2=Symbol.for("react.memo"),D2=Symbol.for("react.lazy"),Vm=Symbol.iterator;function I2(t){return t===null||typeof t!="object"?null:(t=Vm&&t[Vm]||t["@@iterator"],typeof t=="function"?t:null)}var nv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},rv=Object.assign,sv={};function na(t,e,n){this.props=t,this.context=e,this.refs=sv,this.updater=n||nv}na.prototype.isReactComponent={};na.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};na.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function iv(){}iv.prototype=na.prototype;function Mp(t,e,n){this.props=t,this.context=e,this.refs=sv,this.updater=n||nv}var $p=Mp.prototype=new iv;$p.constructor=Mp;rv($p,na.prototype);$p.isPureReactComponent=!0;var Ym=Array.isArray,ov=Object.prototype.hasOwnProperty,Lp={current:null},av={key:!0,ref:!0,__self:!0,__source:!0};function lv(t,e,n){var r,s={},i=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)ov.call(e,r)&&!av.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:Cl,type:t,key:i,ref:a,props:s,_owner:Lp.current}}function z2(t,e){return{$$typeof:Cl,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Dp(t){return typeof t=="object"&&t!==null&&t.$$typeof===Cl}function F2(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var qm=/\/+/g;function hu(t,e){return typeof t=="object"&&t!==null&&t.key!=null?F2(""+t.key):e.toString(36)}function Nc(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case Cl:case T2:a=!0}}if(a)return a=t,s=s(a),t=r===""?"."+hu(a,0):r,Ym(s)?(n="",t!=null&&(n=t.replace(qm,"$&/")+"/"),Nc(s,e,n,"",function(d){return d})):s!=null&&(Dp(s)&&(s=z2(s,n+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(qm,"$&/")+"/")+t)),e.push(s)),1;if(a=0,r=r===""?".":r+":",Ym(t))for(var l=0;l<t.length;l++){i=t[l];var c=r+hu(i,l);a+=Nc(i,e,n,c,s)}else if(c=I2(t),typeof c=="function")for(t=c.call(t),l=0;!(i=t.next()).done;)i=i.value,c=r+hu(i,l++),a+=Nc(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function Vl(t,e,n){if(t==null)return t;var r=[],s=0;return Nc(t,r,"","",function(i){return e.call(n,i,s++)}),r}function B2(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Un={current:null},Pc={transition:null},H2={ReactCurrentDispatcher:Un,ReactCurrentBatchConfig:Pc,ReactCurrentOwner:Lp};function cv(){throw Error("act(...) is not supported in production builds of React.")}vt.Children={map:Vl,forEach:function(t,e,n){Vl(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Vl(t,function(){e++}),e},toArray:function(t){return Vl(t,function(e){return e})||[]},only:function(t){if(!Dp(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};vt.Component=na;vt.Fragment=N2;vt.Profiler=R2;vt.PureComponent=Mp;vt.StrictMode=P2;vt.Suspense=$2;vt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=H2;vt.act=cv;vt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=rv({},t.props),s=t.key,i=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=Lp.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)ov.call(e,c)&&!av.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:Cl,type:t.type,key:s,ref:i,props:r,_owner:a}};vt.createContext=function(t){return t={$$typeof:A2,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:O2,_context:t},t.Consumer=t};vt.createElement=lv;vt.createFactory=function(t){var e=lv.bind(null,t);return e.type=t,e};vt.createRef=function(){return{current:null}};vt.forwardRef=function(t){return{$$typeof:M2,render:t}};vt.isValidElement=Dp;vt.lazy=function(t){return{$$typeof:D2,_payload:{_status:-1,_result:t},_init:B2}};vt.memo=function(t,e){return{$$typeof:L2,type:t,compare:e===void 0?null:e}};vt.startTransition=function(t){var e=Pc.transition;Pc.transition={};try{t()}finally{Pc.transition=e}};vt.unstable_act=cv;vt.useCallback=function(t,e){return Un.current.useCallback(t,e)};vt.useContext=function(t){return Un.current.useContext(t)};vt.useDebugValue=function(){};vt.useDeferredValue=function(t){return Un.current.useDeferredValue(t)};vt.useEffect=function(t,e){return Un.current.useEffect(t,e)};vt.useId=function(){return Un.current.useId()};vt.useImperativeHandle=function(t,e,n){return Un.current.useImperativeHandle(t,e,n)};vt.useInsertionEffect=function(t,e){return Un.current.useInsertionEffect(t,e)};vt.useLayoutEffect=function(t,e){return Un.current.useLayoutEffect(t,e)};vt.useMemo=function(t,e){return Un.current.useMemo(t,e)};vt.useReducer=function(t,e,n){return Un.current.useReducer(t,e,n)};vt.useRef=function(t){return Un.current.useRef(t)};vt.useState=function(t){return Un.current.useState(t)};vt.useSyncExternalStore=function(t,e,n){return Un.current.useSyncExternalStore(t,e,n)};vt.useTransition=function(){return Un.current.useTransition()};vt.version="18.3.1";tv.exports=vt;var O=tv.exports;const L=jl(O);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var U2=O,W2=Symbol.for("react.element"),G2=Symbol.for("react.fragment"),V2=Object.prototype.hasOwnProperty,Y2=U2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,q2={key:!0,ref:!0,__self:!0,__source:!0};function dv(t,e,n){var r,s={},i=null,a=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)V2.call(e,r)&&!q2.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:W2,type:t,key:i,ref:a,props:s,_owner:Y2.current}}Pd.Fragment=G2;Pd.jsx=dv;Pd.jsxs=dv;ev.exports=Pd;var o=ev.exports,ph={},uv={exports:{}},gr={},hv={exports:{}},pv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(J,I){var K=J.length;J.push(I);e:for(;0<K;){var z=K-1>>>1,W=J[z];if(0<s(W,I))J[z]=I,J[K]=W,K=z;else break e}}function n(J){return J.length===0?null:J[0]}function r(J){if(J.length===0)return null;var I=J[0],K=J.pop();if(K!==I){J[0]=K;e:for(var z=0,W=J.length,fe=W>>>1;z<fe;){var ue=2*(z+1)-1,ne=J[ue],ke=ue+1,ce=J[ke];if(0>s(ne,K))ke<W&&0>s(ce,ne)?(J[z]=ce,J[ke]=K,z=ke):(J[z]=ne,J[ue]=K,z=ue);else if(ke<W&&0>s(ce,K))J[z]=ce,J[ke]=K,z=ke;else break e}}return I}function s(J,I){var K=J.sortIndex-I.sortIndex;return K!==0?K:J.id-I.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],d=[],u=1,p=null,h=3,f=!1,m=!1,g=!1,v=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(J){for(var I=n(d);I!==null;){if(I.callback===null)r(d);else if(I.startTime<=J)r(d),I.sortIndex=I.expirationTime,e(c,I);else break;I=n(d)}}function w(J){if(g=!1,b(J),!m)if(n(c)!==null)m=!0,pe(j);else{var I=n(d);I!==null&&V(w,I.startTime-J)}}function j(J,I){m=!1,g&&(g=!1,x(E),E=-1),f=!0;var K=h;try{for(b(I),p=n(c);p!==null&&(!(p.expirationTime>I)||J&&!Z());){var z=p.callback;if(typeof z=="function"){p.callback=null,h=p.priorityLevel;var W=z(p.expirationTime<=I);I=t.unstable_now(),typeof W=="function"?p.callback=W:p===n(c)&&r(c),b(I)}else r(c);p=n(c)}if(p!==null)var fe=!0;else{var ue=n(d);ue!==null&&V(w,ue.startTime-I),fe=!1}return fe}finally{p=null,h=K,f=!1}}var _=!1,S=null,E=-1,T=5,M=-1;function Z(){return!(t.unstable_now()-M<T)}function N(){if(S!==null){var J=t.unstable_now();M=J;var I=!0;try{I=S(!0,J)}finally{I?G():(_=!1,S=null)}}else _=!1}var G;if(typeof y=="function")G=function(){y(N)};else if(typeof MessageChannel<"u"){var C=new MessageChannel,F=C.port2;C.port1.onmessage=N,G=function(){F.postMessage(null)}}else G=function(){v(N,0)};function pe(J){S=J,_||(_=!0,G())}function V(J,I){E=v(function(){J(t.unstable_now())},I)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(J){J.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,pe(j))},t.unstable_forceFrameRate=function(J){0>J||125<J?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<J?Math.floor(1e3/J):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(J){switch(h){case 1:case 2:case 3:var I=3;break;default:I=h}var K=h;h=I;try{return J()}finally{h=K}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(J,I){switch(J){case 1:case 2:case 3:case 4:case 5:break;default:J=3}var K=h;h=J;try{return I()}finally{h=K}},t.unstable_scheduleCallback=function(J,I,K){var z=t.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?z+K:z):K=z,J){case 1:var W=-1;break;case 2:W=250;break;case 5:W=1073741823;break;case 4:W=1e4;break;default:W=5e3}return W=K+W,J={id:u++,callback:I,priorityLevel:J,startTime:K,expirationTime:W,sortIndex:-1},K>z?(J.sortIndex=K,e(d,J),n(c)===null&&J===n(d)&&(g?(x(E),E=-1):g=!0,V(w,K-z))):(J.sortIndex=W,e(c,J),m||f||(m=!0,pe(j))),J},t.unstable_shouldYield=Z,t.unstable_wrapCallback=function(J){var I=h;return function(){var K=h;h=I;try{return J.apply(this,arguments)}finally{h=K}}}})(pv);hv.exports=pv;var X2=hv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K2=O,fr=X2;function Oe(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var fv=new Set,nl={};function zi(t,e){Yo(t,e),Yo(t+"Capture",e)}function Yo(t,e){for(nl[t]=e,t=0;t<e.length;t++)fv.add(e[t])}var _s=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),fh=Object.prototype.hasOwnProperty,Z2=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Xm={},Km={};function J2(t){return fh.call(Km,t)?!0:fh.call(Xm,t)?!1:Z2.test(t)?Km[t]=!0:(Xm[t]=!0,!1)}function Q2(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function eS(t,e,n,r){if(e===null||typeof e>"u"||Q2(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Wn(t,e,n,r,s,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var vn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){vn[t]=new Wn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];vn[e]=new Wn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){vn[t]=new Wn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){vn[t]=new Wn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){vn[t]=new Wn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){vn[t]=new Wn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){vn[t]=new Wn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){vn[t]=new Wn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){vn[t]=new Wn(t,5,!1,t.toLowerCase(),null,!1,!1)});var Ip=/[\-:]([a-z])/g;function zp(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Ip,zp);vn[e]=new Wn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Ip,zp);vn[e]=new Wn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Ip,zp);vn[e]=new Wn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){vn[t]=new Wn(t,1,!1,t.toLowerCase(),null,!1,!1)});vn.xlinkHref=new Wn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){vn[t]=new Wn(t,1,!1,t.toLowerCase(),null,!0,!0)});function Fp(t,e,n,r){var s=vn.hasOwnProperty(e)?vn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(eS(e,n,s,r)&&(n=null),r||s===null?J2(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Cs=K2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Yl=Symbol.for("react.element"),Co=Symbol.for("react.portal"),Eo=Symbol.for("react.fragment"),Bp=Symbol.for("react.strict_mode"),mh=Symbol.for("react.profiler"),mv=Symbol.for("react.provider"),gv=Symbol.for("react.context"),Hp=Symbol.for("react.forward_ref"),gh=Symbol.for("react.suspense"),yh=Symbol.for("react.suspense_list"),Up=Symbol.for("react.memo"),Ls=Symbol.for("react.lazy"),yv=Symbol.for("react.offscreen"),Zm=Symbol.iterator;function ba(t){return t===null||typeof t!="object"?null:(t=Zm&&t[Zm]||t["@@iterator"],typeof t=="function"?t:null)}var Vt=Object.assign,pu;function $a(t){if(pu===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);pu=e&&e[1]||""}return`
`+pu+t}var fu=!1;function mu(t,e){if(!t||fu)return"";fu=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),a=s.length-1,l=i.length-1;1<=a&&0<=l&&s[a]!==i[l];)l--;for(;1<=a&&0<=l;a--,l--)if(s[a]!==i[l]){if(a!==1||l!==1)do if(a--,l--,0>l||s[a]!==i[l]){var c=`
`+s[a].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=a&&0<=l);break}}}finally{fu=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?$a(t):""}function tS(t){switch(t.tag){case 5:return $a(t.type);case 16:return $a("Lazy");case 13:return $a("Suspense");case 19:return $a("SuspenseList");case 0:case 2:case 15:return t=mu(t.type,!1),t;case 11:return t=mu(t.type.render,!1),t;case 1:return t=mu(t.type,!0),t;default:return""}}function xh(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Eo:return"Fragment";case Co:return"Portal";case mh:return"Profiler";case Bp:return"StrictMode";case gh:return"Suspense";case yh:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case gv:return(t.displayName||"Context")+".Consumer";case mv:return(t._context.displayName||"Context")+".Provider";case Hp:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Up:return e=t.displayName||null,e!==null?e:xh(t.type)||"Memo";case Ls:e=t._payload,t=t._init;try{return xh(t(e))}catch{}}return null}function nS(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return xh(e);case 8:return e===Bp?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ti(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function xv(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function rS(t){var e=xv(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function ql(t){t._valueTracker||(t._valueTracker=rS(t))}function vv(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=xv(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Hc(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function vh(t,e){var n=e.checked;return Vt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Jm(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=ti(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function bv(t,e){e=e.checked,e!=null&&Fp(t,"checked",e,!1)}function bh(t,e){bv(t,e);var n=ti(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?wh(t,e.type,n):e.hasOwnProperty("defaultValue")&&wh(t,e.type,ti(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Qm(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function wh(t,e,n){(e!=="number"||Hc(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var La=Array.isArray;function zo(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+ti(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function _h(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Oe(91));return Vt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function eg(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Oe(92));if(La(n)){if(1<n.length)throw Error(Oe(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:ti(n)}}function wv(t,e){var n=ti(e.value),r=ti(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function tg(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function _v(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Sh(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?_v(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Xl,Sv=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Xl=Xl||document.createElement("div"),Xl.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Xl.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function rl(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Ua={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},sS=["Webkit","ms","Moz","O"];Object.keys(Ua).forEach(function(t){sS.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Ua[e]=Ua[t]})});function kv(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Ua.hasOwnProperty(t)&&Ua[t]?(""+e).trim():e+"px"}function jv(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=kv(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var iS=Vt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function kh(t,e){if(e){if(iS[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Oe(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Oe(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Oe(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Oe(62))}}function jh(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ch=null;function Wp(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Eh=null,Fo=null,Bo=null;function ng(t){if(t=Nl(t)){if(typeof Eh!="function")throw Error(Oe(280));var e=t.stateNode;e&&(e=$d(e),Eh(t.stateNode,t.type,e))}}function Cv(t){Fo?Bo?Bo.push(t):Bo=[t]:Fo=t}function Ev(){if(Fo){var t=Fo,e=Bo;if(Bo=Fo=null,ng(t),e)for(t=0;t<e.length;t++)ng(e[t])}}function Tv(t,e){return t(e)}function Nv(){}var gu=!1;function Pv(t,e,n){if(gu)return t(e,n);gu=!0;try{return Tv(t,e,n)}finally{gu=!1,(Fo!==null||Bo!==null)&&(Nv(),Ev())}}function sl(t,e){var n=t.stateNode;if(n===null)return null;var r=$d(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Oe(231,e,typeof n));return n}var Th=!1;if(_s)try{var wa={};Object.defineProperty(wa,"passive",{get:function(){Th=!0}}),window.addEventListener("test",wa,wa),window.removeEventListener("test",wa,wa)}catch{Th=!1}function oS(t,e,n,r,s,i,a,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(u){this.onError(u)}}var Wa=!1,Uc=null,Wc=!1,Nh=null,aS={onError:function(t){Wa=!0,Uc=t}};function lS(t,e,n,r,s,i,a,l,c){Wa=!1,Uc=null,oS.apply(aS,arguments)}function cS(t,e,n,r,s,i,a,l,c){if(lS.apply(this,arguments),Wa){if(Wa){var d=Uc;Wa=!1,Uc=null}else throw Error(Oe(198));Wc||(Wc=!0,Nh=d)}}function Fi(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Rv(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function rg(t){if(Fi(t)!==t)throw Error(Oe(188))}function dS(t){var e=t.alternate;if(!e){if(e=Fi(t),e===null)throw Error(Oe(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return rg(s),t;if(i===r)return rg(s),e;i=i.sibling}throw Error(Oe(188))}if(n.return!==r.return)n=s,r=i;else{for(var a=!1,l=s.child;l;){if(l===n){a=!0,n=s,r=i;break}if(l===r){a=!0,r=s,n=i;break}l=l.sibling}if(!a){for(l=i.child;l;){if(l===n){a=!0,n=i,r=s;break}if(l===r){a=!0,r=i,n=s;break}l=l.sibling}if(!a)throw Error(Oe(189))}}if(n.alternate!==r)throw Error(Oe(190))}if(n.tag!==3)throw Error(Oe(188));return n.stateNode.current===n?t:e}function Ov(t){return t=dS(t),t!==null?Av(t):null}function Av(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Av(t);if(e!==null)return e;t=t.sibling}return null}var Mv=fr.unstable_scheduleCallback,sg=fr.unstable_cancelCallback,uS=fr.unstable_shouldYield,hS=fr.unstable_requestPaint,Zt=fr.unstable_now,pS=fr.unstable_getCurrentPriorityLevel,Gp=fr.unstable_ImmediatePriority,$v=fr.unstable_UserBlockingPriority,Gc=fr.unstable_NormalPriority,fS=fr.unstable_LowPriority,Lv=fr.unstable_IdlePriority,Rd=null,ls=null;function mS(t){if(ls&&typeof ls.onCommitFiberRoot=="function")try{ls.onCommitFiberRoot(Rd,t,void 0,(t.current.flags&128)===128)}catch{}}var qr=Math.clz32?Math.clz32:xS,gS=Math.log,yS=Math.LN2;function xS(t){return t>>>=0,t===0?32:31-(gS(t)/yS|0)|0}var Kl=64,Zl=4194304;function Da(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Vc(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,a=n&268435455;if(a!==0){var l=a&~s;l!==0?r=Da(l):(i&=a,i!==0&&(r=Da(i)))}else a=n&~s,a!==0?r=Da(a):i!==0&&(r=Da(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-qr(e),s=1<<n,r|=t[n],e&=~s;return r}function vS(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bS(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var a=31-qr(i),l=1<<a,c=s[a];c===-1?(!(l&n)||l&r)&&(s[a]=vS(l,e)):c<=e&&(t.expiredLanes|=l),i&=~l}}function Ph(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Dv(){var t=Kl;return Kl<<=1,!(Kl&4194240)&&(Kl=64),t}function yu(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function El(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-qr(e),t[e]=n}function wS(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-qr(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function Vp(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-qr(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var Tt=0;function Iv(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var zv,Yp,Fv,Bv,Hv,Rh=!1,Jl=[],Ys=null,qs=null,Xs=null,il=new Map,ol=new Map,zs=[],_S="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ig(t,e){switch(t){case"focusin":case"focusout":Ys=null;break;case"dragenter":case"dragleave":qs=null;break;case"mouseover":case"mouseout":Xs=null;break;case"pointerover":case"pointerout":il.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ol.delete(e.pointerId)}}function _a(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Nl(e),e!==null&&Yp(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function SS(t,e,n,r,s){switch(e){case"focusin":return Ys=_a(Ys,t,e,n,r,s),!0;case"dragenter":return qs=_a(qs,t,e,n,r,s),!0;case"mouseover":return Xs=_a(Xs,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return il.set(i,_a(il.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,ol.set(i,_a(ol.get(i)||null,t,e,n,r,s)),!0}return!1}function Uv(t){var e=Ci(t.target);if(e!==null){var n=Fi(e);if(n!==null){if(e=n.tag,e===13){if(e=Rv(n),e!==null){t.blockedOn=e,Hv(t.priority,function(){Fv(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Rc(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Oh(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Ch=r,n.target.dispatchEvent(r),Ch=null}else return e=Nl(n),e!==null&&Yp(e),t.blockedOn=n,!1;e.shift()}return!0}function og(t,e,n){Rc(t)&&n.delete(e)}function kS(){Rh=!1,Ys!==null&&Rc(Ys)&&(Ys=null),qs!==null&&Rc(qs)&&(qs=null),Xs!==null&&Rc(Xs)&&(Xs=null),il.forEach(og),ol.forEach(og)}function Sa(t,e){t.blockedOn===e&&(t.blockedOn=null,Rh||(Rh=!0,fr.unstable_scheduleCallback(fr.unstable_NormalPriority,kS)))}function al(t){function e(s){return Sa(s,t)}if(0<Jl.length){Sa(Jl[0],t);for(var n=1;n<Jl.length;n++){var r=Jl[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Ys!==null&&Sa(Ys,t),qs!==null&&Sa(qs,t),Xs!==null&&Sa(Xs,t),il.forEach(e),ol.forEach(e),n=0;n<zs.length;n++)r=zs[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<zs.length&&(n=zs[0],n.blockedOn===null);)Uv(n),n.blockedOn===null&&zs.shift()}var Ho=Cs.ReactCurrentBatchConfig,Yc=!0;function jS(t,e,n,r){var s=Tt,i=Ho.transition;Ho.transition=null;try{Tt=1,qp(t,e,n,r)}finally{Tt=s,Ho.transition=i}}function CS(t,e,n,r){var s=Tt,i=Ho.transition;Ho.transition=null;try{Tt=4,qp(t,e,n,r)}finally{Tt=s,Ho.transition=i}}function qp(t,e,n,r){if(Yc){var s=Oh(t,e,n,r);if(s===null)Eu(t,e,r,qc,n),ig(t,r);else if(SS(s,t,e,n,r))r.stopPropagation();else if(ig(t,r),e&4&&-1<_S.indexOf(t)){for(;s!==null;){var i=Nl(s);if(i!==null&&zv(i),i=Oh(t,e,n,r),i===null&&Eu(t,e,r,qc,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else Eu(t,e,r,null,n)}}var qc=null;function Oh(t,e,n,r){if(qc=null,t=Wp(r),t=Ci(t),t!==null)if(e=Fi(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Rv(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return qc=t,null}function Wv(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(pS()){case Gp:return 1;case $v:return 4;case Gc:case fS:return 16;case Lv:return 536870912;default:return 16}default:return 16}}var Ws=null,Xp=null,Oc=null;function Gv(){if(Oc)return Oc;var t,e=Xp,n=e.length,r,s="value"in Ws?Ws.value:Ws.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var a=n-t;for(r=1;r<=a&&e[n-r]===s[i-r];r++);return Oc=s.slice(t,1<r?1-r:void 0)}function Ac(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Ql(){return!0}function ag(){return!1}function yr(t){function e(n,r,s,i,a){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Ql:ag,this.isPropagationStopped=ag,this}return Vt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Ql)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Ql)},persist:function(){},isPersistent:Ql}),e}var ra={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Kp=yr(ra),Tl=Vt({},ra,{view:0,detail:0}),ES=yr(Tl),xu,vu,ka,Od=Vt({},Tl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Zp,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ka&&(ka&&t.type==="mousemove"?(xu=t.screenX-ka.screenX,vu=t.screenY-ka.screenY):vu=xu=0,ka=t),xu)},movementY:function(t){return"movementY"in t?t.movementY:vu}}),lg=yr(Od),TS=Vt({},Od,{dataTransfer:0}),NS=yr(TS),PS=Vt({},Tl,{relatedTarget:0}),bu=yr(PS),RS=Vt({},ra,{animationName:0,elapsedTime:0,pseudoElement:0}),OS=yr(RS),AS=Vt({},ra,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),MS=yr(AS),$S=Vt({},ra,{data:0}),cg=yr($S),LS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},DS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},IS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zS(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=IS[t])?!!e[t]:!1}function Zp(){return zS}var FS=Vt({},Tl,{key:function(t){if(t.key){var e=LS[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Ac(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?DS[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Zp,charCode:function(t){return t.type==="keypress"?Ac(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Ac(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),BS=yr(FS),HS=Vt({},Od,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),dg=yr(HS),US=Vt({},Tl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Zp}),WS=yr(US),GS=Vt({},ra,{propertyName:0,elapsedTime:0,pseudoElement:0}),VS=yr(GS),YS=Vt({},Od,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),qS=yr(YS),XS=[9,13,27,32],Jp=_s&&"CompositionEvent"in window,Ga=null;_s&&"documentMode"in document&&(Ga=document.documentMode);var KS=_s&&"TextEvent"in window&&!Ga,Vv=_s&&(!Jp||Ga&&8<Ga&&11>=Ga),ug=" ",hg=!1;function Yv(t,e){switch(t){case"keyup":return XS.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qv(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var To=!1;function ZS(t,e){switch(t){case"compositionend":return qv(e);case"keypress":return e.which!==32?null:(hg=!0,ug);case"textInput":return t=e.data,t===ug&&hg?null:t;default:return null}}function JS(t,e){if(To)return t==="compositionend"||!Jp&&Yv(t,e)?(t=Gv(),Oc=Xp=Ws=null,To=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Vv&&e.locale!=="ko"?null:e.data;default:return null}}var QS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!QS[t.type]:e==="textarea"}function Xv(t,e,n,r){Cv(r),e=Xc(e,"onChange"),0<e.length&&(n=new Kp("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Va=null,ll=null;function ek(t){ob(t,0)}function Ad(t){var e=Ro(t);if(vv(e))return t}function tk(t,e){if(t==="change")return e}var Kv=!1;if(_s){var wu;if(_s){var _u="oninput"in document;if(!_u){var fg=document.createElement("div");fg.setAttribute("oninput","return;"),_u=typeof fg.oninput=="function"}wu=_u}else wu=!1;Kv=wu&&(!document.documentMode||9<document.documentMode)}function mg(){Va&&(Va.detachEvent("onpropertychange",Zv),ll=Va=null)}function Zv(t){if(t.propertyName==="value"&&Ad(ll)){var e=[];Xv(e,ll,t,Wp(t)),Pv(ek,e)}}function nk(t,e,n){t==="focusin"?(mg(),Va=e,ll=n,Va.attachEvent("onpropertychange",Zv)):t==="focusout"&&mg()}function rk(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Ad(ll)}function sk(t,e){if(t==="click")return Ad(e)}function ik(t,e){if(t==="input"||t==="change")return Ad(e)}function ok(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Kr=typeof Object.is=="function"?Object.is:ok;function cl(t,e){if(Kr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!fh.call(e,s)||!Kr(t[s],e[s]))return!1}return!0}function gg(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function yg(t,e){var n=gg(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=gg(n)}}function Jv(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Jv(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Qv(){for(var t=window,e=Hc();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Hc(t.document)}return e}function Qp(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function ak(t){var e=Qv(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Jv(n.ownerDocument.documentElement,n)){if(r!==null&&Qp(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=yg(n,i);var a=yg(n,r);s&&a&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var lk=_s&&"documentMode"in document&&11>=document.documentMode,No=null,Ah=null,Ya=null,Mh=!1;function xg(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Mh||No==null||No!==Hc(r)||(r=No,"selectionStart"in r&&Qp(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Ya&&cl(Ya,r)||(Ya=r,r=Xc(Ah,"onSelect"),0<r.length&&(e=new Kp("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=No)))}function ec(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Po={animationend:ec("Animation","AnimationEnd"),animationiteration:ec("Animation","AnimationIteration"),animationstart:ec("Animation","AnimationStart"),transitionend:ec("Transition","TransitionEnd")},Su={},eb={};_s&&(eb=document.createElement("div").style,"AnimationEvent"in window||(delete Po.animationend.animation,delete Po.animationiteration.animation,delete Po.animationstart.animation),"TransitionEvent"in window||delete Po.transitionend.transition);function Md(t){if(Su[t])return Su[t];if(!Po[t])return t;var e=Po[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in eb)return Su[t]=e[n];return t}var tb=Md("animationend"),nb=Md("animationiteration"),rb=Md("animationstart"),sb=Md("transitionend"),ib=new Map,vg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ii(t,e){ib.set(t,e),zi(e,[t])}for(var ku=0;ku<vg.length;ku++){var ju=vg[ku],ck=ju.toLowerCase(),dk=ju[0].toUpperCase()+ju.slice(1);ii(ck,"on"+dk)}ii(tb,"onAnimationEnd");ii(nb,"onAnimationIteration");ii(rb,"onAnimationStart");ii("dblclick","onDoubleClick");ii("focusin","onFocus");ii("focusout","onBlur");ii(sb,"onTransitionEnd");Yo("onMouseEnter",["mouseout","mouseover"]);Yo("onMouseLeave",["mouseout","mouseover"]);Yo("onPointerEnter",["pointerout","pointerover"]);Yo("onPointerLeave",["pointerout","pointerover"]);zi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));zi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));zi("onBeforeInput",["compositionend","keypress","textInput","paste"]);zi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));zi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));zi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ia="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),uk=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ia));function bg(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,cS(r,e,void 0,t),t.currentTarget=null}function ob(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var a=r.length-1;0<=a;a--){var l=r[a],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&s.isPropagationStopped())break e;bg(s,l,d),i=c}else for(a=0;a<r.length;a++){if(l=r[a],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&s.isPropagationStopped())break e;bg(s,l,d),i=c}}}if(Wc)throw t=Nh,Wc=!1,Nh=null,t}function Lt(t,e){var n=e[zh];n===void 0&&(n=e[zh]=new Set);var r=t+"__bubble";n.has(r)||(ab(e,t,2,!1),n.add(r))}function Cu(t,e,n){var r=0;e&&(r|=4),ab(n,t,r,e)}var tc="_reactListening"+Math.random().toString(36).slice(2);function dl(t){if(!t[tc]){t[tc]=!0,fv.forEach(function(n){n!=="selectionchange"&&(uk.has(n)||Cu(n,!1,t),Cu(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[tc]||(e[tc]=!0,Cu("selectionchange",!1,e))}}function ab(t,e,n,r){switch(Wv(e)){case 1:var s=jS;break;case 4:s=CS;break;default:s=qp}n=s.bind(null,e,n,t),s=void 0,!Th||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function Eu(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(a===4)for(a=r.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;a=a.return}for(;l!==null;){if(a=Ci(l),a===null)return;if(c=a.tag,c===5||c===6){r=i=a;continue e}l=l.parentNode}}r=r.return}Pv(function(){var d=i,u=Wp(n),p=[];e:{var h=ib.get(t);if(h!==void 0){var f=Kp,m=t;switch(t){case"keypress":if(Ac(n)===0)break e;case"keydown":case"keyup":f=BS;break;case"focusin":m="focus",f=bu;break;case"focusout":m="blur",f=bu;break;case"beforeblur":case"afterblur":f=bu;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=lg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=NS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=WS;break;case tb:case nb:case rb:f=OS;break;case sb:f=VS;break;case"scroll":f=ES;break;case"wheel":f=qS;break;case"copy":case"cut":case"paste":f=MS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=dg}var g=(e&4)!==0,v=!g&&t==="scroll",x=g?h!==null?h+"Capture":null:h;g=[];for(var y=d,b;y!==null;){b=y;var w=b.stateNode;if(b.tag===5&&w!==null&&(b=w,x!==null&&(w=sl(y,x),w!=null&&g.push(ul(y,w,b)))),v)break;y=y.return}0<g.length&&(h=new f(h,m,null,n,u),p.push({event:h,listeners:g}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",h&&n!==Ch&&(m=n.relatedTarget||n.fromElement)&&(Ci(m)||m[Ss]))break e;if((f||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,f?(m=n.relatedTarget||n.toElement,f=d,m=m?Ci(m):null,m!==null&&(v=Fi(m),m!==v||m.tag!==5&&m.tag!==6)&&(m=null)):(f=null,m=d),f!==m)){if(g=lg,w="onMouseLeave",x="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(g=dg,w="onPointerLeave",x="onPointerEnter",y="pointer"),v=f==null?h:Ro(f),b=m==null?h:Ro(m),h=new g(w,y+"leave",f,n,u),h.target=v,h.relatedTarget=b,w=null,Ci(u)===d&&(g=new g(x,y+"enter",m,n,u),g.target=b,g.relatedTarget=v,w=g),v=w,f&&m)t:{for(g=f,x=m,y=0,b=g;b;b=eo(b))y++;for(b=0,w=x;w;w=eo(w))b++;for(;0<y-b;)g=eo(g),y--;for(;0<b-y;)x=eo(x),b--;for(;y--;){if(g===x||x!==null&&g===x.alternate)break t;g=eo(g),x=eo(x)}g=null}else g=null;f!==null&&wg(p,h,f,g,!1),m!==null&&v!==null&&wg(p,v,m,g,!0)}}e:{if(h=d?Ro(d):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var j=tk;else if(pg(h))if(Kv)j=ik;else{j=rk;var _=nk}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(j=sk);if(j&&(j=j(t,d))){Xv(p,j,n,u);break e}_&&_(t,h,d),t==="focusout"&&(_=h._wrapperState)&&_.controlled&&h.type==="number"&&wh(h,"number",h.value)}switch(_=d?Ro(d):window,t){case"focusin":(pg(_)||_.contentEditable==="true")&&(No=_,Ah=d,Ya=null);break;case"focusout":Ya=Ah=No=null;break;case"mousedown":Mh=!0;break;case"contextmenu":case"mouseup":case"dragend":Mh=!1,xg(p,n,u);break;case"selectionchange":if(lk)break;case"keydown":case"keyup":xg(p,n,u)}var S;if(Jp)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else To?Yv(t,n)&&(E="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(E="onCompositionStart");E&&(Vv&&n.locale!=="ko"&&(To||E!=="onCompositionStart"?E==="onCompositionEnd"&&To&&(S=Gv()):(Ws=u,Xp="value"in Ws?Ws.value:Ws.textContent,To=!0)),_=Xc(d,E),0<_.length&&(E=new cg(E,t,null,n,u),p.push({event:E,listeners:_}),S?E.data=S:(S=qv(n),S!==null&&(E.data=S)))),(S=KS?ZS(t,n):JS(t,n))&&(d=Xc(d,"onBeforeInput"),0<d.length&&(u=new cg("onBeforeInput","beforeinput",null,n,u),p.push({event:u,listeners:d}),u.data=S))}ob(p,e)})}function ul(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Xc(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=sl(t,n),i!=null&&r.unshift(ul(t,i,s)),i=sl(t,e),i!=null&&r.push(ul(t,i,s))),t=t.return}return r}function eo(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function wg(t,e,n,r,s){for(var i=e._reactName,a=[];n!==null&&n!==r;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,s?(c=sl(n,i),c!=null&&a.unshift(ul(n,c,l))):s||(c=sl(n,i),c!=null&&a.push(ul(n,c,l)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var hk=/\r\n?/g,pk=/\u0000|\uFFFD/g;function _g(t){return(typeof t=="string"?t:""+t).replace(hk,`
`).replace(pk,"")}function nc(t,e,n){if(e=_g(e),_g(t)!==e&&n)throw Error(Oe(425))}function Kc(){}var $h=null,Lh=null;function Dh(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Ih=typeof setTimeout=="function"?setTimeout:void 0,fk=typeof clearTimeout=="function"?clearTimeout:void 0,Sg=typeof Promise=="function"?Promise:void 0,mk=typeof queueMicrotask=="function"?queueMicrotask:typeof Sg<"u"?function(t){return Sg.resolve(null).then(t).catch(gk)}:Ih;function gk(t){setTimeout(function(){throw t})}function Tu(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),al(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);al(e)}function Ks(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function kg(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var sa=Math.random().toString(36).slice(2),os="__reactFiber$"+sa,hl="__reactProps$"+sa,Ss="__reactContainer$"+sa,zh="__reactEvents$"+sa,yk="__reactListeners$"+sa,xk="__reactHandles$"+sa;function Ci(t){var e=t[os];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Ss]||n[os]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=kg(t);t!==null;){if(n=t[os])return n;t=kg(t)}return e}t=n,n=t.parentNode}return null}function Nl(t){return t=t[os]||t[Ss],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Ro(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Oe(33))}function $d(t){return t[hl]||null}var Fh=[],Oo=-1;function oi(t){return{current:t}}function zt(t){0>Oo||(t.current=Fh[Oo],Fh[Oo]=null,Oo--)}function At(t,e){Oo++,Fh[Oo]=t.current,t.current=e}var ni={},$n=oi(ni),Yn=oi(!1),Ai=ni;function qo(t,e){var n=t.type.contextTypes;if(!n)return ni;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function qn(t){return t=t.childContextTypes,t!=null}function Zc(){zt(Yn),zt($n)}function jg(t,e,n){if($n.current!==ni)throw Error(Oe(168));At($n,e),At(Yn,n)}function lb(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(Oe(108,nS(t)||"Unknown",s));return Vt({},n,r)}function Jc(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||ni,Ai=$n.current,At($n,t),At(Yn,Yn.current),!0}function Cg(t,e,n){var r=t.stateNode;if(!r)throw Error(Oe(169));n?(t=lb(t,e,Ai),r.__reactInternalMemoizedMergedChildContext=t,zt(Yn),zt($n),At($n,t)):zt(Yn),At(Yn,n)}var xs=null,Ld=!1,Nu=!1;function cb(t){xs===null?xs=[t]:xs.push(t)}function vk(t){Ld=!0,cb(t)}function ai(){if(!Nu&&xs!==null){Nu=!0;var t=0,e=Tt;try{var n=xs;for(Tt=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}xs=null,Ld=!1}catch(s){throw xs!==null&&(xs=xs.slice(t+1)),Mv(Gp,ai),s}finally{Tt=e,Nu=!1}}return null}var Ao=[],Mo=0,Qc=null,ed=0,wr=[],_r=0,Mi=null,vs=1,bs="";function yi(t,e){Ao[Mo++]=ed,Ao[Mo++]=Qc,Qc=t,ed=e}function db(t,e,n){wr[_r++]=vs,wr[_r++]=bs,wr[_r++]=Mi,Mi=t;var r=vs;t=bs;var s=32-qr(r)-1;r&=~(1<<s),n+=1;var i=32-qr(e)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,vs=1<<32-qr(e)+s|n<<s|r,bs=i+t}else vs=1<<i|n<<s|r,bs=t}function ef(t){t.return!==null&&(yi(t,1),db(t,1,0))}function tf(t){for(;t===Qc;)Qc=Ao[--Mo],Ao[Mo]=null,ed=Ao[--Mo],Ao[Mo]=null;for(;t===Mi;)Mi=wr[--_r],wr[_r]=null,bs=wr[--_r],wr[_r]=null,vs=wr[--_r],wr[_r]=null}var pr=null,dr=null,Bt=!1,Gr=null;function ub(t,e){var n=kr(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Eg(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,pr=t,dr=Ks(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,pr=t,dr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Mi!==null?{id:vs,overflow:bs}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=kr(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,pr=t,dr=null,!0):!1;default:return!1}}function Bh(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Hh(t){if(Bt){var e=dr;if(e){var n=e;if(!Eg(t,e)){if(Bh(t))throw Error(Oe(418));e=Ks(n.nextSibling);var r=pr;e&&Eg(t,e)?ub(r,n):(t.flags=t.flags&-4097|2,Bt=!1,pr=t)}}else{if(Bh(t))throw Error(Oe(418));t.flags=t.flags&-4097|2,Bt=!1,pr=t}}}function Tg(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;pr=t}function rc(t){if(t!==pr)return!1;if(!Bt)return Tg(t),Bt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Dh(t.type,t.memoizedProps)),e&&(e=dr)){if(Bh(t))throw hb(),Error(Oe(418));for(;e;)ub(t,e),e=Ks(e.nextSibling)}if(Tg(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Oe(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){dr=Ks(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}dr=null}}else dr=pr?Ks(t.stateNode.nextSibling):null;return!0}function hb(){for(var t=dr;t;)t=Ks(t.nextSibling)}function Xo(){dr=pr=null,Bt=!1}function nf(t){Gr===null?Gr=[t]:Gr.push(t)}var bk=Cs.ReactCurrentBatchConfig;function ja(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Oe(309));var r=n.stateNode}if(!r)throw Error(Oe(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var l=s.refs;a===null?delete l[i]:l[i]=a},e._stringRef=i,e)}if(typeof t!="string")throw Error(Oe(284));if(!n._owner)throw Error(Oe(290,t))}return t}function sc(t,e){throw t=Object.prototype.toString.call(e),Error(Oe(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Ng(t){var e=t._init;return e(t._payload)}function pb(t){function e(x,y){if(t){var b=x.deletions;b===null?(x.deletions=[y],x.flags|=16):b.push(y)}}function n(x,y){if(!t)return null;for(;y!==null;)e(x,y),y=y.sibling;return null}function r(x,y){for(x=new Map;y!==null;)y.key!==null?x.set(y.key,y):x.set(y.index,y),y=y.sibling;return x}function s(x,y){return x=ei(x,y),x.index=0,x.sibling=null,x}function i(x,y,b){return x.index=b,t?(b=x.alternate,b!==null?(b=b.index,b<y?(x.flags|=2,y):b):(x.flags|=2,y)):(x.flags|=1048576,y)}function a(x){return t&&x.alternate===null&&(x.flags|=2),x}function l(x,y,b,w){return y===null||y.tag!==6?(y=Lu(b,x.mode,w),y.return=x,y):(y=s(y,b),y.return=x,y)}function c(x,y,b,w){var j=b.type;return j===Eo?u(x,y,b.props.children,w,b.key):y!==null&&(y.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===Ls&&Ng(j)===y.type)?(w=s(y,b.props),w.ref=ja(x,y,b),w.return=x,w):(w=Fc(b.type,b.key,b.props,null,x.mode,w),w.ref=ja(x,y,b),w.return=x,w)}function d(x,y,b,w){return y===null||y.tag!==4||y.stateNode.containerInfo!==b.containerInfo||y.stateNode.implementation!==b.implementation?(y=Du(b,x.mode,w),y.return=x,y):(y=s(y,b.children||[]),y.return=x,y)}function u(x,y,b,w,j){return y===null||y.tag!==7?(y=Ri(b,x.mode,w,j),y.return=x,y):(y=s(y,b),y.return=x,y)}function p(x,y,b){if(typeof y=="string"&&y!==""||typeof y=="number")return y=Lu(""+y,x.mode,b),y.return=x,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Yl:return b=Fc(y.type,y.key,y.props,null,x.mode,b),b.ref=ja(x,null,y),b.return=x,b;case Co:return y=Du(y,x.mode,b),y.return=x,y;case Ls:var w=y._init;return p(x,w(y._payload),b)}if(La(y)||ba(y))return y=Ri(y,x.mode,b,null),y.return=x,y;sc(x,y)}return null}function h(x,y,b,w){var j=y!==null?y.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return j!==null?null:l(x,y,""+b,w);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Yl:return b.key===j?c(x,y,b,w):null;case Co:return b.key===j?d(x,y,b,w):null;case Ls:return j=b._init,h(x,y,j(b._payload),w)}if(La(b)||ba(b))return j!==null?null:u(x,y,b,w,null);sc(x,b)}return null}function f(x,y,b,w,j){if(typeof w=="string"&&w!==""||typeof w=="number")return x=x.get(b)||null,l(y,x,""+w,j);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Yl:return x=x.get(w.key===null?b:w.key)||null,c(y,x,w,j);case Co:return x=x.get(w.key===null?b:w.key)||null,d(y,x,w,j);case Ls:var _=w._init;return f(x,y,b,_(w._payload),j)}if(La(w)||ba(w))return x=x.get(b)||null,u(y,x,w,j,null);sc(y,w)}return null}function m(x,y,b,w){for(var j=null,_=null,S=y,E=y=0,T=null;S!==null&&E<b.length;E++){S.index>E?(T=S,S=null):T=S.sibling;var M=h(x,S,b[E],w);if(M===null){S===null&&(S=T);break}t&&S&&M.alternate===null&&e(x,S),y=i(M,y,E),_===null?j=M:_.sibling=M,_=M,S=T}if(E===b.length)return n(x,S),Bt&&yi(x,E),j;if(S===null){for(;E<b.length;E++)S=p(x,b[E],w),S!==null&&(y=i(S,y,E),_===null?j=S:_.sibling=S,_=S);return Bt&&yi(x,E),j}for(S=r(x,S);E<b.length;E++)T=f(S,x,E,b[E],w),T!==null&&(t&&T.alternate!==null&&S.delete(T.key===null?E:T.key),y=i(T,y,E),_===null?j=T:_.sibling=T,_=T);return t&&S.forEach(function(Z){return e(x,Z)}),Bt&&yi(x,E),j}function g(x,y,b,w){var j=ba(b);if(typeof j!="function")throw Error(Oe(150));if(b=j.call(b),b==null)throw Error(Oe(151));for(var _=j=null,S=y,E=y=0,T=null,M=b.next();S!==null&&!M.done;E++,M=b.next()){S.index>E?(T=S,S=null):T=S.sibling;var Z=h(x,S,M.value,w);if(Z===null){S===null&&(S=T);break}t&&S&&Z.alternate===null&&e(x,S),y=i(Z,y,E),_===null?j=Z:_.sibling=Z,_=Z,S=T}if(M.done)return n(x,S),Bt&&yi(x,E),j;if(S===null){for(;!M.done;E++,M=b.next())M=p(x,M.value,w),M!==null&&(y=i(M,y,E),_===null?j=M:_.sibling=M,_=M);return Bt&&yi(x,E),j}for(S=r(x,S);!M.done;E++,M=b.next())M=f(S,x,E,M.value,w),M!==null&&(t&&M.alternate!==null&&S.delete(M.key===null?E:M.key),y=i(M,y,E),_===null?j=M:_.sibling=M,_=M);return t&&S.forEach(function(N){return e(x,N)}),Bt&&yi(x,E),j}function v(x,y,b,w){if(typeof b=="object"&&b!==null&&b.type===Eo&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case Yl:e:{for(var j=b.key,_=y;_!==null;){if(_.key===j){if(j=b.type,j===Eo){if(_.tag===7){n(x,_.sibling),y=s(_,b.props.children),y.return=x,x=y;break e}}else if(_.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===Ls&&Ng(j)===_.type){n(x,_.sibling),y=s(_,b.props),y.ref=ja(x,_,b),y.return=x,x=y;break e}n(x,_);break}else e(x,_);_=_.sibling}b.type===Eo?(y=Ri(b.props.children,x.mode,w,b.key),y.return=x,x=y):(w=Fc(b.type,b.key,b.props,null,x.mode,w),w.ref=ja(x,y,b),w.return=x,x=w)}return a(x);case Co:e:{for(_=b.key;y!==null;){if(y.key===_)if(y.tag===4&&y.stateNode.containerInfo===b.containerInfo&&y.stateNode.implementation===b.implementation){n(x,y.sibling),y=s(y,b.children||[]),y.return=x,x=y;break e}else{n(x,y);break}else e(x,y);y=y.sibling}y=Du(b,x.mode,w),y.return=x,x=y}return a(x);case Ls:return _=b._init,v(x,y,_(b._payload),w)}if(La(b))return m(x,y,b,w);if(ba(b))return g(x,y,b,w);sc(x,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,y!==null&&y.tag===6?(n(x,y.sibling),y=s(y,b),y.return=x,x=y):(n(x,y),y=Lu(b,x.mode,w),y.return=x,x=y),a(x)):n(x,y)}return v}var Ko=pb(!0),fb=pb(!1),td=oi(null),nd=null,$o=null,rf=null;function sf(){rf=$o=nd=null}function of(t){var e=td.current;zt(td),t._currentValue=e}function Uh(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Uo(t,e){nd=t,rf=$o=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Vn=!0),t.firstContext=null)}function Cr(t){var e=t._currentValue;if(rf!==t)if(t={context:t,memoizedValue:e,next:null},$o===null){if(nd===null)throw Error(Oe(308));$o=t,nd.dependencies={lanes:0,firstContext:t}}else $o=$o.next=t;return e}var Ei=null;function af(t){Ei===null?Ei=[t]:Ei.push(t)}function mb(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,af(e)):(n.next=s.next,s.next=n),e.interleaved=n,ks(t,r)}function ks(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Ds=!1;function lf(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function gb(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function ws(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Zs(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,St&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,ks(t,n)}return s=r.interleaved,s===null?(e.next=e,af(r)):(e.next=s.next,s.next=e),r.interleaved=e,ks(t,n)}function Mc(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Vp(t,n)}}function Pg(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function rd(t,e,n,r){var s=t.updateQueue;Ds=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,a===null?i=d:a.next=d,a=c;var u=t.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==a&&(l===null?u.firstBaseUpdate=d:l.next=d,u.lastBaseUpdate=c))}if(i!==null){var p=s.baseState;a=0,u=d=c=null,l=i;do{var h=l.lane,f=l.eventTime;if((r&h)===h){u!==null&&(u=u.next={eventTime:f,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var m=t,g=l;switch(h=e,f=n,g.tag){case 1:if(m=g.payload,typeof m=="function"){p=m.call(f,p,h);break e}p=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=g.payload,h=typeof m=="function"?m.call(f,p,h):m,h==null)break e;p=Vt({},p,h);break e;case 2:Ds=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,h=s.effects,h===null?s.effects=[l]:h.push(l))}else f={eventTime:f,lane:h,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(d=u=f,c=p):u=u.next=f,a|=h;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;h=l,l=h.next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}while(!0);if(u===null&&(c=p),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Li|=a,t.lanes=a,t.memoizedState=p}}function Rg(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(Oe(191,s));s.call(r)}}}var Pl={},cs=oi(Pl),pl=oi(Pl),fl=oi(Pl);function Ti(t){if(t===Pl)throw Error(Oe(174));return t}function cf(t,e){switch(At(fl,e),At(pl,t),At(cs,Pl),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Sh(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Sh(e,t)}zt(cs),At(cs,e)}function Zo(){zt(cs),zt(pl),zt(fl)}function yb(t){Ti(fl.current);var e=Ti(cs.current),n=Sh(e,t.type);e!==n&&(At(pl,t),At(cs,n))}function df(t){pl.current===t&&(zt(cs),zt(pl))}var Wt=oi(0);function sd(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Pu=[];function uf(){for(var t=0;t<Pu.length;t++)Pu[t]._workInProgressVersionPrimary=null;Pu.length=0}var $c=Cs.ReactCurrentDispatcher,Ru=Cs.ReactCurrentBatchConfig,$i=0,Gt=null,on=null,hn=null,id=!1,qa=!1,ml=0,wk=0;function Rn(){throw Error(Oe(321))}function hf(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Kr(t[n],e[n]))return!1;return!0}function pf(t,e,n,r,s,i){if($i=i,Gt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,$c.current=t===null||t.memoizedState===null?jk:Ck,t=n(r,s),qa){i=0;do{if(qa=!1,ml=0,25<=i)throw Error(Oe(301));i+=1,hn=on=null,e.updateQueue=null,$c.current=Ek,t=n(r,s)}while(qa)}if($c.current=od,e=on!==null&&on.next!==null,$i=0,hn=on=Gt=null,id=!1,e)throw Error(Oe(300));return t}function ff(){var t=ml!==0;return ml=0,t}function is(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return hn===null?Gt.memoizedState=hn=t:hn=hn.next=t,hn}function Er(){if(on===null){var t=Gt.alternate;t=t!==null?t.memoizedState:null}else t=on.next;var e=hn===null?Gt.memoizedState:hn.next;if(e!==null)hn=e,on=t;else{if(t===null)throw Error(Oe(310));on=t,t={memoizedState:on.memoizedState,baseState:on.baseState,baseQueue:on.baseQueue,queue:on.queue,next:null},hn===null?Gt.memoizedState=hn=t:hn=hn.next=t}return hn}function gl(t,e){return typeof e=="function"?e(t):e}function Ou(t){var e=Er(),n=e.queue;if(n===null)throw Error(Oe(311));n.lastRenderedReducer=t;var r=on,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var a=s.next;s.next=i.next,i.next=a}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=a=null,c=null,d=i;do{var u=d.lane;if(($i&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var p={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=p,a=r):c=c.next=p,Gt.lanes|=u,Li|=u}d=d.next}while(d!==null&&d!==i);c===null?a=r:c.next=l,Kr(r,e.memoizedState)||(Vn=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,Gt.lanes|=i,Li|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Au(t){var e=Er(),n=e.queue;if(n===null)throw Error(Oe(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var a=s=s.next;do i=t(i,a.action),a=a.next;while(a!==s);Kr(i,e.memoizedState)||(Vn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function xb(){}function vb(t,e){var n=Gt,r=Er(),s=e(),i=!Kr(r.memoizedState,s);if(i&&(r.memoizedState=s,Vn=!0),r=r.queue,mf(_b.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||hn!==null&&hn.memoizedState.tag&1){if(n.flags|=2048,yl(9,wb.bind(null,n,r,s,e),void 0,null),pn===null)throw Error(Oe(349));$i&30||bb(n,e,s)}return s}function bb(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Gt.updateQueue,e===null?(e={lastEffect:null,stores:null},Gt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function wb(t,e,n,r){e.value=n,e.getSnapshot=r,Sb(e)&&kb(t)}function _b(t,e,n){return n(function(){Sb(e)&&kb(t)})}function Sb(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Kr(t,n)}catch{return!0}}function kb(t){var e=ks(t,1);e!==null&&Xr(e,t,1,-1)}function Og(t){var e=is();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:gl,lastRenderedState:t},e.queue=t,t=t.dispatch=kk.bind(null,Gt,t),[e.memoizedState,t]}function yl(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Gt.updateQueue,e===null?(e={lastEffect:null,stores:null},Gt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function jb(){return Er().memoizedState}function Lc(t,e,n,r){var s=is();Gt.flags|=t,s.memoizedState=yl(1|e,n,void 0,r===void 0?null:r)}function Dd(t,e,n,r){var s=Er();r=r===void 0?null:r;var i=void 0;if(on!==null){var a=on.memoizedState;if(i=a.destroy,r!==null&&hf(r,a.deps)){s.memoizedState=yl(e,n,i,r);return}}Gt.flags|=t,s.memoizedState=yl(1|e,n,i,r)}function Ag(t,e){return Lc(8390656,8,t,e)}function mf(t,e){return Dd(2048,8,t,e)}function Cb(t,e){return Dd(4,2,t,e)}function Eb(t,e){return Dd(4,4,t,e)}function Tb(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Nb(t,e,n){return n=n!=null?n.concat([t]):null,Dd(4,4,Tb.bind(null,e,t),n)}function gf(){}function Pb(t,e){var n=Er();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&hf(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function Rb(t,e){var n=Er();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&hf(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Ob(t,e,n){return $i&21?(Kr(n,e)||(n=Dv(),Gt.lanes|=n,Li|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Vn=!0),t.memoizedState=n)}function _k(t,e){var n=Tt;Tt=n!==0&&4>n?n:4,t(!0);var r=Ru.transition;Ru.transition={};try{t(!1),e()}finally{Tt=n,Ru.transition=r}}function Ab(){return Er().memoizedState}function Sk(t,e,n){var r=Qs(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Mb(t))$b(e,n);else if(n=mb(t,e,n,r),n!==null){var s=Hn();Xr(n,t,r,s),Lb(n,e,r)}}function kk(t,e,n){var r=Qs(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Mb(t))$b(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,l=i(a,n);if(s.hasEagerState=!0,s.eagerState=l,Kr(l,a)){var c=e.interleaved;c===null?(s.next=s,af(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=mb(t,e,s,r),n!==null&&(s=Hn(),Xr(n,t,r,s),Lb(n,e,r))}}function Mb(t){var e=t.alternate;return t===Gt||e!==null&&e===Gt}function $b(t,e){qa=id=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Lb(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Vp(t,n)}}var od={readContext:Cr,useCallback:Rn,useContext:Rn,useEffect:Rn,useImperativeHandle:Rn,useInsertionEffect:Rn,useLayoutEffect:Rn,useMemo:Rn,useReducer:Rn,useRef:Rn,useState:Rn,useDebugValue:Rn,useDeferredValue:Rn,useTransition:Rn,useMutableSource:Rn,useSyncExternalStore:Rn,useId:Rn,unstable_isNewReconciler:!1},jk={readContext:Cr,useCallback:function(t,e){return is().memoizedState=[t,e===void 0?null:e],t},useContext:Cr,useEffect:Ag,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Lc(4194308,4,Tb.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Lc(4194308,4,t,e)},useInsertionEffect:function(t,e){return Lc(4,2,t,e)},useMemo:function(t,e){var n=is();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=is();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=Sk.bind(null,Gt,t),[r.memoizedState,t]},useRef:function(t){var e=is();return t={current:t},e.memoizedState=t},useState:Og,useDebugValue:gf,useDeferredValue:function(t){return is().memoizedState=t},useTransition:function(){var t=Og(!1),e=t[0];return t=_k.bind(null,t[1]),is().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Gt,s=is();if(Bt){if(n===void 0)throw Error(Oe(407));n=n()}else{if(n=e(),pn===null)throw Error(Oe(349));$i&30||bb(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,Ag(_b.bind(null,r,i,t),[t]),r.flags|=2048,yl(9,wb.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=is(),e=pn.identifierPrefix;if(Bt){var n=bs,r=vs;n=(r&~(1<<32-qr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=ml++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=wk++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Ck={readContext:Cr,useCallback:Pb,useContext:Cr,useEffect:mf,useImperativeHandle:Nb,useInsertionEffect:Cb,useLayoutEffect:Eb,useMemo:Rb,useReducer:Ou,useRef:jb,useState:function(){return Ou(gl)},useDebugValue:gf,useDeferredValue:function(t){var e=Er();return Ob(e,on.memoizedState,t)},useTransition:function(){var t=Ou(gl)[0],e=Er().memoizedState;return[t,e]},useMutableSource:xb,useSyncExternalStore:vb,useId:Ab,unstable_isNewReconciler:!1},Ek={readContext:Cr,useCallback:Pb,useContext:Cr,useEffect:mf,useImperativeHandle:Nb,useInsertionEffect:Cb,useLayoutEffect:Eb,useMemo:Rb,useReducer:Au,useRef:jb,useState:function(){return Au(gl)},useDebugValue:gf,useDeferredValue:function(t){var e=Er();return on===null?e.memoizedState=t:Ob(e,on.memoizedState,t)},useTransition:function(){var t=Au(gl)[0],e=Er().memoizedState;return[t,e]},useMutableSource:xb,useSyncExternalStore:vb,useId:Ab,unstable_isNewReconciler:!1};function Br(t,e){if(t&&t.defaultProps){e=Vt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Wh(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Vt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Id={isMounted:function(t){return(t=t._reactInternals)?Fi(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Hn(),s=Qs(t),i=ws(r,s);i.payload=e,n!=null&&(i.callback=n),e=Zs(t,i,s),e!==null&&(Xr(e,t,s,r),Mc(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Hn(),s=Qs(t),i=ws(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Zs(t,i,s),e!==null&&(Xr(e,t,s,r),Mc(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Hn(),r=Qs(t),s=ws(n,r);s.tag=2,e!=null&&(s.callback=e),e=Zs(t,s,r),e!==null&&(Xr(e,t,r,n),Mc(e,t,r))}};function Mg(t,e,n,r,s,i,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,a):e.prototype&&e.prototype.isPureReactComponent?!cl(n,r)||!cl(s,i):!0}function Db(t,e,n){var r=!1,s=ni,i=e.contextType;return typeof i=="object"&&i!==null?i=Cr(i):(s=qn(e)?Ai:$n.current,r=e.contextTypes,i=(r=r!=null)?qo(t,s):ni),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Id,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function $g(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Id.enqueueReplaceState(e,e.state,null)}function Gh(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},lf(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Cr(i):(i=qn(e)?Ai:$n.current,s.context=qo(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Wh(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Id.enqueueReplaceState(s,s.state,null),rd(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Jo(t,e){try{var n="",r=e;do n+=tS(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function Mu(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Vh(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var Tk=typeof WeakMap=="function"?WeakMap:Map;function Ib(t,e,n){n=ws(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){ld||(ld=!0,np=r),Vh(t,e)},n}function zb(t,e,n){n=ws(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Vh(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Vh(t,e),typeof r!="function"&&(Js===null?Js=new Set([this]):Js.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}function Lg(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new Tk;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=Hk.bind(null,t,e,n),e.then(t,t))}function Dg(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Ig(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=ws(-1,1),e.tag=2,Zs(n,e,1))),n.lanes|=1),t)}var Nk=Cs.ReactCurrentOwner,Vn=!1;function Fn(t,e,n,r){e.child=t===null?fb(e,null,n,r):Ko(e,t.child,n,r)}function zg(t,e,n,r,s){n=n.render;var i=e.ref;return Uo(e,s),r=pf(t,e,n,r,i,s),n=ff(),t!==null&&!Vn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,js(t,e,s)):(Bt&&n&&ef(e),e.flags|=1,Fn(t,e,r,s),e.child)}function Fg(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!kf(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,Fb(t,e,i,r,s)):(t=Fc(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:cl,n(a,r)&&t.ref===e.ref)return js(t,e,s)}return e.flags|=1,t=ei(i,r),t.ref=e.ref,t.return=e,e.child=t}function Fb(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(cl(i,r)&&t.ref===e.ref)if(Vn=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Vn=!0);else return e.lanes=t.lanes,js(t,e,s)}return Yh(t,e,n,r,s)}function Bb(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},At(Do,ar),ar|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,At(Do,ar),ar|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,At(Do,ar),ar|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,At(Do,ar),ar|=r;return Fn(t,e,s,n),e.child}function Hb(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Yh(t,e,n,r,s){var i=qn(n)?Ai:$n.current;return i=qo(e,i),Uo(e,s),n=pf(t,e,n,r,i,s),r=ff(),t!==null&&!Vn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,js(t,e,s)):(Bt&&r&&ef(e),e.flags|=1,Fn(t,e,n,s),e.child)}function Bg(t,e,n,r,s){if(qn(n)){var i=!0;Jc(e)}else i=!1;if(Uo(e,s),e.stateNode===null)Dc(t,e),Db(e,n,r),Gh(e,n,r,s),r=!0;else if(t===null){var a=e.stateNode,l=e.memoizedProps;a.props=l;var c=a.context,d=n.contextType;typeof d=="object"&&d!==null?d=Cr(d):(d=qn(n)?Ai:$n.current,d=qo(e,d));var u=n.getDerivedStateFromProps,p=typeof u=="function"||typeof a.getSnapshotBeforeUpdate=="function";p||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==r||c!==d)&&$g(e,a,r,d),Ds=!1;var h=e.memoizedState;a.state=h,rd(e,r,a,s),c=e.memoizedState,l!==r||h!==c||Yn.current||Ds?(typeof u=="function"&&(Wh(e,n,u,r),c=e.memoizedState),(l=Ds||Mg(e,n,l,r,h,c,d))?(p||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),a.props=r,a.state=c,a.context=d,r=l):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,gb(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:Br(e.type,l),a.props=d,p=e.pendingProps,h=a.context,c=n.contextType,typeof c=="object"&&c!==null?c=Cr(c):(c=qn(n)?Ai:$n.current,c=qo(e,c));var f=n.getDerivedStateFromProps;(u=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==p||h!==c)&&$g(e,a,r,c),Ds=!1,h=e.memoizedState,a.state=h,rd(e,r,a,s);var m=e.memoizedState;l!==p||h!==m||Yn.current||Ds?(typeof f=="function"&&(Wh(e,n,f,r),m=e.memoizedState),(d=Ds||Mg(e,n,d,r,h,m,c)||!1)?(u||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,m,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,m,c)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||l===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=m),a.props=r,a.state=m,a.context=c,r=d):(typeof a.componentDidUpdate!="function"||l===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),r=!1)}return qh(t,e,n,r,i,s)}function qh(t,e,n,r,s,i){Hb(t,e);var a=(e.flags&128)!==0;if(!r&&!a)return s&&Cg(e,n,!1),js(t,e,i);r=e.stateNode,Nk.current=e;var l=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&a?(e.child=Ko(e,t.child,null,i),e.child=Ko(e,null,l,i)):Fn(t,e,l,i),e.memoizedState=r.state,s&&Cg(e,n,!0),e.child}function Ub(t){var e=t.stateNode;e.pendingContext?jg(t,e.pendingContext,e.pendingContext!==e.context):e.context&&jg(t,e.context,!1),cf(t,e.containerInfo)}function Hg(t,e,n,r,s){return Xo(),nf(s),e.flags|=256,Fn(t,e,n,r),e.child}var Xh={dehydrated:null,treeContext:null,retryLane:0};function Kh(t){return{baseLanes:t,cachePool:null,transitions:null}}function Wb(t,e,n){var r=e.pendingProps,s=Wt.current,i=!1,a=(e.flags&128)!==0,l;if((l=a)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),At(Wt,s&1),t===null)return Hh(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,t=r.fallback,i?(r=e.mode,i=e.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=Bd(a,r,0,null),t=Ri(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Kh(n),e.memoizedState=Xh,t):yf(e,a));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return Pk(t,e,a,r,l,s,n);if(i){i=r.fallback,a=e.mode,s=t.child,l=s.sibling;var c={mode:"hidden",children:r.children};return!(a&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=ei(s,c),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=ei(l,i):(i=Ri(i,a,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,a=t.child.memoizedState,a=a===null?Kh(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=t.childLanes&~n,e.memoizedState=Xh,r}return i=t.child,t=i.sibling,r=ei(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function yf(t,e){return e=Bd({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ic(t,e,n,r){return r!==null&&nf(r),Ko(e,t.child,null,n),t=yf(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Pk(t,e,n,r,s,i,a){if(n)return e.flags&256?(e.flags&=-257,r=Mu(Error(Oe(422))),ic(t,e,a,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Bd({mode:"visible",children:r.children},s,0,null),i=Ri(i,s,a,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Ko(e,t.child,null,a),e.child.memoizedState=Kh(a),e.memoizedState=Xh,i);if(!(e.mode&1))return ic(t,e,a,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(Oe(419)),r=Mu(i,r,void 0),ic(t,e,a,r)}if(l=(a&t.childLanes)!==0,Vn||l){if(r=pn,r!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|a)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,ks(t,s),Xr(r,t,s,-1))}return Sf(),r=Mu(Error(Oe(421))),ic(t,e,a,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=Uk.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,dr=Ks(s.nextSibling),pr=e,Bt=!0,Gr=null,t!==null&&(wr[_r++]=vs,wr[_r++]=bs,wr[_r++]=Mi,vs=t.id,bs=t.overflow,Mi=e),e=yf(e,r.children),e.flags|=4096,e)}function Ug(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Uh(t.return,e,n)}function $u(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function Gb(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(Fn(t,e,r.children,n),r=Wt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Ug(t,n,e);else if(t.tag===19)Ug(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(At(Wt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&sd(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),$u(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&sd(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}$u(e,!0,n,null,i);break;case"together":$u(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Dc(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function js(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Li|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Oe(153));if(e.child!==null){for(t=e.child,n=ei(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=ei(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function Rk(t,e,n){switch(e.tag){case 3:Ub(e),Xo();break;case 5:yb(e);break;case 1:qn(e.type)&&Jc(e);break;case 4:cf(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;At(td,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(At(Wt,Wt.current&1),e.flags|=128,null):n&e.child.childLanes?Wb(t,e,n):(At(Wt,Wt.current&1),t=js(t,e,n),t!==null?t.sibling:null);At(Wt,Wt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return Gb(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),At(Wt,Wt.current),r)break;return null;case 22:case 23:return e.lanes=0,Bb(t,e,n)}return js(t,e,n)}var Vb,Zh,Yb,qb;Vb=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Zh=function(){};Yb=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Ti(cs.current);var i=null;switch(n){case"input":s=vh(t,s),r=vh(t,r),i=[];break;case"select":s=Vt({},s,{value:void 0}),r=Vt({},r,{value:void 0}),i=[];break;case"textarea":s=_h(t,s),r=_h(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Kc)}kh(n,r);var a;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(nl.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(nl.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Lt("scroll",t),i||l===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};qb=function(t,e,n,r){n!==r&&(e.flags|=4)};function Ca(t,e){if(!Bt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function On(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function Ok(t,e,n){var r=e.pendingProps;switch(tf(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return On(e),null;case 1:return qn(e.type)&&Zc(),On(e),null;case 3:return r=e.stateNode,Zo(),zt(Yn),zt($n),uf(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(rc(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Gr!==null&&(ip(Gr),Gr=null))),Zh(t,e),On(e),null;case 5:df(e);var s=Ti(fl.current);if(n=e.type,t!==null&&e.stateNode!=null)Yb(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Oe(166));return On(e),null}if(t=Ti(cs.current),rc(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[os]=e,r[hl]=i,t=(e.mode&1)!==0,n){case"dialog":Lt("cancel",r),Lt("close",r);break;case"iframe":case"object":case"embed":Lt("load",r);break;case"video":case"audio":for(s=0;s<Ia.length;s++)Lt(Ia[s],r);break;case"source":Lt("error",r);break;case"img":case"image":case"link":Lt("error",r),Lt("load",r);break;case"details":Lt("toggle",r);break;case"input":Jm(r,i),Lt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Lt("invalid",r);break;case"textarea":eg(r,i),Lt("invalid",r)}kh(n,i),s=null;for(var a in i)if(i.hasOwnProperty(a)){var l=i[a];a==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&nc(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&nc(r.textContent,l,t),s=["children",""+l]):nl.hasOwnProperty(a)&&l!=null&&a==="onScroll"&&Lt("scroll",r)}switch(n){case"input":ql(r),Qm(r,i,!0);break;case"textarea":ql(r),tg(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Kc)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=_v(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=a.createElement(n,{is:r.is}):(t=a.createElement(n),n==="select"&&(a=t,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):t=a.createElementNS(t,n),t[os]=e,t[hl]=r,Vb(t,e,!1,!1),e.stateNode=t;e:{switch(a=jh(n,r),n){case"dialog":Lt("cancel",t),Lt("close",t),s=r;break;case"iframe":case"object":case"embed":Lt("load",t),s=r;break;case"video":case"audio":for(s=0;s<Ia.length;s++)Lt(Ia[s],t);s=r;break;case"source":Lt("error",t),s=r;break;case"img":case"image":case"link":Lt("error",t),Lt("load",t),s=r;break;case"details":Lt("toggle",t),s=r;break;case"input":Jm(t,r),s=vh(t,r),Lt("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=Vt({},r,{value:void 0}),Lt("invalid",t);break;case"textarea":eg(t,r),s=_h(t,r),Lt("invalid",t);break;default:s=r}kh(n,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?jv(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Sv(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&rl(t,c):typeof c=="number"&&rl(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(nl.hasOwnProperty(i)?c!=null&&i==="onScroll"&&Lt("scroll",t):c!=null&&Fp(t,i,c,a))}switch(n){case"input":ql(t),Qm(t,r,!1);break;case"textarea":ql(t),tg(t);break;case"option":r.value!=null&&t.setAttribute("value",""+ti(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?zo(t,!!r.multiple,i,!1):r.defaultValue!=null&&zo(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Kc)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return On(e),null;case 6:if(t&&e.stateNode!=null)qb(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Oe(166));if(n=Ti(fl.current),Ti(cs.current),rc(e)){if(r=e.stateNode,n=e.memoizedProps,r[os]=e,(i=r.nodeValue!==n)&&(t=pr,t!==null))switch(t.tag){case 3:nc(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&nc(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[os]=e,e.stateNode=r}return On(e),null;case 13:if(zt(Wt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Bt&&dr!==null&&e.mode&1&&!(e.flags&128))hb(),Xo(),e.flags|=98560,i=!1;else if(i=rc(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(Oe(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Oe(317));i[os]=e}else Xo(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;On(e),i=!1}else Gr!==null&&(ip(Gr),Gr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Wt.current&1?ln===0&&(ln=3):Sf())),e.updateQueue!==null&&(e.flags|=4),On(e),null);case 4:return Zo(),Zh(t,e),t===null&&dl(e.stateNode.containerInfo),On(e),null;case 10:return of(e.type._context),On(e),null;case 17:return qn(e.type)&&Zc(),On(e),null;case 19:if(zt(Wt),i=e.memoizedState,i===null)return On(e),null;if(r=(e.flags&128)!==0,a=i.rendering,a===null)if(r)Ca(i,!1);else{if(ln!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=sd(t),a!==null){for(e.flags|=128,Ca(i,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,t=a.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return At(Wt,Wt.current&1|2),e.child}t=t.sibling}i.tail!==null&&Zt()>Qo&&(e.flags|=128,r=!0,Ca(i,!1),e.lanes=4194304)}else{if(!r)if(t=sd(a),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Ca(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!Bt)return On(e),null}else 2*Zt()-i.renderingStartTime>Qo&&n!==1073741824&&(e.flags|=128,r=!0,Ca(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(n=i.last,n!==null?n.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Zt(),e.sibling=null,n=Wt.current,At(Wt,r?n&1|2:n&1),e):(On(e),null);case 22:case 23:return _f(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?ar&1073741824&&(On(e),e.subtreeFlags&6&&(e.flags|=8192)):On(e),null;case 24:return null;case 25:return null}throw Error(Oe(156,e.tag))}function Ak(t,e){switch(tf(e),e.tag){case 1:return qn(e.type)&&Zc(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Zo(),zt(Yn),zt($n),uf(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return df(e),null;case 13:if(zt(Wt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Oe(340));Xo()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return zt(Wt),null;case 4:return Zo(),null;case 10:return of(e.type._context),null;case 22:case 23:return _f(),null;case 24:return null;default:return null}}var oc=!1,Mn=!1,Mk=typeof WeakSet=="function"?WeakSet:Set,We=null;function Lo(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){qt(t,e,r)}else n.current=null}function Jh(t,e,n){try{n()}catch(r){qt(t,e,r)}}var Wg=!1;function $k(t,e){if($h=Yc,t=Qv(),Qp(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,l=-1,c=-1,d=0,u=0,p=t,h=null;t:for(;;){for(var f;p!==n||s!==0&&p.nodeType!==3||(l=a+s),p!==i||r!==0&&p.nodeType!==3||(c=a+r),p.nodeType===3&&(a+=p.nodeValue.length),(f=p.firstChild)!==null;)h=p,p=f;for(;;){if(p===t)break t;if(h===n&&++d===s&&(l=a),h===i&&++u===r&&(c=a),(f=p.nextSibling)!==null)break;p=h,h=p.parentNode}p=f}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Lh={focusedElem:t,selectionRange:n},Yc=!1,We=e;We!==null;)if(e=We,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,We=t;else for(;We!==null;){e=We;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var g=m.memoizedProps,v=m.memoizedState,x=e.stateNode,y=x.getSnapshotBeforeUpdate(e.elementType===e.type?g:Br(e.type,g),v);x.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Oe(163))}}catch(w){qt(e,e.return,w)}if(t=e.sibling,t!==null){t.return=e.return,We=t;break}We=e.return}return m=Wg,Wg=!1,m}function Xa(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Jh(e,n,i)}s=s.next}while(s!==r)}}function zd(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Qh(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function Xb(t){var e=t.alternate;e!==null&&(t.alternate=null,Xb(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[os],delete e[hl],delete e[zh],delete e[yk],delete e[xk])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Kb(t){return t.tag===5||t.tag===3||t.tag===4}function Gg(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Kb(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function ep(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Kc));else if(r!==4&&(t=t.child,t!==null))for(ep(t,e,n),t=t.sibling;t!==null;)ep(t,e,n),t=t.sibling}function tp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(tp(t,e,n),t=t.sibling;t!==null;)tp(t,e,n),t=t.sibling}var yn=null,Ur=!1;function Ms(t,e,n){for(n=n.child;n!==null;)Zb(t,e,n),n=n.sibling}function Zb(t,e,n){if(ls&&typeof ls.onCommitFiberUnmount=="function")try{ls.onCommitFiberUnmount(Rd,n)}catch{}switch(n.tag){case 5:Mn||Lo(n,e);case 6:var r=yn,s=Ur;yn=null,Ms(t,e,n),yn=r,Ur=s,yn!==null&&(Ur?(t=yn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):yn.removeChild(n.stateNode));break;case 18:yn!==null&&(Ur?(t=yn,n=n.stateNode,t.nodeType===8?Tu(t.parentNode,n):t.nodeType===1&&Tu(t,n),al(t)):Tu(yn,n.stateNode));break;case 4:r=yn,s=Ur,yn=n.stateNode.containerInfo,Ur=!0,Ms(t,e,n),yn=r,Ur=s;break;case 0:case 11:case 14:case 15:if(!Mn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&Jh(n,e,a),s=s.next}while(s!==r)}Ms(t,e,n);break;case 1:if(!Mn&&(Lo(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){qt(n,e,l)}Ms(t,e,n);break;case 21:Ms(t,e,n);break;case 22:n.mode&1?(Mn=(r=Mn)||n.memoizedState!==null,Ms(t,e,n),Mn=r):Ms(t,e,n);break;default:Ms(t,e,n)}}function Vg(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Mk),e.forEach(function(r){var s=Wk.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function Dr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,a=e,l=a;e:for(;l!==null;){switch(l.tag){case 5:yn=l.stateNode,Ur=!1;break e;case 3:yn=l.stateNode.containerInfo,Ur=!0;break e;case 4:yn=l.stateNode.containerInfo,Ur=!0;break e}l=l.return}if(yn===null)throw Error(Oe(160));Zb(i,a,s),yn=null,Ur=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){qt(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Jb(e,t),e=e.sibling}function Jb(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Dr(e,t),rs(t),r&4){try{Xa(3,t,t.return),zd(3,t)}catch(g){qt(t,t.return,g)}try{Xa(5,t,t.return)}catch(g){qt(t,t.return,g)}}break;case 1:Dr(e,t),rs(t),r&512&&n!==null&&Lo(n,n.return);break;case 5:if(Dr(e,t),rs(t),r&512&&n!==null&&Lo(n,n.return),t.flags&32){var s=t.stateNode;try{rl(s,"")}catch(g){qt(t,t.return,g)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,a=n!==null?n.memoizedProps:i,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&bv(s,i),jh(l,a);var d=jh(l,i);for(a=0;a<c.length;a+=2){var u=c[a],p=c[a+1];u==="style"?jv(s,p):u==="dangerouslySetInnerHTML"?Sv(s,p):u==="children"?rl(s,p):Fp(s,u,p,d)}switch(l){case"input":bh(s,i);break;case"textarea":wv(s,i);break;case"select":var h=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var f=i.value;f!=null?zo(s,!!i.multiple,f,!1):h!==!!i.multiple&&(i.defaultValue!=null?zo(s,!!i.multiple,i.defaultValue,!0):zo(s,!!i.multiple,i.multiple?[]:"",!1))}s[hl]=i}catch(g){qt(t,t.return,g)}}break;case 6:if(Dr(e,t),rs(t),r&4){if(t.stateNode===null)throw Error(Oe(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(g){qt(t,t.return,g)}}break;case 3:if(Dr(e,t),rs(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{al(e.containerInfo)}catch(g){qt(t,t.return,g)}break;case 4:Dr(e,t),rs(t);break;case 13:Dr(e,t),rs(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(bf=Zt())),r&4&&Vg(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Mn=(d=Mn)||u,Dr(e,t),Mn=d):Dr(e,t),rs(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!u&&t.mode&1)for(We=t,u=t.child;u!==null;){for(p=We=u;We!==null;){switch(h=We,f=h.child,h.tag){case 0:case 11:case 14:case 15:Xa(4,h,h.return);break;case 1:Lo(h,h.return);var m=h.stateNode;if(typeof m.componentWillUnmount=="function"){r=h,n=h.return;try{e=r,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(g){qt(r,n,g)}}break;case 5:Lo(h,h.return);break;case 22:if(h.memoizedState!==null){qg(p);continue}}f!==null?(f.return=h,We=f):qg(p)}u=u.sibling}e:for(u=null,p=t;;){if(p.tag===5){if(u===null){u=p;try{s=p.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=p.stateNode,c=p.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=kv("display",a))}catch(g){qt(t,t.return,g)}}}else if(p.tag===6){if(u===null)try{p.stateNode.nodeValue=d?"":p.memoizedProps}catch(g){qt(t,t.return,g)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===t)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===t)break e;for(;p.sibling===null;){if(p.return===null||p.return===t)break e;u===p&&(u=null),p=p.return}u===p&&(u=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:Dr(e,t),rs(t),r&4&&Vg(t);break;case 21:break;default:Dr(e,t),rs(t)}}function rs(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(Kb(n)){var r=n;break e}n=n.return}throw Error(Oe(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(rl(s,""),r.flags&=-33);var i=Gg(t);tp(t,i,s);break;case 3:case 4:var a=r.stateNode.containerInfo,l=Gg(t);ep(t,l,a);break;default:throw Error(Oe(161))}}catch(c){qt(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Lk(t,e,n){We=t,Qb(t)}function Qb(t,e,n){for(var r=(t.mode&1)!==0;We!==null;){var s=We,i=s.child;if(s.tag===22&&r){var a=s.memoizedState!==null||oc;if(!a){var l=s.alternate,c=l!==null&&l.memoizedState!==null||Mn;l=oc;var d=Mn;if(oc=a,(Mn=c)&&!d)for(We=s;We!==null;)a=We,c=a.child,a.tag===22&&a.memoizedState!==null?Xg(s):c!==null?(c.return=a,We=c):Xg(s);for(;i!==null;)We=i,Qb(i),i=i.sibling;We=s,oc=l,Mn=d}Yg(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,We=i):Yg(t)}}function Yg(t){for(;We!==null;){var e=We;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Mn||zd(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Mn)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Br(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Rg(e,i,r);break;case 3:var a=e.updateQueue;if(a!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Rg(e,a,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var p=u.dehydrated;p!==null&&al(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Oe(163))}Mn||e.flags&512&&Qh(e)}catch(h){qt(e,e.return,h)}}if(e===t){We=null;break}if(n=e.sibling,n!==null){n.return=e.return,We=n;break}We=e.return}}function qg(t){for(;We!==null;){var e=We;if(e===t){We=null;break}var n=e.sibling;if(n!==null){n.return=e.return,We=n;break}We=e.return}}function Xg(t){for(;We!==null;){var e=We;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{zd(4,e)}catch(c){qt(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){qt(e,s,c)}}var i=e.return;try{Qh(e)}catch(c){qt(e,i,c)}break;case 5:var a=e.return;try{Qh(e)}catch(c){qt(e,a,c)}}}catch(c){qt(e,e.return,c)}if(e===t){We=null;break}var l=e.sibling;if(l!==null){l.return=e.return,We=l;break}We=e.return}}var Dk=Math.ceil,ad=Cs.ReactCurrentDispatcher,xf=Cs.ReactCurrentOwner,jr=Cs.ReactCurrentBatchConfig,St=0,pn=null,nn=null,xn=0,ar=0,Do=oi(0),ln=0,xl=null,Li=0,Fd=0,vf=0,Ka=null,Gn=null,bf=0,Qo=1/0,gs=null,ld=!1,np=null,Js=null,ac=!1,Gs=null,cd=0,Za=0,rp=null,Ic=-1,zc=0;function Hn(){return St&6?Zt():Ic!==-1?Ic:Ic=Zt()}function Qs(t){return t.mode&1?St&2&&xn!==0?xn&-xn:bk.transition!==null?(zc===0&&(zc=Dv()),zc):(t=Tt,t!==0||(t=window.event,t=t===void 0?16:Wv(t.type)),t):1}function Xr(t,e,n,r){if(50<Za)throw Za=0,rp=null,Error(Oe(185));El(t,n,r),(!(St&2)||t!==pn)&&(t===pn&&(!(St&2)&&(Fd|=n),ln===4&&Fs(t,xn)),Xn(t,r),n===1&&St===0&&!(e.mode&1)&&(Qo=Zt()+500,Ld&&ai()))}function Xn(t,e){var n=t.callbackNode;bS(t,e);var r=Vc(t,t===pn?xn:0);if(r===0)n!==null&&sg(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&sg(n),e===1)t.tag===0?vk(Kg.bind(null,t)):cb(Kg.bind(null,t)),mk(function(){!(St&6)&&ai()}),n=null;else{switch(Iv(r)){case 1:n=Gp;break;case 4:n=$v;break;case 16:n=Gc;break;case 536870912:n=Lv;break;default:n=Gc}n=aw(n,ew.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function ew(t,e){if(Ic=-1,zc=0,St&6)throw Error(Oe(327));var n=t.callbackNode;if(Wo()&&t.callbackNode!==n)return null;var r=Vc(t,t===pn?xn:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=dd(t,r);else{e=r;var s=St;St|=2;var i=nw();(pn!==t||xn!==e)&&(gs=null,Qo=Zt()+500,Pi(t,e));do try{Fk();break}catch(l){tw(t,l)}while(!0);sf(),ad.current=i,St=s,nn!==null?e=0:(pn=null,xn=0,e=ln)}if(e!==0){if(e===2&&(s=Ph(t),s!==0&&(r=s,e=sp(t,s))),e===1)throw n=xl,Pi(t,0),Fs(t,r),Xn(t,Zt()),n;if(e===6)Fs(t,r);else{if(s=t.current.alternate,!(r&30)&&!Ik(s)&&(e=dd(t,r),e===2&&(i=Ph(t),i!==0&&(r=i,e=sp(t,i))),e===1))throw n=xl,Pi(t,0),Fs(t,r),Xn(t,Zt()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(Oe(345));case 2:xi(t,Gn,gs);break;case 3:if(Fs(t,r),(r&130023424)===r&&(e=bf+500-Zt(),10<e)){if(Vc(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){Hn(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=Ih(xi.bind(null,t,Gn,gs),e);break}xi(t,Gn,gs);break;case 4:if(Fs(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var a=31-qr(r);i=1<<a,a=e[a],a>s&&(s=a),r&=~i}if(r=s,r=Zt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Dk(r/1960))-r,10<r){t.timeoutHandle=Ih(xi.bind(null,t,Gn,gs),r);break}xi(t,Gn,gs);break;case 5:xi(t,Gn,gs);break;default:throw Error(Oe(329))}}}return Xn(t,Zt()),t.callbackNode===n?ew.bind(null,t):null}function sp(t,e){var n=Ka;return t.current.memoizedState.isDehydrated&&(Pi(t,e).flags|=256),t=dd(t,e),t!==2&&(e=Gn,Gn=n,e!==null&&ip(e)),t}function ip(t){Gn===null?Gn=t:Gn.push.apply(Gn,t)}function Ik(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!Kr(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Fs(t,e){for(e&=~vf,e&=~Fd,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-qr(e),r=1<<n;t[n]=-1,e&=~r}}function Kg(t){if(St&6)throw Error(Oe(327));Wo();var e=Vc(t,0);if(!(e&1))return Xn(t,Zt()),null;var n=dd(t,e);if(t.tag!==0&&n===2){var r=Ph(t);r!==0&&(e=r,n=sp(t,r))}if(n===1)throw n=xl,Pi(t,0),Fs(t,e),Xn(t,Zt()),n;if(n===6)throw Error(Oe(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,xi(t,Gn,gs),Xn(t,Zt()),null}function wf(t,e){var n=St;St|=1;try{return t(e)}finally{St=n,St===0&&(Qo=Zt()+500,Ld&&ai())}}function Di(t){Gs!==null&&Gs.tag===0&&!(St&6)&&Wo();var e=St;St|=1;var n=jr.transition,r=Tt;try{if(jr.transition=null,Tt=1,t)return t()}finally{Tt=r,jr.transition=n,St=e,!(St&6)&&ai()}}function _f(){ar=Do.current,zt(Do)}function Pi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,fk(n)),nn!==null)for(n=nn.return;n!==null;){var r=n;switch(tf(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Zc();break;case 3:Zo(),zt(Yn),zt($n),uf();break;case 5:df(r);break;case 4:Zo();break;case 13:zt(Wt);break;case 19:zt(Wt);break;case 10:of(r.type._context);break;case 22:case 23:_f()}n=n.return}if(pn=t,nn=t=ei(t.current,null),xn=ar=e,ln=0,xl=null,vf=Fd=Li=0,Gn=Ka=null,Ei!==null){for(e=0;e<Ei.length;e++)if(n=Ei[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var a=i.next;i.next=s,r.next=a}n.pending=r}Ei=null}return t}function tw(t,e){do{var n=nn;try{if(sf(),$c.current=od,id){for(var r=Gt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}id=!1}if($i=0,hn=on=Gt=null,qa=!1,ml=0,xf.current=null,n===null||n.return===null){ln=1,xl=e,nn=null;break}e:{var i=t,a=n.return,l=n,c=e;if(e=xn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=l,p=u.tag;if(!(u.mode&1)&&(p===0||p===11||p===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=Dg(a);if(f!==null){f.flags&=-257,Ig(f,a,l,i,e),f.mode&1&&Lg(i,d,e),e=f,c=d;var m=e.updateQueue;if(m===null){var g=new Set;g.add(c),e.updateQueue=g}else m.add(c);break e}else{if(!(e&1)){Lg(i,d,e),Sf();break e}c=Error(Oe(426))}}else if(Bt&&l.mode&1){var v=Dg(a);if(v!==null){!(v.flags&65536)&&(v.flags|=256),Ig(v,a,l,i,e),nf(Jo(c,l));break e}}i=c=Jo(c,l),ln!==4&&(ln=2),Ka===null?Ka=[i]:Ka.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var x=Ib(i,c,e);Pg(i,x);break e;case 1:l=c;var y=i.type,b=i.stateNode;if(!(i.flags&128)&&(typeof y.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Js===null||!Js.has(b)))){i.flags|=65536,e&=-e,i.lanes|=e;var w=zb(i,l,e);Pg(i,w);break e}}i=i.return}while(i!==null)}sw(n)}catch(j){e=j,nn===n&&n!==null&&(nn=n=n.return);continue}break}while(!0)}function nw(){var t=ad.current;return ad.current=od,t===null?od:t}function Sf(){(ln===0||ln===3||ln===2)&&(ln=4),pn===null||!(Li&268435455)&&!(Fd&268435455)||Fs(pn,xn)}function dd(t,e){var n=St;St|=2;var r=nw();(pn!==t||xn!==e)&&(gs=null,Pi(t,e));do try{zk();break}catch(s){tw(t,s)}while(!0);if(sf(),St=n,ad.current=r,nn!==null)throw Error(Oe(261));return pn=null,xn=0,ln}function zk(){for(;nn!==null;)rw(nn)}function Fk(){for(;nn!==null&&!uS();)rw(nn)}function rw(t){var e=ow(t.alternate,t,ar);t.memoizedProps=t.pendingProps,e===null?sw(t):nn=e,xf.current=null}function sw(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Ak(n,e),n!==null){n.flags&=32767,nn=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ln=6,nn=null;return}}else if(n=Ok(n,e,ar),n!==null){nn=n;return}if(e=e.sibling,e!==null){nn=e;return}nn=e=t}while(e!==null);ln===0&&(ln=5)}function xi(t,e,n){var r=Tt,s=jr.transition;try{jr.transition=null,Tt=1,Bk(t,e,n,r)}finally{jr.transition=s,Tt=r}return null}function Bk(t,e,n,r){do Wo();while(Gs!==null);if(St&6)throw Error(Oe(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Oe(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(wS(t,i),t===pn&&(nn=pn=null,xn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||ac||(ac=!0,aw(Gc,function(){return Wo(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=jr.transition,jr.transition=null;var a=Tt;Tt=1;var l=St;St|=4,xf.current=null,$k(t,n),Jb(n,t),ak(Lh),Yc=!!$h,Lh=$h=null,t.current=n,Lk(n),hS(),St=l,Tt=a,jr.transition=i}else t.current=n;if(ac&&(ac=!1,Gs=t,cd=s),i=t.pendingLanes,i===0&&(Js=null),mS(n.stateNode),Xn(t,Zt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(ld)throw ld=!1,t=np,np=null,t;return cd&1&&t.tag!==0&&Wo(),i=t.pendingLanes,i&1?t===rp?Za++:(Za=0,rp=t):Za=0,ai(),null}function Wo(){if(Gs!==null){var t=Iv(cd),e=jr.transition,n=Tt;try{if(jr.transition=null,Tt=16>t?16:t,Gs===null)var r=!1;else{if(t=Gs,Gs=null,cd=0,St&6)throw Error(Oe(331));var s=St;for(St|=4,We=t.current;We!==null;){var i=We,a=i.child;if(We.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(We=d;We!==null;){var u=We;switch(u.tag){case 0:case 11:case 15:Xa(8,u,i)}var p=u.child;if(p!==null)p.return=u,We=p;else for(;We!==null;){u=We;var h=u.sibling,f=u.return;if(Xb(u),u===d){We=null;break}if(h!==null){h.return=f,We=h;break}We=f}}}var m=i.alternate;if(m!==null){var g=m.child;if(g!==null){m.child=null;do{var v=g.sibling;g.sibling=null,g=v}while(g!==null)}}We=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,We=a;else e:for(;We!==null;){if(i=We,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Xa(9,i,i.return)}var x=i.sibling;if(x!==null){x.return=i.return,We=x;break e}We=i.return}}var y=t.current;for(We=y;We!==null;){a=We;var b=a.child;if(a.subtreeFlags&2064&&b!==null)b.return=a,We=b;else e:for(a=y;We!==null;){if(l=We,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:zd(9,l)}}catch(j){qt(l,l.return,j)}if(l===a){We=null;break e}var w=l.sibling;if(w!==null){w.return=l.return,We=w;break e}We=l.return}}if(St=s,ai(),ls&&typeof ls.onPostCommitFiberRoot=="function")try{ls.onPostCommitFiberRoot(Rd,t)}catch{}r=!0}return r}finally{Tt=n,jr.transition=e}}return!1}function Zg(t,e,n){e=Jo(n,e),e=Ib(t,e,1),t=Zs(t,e,1),e=Hn(),t!==null&&(El(t,1,e),Xn(t,e))}function qt(t,e,n){if(t.tag===3)Zg(t,t,n);else for(;e!==null;){if(e.tag===3){Zg(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Js===null||!Js.has(r))){t=Jo(n,t),t=zb(e,t,1),e=Zs(e,t,1),t=Hn(),e!==null&&(El(e,1,t),Xn(e,t));break}}e=e.return}}function Hk(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Hn(),t.pingedLanes|=t.suspendedLanes&n,pn===t&&(xn&n)===n&&(ln===4||ln===3&&(xn&130023424)===xn&&500>Zt()-bf?Pi(t,0):vf|=n),Xn(t,e)}function iw(t,e){e===0&&(t.mode&1?(e=Zl,Zl<<=1,!(Zl&130023424)&&(Zl=4194304)):e=1);var n=Hn();t=ks(t,e),t!==null&&(El(t,e,n),Xn(t,n))}function Uk(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),iw(t,n)}function Wk(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(Oe(314))}r!==null&&r.delete(e),iw(t,n)}var ow;ow=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Yn.current)Vn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Vn=!1,Rk(t,e,n);Vn=!!(t.flags&131072)}else Vn=!1,Bt&&e.flags&1048576&&db(e,ed,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Dc(t,e),t=e.pendingProps;var s=qo(e,$n.current);Uo(e,n),s=pf(null,e,r,t,s,n);var i=ff();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,qn(r)?(i=!0,Jc(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,lf(e),s.updater=Id,e.stateNode=s,s._reactInternals=e,Gh(e,r,t,n),e=qh(null,e,r,!0,i,n)):(e.tag=0,Bt&&i&&ef(e),Fn(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Dc(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=Vk(r),t=Br(r,t),s){case 0:e=Yh(null,e,r,t,n);break e;case 1:e=Bg(null,e,r,t,n);break e;case 11:e=zg(null,e,r,t,n);break e;case 14:e=Fg(null,e,r,Br(r.type,t),n);break e}throw Error(Oe(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Br(r,s),Yh(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Br(r,s),Bg(t,e,r,s,n);case 3:e:{if(Ub(e),t===null)throw Error(Oe(387));r=e.pendingProps,i=e.memoizedState,s=i.element,gb(t,e),rd(e,r,null,n);var a=e.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Jo(Error(Oe(423)),e),e=Hg(t,e,r,n,s);break e}else if(r!==s){s=Jo(Error(Oe(424)),e),e=Hg(t,e,r,n,s);break e}else for(dr=Ks(e.stateNode.containerInfo.firstChild),pr=e,Bt=!0,Gr=null,n=fb(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Xo(),r===s){e=js(t,e,n);break e}Fn(t,e,r,n)}e=e.child}return e;case 5:return yb(e),t===null&&Hh(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,a=s.children,Dh(r,s)?a=null:i!==null&&Dh(r,i)&&(e.flags|=32),Hb(t,e),Fn(t,e,a,n),e.child;case 6:return t===null&&Hh(e),null;case 13:return Wb(t,e,n);case 4:return cf(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Ko(e,null,r,n):Fn(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Br(r,s),zg(t,e,r,s,n);case 7:return Fn(t,e,e.pendingProps,n),e.child;case 8:return Fn(t,e,e.pendingProps.children,n),e.child;case 12:return Fn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,a=s.value,At(td,r._currentValue),r._currentValue=a,i!==null)if(Kr(i.value,a)){if(i.children===s.children&&!Yn.current){e=js(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){a=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=ws(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),Uh(i.return,n,e),l.lanes|=n;break}c=c.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(Oe(341));a.lanes|=n,l=a.alternate,l!==null&&(l.lanes|=n),Uh(a,n,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}Fn(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Uo(e,n),s=Cr(s),r=r(s),e.flags|=1,Fn(t,e,r,n),e.child;case 14:return r=e.type,s=Br(r,e.pendingProps),s=Br(r.type,s),Fg(t,e,r,s,n);case 15:return Fb(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Br(r,s),Dc(t,e),e.tag=1,qn(r)?(t=!0,Jc(e)):t=!1,Uo(e,n),Db(e,r,s),Gh(e,r,s,n),qh(null,e,r,!0,t,n);case 19:return Gb(t,e,n);case 22:return Bb(t,e,n)}throw Error(Oe(156,e.tag))};function aw(t,e){return Mv(t,e)}function Gk(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function kr(t,e,n,r){return new Gk(t,e,n,r)}function kf(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Vk(t){if(typeof t=="function")return kf(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Hp)return 11;if(t===Up)return 14}return 2}function ei(t,e){var n=t.alternate;return n===null?(n=kr(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Fc(t,e,n,r,s,i){var a=2;if(r=t,typeof t=="function")kf(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case Eo:return Ri(n.children,s,i,e);case Bp:a=8,s|=8;break;case mh:return t=kr(12,n,e,s|2),t.elementType=mh,t.lanes=i,t;case gh:return t=kr(13,n,e,s),t.elementType=gh,t.lanes=i,t;case yh:return t=kr(19,n,e,s),t.elementType=yh,t.lanes=i,t;case yv:return Bd(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case mv:a=10;break e;case gv:a=9;break e;case Hp:a=11;break e;case Up:a=14;break e;case Ls:a=16,r=null;break e}throw Error(Oe(130,t==null?t:typeof t,""))}return e=kr(a,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function Ri(t,e,n,r){return t=kr(7,t,r,e),t.lanes=n,t}function Bd(t,e,n,r){return t=kr(22,t,r,e),t.elementType=yv,t.lanes=n,t.stateNode={isHidden:!1},t}function Lu(t,e,n){return t=kr(6,t,null,e),t.lanes=n,t}function Du(t,e,n){return e=kr(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Yk(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=yu(0),this.expirationTimes=yu(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=yu(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function jf(t,e,n,r,s,i,a,l,c){return t=new Yk(t,e,n,l,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=kr(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},lf(i),t}function qk(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Co,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function lw(t){if(!t)return ni;t=t._reactInternals;e:{if(Fi(t)!==t||t.tag!==1)throw Error(Oe(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(qn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Oe(171))}if(t.tag===1){var n=t.type;if(qn(n))return lb(t,n,e)}return e}function cw(t,e,n,r,s,i,a,l,c){return t=jf(n,r,!0,t,s,i,a,l,c),t.context=lw(null),n=t.current,r=Hn(),s=Qs(n),i=ws(r,s),i.callback=e??null,Zs(n,i,s),t.current.lanes=s,El(t,s,r),Xn(t,r),t}function Hd(t,e,n,r){var s=e.current,i=Hn(),a=Qs(s);return n=lw(n),e.context===null?e.context=n:e.pendingContext=n,e=ws(i,a),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Zs(s,e,a),t!==null&&(Xr(t,s,a,i),Mc(t,s,a)),a}function ud(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Jg(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Cf(t,e){Jg(t,e),(t=t.alternate)&&Jg(t,e)}function Xk(){return null}var dw=typeof reportError=="function"?reportError:function(t){console.error(t)};function Ef(t){this._internalRoot=t}Ud.prototype.render=Ef.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Oe(409));Hd(t,e,null,null)};Ud.prototype.unmount=Ef.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Di(function(){Hd(null,t,null,null)}),e[Ss]=null}};function Ud(t){this._internalRoot=t}Ud.prototype.unstable_scheduleHydration=function(t){if(t){var e=Bv();t={blockedOn:null,target:t,priority:e};for(var n=0;n<zs.length&&e!==0&&e<zs[n].priority;n++);zs.splice(n,0,t),n===0&&Uv(t)}};function Tf(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Wd(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Qg(){}function Kk(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=ud(a);i.call(d)}}var a=cw(e,r,t,0,null,!1,!1,"",Qg);return t._reactRootContainer=a,t[Ss]=a.current,dl(t.nodeType===8?t.parentNode:t),Di(),a}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=ud(c);l.call(d)}}var c=jf(t,0,!1,null,null,!1,!1,"",Qg);return t._reactRootContainer=c,t[Ss]=c.current,dl(t.nodeType===8?t.parentNode:t),Di(function(){Hd(e,c,n,r)}),c}function Gd(t,e,n,r,s){var i=n._reactRootContainer;if(i){var a=i;if(typeof s=="function"){var l=s;s=function(){var c=ud(a);l.call(c)}}Hd(e,a,t,s)}else a=Kk(n,e,t,s,r);return ud(a)}zv=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Da(e.pendingLanes);n!==0&&(Vp(e,n|1),Xn(e,Zt()),!(St&6)&&(Qo=Zt()+500,ai()))}break;case 13:Di(function(){var r=ks(t,1);if(r!==null){var s=Hn();Xr(r,t,1,s)}}),Cf(t,1)}};Yp=function(t){if(t.tag===13){var e=ks(t,134217728);if(e!==null){var n=Hn();Xr(e,t,134217728,n)}Cf(t,134217728)}};Fv=function(t){if(t.tag===13){var e=Qs(t),n=ks(t,e);if(n!==null){var r=Hn();Xr(n,t,e,r)}Cf(t,e)}};Bv=function(){return Tt};Hv=function(t,e){var n=Tt;try{return Tt=t,e()}finally{Tt=n}};Eh=function(t,e,n){switch(e){case"input":if(bh(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=$d(r);if(!s)throw Error(Oe(90));vv(r),bh(r,s)}}}break;case"textarea":wv(t,n);break;case"select":e=n.value,e!=null&&zo(t,!!n.multiple,e,!1)}};Tv=wf;Nv=Di;var Zk={usingClientEntryPoint:!1,Events:[Nl,Ro,$d,Cv,Ev,wf]},Ea={findFiberByHostInstance:Ci,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Jk={bundleType:Ea.bundleType,version:Ea.version,rendererPackageName:Ea.rendererPackageName,rendererConfig:Ea.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Cs.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Ov(t),t===null?null:t.stateNode},findFiberByHostInstance:Ea.findFiberByHostInstance||Xk,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var lc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lc.isDisabled&&lc.supportsFiber)try{Rd=lc.inject(Jk),ls=lc}catch{}}gr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Zk;gr.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Tf(e))throw Error(Oe(200));return qk(t,e,null,n)};gr.createRoot=function(t,e){if(!Tf(t))throw Error(Oe(299));var n=!1,r="",s=dw;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=jf(t,1,!1,null,null,n,!1,r,s),t[Ss]=e.current,dl(t.nodeType===8?t.parentNode:t),new Ef(e)};gr.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Oe(188)):(t=Object.keys(t).join(","),Error(Oe(268,t)));return t=Ov(e),t=t===null?null:t.stateNode,t};gr.flushSync=function(t){return Di(t)};gr.hydrate=function(t,e,n){if(!Wd(e))throw Error(Oe(200));return Gd(null,t,e,!0,n)};gr.hydrateRoot=function(t,e,n){if(!Tf(t))throw Error(Oe(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",a=dw;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),e=cw(e,null,t,1,n??null,s,!1,i,a),t[Ss]=e.current,dl(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Ud(e)};gr.render=function(t,e,n){if(!Wd(e))throw Error(Oe(200));return Gd(null,t,e,!1,n)};gr.unmountComponentAtNode=function(t){if(!Wd(t))throw Error(Oe(40));return t._reactRootContainer?(Di(function(){Gd(null,null,t,!1,function(){t._reactRootContainer=null,t[Ss]=null})}),!0):!1};gr.unstable_batchedUpdates=wf;gr.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Wd(n))throw Error(Oe(200));if(t==null||t._reactInternals===void 0)throw Error(Oe(38));return Gd(t,e,n,!1,r)};gr.version="18.3.1-next-f1338f8080-20240426";function uw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(uw)}catch(t){console.error(t)}}uw(),uv.exports=gr;var Qk=uv.exports,e0=Qk;ph.createRoot=e0.createRoot,ph.hydrateRoot=e0.hydrateRoot;var op=function(t,e){return op=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(n[s]=r[s])},op(t,e)};function hw(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");op(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var hd=function(){return hd=Object.assign||function(e){for(var n,r=1,s=arguments.length;r<s;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},hd.apply(this,arguments)};function ia(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function pw(t,e,n,r){var s=arguments.length,i=s<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,n,r);else for(var l=t.length-1;l>=0;l--)(a=t[l])&&(i=(s<3?a(i):s>3?a(e,n,i):a(e,n))||i);return s>3&&i&&Object.defineProperty(e,n,i),i}function fw(t,e){return function(n,r){e(n,r,t)}}function mw(t,e,n,r,s,i){function a(x){if(x!==void 0&&typeof x!="function")throw new TypeError("Function expected");return x}for(var l=r.kind,c=l==="getter"?"get":l==="setter"?"set":"value",d=!e&&t?r.static?t:t.prototype:null,u=e||(d?Object.getOwnPropertyDescriptor(d,r.name):{}),p,h=!1,f=n.length-1;f>=0;f--){var m={};for(var g in r)m[g]=g==="access"?{}:r[g];for(var g in r.access)m.access[g]=r.access[g];m.addInitializer=function(x){if(h)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(x||null))};var v=(0,n[f])(l==="accessor"?{get:u.get,set:u.set}:u[c],m);if(l==="accessor"){if(v===void 0)continue;if(v===null||typeof v!="object")throw new TypeError("Object expected");(p=a(v.get))&&(u.get=p),(p=a(v.set))&&(u.set=p),(p=a(v.init))&&s.unshift(p)}else(p=a(v))&&(l==="field"?s.unshift(p):u[c]=p)}d&&Object.defineProperty(d,r.name,u),h=!0}function gw(t,e,n){for(var r=arguments.length>2,s=0;s<e.length;s++)n=r?e[s].call(t,n):e[s].call(t);return r?n:void 0}function yw(t){return typeof t=="symbol"?t:"".concat(t)}function xw(t,e,n){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:n?"".concat(n," ",e):e})}function vw(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Je(t,e,n,r){function s(i){return i instanceof n?i:new n(function(a){a(i)})}return new(n||(n=Promise))(function(i,a){function l(u){try{d(r.next(u))}catch(p){a(p)}}function c(u){try{d(r.throw(u))}catch(p){a(p)}}function d(u){u.done?i(u.value):s(u.value).then(l,c)}d((r=r.apply(t,e||[])).next())})}function bw(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=l(0),a.throw=l(1),a.return=l(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(d){return function(u){return c([d,u])}}function c(d){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,d[0]&&(n=0)),n;)try{if(r=1,s&&(i=d[0]&2?s.return:d[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,d[1])).done)return i;switch(s=0,i&&(d=[d[0]&2,i.value]),d[0]){case 0:case 1:i=d;break;case 4:return n.label++,{value:d[1],done:!1};case 5:n.label++,s=d[1],d=[0];continue;case 7:d=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(d[0]===6||d[0]===2)){n=0;continue}if(d[0]===3&&(!i||d[1]>i[0]&&d[1]<i[3])){n.label=d[1];break}if(d[0]===6&&n.label<i[1]){n.label=i[1],i=d;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(d);break}i[2]&&n.ops.pop(),n.trys.pop();continue}d=e.call(t,n)}catch(u){d=[6,u],s=0}finally{r=i=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}var Vd=Object.create?function(t,e,n,r){r===void 0&&(r=n);var s=Object.getOwnPropertyDescriptor(e,n);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,s)}:function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]};function ww(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&Vd(e,t,n)}function pd(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Nf(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),s,i=[],a;try{for(;(e===void 0||e-- >0)&&!(s=r.next()).done;)i.push(s.value)}catch(l){a={error:l}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return i}function _w(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Nf(arguments[e]));return t}function Sw(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),s=0,e=0;e<n;e++)for(var i=arguments[e],a=0,l=i.length;a<l;a++,s++)r[s]=i[a];return r}function kw(t,e,n){if(n||arguments.length===2)for(var r=0,s=e.length,i;r<s;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))}function ea(t){return this instanceof ea?(this.v=t,this):new ea(t)}function jw(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),s,i=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",a),s[Symbol.asyncIterator]=function(){return this},s;function a(f){return function(m){return Promise.resolve(m).then(f,p)}}function l(f,m){r[f]&&(s[f]=function(g){return new Promise(function(v,x){i.push([f,g,v,x])>1||c(f,g)})},m&&(s[f]=m(s[f])))}function c(f,m){try{d(r[f](m))}catch(g){h(i[0][3],g)}}function d(f){f.value instanceof ea?Promise.resolve(f.value.v).then(u,p):h(i[0][2],f)}function u(f){c("next",f)}function p(f){c("throw",f)}function h(f,m){f(m),i.shift(),i.length&&c(i[0][0],i[0][1])}}function Cw(t){var e,n;return e={},r("next"),r("throw",function(s){throw s}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(s,i){e[s]=t[s]?function(a){return(n=!n)?{value:ea(t[s](a)),done:!1}:i?i(a):a}:i}}function Ew(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof pd=="function"?pd(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(i){n[i]=t[i]&&function(a){return new Promise(function(l,c){a=t[i](a),s(l,c,a.done,a.value)})}}function s(i,a,l,c){Promise.resolve(c).then(function(d){i({value:d,done:l})},a)}}function Tw(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var ej=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e},ap=function(t){return ap=Object.getOwnPropertyNames||function(e){var n=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[n.length]=r);return n},ap(t)};function Nw(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n=ap(t),r=0;r<n.length;r++)n[r]!=="default"&&Vd(e,t,n[r]);return ej(e,t),e}function Pw(t){return t&&t.__esModule?t:{default:t}}function Rw(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)}function Ow(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n}function Aw(t,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof t=="function"?e===t:t.has(e)}function Mw(t,e,n){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],n&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),t.stack.push({value:e,dispose:r,async:n})}else n&&t.stack.push({async:!0});return e}var tj=typeof SuppressedError=="function"?SuppressedError:function(t,e,n){var r=new Error(n);return r.name="SuppressedError",r.error=t,r.suppressed=e,r};function $w(t){function e(i){t.error=t.hasError?new tj(i,t.error,"An error was suppressed during disposal."):i,t.hasError=!0}var n,r=0;function s(){for(;n=t.stack.pop();)try{if(!n.async&&r===1)return r=0,t.stack.push(n),Promise.resolve().then(s);if(n.dispose){var i=n.dispose.call(n.value);if(n.async)return r|=2,Promise.resolve(i).then(s,function(a){return e(a),s()})}else r|=1}catch(a){e(a)}if(r===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return s()}function Lw(t,e){return typeof t=="string"&&/^\.\.?\//.test(t)?t.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(n,r,s,i,a){return r?e?".jsx":".js":s&&(!i||!a)?n:s+i+"."+a.toLowerCase()+"js"}):t}const nj={__extends:hw,__assign:hd,__rest:ia,__decorate:pw,__param:fw,__esDecorate:mw,__runInitializers:gw,__propKey:yw,__setFunctionName:xw,__metadata:vw,__awaiter:Je,__generator:bw,__createBinding:Vd,__exportStar:ww,__values:pd,__read:Nf,__spread:_w,__spreadArrays:Sw,__spreadArray:kw,__await:ea,__asyncGenerator:jw,__asyncDelegator:Cw,__asyncValues:Ew,__makeTemplateObject:Tw,__importStar:Nw,__importDefault:Pw,__classPrivateFieldGet:Rw,__classPrivateFieldSet:Ow,__classPrivateFieldIn:Aw,__addDisposableResource:Mw,__disposeResources:$w,__rewriteRelativeImportExtension:Lw},rj=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:Mw,get __assign(){return hd},__asyncDelegator:Cw,__asyncGenerator:jw,__asyncValues:Ew,__await:ea,__awaiter:Je,__classPrivateFieldGet:Rw,__classPrivateFieldIn:Aw,__classPrivateFieldSet:Ow,__createBinding:Vd,__decorate:pw,__disposeResources:$w,__esDecorate:mw,__exportStar:ww,__extends:hw,__generator:bw,__importDefault:Pw,__importStar:Nw,__makeTemplateObject:Tw,__metadata:vw,__param:fw,__propKey:yw,__read:Nf,__rest:ia,__rewriteRelativeImportExtension:Lw,__runInitializers:gw,__setFunctionName:xw,__spread:_w,__spreadArray:kw,__spreadArrays:Sw,__values:pd,default:nj},Symbol.toStringTag,{value:"Module"})),sj=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class Pf extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}}class t0 extends Pf{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class n0 extends Pf{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class r0 extends Pf{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var lp;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(lp||(lp={}));class ij{constructor(e,{headers:n={},customFetch:r,region:s=lp.Any}={}){this.url=e,this.headers=n,this.region=s,this.fetch=sj(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return Je(this,arguments,void 0,function*(n,r={}){var s;try{const{headers:i,method:a,body:l,signal:c}=r;let d={},{region:u}=r;u||(u=this.region);const p=new URL(`${this.url}/${n}`);u&&u!=="any"&&(d["x-region"]=u,p.searchParams.set("forceFunctionRegion",u));let h;l&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)?typeof Blob<"u"&&l instanceof Blob||l instanceof ArrayBuffer?(d["Content-Type"]="application/octet-stream",h=l):typeof l=="string"?(d["Content-Type"]="text/plain",h=l):typeof FormData<"u"&&l instanceof FormData?h=l:(d["Content-Type"]="application/json",h=JSON.stringify(l)):h=l;const f=yield this.fetch(p.toString(),{method:a||"POST",headers:Object.assign(Object.assign(Object.assign({},d),this.headers),i),body:h,signal:c}).catch(x=>{throw x.name==="AbortError"?x:new t0(x)}),m=f.headers.get("x-relay-error");if(m&&m==="true")throw new n0(f);if(!f.ok)throw new r0(f);let g=((s=f.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),v;return g==="application/json"?v=yield f.json():g==="application/octet-stream"||g==="application/pdf"?v=yield f.blob():g==="text/event-stream"?v=f:g==="multipart/form-data"?v=yield f.formData():v=yield f.text(),{data:v,error:null,response:f}}catch(i){return i instanceof Error&&i.name==="AbortError"?{data:null,error:new t0(i)}:{data:null,error:i,response:i instanceof r0||i instanceof n0?i.context:void 0}}})}}var Bn={};const oa=E2(rj);var cc={},dc={},uc={},hc={},pc={},fc={},s0;function Dw(){if(s0)return fc;s0=1,Object.defineProperty(fc,"__esModule",{value:!0});class t extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}}return fc.default=t,fc}var i0;function Iw(){if(i0)return pc;i0=1,Object.defineProperty(pc,"__esModule",{value:!0});const e=oa.__importDefault(Dw());class n{constructor(s){var i,a;this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=new Headers(s.headers),this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=(i=s.shouldThrowOnError)!==null&&i!==void 0?i:!1,this.signal=s.signal,this.isMaybeSingle=(a=s.isMaybeSingle)!==null&&a!==void 0?a:!1,s.fetch?this.fetch=s.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,i){return this.headers=new Headers(this.headers),this.headers.set(s,i),this}then(s,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const a=this.fetch;let l=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var d,u,p,h;let f=null,m=null,g=null,v=c.status,x=c.statusText;if(c.ok){if(this.method!=="HEAD"){const j=await c.text();j===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((d=this.headers.get("Accept"))===null||d===void 0)&&d.includes("application/vnd.pgrst.plan+text"))?m=j:m=JSON.parse(j))}const b=(u=this.headers.get("Prefer"))===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),w=(p=c.headers.get("content-range"))===null||p===void 0?void 0:p.split("/");b&&w&&w.length>1&&(g=parseInt(w[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(m)&&(m.length>1?(f={code:"PGRST116",details:`Results contain ${m.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},m=null,g=null,v=406,x="Not Acceptable"):m.length===1?m=m[0]:m=null)}else{const b=await c.text();try{f=JSON.parse(b),Array.isArray(f)&&c.status===404&&(m=[],f=null,v=200,x="OK")}catch{c.status===404&&b===""?(v=204,x="No Content"):f={message:b}}if(f&&this.isMaybeSingle&&(!((h=f==null?void 0:f.details)===null||h===void 0)&&h.includes("0 rows"))&&(f=null,v=200,x="OK"),f&&this.shouldThrowOnError)throw new e.default(f)}return{error:f,data:m,count:g,status:v,statusText:x}});return this.shouldThrowOnError||(l=l.catch(c=>{var d,u,p;return{error:{message:`${(d=c==null?void 0:c.name)!==null&&d!==void 0?d:"FetchError"}: ${c==null?void 0:c.message}`,details:`${(u=c==null?void 0:c.stack)!==null&&u!==void 0?u:""}`,hint:"",code:`${(p=c==null?void 0:c.code)!==null&&p!==void 0?p:""}`},data:null,count:null,status:0,statusText:""}})),l.then(s,i)}returns(){return this}overrideTypes(){return this}}return pc.default=n,pc}var o0;function zw(){if(o0)return hc;o0=1,Object.defineProperty(hc,"__esModule",{value:!0});const e=oa.__importDefault(Iw());class n extends e.default{select(s){let i=!1;const a=(s??"*").split("").map(l=>/\s/.test(l)&&!i?"":(l==='"'&&(i=!i),l)).join("");return this.url.searchParams.set("select",a),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:i=!0,nullsFirst:a,foreignTable:l,referencedTable:c=l}={}){const d=c?`${c}.order`:"order",u=this.url.searchParams.get(d);return this.url.searchParams.set(d,`${u?`${u},`:""}${s}.${i?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:i,referencedTable:a=i}={}){const l=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${s}`),this}range(s,i,{foreignTable:a,referencedTable:l=a}={}){const c=typeof l>"u"?"offset":`${l}.offset`,d=typeof l>"u"?"limit":`${l}.limit`;return this.url.searchParams.set(c,`${s}`),this.url.searchParams.set(d,`${i-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:i=!1,settings:a=!1,buffers:l=!1,wal:c=!1,format:d="text"}={}){var u;const p=[s?"analyze":null,i?"verbose":null,a?"settings":null,l?"buffers":null,c?"wal":null].filter(Boolean).join("|"),h=(u=this.headers.get("Accept"))!==null&&u!==void 0?u:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${d}; for="${h}"; options=${p};`),d==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}}return hc.default=n,hc}var a0;function Rf(){if(a0)return uc;a0=1,Object.defineProperty(uc,"__esModule",{value:!0});const e=oa.__importDefault(zw()),n=new RegExp("[,()]");class r extends e.default{eq(i,a){return this.url.searchParams.append(i,`eq.${a}`),this}neq(i,a){return this.url.searchParams.append(i,`neq.${a}`),this}gt(i,a){return this.url.searchParams.append(i,`gt.${a}`),this}gte(i,a){return this.url.searchParams.append(i,`gte.${a}`),this}lt(i,a){return this.url.searchParams.append(i,`lt.${a}`),this}lte(i,a){return this.url.searchParams.append(i,`lte.${a}`),this}like(i,a){return this.url.searchParams.append(i,`like.${a}`),this}likeAllOf(i,a){return this.url.searchParams.append(i,`like(all).{${a.join(",")}}`),this}likeAnyOf(i,a){return this.url.searchParams.append(i,`like(any).{${a.join(",")}}`),this}ilike(i,a){return this.url.searchParams.append(i,`ilike.${a}`),this}ilikeAllOf(i,a){return this.url.searchParams.append(i,`ilike(all).{${a.join(",")}}`),this}ilikeAnyOf(i,a){return this.url.searchParams.append(i,`ilike(any).{${a.join(",")}}`),this}is(i,a){return this.url.searchParams.append(i,`is.${a}`),this}in(i,a){const l=Array.from(new Set(a)).map(c=>typeof c=="string"&&n.test(c)?`"${c}"`:`${c}`).join(",");return this.url.searchParams.append(i,`in.(${l})`),this}contains(i,a){return typeof a=="string"?this.url.searchParams.append(i,`cs.${a}`):Array.isArray(a)?this.url.searchParams.append(i,`cs.{${a.join(",")}}`):this.url.searchParams.append(i,`cs.${JSON.stringify(a)}`),this}containedBy(i,a){return typeof a=="string"?this.url.searchParams.append(i,`cd.${a}`):Array.isArray(a)?this.url.searchParams.append(i,`cd.{${a.join(",")}}`):this.url.searchParams.append(i,`cd.${JSON.stringify(a)}`),this}rangeGt(i,a){return this.url.searchParams.append(i,`sr.${a}`),this}rangeGte(i,a){return this.url.searchParams.append(i,`nxl.${a}`),this}rangeLt(i,a){return this.url.searchParams.append(i,`sl.${a}`),this}rangeLte(i,a){return this.url.searchParams.append(i,`nxr.${a}`),this}rangeAdjacent(i,a){return this.url.searchParams.append(i,`adj.${a}`),this}overlaps(i,a){return typeof a=="string"?this.url.searchParams.append(i,`ov.${a}`):this.url.searchParams.append(i,`ov.{${a.join(",")}}`),this}textSearch(i,a,{config:l,type:c}={}){let d="";c==="plain"?d="pl":c==="phrase"?d="ph":c==="websearch"&&(d="w");const u=l===void 0?"":`(${l})`;return this.url.searchParams.append(i,`${d}fts${u}.${a}`),this}match(i){return Object.entries(i).forEach(([a,l])=>{this.url.searchParams.append(a,`eq.${l}`)}),this}not(i,a,l){return this.url.searchParams.append(i,`not.${a}.${l}`),this}or(i,{foreignTable:a,referencedTable:l=a}={}){const c=l?`${l}.or`:"or";return this.url.searchParams.append(c,`(${i})`),this}filter(i,a,l){return this.url.searchParams.append(i,`${a}.${l}`),this}}return uc.default=r,uc}var l0;function Fw(){if(l0)return dc;l0=1,Object.defineProperty(dc,"__esModule",{value:!0});const e=oa.__importDefault(Rf());class n{constructor(s,{headers:i={},schema:a,fetch:l}){this.url=s,this.headers=new Headers(i),this.schema=a,this.fetch=l}select(s,i){const{head:a=!1,count:l}=i??{},c=a?"HEAD":"GET";let d=!1;const u=(s??"*").split("").map(p=>/\s/.test(p)&&!d?"":(p==='"'&&(d=!d),p)).join("");return this.url.searchParams.set("select",u),l&&this.headers.append("Prefer",`count=${l}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(s,{count:i,defaultToNull:a=!0}={}){var l;const c="POST";if(i&&this.headers.append("Prefer",`count=${i}`),a||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const d=s.reduce((u,p)=>u.concat(Object.keys(p)),[]);if(d.length>0){const u=[...new Set(d)].map(p=>`"${p}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}upsert(s,{onConflict:i,ignoreDuplicates:a=!1,count:l,defaultToNull:c=!0}={}){var d;const u="POST";if(this.headers.append("Prefer",`resolution=${a?"ignore":"merge"}-duplicates`),i!==void 0&&this.url.searchParams.set("on_conflict",i),l&&this.headers.append("Prefer",`count=${l}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const p=s.reduce((h,f)=>h.concat(Object.keys(f)),[]);if(p.length>0){const h=[...new Set(p)].map(f=>`"${f}"`);this.url.searchParams.set("columns",h.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}update(s,{count:i}={}){var a;const l="PATCH";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}delete({count:s}={}){var i;const a="DELETE";return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}}return dc.default=n,dc}var c0;function oj(){if(c0)return cc;c0=1,Object.defineProperty(cc,"__esModule",{value:!0});const t=oa,e=t.__importDefault(Fw()),n=t.__importDefault(Rf());class r{constructor(i,{headers:a={},schema:l,fetch:c}={}){this.url=i,this.headers=new Headers(a),this.schemaName=l,this.fetch=c}from(i){const a=new URL(`${this.url}/${i}`);return new e.default(a,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new r(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,a={},{head:l=!1,get:c=!1,count:d}={}){var u;let p;const h=new URL(`${this.url}/rpc/${i}`);let f;l||c?(p=l?"HEAD":"GET",Object.entries(a).filter(([g,v])=>v!==void 0).map(([g,v])=>[g,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([g,v])=>{h.searchParams.append(g,v)})):(p="POST",f=a);const m=new Headers(this.headers);return d&&m.set("Prefer",`count=${d}`),new n.default({method:p,url:h,headers:m,schema:this.schemaName,body:f,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}}return cc.default=r,cc}Object.defineProperty(Bn,"__esModule",{value:!0});var Bw=Bn.PostgrestError=Zw=Bn.PostgrestBuilder=Xw=Bn.PostgrestTransformBuilder=Yw=Bn.PostgrestFilterBuilder=Gw=Bn.PostgrestQueryBuilder=Uw=Bn.PostgrestClient=void 0;const aa=oa,Hw=aa.__importDefault(oj());var Uw=Bn.PostgrestClient=Hw.default;const Ww=aa.__importDefault(Fw());var Gw=Bn.PostgrestQueryBuilder=Ww.default;const Vw=aa.__importDefault(Rf());var Yw=Bn.PostgrestFilterBuilder=Vw.default;const qw=aa.__importDefault(zw());var Xw=Bn.PostgrestTransformBuilder=qw.default;const Kw=aa.__importDefault(Iw());var Zw=Bn.PostgrestBuilder=Kw.default;const Jw=aa.__importDefault(Dw());Bw=Bn.PostgrestError=Jw.default;var Qw=Bn.default={PostgrestClient:Hw.default,PostgrestQueryBuilder:Ww.default,PostgrestFilterBuilder:Vw.default,PostgrestTransformBuilder:qw.default,PostgrestBuilder:Kw.default,PostgrestError:Jw.default};const aj=C2({__proto__:null,get PostgrestBuilder(){return Zw},get PostgrestClient(){return Uw},get PostgrestError(){return Bw},get PostgrestFilterBuilder(){return Yw},get PostgrestQueryBuilder(){return Gw},get PostgrestTransformBuilder(){return Xw},default:Qw},[Bn]),{PostgrestClient:lj,PostgrestQueryBuilder:QW,PostgrestFilterBuilder:eG,PostgrestTransformBuilder:tG,PostgrestBuilder:nG,PostgrestError:rG}=Qw||aj;class cj{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const n=process.versions;if(n&&n.node){const r=n.node,s=parseInt(r.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const r=this.getWebSocketConstructor();return new r(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const dj="2.79.0",uj=`realtime-js/${dj}`,hj="1.0.0",cp=1e4,pj=1e3,fj=100;var Ja;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(Ja||(Ja={}));var sn;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(sn||(sn={}));var Wr;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Wr||(Wr={}));var dp;(function(t){t.websocket="websocket"})(dp||(dp={}));var _i;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(_i||(_i={}));class mj{constructor(){this.HEADER_LENGTH=1}decode(e,n){return e.constructor===ArrayBuffer?n(this._binaryDecode(e)):n(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const n=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,n,r)}_decodeBroadcast(e,n,r){const s=n.getUint8(1),i=n.getUint8(2);let a=this.HEADER_LENGTH+2;const l=r.decode(e.slice(a,a+s));a=a+s;const c=r.decode(e.slice(a,a+i));a=a+i;const d=JSON.parse(r.decode(e.slice(a,e.byteLength)));return{ref:null,topic:l,event:c,payload:d}}}class e1{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Rt;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Rt||(Rt={}));const d0=(t,e,n={})=>{var r;const s=(r=n.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((i,a)=>(i[a]=gj(a,t,e,s),i),{}):{}},gj=(t,e,n,r)=>{const s=e.find(l=>l.name===t),i=s==null?void 0:s.type,a=n[t];return i&&!r.includes(i)?t1(i,a):up(a)},t1=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return bj(e,n)}switch(t){case Rt.bool:return yj(e);case Rt.float4:case Rt.float8:case Rt.int2:case Rt.int4:case Rt.int8:case Rt.numeric:case Rt.oid:return xj(e);case Rt.json:case Rt.jsonb:return vj(e);case Rt.timestamp:return wj(e);case Rt.abstime:case Rt.date:case Rt.daterange:case Rt.int4range:case Rt.int8range:case Rt.money:case Rt.reltime:case Rt.text:case Rt.time:case Rt.timestamptz:case Rt.timetz:case Rt.tsrange:case Rt.tstzrange:return up(e);default:return up(e)}},up=t=>t,yj=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},xj=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},vj=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},bj=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let i;const a=t.slice(1,n);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(l=>t1(e,l))}return t},wj=t=>typeof t=="string"?t.replace(" ","T"):t,n1=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Iu{constructor(e,n,r={},s=cp){this.channel=e,this.event=n,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var u0;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(u0||(u0={}));class Qa{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:a,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Qa.syncState(this.state,s,i,a),this.pendingDiffs.forEach(c=>{this.state=Qa.syncDiff(this.state,c,i,a)}),this.pendingDiffs=[],l()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:a,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Qa.syncDiff(this.state,s,i,a),l())}),this.onJoin((s,i,a)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:a})}),this.onLeave((s,i,a)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,s){const i=this.cloneDeep(e),a=this.transformState(n),l={},c={};return this.map(i,(d,u)=>{a[d]||(c[d]=u)}),this.map(a,(d,u)=>{const p=i[d];if(p){const h=u.map(v=>v.presence_ref),f=p.map(v=>v.presence_ref),m=u.filter(v=>f.indexOf(v.presence_ref)<0),g=p.filter(v=>h.indexOf(v.presence_ref)<0);m.length>0&&(l[d]=m),g.length>0&&(c[d]=g)}else l[d]=u}),this.syncDiff(i,{joins:l,leaves:c},r,s)}static syncDiff(e,n,r,s){const{joins:i,leaves:a}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(l,c)=>{var d;const u=(d=e[l])!==null&&d!==void 0?d:[];if(e[l]=this.cloneDeep(c),u.length>0){const p=e[l].map(f=>f.presence_ref),h=u.filter(f=>p.indexOf(f.presence_ref)<0);e[l].unshift(...h)}r(l,u,c)}),this.map(a,(l,c)=>{let d=e[l];if(!d)return;const u=c.map(p=>p.presence_ref);d=d.filter(p=>u.indexOf(p.presence_ref)<0),e[l]=d,s(l,d,c),d.length===0&&delete e[l]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{const s=e[r];return"metas"in s?n[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):n[r]=s,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var h0;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(h0||(h0={}));var el;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(el||(el={}));var ys;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(ys||(ys={}));class Of{constructor(e,n={config:{}},r){var s,i;if(this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=sn.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new Iu(this,Wr.join,this.params,this.timeout),this.rejoinTimer=new e1(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=sn.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=sn.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=sn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=sn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=sn.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Wr.reply,{},(a,l)=>{this._trigger(this._replyEventName(l),a)}),this.presence=new Qa(this),this.broadcastEndpointURL=n1(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,n=this.timeout){var r,s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==sn.closed){const{config:{broadcast:a,presence:l,private:c}}=this.params,d=(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(f=>f.filter))!==null&&s!==void 0?s:[],u=!!this.bindings[el.PRESENCE]&&this.bindings[el.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,p={},h={broadcast:a,presence:Object.assign(Object.assign({},l),{enabled:u}),postgres_changes:d,private:c};this.socket.accessTokenValue&&(p.access_token=this.socket.accessTokenValue),this._onError(f=>e==null?void 0:e(ys.CHANNEL_ERROR,f)),this._onClose(()=>e==null?void 0:e(ys.CLOSED)),this.updateJoinPayload(Object.assign({config:h},p)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:f})=>{var m;if(this.socket.setAuth(),f===void 0){e==null||e(ys.SUBSCRIBED);return}else{const g=this.bindings.postgres_changes,v=(m=g==null?void 0:g.length)!==null&&m!==void 0?m:0,x=[];for(let y=0;y<v;y++){const b=g[y],{filter:{event:w,schema:j,table:_,filter:S}}=b,E=f&&f[y];if(E&&E.event===w&&E.schema===j&&E.table===_&&E.filter===S)x.push(Object.assign(Object.assign({},b),{id:E.id}));else{this.unsubscribe(),this.state=sn.errored,e==null||e(ys.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=x,e&&e(ys.SUBSCRIBED);return}}).receive("error",f=>{this.state=sn.errored,e==null||e(ys.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(ys.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this.state===sn.joined&&e===el.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,n,r)}async httpSend(e,n,r={}){var s;const i=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(n==null)return Promise.reject("Payload is required for httpSend()");const a={method:"POST",headers:{Authorization:i,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:n,private:this.private}]})},l=await this._fetchWithTimeout(this.broadcastEndpointURL,a,(s=r.timeout)!==null&&s!==void 0?s:this.timeout);if(l.status===202)return{success:!0};let c=l.statusText;try{const d=await l.json();c=d.error||d.message||c}catch{}return Promise.reject(new Error(c))}async send(e,n={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:a}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=d.body)===null||s===void 0?void 0:s.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,l,c;const d=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(l=(a=this.params)===null||a===void 0?void 0:a.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),d.receive("ok",()=>i("ok")),d.receive("error",()=>i("error")),d.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=sn.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Wr.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new Iu(this,Wr.leave,{},e),r.receive("ok",()=>{n(),s("ok")}).receive("timeout",()=>{n(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=sn.closed,this.bindings={}}async _fetchWithTimeout(e,n,r){const s=new AbortController,i=setTimeout(()=>s.abort(),r),a=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:s.signal}));return clearTimeout(i),a}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Iu(this,e,n,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>fj){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var s,i;const a=e.toLocaleLowerCase(),{close:l,error:c,leave:d,join:u}=Wr;if(r&&[l,c,d,u].indexOf(a)>=0&&r!==this._joinRef())return;let h=this._onMessage(a,n,r);if(n&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(f=>{var m,g,v;return((m=f.filter)===null||m===void 0?void 0:m.event)==="*"||((v=(g=f.filter)===null||g===void 0?void 0:g.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===a}).map(f=>f.callback(h,r)):(i=this.bindings[a])===null||i===void 0||i.filter(f=>{var m,g,v,x,y,b;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in f){const w=f.id,j=(m=f.filter)===null||m===void 0?void 0:m.event;return w&&((g=n.ids)===null||g===void 0?void 0:g.includes(w))&&(j==="*"||(j==null?void 0:j.toLocaleLowerCase())===((v=n.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const w=(y=(x=f==null?void 0:f.filter)===null||x===void 0?void 0:x.event)===null||y===void 0?void 0:y.toLocaleLowerCase();return w==="*"||w===((b=n==null?void 0:n.event)===null||b===void 0?void 0:b.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===a}).map(f=>{if(typeof h=="object"&&"ids"in h){const m=h.data,{schema:g,table:v,commit_timestamp:x,type:y,errors:b}=m;h=Object.assign(Object.assign({},{schema:g,table:v,commit_timestamp:x,eventType:y,new:{},old:{},errors:b}),this._getPayloadRecords(m))}f.callback(h,r)})}_isClosed(){return this.state===sn.closed}_isJoined(){return this.state===sn.joined}_isJoining(){return this.state===sn.joining}_isLeaving(){return this.state===sn.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){const s=e.toLocaleLowerCase(),i={type:s,filter:n,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,n){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Of.isEqual(s.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const r in e)if(e[r]!==n[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Wr.close,{},e)}_onError(e){this._on(Wr.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=sn.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=d0(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=d0(e.columns,e.old_record)),n}}const zu=()=>{},mc={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},_j=[1e3,2e3,5e3,1e4],Sj=1e4,kj=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class jj{constructor(e,n){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=cp,this.transport=null,this.heartbeatIntervalMs=mc.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=zu,this.ref=0,this.reconnectTimer=null,this.logger=zu,this.conn=null,this.sendBuffer=[],this.serializer=new mj,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>s?(...i)=>s(...i):(...i)=>fetch(...i),!(!((r=n==null?void 0:n.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${dp.websocket}`,this.httpEndpoint=n1(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=cj.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:hj}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,n??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Ja.connecting:return _i.Connecting;case Ja.open:return _i.Open;case Ja.closing:return _i.Closing;default:return _i.Closed}}isConnected(){return this.connectionState()===_i.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===r);if(s)return s;{const i=new Of(`realtime:${e}`,n,this);return this.channels.push(i),i}}push(e){const{topic:n,event:r,payload:s,ref:i}=e,a=()=>{this.encode(e,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${n} ${r} (${i})`,s),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(pj,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},mc.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply")try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error")}catch(d){this.log("error","error in heartbeat callback",d)}n.ref&&n.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:s,payload:i,ref:a}=n,l=a?`(${a})`:"",c=i.status||"";this.log("receive",`${c} ${r} ${s} ${l}`.trim(),i),this.channels.filter(d=>d._isMember(r)).forEach(d=>d._trigger(s,i,a)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this.workerRef.terminate()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Wr.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(n);return`${e}${r}${s}`}_workerObjectUrl(e){let n;if(e)n=e;else{const r=new Blob([kj],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n;e?n=e:this.accessToken?n=await this.accessToken():n=this.accessTokenValue,this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(r=>{const s={access_token:n,version:uj};n&&r.updateJoinPayload(s),r.joinedOnce&&r._isJoined()&&r._push(Wr.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(n=>{this.log("error",`error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(n)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new e1(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},mc.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,r,s,i,a,l,c,d,u;if(this.transport=(n=e==null?void 0:e.transport)!==null&&n!==void 0?n:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:cp,this.heartbeatIntervalMs=(s=e==null?void 0:e.heartbeatIntervalMs)!==null&&s!==void 0?s:mc.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(a=e==null?void 0:e.accessToken)!==null&&a!==void 0?a:null,this.heartbeatCallback=(l=e==null?void 0:e.heartbeatCallback)!==null&&l!==void 0?l:zu,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e==null?void 0:e.reconnectAfterMs)!==null&&c!==void 0?c:p=>_j[p-1]||Sj,this.encode=(d=e==null?void 0:e.encode)!==null&&d!==void 0?d:(p,h)=>h(JSON.stringify(p)),this.decode=(u=e==null?void 0:e.decode)!==null&&u!==void 0?u:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class Af extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Ut(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class Cj extends Af{constructor(e,n,r){super(e),this.name="StorageApiError",this.status=n,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class hp extends Af{constructor(e,n){super(e),this.name="StorageUnknownError",this.originalError=n}}const Mf=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),Ej=()=>Response,pp=t=>{if(Array.isArray(t))return t.map(n=>pp(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,r])=>{const s=n.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=pp(r)}),e},Tj=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Fu=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},Nj=(t,e,n)=>Je(void 0,void 0,void 0,function*(){const r=yield Ej();t instanceof r&&!(n!=null&&n.noResolveJson)?t.json().then(s=>{const i=t.status||500,a=(s==null?void 0:s.statusCode)||i+"";e(new Cj(Fu(s),i,a))}).catch(s=>{e(new hp(Fu(s),s))}):e(new hp(Fu(t),t))}),Pj=(t,e,n,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!r?s:(Tj(r)?(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r)):s.body=r,e!=null&&e.duplex&&(s.duplex=e.duplex),Object.assign(Object.assign({},s),n))};function Rl(t,e,n,r,s,i){return Je(this,void 0,void 0,function*(){return new Promise((a,l)=>{t(n,Pj(e,r,s,i)).then(c=>{if(!c.ok)throw c;return r!=null&&r.noResolveJson?c:c.json()}).then(c=>a(c)).catch(c=>Nj(c,l,r))})})}function vl(t,e,n,r){return Je(this,void 0,void 0,function*(){return Rl(t,"GET",e,n,r)})}function Hr(t,e,n,r,s){return Je(this,void 0,void 0,function*(){return Rl(t,"POST",e,r,s,n)})}function fp(t,e,n,r,s){return Je(this,void 0,void 0,function*(){return Rl(t,"PUT",e,r,s,n)})}function Rj(t,e,n,r){return Je(this,void 0,void 0,function*(){return Rl(t,"HEAD",e,Object.assign(Object.assign({},n),{noResolveJson:!0}),r)})}function $f(t,e,n,r,s){return Je(this,void 0,void 0,function*(){return Rl(t,"DELETE",e,r,s,n)})}class Oj{constructor(e,n){this.downloadFn=e,this.shouldThrowOnError=n}then(e,n){return this.execute().then(e,n)}execute(){return Je(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Ut(e))return{data:null,error:e};throw e}})}}var r1;class Aj{constructor(e,n){this.downloadFn=e,this.shouldThrowOnError=n,this[r1]="BlobDownloadBuilder",this.promise=null}asStream(){return new Oj(this.downloadFn,this.shouldThrowOnError)}then(e,n){return this.getPromise().then(e,n)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return Je(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Ut(e))return{data:null,error:e};throw e}})}}r1=Symbol.toStringTag;const Mj={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},p0={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class $j{constructor(e,n={},r,s){this.shouldThrowOnError=!1,this.url=e,this.headers=n,this.bucketId=r,this.fetch=Mf(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,n,r,s){return Je(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},p0),s);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const c=a.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.has("cacheControl")||i.append("cacheControl",a.cacheControl),c&&!i.has("metadata")&&i.append("metadata",this.encodeMetadata(c))):(i=r,l["cache-control"]=`max-age=${a.cacheControl}`,l["content-type"]=a.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!a.duplex&&(a.duplex="half")),s!=null&&s.headers&&(l=Object.assign(Object.assign({},l),s.headers));const d=this._removeEmptyFolders(n),u=this._getFinalPath(d),p=yield(e=="PUT"?fp:Hr)(this.fetch,`${this.url}/object/${u}`,i,Object.assign({headers:l},a!=null&&a.duplex?{duplex:a.duplex}:{}));return{data:{path:d,id:p.Id,fullPath:p.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Ut(i))return{data:null,error:i};throw i}})}upload(e,n,r){return Je(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,n,r)})}uploadToSignedUrl(e,n,r,s){return Je(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),l=new URL(this.url+`/object/upload/sign/${a}`);l.searchParams.set("token",n);try{let c;const d=Object.assign({upsert:p0.upsert},s),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",d.cacheControl)):(c=r,u["cache-control"]=`max-age=${d.cacheControl}`,u["content-type"]=d.contentType);const p=yield fp(this.fetch,l.toString(),c,{headers:u});return{data:{path:i,fullPath:p.Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Ut(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,n){return Je(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);n!=null&&n.upsert&&(s["x-upsert"]="true");const i=yield Hr(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),a=new URL(this.url+i.url),l=a.searchParams.get("token");if(!l)throw new Af("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:l},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ut(r))return{data:null,error:r};throw r}})}update(e,n,r){return Je(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,n,r)})}move(e,n,r){return Je(this,void 0,void 0,function*(){try{return{data:yield Hr(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Ut(s))return{data:null,error:s};throw s}})}copy(e,n,r){return Je(this,void 0,void 0,function*(){try{return{data:{path:(yield Hr(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Ut(s))return{data:null,error:s};throw s}})}createSignedUrl(e,n,r){return Je(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield Hr(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:n},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const a=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Ut(s))return{data:null,error:s};throw s}})}createSignedUrls(e,n,r){return Je(this,void 0,void 0,function*(){try{const s=yield Hr(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:n,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Ut(s))return{data:null,error:s};throw s}})}download(e,n){const s=typeof(n==null?void 0:n.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((n==null?void 0:n.transform)||{}),a=i?`?${i}`:"",l=this._getFinalPath(e),c=()=>vl(this.fetch,`${this.url}/${s}/${l}${a}`,{headers:this.headers,noResolveJson:!0});return new Aj(c,this.shouldThrowOnError)}info(e){return Je(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{const r=yield vl(this.fetch,`${this.url}/object/info/${n}`,{headers:this.headers});return{data:pp(r),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ut(r))return{data:null,error:r};throw r}})}exists(e){return Je(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{return yield Rj(this.fetch,`${this.url}/object/${n}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ut(r)&&r instanceof hp){const s=r.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,n){const r=this._getFinalPath(e),s=[],i=n!=null&&n.download?`download=${n.download===!0?"":n.download}`:"";i!==""&&s.push(i);const l=typeof(n==null?void 0:n.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((n==null?void 0:n.transform)||{});c!==""&&s.push(c);let d=s.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${r}${d}`)}}}remove(e){return Je(this,void 0,void 0,function*(){try{return{data:yield $f(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ut(n))return{data:null,error:n};throw n}})}list(e,n,r){return Je(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Mj),n),{prefix:e||""});return{data:yield Hr(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Ut(s))return{data:null,error:s};throw s}})}listV2(e,n){return Je(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield Hr(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},n),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ut(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const n=[];return e.width&&n.push(`width=${e.width}`),e.height&&n.push(`height=${e.height}`),e.resize&&n.push(`resize=${e.resize}`),e.format&&n.push(`format=${e.format}`),e.quality&&n.push(`quality=${e.quality}`),n.join("&")}}const s1="2.79.0",i1={"X-Client-Info":`storage-js/${s1}`};class Lj{constructor(e,n={},r,s){this.shouldThrowOnError=!1;const i=new URL(e);s!=null&&s.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},i1),n),this.fetch=Mf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return Je(this,void 0,void 0,function*(){try{const n=this.listBucketOptionsToQueryString(e);return{data:yield vl(this.fetch,`${this.url}/bucket${n}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ut(n))return{data:null,error:n};throw n}})}getBucket(e){return Je(this,void 0,void 0,function*(){try{return{data:yield vl(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ut(n))return{data:null,error:n};throw n}})}createBucket(e){return Je(this,arguments,void 0,function*(n,r={public:!1}){try{return{data:yield Hr(this.fetch,`${this.url}/bucket`,{id:n,name:n,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Ut(s))return{data:null,error:s};throw s}})}updateBucket(e,n){return Je(this,void 0,void 0,function*(){try{return{data:yield fp(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Ut(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Je(this,void 0,void 0,function*(){try{return{data:yield Hr(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ut(n))return{data:null,error:n};throw n}})}deleteBucket(e){return Je(this,void 0,void 0,function*(){try{return{data:yield $f(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ut(n))return{data:null,error:n};throw n}})}listBucketOptionsToQueryString(e){const n={};return e&&("limit"in e&&(n.limit=String(e.limit)),"offset"in e&&(n.offset=String(e.offset)),e.search&&(n.search=e.search),e.sortColumn&&(n.sortColumn=e.sortColumn),e.sortOrder&&(n.sortOrder=e.sortOrder)),Object.keys(n).length>0?"?"+new URLSearchParams(n).toString():""}}class Dj{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},i1),n),this.fetch=Mf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return Je(this,void 0,void 0,function*(){try{return{data:yield Hr(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ut(n))return{data:null,error:n};throw n}})}listBuckets(e){return Je(this,void 0,void 0,function*(){try{const n=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&n.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&n.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&n.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&n.set("sortOrder",e.sortOrder),e!=null&&e.search&&n.set("search",e.search);const r=n.toString(),s=r?`${this.url}/bucket?${r}`:`${this.url}/bucket`;return{data:yield vl(this.fetch,s,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ut(n))return{data:null,error:n};throw n}})}deleteBucket(e){return Je(this,void 0,void 0,function*(){try{return{data:yield $f(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Ut(n))return{data:null,error:n};throw n}})}}const Lf={"X-Client-Info":`storage-js/${s1}`,"Content-Type":"application/json"};class o1 extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function lr(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}class Bu extends o1{constructor(e,n,r){super(e),this.name="StorageVectorsApiError",this.status=n,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Ij extends o1{constructor(e,n){super(e),this.name="StorageVectorsUnknownError",this.originalError=n}}var f0;(function(t){t.InternalError="InternalError",t.S3VectorConflictException="S3VectorConflictException",t.S3VectorNotFoundException="S3VectorNotFoundException",t.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",t.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",t.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(f0||(f0={}));const Df=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),zj=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},m0=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Fj=(t,e,n)=>Je(void 0,void 0,void 0,function*(){if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(n!=null&&n.noResolveJson)){const s=t.status||500,i=t;if(typeof i.json=="function")i.json().then(a=>{const l=(a==null?void 0:a.statusCode)||(a==null?void 0:a.code)||s+"";e(new Bu(m0(a),s,l))}).catch(()=>{const a=s+"",l=i.statusText||`HTTP ${s} error`;e(new Bu(l,s,a))});else{const a=s+"",l=i.statusText||`HTTP ${s} error`;e(new Bu(l,s,a))}}else e(new Ij(m0(t),t))}),Bj=(t,e,n,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return r?(zj(r)?(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r)):s.body=r,Object.assign(Object.assign({},s),n)):s};function Hj(t,e,n,r,s,i){return Je(this,void 0,void 0,function*(){return new Promise((a,l)=>{t(n,Bj(e,r,s,i)).then(c=>{if(!c.ok)throw c;if(r!=null&&r.noResolveJson)return c;const d=c.headers.get("content-type");return!d||!d.includes("application/json")?{}:c.json()}).then(c=>a(c)).catch(c=>Fj(c,l,r))})})}function cr(t,e,n,r,s){return Je(this,void 0,void 0,function*(){return Hj(t,"POST",e,r,s,n)})}class Uj{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Lf),n),this.fetch=Df(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return Je(this,void 0,void 0,function*(){try{return{data:(yield cr(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}})}getIndex(e,n){return Je(this,void 0,void 0,function*(){try{return{data:yield cr(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:n},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(lr(r))return{data:null,error:r};throw r}})}listIndexes(e){return Je(this,void 0,void 0,function*(){try{return{data:yield cr(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}})}deleteIndex(e,n){return Je(this,void 0,void 0,function*(){try{return{data:(yield cr(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:n},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(lr(r))return{data:null,error:r};throw r}})}}class Wj{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Lf),n),this.fetch=Df(r)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return Je(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield cr(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}})}getVectors(e){return Je(this,void 0,void 0,function*(){try{return{data:yield cr(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}})}listVectors(e){return Je(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield cr(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}})}queryVectors(e){return Je(this,void 0,void 0,function*(){try{return{data:yield cr(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}})}deleteVectors(e){return Je(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield cr(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}})}}class Gj{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Lf),n),this.fetch=Df(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return Je(this,void 0,void 0,function*(){try{return{data:(yield cr(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}})}getBucket(e){return Je(this,void 0,void 0,function*(){try{return{data:yield cr(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}})}listBuckets(){return Je(this,arguments,void 0,function*(e={}){try{return{data:yield cr(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}})}deleteBucket(e){return Je(this,void 0,void 0,function*(){try{return{data:(yield cr(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(lr(n))return{data:null,error:n};throw n}})}}class Vj extends Gj{constructor(e,n={}){super(e,n.headers||{},n.fetch)}from(e){return new Yj(this.url,this.headers,e,this.fetch)}}class Yj extends Uj{constructor(e,n,r,s){super(e,n,s),this.vectorBucketName=r}createIndex(e){const n=Object.create(null,{createIndex:{get:()=>super.createIndex}});return Je(this,void 0,void 0,function*(){return n.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return Je(this,arguments,void 0,function*(n={}){return e.listIndexes.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const n=Object.create(null,{getIndex:{get:()=>super.getIndex}});return Je(this,void 0,void 0,function*(){return n.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const n=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return Je(this,void 0,void 0,function*(){return n.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new qj(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class qj extends Wj{constructor(e,n,r,s,i){super(e,n,i),this.vectorBucketName=r,this.indexName=s}putVectors(e){const n=Object.create(null,{putVectors:{get:()=>super.putVectors}});return Je(this,void 0,void 0,function*(){return n.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const n=Object.create(null,{getVectors:{get:()=>super.getVectors}});return Je(this,void 0,void 0,function*(){return n.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return Je(this,arguments,void 0,function*(n={}){return e.listVectors.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const n=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return Je(this,void 0,void 0,function*(){return n.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const n=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return Je(this,void 0,void 0,function*(){return n.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class Xj extends Lj{constructor(e,n={},r,s){super(e,n,r,s)}from(e){return new $j(this.url,this.headers,e,this.fetch)}get vectors(){return new Vj(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Dj(this.url+"/iceberg",this.headers,this.fetch)}}const Kj="2.79.0";let za="";typeof Deno<"u"?za="deno":typeof document<"u"?za="web":typeof navigator<"u"&&navigator.product==="ReactNative"?za="react-native":za="node";const Zj={"X-Client-Info":`supabase-js-${za}/${Kj}`},Jj={headers:Zj},Qj={schema:"public"},eC={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},tC={},nC=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),rC=()=>Headers,sC=(t,e,n)=>{const r=nC(n),s=rC();return async(i,a)=>{var l;const c=(l=await e())!==null&&l!==void 0?l:t;let d=new s(a==null?void 0:a.headers);return d.has("apikey")||d.set("apikey",t),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},a),{headers:d}))}};function iC(t){return t.endsWith("/")?t:t+"/"}function oC(t,e){var n,r;const{db:s,auth:i,realtime:a,global:l}=t,{db:c,auth:d,realtime:u,global:p}=e,h={db:Object.assign(Object.assign({},c),s),auth:Object.assign(Object.assign({},d),i),realtime:Object.assign(Object.assign({},u),a),storage:{},global:Object.assign(Object.assign(Object.assign({},p),l),{headers:Object.assign(Object.assign({},(n=p==null?void 0:p.headers)!==null&&n!==void 0?n:{}),(r=l==null?void 0:l.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return t.accessToken?h.accessToken=t.accessToken:delete h.accessToken,h}function aC(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(iC(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const a1="2.79.0",oo=30*1e3,mp=3,Hu=mp*oo,lC="http://localhost:9999",cC="supabase.auth.token",dC={"X-Client-Info":`gotrue-js/${a1}`},gp="X-Supabase-Api-Version",l1={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},uC=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,hC=10*60*1e3;class bl extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function rt(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class pC extends bl{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function fC(t){return rt(t)&&t.name==="AuthApiError"}class Si extends bl{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class li extends bl{constructor(e,n,r,s){super(e,r,s),this.name=n,this.status=r}}class Ir extends li{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function mC(t){return rt(t)&&t.name==="AuthSessionMissingError"}class to extends li{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class gc extends li{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class yc extends li{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function gC(t){return rt(t)&&t.name==="AuthImplicitGrantRedirectError"}class g0 extends li{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class yp extends li{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function Uu(t){return rt(t)&&t.name==="AuthRetryableFetchError"}class y0 extends li{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class xp extends li{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const fd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),x0=` 	
\r=`.split(""),yC=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<x0.length;e+=1)t[x0[e].charCodeAt(0)]=-2;for(let e=0;e<fd.length;e+=1)t[fd[e].charCodeAt(0)]=e;return t})();function v0(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(fd[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(fd[r]),e.queuedBits-=6}}function c1(t,e,n){const r=yC[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function b0(t){const e=[],n=a=>{e.push(String.fromCodePoint(a))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=a=>{bC(a,r,n)};for(let a=0;a<t.length;a+=1)c1(t.charCodeAt(a),s,i);return e.join("")}function xC(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function vC(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|s)+65536,n+=1}xC(r,e)}}function bC(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if(!(t>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function Go(t){const e=[],n={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<t.length;s+=1)c1(t.charCodeAt(s),n,r);return new Uint8Array(e)}function wC(t){const e=[];return vC(t,n=>e.push(n)),new Uint8Array(e)}function Ni(t){const e=[],n={queue:0,queuedBits:0},r=s=>{e.push(s)};return t.forEach(s=>v0(s,n,r)),v0(null,n,r),e.join("")}function _C(t){return Math.round(Date.now()/1e3)+t}function SC(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const An=()=>typeof window<"u"&&typeof document<"u",fi={tested:!1,writable:!1},d1=()=>{if(!An())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(fi.tested)return fi.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),fi.tested=!0,fi.writable=!0}catch{fi.tested=!0,fi.writable=!1}return fi.writable};function kC(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return n.searchParams.forEach((r,s)=>{e[s]=r}),e}const u1=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),jC=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",ao=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},mi=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},$s=async(t,e)=>{await t.removeItem(e)};class Yd{constructor(){this.promise=new Yd.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}Yd.promiseConstructor=Promise;function Wu(t){const e=t.split(".");if(e.length!==3)throw new xp("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!uC.test(e[r]))throw new xp("JWT not in base64url format");return{header:JSON.parse(b0(e[0])),payload:JSON.parse(b0(e[1])),signature:Go(e[2]),raw:{header:e[0],payload:e[1]}}}async function CC(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function EC(t,e){return new Promise((r,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await t(i);if(!e(i,null,a)){r(a);return}}catch(a){if(!e(i,a)){s(a);return}}})()})}function TC(t){return("0"+t.toString(16)).substr(-2)}function NC(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let s="";for(let i=0;i<56;i++)s+=n.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,TC).join("")}async function PC(t){const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function RC(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await PC(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function no(t,e,n=!1){const r=NC();let s=r;n&&(s+="/PASSWORD_RECOVERY"),await ao(t,`${e}-code-verifier`,s);const i=await RC(r);return[i,r===i?"plain":"s256"]}const OC=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function AC(t){const e=t.headers.get(gp);if(!e||!e.match(OC))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function MC(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function $C(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const LC=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ro(t){if(!LC.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Gu(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function DC(t,e){return new Proxy(t,{get:(n,r,s)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const i=r.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,r,s)}return!e.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(n,r,s)}})}function w0(t){return JSON.parse(JSON.stringify(t))}const vi=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),IC=[502,503,504];async function _0(t){var e;if(!jC(t))throw new yp(vi(t),0);if(IC.includes(t.status))throw new yp(vi(t),t.status);let n;try{n=await t.json()}catch(i){throw new Si(vi(i),i)}let r;const s=AC(t);if(s&&s.getTime()>=l1["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new y0(vi(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Ir}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new y0(vi(n),t.status,n.weak_password.reasons);throw new pC(vi(n),t.status||500,r)}const zC=(t,e,n,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),n))};async function ut(t,e,n,r){var s;const i=Object.assign({},r==null?void 0:r.headers);i[gp]||(i[gp]=l1["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const a=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(a.redirect_to=r.redirectTo);const l=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",c=await FC(t,e,n+l,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(c):{data:Object.assign({},c),error:null}}async function FC(t,e,n,r,s,i){const a=zC(e,r,s,i);let l;try{l=await t(n,Object.assign({},a))}catch(c){throw console.error(c),new yp(vi(c),0)}if(l.ok||await _0(l),r!=null&&r.noResolveJson)return l;try{return await l.json()}catch(c){await _0(c)}}function zr(t){var e;let n=null;UC(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=_C(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function S0(t){const e=zr(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Bs(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function BC(t){return{data:t,error:null}}function HC(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:s,verification_type:i}=t,a=ia(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:n,hashed_token:r,redirect_to:s,verification_type:i},c=Object.assign({},a);return{data:{properties:l,user:c},error:null}}function k0(t){return t}function UC(t){return t.access_token&&t.refresh_token&&t.expires_in}const Vu=["global","local","others"];class WC{constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=u1(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,n=Vu[0]){if(Vu.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Vu.join(", ")}`);try{return await ut(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(rt(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await ut(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:Bs})}catch(r){if(rt(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:n}=e,r=ia(e,["options"]),s=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),await ut(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:HC,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(rt(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await ut(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Bs})}catch(n){if(rt(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,s,i,a,l,c;try{const d={nextPage:null,lastPage:0,total:0},u=await ut(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:k0});if(u.error)throw u.error;const p=await u.json(),h=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,f=(c=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return f.length>0&&(f.forEach(m=>{const g=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(m.split(";")[1].split("=")[1]);d[`${v}Page`]=g}),d.total=parseInt(h)),{data:Object.assign(Object.assign({},p),d),error:null}}catch(d){if(rt(d))return{data:{users:[]},error:d};throw d}}async getUserById(e){ro(e);try{return await ut(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Bs})}catch(n){if(rt(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){ro(e);try{return await ut(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:Bs})}catch(r){if(rt(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){ro(e);try{return await ut(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:Bs})}catch(r){if(rt(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){ro(e.userId);try{const{data:n,error:r}=await ut(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:n,error:r}}catch(n){if(rt(n))return{data:null,error:n};throw n}}async _deleteFactor(e){ro(e.userId),ro(e.id);try{return{data:await ut(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(rt(n))return{data:null,error:n};throw n}}async _listOAuthClients(e){var n,r,s,i,a,l,c;try{const d={nextPage:null,lastPage:0,total:0},u=await ut(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:k0});if(u.error)throw u.error;const p=await u.json(),h=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,f=(c=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return f.length>0&&(f.forEach(m=>{const g=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(m.split(";")[1].split("=")[1]);d[`${v}Page`]=g}),d.total=parseInt(h)),{data:Object.assign(Object.assign({},p),d),error:null}}catch(d){if(rt(d))return{data:{clients:[]},error:d};throw d}}async _createOAuthClient(e){try{return await ut(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(rt(n))return{data:null,error:n};throw n}}async _getOAuthClient(e){try{return await ut(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(rt(n))return{data:null,error:n};throw n}}async _updateOAuthClient(e,n){try{return await ut(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:n,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(rt(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(e){try{return await ut(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(rt(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(e){try{return await ut(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(rt(n))return{data:null,error:n};throw n}}}function j0(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const so={debug:!!(globalThis&&d1()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class h1 extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class GC extends h1{}async function VC(t,e,n){so.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),so.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){so.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,s.name);try{return await n()}finally{so.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,s.name)}}else{if(e===0)throw so.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new GC(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(so.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function YC(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function p1(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function qC(t){return parseInt(t,16)}function XC(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function KC(t){var e;const{chainId:n,domain:r,expirationTime:s,issuedAt:i=new Date,nonce:a,notBefore:l,requestId:c,resources:d,scheme:u,uri:p,version:h}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${a}`);if(!p)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(h!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const f=p1(t.address),m=u?`${u}://${r}`:r,g=t.statement?`${t.statement}
`:"",v=`${m} wants you to sign in with your Ethereum account:
${f}

${g}`;let x=`URI: ${p}
Version: ${h}
Chain ID: ${n}${a?`
Nonce: ${a}`:""}
Issued At: ${i.toISOString()}`;if(s&&(x+=`
Expiration Time: ${s.toISOString()}`),l&&(x+=`
Not Before: ${l.toISOString()}`),c&&(x+=`
Request ID: ${c}`),d){let y=`
Resources:`;for(const b of d){if(!b||typeof b!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${b}`);y+=`
- ${b}`}x+=y}return`${v}
${x}`}class tn extends Error{constructor({message:e,code:n,cause:r,name:s}){var i;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(i=s??(r instanceof Error?r.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=n}}class md extends tn{constructor(e,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}),this.name="WebAuthnUnknownError",this.originalError=n}}function ZC({error:t,options:e}){var n,r,s;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new tn({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new tn({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((r=i.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new tn({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new tn({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new tn({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new tn({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return i.pubKeyCredParams.filter(l=>l.type==="public-key").length===0?new tn({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new tn({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const a=window.location.hostname;if(f1(a)){if(i.rp.id!==a)return new tn({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new tn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new tn({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new tn({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new tn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function JC({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new tn({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new tn({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const r=window.location.hostname;if(f1(r)){if(n.rpId!==r)return new tn({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new tn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new tn({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new tn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class QC{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const eE=new QC;function tE(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:n,excludeCredentials:r}=t,s=ia(t,["challenge","user","excludeCredentials"]),i=Go(e).buffer,a=Object.assign(Object.assign({},n),{id:Go(n.id).buffer}),l=Object.assign(Object.assign({},s),{challenge:i,user:a});if(r&&r.length>0){l.excludeCredentials=new Array(r.length);for(let c=0;c<r.length;c++){const d=r[c];l.excludeCredentials[c]=Object.assign(Object.assign({},d),{id:Go(d.id).buffer,type:d.type||"public-key",transports:d.transports})}}return l}function nE(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:n}=t,r=ia(t,["challenge","allowCredentials"]),s=Go(e).buffer,i=Object.assign(Object.assign({},r),{challenge:s});if(n&&n.length>0){i.allowCredentials=new Array(n.length);for(let a=0;a<n.length;a++){const l=n[a];i.allowCredentials[a]=Object.assign(Object.assign({},l),{id:Go(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return i}function rE(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t;return{id:t.id,rawId:t.id,response:{attestationObject:Ni(new Uint8Array(t.response.attestationObject)),clientDataJSON:Ni(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function sE(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t,r=t.getClientExtensionResults(),s=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Ni(new Uint8Array(s.authenticatorData)),clientDataJSON:Ni(new Uint8Array(s.clientDataJSON)),signature:Ni(new Uint8Array(s.signature)),userHandle:s.userHandle?Ni(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function f1(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function C0(){var t,e;return!!(An()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function iE(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new md("Browser returned unexpected credential type",e)}:{data:null,error:new md("Empty credential response",e)}}catch(e){return{data:null,error:ZC({error:e,options:t})}}}async function oE(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new md("Browser returned unexpected credential type",e)}:{data:null,error:new md("Empty credential response",e)}}catch(e){return{data:null,error:JC({error:e,options:t})}}}const aE={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},lE={userVerification:"preferred",hints:["security-key"]};function gd(...t){const e=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),n=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),r={};for(const s of t)if(s)for(const i in s){const a=s[i];if(a!==void 0)if(Array.isArray(a))r[i]=a;else if(n(a))r[i]=a;else if(e(a)){const l=r[i];e(l)?r[i]=gd(l,a):r[i]=gd(a)}else r[i]=a}return r}function cE(t,e){return gd(aE,t,e||{})}function dE(t,e){return gd(lE,t,e||{})}class uE{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:n,friendlyName:r,signal:s},i){try{const{data:a,error:l}=await this.client.mfa.challenge({factorId:e,webauthn:n});if(!a)return{data:null,error:l};const c=s??eE.createNewAbortSignal();if(a.webauthn.type==="create"){const{user:d}=a.webauthn.credential_options.publicKey;d.name||(d.name=`${d.id}:${r}`),d.displayName||(d.displayName=d.name)}switch(a.webauthn.type){case"create":{const d=cE(a.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:u,error:p}=await iE({publicKey:d,signal:c});return u?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:u}},error:null}:{data:null,error:p}}case"request":{const d=dE(a.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:u,error:p}=await oE(Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:d,signal:c}));return u?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:u}},error:null}:{data:null,error:p}}}}catch(a){return rt(a)?{data:null,error:a}:{data:null,error:new Si("Unexpected error in challenge",a)}}}async _verify({challengeId:e,factorId:n,webauthn:r}){return this.client.mfa.verify({factorId:n,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:s}},i){if(!n)return{data:null,error:new bl("rpId is required for WebAuthn authentication")};try{if(!C0())return{data:null,error:new Si("Browser does not support WebAuthn",null)};const{data:a,error:l}=await this.challenge({factorId:e,webauthn:{rpId:n,rpOrigins:r},signal:s},{request:i});if(!a)return{data:null,error:l};const{webauthn:c}=a;return this._verify({factorId:e,challengeId:a.challengeId,webauthn:{type:c.type,rpId:n,rpOrigins:r,credential_response:c.credential_response}})}catch(a){return rt(a)?{data:null,error:a}:{data:null,error:new Si("Unexpected error in authenticate",a)}}}async _register({friendlyName:e,rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:s},i){if(!n)return{data:null,error:new bl("rpId is required for WebAuthn registration")};try{if(!C0())return{data:null,error:new Si("Browser does not support WebAuthn",null)};const{data:a,error:l}=await this._enroll({friendlyName:e});if(!a)return await this.client.mfa.listFactors().then(u=>{var p;return(p=u.data)===null||p===void 0?void 0:p.all.find(h=>h.factor_type==="webauthn"&&h.friendly_name===e&&h.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u==null?void 0:u.id}):void 0),{data:null,error:l};const{data:c,error:d}=await this._challenge({factorId:a.id,friendlyName:a.friendly_name,webauthn:{rpId:n,rpOrigins:r},signal:s},{create:i});return c?this._verify({factorId:a.id,challengeId:c.challengeId,webauthn:{rpId:n,rpOrigins:r,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:d}}catch(a){return rt(a)?{data:null,error:a}:{data:null,error:new Si("Unexpected error in register",a)}}}}YC();const hE={url:lC,storageKey:cC,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:dC,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function E0(t,e,n){return await n()}const io={};class wl{get jwks(){var e,n;return(n=(e=io[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){io[this.storageKey]=Object.assign(Object.assign({},io[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=io[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){io[this.storageKey]=Object.assign(Object.assign({},io[this.storageKey]),{cachedAt:e})}constructor(e){var n,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=wl.nextInstanceID,wl.nextInstanceID+=1,this.instanceID>0&&An()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},hE),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new WC({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=u1(s.fetch),this.lock=s.lock||E0,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,this.throwOnError=s.throwOnError,s.lock?this.lock=s.lock:An()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=VC:this.lock=E0,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new uE(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:d1()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=j0(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=j0(this.memoryStorage)),An()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${a1}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n={},r="none";if(An()&&(n=kC(window.location.href),this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce")),An()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:i}=await this._getSessionFromURL(n,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),gC(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:a,redirectType:l}=s;return this._debug("#_initialize()","detected session in URL",a,"redirect type",l),await this._saveSession(a),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return rt(n)?this._returnResult({error:n}):this._returnResult({error:new Si("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,s;try{const i=await ut(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:zr}),{data:a,error:l}=i;if(l||!a)return this._returnResult({data:{user:null,session:null},error:l});const c=a.session,d=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(i){if(rt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var n,r,s;try{let i;if("email"in e){const{email:u,password:p,options:h}=e;let f=null,m=null;this.flowType==="pkce"&&([f,m]=await no(this.storage,this.storageKey)),i=await ut(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:u,password:p,data:(n=h==null?void 0:h.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:f,code_challenge_method:m},xform:zr})}else if("phone"in e){const{phone:u,password:p,options:h}=e;i=await ut(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:p,data:(r=h==null?void 0:h.data)!==null&&r!==void 0?r:{},channel:(s=h==null?void 0:h.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:zr})}else throw new gc("You must provide either an email or phone number and a password");const{data:a,error:l}=i;if(l||!a)return this._returnResult({data:{user:null,session:null},error:l});const c=a.session,d=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(i){if(rt(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let n;if("email"in e){const{email:i,password:a,options:l}=e;n=await ut(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:S0})}else if("phone"in e){const{phone:i,password:a,options:l}=e;n=await ut(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:S0})}else throw new gc("You must provide either an email or phone number and a password");const{data:r,error:s}=n;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!r||!r.session||!r.user){const i=new to;return this._returnResult({data:{user:null,session:null},error:i})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(n){if(rt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(e){var n,r,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,r,s,i,a,l,c,d,u,p,h;let f,m;if("message"in e)f=e.message,m=e.signature;else{const{chain:g,wallet:v,statement:x,options:y}=e;let b;if(An())if(typeof v=="object")b=v;else{const T=window;if("ethereum"in T&&typeof T.ethereum=="object"&&"request"in T.ethereum&&typeof T.ethereum.request=="function")b=T.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!(y!=null&&y.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");b=v}const w=new URL((n=y==null?void 0:y.url)!==null&&n!==void 0?n:window.location.href),j=await b.request({method:"eth_requestAccounts"}).then(T=>T).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!j||j.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const _=p1(j[0]);let S=(r=y==null?void 0:y.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!S){const T=await b.request({method:"eth_chainId"});S=qC(T)}const E={domain:w.host,address:_,statement:x,uri:w.href,version:"1",chainId:S,nonce:(s=y==null?void 0:y.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(a=(i=y==null?void 0:y.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&a!==void 0?a:new Date,expirationTime:(l=y==null?void 0:y.signInWithEthereum)===null||l===void 0?void 0:l.expirationTime,notBefore:(c=y==null?void 0:y.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(d=y==null?void 0:y.signInWithEthereum)===null||d===void 0?void 0:d.requestId,resources:(u=y==null?void 0:y.signInWithEthereum)===null||u===void 0?void 0:u.resources};f=KC(E),m=await b.request({method:"personal_sign",params:[XC(f),_]})}try{const{data:g,error:v}=await ut(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:m},!((p=e.options)===null||p===void 0)&&p.captchaToken?{gotrue_meta_security:{captcha_token:(h=e.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:zr});if(v)throw v;if(!g||!g.session||!g.user){const x=new to;return this._returnResult({data:{user:null,session:null},error:x})}return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),this._returnResult({data:Object.assign({},g),error:v})}catch(g){if(rt(g))return this._returnResult({data:{user:null,session:null},error:g});throw g}}async signInWithSolana(e){var n,r,s,i,a,l,c,d,u,p,h,f;let m,g;if("message"in e)m=e.message,g=e.signature;else{const{chain:v,wallet:x,statement:y,options:b}=e;let w;if(An())if(typeof x=="object")w=x;else{const _=window;if("solana"in _&&typeof _.solana=="object"&&("signIn"in _.solana&&typeof _.solana.signIn=="function"||"signMessage"in _.solana&&typeof _.solana.signMessage=="function"))w=_.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof x!="object"||!(b!=null&&b.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=x}const j=new URL((n=b==null?void 0:b.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in w&&w.signIn){const _=await w.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},b==null?void 0:b.signInWithSolana),{version:"1",domain:j.host,uri:j.href}),y?{statement:y}:null));let S;if(Array.isArray(_)&&_[0]&&typeof _[0]=="object")S=_[0];else if(_&&typeof _=="object"&&"signedMessage"in _&&"signature"in _)S=_;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in S&&"signature"in S&&(typeof S.signedMessage=="string"||S.signedMessage instanceof Uint8Array)&&S.signature instanceof Uint8Array)m=typeof S.signedMessage=="string"?S.signedMessage:new TextDecoder().decode(S.signedMessage),g=S.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in w)||typeof w.signMessage!="function"||!("publicKey"in w)||typeof w!="object"||!w.publicKey||!("toBase58"in w.publicKey)||typeof w.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${j.host} wants you to sign in with your Solana account:`,w.publicKey.toBase58(),...y?["",y,""]:[""],"Version: 1",`URI: ${j.href}`,`Issued At: ${(s=(r=b==null?void 0:b.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=b==null?void 0:b.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${b.signInWithSolana.notBefore}`]:[],...!((a=b==null?void 0:b.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${b.signInWithSolana.expirationTime}`]:[],...!((l=b==null?void 0:b.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${b.signInWithSolana.chainId}`]:[],...!((c=b==null?void 0:b.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${b.signInWithSolana.nonce}`]:[],...!((d=b==null?void 0:b.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${b.signInWithSolana.requestId}`]:[],...!((p=(u=b==null?void 0:b.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||p===void 0)&&p.length?["Resources",...b.signInWithSolana.resources.map(S=>`- ${S}`)]:[]].join(`
`);const _=await w.signMessage(new TextEncoder().encode(m),"utf8");if(!_||!(_ instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");g=_}}try{const{data:v,error:x}=await ut(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:Ni(g)},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:zr});if(x)throw x;if(!v||!v.session||!v.user){const y=new to;return this._returnResult({data:{user:null,session:null},error:y})}return v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),this._returnResult({data:Object.assign({},v),error:x})}catch(v){if(rt(v))return this._returnResult({data:{user:null,session:null},error:v});throw v}}async _exchangeCodeForSession(e){const n=await mi(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(n??"").split("/");try{const{data:i,error:a}=await ut(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:zr});if(await $s(this.storage,`${this.storageKey}-code-verifier`),a)throw a;if(!i||!i.session||!i.user){const l=new to;return this._returnResult({data:{user:null,session:null,redirectType:null},error:l})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:a})}catch(i){if(rt(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:n,provider:r,token:s,access_token:i,nonce:a}=e,l=await ut(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:zr}),{data:c,error:d}=l;if(d)return this._returnResult({data:{user:null,session:null},error:d});if(!c||!c.session||!c.user){const u=new to;return this._returnResult({data:{user:null,session:null},error:u})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:c,error:d})}catch(n){if(rt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(e){var n,r,s,i,a;try{if("email"in e){const{email:l,options:c}=e;let d=null,u=null;this.flowType==="pkce"&&([d,u]=await no(this.storage,this.storageKey));const{error:p}=await ut(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:d,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:p})}if("phone"in e){const{phone:l,options:c}=e,{data:d,error:u}=await ut(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(a=c==null?void 0:c.channel)!==null&&a!==void 0?a:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:u})}throw new gc("You must provide either an email or phone number.")}catch(l){if(rt(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async verifyOtp(e){var n,r;try{let s,i;"options"in e&&(s=(n=e.options)===null||n===void 0?void 0:n.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:a,error:l}=await ut(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:zr});if(l)throw l;if(!a)throw new Error("An error occurred on token verification.");const c=a.session,d=a.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(s){if(rt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithSSO(e){var n,r,s;try{let i=null,a=null;this.flowType==="pkce"&&([i,a]=await no(this.storage,this.storageKey));const l=await ut(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:a}),headers:this.headers,xform:BC});return this._returnResult(l)}catch(i){if(rt(i))return this._returnResult({data:null,error:i});throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new Ir;const{error:s}=await ut(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(e){if(rt(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:a}=await ut(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:a})}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:a,error:l}=await ut(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:l})}throw new gc("You must provide either an email or phone number and a type")}catch(n){if(rt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await mi(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Hu:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const a=await mi(this.userStorage,this.storageKey+"-user");a!=null&&a.user?e.user=a.user:e.user=Gu()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const a={value:this.suppressGetSessionWarning};e.user=DC(e.user,a),a.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await ut(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Bs}):await this._useSession(async n=>{var r,s,i;const{data:a,error:l}=n;if(l)throw l;return!(!((r=a.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ir}:await ut(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:Bs})})}catch(n){if(rt(n))return mC(n)&&(await this._removeSession(),await $s(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{const{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new Ir;const a=s.session;let l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await no(this.storage,this.storageKey));const{data:d,error:u}=await ut(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:a.access_token,xform:Bs});if(u)throw u;return a.user=d.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),this._returnResult({data:{user:a.user},error:null})})}catch(r){if(rt(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ir;const n=Date.now()/1e3;let r=n,s=!0,i=null;const{payload:a}=Wu(e.access_token);if(a.exp&&(r=a.exp,s=r<=n),s){const{data:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(n){if(rt(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){const{data:a,error:l}=n;if(l)throw l;e=(r=a.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new Ir;const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(rt(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(e,n){try{if(!An())throw new yc("No browser detected.");if(e.error||e.error_description||e.error_code)throw new yc(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new g0("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new yc("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new g0("No code detected.");const{data:y,error:b}=await this._exchangeCodeForSession(e.code);if(b)throw b;const w=new URL(window.location.href);return w.searchParams.delete("code"),window.history.replaceState(window.history.state,"",w.toString()),{data:{session:y.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:a,expires_in:l,expires_at:c,token_type:d}=e;if(!i||!l||!a||!d)throw new yc("No session defined in URL");const u=Math.round(Date.now()/1e3),p=parseInt(l);let h=u+p;c&&(h=parseInt(c));const f=h-u;f*1e3<=oo&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${p}s`);const m=h-p;u-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,h,u):u-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,h,u);const{data:g,error:v}=await this._getUser(i);if(v)throw v;const x={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:p,expires_at:h,refresh_token:a,token_type:d,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:x,redirectType:e.type},error:null})}catch(r){if(rt(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await mi(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:s,error:i}=n;if(i)return this._returnResult({error:i});const a=(r=s.session)===null||r===void 0?void 0:r.access_token;if(a){const{error:l}=await this.admin.signOut(a,e);if(l&&!(fC(l)&&(l.status===404||l.status===401||l.status===403)))return this._returnResult({error:l})}return e!=="others"&&(await this._removeSession(),await $s(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const n=SC(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,s;try{const{data:{session:i},error:a}=n;if(a)throw a;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,n={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await no(this.storage,this.storageKey,!0));try{return await ut(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(i){if(rt(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(n){if(rt(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var n;try{const{data:r,error:s}=await this._useSession(async i=>{var a,l,c,d,u;const{data:p,error:h}=i;if(h)throw h;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await ut(this.fetch,"GET",f,{headers:this.headers,jwt:(u=(d=p.session)===null||d===void 0?void 0:d.access_token)!==null&&u!==void 0?u:void 0})});if(s)throw s;return An()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),this._returnResult({data:{provider:e.provider,url:r==null?void 0:r.url},error:null})}catch(r){if(rt(r))return this._returnResult({data:{provider:e.provider,url:null},error:r});throw r}}async linkIdentityIdToken(e){return await this._useSession(async n=>{var r;try{const{error:s,data:{session:i}}=n;if(s)throw s;const{options:a,provider:l,token:c,access_token:d,nonce:u}=e,p=await ut(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=i==null?void 0:i.access_token)!==null&&r!==void 0?r:void 0,body:{provider:l,id_token:c,access_token:d,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:zr}),{data:h,error:f}=p;return f?this._returnResult({data:{user:null,session:null},error:f}):!h||!h.session||!h.user?this._returnResult({data:{user:null,session:null},error:new to}):(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),this._returnResult({data:h,error:f}))}catch(s){if(rt(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}})}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,s;const{data:i,error:a}=n;if(a)throw a;return await ut(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(n){if(rt(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await EC(async s=>(s>0&&await CC(200*Math.pow(2,s-1)),this._debug(n,"refreshing attempt",s),await ut(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:zr})),(s,i)=>{const a=200*Math.pow(2,s);return i&&Uu(i)&&Date.now()+a-r<oo})}catch(r){if(this._debug(n,"error",r),rt(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),An()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const s=await mi(this.storage,this.storageKey);if(s&&this.userStorage){let a=await mi(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:s.user},await ao(this.userStorage,this.storageKey+"-user",a)),s.user=(e=a==null?void 0:a.user)!==null&&e!==void 0?e:Gu()}else if(s&&!s.user&&!s.user){const a=await mi(this.storage,this.storageKey+"-user");a&&(a!=null&&a.user)?(s.user=a.user,await $s(this.storage,this.storageKey+"-user"),await ao(this.storage,this.storageKey,s)):s.user=Gu()}if(this._debug(r,"session from storage",s),!this._isValidSession(s)){this._debug(r,"session is not valid"),s!==null&&await this._removeSession();return}const i=((n=s.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<Hu;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${Hu}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:a}=await this._callRefreshToken(s.refresh_token);a&&(console.error(a),Uu(a)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:a,error:l}=await this._getUser(s.access_token);!l&&(a!=null&&a.user)?(s.user=a.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(r,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(r,"error",s),console.error(s);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new Ir;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Yd;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new Ir;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={data:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(s,"error",i),rt(i)){const a={data:null,error:i};return Uu(i)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(a),a}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,n,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,n)}catch(c){i.push(c)}});if(await Promise.all(a),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await ao(this.userStorage,this.storageKey+"-user",{user:n.user});const s=Object.assign({},n);delete s.user;const i=w0(s);await ao(this.storage,this.storageKey,i)}else{const s=w0(n);await ao(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await $s(this.storage,this.storageKey),await $s(this.storage,this.storageKey+"-code-verifier"),await $s(this.storage,this.storageKey+"-user"),this.userStorage&&await $s(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&An()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),oo);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/oo);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${oo}ms, refresh threshold is ${mp} ticks`),s<=mp&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof h1)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!An()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){const s=[`provider=${encodeURIComponent(n)}`];if(r!=null&&r.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,a]=await no(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});s.push(l.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);s.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;const{data:s,error:i}=n;return i?this._returnResult({data:null,error:i}):await ut(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(rt(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,s;const{data:i,error:a}=n;if(a)return this._returnResult({data:null,error:a});const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:c,error:d}=await ut(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return d?this._returnResult({data:null,error:d}):(e.factorType==="totp"&&c.type==="totp"&&(!((s=c==null?void 0:c.totp)===null||s===void 0)&&s.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),this._returnResult({data:c,error:null}))})}catch(n){if(rt(n))return this._returnResult({data:null,error:n});throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:s,error:i}=n;if(i)return this._returnResult({data:null,error:i});const a=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?rE(e.webauthn.credential_response):sE(e.webauthn.credential_response)})}:{code:e.code}),{data:l,error:c}=await ut(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:a,headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return c?this._returnResult({data:null,error:c}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),this._returnResult({data:l,error:c}))})}catch(n){if(rt(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:s,error:i}=n;if(i)return this._returnResult({data:null,error:i});const a=await ut(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});if(a.error)return a;const{data:l}=a;if(l.type!=="webauthn")return{data:l,error:null};switch(l.webauthn.type){case"create":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:tE(l.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:nE(l.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(rt(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(e){const{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){var e;const{data:{user:n},error:r}=await this.getUser();if(r)return{data:null,error:r};const s={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=n==null?void 0:n.factors)!==null&&e!==void 0?e:[])s.all.push(i),i.status==="verified"&&s[i.factor_type].push(i);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var e,n;const{data:{session:r},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=Wu(r.access_token);let a=null;i.aal&&(a=i.aal);let l=a;((n=(e=r.user.factors)===null||e===void 0?void 0:e.filter(u=>u.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(l="aal2");const d=i.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:d},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async n=>{const{data:{session:r},error:s}=n;return s?this._returnResult({data:null,error:s}):r?await ut(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new Ir})})}catch(n){if(rt(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:s},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new Ir});const a=await ut(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:l=>({data:l,error:null})});return a.data&&a.data.redirect_url&&An()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(r){if(rt(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:s},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new Ir});const a=await ut(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:l=>({data:l,error:null})});return a.data&&a.data.redirect_url&&An()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(r){if(rt(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(l=>l.kid===e);if(r)return r;const s=Date.now();if(r=this.jwks.keys.find(l=>l.kid===e),r&&this.jwks_cached_at+hC>s)return r;const{data:i,error:a}=await ut(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=s,r=i.keys.find(l=>l.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){const{data:f,error:m}=await this.getSession();if(m||!f.session)return this._returnResult({data:null,error:m});r=f.session.access_token}const{header:s,payload:i,signature:a,raw:{header:l,payload:c}}=Wu(r);n!=null&&n.allowExpired||MC(i.exp);const d=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!d){const{error:f}=await this.getUser(r);if(f)throw f;return{data:{claims:i,header:s,signature:a},error:null}}const u=$C(s.alg),p=await crypto.subtle.importKey("jwk",d,u,!0,["verify"]);if(!await crypto.subtle.verify(u,p,a,wC(`${l}.${c}`)))throw new xp("Invalid JWT signature");return{data:{claims:i,header:s,signature:a},error:null}}catch(r){if(rt(r))return this._returnResult({data:null,error:r});throw r}}}wl.nextInstanceID=0;const pE=wl;class fE extends pE{constructor(e){super(e)}}class mE{constructor(e,n,r){var s,i,a;this.supabaseUrl=e,this.supabaseKey=n;const l=aC(e);if(!n)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,d={db:Qj,realtime:tC,auth:Object.assign(Object.assign({},eC),{storageKey:c}),global:Jj},u=oC(r??{},d);this.storageKey=(s=u.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(p,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=u.auth)!==null&&a!==void 0?a:{},this.headers,u.global.fetch),this.fetch=sC(n,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new lj(new URL("rest/v1",l).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),this.storage=new Xj(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),u.accessToken||this._listenForAuthEvents()}get functions(){return new ij(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,n={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,n,r)}channel(e,n={config:{}}){return this.realtime.channel(e,n)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,n;if(this.accessToken)return await this.accessToken();const{data:r}=await this.auth.getSession();return(n=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&n!==void 0?n:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:s,userStorage:i,storageKey:a,flowType:l,lock:c,debug:d,throwOnError:u},p,h){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new fE({url:this.authUrl.href,headers:Object.assign(Object.assign({},f),p),storageKey:a,autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:s,userStorage:i,flowType:l,lock:c,debug:d,throwOnError:u,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(m=>m.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new jj(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,r)=>{this._handleTokenChanged(n,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,n,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),n=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const gE=(t,e,n)=>new mE(t,e,n);function yE(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}yE()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const T0={DRAFTIFY:"/api/studio-draftify",GEOMETRIC_GENERATE:"/api/studio-generate-geometric"},N0={URL:"https://okakomwfikxmwllvliva.supabase.co",ANON_KEY:""},P0={AUTH_SESSION:"studio_auth_session"},ki={BLEND_MODE_ENABLED:!1},an=gE(N0.URL,N0.ANON_KEY),Vr={async signIn(t,e){const{data:n,error:r}=await an.auth.signInWithPassword({email:t,password:e});if(r)throw r;return localStorage.setItem(P0.AUTH_SESSION,JSON.stringify(n.session)),n},async signOut(){await an.auth.signOut(),localStorage.removeItem(P0.AUTH_SESSION)},async getSession(){const{data:t}=await an.auth.getSession();return t.session},async updatePassword(t){const{data:e,error:n}=await an.auth.updateUser({password:t});if(n)throw n;return await an.auth.updateUser({data:{password_setup_complete:!0}}),e},onAuthStateChange(t){return an.auth.onAuthStateChange(t)}};async function qd(){var n,r;const t=await an.auth.getSession(),e=(r=(n=t==null?void 0:t.data)==null?void 0:n.session)==null?void 0:r.access_token;if(!e)throw new Error("Not authenticated");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function If(t){const e=await qd(),n=await fetch("/api/designs/save",{method:"POST",headers:e,body:JSON.stringify(t)});if(!n.ok){const r=await n.json();throw new Error(r.error||"Unable to save your design. Please check your connection and try again.")}return n.json()}async function yd({project_id:t,limit:e=50,offset:n=0,search:r}={}){const s=await qd(),i=new URLSearchParams;t&&i.append("project_id",t),i.append("limit",e),i.append("offset",n),r&&i.append("search",r);const a=await fetch(`/api/designs/list?${i}`,{method:"GET",headers:s});if(!a.ok){const l=await a.json();throw new Error(l.error||"Unable to load your designs. Please refresh the page and try again.")}return a.json()}async function Ol(t){const e=await qd(),n=await fetch(`/api/designs/by-id?id=${t}`,{method:"GET",headers:e});if(!n.ok){const r=await n.json();throw new Error(r.error||"Unable to open this design. It may have been deleted or you may not have permission to view it.")}return n.json()}async function xE(t){const e=await qd(),n=await fetch(`/api/designs/by-id?id=${t}`,{method:"DELETE",headers:e});if(!n.ok){const r=await n.json();throw new Error(r.error||"Unable to delete this design. Please check your connection and try again.")}return n.json()}class vE extends L.Component{constructor(n){super(n);Gl(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(n){return{hasError:!0}}componentDidCatch(n,r){console.error("[ErrorBoundary] Caught error:",n,r),this.setState({error:n,errorInfo:r})}render(){return this.state.hasError?o.jsxs("div",{className:"error-boundary",children:[o.jsxs("div",{className:"error-content",children:[o.jsx("h1",{children:"Something went wrong"}),o.jsx("p",{children:"We're sorry, but something unexpected happened. Please try refreshing the page."}),o.jsxs("div",{className:"error-actions",children:[o.jsx("button",{onClick:this.handleReset,className:"btn-primary",children:"Try Again"}),o.jsx("button",{onClick:()=>window.location.reload(),className:"btn-secondary",children:"Refresh Page"})]}),!1]}),o.jsx("style",{jsx:!0,children:`
            .error-boundary {
              min-height: 100vh;
              display: flex;
              align-items: center;
              justify-content: center;
              padding: 2rem;
              background: #f9fafb;
            }

            .error-content {
              max-width: 500px;
              text-align: center;
              background: white;
              padding: 3rem;
              border-radius: 12px;
              box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            }

            h1 {
              color: #1e4a7a;
              margin: 0 0 1rem 0;
              font-size: 1.75rem;
            }

            p {
              color: #6b7280;
              margin: 0 0 2rem 0;
              line-height: 1.6;
            }

            .error-actions {
              display: flex;
              gap: 1rem;
              justify-content: center;
            }

            .btn-primary,
            .btn-secondary {
              padding: 0.75rem 1.5rem;
              border-radius: 6px;
              font-weight: 500;
              cursor: pointer;
              transition: all 0.2s;
              border: none;
            }

            .btn-primary {
              background: #ff6b35;
              color: white;
            }

            .btn-primary:hover {
              background: #e55a2b;
              transform: translateY(-1px);
            }

            .btn-secondary {
              background: white;
              color: #374151;
              border: 1px solid #d1d5db;
            }

            .btn-secondary:hover {
              background: #f9fafb;
            }

            .error-details {
              margin-top: 2rem;
              text-align: left;
              font-size: 0.875rem;
            }

            .error-details summary {
              cursor: pointer;
              color: #6b7280;
              margin-bottom: 0.5rem;
            }

            .error-details pre {
              background: #f3f4f6;
              padding: 1rem;
              border-radius: 4px;
              overflow-x: auto;
              font-size: 0.75rem;
              color: #dc2626;
            }
          `})]}):this.props.children}}const bE="modulepreload",wE=function(t){return"/"+t},R0={},_E=function(e,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.allSettled(n.map(c=>{if(c=wE(c),c in R0)return;R0[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":bE,d||(p.as="script"),p.crossOrigin="",p.href=c,l&&p.setAttribute("nonce",l),document.head.appendChild(p),d)return new Promise((h,f)=>{p.addEventListener("load",h),p.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return s.then(a=>{for(const l of a||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})},O0=t=>{let e;const n=new Set,r=(d,u)=>{const p=typeof d=="function"?d(e):d;if(!Object.is(p,e)){const h=e;e=u??(typeof p!="object"||p===null)?p:Object.assign({},e,p),n.forEach(f=>f(e,h))}},s=()=>e,l={setState:r,getState:s,getInitialState:()=>c,subscribe:d=>(n.add(d),()=>n.delete(d))},c=e=t(r,s,l);return l},SE=t=>t?O0(t):O0,kE=t=>t;function jE(t,e=kE){const n=L.useSyncExternalStore(t.subscribe,L.useCallback(()=>e(t.getState()),[t,e]),L.useCallback(()=>e(t.getInitialState()),[t,e]));return L.useDebugValue(n),n}const A0=t=>{const e=SE(t),n=r=>jE(e,r);return Object.assign(n,e),n},m1=t=>t?A0(t):A0,M0={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},_l=new Map,xc=t=>{const e=_l.get(t);return e?Object.fromEntries(Object.entries(e.stores).map(([n,r])=>[n,r.getState()])):{}},CE=(t,e,n)=>{if(t===void 0)return{type:"untracked",connection:e.connect(n)};const r=_l.get(n.name);if(r)return{type:"tracked",store:t,...r};const s={connection:e.connect(n),stores:{}};return _l.set(n.name,s),{type:"tracked",store:t,...s}},EE=(t,e)=>{if(e===void 0)return;const n=_l.get(t);n&&(delete n.stores[e],Object.keys(n.stores).length===0&&_l.delete(t))},TE=t=>{var e,n;if(!t)return;const r=t.split(`
`),s=r.findIndex(a=>a.includes("api.setState"));if(s<0)return;const i=((e=r[s+1])==null?void 0:e.trim())||"";return(n=/.+ (.+) .+/.exec(i))==null?void 0:n[1]},NE=(t,e={})=>(n,r,s)=>{const{enabled:i,anonymousActionType:a,store:l,...c}=e;let d;try{d=(i??(M0?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!d)return t(n,r,s);const{connection:u,...p}=CE(l,d,c);let h=!0;s.setState=(g,v,x)=>{const y=n(g,v);if(!h)return y;const b=x===void 0?{type:a||TE(new Error().stack)||"anonymous"}:typeof x=="string"?{type:x}:x;return l===void 0?(u==null||u.send(b,r()),y):(u==null||u.send({...b,type:`${l}/${b.type}`},{...xc(c.name),[l]:s.getState()}),y)},s.devtools={cleanup:()=>{u&&typeof u.unsubscribe=="function"&&u.unsubscribe(),EE(c.name,l)}};const f=(...g)=>{const v=h;h=!1,n(...g),h=v},m=t(s.setState,r,s);if(p.type==="untracked"?u==null||u.init(m):(p.stores[p.store]=s,u==null||u.init(Object.fromEntries(Object.entries(p.stores).map(([g,v])=>[g,g===p.store?m:v.getState()])))),s.dispatchFromDevtools&&typeof s.dispatch=="function"){let g=!1;const v=s.dispatch;s.dispatch=(...x)=>{(M0?"production":void 0)!=="production"&&x[0].type==="__setState"&&!g&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),g=!0),v(...x)}}return u.subscribe(g=>{var v;switch(g.type){case"ACTION":if(typeof g.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return Yu(g.payload,x=>{if(x.type==="__setState"){if(l===void 0){f(x.state);return}Object.keys(x.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const y=x.state[l];if(y==null)return;JSON.stringify(s.getState())!==JSON.stringify(y)&&f(y);return}s.dispatchFromDevtools&&typeof s.dispatch=="function"&&s.dispatch(x)});case"DISPATCH":switch(g.payload.type){case"RESET":return f(m),l===void 0?u==null?void 0:u.init(s.getState()):u==null?void 0:u.init(xc(c.name));case"COMMIT":if(l===void 0){u==null||u.init(s.getState());return}return u==null?void 0:u.init(xc(c.name));case"ROLLBACK":return Yu(g.state,x=>{if(l===void 0){f(x),u==null||u.init(s.getState());return}f(x[l]),u==null||u.init(xc(c.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return Yu(g.state,x=>{if(l===void 0){f(x);return}JSON.stringify(s.getState())!==JSON.stringify(x[l])&&f(x[l])});case"IMPORT_STATE":{const{nextLiftedState:x}=g.payload,y=(v=x.computedStates.slice(-1)[0])==null?void 0:v.state;if(!y)return;f(l===void 0?y:y[l]),u==null||u.send(null,x);return}case"PAUSE_RECORDING":return h=!h}return}}),m},g1=NE,Yu=(t,e)=>{let n;try{n=JSON.parse(t)}catch(r){console.error("[zustand devtools middleware] Could not parse the received json",r)}n!==void 0&&e(n)};function y1(t){let e=t%2147483647;return e<=0&&(e+=2147483646),function(){return e=e*16807%2147483647,(e-1)/2147483646}}function $0(t,e,n){const r=y1(n),s=[],i=.4,a=.5,l=.5;for(let c=0;c<t;c++){const d=c/t*Math.PI*2-Math.PI/2,u=(r()-.5)*.4*e,p=d+u,h=1+(r()-.5)*e*.8,f=i*h,m=a+f*Math.cos(p),g=l+f*Math.sin(p),v=.35/t*(1+e*(r()-.5)),x=p+Math.PI/2,y=(r()-.5)*.3*e,b=x+Math.PI+y,w=x+y;s.push({x:m,y:g,handleIn:{x:Math.cos(b)*v,y:Math.sin(b)*v},handleOut:{x:Math.cos(w)*v,y:Math.sin(w)*v}})}return s}function PE(t,e,n){if(!t||t.length<3)return RE(e,n);const r=[],s=t.length;for(let i=0;i<s;i++){const a=t[i],l=t[(i+1)%s],c=a.x*e,d=a.y*n,u=l.x*e,p=l.y*n,h=c+a.handleOut.x*e,f=d+a.handleOut.y*n,m=u+l.handleIn.x*e,g=p+l.handleIn.y*n;i===0&&r.push(`M ${c.toFixed(2)},${d.toFixed(2)}`),r.push(`C ${h.toFixed(2)},${f.toFixed(2)} ${m.toFixed(2)},${g.toFixed(2)} ${u.toFixed(2)},${p.toFixed(2)}`)}return r.push("Z"),r.join(" ")}function RE(t,e){const n=t/2,r=e/2,s=n,i=r;return`M ${s-n},${i} A ${n},${r} 0 1,1 ${s+n},${i} A ${n},${r} 0 1,1 ${s-n},${i} Z`}function OE(){const n=[];for(let a=0;a<8;a++){const l=a/8*Math.PI*2-Math.PI/2,c=.5+.4*Math.cos(l),d=.5+.4*Math.sin(l),u=l+Math.PI/2;n.push({x:c,y:d,handleIn:{x:Math.cos(u+Math.PI)*.2,y:Math.sin(u+Math.PI)*.2},handleOut:{x:Math.cos(u)*.2,y:Math.sin(u)*.2}})}return n}const xd={organic:{name:"Organic",description:"Smooth, gentle curves like a pebble",minPoints:6,maxPoints:8,blobinessMin:.15,blobinessMax:.25,handleLengthFactor:.4,radiusVariation:.15},splashy:{name:"Splashy",description:"Irregular edges, some spikes like paint splatter",minPoints:10,maxPoints:12,blobinessMin:.3,blobinessMax:.5,handleLengthFactor:.25,radiusVariation:.35},cloudy:{name:"Cloudy",description:"Soft bumps, fluffy cloud-like appearance",minPoints:8,maxPoints:10,blobinessMin:.2,blobinessMax:.3,handleLengthFactor:.5,radiusVariation:.2},rocky:{name:"Rocky",description:"Angular variations, irregular stone-like edges",minPoints:8,maxPoints:12,blobinessMin:.25,blobinessMax:.4,handleLengthFactor:.2,radiusVariation:.3}};function qu(t,e){const n=xd[t]||xd.organic,r=y1(e),s=Math.floor(r()*(n.maxPoints-n.minPoints+1))+n.minPoints,i=n.blobinessMin+r()*(n.blobinessMax-n.blobinessMin),a=[],l=.4,c=.5,d=.5;for(let u=0;u<s;u++){const p=u/s*Math.PI*2-Math.PI/2,h=(r()-.5)*.4*i,f=p+h,m=1+(r()-.5)*n.radiusVariation*2,g=l*m,v=c+g*Math.cos(f),x=d+g*Math.sin(f),b=n.handleLengthFactor/s*(.8+r()*.4),w=f+Math.PI/2,j=(r()-.5)*.3*i,_=w+Math.PI+j,S=w+j;a.push({x:v,y:x,handleIn:{x:Math.cos(_)*b,y:Math.sin(_)*b},handleOut:{x:Math.cos(S)*b,y:Math.sin(S)*b}})}return a}function AE(t,e,n,r){return{x:n?.5-(t-.5):t,y:r?.5-(e-.5):e}}function ME(t,e,n,r){return{x:n?-t:t,y:r?-e:e}}function x1(t,e,n,r=4){const s=[{index:t,mirrorX:!1,mirrorY:!1,rotationAngle:0}];if(n==="none"||!n)return s;if(n==="horizontal"){const i=(e-t)%e;return i!==t&&s.push({index:i,mirrorX:!0,mirrorY:!1,rotationAngle:0}),s}if(n==="vertical"){const i=(Math.floor(e/2)-t+e)%e;return i!==t&&s.push({index:i,mirrorX:!1,mirrorY:!0,rotationAngle:0}),s}if(n==="radial"){for(let i=1;i<r;i++){const a=Math.round(t+i*e/r)%e;if(a!==t){const l=i*2*Math.PI/r;s.push({index:a,mirrorX:!1,mirrorY:!1,rotationAngle:l})}}return s}return s}function $E(t,e,n,r,s,i=4){if(s==="none"||!s)return t.map((l,c)=>c!==e?l:{...l,x:n,y:r});const a=x1(e,t.length,s,i);return t.map((l,c)=>{const d=a.find(p=>p.index===c);if(!d)return l;if(d.rotationAngle!==0){const f=n-.5,m=r-.5,g=Math.cos(d.rotationAngle),v=Math.sin(d.rotationAngle);return{...l,x:.5+f*g-m*v,y:.5+f*v+m*g}}const u=AE(n,r,d.mirrorX,d.mirrorY);return{...l,x:u.x,y:u.y}})}function LE(t,e,n,r,s,i,a=4){if(i==="none"||!i)return t.map((c,d)=>d!==e?c:{...c,[n]:{x:r,y:s}});const l=x1(e,t.length,i,a);return t.map((c,d)=>{const u=l.find(m=>m.index===d);if(!u)return c;let p=n,h=r,f=s;if(u.rotationAngle!==0){const m=Math.cos(u.rotationAngle),g=Math.sin(u.rotationAngle);h=r*m-s*g,f=r*g+s*m}else{const m=ME(r,s,u.mirrorX,u.mirrorY);h=m.x,f=m.y}return{...c,[p]:{x:h,y:f}}})}function v1(t,e,n,r=!0,s=!1){if(!t||t.length<2)return"";const i=[],a=t.length;for(let l=0;l<a;l++){const c=t[l],d=l===a-1,u=r?t[(l+1)%a]:d?null:t[l+1],p=c.x*e,h=c.y*n;if(l===0&&i.push(`M ${p.toFixed(2)},${h.toFixed(2)}`),!u)continue;const f=u.x*e,m=u.y*n;if(s&&c.handleOut&&u.handleIn){const g=p+c.handleOut.x*e,v=h+c.handleOut.y*n,x=f+u.handleIn.x*e,y=m+u.handleIn.y*n;i.push(`C ${g.toFixed(2)},${v.toFixed(2)} ${x.toFixed(2)},${y.toFixed(2)} ${f.toFixed(2)},${m.toFixed(2)}`)}else i.push(`L ${f.toFixed(2)},${m.toFixed(2)}`)}return r&&i.push("Z"),i.join(" ")}function Xu(t,e=!0,n=.3){if(!t||t.length<2)return t;const r=t.length,s=t.map(i=>({...i,handleIn:{x:0,y:0},handleOut:{x:0,y:0}}));for(let i=0;i<r;i++){const a=e?t[(i-1+r)%r]:i>0?t[i-1]:t[i];t[i];const l=e?t[(i+1)%r]:i<r-1?t[i+1]:t[i],c=l.x-a.x,d=l.y-a.y,u=n*.5;!e&&i===0?(s[i].handleIn={x:0,y:0},s[i].handleOut={x:c*u,y:d*u}):!e&&i===r-1?(s[i].handleIn={x:-c*u,y:-d*u},s[i].handleOut={x:0,y:0}):(s[i].handleIn={x:-c*u,y:-d*u},s[i].handleOut={x:c*u,y:d*u})}return s}function DE(t,e,n,r){const s={x:n,y:r,handleIn:{x:0,y:0},handleOut:{x:0,y:0}},i=[...t];return i.splice(e,0,s),i}function IE(t,e,n=3){if(t.length<=n)return null;const r=[...t];return r.splice(e,1),r}function zE(t){switch(t){case"l-shape":return[{x:0,y:0,handleIn:{x:0,y:0},handleOut:{x:0,y:0}},{x:.5,y:0,handleIn:{x:0,y:0},handleOut:{x:0,y:0}},{x:.5,y:.5,handleIn:{x:0,y:0},handleOut:{x:0,y:0}},{x:1,y:.5,handleIn:{x:0,y:0},handleOut:{x:0,y:0}},{x:1,y:1,handleIn:{x:0,y:0},handleOut:{x:0,y:0}},{x:0,y:1,handleIn:{x:0,y:0},handleOut:{x:0,y:0}}];case"custom":default:return[{x:0,y:0,handleIn:{x:0,y:0},handleOut:{x:0,y:0}},{x:1,y:0,handleIn:{x:0,y:0},handleOut:{x:0,y:0}},{x:1,y:1,handleIn:{x:0,y:0},handleOut:{x:0,y:0}},{x:0,y:1,handleIn:{x:0,y:0},handleOut:{x:0,y:0}}]}}function L0(t,e={}){switch(t){case"l-shape":{const n=e.cutWidth??.6,r=e.cutHeight??.4;return[{x:0,y:0},{x:n,y:0},{x:n,y:r},{x:1,y:r},{x:1,y:1},{x:0,y:1}]}case"u-shape":{const n=e.cutStart??.35,r=e.cutEnd??.65,s=e.cutHeight??.4;return[{x:0,y:0},{x:n,y:0},{x:n,y:s},{x:r,y:s},{x:r,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}]}case"t-shape":{const n=e.stemStart??.3,r=e.stemEnd??.7,s=e.stemHeight??.4;return[{x:0,y:0},{x:1,y:0},{x:1,y:s},{x:r,y:s},{x:r,y:1},{x:n,y:1},{x:n,y:s},{x:0,y:s}]}case"rectangle":default:return null}}function FE(t){switch(t){case"l-shape":return{cutWidth:.6,cutHeight:.4};case"u-shape":return{cutStart:.35,cutEnd:.65,cutHeight:.4};case"t-shape":return{stemStart:.3,stemEnd:.7,stemHeight:.4};default:return{}}}const Ku={surface:{width_mm:5e4,length_mm:5e4,color:{tpv_code:"RH12",hex:"#006C55",name:"Dark Green"},boundary:{type:"rectangle",controlPoints:null}},courts:{},selectedCourtId:null,tracks:{},selectedTrackId:null,motifs:{},selectedMotifId:null,shapes:{},selectedShapeId:null,texts:{},selectedTextId:null,editingTextId:null,exclusionZones:{},selectedExclusionZoneId:null,groups:{},selectedGroupId:null,selectedElementIds:[],clipboard:null,editingGroupId:null,elementOrder:[],customMarkings:[],backgroundZones:[],designName:"Untitled Design",designDescription:"",designTags:[],history:[],historyIndex:-1,maxHistory:50,showCourtLibrary:!0,showPropertiesPanel:!0,propertiesPanelUserClosed:!1,showColorEditor:!1,snapToGrid:!0,gridSize_mm:100,mobileLibraryOpen:!1,mobilePropertiesOpen:!1,mobileColoursOpen:!1,mobileActiveTab:"courts",standaloneMode:!1,standaloneDesignId:null,pathDrawingMode:!1,activePathId:null,isSaving:!1,lastSaved:null},lt=m1(g1((t,e)=>({...Ku,setSurfaceDimensions:(n,r)=>{t(s=>({surface:{...s.surface,width_mm:n,length_mm:r}})),e().addToHistory()},setSurfaceColor:n=>{t(r=>({surface:{...r.surface,color:n}})),e().addToHistory()},setSurfaceBoundaryPreset:n=>{const r=FE(n),s=L0(n,r);t(i=>({surface:{...i.surface,boundary:{type:n,controlPoints:s,params:r}}})),e().addToHistory()},updateBoundaryParams:n=>{var l;const r=e(),s=(l=r.surface.boundary)==null?void 0:l.type;if(!s||s==="rectangle"||s==="custom")return;const i={...r.surface.boundary.params,...n},a=L0(s,i);t(c=>({surface:{...c.surface,boundary:{...c.surface.boundary,controlPoints:a,params:i}}})),e().addToHistory()},setSurfaceBoundaryPoints:n=>{t(r=>({surface:{...r.surface,boundary:{type:"custom",controlPoints:n}}})),e().addToHistory()},resetSurfaceBoundary:()=>{t(n=>({surface:{...n.surface,boundary:{type:"rectangle",controlPoints:null}}})),e().addToHistory()},addCourt:(n,r)=>{const s=`court-${Date.now()}`,i=u=>({RH01:{tpv_code:"RH01",hex:"#A5362F",name:"Standard Red"},RH02:{tpv_code:"RH02",hex:"#E21F2F",name:"Bright Red"},RH10:{tpv_code:"RH10",hex:"#609B63",name:"Standard Green"},RH11:{tpv_code:"RH11",hex:"#3BB44A",name:"Bright Green"},RH12:{tpv_code:"RH12",hex:"#006C55",name:"Dark Green"},RH20:{tpv_code:"RH20",hex:"#0075BC",name:"Standard Blue"},RH21:{tpv_code:"RH21",hex:"#493D8C",name:"Purple"},RH22:{tpv_code:"RH22",hex:"#47AFE3",name:"Light Blue"},RH23:{tpv_code:"RH23",hex:"#039DC4",name:"Azure"},RH26:{tpv_code:"RH26",hex:"#00A6A3",name:"Turquoise"},RH30:{tpv_code:"RH30",hex:"#E4C4AA",name:"Standard Beige"},RH31:{tpv_code:"RH31",hex:"#E8E3D8",name:"Cream"},RH32:{tpv_code:"RH32",hex:"#8B5F3C",name:"Brown"},RH40:{tpv_code:"RH40",hex:"#E5A144",name:"Mustard Yellow"},RH41:{tpv_code:"RH41",hex:"#FFD833",name:"Bright Yellow"},RH50:{tpv_code:"RH50",hex:"#F15B32",name:"Orange"},RH60:{tpv_code:"RH60",hex:"#59595B",name:"Dark Grey"},RH61:{tpv_code:"RH61",hex:"#939598",name:"Light Grey"},RH65:{tpv_code:"RH65",hex:"#D9D9D6",name:"Pale Grey"},RH70:{tpv_code:"RH70",hex:"#231F20",name:"Black"},RH90:{tpv_code:"RH90",hex:"#E8457E",name:"Funky Pink"}})[u]||{tpv_code:"RH31",hex:"#E8E3D8",name:"Cream"},a={};if(r.defaultLineColor){const u=i(r.defaultLineColor);r.markings.forEach(p=>{a[p.id]=u})}const l={};if(r.defaultLineColor&&r.zones){const u=i(r.defaultLineColor);r.zones.forEach(p=>{l[p.id]=u})}const c=r.defaultSurfaceColor?i(r.defaultSurfaceColor):null,d={id:s,templateId:n,template:r,position:{x:e().surface.width_mm/2-r.dimensions.width_mm/2,y:e().surface.length_mm/2-r.dimensions.length_mm/2},rotation:0,scale:1,lineColorOverrides:a,zoneColorOverrides:l,courtSurfaceColor:c};t(u=>({courts:{...u.courts,[s]:d},elementOrder:[...u.elementOrder,s],selectedCourtId:s,selectedTrackId:null})),e().addToHistory()},removeCourt:n=>{const{[n]:r,...s}=e().courts;t(i=>({courts:s,elementOrder:i.elementOrder.filter(a=>a!==n),selectedCourtId:i.selectedCourtId===n?null:i.selectedCourtId})),e().addToHistory()},updateCourtPosition:(n,r)=>{t(s=>({courts:{...s.courts,[n]:{...s.courts[n],position:r}}}))},updateCourtRotation:(n,r)=>{t(s=>({courts:{...s.courts,[n]:{...s.courts[n],rotation:r}}}))},updateCourtScale:(n,r)=>{t(s=>({courts:{...s.courts,[n]:{...s.courts[n],scale:r}}}))},duplicateCourt:n=>{const r=e().courts[n];if(!r)return;const s=`court-${Date.now()}`,i={...r,id:s,position:{x:r.position.x+500,y:r.position.y+500}};t(a=>({courts:{...a.courts,[s]:i},elementOrder:[...a.elementOrder,s],selectedCourtId:s,selectedTrackId:null})),e().addToHistory()},duplicateTrack:n=>{const r=e().tracks[n];if(!r)return;const s=`track-${Date.now()}`,i={...r,id:s,position:{x:r.position.x+500,y:r.position.y+500}};t(a=>({tracks:{...a.tracks,[s]:i},elementOrder:[...a.elementOrder,s],selectedTrackId:s,selectedCourtId:null})),e().addToHistory()},renameElement:(n,r)=>{n.startsWith("court-")?t(s=>({courts:{...s.courts,[n]:{...s.courts[n],customName:r}}})):n.startsWith("track-")?t(s=>({tracks:{...s.tracks,[n]:{...s.tracks[n],customName:r}}})):n.startsWith("motif-")?t(s=>({motifs:{...s.motifs,[n]:{...s.motifs[n],customName:r}}})):n.startsWith("shape-")?t(s=>({shapes:{...s.shapes,[n]:{...s.shapes[n],customName:r}}})):n.startsWith("text-")?t(s=>({texts:{...s.texts,[n]:{...s.texts[n],customName:r}}})):n.startsWith("exclusion-")&&t(s=>({exclusionZones:{...s.exclusionZones,[n]:{...s.exclusionZones[n],customName:r}}})),e().addToHistory()},toggleElementLock:n=>{n.startsWith("court-")?t(r=>{var s;return{courts:{...r.courts,[n]:{...r.courts[n],locked:!((s=r.courts[n])!=null&&s.locked)}}}}):n.startsWith("track-")?t(r=>{var s;return{tracks:{...r.tracks,[n]:{...r.tracks[n],locked:!((s=r.tracks[n])!=null&&s.locked)}}}}):n.startsWith("motif-")?t(r=>{var s;return{motifs:{...r.motifs,[n]:{...r.motifs[n],locked:!((s=r.motifs[n])!=null&&s.locked)}}}}):n.startsWith("shape-")?t(r=>{var s;return{shapes:{...r.shapes,[n]:{...r.shapes[n],locked:!((s=r.shapes[n])!=null&&s.locked)}}}}):n.startsWith("text-")?t(r=>{var s;return{texts:{...r.texts,[n]:{...r.texts[n],locked:!((s=r.texts[n])!=null&&s.locked)}}}}):n.startsWith("exclusion-")?t(r=>{var s;return{exclusionZones:{...r.exclusionZones,[n]:{...r.exclusionZones[n],locked:!((s=r.exclusionZones[n])!=null&&s.locked)}}}}):n.startsWith("group-")&&t(r=>{var s;return{groups:{...r.groups,[n]:{...r.groups[n],locked:!((s=r.groups[n])!=null&&s.locked)}}}}),e().addToHistory()},toggleElementVisibility:n=>{n.startsWith("court-")?t(r=>{var s;return{courts:{...r.courts,[n]:{...r.courts[n],visible:((s=r.courts[n])==null?void 0:s.visible)===!1}}}}):n.startsWith("track-")?t(r=>{var s;return{tracks:{...r.tracks,[n]:{...r.tracks[n],visible:((s=r.tracks[n])==null?void 0:s.visible)===!1}}}}):n.startsWith("motif-")?t(r=>{var s;return{motifs:{...r.motifs,[n]:{...r.motifs[n],visible:((s=r.motifs[n])==null?void 0:s.visible)===!1}}}}):n.startsWith("shape-")?t(r=>{var s;return{shapes:{...r.shapes,[n]:{...r.shapes[n],visible:((s=r.shapes[n])==null?void 0:s.visible)===!1}}}}):n.startsWith("text-")?t(r=>{var s;return{texts:{...r.texts,[n]:{...r.texts[n],visible:((s=r.texts[n])==null?void 0:s.visible)===!1}}}}):n.startsWith("exclusion-")&&t(r=>{var s;return{exclusionZones:{...r.exclusionZones,[n]:{...r.exclusionZones[n],visible:((s=r.exclusionZones[n])==null?void 0:s.visible)===!1}}}}),e().addToHistory()},setLineColor:(n,r,s)=>{t(i=>({courts:{...i.courts,[n]:{...i.courts[n],lineColorOverrides:{...i.courts[n].lineColorOverrides,[r]:s}}}})),e().addToHistory()},setZoneColor:(n,r,s)=>{t(i=>({courts:{...i.courts,[n]:{...i.courts[n],zoneColorOverrides:{...i.courts[n].zoneColorOverrides,[r]:s}}}})),e().addToHistory()},resetCourtColors:n=>{t(r=>({courts:{...r.courts,[n]:{...r.courts[n],lineColorOverrides:{},zoneColorOverrides:{}}}})),e().addToHistory()},setCourtSurfaceColor:(n,r)=>{t(s=>({courts:{...s.courts,[n]:{...s.courts[n],courtSurfaceColor:r}}})),e().addToHistory()},selectCourt:n=>{const{propertiesPanelUserClosed:r}=e();t(r?{selectedCourtId:n,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null,selectedTextId:null,selectedExclusionZoneId:null,editingTextId:null}:{selectedCourtId:n,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null,selectedTextId:null,selectedExclusionZoneId:null,editingTextId:null,showPropertiesPanel:!0})},deselectCourt:()=>{t({selectedCourtId:null,showPropertiesPanel:!1,propertiesPanelUserClosed:!0})},setElementOrder:n=>{t({elementOrder:n})},moveElementUp:n=>{const{elementOrder:r}=e(),s=r.indexOf(n);if(s<r.length-1){const i=[...r];[i[s],i[s+1]]=[i[s+1],i[s]],t({elementOrder:i}),e().addToHistory()}},moveElementDown:n=>{const{elementOrder:r}=e(),s=r.indexOf(n);if(s>0){const i=[...r];[i[s],i[s-1]]=[i[s-1],i[s]],t({elementOrder:i}),e().addToHistory()}},bringToFront:n=>{const{elementOrder:r}=e(),s=r.filter(i=>i!==n);s.push(n),t({elementOrder:s}),e().addToHistory()},sendToBack:n=>{const{elementOrder:r}=e(),s=r.filter(i=>i!==n);s.unshift(n),t({elementOrder:s}),e().addToHistory()},addTrack:(n,r)=>{const s=`track-${Date.now()}`,i=e().surface,a=i.width_mm,l=i.length_mm,c=x=>({RH01:{tpv_code:"RH01",hex:"#A5362F",name:"Standard Red"},RH31:{tpv_code:"RH31",hex:"#E8E3D8",name:"Cream"},RH30:{tpv_code:"RH30",hex:"#E4C4AA",name:"Standard Beige"},RH20:{tpv_code:"RH20",hex:"#0075BC",name:"Standard Blue"},RH12:{tpv_code:"RH12",hex:"#006C55",name:"Dark Green"}})[x]||{tpv_code:x,hex:"#A5362F",name:"Standard Red"},d=r.defaultTrackSurfaceColor?c(r.defaultTrackSurfaceColor):c("RH01"),u=c("RH31"),p=r.trackType==="straight";let h,f,m;const g={enabled:!1,depth_mm:800,lineWidth_mm:50,style:"staggered",direction:"counterclockwise",startPosition:0};if(p){const x=r.parameters.numLanes,y=r.parameters.laneWidth_mm,b=x*y,w=Math.max(a,l)*.9,j=r.parameters.height_mm||1e5,_=Math.min(j,w);h={...r.parameters,width_mm:b,height_mm:_,cornerRadius:{topLeft:0,topRight:0,bottomLeft:0,bottomRight:0},laneWidth_mm:y,startingBoxes:{...g,...r.parameters.startingBoxes}},m=90,f={x:a/2-b/2,y:l/2-_/2}}else{const x=a*.9,y=l*.9,b=r.parameters.width_mm||25e3,w=r.parameters.height_mm||15e3,j=x/b,_=y/w,S=Math.min(j,_),E=r.parameters.cornerRadius||{topLeft:3e3,topRight:3e3,bottomLeft:3e3,bottomRight:3e3},T={topLeft:E.topLeft*S,topRight:E.topRight*S,bottomLeft:E.bottomLeft*S,bottomRight:E.bottomRight*S};h={...r.parameters,width_mm:x,height_mm:y,cornerRadius:T,laneWidth_mm:r.parameters.laneWidth_mm,startingBoxes:{...g,...r.parameters.startingBoxes}},m=0,f={x:a/2-x/2,y:l/2-y/2}}const v={id:s,templateId:n,template:r,position:f,rotation:m,parameters:h,trackSurfaceColor:d,laneSurfaceColors:[],trackLineColor:u};t(x=>({tracks:{...x.tracks,[s]:v},elementOrder:[...x.elementOrder,s],selectedTrackId:s,selectedCourtId:null})),e().addToHistory()},removeTrack:n=>{const{[n]:r,...s}=e().tracks;t(i=>({tracks:s,elementOrder:i.elementOrder.filter(a=>a!==n),selectedTrackId:i.selectedTrackId===n?null:i.selectedTrackId})),e().addToHistory()},updateTrackParameters:(n,r)=>{t(s=>{var p;const i=s.tracks[n];if(!i)return s;const a=i.parameters,l={...a,...r},c=((p=i.template)==null?void 0:p.trackType)==="straight";let d=i.position,u=i.laneSurfaceColors||[];if(r.numLanes!==void 0&&r.numLanes!==a.numLanes&&r.numLanes<a.numLanes&&(u=u.slice(0,r.numLanes)),c&&r.numLanes!==void 0&&r.numLanes!==a.numLanes){const h=a.laneWidth_mm,f=a.numLanes*h,m=r.numLanes*h;l.width_mm=m;const g=i.position.x+f/2,v=i.position.y+a.height_mm/2;d={x:g-m/2,y:v-l.height_mm/2}}return{tracks:{...s.tracks,[n]:{...i,parameters:l,position:d,laneSurfaceColors:u}}}}),e().addToHistory()},updateTrackPosition:(n,r)=>{t(s=>({tracks:{...s.tracks,[n]:{...s.tracks[n],position:r}}}))},updateTrackRotation:(n,r)=>{t(s=>({tracks:{...s.tracks,[n]:{...s.tracks[n],rotation:r}}}))},setTrackSurfaceColor:(n,r)=>{t(s=>({tracks:{...s.tracks,[n]:{...s.tracks[n],trackSurfaceColor:r}}})),e().addToHistory()},setTrackLineColor:(n,r)=>{t(s=>({tracks:{...s.tracks,[n]:{...s.tracks[n],trackLineColor:r}}})),e().addToHistory()},setLaneSurfaceColor:(n,r,s)=>{t(i=>{const a=i.tracks[n];if(!a)return i;const l=[...a.laneSurfaceColors||[]];for(;l.length<r;)l.push(null);return l[r-1]=s,{tracks:{...i.tracks,[n]:{...a,laneSurfaceColors:l}}}}),e().addToHistory()},resetLaneSurfaceColors:n=>{t(r=>({tracks:{...r.tracks,[n]:{...r.tracks[n],laneSurfaceColors:[]}}})),e().addToHistory()},selectTrack:n=>{const{propertiesPanelUserClosed:r}=e();t(r?{selectedTrackId:n,selectedCourtId:null,selectedMotifId:null,selectedShapeId:null,selectedTextId:null,selectedExclusionZoneId:null,editingTextId:null}:{selectedTrackId:n,selectedCourtId:null,selectedMotifId:null,selectedShapeId:null,selectedTextId:null,selectedExclusionZoneId:null,editingTextId:null,showPropertiesPanel:!0})},deselectTrack:()=>{t({selectedTrackId:null,showPropertiesPanel:!1,propertiesPanelUserClosed:!0})},addMotif:(n,r,s,i,a,l=null,c={})=>{const d=`motif-${Date.now()}`,u=e().surface,p={id:d,type:"motif",sourceDesignId:n,sourceDesignName:r,sourceThumbnailUrl:l,solidSvgContent:c.solidSvgContent||s,blendSvgContent:c.blendSvgContent||null,hasBothVersions:c.hasBothVersions||!1,viewMode:"solid",svgContent:c.solidSvgContent||s,originalWidth_mm:i,originalHeight_mm:a,position:{x:u.width_mm/2-i/2,y:u.length_mm/2-a/2},rotation:0,scale:1};t(h=>({motifs:{...h.motifs,[d]:p},elementOrder:[...h.elementOrder,d],selectedMotifId:d,selectedCourtId:null,selectedTrackId:null})),e().addToHistory()},removeMotif:n=>{const{[n]:r,...s}=e().motifs;t(i=>({motifs:s,elementOrder:i.elementOrder.filter(a=>a!==n),selectedMotifId:i.selectedMotifId===n?null:i.selectedMotifId})),e().addToHistory()},updateMotifPosition:(n,r)=>{t(s=>({motifs:{...s.motifs,[n]:{...s.motifs[n],position:r}}}))},updateMotifRotation:(n,r)=>{t(s=>({motifs:{...s.motifs,[n]:{...s.motifs[n],rotation:r}}}))},updateMotifScale:(n,r)=>{t(s=>({motifs:{...s.motifs,[n]:{...s.motifs[n],scale:r}}}))},setMotifViewMode:(n,r)=>{const s=e().motifs[n];if(!s)return;const i=r==="blend"?s.blendSvgContent||s.solidSvgContent:s.solidSvgContent||s.blendSvgContent;t(a=>({motifs:{...a.motifs,[n]:{...a.motifs[n],viewMode:r,svgContent:i}}})),e().addToHistory()},duplicateMotif:n=>{const r=e().motifs[n];if(!r)return;const s=`motif-${Date.now()}`,i={...r,id:s,position:{x:r.position.x+500,y:r.position.y+500}};t(a=>({motifs:{...a.motifs,[s]:i},elementOrder:[...a.elementOrder,s],selectedMotifId:s,selectedCourtId:null,selectedTrackId:null})),e().addToHistory()},refreshMotif:async n=>{const r=e().motifs[n];if(!r)return{success:!1,error:"Motif not found"};try{const{fetchMotifFromDesign:s}=await _E(async()=>{const{fetchMotifFromDesign:c}=await Promise.resolve().then(()=>U5);return{fetchMotifFromDesign:c}},void 0),i=await s(r.sourceDesignId),l=(r.viewMode||"solid")==="blend"?i.blendSvgContent||i.solidSvgContent:i.solidSvgContent||i.blendSvgContent;return t(c=>({motifs:{...c.motifs,[n]:{...c.motifs[n],solidSvgContent:i.solidSvgContent,blendSvgContent:i.blendSvgContent,hasBothVersions:i.hasBothVersions,svgContent:l,sourceThumbnailUrl:i.sourceThumbnailUrl,sourceDesignName:i.sourceDesignName,originalWidth_mm:i.originalWidth_mm,originalHeight_mm:i.originalHeight_mm}},lastModified:Date.now()})),e().addToHistory(),{success:!0}}catch(s){return console.error("[MOTIF] Failed to refresh:",s),{success:!1,error:s.message}}},selectMotif:n=>{const{propertiesPanelUserClosed:r}=e();t(r?{selectedMotifId:n,selectedCourtId:null,selectedTrackId:null,selectedShapeId:null,selectedTextId:null,selectedExclusionZoneId:null,editingTextId:null}:{selectedMotifId:n,selectedCourtId:null,selectedTrackId:null,selectedShapeId:null,selectedTextId:null,selectedExclusionZoneId:null,editingTextId:null,showPropertiesPanel:!0})},deselectMotif:()=>{t({selectedMotifId:null,showPropertiesPanel:!1,propertiesPanelUserClosed:!0})},addShape:(n="rectangle")=>{const r=`shape-${Date.now()}`,s=e().surface,i=e().shapes,a={rectangle:{sides:4,aspectLocked:!1,width:3e3,height:2e3},square:{sides:4,aspectLocked:!0,width:2e3,height:2e3},circle:{sides:32,aspectLocked:!0,width:2e3,height:2e3},triangle:{sides:3,aspectLocked:!0,width:2e3,height:2e3},pentagon:{sides:5,aspectLocked:!0,width:2e3,height:2e3},hexagon:{sides:6,aspectLocked:!0,width:2e3,height:2e3},polygon:{sides:6,aspectLocked:!0,width:2e3,height:2e3},star:{sides:5,aspectLocked:!0,width:2e3,height:2e3,starMode:!0,innerRadius:.5}},l=[{tpv_code:"RH20",hex:"#0075BC",name:"Standard Blue"},{tpv_code:"RH50",hex:"#F15B32",name:"Orange"},{tpv_code:"RH10",hex:"#609B63",name:"Standard Green"},{tpv_code:"RH21",hex:"#493D8C",name:"Purple"},{tpv_code:"RH41",hex:"#FFD833",name:"Bright Yellow"},{tpv_code:"RH26",hex:"#00A6A3",name:"Turquoise"},{tpv_code:"RH02",hex:"#E21F2F",name:"Bright Red"},{tpv_code:"RH90",hex:"#E8457E",name:"Funky Pink"}],c=Object.keys(i).length,d=l[c%l.length];if(n==="blob"){const h=Math.floor(Math.random()*1e5),f="organic",m=qu(f,h),g={id:r,type:"shape",shapeType:"blob",blobStyle:f,seed:h,controlPoints:m,editPointsVisible:!1,numPoints:m.length,blobiness:.2,symmetryMode:"none",radialSymmetryCount:4,width_mm:2e3,height_mm:2e3,position:{x:s.width_mm/2-1e3,y:s.length_mm/2-1e3},rotation:0,fillColor:d,strokeEnabled:!1,strokeColor:null,strokeWidth_mm:50,aspectLocked:!1,locked:!1,visible:!0};t(v=>({shapes:{...v.shapes,[r]:g},elementOrder:[...v.elementOrder,r],selectedShapeId:r,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null})),e().addToHistory();return}const u=a[n]||a.rectangle,p={id:r,type:"shape",shapeType:"polygon",sides:u.sides,width_mm:u.width,height_mm:u.height,cornerRadius:0,starMode:u.starMode||!1,innerRadius:u.innerRadius||.5,position:{x:s.width_mm/2-u.width/2,y:s.length_mm/2-u.height/2},rotation:0,fillColor:d,strokeEnabled:!1,strokeColor:null,strokeWidth_mm:50,aspectLocked:u.aspectLocked,locked:!1,visible:!0};t(h=>({shapes:{...h.shapes,[r]:p},elementOrder:[...h.elementOrder,r],selectedShapeId:r,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null})),e().addToHistory()},removeShape:n=>{const{[n]:r,...s}=e().shapes;t(i=>({shapes:s,elementOrder:i.elementOrder.filter(a=>a!==n),selectedShapeId:i.selectedShapeId===n?null:i.selectedShapeId})),e().addToHistory()},updateShapePosition:(n,r)=>{t(s=>({shapes:{...s.shapes,[n]:{...s.shapes[n],position:r}}}))},updateShapeDimensions:(n,r,s)=>{t(i=>({shapes:{...i.shapes,[n]:{...i.shapes[n],width_mm:r,height_mm:s}}}))},updateShapeSides:(n,r)=>{t(s=>{const i=s.shapes[n];if(!i)return s;const a=Math.max(3,Math.min(32,r));let l=i.width_mm,c=i.height_mm;if(a!==4){const d=Math.min(i.width_mm,i.height_mm);l=d,c=d}return{shapes:{...s.shapes,[n]:{...i,sides:a,width_mm:l,height_mm:c,aspectLocked:a!==4}}}}),e().addToHistory()},updateShapeCornerRadius:(n,r)=>{t(s=>({shapes:{...s.shapes,[n]:{...s.shapes[n],cornerRadius:Math.max(0,Math.min(100,r))}}})),e().addToHistory()},setShapeStarMode:(n,r)=>{t(s=>{const i=s.shapes[n];return{shapes:{...s.shapes,[n]:{...i,starMode:r,sides:r&&i.sides<3?3:i.sides,innerRadius:i.innerRadius??.5}}}}),e().addToHistory()},setShapeInnerRadius:(n,r)=>{t(s=>({shapes:{...s.shapes,[n]:{...s.shapes[n],innerRadius:Math.max(.1,Math.min(.9,r))}}})),e().addToHistory()},updateShapeRotation:(n,r)=>{t(s=>({shapes:{...s.shapes,[n]:{...s.shapes[n],rotation:r}}}))},setShapeFillColor:(n,r)=>{t(s=>({shapes:{...s.shapes,[n]:{...s.shapes[n],fillColor:r}}})),e().addToHistory()},setShapeStroke:(n,r,s=null,i=50)=>{t(a=>({shapes:{...a.shapes,[n]:{...a.shapes[n],strokeEnabled:r,strokeColor:s,strokeWidth_mm:i}}})),e().addToHistory()},setShapeAspectLock:(n,r)=>{t(s=>{const i=s.shapes[n];return{shapes:{...s.shapes,[n]:{...i,aspectLocked:r}}}}),e().addToHistory()},updateBlobPoints:(n,r)=>{t(s=>{const i=s.shapes[n];if(!i||i.shapeType!=="blob")return s;const a=$0(r,i.blobiness,i.seed);return{shapes:{...s.shapes,[n]:{...i,numPoints:r,controlPoints:a}}}}),e().addToHistory()},updateBlobiness:(n,r)=>{t(s=>{const i=s.shapes[n];if(!i||i.shapeType!=="blob")return s;const a=$0(i.numPoints,r,i.seed);return{shapes:{...s.shapes,[n]:{...i,blobiness:r,controlPoints:a}}}}),e().addToHistory()},randomizeBlob:n=>{t(r=>{const s=r.shapes[n];if(!s||s.shapeType!=="blob")return r;const i=Math.floor(Math.random()*1e5),a=s.blobStyle||"organic",l=qu(a,i);return{shapes:{...r.shapes,[n]:{...s,seed:i,controlPoints:l,numPoints:l.length}}}}),e().addToHistory()},setBlobStyle:(n,r)=>{t(s=>{const i=s.shapes[n];if(!i||i.shapeType!=="blob")return s;const a=qu(r,i.seed);return{shapes:{...s.shapes,[n]:{...i,blobStyle:r,controlPoints:a,numPoints:a.length}}}}),e().addToHistory()},setEditPointsVisible:(n,r)=>{t(s=>{const i=s.shapes[n];return!i||i.shapeType!=="blob"&&i.shapeType!=="path"?s:{shapes:{...s.shapes,[n]:{...i,editPointsVisible:r}}}})},resetBlob:n=>{t(r=>{const s=r.shapes[n];if(!s||s.shapeType!=="blob")return r;const i=OE();return{shapes:{...r.shapes,[n]:{...s,blobiness:0,controlPoints:i}}}}),e().addToHistory()},updateBlobControlPoint:(n,r,s,i)=>{t(a=>{const l=a.shapes[n];if(!l||l.shapeType!=="blob"||!l.controlPoints)return a;const c=Math.max(0,Math.min(1,s)),d=Math.max(0,Math.min(1,i)),u=$E(l.controlPoints,r,c,d,l.symmetryMode||"none",l.radialSymmetryCount||4);return{shapes:{...a.shapes,[n]:{...l,controlPoints:u}}}})},updateBlobHandle:(n,r,s,i,a)=>{t(l=>{const c=l.shapes[n];if(!c||c.shapeType!=="blob"||!c.controlPoints)return l;const d=LE(c.controlPoints,r,s,i,a,c.symmetryMode||"none",c.radialSymmetryCount||4);return{shapes:{...l.shapes,[n]:{...c,controlPoints:d}}}})},commitBlobEdit:()=>{e().addToHistory()},setBlobSymmetry:(n,r,s=4)=>{t(i=>{const a=i.shapes[n];return!a||a.shapeType!=="blob"?i:{shapes:{...i.shapes,[n]:{...a,symmetryMode:r,radialSymmetryCount:s}}}}),e().addToHistory()},applyBlobPreset:(n,r)=>{const s=BLOB_PRESETS[r];!s||!s.controlPoints||(t(i=>{const a=i.shapes[n];return!a||a.shapeType!=="blob"?i:{shapes:{...i.shapes,[n]:{...a,numPoints:s.controlPoints.length,blobiness:0,controlPoints:JSON.parse(JSON.stringify(s.controlPoints))}}}}),e().addToHistory())},duplicateShape:n=>{const r=e().shapes[n];if(!r)return;const s=`shape-${Date.now()}`,i={...r,id:s,position:{x:r.position.x+500,y:r.position.y+500}};t(a=>({shapes:{...a.shapes,[s]:i},elementOrder:[...a.elementOrder,s],selectedShapeId:s,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null})),e().addToHistory()},selectShape:n=>{const{propertiesPanelUserClosed:r}=e();t(r?{selectedShapeId:n,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedTextId:null,selectedExclusionZoneId:null,editingTextId:null}:{selectedShapeId:n,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedTextId:null,selectedExclusionZoneId:null,editingTextId:null,showPropertiesPanel:!0})},deselectShape:()=>{t({selectedShapeId:null,showPropertiesPanel:!1,propertiesPanelUserClosed:!0})},startPathDrawing:()=>{const n=`shape-path-${Date.now()}`,r=e().surface,s=e().shapes,i=[{tpv_code:"RH20",hex:"#0075BC",name:"Standard Blue"},{tpv_code:"RH50",hex:"#F15B32",name:"Orange"},{tpv_code:"RH10",hex:"#609B63",name:"Standard Green"},{tpv_code:"RH21",hex:"#493D8C",name:"Purple"}],a=Object.keys(s).length,l=i[a%i.length],c={id:n,type:"shape",shapeType:"path",controlPoints:[],closed:!0,smooth:!1,editPointsVisible:!1,width_mm:r.width_mm,height_mm:r.length_mm,position:{x:0,y:0},rotation:0,fillColor:l,strokeEnabled:!0,strokeColor:{tpv_code:"RH70",hex:"#A8A9AD",name:"Light Grey"},strokeWidth_mm:20,aspectLocked:!1,locked:!1,visible:!0};t({pathDrawingMode:!0,activePathId:n,shapes:{...e().shapes,[n]:c},elementOrder:[...e().elementOrder,n],selectedShapeId:n,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedTextId:null})},addPointToPath:(n,r)=>{const{activePathId:s,shapes:i,pathDrawingMode:a}=e();if(!a||!s)return;const l=i[s];if(!l||l.shapeType!=="path")return;const c={x:n,y:r,handleIn:{x:0,y:0},handleOut:{x:0,y:0}};t({shapes:{...i,[s]:{...l,controlPoints:[...l.controlPoints,c]}}})},finishPath:()=>{const{activePathId:n,shapes:r,pathDrawingMode:s}=e();if(!s||!n)return;const i=r[n];if(!i)return;if(i.controlPoints.length<3){e().cancelPath();return}const a=i.controlPoints;let l=1/0,c=1/0,d=-1/0,u=-1/0;for(const w of a)l=Math.min(l,w.x),c=Math.min(c,w.y),d=Math.max(d,w.x),u=Math.max(u,w.y);const p=d-l||1,h=u-c||1,f=.05,m=a.map(w=>({...w,x:f+(w.x-l)/p*(1-2*f),y:f+(w.y-c)/h*(1-2*f)})),g=e().surface,v=p*g.width_mm,x=h*g.length_mm,y=l*g.width_mm,b=c*g.length_mm;t({pathDrawingMode:!1,activePathId:null,shapes:{...r,[n]:{...i,controlPoints:m,width_mm:Math.max(500,v),height_mm:Math.max(500,x),position:{x:y,y:b},strokeEnabled:!1}}}),e().addToHistory()},cancelPath:()=>{const{activePathId:n,shapes:r,elementOrder:s}=e();if(!n){t({pathDrawingMode:!1});return}const i={...r};delete i[n],t({pathDrawingMode:!1,activePathId:null,shapes:i,elementOrder:s.filter(a=>a!==n),selectedShapeId:null})},setPathClosed:(n,r)=>{const s=e().shapes[n];!s||s.shapeType!=="path"||(t({shapes:{...e().shapes,[n]:{...s,closed:r}}}),e().addToHistory())},setPathSmooth:(n,r)=>{const s=e().shapes[n];if(!s||s.shapeType!=="path")return;let i=s.controlPoints;r&&s.controlPoints.length>=2?i=Xu(s.controlPoints,s.closed,.3):i=s.controlPoints.map(a=>({...a,handleIn:{x:0,y:0},handleOut:{x:0,y:0}})),t({shapes:{...e().shapes,[n]:{...s,smooth:r,controlPoints:i}}}),e().addToHistory()},updatePathControlPoint:(n,r,s,i)=>{const a=e().shapes[n];if(!a||a.shapeType!=="path")return;const l=[...a.controlPoints];l[r]={...l[r],x:s,y:i},t({shapes:{...e().shapes,[n]:{...a,controlPoints:l}}})},updatePathHandle:(n,r,s,i,a)=>{const l=e().shapes[n];if(!l||l.shapeType!=="path")return;const c=[...l.controlPoints];c[r]={...c[r],[s]:{x:i,y:a}},t({shapes:{...e().shapes,[n]:{...l,controlPoints:c}}})},addPointToExistingPath:(n,r,s,i)=>{const a=e().shapes[n];if(!a||a.shapeType!=="path")return;const l=DE(a.controlPoints,r,s,i),c=a.smooth?Xu(l,a.closed,.3):l;t({shapes:{...e().shapes,[n]:{...a,controlPoints:c}}}),e().addToHistory()},removePointFromPath:(n,r)=>{const s=e().shapes[n];if(!s||s.shapeType!=="path")return;const i=s.closed?3:2,a=IE(s.controlPoints,r,i);if(!a){console.log("[STORE] Cannot remove point - minimum reached");return}const l=s.smooth?Xu(a,s.closed,.3):a;t({shapes:{...e().shapes,[n]:{...s,controlPoints:l}}}),e().addToHistory()},commitPathEdit:()=>{e().addToHistory()},addText:()=>{const{surface:n}=e(),r=`text-${Date.now()}`,s={id:r,type:"text",content:"",fontFamily:"Open Sans, sans-serif",fontSize_mm:500,fontWeight:"normal",fontStyle:"normal",textAlign:"left",position:{x:n.width_mm/2,y:n.length_mm/2},rotation:0,fillColor:{tpv_code:"RH70",hex:"#1C1C1C",name:"Black"},strokeColor:null,strokeWidth_mm:0,locked:!1,visible:!0,customName:null};t(i=>({texts:{...i.texts,[r]:s},elementOrder:[...i.elementOrder,r],selectedTextId:r,editingTextId:r,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null})),e().addToHistory()},removeText:n=>{t(r=>{const{[n]:s,...i}=r.texts;return{texts:i,elementOrder:r.elementOrder.filter(a=>a!==n),selectedTextId:r.selectedTextId===n?null:r.selectedTextId,editingTextId:r.editingTextId===n?null:r.editingTextId}}),e().addToHistory()},selectText:n=>{const{propertiesPanelUserClosed:r}=e();t(r?{selectedTextId:n,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null,selectedExclusionZoneId:null}:{selectedTextId:n,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null,selectedExclusionZoneId:null,showPropertiesPanel:!0})},deselectText:()=>{t({selectedTextId:null,editingTextId:null,showPropertiesPanel:!1,propertiesPanelUserClosed:!0})},startEditingText:n=>{t({editingTextId:n})},stopEditingText:()=>{t({editingTextId:null}),e().addToHistory()},updateTextContent:(n,r)=>{t(s=>({texts:{...s.texts,[n]:{...s.texts[n],content:r}}}))},updateTextPosition:(n,r)=>{t(s=>({texts:{...s.texts,[n]:{...s.texts[n],position:r}}}))},updateTextFontSize:(n,r)=>{t(s=>({texts:{...s.texts,[n]:{...s.texts[n],fontSize_mm:Math.max(50,r)}}})),e().addToHistory()},updateTextFont:(n,r,s,i)=>{t(a=>({texts:{...a.texts,[n]:{...a.texts[n],fontFamily:r,fontWeight:s,fontStyle:i}}})),e().addToHistory()},updateTextAlign:(n,r)=>{t(s=>({texts:{...s.texts,[n]:{...s.texts[n],textAlign:r}}})),e().addToHistory()},updateTextRotation:(n,r)=>{t(s=>({texts:{...s.texts,[n]:{...s.texts[n],rotation:r}}}))},setTextFillColor:(n,r)=>{t(s=>({texts:{...s.texts,[n]:{...s.texts[n],fillColor:r}}})),e().addToHistory()},setTextStrokeColor:(n,r)=>{t(s=>({texts:{...s.texts,[n]:{...s.texts[n],strokeColor:r}}})),e().addToHistory()},updateTextStrokeWidth:(n,r)=>{t(s=>({texts:{...s.texts,[n]:{...s.texts[n],strokeWidth_mm:r}}}))},duplicateText:n=>{const{texts:r}=e(),s=r[n];if(!s)return;const i=`text-${Date.now()}`,a={...s,id:i,position:{x:s.position.x+500,y:s.position.y+500},customName:s.customName?`${s.customName} (copy)`:null};t(l=>({texts:{...l.texts,[i]:a},elementOrder:[...l.elementOrder,i],selectedTextId:i,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null})),e().addToHistory()},addExclusionZone:(n="rectangle")=>{const r=`exclusion-${Date.now()}`,s=e().surface,i={rectangle:{shapeType:"polygon",sides:4,width:3e3,height:2e3},square:{shapeType:"polygon",sides:4,width:2e3,height:2e3},circle:{shapeType:"polygon",sides:32,width:2e3,height:2e3},"l-shape":{shapeType:"path",width:4e3,height:3e3},custom:{shapeType:"path",width:3e3,height:3e3}},a=i[n]||i.rectangle,l={id:r,type:"exclusion",shapeType:a.shapeType,sides:a.sides||4,width_mm:a.width,height_mm:a.height,position:{x:s.width_mm/2-a.width/2,y:s.length_mm/2-a.height/2},rotation:0,cornerRadius:0,locked:!1,visible:!0,customName:null,controlPoints:a.shapeType==="path"?zE(n):null};t(c=>({exclusionZones:{...c.exclusionZones,[r]:l},selectedExclusionZoneId:r,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null,selectedTextId:null,editingTextId:null})),e().addToHistory()},removeExclusionZone:n=>{const{[n]:r,...s}=e().exclusionZones;t(i=>({exclusionZones:s,selectedExclusionZoneId:i.selectedExclusionZoneId===n?null:i.selectedExclusionZoneId})),e().addToHistory()},updateExclusionZonePosition:(n,r)=>{t(s=>({exclusionZones:{...s.exclusionZones,[n]:{...s.exclusionZones[n],position:r}}}))},updateExclusionZoneDimensions:(n,r,s)=>{t(i=>({exclusionZones:{...i.exclusionZones,[n]:{...i.exclusionZones[n],width_mm:r,height_mm:s}}}))},updateExclusionZoneRotation:(n,r)=>{t(s=>({exclusionZones:{...s.exclusionZones,[n]:{...s.exclusionZones[n],rotation:r}}}))},updateExclusionZoneCornerRadius:(n,r)=>{t(s=>({exclusionZones:{...s.exclusionZones,[n]:{...s.exclusionZones[n],cornerRadius:Math.max(0,Math.min(100,r))}}})),e().addToHistory()},selectExclusionZone:n=>{const{propertiesPanelUserClosed:r}=e();t(r?{selectedExclusionZoneId:n,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null,selectedTextId:null,editingTextId:null}:{selectedExclusionZoneId:n,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null,selectedTextId:null,editingTextId:null,showPropertiesPanel:!0})},deselectExclusionZone:()=>{t({selectedExclusionZoneId:null,showPropertiesPanel:!1,propertiesPanelUserClosed:!0})},duplicateExclusionZone:n=>{const r=e().exclusionZones[n];if(!r)return;const s=`exclusion-${Date.now()}`,i={...r,id:s,position:{x:r.position.x+500,y:r.position.y+500},customName:r.customName?`${r.customName} (copy)`:null};t(a=>({exclusionZones:{...a.exclusionZones,[s]:i},selectedExclusionZoneId:s,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null,selectedTextId:null})),e().addToHistory()},calculateGroupBounds:n=>{const r=e();let s=1/0,i=1/0,a=-1/0,l=-1/0;for(const c of n)if(c.startsWith("shape-")){const d=r.shapes[c];if(d){const u=d.position.x,p=d.position.y;s=Math.min(s,u),i=Math.min(i,p),a=Math.max(a,u+d.width_mm),l=Math.max(l,p+d.height_mm)}}else if(c.startsWith("text-")){const d=r.texts[c];if(d){const u=d.position.x,p=d.position.y,h=d.width_mm||1e3,f=d.height_mm||500;s=Math.min(s,u),i=Math.min(i,p),a=Math.max(a,u+h),l=Math.max(l,p+f)}}return s===1/0?{x:0,y:0,width:0,height:0}:{x:s,y:i,width:a-s,height:l-i}},createGroup:(n,r={})=>{if(!n||n.length<2)return null;const s=`group-${Date.now()}`,i=e().calculateGroupBounds(n),a={id:s,type:"group",childIds:[...n],compoundType:r.compoundType||null,generatorSeed:r.generatorSeed||null,customName:r.customName||null,locked:!1,visible:!0,bounds:i};return t(l=>{const c=Math.min(...n.map(u=>l.elementOrder.indexOf(u)).filter(u=>u>=0)),d=l.elementOrder.filter(u=>!n.includes(u));return d.splice(c,0,s),{groups:{...l.groups,[s]:a},elementOrder:d,selectedGroupId:s,selectedShapeId:null,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedTextId:null,selectedExclusionZoneId:null,selectedElementIds:[]}}),e().addToHistory(),s},ungroup:n=>{const r=e().groups[n];r&&(t(s=>{const i=s.elementOrder.indexOf(n),a=s.elementOrder.filter(d=>d!==n);a.splice(i,0,...r.childIds);const{[n]:l,...c}=s.groups;return{groups:c,elementOrder:a,selectedGroupId:null,selectedElementIds:[...r.childIds]}}),e().addToHistory())},selectGroup:n=>{const{propertiesPanelUserClosed:r}=e();t({selectedGroupId:n,selectedShapeId:null,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedTextId:null,selectedExclusionZoneId:null,editingTextId:null,editingGroupId:null,selectedElementIds:[],showPropertiesPanel:!r})},deselectGroup:()=>{t({selectedGroupId:null,editingGroupId:null,showPropertiesPanel:!1,propertiesPanelUserClosed:!0})},enterGroup:n=>{t({editingGroupId:n,selectedGroupId:null})},exitGroup:()=>{const n=e().editingGroupId;n&&t({editingGroupId:null,selectedGroupId:n,selectedShapeId:null})},updateGroupPosition:(n,r,s)=>{const i=e().groups[n];i&&t(a=>{const l={...a.shapes},c={...a.texts};for(const u of i.childIds)u.startsWith("shape-")&&l[u]?l[u]={...l[u],position:{x:l[u].position.x+r,y:l[u].position.y+s}}:u.startsWith("text-")&&c[u]&&(c[u]={...c[u],position:{x:c[u].position.x+r,y:c[u].position.y+s}});const d={...i.bounds,x:i.bounds.x+r,y:i.bounds.y+s};return{shapes:l,texts:c,groups:{...a.groups,[n]:{...i,bounds:d}}}})},commitGroupMove:()=>{e().addToHistory()},updateGroupScale:(n,r,s,i)=>{const a=e().groups[n];a&&t(l=>{const c={...l.shapes},d={...l.texts};for(const p of a.childIds)if(p.startsWith("shape-")){const h=c[p];if(h){const f=h.position.x-i.x,m=h.position.y-i.y;c[p]={...h,position:{x:i.x+f*r,y:i.y+m*s},width_mm:h.width_mm*r,height_mm:h.height_mm*s}}}else if(p.startsWith("text-")){const h=d[p];if(h){const f=h.position.x-i.x,m=h.position.y-i.y;d[p]={...h,position:{x:i.x+f*r,y:i.y+m*s},width_mm:(h.width_mm||1e3)*r,height_mm:(h.height_mm||500)*s,fontSize:(h.fontSize||200)*Math.min(r,s)}}}const u=e().calculateGroupBounds(a.childIds);return{shapes:c,texts:d,groups:{...l.groups,[n]:{...a,bounds:u}}}})},addToSelection:n=>{t(r=>r.selectedElementIds.includes(n)?{selectedElementIds:r.selectedElementIds.filter(s=>s!==n)}:{selectedElementIds:[...r.selectedElementIds,n],selectedShapeId:null,selectedGroupId:null,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedTextId:null,selectedExclusionZoneId:null})},clearMultiSelection:()=>{t({selectedElementIds:[]})},groupSelected:()=>{const{selectedElementIds:n}=e();n.length<2||e().createGroup(n)},alignElements:n=>{const{selectedElementIds:r,shapes:s,texts:i}=e();if(r.length<2)return;const a=r.map(m=>{const g=s[m];if(g)return{id:m,type:"shape",x:g.position.x,y:g.position.y,width:g.width_mm||0,height:g.height_mm||0};const v=i[m];return v?{id:m,type:"text",x:v.position.x,y:v.position.y,width:v.width||100,height:v.height||50}:null}).filter(Boolean);if(a.length<2)return;const l=Math.min(...a.map(m=>m.x)),c=Math.max(...a.map(m=>m.x+m.width)),d=Math.min(...a.map(m=>m.y)),u=Math.max(...a.map(m=>m.y+m.height)),p=(l+c)/2,h=(d+u)/2,f={};for(const m of a){let g=m.x,v=m.y;switch(n){case"left":g=l;break;case"center":g=p-m.width/2;break;case"right":g=c-m.width;break;case"top":v=d;break;case"middle":v=h-m.height/2;break;case"bottom":v=u-m.height;break}(g!==m.x||v!==m.y)&&(f[m.id]={x:g,y:v,type:m.type})}t(m=>{const g={...m.shapes},v={...m.texts};for(const[x,y]of Object.entries(f))y.type==="shape"&&g[x]?g[x]={...g[x],position:{x:y.x,y:y.y}}:y.type==="text"&&v[x]&&(v[x]={...v[x],position:{x:y.x,y:y.y}});return{shapes:g,texts:v}}),e().addToHistory()},distributeElements:n=>{const{selectedElementIds:r,shapes:s,texts:i}=e();if(r.length<3)return;const a=r.map(v=>{const x=s[v];if(x)return{id:v,type:"shape",x:x.position.x,y:x.position.y,width:x.width_mm||0,height:x.height_mm||0};const y=i[v];return y?{id:v,type:"text",x:y.position.x,y:y.position.y,width:y.width||100,height:y.height||50}:null}).filter(Boolean);if(a.length<3)return;const l=[...a].sort((v,x)=>n==="horizontal"?v.x-x.x:v.y-x.y),c=l[0],d=l[l.length-1],u=l.length;let p,h;n==="horizontal"?(p=d.x+d.width-c.x,h=l.reduce((v,x)=>v+x.width,0)):(p=d.y+d.height-c.y,h=l.reduce((v,x)=>v+x.height,0));const f=(p-h)/(u-1),m={};let g=n==="horizontal"?c.x:c.y;for(const v of l){let x=v.x,y=v.y;n==="horizontal"?(x=g,g+=v.width+f):(y=g,g+=v.height+f),(x!==v.x||y!==v.y)&&(m[v.id]={x,y,type:v.type})}t(v=>{const x={...v.shapes},y={...v.texts};for(const[b,w]of Object.entries(m))w.type==="shape"&&x[b]?x[b]={...x[b],position:{x:w.x,y:w.y}}:w.type==="text"&&y[b]&&(y[b]={...y[b],position:{x:w.x,y:w.y}});return{shapes:x,texts:y}}),e().addToHistory()},copySelection:()=>{const{selectedElementIds:n,selectedGroupId:r,groups:s,shapes:i,texts:a}=e();if(r){const d=s[r];if(!d)return;const u=d.childIds.map(p=>i[p]?{type:"shape",data:JSON.parse(JSON.stringify(i[p]))}:a[p]?{type:"text",data:JSON.parse(JSON.stringify(a[p]))}:null).filter(Boolean);t({clipboard:{type:"group",groupData:JSON.parse(JSON.stringify(d)),children:u}});return}if(n.length>0){const d=n.map(u=>i[u]?{type:"shape",data:JSON.parse(JSON.stringify(i[u]))}:a[u]?{type:"text",data:JSON.parse(JSON.stringify(a[u]))}:null).filter(Boolean);t({clipboard:{type:"elements",data:d}});return}const{selectedShapeId:l,selectedTextId:c}=e();l&&i[l]?t({clipboard:{type:"elements",data:[{type:"shape",data:JSON.parse(JSON.stringify(i[l]))}]}}):c&&a[c]&&t({clipboard:{type:"elements",data:[{type:"text",data:JSON.parse(JSON.stringify(a[c]))}]}})},pasteClipboard:()=>{const{clipboard:n}=e();if(!n)return;const r=500;if(n.type==="group"){const s=`group-${Date.now()}`,i=[],a=Date.now();t(l=>{const c={...l.shapes},d={...l.texts};let u=[...l.elementOrder];n.children.forEach((h,f)=>{const m=`${h.type}-${a}-${f}`;i.push(m),h.type==="shape"?c[m]={...h.data,id:m,position:{x:h.data.position.x+r,y:h.data.position.y+r}}:h.type==="text"&&(d[m]={...h.data,id:m,position:{x:h.data.position.x+r,y:h.data.position.y+r}})});const p={...n.groupData,id:s,childIds:i,customName:n.groupData.customName?`${n.groupData.customName} (copy)`:"Group (copy)",bounds:{...n.groupData.bounds,x:n.groupData.bounds.x+r,y:n.groupData.bounds.y+r}};return u.push(s),{shapes:c,texts:d,groups:{...l.groups,[s]:p},elementOrder:u,selectedGroupId:s,selectedShapeId:null,selectedTextId:null,selectedElementIds:[]}})}else{const s=Date.now(),i=[];t(a=>{const l={...a.shapes},c={...a.texts};let d=[...a.elementOrder];return n.data.forEach((u,p)=>{const h=`${u.type}-${s}-${p}`;i.push(h),u.type==="shape"?(l[h]={...u.data,id:h,position:{x:u.data.position.x+r,y:u.data.position.y+r}},d.push(h)):u.type==="text"&&(c[h]={...u.data,id:h,position:{x:u.data.position.x+r,y:u.data.position.y+r}},d.push(h))}),{shapes:l,texts:c,elementOrder:d,selectedElementIds:i.length>1?i:[],selectedShapeId:i.length===1&&n.data[0].type==="shape"?i[0]:null,selectedTextId:i.length===1&&n.data[0].type==="text"?i[0]:null,selectedGroupId:null}})}e().addToHistory()},removeGroup:n=>{e().ungroup(n)},deleteGroupWithChildren:n=>{const r=e().groups[n];r&&(t(s=>{const i={...s.shapes};for(const d of r.childIds)delete i[d];const{[n]:a,...l}=s.groups,c=s.elementOrder.filter(d=>d!==n&&!r.childIds.includes(d));return{shapes:i,groups:l,elementOrder:c,selectedGroupId:null,selectedShapeId:null}}),e().addToHistory())},refreshGroupBounds:n=>{const r=e().groups[n];if(!r)return;const s=e().calculateGroupBounds(r.childIds);t(i=>({groups:{...i.groups,[n]:{...r,bounds:s}}}))},addCustomMarking:n=>{t(r=>({customMarkings:[...r.customMarkings,{...n,id:`custom-${Date.now()}`}]})),e().addToHistory()},removeCustomMarking:n=>{t(r=>({customMarkings:r.customMarkings.filter(s=>s.id!==n)})),e().addToHistory()},addBackgroundZone:n=>{t(r=>({backgroundZones:[...r.backgroundZones,{...n,id:`zone-${Date.now()}`}]})),e().addToHistory()},removeBackgroundZone:n=>{t(r=>({backgroundZones:r.backgroundZones.filter(s=>s.id!==n)})),e().addToHistory()},setDesignName:n=>{t({designName:n})},setDesignDescription:n=>{t({designDescription:n})},setDesignTags:n=>{t({designTags:n})},addToHistory:()=>{const n=e(),r={surface:n.surface,courts:n.courts,tracks:n.tracks,motifs:n.motifs,shapes:n.shapes,texts:n.texts,exclusionZones:n.exclusionZones,elementOrder:n.elementOrder,customMarkings:n.customMarkings,backgroundZones:n.backgroundZones};t(s=>{const i=s.history.slice(0,s.historyIndex+1);return i.push(r),i.length>s.maxHistory&&i.shift(),{history:i,historyIndex:i.length-1}})},undo:()=>{const{history:n,historyIndex:r}=e();if(r>0){const s=n[r-1];t({...s,historyIndex:r-1})}},redo:()=>{const{history:n,historyIndex:r}=e();if(r<n.length-1){const s=n[r+1];t({...s,historyIndex:r+1})}},canUndo:()=>e().historyIndex>0,canRedo:()=>e().historyIndex<e().history.length-1,toggleCourtLibrary:()=>{t(n=>({showCourtLibrary:!n.showCourtLibrary}))},togglePropertiesPanel:()=>{t(n=>({showPropertiesPanel:!n.showPropertiesPanel,propertiesPanelUserClosed:!!n.showPropertiesPanel}))},setMobileLibraryOpen:n=>t({mobileLibraryOpen:n}),setMobilePropertiesOpen:n=>t({mobilePropertiesOpen:n}),setMobileColoursOpen:n=>t({mobileColoursOpen:n}),setMobileActiveTab:n=>t({mobileActiveTab:n}),closeMobileSheets:()=>t({mobileLibraryOpen:!1,mobilePropertiesOpen:!1,mobileColoursOpen:!1}),toggleColorEditor:()=>{t(n=>({showColorEditor:!n.showColorEditor}))},toggleSnapToGrid:()=>{t(n=>({snapToGrid:!n.snapToGrid}))},setGridSize:n=>{t({gridSize_mm:n})},toggleStandaloneMode:()=>{t(n=>({standaloneMode:!n.standaloneMode}))},setStandaloneMode:(n,r=null)=>{t({standaloneMode:n,standaloneDesignId:r})},setSaving:n=>{t({isSaving:n})},setLastSaved:n=>{t({lastSaved:n})},loadDesign:n=>{let r=n.elementOrder;!r&&(n.courtOrder||n.trackOrder)&&(r=[...n.trackOrder||[],...n.courtOrder||[]]),t({surface:n.surface||Ku.surface,courts:n.courts||{},tracks:n.tracks||{},motifs:n.motifs||{},shapes:n.shapes||{},texts:n.texts||{},exclusionZones:n.exclusionZones||{},groups:n.groups||{},elementOrder:r||[],customMarkings:n.customMarkings||[],backgroundZones:n.backgroundZones||[],designName:n.name||"Untitled Design",designDescription:n.description||"",designTags:n.tags||[],selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null,selectedTextId:null,selectedExclusionZoneId:null,selectedGroupId:null,editingGroupId:null,editingTextId:null,history:[],historyIndex:-1}),e().addToHistory()},exportDesignData:()=>{const n=e();return{surface:n.surface,courts:n.courts,tracks:n.tracks,motifs:n.motifs,shapes:n.shapes,texts:n.texts,exclusionZones:n.exclusionZones,groups:n.groups,elementOrder:n.elementOrder,customMarkings:n.customMarkings,backgroundZones:n.backgroundZones,name:n.designName,description:n.designDescription,tags:n.designTags}},resetDesign:()=>{t(Ku)},hasUnsavedChanges:()=>{const n=e();return Object.keys(n.courts).length>0||Object.keys(n.tracks).length>0||Object.keys(n.motifs).length>0||Object.keys(n.shapes).length>0||Object.keys(n.texts).length>0||Object.keys(n.exclusionZones).length>0}}),{name:"SportsDesignStore"})),D0={inputMode:"prompt",prompt:"",lengthMM:5e3,widthMM:5e3,selectedFileName:null,uploadedFileUrl:null,arMapping:null,result:null,jobId:null,blendRecipes:null,blendSvgUrl:null,colorMapping:null,blendEditedColors:new Map,solidRecipes:null,solidSvgUrl:null,solidColorMapping:null,solidEditedColors:new Map,viewMode:"solid",showFinalRecipes:!1,showSolidSummary:!1,regionOverrides:new Map,originalTaggedSvg:null,regionOverridesHistory:[new Map],historyIndex:0,designName:"",currentDesignId:null,hasGeneratedContent:!1,lastModified:null},vd=m1(g1((t,e)=>({...D0,setInputMode:n=>t({inputMode:n}),setPrompt:n=>t({prompt:n,lastModified:Date.now()}),setDimensions:(n,r)=>t({widthMM:n,lengthMM:r,lastModified:Date.now()}),setArMapping:n=>t({arMapping:n}),setSelectedFile:(n,r)=>t({selectedFileName:n,uploadedFileUrl:r,lastModified:Date.now()}),clearSelectedFile:()=>t({selectedFileName:null,uploadedFileUrl:null}),setGenerationResult:(n,r)=>t({result:n,jobId:r,hasGeneratedContent:!0,lastModified:Date.now()}),setResult:n=>t({result:n,hasGeneratedContent:!!n,lastModified:Date.now()}),setJobId:n=>t({jobId:n}),setBlendState:(n,r,s)=>t({blendRecipes:n,colorMapping:r,blendSvgUrl:s,lastModified:Date.now()}),setBlendRecipes:n=>t({blendRecipes:n,lastModified:Date.now()}),setColorMapping:n=>t({colorMapping:n,lastModified:Date.now()}),setBlendSvgUrl:n=>t({blendSvgUrl:n}),setBlendEditedColors:n=>t({blendEditedColors:n,lastModified:Date.now()}),updateBlendSvgUrl:n=>t({blendSvgUrl:n}),setSolidState:(n,r,s)=>t({solidRecipes:n,solidColorMapping:r,solidSvgUrl:s,lastModified:Date.now()}),setSolidRecipes:n=>t({solidRecipes:n,lastModified:Date.now()}),setSolidColorMapping:n=>t({solidColorMapping:n,lastModified:Date.now()}),setSolidSvgUrl:n=>t({solidSvgUrl:n}),setSolidEditedColors:n=>t({solidEditedColors:n,lastModified:Date.now()}),updateSolidSvgUrl:n=>t({solidSvgUrl:n}),setViewMode:n=>{if(n==="blend"){console.log("[STORE] Blend mode disabled - forcing solid mode");return}t({viewMode:n})},setShowFinalRecipes:n=>t({showFinalRecipes:n}),setShowSolidSummary:n=>t({showSolidSummary:n}),setOriginalTaggedSvg:n=>t({originalTaggedSvg:n}),setRegionOverrides:n=>t({regionOverrides:n,lastModified:Date.now()}),addRegionOverride:(n,r)=>{const s=new Map(e().regionOverrides),i=typeof r=="string"?{hex:r}:r;s.set(n,i);const a=e().regionOverridesHistory,l=e().historyIndex,c=a.slice(0,l+1);c.push(new Map(s)),c.length>50&&c.shift(),t({regionOverrides:s,regionOverridesHistory:c,historyIndex:c.length-1,lastModified:Date.now()})},setRegionOverridesHistory:n=>{t(typeof n=="function"?{regionOverridesHistory:n(e().regionOverridesHistory)}:{regionOverridesHistory:n})},setHistoryIndex:n=>{t(typeof n=="function"?{historyIndex:n(e().historyIndex)}:{historyIndex:n})},canUndo:()=>e().historyIndex>0,canRedo:()=>e().historyIndex<e().regionOverridesHistory.length-1,undo:()=>{const{historyIndex:n,regionOverridesHistory:r}=e();if(n>0){const s=n-1;t({historyIndex:s,regionOverrides:new Map(r[s])})}},redo:()=>{const{historyIndex:n,regionOverridesHistory:r}=e();if(n<r.length-1){const s=n+1;t({historyIndex:s,regionOverrides:new Map(r[s])})}},setRegionOverridesHistory:(n,r)=>t({regionOverridesHistory:n,historyIndex:r}),setDesignName:n=>t({designName:n}),setCurrentDesignId:n=>t({currentDesignId:n}),loadDesign:n=>{const r=n.regionOverrides||new Map,s=r.size>0?[new Map,new Map(r)]:[new Map],i=r.size>0?1:0;t({inputMode:n.inputMode||"prompt",prompt:n.prompt||"",lengthMM:n.lengthMM||5e3,widthMM:n.widthMM||5e3,uploadedFileUrl:n.selectedFile||null,result:n.result||null,blendRecipes:n.blendRecipes||null,solidRecipes:n.solidRecipes||null,colorMapping:n.colorMapping||null,solidColorMapping:n.solidColorMapping||null,solidEditedColors:n.solidEditedColors||new Map,blendEditedColors:n.blendEditedColors||new Map,blendSvgUrl:n.blendSvgUrl||null,solidSvgUrl:n.solidSvgUrl||null,viewMode:"solid",arMapping:n.arMapping||null,jobId:n.jobId||null,showFinalRecipes:n.showFinalRecipes||!1,showSolidSummary:n.showSolidSummary||!1,hasGeneratedContent:!!n.result,regionOverrides:r,originalTaggedSvg:n.originalTaggedSvg||null,regionOverridesHistory:s,historyIndex:i,lastModified:Date.now()})},exportDesignData:()=>{const n=e();return{inputMode:n.inputMode,prompt:n.prompt,lengthMM:n.lengthMM,widthMM:n.widthMM,uploadedFileUrl:n.uploadedFileUrl,result:n.result,blendRecipes:n.blendRecipes,solidRecipes:n.solidRecipes,colorMapping:n.colorMapping,solidColorMapping:n.solidColorMapping,solidEditedColors:n.solidEditedColors,blendEditedColors:n.blendEditedColors,viewMode:n.viewMode,arMapping:n.arMapping,jobId:n.jobId,showFinalRecipes:n.showFinalRecipes,showSolidSummary:n.showSolidSummary,regionOverrides:n.regionOverrides,designName:n.designName,currentDesignId:n.currentDesignId}},resetDesign:()=>{const{blendSvgUrl:n,solidSvgUrl:r}=e();n&&n.startsWith("blob:")&&URL.revokeObjectURL(n),r&&r.startsWith("blob:")&&URL.revokeObjectURL(r),t({...D0,blendEditedColors:new Map,solidEditedColors:new Map,regionOverrides:new Map,regionOverridesHistory:[new Map]})},hasUnsavedChanges:()=>{const n=e();return n.hasGeneratedContent||n.prompt.trim()!==""||n.selectedFileName!==null}}),{name:"PlaygroundDesignStore"})),b1={"basketball-full":{id:"basketball-full",name:"Basketball (Full Court)",sport:"basketball",standard:"FIBA 2020",category:"court",description:"Official FIBA standard full basketball court with all markings",dimensions:{length_mm:28e3,width_mm:15e3,min_surround_mm:2e3},defaultSurfaceColor:"RH20",defaultLineColor:"RH31",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:15e3,height:28e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"center-line",name:"Center Line",type:"line",params:{x1:0,y1:14e3,x2:15e3,y2:14e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-circle",name:"Center Circle",type:"circle",params:{cx:7500,cy:14e3,radius:1800},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"three-point-arc-top",name:"Three-Point Arc (Top)",type:"arc",params:{cx:7500,cy:26425,radius:6750,startAngle:192,endAngle:348},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"three-point-arc-bottom",name:"Three-Point Arc (Bottom)",type:"arc",params:{cx:7500,cy:1575,radius:6750,startAngle:12,endAngle:168},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"three-point-line-bottom-left",name:"Three-Point Line Bottom Left",type:"line",params:{x1:900,y1:0,x2:900,y2:2990},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"three-point-line-bottom-right",name:"Three-Point Line Bottom Right",type:"line",params:{x1:14100,y1:0,x2:14100,y2:2990},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"three-point-line-top-left",name:"Three-Point Line Top Left",type:"line",params:{x1:900,y1:25010,x2:900,y2:28e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"three-point-line-top-right",name:"Three-Point Line Top Right",type:"line",params:{x1:14100,y1:25010,x2:14100,y2:28e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"free-throw-line-top",name:"Free Throw Line (Top)",type:"line",params:{x1:5050,y1:22200,x2:9950,y2:22200},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"free-throw-line-bottom",name:"Free Throw Line (Bottom)",type:"line",params:{x1:5050,y1:5800,x2:9950,y2:5800},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"free-throw-circle-top",name:"Free Throw Circle (Top)",type:"circle",params:{cx:7500,cy:22200,radius:1800},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"free-throw-circle-bottom",name:"Free Throw Circle (Bottom)",type:"circle",params:{cx:7500,cy:5800,radius:1800},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"key-lane-top",name:"Key Lane (Top)",type:"rectangle",params:{x:5050,y:22200,width:4900,height:5800},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"key-lane-bottom",name:"Key Lane (Bottom)",type:"rectangle",params:{x:5050,y:0,width:4900,height:5800},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"restricted-area-top",name:"Restricted Area (Top)",type:"arc",params:{cx:7500,cy:28e3,radius:1250,startAngle:180,endAngle:360},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"restricted-area-bottom",name:"Restricted Area (Bottom)",type:"arc",params:{cx:7500,cy:0,radius:1250,startAngle:0,endAngle:180},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[{id:"key-area-top",name:"Key Area (Top)",type:"rectangle",params:{x:5050,y:22200,width:4900,height:5800},defaultColor:"RH20",paintable:!0,area_m2:28.42},{id:"key-area-bottom",name:"Key Area (Bottom)",type:"rectangle",params:{x:5050,y:0,width:4900,height:5800},defaultColor:"RH20",paintable:!0,area_m2:28.42}]},"netball-full":{id:"netball-full",name:"Netball (Full Court)",sport:"netball",standard:"World Netball 2020",category:"court",description:"Official World Netball standard court with goal circles and thirds",dimensions:{length_mm:30500,width_mm:15250,min_surround_mm:3050},defaultSurfaceColor:"RH01",defaultLineColor:"RH31",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:15250,height:30500},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"transverse-line-1",name:"Transverse Line 1",type:"line",params:{x1:0,y1:10167,x2:15250,y2:10167},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"transverse-line-2",name:"Transverse Line 2",type:"line",params:{x1:0,y1:20333,x2:15250,y2:20333},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-circle",name:"Center Circle",type:"circle",params:{cx:7625,cy:15250,radius:450},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"goal-circle-bottom",name:"Goal Circle (Bottom)",type:"arc",params:{cx:7625,cy:0,radius:4900,startAngle:0,endAngle:180},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"goal-circle-top",name:"Goal Circle (Top)",type:"arc",params:{cx:7625,cy:30500,radius:4900,startAngle:180,endAngle:360},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[]},"tennis-doubles":{id:"tennis-doubles",name:"Tennis (Doubles)",sport:"tennis",standard:"ITF 2020",category:"court",description:"Official ITF standard doubles tennis court with all service boxes",dimensions:{length_mm:23770,width_mm:10970,min_surround_mm:3660},defaultSurfaceColor:"RH22",defaultLineColor:"RH29",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:10970,height:23770},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"singles-sideline-left",name:"Singles Sideline (Left)",type:"line",params:{x1:1370,y1:0,x2:1370,y2:23770},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"singles-sideline-right",name:"Singles Sideline (Right)",type:"line",params:{x1:9600,y1:0,x2:9600,y2:23770},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"service-line-bottom",name:"Service Line (Bottom)",type:"line",params:{x1:0,y1:6400,x2:10970,y2:6400},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"service-line-top",name:"Service Line (Top)",type:"line",params:{x1:0,y1:17370,x2:10970,y2:17370},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-service-line",name:"Center Service Line",type:"line",params:{x1:5485,y1:6400,x2:5485,y2:17370},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-mark-bottom",name:"Center Mark (Bottom)",type:"line",params:{x1:5485,y1:0,x2:5485,y2:100},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-mark-top",name:"Center Mark (Top)",type:"line",params:{x1:5485,y1:23670,x2:5485,y2:23770},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[]},"futsal-standard":{id:"futsal-standard",name:"Futsal (5-a-side)",sport:"futsal",standard:"FIFA 2020",category:"court",description:"Official FIFA standard futsal court for international matches",dimensions:{length_mm:4e4,width_mm:2e4,min_surround_mm:1e3},defaultSurfaceColor:"RH50",defaultLineColor:"RH30",defaultLineWidth_mm:80,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:2e4,height:4e4},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"boundary"},{id:"center-line",name:"Center Line",type:"line",params:{x1:0,y1:2e4,x2:2e4,y2:2e4},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"center-circle",name:"Center Circle",type:"circle",params:{cx:1e4,cy:2e4,radius:3e3},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"center-spot",name:"Center Spot",type:"circle",params:{cx:1e4,cy:2e4,radius:100},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"penalty-area-bottom",name:"Penalty Area (Bottom)",type:"arc",params:{cx:1e4,cy:0,radius:6e3,startAngle:0,endAngle:180},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"penalty-area-top",name:"Penalty Area (Top)",type:"arc",params:{cx:1e4,cy:4e4,radius:6e3,startAngle:180,endAngle:360},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"penalty-mark-bottom",name:"Penalty Mark (Bottom)",type:"circle",params:{cx:1e4,cy:6e3,radius:100},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"penalty-mark-top",name:"Penalty Mark (Top)",type:"circle",params:{cx:1e4,cy:34e3,radius:100},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"second-penalty-mark-bottom",name:"Second Penalty Mark (Bottom)",type:"circle",params:{cx:1e4,cy:1e4,radius:100},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"second-penalty-mark-top",name:"Second Penalty Mark (Top)",type:"circle",params:{cx:1e4,cy:3e4,radius:100},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"corner-arc-bl",name:"Corner Arc (Bottom Left)",type:"arc",params:{cx:0,cy:0,radius:250,startAngle:0,endAngle:90},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"corner-arc-br",name:"Corner Arc (Bottom Right)",type:"arc",params:{cx:2e4,cy:0,radius:250,startAngle:90,endAngle:180},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"corner-arc-tl",name:"Corner Arc (Top Left)",type:"arc",params:{cx:0,cy:4e4,radius:250,startAngle:270,endAngle:360},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"corner-arc-tr",name:"Corner Arc (Top Right)",type:"arc",params:{cx:2e4,cy:4e4,radius:250,startAngle:180,endAngle:270},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"}],zones:[]},"volleyball-indoor":{id:"volleyball-indoor",name:"Volleyball (Indoor)",sport:"volleyball",standard:"FIVB",category:"court",description:"Official FIVB standard indoor volleyball court with attack lines",dimensions:{length_mm:18e3,width_mm:9e3,min_surround_mm:3e3},defaultSurfaceColor:"RH40",defaultLineColor:"RH29",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:9e3,height:18e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"center-line",name:"Center Line",type:"line",params:{x1:0,y1:9e3,x2:9e3,y2:9e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"attack-line-bottom",name:"Attack Line (Bottom)",type:"line",params:{x1:0,y1:6e3,x2:9e3,y2:6e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"attack-line-top",name:"Attack Line (Top)",type:"line",params:{x1:0,y1:12e3,x2:9e3,y2:12e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[]},"badminton-full":{id:"badminton-full",name:"Badminton (Full Court)",sport:"badminton",standard:"BWF",category:"court",description:"Official BWF standard full badminton court with singles and doubles lines",dimensions:{length_mm:13400,width_mm:6100,min_surround_mm:1e3},defaultSurfaceColor:"RH26",defaultLineColor:"RH12",defaultLineWidth_mm:40,markings:[{id:"boundary",name:"Boundary Lines (Doubles)",type:"rectangle",params:{x:0,y:0,width:6100,height:13400},defaultColor:"RH31",lineWidth_mm:40,required:!0,category:"boundary"},{id:"singles-sideline-left",name:"Singles Sideline (Left)",type:"line",params:{x1:460,y1:0,x2:460,y2:13400},defaultColor:"RH31",lineWidth_mm:40,required:!0,category:"court-marking"},{id:"singles-sideline-right",name:"Singles Sideline (Right)",type:"line",params:{x1:5640,y1:0,x2:5640,y2:13400},defaultColor:"RH31",lineWidth_mm:40,required:!0,category:"court-marking"},{id:"short-service-line-bottom",name:"Short Service Line (Bottom)",type:"line",params:{x1:0,y1:1980,x2:6100,y2:1980},defaultColor:"RH31",lineWidth_mm:40,required:!0,category:"court-marking"},{id:"short-service-line-top",name:"Short Service Line (Top)",type:"line",params:{x1:0,y1:11420,x2:6100,y2:11420},defaultColor:"RH31",lineWidth_mm:40,required:!0,category:"court-marking"},{id:"doubles-long-service-line-bottom",name:"Doubles Long Service Line (Bottom)",type:"line",params:{x1:0,y1:760,x2:6100,y2:760},defaultColor:"RH31",lineWidth_mm:40,required:!0,category:"court-marking"},{id:"doubles-long-service-line-top",name:"Doubles Long Service Line (Top)",type:"line",params:{x1:0,y1:12640,x2:6100,y2:12640},defaultColor:"RH31",lineWidth_mm:40,required:!0,category:"court-marking"},{id:"center-service-line",name:"Center Service Line",type:"line",params:{x1:3050,y1:1980,x2:3050,y2:11420},defaultColor:"RH31",lineWidth_mm:40,required:!0,category:"court-marking"}],zones:[]},"pickleball-standard":{id:"pickleball-standard",name:"Pickleball",sport:"pickleball",standard:"USA Pickleball",category:"court",description:"Official USA Pickleball standard court with non-volley zone (kitchen)",dimensions:{length_mm:13410,width_mm:6100,min_surround_mm:1e3},defaultSurfaceColor:"RH11",defaultLineColor:"RH31",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:6100,height:13410},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"non-volley-zone-line-bottom",name:"Non-Volley Zone Line (Bottom)",type:"line",params:{x1:0,y1:2130,x2:6100,y2:2130},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"non-volley-zone-line-top",name:"Non-Volley Zone Line (Top)",type:"line",params:{x1:0,y1:11280,x2:6100,y2:11280},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-line",name:"Center Line (Net)",type:"line",params:{x1:0,y1:6705,x2:6100,y2:6705},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-service-line",name:"Center Service Line",type:"line",params:{x1:3050,y1:0,x2:3050,y2:13410},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[]},"basketball-half":{id:"basketball-half",name:"Basketball (Half Court / 3x3)",sport:"basketball",standard:"FIBA 3x3",category:"court",description:"Half-court basketball for 3x3 games, practice, or space-constrained areas",dimensions:{length_mm:11e3,width_mm:15e3,min_surround_mm:2e3},defaultSurfaceColor:"RH20",defaultLineColor:"RH31",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:15e3,height:11e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"three-point-arc",name:"Three-Point Arc",type:"arc",params:{cx:7500,cy:1575,radius:6750,startAngle:12,endAngle:168},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"three-point-line-left",name:"Three-Point Line (Left)",type:"line",params:{x1:900,y1:0,x2:900,y2:2990},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"three-point-line-right",name:"Three-Point Line (Right)",type:"line",params:{x1:14100,y1:0,x2:14100,y2:2990},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"free-throw-line",name:"Free Throw Line",type:"line",params:{x1:5050,y1:5800,x2:9950,y2:5800},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"free-throw-circle",name:"Free Throw Circle",type:"circle",params:{cx:7500,cy:5800,radius:1800},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"key-lane",name:"Key Lane",type:"rectangle",params:{x:5050,y:0,width:4900,height:5800},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"restricted-area",name:"Restricted Area",type:"arc",params:{cx:7500,cy:0,radius:1250,startAngle:0,endAngle:180},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[{id:"key-area",name:"Key Area",type:"rectangle",params:{x:5050,y:0,width:4900,height:5800},defaultColor:"RH20",paintable:!0,area_m2:28.42}]},"tennis-singles":{id:"tennis-singles",name:"Tennis (Singles)",sport:"tennis",standard:"ITF",category:"court",description:"Singles-only tennis court without doubles alleys",dimensions:{length_mm:23770,width_mm:8230,min_surround_mm:3660},defaultSurfaceColor:"RH22",defaultLineColor:"RH29",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:8230,height:23770},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"service-line-bottom",name:"Service Line (Bottom)",type:"line",params:{x1:0,y1:6400,x2:8230,y2:6400},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"service-line-top",name:"Service Line (Top)",type:"line",params:{x1:0,y1:17370,x2:8230,y2:17370},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-service-line",name:"Center Service Line",type:"line",params:{x1:4115,y1:6400,x2:4115,y2:17370},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-mark-bottom",name:"Center Mark (Bottom)",type:"line",params:{x1:4115,y1:0,x2:4115,y2:100},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-mark-top",name:"Center Mark (Top)",type:"line",params:{x1:4115,y1:23670,x2:4115,y2:23770},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[]},"mini-tennis-red":{id:"mini-tennis-red",name:"Mini Tennis (Red Court)",sport:"tennis",standard:"ITF Play+Stay",category:"court",description:"Beginner/youth court for red stage tennis coaching (36ft)",dimensions:{length_mm:10970,width_mm:5490,min_surround_mm:2e3},defaultSurfaceColor:"RH02",defaultLineColor:"RH29",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:5490,height:10970},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"net-line",name:"Net Line",type:"line",params:{x1:0,y1:5485,x2:5490,y2:5485},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"service-line-bottom",name:"Service Line (Bottom)",type:"line",params:{x1:0,y1:2745,x2:5490,y2:2745},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"service-line-top",name:"Service Line (Top)",type:"line",params:{x1:0,y1:8225,x2:5490,y2:8225},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-service-line",name:"Center Service Line",type:"line",params:{x1:2745,y1:2745,x2:2745,y2:8225},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[]},"padel-standard":{id:"padel-standard",name:"Padel",sport:"padel",standard:"FIP",category:"court",description:"Official FIP padel court with service boxes",dimensions:{length_mm:2e4,width_mm:1e4,min_surround_mm:0},defaultSurfaceColor:"RH60",defaultLineColor:"RH29",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:1e4,height:2e4},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"net-line",name:"Net Line",type:"line",params:{x1:0,y1:1e4,x2:1e4,y2:1e4},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"service-line-bottom",name:"Service Line (Bottom)",type:"line",params:{x1:0,y1:3e3,x2:1e4,y2:3e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"service-line-top",name:"Service Line (Top)",type:"line",params:{x1:0,y1:17e3,x2:1e4,y2:17e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-service-line-bottom",name:"Center Service Line (Bottom)",type:"line",params:{x1:5e3,y1:0,x2:5e3,y2:3e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-service-line-top",name:"Center Service Line (Top)",type:"line",params:{x1:5e3,y1:17e3,x2:5e3,y2:2e4},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-line",name:"Center Line",type:"line",params:{x1:5e3,y1:3e3,x2:5e3,y2:17e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[]},"handball-standard":{id:"handball-standard",name:"Handball",sport:"handball",standard:"IHF",category:"court",description:"Official IHF handball court with goal areas and penalty lines",dimensions:{length_mm:4e4,width_mm:2e4,min_surround_mm:1e3},defaultSurfaceColor:"RH10",defaultLineColor:"RH31",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:2e4,height:4e4},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"center-line",name:"Center Line",type:"line",params:{x1:0,y1:2e4,x2:2e4,y2:2e4},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"goal-area-bottom",name:"Goal Area (Bottom)",type:"arc",params:{cx:1e4,cy:0,radius:6e3,startAngle:0,endAngle:180},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"goal-area-top",name:"Goal Area (Top)",type:"arc",params:{cx:1e4,cy:4e4,radius:6e3,startAngle:180,endAngle:360},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"free-throw-line-bottom",name:"Free-Throw Line (Bottom)",type:"arc",params:{cx:1e4,cy:0,radius:9e3,startAngle:0,endAngle:180,dashed:!0,dashPattern:"300 150"},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"free-throw-line-top",name:"Free-Throw Line (Top)",type:"arc",params:{cx:1e4,cy:4e4,radius:9e3,startAngle:180,endAngle:360,dashed:!0,dashPattern:"300 150"},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"7m-line-bottom",name:"7m Penalty Line (Bottom)",type:"line",params:{x1:9e3,y1:7e3,x2:11e3,y2:7e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"7m-line-top",name:"7m Penalty Line (Top)",type:"line",params:{x1:9e3,y1:33e3,x2:11e3,y2:33e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"goalkeeper-line-bottom",name:"Goalkeeper Restriction Line (Bottom)",type:"line",params:{x1:9500,y1:4e3,x2:10500,y2:4e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"goalkeeper-line-top",name:"Goalkeeper Restriction Line (Top)",type:"line",params:{x1:9500,y1:36e3,x2:10500,y2:36e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[]},"hockey-d":{id:"hockey-d",name:"Field Hockey D",sport:"hockey",standard:"FIH",category:"overlay",description:"Hockey shooting circle (D) for overlay on sports surfaces",dimensions:{length_mm:14630,width_mm:29260,min_surround_mm:0},defaultSurfaceColor:"RH23",defaultLineColor:"RH29",defaultLineWidth_mm:50,markings:[{id:"shooting-circle",name:"Shooting Circle (D)",type:"arc",params:{cx:14630,cy:0,radius:14630,startAngle:0,endAngle:180},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"goal-line",name:"Goal Line",type:"line",params:{x1:0,y1:0,x2:29260,y2:0},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"penalty-spot",name:"Penalty Spot",type:"circle",params:{cx:14630,cy:6400,radius:150},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[]},"hockey-5s":{id:"hockey-5s",name:"Hockey 5s",sport:"hockey",standard:"England Hockey",category:"court",description:"Scaled-down hockey pitch for 5-a-side games",dimensions:{length_mm:55e3,width_mm:41100,min_surround_mm:2e3},defaultSurfaceColor:"RH23",defaultLineColor:"RH29",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:41100,height:55e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"center-line",name:"Center Line",type:"line",params:{x1:0,y1:27500,x2:41100,y2:27500},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-spot",name:"Center Spot",type:"circle",params:{cx:20550,cy:27500,radius:150},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"shooting-circle-bottom",name:"Shooting Circle (Bottom)",type:"arc",params:{cx:20550,cy:0,radius:9e3,startAngle:0,endAngle:180},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"shooting-circle-top",name:"Shooting Circle (Top)",type:"arc",params:{cx:20550,cy:55e3,radius:9e3,startAngle:180,endAngle:360},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"penalty-spot-bottom",name:"Penalty Spot (Bottom)",type:"circle",params:{cx:20550,cy:6400,radius:150},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"penalty-spot-top",name:"Penalty Spot (Top)",type:"circle",params:{cx:20550,cy:48600,radius:150},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[]}},fn=[{code:"RH01",name:"Standard Red",hex:"#A5362F",R:165,G:54,B:47,L:39.4,a:58.5,b:29},{code:"RH02",name:"Bright Red",hex:"#E21F2F",R:226,G:31,B:47,L:47.4,a:70.1,b:44},{code:"RH10",name:"Standard Green",hex:"#609B63",R:96,G:155,B:99,L:40.5,a:-42.2,b:17.9},{code:"RH11",name:"Bright Green",hex:"#3BB44A",R:59,G:180,B:74,L:62.1,a:-47.7,b:47.2},{code:"RH12",name:"Dark Green",hex:"#006C55",R:0,G:108,B:85,L:39.6,a:-38.3,b:13.1},{code:"RH20",name:"Standard Blue",hex:"#0075BC",R:0,G:117,B:188,L:36.4,a:14.2,b:-46.7},{code:"RH21",name:"Purple",hex:"#493D8C",R:73,G:61,B:140,L:31.5,a:41.9,b:-40.9},{code:"RH22",name:"Light Blue",hex:"#47AFE3",R:71,G:175,B:227,L:55.3,a:-19.1,b:-37.3},{code:"RH23",name:"Azure",hex:"#039DC4",R:3,G:157,B:196,L:47.7,a:-4.8,b:-34.8},{code:"RH26",name:"Turquoise",hex:"#00A6A3",R:0,G:166,B:163,L:58.8,a:-38.4,b:-3},{code:"RH30",name:"Standard Beige",hex:"#E4C4AA",R:228,G:196,B:170,L:75.2,a:3.8,b:24.8},{code:"RH31",name:"Cream",hex:"#E8E3D8",R:232,G:227,B:216,L:91.8,a:-.5,b:12.5},{code:"RH32",name:"Brown",hex:"#8B5F3C",R:139,G:95,B:60,L:40,a:15.9,b:27.1},{code:"RH90",name:"Funky Pink",hex:"#E8457E",R:232,G:69,B:126,L:55,a:66.1,b:4.9},{code:"RH40",name:"Mustard Yellow",hex:"#E5A144",R:229,G:161,B:68,L:66,a:8.4,b:56.3},{code:"RH41",name:"Bright Yellow",hex:"#FFD833",R:255,G:216,B:51,L:86.9,a:-1,b:90.6},{code:"RH50",name:"Orange",hex:"#F15B32",R:241,G:91,B:50,L:63.2,a:49.8,b:60.2},{code:"RH60",name:"Dark Grey",hex:"#59595B",R:89,G:89,B:91,L:34.1,a:-.4,b:-2.4},{code:"RH61",name:"Light Grey",hex:"#939598",R:147,G:149,B:152,L:69,a:-.5,b:-1},{code:"RH65",name:"Pale Grey",hex:"#D9D9D6",R:217,G:217,B:214,L:87.6,a:-.2,b:-.7},{code:"RH70",name:"Black",hex:"#231F20",R:35,G:31,B:32,L:9.1,a:-.3,b:-6.3}];function BE(){return Object.values(b1)}function HE(t){return b1[t]||null}function UE(t,e,n){const{type:r,params:s}=t;switch(r){case"line":return GE(s,e,n);case"rectangle":return VE(s,e,n);case"circle":return YE(s,e,n);case"arc":return qE(s,e,n);case"polyline":return XE(s,e,n);default:return console.warn(`Unknown marking type: ${r}`),null}}function WE(t,e){const{type:n,params:r}=t;switch(n){case"rectangle":return{type:"rect",x:r.x,y:r.y,width:r.width,height:r.height,fill:e};case"circle":return{type:"circle",cx:r.cx,cy:r.cy,r:r.radius,fill:e};case"polygon":return{type:"polygon",points:r.points,fill:e};default:return console.warn(`Unknown zone type: ${n}`),null}}function GE(t,e,n){const r={type:"line",x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,stroke:e,strokeWidth:n};return t.dashed&&(r.strokeDasharray=t.dashPattern||"200 100"),r}function VE(t,e,n){return{type:"rect",x:t.x,y:t.y,width:t.width,height:t.height,stroke:e,strokeWidth:n,fill:"none"}}function YE(t,e,n){return{type:"circle",cx:t.cx,cy:t.cy,r:t.radius,stroke:e,strokeWidth:n,fill:"none"}}function qE(t,e,n){const{cx:r,cy:s,radius:i,startAngle:a,endAngle:l}=t,c=a*Math.PI/180,d=l*Math.PI/180,u=r+i*Math.cos(c),p=s+i*Math.sin(c),h=r+i*Math.cos(d),f=s+i*Math.sin(d),m=l-a>180?1:0,v={type:"path",d:`M ${u} ${p} A ${i} ${i} 0 ${m} 1 ${h} ${f}`,stroke:e,strokeWidth:n,fill:"none"};return t.dashed&&(v.strokeDasharray=t.dashPattern||"200 100"),v}function XE(t,e,n){return{type:"polyline",points:t.points.map(s=>`${s[0]},${s[1]}`).join(" "),stroke:e,strokeWidth:n,fill:"none"}}function I0(t){if(t&&t.startsWith("#"))return t;const e=fn.find(n=>n.code===t);return e?e.hex:"#000000"}function KE(t){var a;const{template:e,lineColorOverrides:n,zoneColorOverrides:r}=t;if(!e)return console.error("No template provided for court"),{markings:[],zones:[]};const s=e.markings.map(l=>{var p;const c=((p=n[l.id])==null?void 0:p.hex)||e.defaultLineColor,d=I0(c),u=l.lineWidth_mm||e.defaultLineWidth_mm;return{id:l.id,name:l.name,...UE(l,d,u)}}).filter(Boolean),i=((a=e.zones)==null?void 0:a.map(l=>{var u;const c=((u=r[l.id])==null?void 0:u.hex)||l.defaultColor,d=I0(c);return{id:l.id,name:l.name,...WE(l,d)}}).filter(Boolean))||[];return{markings:s,zones:i}}function z0(t,e){return Math.round(t/e)*e}function ZE(t,e){return{x:z0(t.x,e),y:z0(t.y,e)}}function w1(t){let e=t%360;return e<0&&(e+=360),e}function vc(t,e,n){const{width_mm:r,length_mm:s}=e,{width_mm:i,length_mm:a}=n,l=500,c=-(r-l),d=i-l,u=-(s-l),p=a-l;return{x:Math.max(c,Math.min(t.x,d)),y:Math.max(u,Math.min(t.y,p))}}function JE(t){const{position:e,rotation:n,scale:r,template:s}=t,i=s.dimensions.width_mm/2,a=s.dimensions.length_mm/2;return`translate(${e.x}, ${e.y}) scale(${r}) rotate(${n}, ${i}, ${a})`}function QE({court:t,svgRef:e}){const{updateCourtRotation:n,updateCourtScale:r,updateCourtPosition:s,addToHistory:i}=lt(),[a,l]=O.useState(!1),[c,d]=O.useState(!1),[u,p]=O.useState(null),[h,f]=O.useState(null),{template:m,position:g,rotation:v,scale:x}=t,y=m.dimensions.width_mm*x,b=m.dimensions.length_mm*x,w=g.x+m.dimensions.width_mm*x/2,j=g.y+m.dimensions.length_mm*x/2,_=m.dimensions.width_mm/2,S=-1e3,E=(C,F)=>{if(!e.current)return{x:0,y:0};const pe=e.current.createSVGPoint();pe.x=C,pe.y=F;const V=pe.matrixTransform(e.current.getScreenCTM().inverse());return{x:V.x,y:V.y}},T=C=>{C.stopPropagation(),l(!0),f({x:C.clientX,y:C.clientY})},M=(C,F)=>{C.stopPropagation(),d(!0),p(F),f({x:C.clientX,y:C.clientY,initialScale:x,initialWidth:y,initialHeight:b,initialPosition:{...g}})};O.useEffect(()=>{if(!a&&!c)return;const C=pe=>{if(a){const V=E(pe.clientX,pe.clientY),J=V.x-w,I=V.y-j;let K=Math.atan2(I,J)*(180/Math.PI)+90;K=w1(K),pe.shiftKey&&(K=Math.round(K/15)*15),n(t.id,K)}else if(c&&h){const V=E(pe.clientX,pe.clientY),J=E(h.x,h.y),I=V.x-J.x,K=V.y-J.y;let z=h.initialScale,W={...g};switch(u){case"se":z=Math.max(.3,h.initialScale+I/m.dimensions.width_mm);break;case"nw":z=Math.max(.3,h.initialScale-I/m.dimensions.width_mm),W.x=h.initialPosition.x+(h.initialWidth-m.dimensions.width_mm*z),W.y=h.initialPosition.y+(h.initialHeight-m.dimensions.length_mm*z);break;case"ne":z=Math.max(.3,h.initialScale+I/m.dimensions.width_mm),W.y=h.initialPosition.y+(h.initialHeight-m.dimensions.length_mm*z);break;case"sw":z=Math.max(.3,h.initialScale-I/m.dimensions.width_mm),W.x=h.initialPosition.x+(h.initialWidth-m.dimensions.width_mm*z);break;case"e":z=Math.max(.3,h.initialScale+I/m.dimensions.width_mm);break;case"w":z=Math.max(.3,h.initialScale-I/m.dimensions.width_mm),W.x=h.initialPosition.x+(h.initialWidth-m.dimensions.width_mm*z);break;case"n":z=Math.max(.3,h.initialScale-K/m.dimensions.length_mm),W.y=h.initialPosition.y+(h.initialHeight-m.dimensions.length_mm*z);break;case"s":z=Math.max(.3,h.initialScale+K/m.dimensions.length_mm);break}z=Math.min(3,Math.max(.3,z)),r(t.id,z),(W.x!==g.x||W.y!==g.y)&&s(t.id,W)}},F=()=>{(a||c)&&i(),l(!1),d(!1),p(null),f(null)};return window.addEventListener("mousemove",C),window.addEventListener("mouseup",F),()=>{window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",F)}},[a,c,h,w,j,t.id,g,x,u]);const Z=[{type:"nw",x:0,y:0,cursor:"nwse-resize"},{type:"n",x:m.dimensions.width_mm/2,y:0,cursor:"ns-resize"},{type:"ne",x:m.dimensions.width_mm,y:0,cursor:"nesw-resize"},{type:"e",x:m.dimensions.width_mm,y:m.dimensions.length_mm/2,cursor:"ew-resize"},{type:"se",x:m.dimensions.width_mm,y:m.dimensions.length_mm,cursor:"nwse-resize"},{type:"s",x:m.dimensions.width_mm/2,y:m.dimensions.length_mm,cursor:"ns-resize"},{type:"sw",x:0,y:m.dimensions.length_mm,cursor:"nesw-resize"},{type:"w",x:0,y:m.dimensions.length_mm/2,cursor:"ew-resize"}],N=300,G=250;return o.jsxs("g",{className:"transform-handles",children:[o.jsxs("g",{className:"rotation-handle",onMouseDown:T,style:{cursor:a?"grabbing":"grab"},children:[o.jsx("line",{x1:_,y1:0,x2:_,y2:S+G,stroke:"#007bff",strokeWidth:30,strokeDasharray:"100 50"}),o.jsx("circle",{cx:_,cy:S,r:G,fill:"white",stroke:"#007bff",strokeWidth:40}),o.jsx("path",{d:`M ${_-G*.4} ${S}
              A ${G*.5} ${G*.5} 0 1 1 ${_+G*.4} ${S}`,fill:"none",stroke:"#007bff",strokeWidth:30,strokeLinecap:"round"}),o.jsx("path",{d:`M ${_+G*.4} ${S}
              L ${_+G*.6} ${S-G*.2}
              M ${_+G*.4} ${S}
              L ${_+G*.6} ${S+G*.2}`,fill:"none",stroke:"#007bff",strokeWidth:30,strokeLinecap:"round"})]}),Z.map(C=>o.jsx("rect",{className:`scale-handle scale-handle--${C.type}`,x:C.x-N/2,y:C.y-N/2,width:N,height:N,fill:"white",stroke:"#007bff",strokeWidth:40,rx:30,ry:30,style:{cursor:c&&u===C.type?"grabbing":C.cursor,pointerEvents:"all"},onMouseDown:F=>M(F,C.type)},C.type)),a&&o.jsxs("text",{x:m.dimensions.width_mm/2,y:-1e3-G-200,textAnchor:"middle",fontSize:400,fill:"#007bff",fontWeight:"bold",style:{pointerEvents:"none"},children:[Math.round(v),""]}),c&&o.jsxs("text",{x:m.dimensions.width_mm/2,y:m.dimensions.length_mm+600,textAnchor:"middle",fontSize:400,fill:"#007bff",fontWeight:"bold",style:{pointerEvents:"none"},children:[(x*100).toFixed(0),"%"]})]})}function _1(t){const{width_mm:e,height_mm:n,numLanes:r,laneWidth_mm:s,cornerRadius:i={topLeft:3e3,topRight:3e3,bottomLeft:3e3,bottomRight:3e3},lineWidth_mm:a=50}=t,l=[];if(i.topLeft===0&&i.topRight===0&&i.bottomLeft===0&&i.bottomRight===0){const d=r*s;for(let u=0;u<r;u++){const p=u*s;l.push({laneNumber:u+1,innerPath:null,outerPath:e5(s,n,u),perimeter:2*n/1e3,isParallel:!0,laneX:p,laneWidth:s})}return{lanes:l,totalWidth:d,totalLength:n,usableWidth:d,usableHeight:n,isStraightTrack:!0}}else for(let d=0;d<r;d++){const u=d*s,p=(d+1)*s,h=Math.max(0,e-p*2),f=Math.max(0,n-p*2),m=Math.max(0,e-u*2),g=Math.max(0,n-u*2),v={topLeft:Math.max(0,i.topLeft-p),topRight:Math.max(0,i.topRight-p),bottomLeft:Math.max(0,i.bottomLeft-p),bottomRight:Math.max(0,i.bottomRight-p)},x={topLeft:Math.max(0,i.topLeft-u),topRight:Math.max(0,i.topRight-u),bottomLeft:Math.max(0,i.bottomLeft-u),bottomRight:Math.max(0,i.bottomRight-u)};l.push({laneNumber:d+1,innerPath:F0(h,f,v,p),outerPath:F0(m,g,x,u),perimeter:t5(m,g,x),isParallel:!1})}return{lanes:l,totalWidth:e,totalLength:n,usableWidth:e-r*s*2,usableHeight:n-r*s*2}}function F0(t,e,n,r=0){if(t<=0||e<=0)return`M ${r} ${r} L ${r} ${r}`;const s=Math.min(t/2,e/2),i=Math.min(n.topLeft,s),a=Math.min(n.topRight,s),l=Math.min(n.bottomRight,s),c=Math.min(n.bottomLeft,s),d=r,u=r+t,p=r,h=r+e;return`
    M ${d+i} ${p}
    L ${u-a} ${p}
    ${a>0?`A ${a} ${a} 0 0 1 ${u} ${p+a}`:""}
    L ${u} ${h-l}
    ${l>0?`A ${l} ${l} 0 0 1 ${u-l} ${h}`:""}
    L ${d+c} ${h}
    ${c>0?`A ${c} ${c} 0 0 1 ${d} ${h-c}`:""}
    L ${d} ${p+i}
    ${i>0?`A ${i} ${i} 0 0 1 ${d+i} ${p}`:""}
    Z
  `.trim().replace(/\s+/g," ")}function e5(t,e,n){const r=n*t;return`M ${r} 0 L ${r+t} 0 L ${r+t} ${e} L ${r} ${e} Z`}function t5(t,e,n){if(t<=0||e<=0)return 0;const r=Math.min(t/2,e/2),s=Math.min(n.topLeft,r),i=Math.min(n.topRight,r),a=Math.min(n.bottomRight,r),l=Math.min(n.bottomLeft,r),c=t-s-i,d=e-i-a,u=t-a-l,p=e-l-s,h=Math.PI*s/2,f=Math.PI*i/2,m=Math.PI*a/2,g=Math.PI*l/2;return(c+d+u+p+h+f+m+g)/1e3}function S1(t){if(!t||!t.lanes||t.lanes.length===0)return[];const e=t.lanes.length-1,n=t.lanes[e].perimeter;return t.lanes.map((r,s)=>r.perimeter-n)}function B0(t,e,n){const{width_mm:r,height_mm:s,laneWidth_mm:i,cornerRadius:a={topLeft:3e3,topRight:3e3,bottomLeft:3e3,bottomRight:3e3}}=n,l=t*i,c=Math.max(0,r-l*2),d=Math.max(0,s-l*2),u=Math.min(c/2,d/2),p=Math.min(Math.max(0,a.topLeft-l),u),h=Math.min(Math.max(0,a.topRight-l),u),f=Math.min(Math.max(0,a.bottomRight-l),u),m=Math.min(Math.max(0,a.bottomLeft-l),u),g=l,v=l+c,x=l,y=l+d,b=[{type:"arc",length:Math.PI*m/2,radius:m,corner:"bottomLeft"},{type:"straight",length:d-m-p,dir:"up"},{type:"arc",length:Math.PI*p/2,radius:p,corner:"topLeft"},{type:"straight",length:c-p-h,dir:"right"},{type:"arc",length:Math.PI*h/2,radius:h,corner:"topRight"},{type:"straight",length:d-h-f,dir:"down"},{type:"arc",length:Math.PI*f/2,radius:f,corner:"bottomRight"},{type:"straight",length:c-f-m,dir:"left"}];let w=e;const j=b.reduce((S,E)=>S+E.length,0);for(;w<0;)w+=j;for(;w>=j;)w-=j;let _=0;for(const S of b){if(w<=_+S.length){const E=w-_,T=S.length>0?E/S.length:0;return S.type==="arc"?n5(S,T,{left:g,right:v,top:x,bottom:y,tl:p,tr:h,br:f,bl:m}):r5(S,T,{left:g,right:v,top:x,bottom:y,tl:p,tr:h,br:f,bl:m})}_+=S.length}return{x:g,y:y-m,angle:-Math.PI/2}}function n5(t,e,n){const{left:r,right:s,top:i,bottom:a,tl:l,tr:c,br:d,bl:u}=n,p=e*(Math.PI/2);switch(t.corner){case"bottomLeft":{const h=r+u,f=a-u,g=Math.PI/2+p;return{x:h+u*Math.cos(g),y:f+u*Math.sin(g),angle:g+Math.PI/2}}case"topLeft":{const h=r+l,f=i+l,g=Math.PI+p;return{x:h+l*Math.cos(g),y:f+l*Math.sin(g),angle:g+Math.PI/2}}case"topRight":{const h=s-c,f=i+c,g=-Math.PI/2+p;return{x:h+c*Math.cos(g),y:f+c*Math.sin(g),angle:g+Math.PI/2}}case"bottomRight":{const h=s-d,f=a-d,g=0+p;return{x:h+d*Math.cos(g),y:f+d*Math.sin(g),angle:g+Math.PI/2}}default:return{x:r,y:i,angle:0}}}function r5(t,e,n){const{left:r,right:s,top:i,bottom:a,tl:l,tr:c,br:d,bl:u}=n;switch(t.dir){case"up":{const p=a-u,h=i+l;return{x:r,y:p+e*(h-p),angle:-Math.PI/2}}case"right":{const p=r+l,h=s-c;return{x:p+e*(h-p),y:i,angle:0}}case"down":{const p=i+c,h=a-d;return{x:s,y:p+e*(h-p),angle:Math.PI/2}}case"left":{const p=s-d,h=r+u;return{x:p+e*(h-p),y:a,angle:Math.PI}}default:return{x:r,y:i,angle:0}}}function H0(t,e,n){const r=B0(t,e,n),s=B0(t+1,e,n);return{x:(r.x+s.x)/2,y:(r.y+s.y)/2,angle:r.angle,innerX:s.x,innerY:s.y,outerX:r.x,outerY:r.y}}function U0(t,e,n){const{width_mm:r,height_mm:s,laneWidth_mm:i,cornerRadius:a={topLeft:3e3,topRight:3e3,bottomLeft:3e3,bottomRight:3e3}}=n,l=t*i,c=Math.max(0,r-l*2),d=Math.max(0,s-l*2),u=Math.min(c/2,d/2),p=Math.min(Math.max(0,a.topLeft-l),u),h=Math.min(Math.max(0,a.topRight-l),u),f=Math.min(Math.max(0,a.bottomRight-l),u),m=Math.min(Math.max(0,a.bottomLeft-l),u),g=[{type:"arc",length:Math.PI*m/2,corner:"bottomLeft"},{type:"straight",length:d-m-p,dir:"up"},{type:"arc",length:Math.PI*p/2,corner:"topLeft"},{type:"straight",length:c-p-h,dir:"right"},{type:"arc",length:Math.PI*h/2,corner:"topRight"},{type:"straight",length:d-h-f,dir:"down"},{type:"arc",length:Math.PI*f/2,corner:"bottomRight"},{type:"straight",length:c-f-m,dir:"left"}],v=g.reduce((b,w)=>b+w.length,0);let x=e;for(;x<0;)x+=v;for(;x>=v;)x-=v;let y=0;for(let b=0;b<g.length;b++){if(x<=y+g[b].length){const w=x-y,j=g[b].length>0?w/g[b].length:0;return{segmentIndex:b,t:j,segments:g,totalPerimeter:v}}y+=g[b].length}return{segmentIndex:0,t:0,segments:g,totalPerimeter:v}}function W0(t,e,n,r){const s=U0(n,e,r),i=U0(t,0,r);let a=0;for(let d=0;d<s.segmentIndex;d++)a+=i.segments[d].length;const l=i.segments[s.segmentIndex].length;return a+s.t*l}function s5({track:t,svgRef:e}){var C;const{updateTrackParameters:n,updateTrackPosition:r,updateTrackRotation:s,addToHistory:i}=lt(),[a,l]=O.useState(!1),[c,d]=O.useState(!1),[u,p]=O.useState(null),[h,f]=O.useState(null),{parameters:m,position:g,rotation:v}=t,x=m.width_mm,y=m.height_mm,b=g.x+x/2,w=g.y+y/2,j=x/2,_=-1e3,S=(F,pe)=>{if(!e.current)return{x:0,y:0};const V=e.current.createSVGPoint();V.x=F,V.y=pe;const J=V.matrixTransform(e.current.getScreenCTM().inverse());return{x:J.x,y:J.y}},E=F=>{F.stopPropagation();const pe=F.touches?F.touches[0].clientX:F.clientX,V=F.touches?F.touches[0].clientY:F.clientY;d(!0),f({x:pe,y:V})},T=(F,pe)=>{var W;F.stopPropagation(),l(!0),p(pe);const V=F.touches?F.touches[0].clientX:F.clientX,J=F.touches?F.touches[0].clientY:F.clientY,I=S(V,J),K=((W=t.template)==null?void 0:W.trackType)==="straight";let z={};if(K){const fe=v*Math.PI/180,ue=Math.sin(fe),ne=Math.cos(fe),ke=g.x+x/2,ce=g.y+y/2,$e=pe==="n"||pe==="nw"||pe==="ne";z={fixedEdgeCenter:$e?{x:ke-y/2*ue,y:ce+y/2*ne}:{x:ke+y/2*ue,y:ce-y/2*ne},fixedEdgeIsSouth:$e,sinR:ue,cosR:ne}}f({screenX:V,screenY:J,svgX:I.x,svgY:I.y,initialWidth:x,initialHeight:y,initialPosition:{...g},initialCornerRadius:{...m.cornerRadius},...z})};O.useEffect(()=>{if(!a&&!c)return;const F=V=>{var Ue;const J=V.touches?V.touches[0].clientX:V.clientX,I=V.touches?V.touches[0].clientY:V.clientY;if(c){const Ge=S(J,I),at=Ge.x-b,Ve=Ge.y-w;let k=Math.atan2(Ve,at)*(180/Math.PI)+90;k=w1(k),V.shiftKey&&(k=Math.round(k/15)*15),s(t.id,k);return}if(!h)return;const K=S(J,I),z=K.x-h.svgX,W=K.y-h.svgY;let fe=h.initialWidth,ue=h.initialHeight,ne={...g},ke={...h.initialCornerRadius};const ce=3e3,$e=((Ue=t.template)==null?void 0:Ue.trackType)==="straight";if($e&&(u==="e"||u==="w"))return;if($e&&h.fixedEdgeCenter){const{fixedEdgeCenter:Ge,fixedEdgeIsSouth:at,sinR:Ve,cosR:k}=h,Q=K.x-Ge.x,oe=K.y-Ge.y,D=at?Ve:-Ve,P=at?-k:k,$=Q*D+oe*P;ue=Math.max(ce,$);const Y=Ge.x+ue/2*D,se=Ge.y+ue/2*P;ne={x:Y-fe/2,y:se-ue/2}}else switch(u){case"se":fe=Math.max(ce,h.initialWidth+z),ue=Math.max(ce,h.initialHeight+W);const Ge=Math.min(fe/h.initialWidth,ue/h.initialHeight);ke={topLeft:h.initialCornerRadius.topLeft*Ge,topRight:h.initialCornerRadius.topRight*Ge,bottomLeft:h.initialCornerRadius.bottomLeft*Ge,bottomRight:h.initialCornerRadius.bottomRight*Ge};break;case"nw":fe=Math.max(ce,h.initialWidth-z),ue=Math.max(ce,h.initialHeight-W),ne.x=h.initialPosition.x+(h.initialWidth-fe),ne.y=h.initialPosition.y+(h.initialHeight-ue);const at=Math.min(fe/h.initialWidth,ue/h.initialHeight);ke={topLeft:h.initialCornerRadius.topLeft*at,topRight:h.initialCornerRadius.topRight*at,bottomLeft:h.initialCornerRadius.bottomLeft*at,bottomRight:h.initialCornerRadius.bottomRight*at};break;case"ne":fe=Math.max(ce,h.initialWidth+z),ue=Math.max(ce,h.initialHeight-W),ne.y=h.initialPosition.y+(h.initialHeight-ue);const Ve=Math.min(fe/h.initialWidth,ue/h.initialHeight);ke={topLeft:h.initialCornerRadius.topLeft*Ve,topRight:h.initialCornerRadius.topRight*Ve,bottomLeft:h.initialCornerRadius.bottomLeft*Ve,bottomRight:h.initialCornerRadius.bottomRight*Ve};break;case"sw":fe=Math.max(ce,h.initialWidth-z),ue=Math.max(ce,h.initialHeight+W),ne.x=h.initialPosition.x+(h.initialWidth-fe);const k=Math.min(fe/h.initialWidth,ue/h.initialHeight);ke={topLeft:h.initialCornerRadius.topLeft*k,topRight:h.initialCornerRadius.topRight*k,bottomLeft:h.initialCornerRadius.bottomLeft*k,bottomRight:h.initialCornerRadius.bottomRight*k};break;case"e":fe=Math.max(ce,h.initialWidth+z);const Q=fe/h.initialWidth;ke={topLeft:h.initialCornerRadius.topLeft*Q,topRight:h.initialCornerRadius.topRight*Q,bottomLeft:h.initialCornerRadius.bottomLeft*Q,bottomRight:h.initialCornerRadius.bottomRight*Q};break;case"w":fe=Math.max(ce,h.initialWidth-z),ne.x=h.initialPosition.x+(h.initialWidth-fe);const oe=fe/h.initialWidth;ke={topLeft:h.initialCornerRadius.topLeft*oe,topRight:h.initialCornerRadius.topRight*oe,bottomLeft:h.initialCornerRadius.bottomLeft*oe,bottomRight:h.initialCornerRadius.bottomRight*oe};break;case"n":ue=Math.max(ce,h.initialHeight-W),ne.y=h.initialPosition.y+(h.initialHeight-ue);const D=ue/h.initialHeight;ke={topLeft:h.initialCornerRadius.topLeft*D,topRight:h.initialCornerRadius.topRight*D,bottomLeft:h.initialCornerRadius.bottomLeft*D,bottomRight:h.initialCornerRadius.bottomRight*D};break;case"s":ue=Math.max(ce,h.initialHeight+W);const P=ue/h.initialHeight;ke={topLeft:h.initialCornerRadius.topLeft*P,topRight:h.initialCornerRadius.topRight*P,bottomLeft:h.initialCornerRadius.bottomLeft*P,bottomRight:h.initialCornerRadius.bottomRight*P};break}const ze=Math.min(fe,ue)/2;ke={topLeft:Math.min(ke.topLeft,ze),topRight:Math.min(ke.topRight,ze),bottomLeft:Math.min(ke.bottomLeft,ze),bottomRight:Math.min(ke.bottomRight,ze)},n(t.id,{width_mm:fe,height_mm:ue,cornerRadius:ke}),(ne.x!==g.x||ne.y!==g.y)&&r(t.id,ne)},pe=()=>{(a||c)&&i(),l(!1),d(!1),p(null),f(null)};return window.addEventListener("mousemove",F),window.addEventListener("mouseup",pe),window.addEventListener("touchmove",F,{passive:!1}),window.addEventListener("touchend",pe),window.addEventListener("touchcancel",pe),()=>{window.removeEventListener("mousemove",F),window.removeEventListener("mouseup",pe),window.removeEventListener("touchmove",F),window.removeEventListener("touchend",pe),window.removeEventListener("touchcancel",pe)}},[a,h,u,t.id,g,m,n,r,i]);const M=((C=t.template)==null?void 0:C.trackType)==="straight",Z=[{type:"nw",x:0,y:0,cursor:"nwse-resize"},{type:"n",x:x/2,y:0,cursor:"ns-resize"},{type:"ne",x,y:0,cursor:"nesw-resize"},{type:"e",x,y:y/2,cursor:"ew-resize"},{type:"se",x,y,cursor:"nwse-resize"},{type:"s",x:x/2,y,cursor:"ns-resize"},{type:"sw",x:0,y,cursor:"nesw-resize"},{type:"w",x:0,y:y/2,cursor:"ew-resize"}],N=M?Z.filter(F=>F.type==="n"||F.type==="s"):Z,G=400;return o.jsxs("g",{className:"track-resize-handles",children:[o.jsxs("g",{className:"rotation-handle-group",children:[o.jsx("line",{x1:j,y1:0,x2:j,y2:_,stroke:"#0066CC",strokeWidth:30,strokeDasharray:"100 100",opacity:.5,style:{pointerEvents:"none"}}),o.jsx("circle",{className:"rotation-handle",cx:j,cy:_,r:G/2,fill:"white",stroke:"#0066CC",strokeWidth:50,style:{cursor:c?"grabbing":"grab",pointerEvents:"all"},onMouseDown:E,onTouchStart:E}),o.jsx("path",{d:`M ${j-100} ${_-50}
              A 100 100 0 1 1 ${j+100} ${_-50}`,fill:"none",stroke:"#0066CC",strokeWidth:40,strokeLinecap:"round",style:{pointerEvents:"none"}}),o.jsx("path",{d:`M ${j+100} ${_-50}
              L ${j+80} ${_-120}
              L ${j+150} ${_-80}
              Z`,fill:"#0066CC",style:{pointerEvents:"none"}})]}),N.map(F=>o.jsx("rect",{className:`resize-handle resize-handle--${F.type}`,x:F.x-G/2,y:F.y-G/2,width:G,height:G,fill:"white",stroke:"#0066CC",strokeWidth:50,rx:40,ry:40,style:{cursor:a&&u===F.type?"grabbing":F.cursor,pointerEvents:"all"},onMouseDown:pe=>T(pe,F.type),onTouchStart:pe=>T(pe,F.type)},F.type)),a&&o.jsxs("text",{x:x/2,y:y+800,textAnchor:"middle",fontSize:400,fill:"#0066CC",fontWeight:"bold",style:{pointerEvents:"none"},children:[(x/1e3).toFixed(1),"m  ",(y/1e3).toFixed(1),"m"]}),c&&o.jsxs("text",{x:x/2,y:-1500,textAnchor:"middle",fontSize:400,fill:"#0066CC",fontWeight:"bold",style:{pointerEvents:"none"},children:[v.toFixed(0),""]})]})}function i5({geometry:t,parameters:e,boxConfig:n,surfaceColor:r,lineColor:s,isStraightTrack:i}){if(!n||!n.enabled)return null;const{depth_mm:a=800,lineWidth_mm:l=50,perLaneOffsets:c=[],style:d="staggered",direction:u="counterclockwise",startPosition:p=0}=n,h="'Black Ops One', 'Impact', sans-serif",f=r||"#A5362F",m=s||"#E8E3D8",g=d==="staggered"||d==="both",v=d==="straight"||d==="both";return o.jsx("g",{className:"starting-boxes",children:t.lanes.map((x,y)=>{const b=y+1;return i?o5(y,b,e,t,a,l,f,m,h,g,v,c,u):a5(y,b,e,t,a,l,f,m,h,g,v,c,u,p)})})}function o5(t,e,n,r,s,i,a,l,c,d,u,p,h){const f=t*n.laneWidth_mm,m=n.laneWidth_mm,g=h==="clockwise",v=g?r.totalLength-s:0,x=g?0:r.totalLength-s,y=(p[t]||0)*1e3,b=[];if(d&&!u){const w=g?v-y:v+y;b.push(o.jsx(bc,{x:f,y:w,width:m,height:s,laneNumber:e,boxFillColor:a,lineColor:l,lineWidth:i,fontFamily:c,flipLine:!g},`stagger-${e}`))}else if(u&&!d)b.push(o.jsx(bc,{x:f,y:v,width:m,height:s,laneNumber:e,boxFillColor:a,lineColor:l,lineWidth:i,fontFamily:c,flipLine:!g},`straight-${e}`));else if(d&&u){const w=g?v-y:v+y;b.push(o.jsx(bc,{x:f,y:w,width:m,height:s,laneNumber:e,boxFillColor:a,lineColor:l,lineWidth:i,fontFamily:c,flipLine:!g},`stagger-${e}`)),b.push(o.jsx(bc,{x:f,y:x,width:m,height:s,laneNumber:e,boxFillColor:a,lineColor:l,lineWidth:i,fontFamily:c,flipLine:g},`straight-${e}`))}return o.jsx("g",{children:b},`lane-boxes-${e}`)}function bc({x:t,y:e,width:n,height:r,laneNumber:s,boxFillColor:i,lineColor:a,lineWidth:l,fontFamily:c,flipLine:d}){const u=d?e+r:e;return o.jsxs("g",{children:[o.jsx("line",{x1:t,y1:u,x2:t+n,y2:u,stroke:a,strokeWidth:l,strokeLinecap:"butt",pointerEvents:"none"}),o.jsx("text",{x:t+n/2,y:e+r/2,fontSize:Math.min(r*.6,n*.5),fill:a,textAnchor:"middle",dominantBaseline:"middle",fontFamily:c,fontWeight:"bold",pointerEvents:"none",opacity:"0.9",children:s})]})}function a5(t,e,n,r,s,i,a,l,c,d,u,p,h,f=0){var E,T;const m=h==="clockwise",g=r.lanes.length-1,v=(((E=r.lanes[g])==null?void 0:E.perimeter)||0)*1e3,x=v/2,y=f/100*v,b=W0(t,y,g,n),j=(((T=r.lanes[t])==null?void 0:T.perimeter)||0)*1e3/2,_=(p[t]||0)*1e3,S=[];if(d&&!u){const M=m?b+j+_:b+_;S.push(o.jsx(wc,{index:t,laneNumber:e,distance:M,depth_mm:s,parameters:n,boxFillColor:a,lineColor:l,lineWidth:i,fontFamily:c},`stagger-${e}`))}else if(u&&!d){const M=m?b+j:b;S.push(o.jsx(wc,{index:t,laneNumber:e,distance:M,depth_mm:s,parameters:n,boxFillColor:a,lineColor:l,lineWidth:i,fontFamily:c},`straight-${e}`))}else if(d&&u){const M=m?b+j+_:b+_,Z=m?y:y+x,N=W0(t,Z,g,n),G=N;S.push(o.jsx(wc,{index:t,laneNumber:e,distance:M,depth_mm:s,parameters:n,boxFillColor:a,lineColor:l,lineWidth:i,fontFamily:c},`stagger-${e}`)),S.push(o.jsx(wc,{index:t,laneNumber:e,distance:G,depth_mm:s,parameters:n,boxFillColor:a,lineColor:l,lineWidth:i,fontFamily:c},`straight-${e}`))}return o.jsx("g",{children:S},`lane-boxes-${e}`)}function wc({index:t,laneNumber:e,distance:n,depth_mm:r,parameters:s,boxFillColor:i,lineColor:a,lineWidth:l,fontFamily:c}){const d=H0(t,n,s),u=d.angle+Math.PI/2,p=s.laneWidth_mm/2,h=d.x+Math.cos(u)*p,f=d.y+Math.sin(u)*p,m=d.x-Math.cos(u)*p,g=d.y-Math.sin(u)*p,v=H0(t,n+r/2,s);return o.jsxs("g",{children:[o.jsx("line",{x1:h,y1:f,x2:m,y2:g,stroke:a,strokeWidth:l,strokeLinecap:"butt",pointerEvents:"none"}),o.jsx("text",{x:v.x,y:v.y,fontSize:Math.min(r*.6,s.laneWidth_mm*.5),fill:a,textAnchor:"middle",dominantBaseline:"middle",fontFamily:c,fontWeight:"bold",pointerEvents:"none",opacity:"0.9",transform:`rotate(${v.angle*180/Math.PI+90}, ${v.x}, ${v.y})`,children:e})]})}function l5({track:t,isSelected:e,onMouseDown:n,onTouchStart:r,onDoubleClick:s,svgRef:i}){var S,E,T;const{parameters:a,position:l,rotation:c,trackSurfaceColor:d,trackLineColor:u,laneSurfaceColors:p}=t,h=_1(a),f=h.lanes.length>0&&h.lanes[0].isParallel===!0,m=h.totalWidth,g=h.totalLength,v=m/2,x=g/2,y=`translate(${l.x}, ${l.y}) rotate(${c}, ${v}, ${x})`,b=(d==null?void 0:d.hex)||"#A5362F",w=(u==null?void 0:u.hex)||"#E8E3D8",j=a.lineWidth_mm||50,_=M=>{const Z=p==null?void 0:p[M-1];return(Z==null?void 0:Z.hex)||b};return console.log("TrackRenderer - trackSurfaceColor:",d),console.log("TrackRenderer - defaultSurfaceColor:",b),console.log("TrackRenderer - geometry.lanes.length:",h.lanes.length),o.jsxs("g",{className:`track-element ${e?"track-element--selected":""}`,transform:y,style:{cursor:"move"},children:[f?o.jsxs(o.Fragment,{children:[o.jsx("rect",{x:"0",y:"0",width:m,height:g,fill:"transparent",pointerEvents:"all",onMouseDown:n,onTouchStart:r,onDoubleClick:s,style:{cursor:"move"}}),h.lanes.map(M=>o.jsx("path",{d:M.outerPath,fill:_(M.laneNumber),stroke:"none",pointerEvents:"none"},`lane-fill-${M.laneNumber}`))]}):o.jsx(o.Fragment,{children:h.lanes.map((M,Z)=>{const N=h.lanes[Z+1],G=N?N.outerPath:M.innerPath,C=Z===0;return o.jsx("path",{d:`${M.outerPath} ${G}`,fill:_(M.laneNumber),fillRule:"evenodd",stroke:"none",pointerEvents:C?"all":"none",onMouseDown:C?n:void 0,onTouchStart:C?r:void 0,onDoubleClick:C?s:void 0,style:C?{cursor:"move"}:void 0},`lane-fill-${M.laneNumber}`)})}),h.lanes.map((M,Z)=>o.jsx(c5,{lane:M,lineColor:w,lineWidth:j,isLastLane:Z===h.lanes.length-1,isStraightTrack:f,geometry:h},`stroke-${M.laneNumber}`)),((S=a.startingBoxes)==null?void 0:S.enabled)&&o.jsx(i5,{geometry:h,parameters:a,boxConfig:{...a.startingBoxes,perLaneOffsets:((E=t.template)==null?void 0:E.trackType)==="curved"?S1(h):[]},surfaceColor:b,lineColor:w,isStraightTrack:((T=t.template)==null?void 0:T.trackType)==="straight"}),e&&o.jsxs(o.Fragment,{children:[o.jsx("rect",{x:"-10",y:"-10",width:m+20,height:g+20,fill:"none",stroke:"#0066CC",strokeWidth:"80",strokeDasharray:"400 400",opacity:"0.5",pointerEvents:"none"}),o.jsx(s5,{track:t,svgRef:i})]})]})}function c5({lane:t,lineColor:e,lineWidth:n,isLastLane:r,isStraightTrack:s,geometry:i}){const{innerPath:a,outerPath:l}=t,c=50;return s?o.jsxs("g",{className:"track-lane-stroke",children:[t.laneNumber===1&&o.jsx("line",{x1:t.laneX,y1:0,x2:t.laneX,y2:i.totalLength,stroke:e,strokeWidth:c,pointerEvents:"none"}),o.jsx("line",{x1:t.laneX+t.laneWidth,y1:0,x2:t.laneX+t.laneWidth,y2:i.totalLength,stroke:e,strokeWidth:c,pointerEvents:"none"})]}):o.jsxs("g",{className:"track-lane-stroke",children:[o.jsx("path",{d:l,fill:"none",stroke:e,strokeWidth:c,pointerEvents:"none"}),r&&o.jsx("path",{d:a,fill:"none",stroke:e,strokeWidth:c,pointerEvents:"none"})]})}function d5({motif:t,isSelected:e,onMouseDown:n,onTouchStart:r,onDoubleClick:s,onScaleStart:i,onRotateStart:a}){const{svgContent:l,originalWidth_mm:c,originalHeight_mm:d,position:u,rotation:p,scale:h}=t,f=O.useMemo(()=>{if(!l)return null;const _=l.match(/viewBox=["']([^"']+)["']/i);if(_){const T=_[1].split(/\s+/).map(Number);if(T.length>=4)return{width:T[2],height:T[3]}}const S=l.match(/\bwidth=["']?(\d+(?:\.\d+)?)/i),E=l.match(/\bheight=["']?(\d+(?:\.\d+)?)/i);return S&&E?{width:parseFloat(S[1]),height:parseFloat(E[1])}:null},[l]),m=O.useMemo(()=>{if(!f)return{width:c,height:d};const _=f.width/f.height,S=c/d,E=_>=1,T=S>=1;if(E!==T){console.warn("[MOTIF] Orientation mismatch detected - using SVG viewBox aspect ratio"),console.log("[MOTIF] SVG viewBox:",f,"AR:",_.toFixed(2)),console.log("[MOTIF] Physical dims:",c,"",d,"AR:",S.toFixed(2));const M=c*d,Z=Math.sqrt(M*_),N=Z/_;return{width:Z,height:N}}return{width:c,height:d}},[f,c,d]),g=m.width*(h||1),v=m.height*(h||1),x=g/2,y=v/2,b=`translate(${u.x}, ${u.y}) rotate(${p||0}, ${x}, ${y})`,w=O.useMemo(()=>{if(!l)return null;try{let _=l;return _=_.replace(/\s+(width|height)=["'][^"']*["']/gi,""),_.includes("viewBox")||(_=_.replace("<svg",`<svg viewBox="0 0 ${m.width} ${m.height}"`)),_}catch(_){return console.error("[MOTIF] Error processing SVG:",_),l}},[l,m]),j=O.useMemo(()=>{if(!w)return null;try{return`data:image/svg+xml,${encodeURIComponent(w).replace(/'/g,"%27").replace(/"/g,"%22")}`}catch(_){return console.error("[MOTIF] Error creating data URL:",_),null}},[w]);return j?o.jsxs("g",{className:`motif-element ${e?"motif-element--selected":""}`,transform:b,style:{cursor:"move"},children:[o.jsx("image",{href:j,x:"0",y:"0",width:g,height:v,preserveAspectRatio:"xMidYMid meet",pointerEvents:"none"}),o.jsx("rect",{x:"0",y:"0",width:g,height:v,fill:"transparent",pointerEvents:"all",onMouseDown:n,onTouchStart:r,onDoubleClick:s,style:{cursor:"move"}}),e&&o.jsx("rect",{x:"-10",y:"-10",width:g+20,height:v+20,fill:"none",stroke:"#9333EA",strokeWidth:"80",strokeDasharray:"400 400",opacity:"0.7",pointerEvents:"none"}),e&&o.jsx(u5,{width:g,height:v,onScaleStart:i,onRotateStart:a})]}):o.jsxs("g",{transform:b,children:[o.jsx("rect",{x:"0",y:"0",width:g,height:v,fill:"#f0f0f0",stroke:"#ccc",strokeWidth:"50",strokeDasharray:"200 200"}),o.jsx("text",{x:g/2,y:v/2,textAnchor:"middle",dominantBaseline:"middle",fontSize:Math.min(g,v)/10,fill:"#999",children:"Motif Error"})]})}function u5({width:t,height:e,onScaleStart:n,onRotateStart:r}){const s=Math.min(t,e)*.08,l=Math.max(150,Math.min(400,s)),c=[{x:-l/2,y:-l/2,corner:"nw",cursor:"nwse-resize"},{x:t-l/2,y:-l/2,corner:"ne",cursor:"nesw-resize"},{x:-l/2,y:e-l/2,corner:"sw",cursor:"nesw-resize"},{x:t-l/2,y:e-l/2,corner:"se",cursor:"nwse-resize"}],d=l*2.5,u=l*.8;return o.jsxs("g",{className:"motif-handles",children:[c.map(p=>o.jsx("rect",{x:p.x,y:p.y,width:l,height:l,fill:"#9333EA",stroke:"#fff",strokeWidth:"20",rx:l/4,style:{cursor:p.cursor},pointerEvents:"all",onMouseDown:h=>{h.stopPropagation(),n==null||n(h,p.corner)},onTouchStart:h=>{h.stopPropagation(),n==null||n(h,p.corner)}},p.corner)),o.jsx("line",{x1:t/2,y1:0,x2:t/2,y2:-d+u/2,stroke:"#9333EA",strokeWidth:"30",pointerEvents:"none"}),o.jsx("circle",{cx:t/2,cy:-d,r:u,fill:"#9333EA",stroke:"#fff",strokeWidth:"20",style:{cursor:"grab"},pointerEvents:"all",onMouseDown:p=>{p.stopPropagation(),r==null||r(p)},onTouchStart:p=>{p.stopPropagation(),r==null||r(p)}}),o.jsx("path",{d:`M ${t/2-u*.4} ${-d}
            A ${u*.4} ${u*.4} 0 1 1
            ${t/2+u*.4} ${-d}`,fill:"none",stroke:"#fff",strokeWidth:"25",strokeLinecap:"round",pointerEvents:"none"}),o.jsx("polygon",{points:`${t/2+u*.4},${-d-u*.25}
                 ${t/2+u*.4},${-d+u*.25}
                 ${t/2+u*.65},${-d}`,fill:"#fff",pointerEvents:"none"})]})}function k1(t,e,n,r=0,s=!1,i=.5){if(s&&t>=3)return p5(t,e,n,i,r);if(t>=32)return m5(e,n);const a=h5(t,e,n);return r>0?j1(a,r):`M ${a.map(l=>`${l.x},${l.y}`).join(" L ")} Z`}function h5(t,e,n){if(t===4)return[{x:0,y:0},{x:e,y:0},{x:e,y:n},{x:0,y:n}];const r=[],s=2*Math.PI/t,i=-Math.PI/2;for(let m=0;m<t;m++){const g=i+s*m;r.push({x:Math.cos(g),y:Math.sin(g)})}let a=1/0,l=-1/0,c=1/0,d=-1/0;for(const m of r)a=Math.min(a,m.x),l=Math.max(l,m.x),c=Math.min(c,m.y),d=Math.max(d,m.y);const u=l-a,p=d-c,h=e/u,f=n/p;return r.map(m=>({x:(m.x-a)*h,y:(m.y-c)*f}))}function p5(t,e,n,r=.5,s=0){const i=f5(t,e,n,r);return s>0?j1(i,s):`M ${i.map(a=>`${a.x},${a.y}`).join(" L ")} Z`}function f5(t,e,n,r=.5){const s=[],i=t*2,a=2*Math.PI/i,l=-Math.PI/2,c=Math.max(.1,Math.min(.9,r));for(let x=0;x<i;x++){const y=l+a*x,b=x%2===0?1:c;s.push({x:Math.cos(y)*b,y:Math.sin(y)*b})}let d=1/0,u=-1/0,p=1/0,h=-1/0;for(const x of s)d=Math.min(d,x.x),u=Math.max(u,x.x),p=Math.min(p,x.y),h=Math.max(h,x.y);const f=u-d,m=h-p,g=e/f,v=n/m;return s.map(x=>({x:(x.x-d)*g,y:(x.y-p)*v}))}function m5(t,e){const n=t/2,r=e/2,s=n,i=r;return`M ${s-n},${i} A ${n},${r} 0 1,1 ${s+n},${i} A ${n},${r} 0 1,1 ${s-n},${i} Z`}function j1(t,e,n,r){if(t.length<3)return"";let s=1/0;for(let h=0;h<t.length;h++){const f=t[h],m=t[(h+1)%t.length],g=Math.sqrt(Math.pow(m.x-f.x,2)+Math.pow(m.y-f.y,2));s=Math.min(s,g)}const i=s/2,a=e/100*i;if(a<1)return`M ${t.map(h=>`${h.x},${h.y}`).join(" L ")} Z`;const l=[];for(let h=0;h<t.length;h++){const f=t[(h-1+t.length)%t.length],m=t[h],g=t[(h+1)%t.length],v=Zu({x:f.x-m.x,y:f.y-m.y}),x=Zu({x:g.x-m.x,y:g.y-m.y}),y={x:m.x+v.x*a,y:m.y+v.y*a},b={x:m.x+x.x*a,y:m.y+x.y*a};h===0?l.push(`M ${y.x},${y.y}`):l.push(`L ${y.x},${y.y}`),l.push(`Q ${m.x},${m.y} ${b.x},${b.y}`)}const c=t[t.length-1],d=t[0],u=Zu({x:c.x-d.x,y:c.y-d.y}),p={x:d.x+u.x*a,y:d.y+u.y*a};return l.push(`L ${p.x},${p.y}`),l.push("Z"),l.join(" ")}function Zu(t){const e=Math.sqrt(t.x*t.x+t.y*t.y);return e===0?{x:0,y:0}:{x:t.x/e,y:t.y/e}}function g5(t,e=!1){if(e)return t===5?"Star":`${t}-Point Star`;const n={3:"Triangle",4:"Rectangle",5:"Pentagon",6:"Hexagon",7:"Heptagon",8:"Octagon",9:"Nonagon",10:"Decagon",12:"Dodecagon"};return t>=32?"Circle":n[t]?n[t]:`${t}-gon`}function y5(t,e=!1){return e?"":t>=32?"":t===3?"":t===4?"":t===5?"":t===6?"":`${t}`}function G0({shape:t,isSelected:e,onMouseDown:n,onTouchStart:r,onDoubleClick:s,onScaleStart:i,onRotateStart:a}){const{sides:l,width_mm:c,height_mm:d,cornerRadius:u,starMode:p,innerRadius:h,position:f,rotation:m,fillColor:g,strokeEnabled:v,strokeColor:x,strokeWidth_mm:y}=t,b=O.useMemo(()=>k1(l,c,d,u,p,h),[l,c,d,u,p,h]),w=c/2,j=d/2,_=`translate(${f.x}, ${f.y}) rotate(${m||0}, ${w}, ${j})`;return o.jsxs("g",{className:`shape-element ${e?"shape-element--selected":""}`,transform:_,style:{cursor:"move"},children:[o.jsx("path",{d:b,fill:(g==null?void 0:g.hex)||"#609B63",stroke:v&&x?x.hex:"none",strokeWidth:v?y:0,pointerEvents:"none"}),o.jsx("path",{d:b,fill:"transparent",stroke:"transparent",strokeWidth:Math.max(y,100),pointerEvents:"all",onMouseDown:n,onTouchStart:r,onDoubleClick:s,style:{cursor:"move"}}),e&&o.jsx("rect",{x:"-10",y:"-10",width:c+20,height:d+20,fill:"none",stroke:"#3b82f6",strokeWidth:"80",strokeDasharray:"400 400",opacity:"0.7",pointerEvents:"none"}),e&&o.jsx(x5,{width:c,height:d,onScaleStart:i,onRotateStart:a})]})}function x5({width:t,height:e,onScaleStart:n,onRotateStart:r}){const s=Math.min(t,e)*.08,l=Math.max(150,Math.min(400,s)),c=[{x:t/2-l/2,y:-l/2,corner:"n",cursor:"ns-resize"},{x:t/2-l/2,y:e-l/2,corner:"s",cursor:"ns-resize"},{x:t-l/2,y:e/2-l/2,corner:"e",cursor:"ew-resize"},{x:-l/2,y:e/2-l/2,corner:"w",cursor:"ew-resize"}],d=l*2.5,u=l*.8;return o.jsxs("g",{className:"shape-handles",children:[c.map(p=>o.jsx("rect",{x:p.x,y:p.y,width:l,height:l,fill:"#3b82f6",stroke:"#fff",strokeWidth:"20",rx:l/4,style:{cursor:p.cursor},pointerEvents:"all",onMouseDown:h=>{h.stopPropagation(),n==null||n(h,p.corner)},onTouchStart:h=>{h.stopPropagation(),n==null||n(h,p.corner)}},p.corner)),o.jsx("line",{x1:t/2,y1:0,x2:t/2,y2:-d+u/2,stroke:"#3b82f6",strokeWidth:"30",pointerEvents:"none"}),o.jsx("circle",{cx:t/2,cy:-d,r:u,fill:"#3b82f6",stroke:"#fff",strokeWidth:"20",style:{cursor:"grab"},pointerEvents:"all",onMouseDown:p=>{p.stopPropagation(),r==null||r(p)},onTouchStart:p=>{p.stopPropagation(),r==null||r(p)}}),o.jsx("path",{d:`M ${t/2-u*.4} ${-d}
            A ${u*.4} ${u*.4} 0 1 1
            ${t/2+u*.4} ${-d}`,fill:"none",stroke:"#fff",strokeWidth:"25",strokeLinecap:"round",pointerEvents:"none"}),o.jsx("polygon",{points:`${t/2+u*.4},${-d-u*.25}
                 ${t/2+u*.4},${-d+u*.25}
                 ${t/2+u*.65},${-d}`,fill:"#fff",pointerEvents:"none"})]})}function C1({controlPoints:t,width:e,height:n,onPointDrag:r,onHandleDrag:s,onDragEnd:i,showHandles:a=!0,selectedPointIndex:l,onPointSelect:c,onPointDelete:d}){const[u,p]=O.useState(null),[h,f]=O.useState(null),m=Math.min(e,n)*.03,x=Math.max(60,Math.min(120,m)),y=x*.7,b=O.useCallback((_,S)=>{_.stopPropagation(),_.preventDefault(),c==null||c(S),p({type:"point",index:S}),f({x:_.clientX,y:_.clientY})},[c]),w=O.useCallback((_,S)=>{_.preventDefault(),_.stopPropagation(),d==null||d(S)},[d]),j=O.useCallback((_,S,E)=>{_.stopPropagation(),_.preventDefault(),p({type:"handle",index:S,handleType:E}),f({x:_.clientX,y:_.clientY})},[]);return O.useEffect(()=>{if(!u)return;const _=E=>{if(!h)return;const T=document.querySelector(".court-canvas__svg");if(!T)return;const M=T.getBoundingClientRect(),Z=T.viewBox.baseVal,N=Z.width/M.width,G=Z.height/M.height,C=(E.clientX-h.x)*N,F=(E.clientY-h.y)*G;if(u.type==="point"){const pe=t[u.index],V=pe.x+C/e,J=pe.y+F/n;r==null||r(u.index,V,J)}else if(u.type==="handle"){const V=t[u.index][u.handleType],J=V.x+C/e,I=V.y+F/n;s==null||s(u.index,u.handleType,J,I)}f({x:E.clientX,y:E.clientY})},S=()=>{p(null),f(null),i==null||i()};return window.addEventListener("mousemove",_),window.addEventListener("mouseup",S),()=>{window.removeEventListener("mousemove",_),window.removeEventListener("mouseup",S)}},[u,h,t,e,n,r,s,i]),!t||t.length===0?null:o.jsx("g",{className:"blob-edit-handles",children:t.map((_,S)=>{const E=_.x*e,T=_.y*n,M=E+_.handleIn.x*e,Z=T+_.handleIn.y*n,N=E+_.handleOut.x*e,G=T+_.handleOut.y*n,C=(u==null?void 0:u.type)==="point"&&(u==null?void 0:u.index)===S,F=(u==null?void 0:u.type)==="handle"&&(u==null?void 0:u.index)===S&&(u==null?void 0:u.handleType)==="handleIn",pe=(u==null?void 0:u.type)==="handle"&&(u==null?void 0:u.index)===S&&(u==null?void 0:u.handleType)==="handleOut",V=l===S;return o.jsxs("g",{className:"blob-control-point-group",children:[a&&o.jsxs(o.Fragment,{children:[o.jsx("line",{x1:E,y1:T,x2:M,y2:Z,stroke:"#94a3b8",strokeWidth:"20",strokeDasharray:"60 40",pointerEvents:"none",opacity:"0.8"}),o.jsx("line",{x1:E,y1:T,x2:N,y2:G,stroke:"#94a3b8",strokeWidth:"20",strokeDasharray:"60 40",pointerEvents:"none",opacity:"0.8"}),o.jsx("circle",{cx:M,cy:Z,r:y,fill:F?"#f97316":"#ffffff",stroke:"#64748b",strokeWidth:"15",style:{cursor:"crosshair"},pointerEvents:"all",onMouseDown:J=>j(J,S,"handleIn")}),o.jsx("circle",{cx:N,cy:G,r:y,fill:pe?"#f97316":"#ffffff",stroke:"#64748b",strokeWidth:"15",style:{cursor:"crosshair"},pointerEvents:"all",onMouseDown:J=>j(J,S,"handleOut")})]}),o.jsx("circle",{cx:E,cy:T,r:x,fill:V?"#ef4444":C?"#f97316":"#3b82f6",stroke:"#ffffff",strokeWidth:"20",style:{cursor:"move"},pointerEvents:"all",onMouseDown:J=>b(J,S),onContextMenu:J=>w(J,S)}),o.jsx("text",{x:E,y:T+x*.35,textAnchor:"middle",fontSize:x*.8,fill:"#ffffff",fontWeight:"bold",pointerEvents:"none",children:S+1})]},S)})})}function V0({shape:t,isSelected:e,onMouseDown:n,onTouchStart:r,onDoubleClick:s,onScaleStart:i,onRotateStart:a,onPointDrag:l,onHandleDrag:c,onDragEnd:d,selectedPointIndex:u,onPointSelect:p,onPointDelete:h}){const{controlPoints:f,width_mm:m,height_mm:g,position:v,rotation:x,fillColor:y,strokeEnabled:b,strokeColor:w,strokeWidth_mm:j,editPointsVisible:_}=t,S=O.useMemo(()=>PE(f,m,g),[f,m,g]),E=m/2,T=g/2,M=`translate(${v.x}, ${v.y}) rotate(${x||0}, ${E}, ${T})`;return o.jsxs("g",{className:`blob-element ${e?"blob-element--selected":""}`,transform:M,style:{cursor:"move"},children:[o.jsx("path",{d:S,fill:(y==null?void 0:y.hex)||"#609B63",stroke:b&&w?w.hex:"none",strokeWidth:b?j:0,pointerEvents:"none"}),o.jsx("path",{d:S,fill:"transparent",stroke:"transparent",strokeWidth:Math.max(j||0,100),pointerEvents:"all",onTouchStart:r,onMouseDown:n,onDoubleClick:s,style:{cursor:"move"}}),e&&o.jsx("rect",{x:"-10",y:"-10",width:m+20,height:g+20,fill:"none",stroke:"#3b82f6",strokeWidth:"80",strokeDasharray:"400 400",opacity:"0.7",pointerEvents:"none"}),e&&o.jsx(v5,{width:m,height:g,onScaleStart:i,onRotateStart:a}),e&&f&&_&&o.jsx(C1,{controlPoints:f,width:m,height:g,onPointDrag:l,onHandleDrag:c,onDragEnd:d,showHandles:!0,selectedPointIndex:u,onPointSelect:p,onPointDelete:h})]})}function v5({width:t,height:e,onScaleStart:n,onRotateStart:r}){const s=Math.min(t,e)*.08,l=Math.max(150,Math.min(400,s)),c=[{x:-l/2,y:-l/2,corner:"nw",cursor:"nwse-resize"},{x:t-l/2,y:-l/2,corner:"ne",cursor:"nesw-resize"},{x:-l/2,y:e-l/2,corner:"sw",cursor:"nesw-resize"},{x:t-l/2,y:e-l/2,corner:"se",cursor:"nwse-resize"}],d=l*2.5,u=l*.8;return o.jsxs("g",{className:"blob-resize-handles",children:[c.map(p=>o.jsx("rect",{x:p.x,y:p.y,width:l,height:l,fill:"#3b82f6",stroke:"#fff",strokeWidth:"20",rx:l/4,style:{cursor:p.cursor},pointerEvents:"all",onMouseDown:h=>{h.stopPropagation(),n==null||n(h,p.corner)},onTouchStart:h=>{h.stopPropagation(),n==null||n(h,p.corner)}},p.corner)),o.jsx("line",{x1:t/2,y1:0,x2:t/2,y2:-d+u/2,stroke:"#3b82f6",strokeWidth:"30",pointerEvents:"none"}),o.jsx("circle",{cx:t/2,cy:-d,r:u,fill:"#3b82f6",stroke:"#fff",strokeWidth:"20",style:{cursor:"grab"},pointerEvents:"all",onMouseDown:p=>{p.stopPropagation(),r==null||r(p)},onTouchStart:p=>{p.stopPropagation(),r==null||r(p)}}),o.jsx("path",{d:`M ${t/2-u*.4} ${-d}
            A ${u*.4} ${u*.4} 0 1 1
            ${t/2+u*.4} ${-d}`,fill:"none",stroke:"#fff",strokeWidth:"25",strokeLinecap:"round",pointerEvents:"none"}),o.jsx("polygon",{points:`${t/2+u*.4},${-d-u*.25}
                 ${t/2+u*.4},${-d+u*.25}
                 ${t/2+u*.65},${-d}`,fill:"#fff",pointerEvents:"none"})]})}function Y0({shape:t,isSelected:e,onMouseDown:n,onTouchStart:r,onDoubleClick:s,onScaleStart:i,onRotateStart:a,onPointDrag:l,onHandleDrag:c,onDragEnd:d,selectedPointIndex:u,onPointSelect:p,onPointDelete:h}){const{controlPoints:f,width_mm:m,height_mm:g,position:v,rotation:x,fillColor:y,strokeEnabled:b,strokeColor:w,strokeWidth_mm:j,editPointsVisible:_,closed:S,smooth:E}=t,T=O.useMemo(()=>!f||f.length<2?"":v1(f,m,g,S,E),[f,m,g,S,E]),M=m/2,Z=g/2,N=`translate(${v.x}, ${v.y}) rotate(${x||0}, ${M}, ${Z})`;return T?o.jsxs("g",{className:`path-element ${e?"path-element--selected":""}`,transform:N,style:{cursor:"move"},children:[o.jsx("path",{d:T,fill:S?(y==null?void 0:y.hex)||"#609B63":"none",stroke:b&&w?w.hex:S?"none":(y==null?void 0:y.hex)||"#609B63",strokeWidth:b?j:S?0:50,strokeLinecap:"round",strokeLinejoin:"round",pointerEvents:"none"}),o.jsx("path",{d:T,fill:"transparent",stroke:"transparent",strokeWidth:Math.max(j||0,200),pointerEvents:"all",onTouchStart:r,onMouseDown:n,onDoubleClick:s,style:{cursor:"move"}}),e&&o.jsx("rect",{x:"-10",y:"-10",width:m+20,height:g+20,fill:"none",stroke:"#3b82f6",strokeWidth:"80",strokeDasharray:"400 400",opacity:"0.7",pointerEvents:"none"}),e&&o.jsx(b5,{width:m,height:g,onScaleStart:i,onRotateStart:a}),e&&f&&_&&o.jsx(C1,{controlPoints:f,width:m,height:g,onPointDrag:l,onHandleDrag:c,onDragEnd:d,showHandles:E,selectedPointIndex:u,onPointSelect:p,onPointDelete:h})]}):null}function b5({width:t,height:e,onScaleStart:n,onRotateStart:r}){const s=Math.min(t,e)*.08,l=Math.max(150,Math.min(400,s)),c=[{x:-l/2,y:-l/2,corner:"nw",cursor:"nwse-resize"},{x:t-l/2,y:-l/2,corner:"ne",cursor:"nesw-resize"},{x:-l/2,y:e-l/2,corner:"sw",cursor:"nesw-resize"},{x:t-l/2,y:e-l/2,corner:"se",cursor:"nwse-resize"}],d=l*2.5,u=l*.8;return o.jsxs("g",{className:"path-resize-handles",children:[c.map(p=>o.jsx("rect",{x:p.x,y:p.y,width:l,height:l,fill:"#3b82f6",stroke:"#fff",strokeWidth:"20",rx:l/4,style:{cursor:p.cursor},pointerEvents:"all",onMouseDown:h=>{h.stopPropagation(),n==null||n(h,p.corner)},onTouchStart:h=>{h.stopPropagation(),n==null||n(h,p.corner)}},p.corner)),o.jsx("line",{x1:t/2,y1:0,x2:t/2,y2:-d+u/2,stroke:"#3b82f6",strokeWidth:"30",pointerEvents:"none"}),o.jsx("circle",{cx:t/2,cy:-d,r:u,fill:"#3b82f6",stroke:"#fff",strokeWidth:"20",style:{cursor:"grab"},pointerEvents:"all",onMouseDown:p=>{p.stopPropagation(),r==null||r(p)},onTouchStart:p=>{p.stopPropagation(),r==null||r(p)}}),o.jsx("path",{d:`M ${t/2-u*.4} ${-d}
            A ${u*.4} ${u*.4} 0 1 1
            ${t/2+u*.4} ${-d}`,fill:"none",stroke:"#fff",strokeWidth:"25",strokeLinecap:"round",pointerEvents:"none"}),o.jsx("polygon",{points:`${t/2+u*.4},${-d-u*.25}
                 ${t/2+u*.4},${-d+u*.25}
                 ${t/2+u*.65},${-d}`,fill:"#fff",pointerEvents:"none"})]})}function Hs(t,e,n,r="normal",s="normal"){Hs._canvas||(Hs._canvas=document.createElement("canvas"),Hs._ctx=Hs._canvas.getContext("2d"));const i=Hs._ctx,a=s==="italic"?"italic ":"",l=r==="bold"?"bold ":"";i.font=`${a}${l}${n}px ${e}`;const c=i.measureText(t||"Double-click to edit");return{width:Math.max(c.width,100),height:n*1.2}}function w5(){return[{name:"Open Sans",family:"Open Sans, sans-serif"},{name:"Roboto",family:"Roboto, sans-serif"},{name:"Montserrat",family:"Montserrat, sans-serif"},{name:"Oswald",family:"Oswald, sans-serif"},{name:"Black Ops One",family:"Black Ops One, sans-serif"},{name:"Playfair Display",family:"Playfair Display, serif"},{name:"Arial",family:"Arial, sans-serif"},{name:"Georgia",family:"Georgia, serif"},{name:"Impact",family:"Impact, sans-serif"}]}function q0({text:t,isSelected:e,isEditing:n,onMouseDown:r,onTouchStart:s,onDoubleClick:i,onScaleStart:a,onRotateStart:l,onContentChange:c,onEditComplete:d}){const u=O.useRef(null),{content:p,fontFamily:h,fontSize_mm:f,fontWeight:m,fontStyle:g,textAlign:v,position:x,rotation:y,fillColor:b,strokeColor:w,strokeWidth_mm:j}=t,_=O.useMemo(()=>Hs(p,h,f,m,g),[p,h,f,m,g]),S=O.useMemo(()=>{switch(v){case"center":return-_.width/2;case"right":return-_.width;default:return 0}},[v,_.width]),E=`translate(${x.x}, ${x.y}) rotate(${y||0})`;O.useEffect(()=>{n&&u.current&&(u.current.focus(),u.current.select())},[n]);const T=Z=>{(Z.key==="Enter"||Z.key==="Escape")&&(Z.preventDefault(),d==null||d())},M=p||"Double-click to edit";return o.jsxs("g",{className:`text-element ${e?"text-element--selected":""} ${n?"text-element--editing":""}`,transform:E,children:[n?o.jsx("foreignObject",{x:S-10,y:-f*.85,width:Math.max(_.width+200,500),height:f*1.5,style:{overflow:"visible"},children:o.jsx("input",{ref:u,type:"text",value:p,onChange:Z=>c==null?void 0:c(Z.target.value),onBlur:d,onKeyDown:T,style:{fontFamily:h,fontSize:`${f}px`,fontWeight:m,fontStyle:g,color:(b==null?void 0:b.hex)||"#1C1C1C",background:"rgba(255,255,255,0.95)",border:"4px solid #3b82f6",borderRadius:"4px",outline:"none",padding:"4px 8px",width:"100%",boxSizing:"border-box",lineHeight:1}})}):o.jsxs(o.Fragment,{children:[o.jsx("text",{x:"0",y:"0",fontFamily:h,fontSize:f,fontWeight:m,fontStyle:g,textAnchor:v==="center"?"middle":v==="right"?"end":"start",fill:(b==null?void 0:b.hex)||"#1C1C1C",stroke:(w==null?void 0:w.hex)||"none",strokeWidth:j||0,strokeLinejoin:"round",strokeLinecap:"round",paintOrder:"stroke fill",style:{cursor:"move",userSelect:"none"},pointerEvents:"none",children:M}),o.jsx("rect",{x:S-20,y:-f*.85,width:_.width+40,height:f*1.2,fill:"transparent",onMouseDown:r,onTouchStart:s,onDoubleClick:i,style:{cursor:"move"}})]}),e&&!n&&o.jsx("rect",{x:S-40,y:-f-40,width:_.width+80,height:f*1.2+80,fill:"none",stroke:"#3b82f6",strokeWidth:"60",strokeDasharray:"300 300",opacity:"0.7",pointerEvents:"none"}),e&&!n&&o.jsx(_5,{bounds:_,fontSize:f,alignOffset:S,onScaleStart:a,onRotateStart:l})]})}function _5({bounds:t,fontSize:e,alignOffset:n,onScaleStart:r,onRotateStart:s}){const i=Math.min(t.width,e)*.15,c=Math.max(100,Math.min(300,i)),d=n-20,u=-e-20,p=t.width+40,h=e*1.2+40,f=[{x:d-c/2,y:u-c/2,corner:"nw",cursor:"nwse-resize"},{x:d+p-c/2,y:u-c/2,corner:"ne",cursor:"nesw-resize"},{x:d-c/2,y:u+h-c/2,corner:"sw",cursor:"nesw-resize"},{x:d+p-c/2,y:u+h-c/2,corner:"se",cursor:"nwse-resize"}],m=c*2.5,g=c*.8,v=d+p/2;return o.jsxs("g",{className:"text-handles",children:[f.map(x=>o.jsx("rect",{x:x.x,y:x.y,width:c,height:c,fill:"#3b82f6",stroke:"#fff",strokeWidth:"15",rx:c/4,style:{cursor:x.cursor},pointerEvents:"all",onMouseDown:y=>{y.stopPropagation(),r==null||r(y,x.corner)},onTouchStart:y=>{y.stopPropagation(),r==null||r(y,x.corner)}},x.corner)),o.jsx("line",{x1:v,y1:u,x2:v,y2:u-m+g/2,stroke:"#3b82f6",strokeWidth:"25",pointerEvents:"none"}),o.jsx("circle",{cx:v,cy:u-m,r:g,fill:"#3b82f6",stroke:"#fff",strokeWidth:"15",style:{cursor:"grab"},pointerEvents:"all",onMouseDown:x=>{x.stopPropagation(),s==null||s(x)},onTouchStart:x=>{x.stopPropagation(),s==null||s(x)}}),o.jsx("path",{d:`M ${v-g*.4} ${u-m}
            A ${g*.4} ${g*.4} 0 1 1
            ${v+g*.4} ${u-m}`,fill:"none",stroke:"#fff",strokeWidth:"20",strokeLinecap:"round",pointerEvents:"none"}),o.jsx("polygon",{points:`${v+g*.4},${u-m-g*.25}
                 ${v+g*.4},${u-m+g*.25}
                 ${v+g*.65},${u-m}`,fill:"#fff",pointerEvents:"none"})]})}function S5({zone:t,isSelected:e,onMouseDown:n,onTouchStart:r,onDoubleClick:s,onScaleStart:i,onRotateStart:a}){const{id:l,shapeType:c,sides:d,width_mm:u,height_mm:p,cornerRadius:h,position:f,rotation:m,controlPoints:g}=t,v=`exclusion-crosshatch-${l}`,x=O.useMemo(()=>c==="path"&&g?v1(g,u,p,!0):k1(d||4,u,p,h||0),[c,d,u,p,h,g]),y=u/2,b=p/2,w=`translate(${f.x}, ${f.y}) rotate(${m||0}, ${y}, ${b})`,j=Math.min(u,p)*.02,E=Math.max(100,Math.min(500,j)),T=E*.15;return o.jsxs("g",{className:`exclusion-zone-element ${e?"exclusion-zone-element--selected":""}`,transform:w,style:{cursor:"move"},children:[o.jsx("defs",{children:o.jsxs("pattern",{id:v,patternUnits:"userSpaceOnUse",width:E,height:E,patternTransform:"rotate(45)",children:[o.jsx("rect",{width:E,height:E,fill:"#e5e5e5"}),o.jsx("line",{x1:"0",y1:"0",x2:"0",y2:E,stroke:"#999",strokeWidth:T}),o.jsx("line",{x1:E/2,y1:"0",x2:E/2,y2:E,stroke:"#999",strokeWidth:T})]})}),o.jsx("path",{d:x,fill:`url(#${v})`,stroke:"#666",strokeWidth:"60",strokeDasharray:"200 100",pointerEvents:"none"}),o.jsx("path",{d:x,fill:"transparent",stroke:"transparent",strokeWidth:"200",pointerEvents:"all",onMouseDown:n,onTouchStart:r,onDoubleClick:s,style:{cursor:"move"}}),e&&o.jsx("rect",{x:"-10",y:"-10",width:u+20,height:p+20,fill:"none",stroke:"#ef4444",strokeWidth:"80",strokeDasharray:"400 400",opacity:"0.7",pointerEvents:"none"}),e&&o.jsx(k5,{width:u,height:p,onScaleStart:i,onRotateStart:a})]})}function k5({width:t,height:e,onScaleStart:n,onRotateStart:r}){const s=Math.min(t,e)*.08,l=Math.max(150,Math.min(400,s)),c=[{x:t/2-l/2,y:-l/2,corner:"n",cursor:"ns-resize"},{x:t/2-l/2,y:e-l/2,corner:"s",cursor:"ns-resize"},{x:t-l/2,y:e/2-l/2,corner:"e",cursor:"ew-resize"},{x:-l/2,y:e/2-l/2,corner:"w",cursor:"ew-resize"}],d=l*2.5,u=l*.8;return o.jsxs("g",{className:"exclusion-zone-handles",children:[c.map(p=>o.jsx("rect",{x:p.x,y:p.y,width:l,height:l,fill:"#ef4444",stroke:"#fff",strokeWidth:"20",rx:l/4,style:{cursor:p.cursor},pointerEvents:"all",onMouseDown:h=>{h.stopPropagation(),n==null||n(h,p.corner)},onTouchStart:h=>{h.stopPropagation(),n==null||n(h,p.corner)}},p.corner)),o.jsx("line",{x1:t/2,y1:0,x2:t/2,y2:-d+u/2,stroke:"#ef4444",strokeWidth:"30",pointerEvents:"none"}),o.jsx("circle",{cx:t/2,cy:-d,r:u,fill:"#ef4444",stroke:"#fff",strokeWidth:"20",style:{cursor:"grab"},pointerEvents:"all",onMouseDown:p=>{p.stopPropagation(),r==null||r(p)},onTouchStart:p=>{p.stopPropagation(),r==null||r(p)}}),o.jsx("path",{d:`M ${t/2-u*.4} ${-d}
            A ${u*.4} ${u*.4} 0 1 1
            ${t/2+u*.4} ${-d}`,fill:"none",stroke:"#fff",strokeWidth:"25",strokeLinecap:"round",pointerEvents:"none"}),o.jsx("polygon",{points:`${t/2+u*.4},${-d-u*.25}
                 ${t/2+u*.4},${-d+u*.25}
                 ${t/2+u*.65},${-d}`,fill:"#fff",pointerEvents:"none"})]})}function j5({groupId:t,scale:e=1,onDragStart:n,onScaleStart:r,screenToSVG:s}){const{groups:i,selectedGroupId:a,editingGroupId:l,shapes:c,selectGroup:d,enterGroup:u,updateGroupPosition:p,commitGroupMove:h}=lt(),f=i[t];if(!f||!f.bounds||l===t)return null;const m=a===t,{x:g,y:v,width:x,height:y}=f.bounds,b=8/e,w=b/2,j=E=>{if(E.stopPropagation(),d(t),!f.locked&&n&&s){const T=E.touches?E.touches[0].clientX:E.clientX,M=E.touches?E.touches[0].clientY:E.clientY,Z=s(T,M);n(t,{x:Z.x-f.bounds.x,y:Z.y-f.bounds.y})}},_=E=>{E.stopPropagation(),u(t)},S=(E,T)=>{E.stopPropagation(),r&&r(E,t,T)};return f.childIds.map(E=>c[E]).filter(Boolean),o.jsxs("g",{className:"group-element",children:[o.jsx("rect",{x:g,y:v,width:x,height:y,fill:"transparent",stroke:m?"#9333ea":"#a855f7",strokeWidth:m?2/e:1/e,strokeDasharray:m?"none":`${4/e} ${4/e}`,rx:4/e,ry:4/e,style:{cursor:"move"},onMouseDown:j,onTouchStart:j,onDoubleClick:_}),!m&&o.jsx("text",{x:g+4/e,y:v-4/e,fontSize:10/e,fill:"#9333ea",fontFamily:"system-ui, -apple-system, sans-serif",fontWeight:"500",children:f.compoundType?`${f.compoundType.charAt(0).toUpperCase()+f.compoundType.slice(1)} Group`:f.customName||"Group"}),m&&o.jsxs(o.Fragment,{children:[o.jsx("rect",{x:g-w,y:v-w,width:b,height:b,fill:"white",stroke:"#9333ea",strokeWidth:1.5/e,rx:2/e,style:{cursor:"nwse-resize"},onMouseDown:E=>S(E,"nw"),onTouchStart:E=>S(E,"nw")}),o.jsx("rect",{x:g+x-w,y:v-w,width:b,height:b,fill:"white",stroke:"#9333ea",strokeWidth:1.5/e,rx:2/e,style:{cursor:"nesw-resize"},onMouseDown:E=>S(E,"ne"),onTouchStart:E=>S(E,"ne")}),o.jsx("rect",{x:g-w,y:v+y-w,width:b,height:b,fill:"white",stroke:"#9333ea",strokeWidth:1.5/e,rx:2/e,style:{cursor:"nesw-resize"},onMouseDown:E=>S(E,"sw"),onTouchStart:E=>S(E,"sw")}),o.jsx("rect",{x:g+x-w,y:v+y-w,width:b,height:b,fill:"white",stroke:"#9333ea",strokeWidth:1.5/e,rx:2/e,style:{cursor:"nwse-resize"},onMouseDown:E=>S(E,"se"),onTouchStart:E=>S(E,"se")}),o.jsx("rect",{x:g+x/2-w,y:v-w,width:b,height:b,fill:"white",stroke:"#9333ea",strokeWidth:1.5/e,rx:2/e,style:{cursor:"ns-resize"},onMouseDown:E=>S(E,"n"),onTouchStart:E=>S(E,"n")}),o.jsx("rect",{x:g+x/2-w,y:v+y-w,width:b,height:b,fill:"white",stroke:"#9333ea",strokeWidth:1.5/e,rx:2/e,style:{cursor:"ns-resize"},onMouseDown:E=>S(E,"s"),onTouchStart:E=>S(E,"s")}),o.jsx("rect",{x:g-w,y:v+y/2-w,width:b,height:b,fill:"white",stroke:"#9333ea",strokeWidth:1.5/e,rx:2/e,style:{cursor:"ew-resize"},onMouseDown:E=>S(E,"w"),onTouchStart:E=>S(E,"w")}),o.jsx("rect",{x:g+x-w,y:v+y/2-w,width:b,height:b,fill:"white",stroke:"#9333ea",strokeWidth:1.5/e,rx:2/e,style:{cursor:"ew-resize"},onMouseDown:E=>S(E,"e"),onTouchStart:E=>S(E,"e")}),o.jsx("line",{x1:g+x/2,y1:v,x2:g+x/2,y2:v-20/e,stroke:"#9333ea",strokeWidth:1.5/e}),o.jsx("circle",{cx:g+x/2,cy:v-24/e,r:b/2,fill:"white",stroke:"#9333ea",strokeWidth:1.5/e,style:{cursor:"grab"}}),o.jsx("text",{x:g+x/2,y:v-32/e,fontSize:10/e,fill:"#9333ea",fontFamily:"system-ui, -apple-system, sans-serif",fontWeight:"600",textAnchor:"middle",children:f.compoundType?`${f.compoundType.charAt(0).toUpperCase()+f.compoundType.slice(1)}`:f.customName||"Group"}),o.jsxs("g",{transform:`translate(${g+x-8/e}, ${v-8/e})`,children:[o.jsx("circle",{cx:0,cy:0,r:8/e,fill:"#9333ea"}),o.jsx("text",{x:0,y:0,fontSize:8/e,fill:"white",fontFamily:"system-ui, -apple-system, sans-serif",fontWeight:"600",textAnchor:"middle",dominantBaseline:"central",children:f.childIds.length})]})]})]})}function X0(t,e,n){if(!t||t.type==="rectangle"||!t.controlPoints)return null;const r=t.controlPoints;if(!r||r.length<3)return null;const s=r.map(a=>({x:a.x*e,y:a.y*n}));let i=`M ${s[0].x} ${s[0].y}`;for(let a=1;a<s.length;a++)i+=` L ${s[a].x} ${s[a].y}`;return i+=" Z",i}const C5=O.forwardRef(function(e,n){var Wm,Gm;const r=O.useRef(null),s=O.useRef(null);O.useImperativeHandle(n,()=>r.current);const[i,a]=O.useState(1),[l,c]=O.useState({x:0,y:0}),[d,u]=O.useState(!1),[p,h]=O.useState({x:0,y:0}),[f,m]=O.useState(!1),[g,v]=O.useState({active:!1,initialDistance:0,initialZoom:1,initialPan:{x:0,y:0},initialCenter:{x:0,y:0}}),[x,y]=O.useState(!1),[b,w]=O.useState(null),[j,_]=O.useState(null),[S,E]=O.useState(null),[T,M]=O.useState(null),[Z,N]=O.useState(null),[G,C]=O.useState(null),[F,pe]=O.useState(null),[V,J]=O.useState(null),[I,K]=O.useState(!1),[z,W]=O.useState(null),[fe,ue]=O.useState(null),[ne,ke]=O.useState(!1),[ce,$e]=O.useState(null),[ze,Ue]=O.useState(null),[Ge,at]=O.useState(!1),[Ve,k]=O.useState(null),[Q,oe]=O.useState(null),[D,P]=O.useState(!1),[$,Y]=O.useState(null),[se,B]=O.useState(null),[re,ye]=O.useState(!1),[le,U]=O.useState(null),[ae,xe]=O.useState(null),[Te,He]=O.useState(!1),[Ee,ie]=O.useState(null),[he,Xe]=O.useState(null),[tt,nt]=O.useState(!1),[yt,ht]=O.useState(null),[Fe,de]=O.useState(null),[te,me]=O.useState(!1),[Ye,xt]=O.useState(null),[Ce,wt]=O.useState(null),[pt,Ct]=O.useState(!1),[Ke,Xt]=O.useState(null),[bn,Nr]=O.useState(null),[Jn,Ps]=O.useState(null),[be,qe]=O.useState(0),[kt,rn]=O.useState(null),{surface:Ze,courts:Pr,tracks:_t,motifs:Ln,shapes:ft,texts:Kt,exclusionZones:Mt,elementOrder:cn,selectedCourtId:Qr,selectedTrackId:hs,selectedMotifId:Rr,selectedShapeId:Jt,selectedTextId:wn,selectedExclusionZoneId:es,editingTextId:_n,snapToGrid:Or,gridSize_mm:Qn,selectCourt:Dn,deselectCourt:xr,selectTrack:Ar,deselectTrack:Rs,selectMotif:ps,deselectMotif:di,selectShape:ts,deselectShape:Mr,selectText:er,deselectText:In,selectExclusionZone:fs,deselectExclusionZone:Sn,startEditingText:kn,stopEditingText:dn,updateCourtPosition:$r,updateTrackPosition:tr,updateMotifPosition:zn,updateMotifScale:jn,updateMotifRotation:nr,updateShapePosition:un,updateShapeDimensions:Cn,updateShapeRotation:$t,updateTextPosition:jt,updateTextFontSize:mn,updateTextRotation:Nt,updateTextContent:ns,updateExclusionZonePosition:Os,updateExclusionZoneDimensions:qi,updateExclusionZoneRotation:Pt,updateBlobControlPoint:Lr,updateBlobHandle:Xi,commitBlobEdit:ui,pathDrawingMode:En,activePathId:rr,addPointToPath:Ki,finishPath:hi,cancelPath:Qt,updatePathControlPoint:Tn,updatePathHandle:pi,commitPathEdit:As,removePointFromPath:sr,groups:ee,selectedGroupId:ve,selectedElementIds:Se,editingGroupId:Pe,selectGroup:ct,deselectGroup:et,enterGroup:Be,exitGroup:je,addToSelection:H,clearMultiSelection:we,updateGroupPosition:Ae,updateGroupScale:dt,commitGroupMove:gt}=lt(),De=(R,X)=>{const A=r.current,q=A.createSVGPoint();q.x=R,q.y=X;const Me=q.matrixTransform(A.getScreenCTM().inverse());return{x:Me.x,y:Me.y}},it=(R,X)=>{R.stopPropagation(),Dn(X);const A=Pr[X];if(A!=null&&A.locked)return;const q=R.touches?R.touches[0].clientX:R.clientX,Me=R.touches?R.touches[0].clientY:R.clientY,ge=De(q,Me);w({x:ge.x-A.position.x,y:ge.y-A.position.y}),_(X),y(!0)},Nn=(R,X)=>{R.stopPropagation(),Dn(X),lt.setState({showPropertiesPanel:!0,propertiesPanelUserClosed:!1})},ir=(R,X)=>{R.stopPropagation(),Ar(X);const A=_t[X];if(A!=null&&A.locked)return;const q=R.touches?R.touches[0].clientX:R.clientX,Me=R.touches?R.touches[0].clientY:R.clientY,ge=De(q,Me);w({x:ge.x-A.position.x,y:ge.y-A.position.y}),E(X),y(!0)},xa=(R,X)=>{R.stopPropagation(),Ar(X),lt.setState({showPropertiesPanel:!0,propertiesPanelUserClosed:!1})},en=(R,X)=>{R.stopPropagation(),ps(X);const A=Ln[X];if(A!=null&&A.locked)return;const q=R.touches?R.touches[0].clientX:R.clientX,Me=R.touches?R.touches[0].clientY:R.clientY,ge=De(q,Me);w({x:ge.x-A.position.x,y:ge.y-A.position.y}),M(X),y(!0)},Hl=(R,X)=>{R.stopPropagation(),ps(X),lt.setState({showPropertiesPanel:!0,propertiesPanelUserClosed:!1})},Ul=(R,X,A)=>{R.stopPropagation();const q=Ln[X];if(!q||q.locked)return;const Me=R.touches?R.touches[0].clientX:R.clientX,ge=R.touches?R.touches[0].clientY:R.clientY,Le=De(Me,ge),Ne=q.originalWidth_mm*(q.scale||1),_e=q.originalHeight_mm*(q.scale||1);let Re;switch(A){case"nw":Re={x:q.position.x+Ne,y:q.position.y+_e};break;case"ne":Re={x:q.position.x,y:q.position.y+_e};break;case"sw":Re={x:q.position.x+Ne,y:q.position.y};break;case"se":default:Re={x:q.position.x,y:q.position.y};break}const st=Math.sqrt(Math.pow(Le.x-Re.x,2)+Math.pow(Le.y-Re.y,2));ue({initialDistance:st,originalScale:q.scale||1,originalWidth:Ne,originalHeight:_e,corner:A,anchorPoint:Re}),W(X),K(!0)},i2=(R,X)=>{R.stopPropagation();const A=Ln[X];if(!A||A.locked)return;const q=R.touches?R.touches[0].clientX:R.clientX,Me=R.touches?R.touches[0].clientY:R.clientY,ge=De(q,Me),Le=A.originalWidth_mm*(A.scale||1),Ne=A.originalHeight_mm*(A.scale||1),_e={x:A.position.x+Le/2,y:A.position.y+Ne/2},Re=Math.atan2(ge.y-_e.y,ge.x-_e.x)*(180/Math.PI);Ue({initialAngle:Re,originalRotation:A.rotation||0,motifCenter:_e}),$e(X),ke(!0)},Dm=R=>{for(const[X,A]of Object.entries(ee))if(A.childIds.includes(R))return X;return null},o2=Dm,vr=(R,X)=>{R.stopPropagation();const A=o2(X);if(A&&Pe!==A){ct(A);const _e=ee[A];if(_e!=null&&_e.locked)return;const Re=R.touches?R.touches[0].clientX:R.clientX,st=R.touches?R.touches[0].clientY:R.clientY,ot=De(Re,st);w({x:ot.x-_e.bounds.x,y:ot.y-_e.bounds.y}),J(A),y(!0);return}if(R.shiftKey){H(X);return}Se.length>0&&we(),ts(X);const Me=ft[X];if(Me!=null&&Me.locked)return;const ge=R.touches?R.touches[0].clientX:R.clientX,Le=R.touches?R.touches[0].clientY:R.clientY,Ne=De(ge,Le);w({x:Ne.x-Me.position.x,y:Ne.y-Me.position.y}),N(X),y(!0)},Zi=(R,X)=>{R.stopPropagation(),ts(X),lt.setState({showPropertiesPanel:!0,propertiesPanelUserClosed:!1})},Ji=(R,X,A)=>{R.stopPropagation();const q=ft[X];if(!q||q.locked)return;const Me=R.touches?R.touches[0].clientX:R.clientX,ge=R.touches?R.touches[0].clientY:R.clientY,Le=De(Me,ge),{width_mm:Ne,height_mm:_e}=q;let Re;switch(A){case"n":Re={x:q.position.x+Ne/2,y:q.position.y+_e};break;case"s":Re={x:q.position.x+Ne/2,y:q.position.y};break;case"e":Re={x:q.position.x,y:q.position.y+_e/2};break;case"w":Re={x:q.position.x+Ne,y:q.position.y+_e/2};break;case"nw":Re={x:q.position.x+Ne,y:q.position.y+_e};break;case"ne":Re={x:q.position.x,y:q.position.y+_e};break;case"sw":Re={x:q.position.x+Ne,y:q.position.y};break;case"se":default:Re={x:q.position.x,y:q.position.y};break}const st=Math.sqrt(Math.pow(Le.x-Re.x,2)+Math.pow(Le.y-Re.y,2));oe({initialDistance:st,originalWidth:Ne,originalHeight:_e,aspectLocked:q.aspectLocked,corner:A,anchorPoint:Re}),k(X),at(!0)},Qi=(R,X)=>{R.stopPropagation();const A=ft[X];if(!A||A.locked)return;const q=R.touches?R.touches[0].clientX:R.clientX,Me=R.touches?R.touches[0].clientY:R.clientY,ge=De(q,Me),{width_mm:Le,height_mm:Ne}=A,_e={x:A.position.x+Le/2,y:A.position.y+Ne/2},Re=Math.atan2(ge.y-_e.y,ge.x-_e.x)*(180/Math.PI);B({initialAngle:Re,originalRotation:A.rotation||0,shapeCenter:_e}),Y(X),P(!0)},Wl=(R,X)=>{if(R.stopPropagation(),_n===X)return;const A=Dm(X);if(A&&Pe!==A){ct(A);const Ne=ee[A];if(Ne!=null&&Ne.locked)return;const _e=R.touches?R.touches[0].clientX:R.clientX,Re=R.touches?R.touches[0].clientY:R.clientY,st=De(_e,Re);w({x:st.x-Ne.bounds.x,y:st.y-Ne.bounds.y}),J(A),y(!0);return}er(X);const q=Kt[X];if(q!=null&&q.locked)return;const Me=R.touches?R.touches[0].clientX:R.clientX,ge=R.touches?R.touches[0].clientY:R.clientY,Le=De(Me,ge);w({x:Le.x-q.position.x,y:Le.y-q.position.y}),C(X),y(!0)},Im=(R,X)=>{R.stopPropagation(),er(X),kn(X)},zm=(R,X,A)=>{R.stopPropagation();const q=Kt[X];if(!q||q.locked)return;const Me=R.touches?R.touches[0].clientX:R.clientX,ge=R.touches?R.touches[0].clientY:R.clientY,Le=De(Me,ge),Ne=Hs(q.content,q.fontFamily,q.fontSize_mm,q.fontWeight,q.fontStyle);let _e=q.position.x;q.textAlign==="center"?_e-=Ne.width/2:q.textAlign==="right"&&(_e-=Ne.width);const Re=q.position.y-q.fontSize_mm;let st;switch(A){case"nw":st={x:_e+Ne.width,y:Re+q.fontSize_mm*1.2};break;case"ne":st={x:_e,y:Re+q.fontSize_mm*1.2};break;case"sw":st={x:_e+Ne.width,y:Re};break;case"se":default:st={x:_e,y:Re};break}const ot=Math.sqrt(Math.pow(Le.x-st.x,2)+Math.pow(Le.y-st.y,2));xe({initialDistance:ot,originalFontSize:q.fontSize_mm,originalPosition:{...q.position},originalBounds:Ne,textAlign:q.textAlign,corner:A,anchorPoint:st}),U(X),ye(!0)},Fm=(R,X)=>{R.stopPropagation();const A=Kt[X];if(!A||A.locked)return;const q=R.touches?R.touches[0].clientX:R.clientX,Me=R.touches?R.touches[0].clientY:R.clientY,ge=De(q,Me),Le=Hs(A.content,A.fontFamily,A.fontSize_mm,A.fontWeight,A.fontStyle);let Ne=A.position.x;A.textAlign==="center"?Ne=A.position.x:A.textAlign==="right"?Ne=A.position.x-Le.width/2:Ne=A.position.x+Le.width/2;const _e={x:Ne,y:A.position.y-A.fontSize_mm*.4},Re=Math.atan2(ge.y-_e.y,ge.x-_e.x)*(180/Math.PI);Xe({initialAngle:Re,originalRotation:A.rotation||0,textCenter:_e}),ie(X),He(!0)},Bm=(R,X)=>{R.stopPropagation(),fs(X);const A=Mt[X];if(A!=null&&A.locked)return;const q=R.touches?R.touches[0].clientX:R.clientX,Me=R.touches?R.touches[0].clientY:R.clientY,ge=De(q,Me);w({x:ge.x-A.position.x,y:ge.y-A.position.y}),pe(X),y(!0)},a2=(R,X)=>{R.stopPropagation(),fs(X),lt.setState({showPropertiesPanel:!0,propertiesPanelUserClosed:!1})},l2=(R,X,A)=>{R.stopPropagation();const q=Mt[X];if(!q||q.locked)return;const Me=R.touches?R.touches[0].clientX:R.clientX,ge=R.touches?R.touches[0].clientY:R.clientY,Le=De(Me,ge),{width_mm:Ne,height_mm:_e}=q;let Re;switch(A){case"n":Re={x:q.position.x+Ne/2,y:q.position.y+_e};break;case"s":Re={x:q.position.x+Ne/2,y:q.position.y};break;case"e":Re={x:q.position.x,y:q.position.y+_e/2};break;case"w":Re={x:q.position.x+Ne,y:q.position.y+_e/2};break;default:Re={x:q.position.x,y:q.position.y};break}const st=Math.sqrt(Math.pow(Le.x-Re.x,2)+Math.pow(Le.y-Re.y,2));de({initialDistance:st,originalWidth:Ne,originalHeight:_e,corner:A,anchorPoint:Re}),ht(X),nt(!0)},c2=(R,X)=>{R.stopPropagation();const A=Mt[X];if(!A||A.locked)return;const q=R.touches?R.touches[0].clientX:R.clientX,Me=R.touches?R.touches[0].clientY:R.clientY,ge=De(q,Me),{width_mm:Le,height_mm:Ne}=A,_e={x:A.position.x+Le/2,y:A.position.y+Ne/2},Re=Math.atan2(ge.y-_e.y,ge.x-_e.x)*(180/Math.PI);wt({initialAngle:Re,originalRotation:A.rotation||0,zoneCenter:_e}),xt(X),me(!0)},d2=(R,X,A)=>{R.stopPropagation();const q=ee[X];if(!q||q.locked)return;const Me=R.touches?R.touches[0].clientX:R.clientX,ge=R.touches?R.touches[0].clientY:R.clientY,Le=De(Me,ge),{x:Ne,y:_e,width:Re,height:st}=q.bounds;let ot;switch(A){case"n":ot={x:Ne+Re/2,y:_e+st};break;case"s":ot={x:Ne+Re/2,y:_e};break;case"e":ot={x:Ne,y:_e+st/2};break;case"w":ot={x:Ne+Re,y:_e+st/2};break;case"nw":ot={x:Ne+Re,y:_e+st};break;case"ne":ot={x:Ne,y:_e+st};break;case"sw":ot={x:Ne+Re,y:_e};break;case"se":default:ot={x:Ne,y:_e};break}const Ht=Math.sqrt(Math.pow(Le.x-ot.x,2)+Math.pow(Le.y-ot.y,2));Nr({initialDistance:Ht,originalBounds:{...q.bounds},corner:A,anchorPoint:ot}),Xt(X),Ct(!0)};O.useEffect(()=>{y(!1),_(null),E(null),M(null),N(null),C(null),pe(null),w(null)},[Ze.width_mm,Ze.length_mm]),O.useEffect(()=>{if(!x||!j&&!S&&!T&&!Z&&!G&&!F&&!V)return;const R=A=>{const q=A.touches?A.touches[0].clientX:A.clientX,Me=A.touches?A.touches[0].clientY:A.clientY,ge=De(q,Me);let Le={x:ge.x-b.x,y:ge.y-b.y};if(Or&&(Le=ZE(Le,Qn)),j){const Ne=Pr[j],_e={width_mm:Ne.template.dimensions.width_mm*Ne.scale,length_mm:Ne.template.dimensions.length_mm*Ne.scale};Le=vc(Le,_e,Ze),$r(j,Le)}else if(S)tr(S,Le);else if(T){const Ne=Ln[T],_e={width_mm:Ne.originalWidth_mm*(Ne.scale||1),length_mm:Ne.originalHeight_mm*(Ne.scale||1)};Le=vc(Le,_e,Ze),zn(T,Le)}else if(Z){const Ne=ft[Z],_e={width_mm:Ne.width_mm,length_mm:Ne.height_mm};Le=vc(Le,_e,Ze),un(Z,Le)}else if(G)jt(G,Le);else if(F){const Ne=Mt[F],_e={width_mm:Ne.width_mm,length_mm:Ne.height_mm};Le=vc(Le,_e,Ze),Os(F,Le)}else if(V){const Ne=ee[V];if(Ne){const _e=Le.x-Ne.bounds.x,Re=Le.y-Ne.bounds.y;Ae(V,_e,Re)}}},X=()=>{if(j||S||T||Z||G||F||V){const{addToHistory:A,commitGroupMove:q}=lt.getState();V&&q(V),A()}y(!1),_(null),E(null),M(null),N(null),C(null),pe(null),J(null),w(null)};return window.addEventListener("mousemove",R),window.addEventListener("mouseup",X),window.addEventListener("touchmove",R,{passive:!1}),window.addEventListener("touchend",X),window.addEventListener("touchcancel",X),()=>{window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",X),window.removeEventListener("touchmove",R),window.removeEventListener("touchend",X),window.removeEventListener("touchcancel",X)}},[x,j,S,T,Z,G,F,V,b,Pr,_t,Ln,ft,Kt,Mt,ee,Or,Qn,Ze,$r,tr,zn,un,jt,Os,Ae]),O.useEffect(()=>{if(!I||!z||!fe)return;const R=A=>{const q=A.touches?A.touches[0].clientX:A.clientX,Me=A.touches?A.touches[0].clientY:A.clientY,ge=De(q,Me),Le=Ln[z];if(!Le)return;const _e=Math.sqrt(Math.pow(ge.x-fe.anchorPoint.x,2)+Math.pow(ge.y-fe.anchorPoint.y,2))/fe.initialDistance;let Re=fe.originalScale*_e;Re=Math.max(.1,Re),Re=Math.round(Re*100)/100;const st=Le.originalWidth_mm*Re,ot=Le.originalHeight_mm*Re;let Ht;switch(fe.corner){case"nw":Ht={x:fe.anchorPoint.x-st,y:fe.anchorPoint.y-ot};break;case"ne":Ht={x:fe.anchorPoint.x,y:fe.anchorPoint.y-ot};break;case"sw":Ht={x:fe.anchorPoint.x-st,y:fe.anchorPoint.y};break;case"se":default:Ht={x:fe.anchorPoint.x,y:fe.anchorPoint.y};break}jn(z,Re),zn(z,Ht)},X=()=>{const{addToHistory:A}=lt.getState();A(),K(!1),W(null),ue(null)};return window.addEventListener("mousemove",R),window.addEventListener("mouseup",X),window.addEventListener("touchmove",R,{passive:!1}),window.addEventListener("touchend",X),window.addEventListener("touchcancel",X),()=>{window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",X),window.removeEventListener("touchmove",R),window.removeEventListener("touchend",X),window.removeEventListener("touchcancel",X)}},[I,z,fe,Ln,jn,zn]),O.useEffect(()=>{if(!ne||!ce||!ze)return;const R=A=>{const q=A.touches?A.touches[0].clientX:A.clientX,Me=A.touches?A.touches[0].clientY:A.clientY,ge=De(q,Me),Ne=Math.atan2(ge.y-ze.motifCenter.y,ge.x-ze.motifCenter.x)*(180/Math.PI)-ze.initialAngle;let _e=ze.originalRotation+Ne;_e=(_e%360+360)%360,A.shiftKey&&(_e=Math.round(_e/15)*15),_e=Math.round(_e*10)/10,nr(ce,_e)},X=()=>{const{addToHistory:A}=lt.getState();A(),ke(!1),$e(null),Ue(null)};return window.addEventListener("mousemove",R),window.addEventListener("mouseup",X),window.addEventListener("touchmove",R,{passive:!1}),window.addEventListener("touchend",X),window.addEventListener("touchcancel",X),()=>{window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",X),window.removeEventListener("touchmove",R),window.removeEventListener("touchend",X),window.removeEventListener("touchcancel",X)}},[ne,ce,ze,nr]),O.useEffect(()=>{if(!Ge||!Ve||!Q)return;const R=A=>{const q=A.touches?A.touches[0].clientX:A.clientX,Me=A.touches?A.touches[0].clientY:A.clientY,ge=De(q,Me);if(!ft[Ve])return;const _e=Math.sqrt(Math.pow(ge.x-Q.anchorPoint.x,2)+Math.pow(ge.y-Q.anchorPoint.y,2))/Q.initialDistance;let Re,st;const ot=Q.corner,Ht=["n","s","e","w"].includes(ot);if(Q.aspectLocked)Re=Q.originalWidth*_e,st=Q.originalHeight*_e;else if(Ht){const br=Math.abs(ge.y-Q.anchorPoint.y),va=Math.abs(ge.x-Q.anchorPoint.x);ot==="n"||ot==="s"?(Re=Q.originalWidth,st=Math.max(100,br)):(Re=Math.max(100,va),st=Q.originalHeight)}else{const br=Math.abs(ge.x-Q.anchorPoint.x),va=Math.abs(ge.y-Q.anchorPoint.y);Re=Math.max(100,br),st=Math.max(100,va)}Re=Math.round(Re),st=Math.round(st);let Et;switch(ot){case"n":Et={x:Q.anchorPoint.x-Re/2,y:Q.anchorPoint.y-st};break;case"s":Et={x:Q.anchorPoint.x-Re/2,y:Q.anchorPoint.y};break;case"e":Et={x:Q.anchorPoint.x,y:Q.anchorPoint.y-st/2};break;case"w":Et={x:Q.anchorPoint.x-Re,y:Q.anchorPoint.y-st/2};break;case"nw":Et={x:Q.anchorPoint.x-Re,y:Q.anchorPoint.y-st};break;case"ne":Et={x:Q.anchorPoint.x,y:Q.anchorPoint.y-st};break;case"sw":Et={x:Q.anchorPoint.x-Re,y:Q.anchorPoint.y};break;case"se":default:Et={x:Q.anchorPoint.x,y:Q.anchorPoint.y};break}Cn(Ve,Re,st),un(Ve,Et)},X=()=>{const{addToHistory:A}=lt.getState();A(),at(!1),k(null),oe(null)};return window.addEventListener("mousemove",R),window.addEventListener("mouseup",X),window.addEventListener("touchmove",R,{passive:!1}),window.addEventListener("touchend",X),window.addEventListener("touchcancel",X),()=>{window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",X),window.removeEventListener("touchmove",R),window.removeEventListener("touchend",X),window.removeEventListener("touchcancel",X)}},[Ge,Ve,Q,ft,Cn,un]),O.useEffect(()=>{if(!D||!$||!se)return;const R=A=>{const q=A.touches?A.touches[0].clientX:A.clientX,Me=A.touches?A.touches[0].clientY:A.clientY,ge=De(q,Me),Ne=Math.atan2(ge.y-se.shapeCenter.y,ge.x-se.shapeCenter.x)*(180/Math.PI)-se.initialAngle;let _e=se.originalRotation+Ne;_e=(_e%360+360)%360,A.shiftKey&&(_e=Math.round(_e/15)*15),_e=Math.round(_e*10)/10,$t($,_e)},X=()=>{const{addToHistory:A}=lt.getState();A(),P(!1),Y(null),B(null)};return window.addEventListener("mousemove",R),window.addEventListener("mouseup",X),window.addEventListener("touchmove",R,{passive:!1}),window.addEventListener("touchend",X),window.addEventListener("touchcancel",X),()=>{window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",X),window.removeEventListener("touchmove",R),window.removeEventListener("touchend",X),window.removeEventListener("touchcancel",X)}},[D,$,se,$t]),O.useEffect(()=>{if(!re||!le||!ae)return;const R=A=>{const q=A.touches?A.touches[0].clientX:A.clientX,Me=A.touches?A.touches[0].clientY:A.clientY,ge=De(q,Me);if(!Kt[le])return;const _e=Math.sqrt(Math.pow(ge.x-ae.anchorPoint.x,2)+Math.pow(ge.y-ae.anchorPoint.y,2))/ae.initialDistance;let Re=ae.originalFontSize*_e;Re=Math.max(50,Re),Re=Math.round(Re);const st=Re/ae.originalFontSize,ot=ae.originalBounds.width*st,{corner:Ht,anchorPoint:Et,textAlign:br,originalPosition:va,originalBounds:KW,originalFontSize:ZW}=ae;let gn={...va};switch(Ht){case"nw":br==="left"?gn.x=Et.x-ot:br==="center"?gn.x=Et.x-ot/2:gn.x=Et.x,gn.y=Et.y-Re*.2;break;case"ne":br==="left"?gn.x=Et.x:br==="center"?gn.x=Et.x+ot/2:gn.x=Et.x+ot,gn.y=Et.y-Re*.2;break;case"sw":br==="left"?gn.x=Et.x-ot:br==="center"?gn.x=Et.x-ot/2:gn.x=Et.x,gn.y=Et.y+Re;break;case"se":default:br==="left"?gn.x=Et.x:br==="center"?gn.x=Et.x+ot/2:gn.x=Et.x+ot,gn.y=Et.y+Re;break}mn(le,Re),jt(le,gn)},X=()=>{const{addToHistory:A}=lt.getState();A(),ye(!1),U(null),xe(null)};return window.addEventListener("mousemove",R),window.addEventListener("mouseup",X),window.addEventListener("touchmove",R,{passive:!1}),window.addEventListener("touchend",X),window.addEventListener("touchcancel",X),()=>{window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",X),window.removeEventListener("touchmove",R),window.removeEventListener("touchend",X),window.removeEventListener("touchcancel",X)}},[re,le,ae,Kt,mn,jt]),O.useEffect(()=>{if(!Te||!Ee||!he)return;const R=A=>{const q=A.touches?A.touches[0].clientX:A.clientX,Me=A.touches?A.touches[0].clientY:A.clientY,ge=De(q,Me),Ne=Math.atan2(ge.y-he.textCenter.y,ge.x-he.textCenter.x)*(180/Math.PI)-he.initialAngle;let _e=he.originalRotation+Ne;_e=(_e%360+360)%360,A.shiftKey&&(_e=Math.round(_e/15)*15),_e=Math.round(_e*10)/10,Nt(Ee,_e)},X=()=>{const{addToHistory:A}=lt.getState();A(),He(!1),ie(null),Xe(null)};return window.addEventListener("mousemove",R),window.addEventListener("mouseup",X),window.addEventListener("touchmove",R,{passive:!1}),window.addEventListener("touchend",X),window.addEventListener("touchcancel",X),()=>{window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",X),window.removeEventListener("touchmove",R),window.removeEventListener("touchend",X),window.removeEventListener("touchcancel",X)}},[Te,Ee,he,Nt]),O.useEffect(()=>{if(!tt||!yt||!Fe)return;const R=A=>{const q=A.touches?A.touches[0].clientX:A.clientX,Me=A.touches?A.touches[0].clientY:A.clientY,ge=De(q,Me);if(!Mt[yt])return;const Ne=Fe.corner,_e=Math.abs(ge.y-Fe.anchorPoint.y),Re=Math.abs(ge.x-Fe.anchorPoint.x);let st,ot;Ne==="n"||Ne==="s"?(st=Fe.originalWidth,ot=Math.max(500,_e)):Ne==="e"||Ne==="w"?(st=Math.max(500,Re),ot=Fe.originalHeight):(st=Math.max(500,Re),ot=Math.max(500,_e)),st=Math.round(st),ot=Math.round(ot);let Ht;switch(Ne){case"n":Ht={x:Fe.anchorPoint.x-st/2,y:Fe.anchorPoint.y-ot};break;case"s":Ht={x:Fe.anchorPoint.x-st/2,y:Fe.anchorPoint.y};break;case"e":Ht={x:Fe.anchorPoint.x,y:Fe.anchorPoint.y-ot/2};break;case"w":Ht={x:Fe.anchorPoint.x-st,y:Fe.anchorPoint.y-ot/2};break;default:Ht={x:Fe.anchorPoint.x,y:Fe.anchorPoint.y};break}qi(yt,st,ot),Os(yt,Ht)},X=()=>{const{addToHistory:A}=lt.getState();A(),nt(!1),ht(null),de(null)};return window.addEventListener("mousemove",R),window.addEventListener("mouseup",X),window.addEventListener("touchmove",R,{passive:!1}),window.addEventListener("touchend",X),window.addEventListener("touchcancel",X),()=>{window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",X),window.removeEventListener("touchmove",R),window.removeEventListener("touchend",X),window.removeEventListener("touchcancel",X)}},[tt,yt,Fe,Mt,qi,Os]),O.useEffect(()=>{if(!te||!Ye||!Ce)return;const R=A=>{const q=A.touches?A.touches[0].clientX:A.clientX,Me=A.touches?A.touches[0].clientY:A.clientY,ge=De(q,Me),Ne=Math.atan2(ge.y-Ce.zoneCenter.y,ge.x-Ce.zoneCenter.x)*(180/Math.PI)-Ce.initialAngle;let _e=Ce.originalRotation+Ne;_e=(_e%360+360)%360,A.shiftKey&&(_e=Math.round(_e/15)*15),_e=Math.round(_e*10)/10,Pt(Ye,_e)},X=()=>{const{addToHistory:A}=lt.getState();A(),me(!1),xt(null),wt(null)};return window.addEventListener("mousemove",R),window.addEventListener("mouseup",X),window.addEventListener("touchmove",R,{passive:!1}),window.addEventListener("touchend",X),window.addEventListener("touchcancel",X),()=>{window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",X),window.removeEventListener("touchmove",R),window.removeEventListener("touchend",X),window.removeEventListener("touchcancel",X)}},[te,Ye,Ce,Pt]),O.useEffect(()=>{if(!pt||!Ke||!bn)return;const R=A=>{const q=A.touches?A.touches[0].clientX:A.clientX,Me=A.touches?A.touches[0].clientY:A.clientY,ge=De(q,Me),{initialDistance:Le,originalBounds:Ne,corner:_e,anchorPoint:Re}=bn;let ot=Math.sqrt(Math.pow(ge.x-Re.x,2)+Math.pow(ge.y-Re.y,2))/Le;ot<.1&&(ot=.1),ot>10&&(ot=10);let Ht=ot,Et=ot;_e==="n"||_e==="s"?Ht=1:(_e==="e"||_e==="w")&&(Et=1),dt(Ke,Ht,Et,Re)},X=()=>{const{addToHistory:A,refreshGroupBounds:q}=lt.getState();q(Ke),A(),Ct(!1),Xt(null),Nr(null)};return window.addEventListener("mousemove",R),window.addEventListener("mouseup",X),window.addEventListener("touchmove",R,{passive:!1}),window.addEventListener("touchend",X),window.addEventListener("touchcancel",X),()=>{window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",X),window.removeEventListener("touchmove",R),window.removeEventListener("touchend",X),window.removeEventListener("touchcancel",X)}},[pt,Ke,bn,ee,dt]);const u2=R=>{var A;if(En&&rr&&(R.target===R.currentTarget||R.target.tagName==="svg"||R.target.closest("svg"))){R.preventDefault(),R.stopPropagation();const q=Date.now(),Me=q-be;if(qe(q),Me<300&&Me>0){hi();return}const ge=R.clientX,Le=R.clientY,Ne=De(ge,Le),_e=ft[rr];if(_e){const Re=(Ne.x-_e.position.x)/_e.width_mm,st=(Ne.y-_e.position.y)/_e.height_mm,ot=Math.max(-.5,Math.min(1.5,Re)),Ht=Math.max(-.5,Math.min(1.5,st));Ki(ot,Ht)}return}(R.target===R.currentTarget||R.target.tagName==="svg"||((A=R.target.classList)==null?void 0:A.contains("court-canvas__surface"))||R.target.closest(".court-canvas__scroll-container")===R.target)&&(xr(),Rs(),di(),Mr(),In(),Sn(),et(),we(),rn(null))},h2=()=>{a(R=>Math.min(R*1.25,5))},p2=()=>{a(R=>Math.max(R/1.25,.25))},f2=()=>{a(1),c({x:0,y:0})},m2=R=>{if(R.ctrlKey||R.metaKey){R.preventDefault();const X=R.deltaY*-.002;a(A=>Math.min(Math.max(A+A*X,.25),5))}else{R.preventDefault();const X=1;c(A=>({x:A.x-R.deltaX*X,y:A.y-R.deltaY*X}))}},g2=R=>{(R.button===1||R.button===0&&f)&&(R.preventDefault(),R.stopPropagation(),u(!0),h({x:R.clientX-l.x,y:R.clientY-l.y}))},y2=R=>{d&&c({x:R.clientX-p.x,y:R.clientY-p.y})},x2=()=>{u(!1)},Hm=R=>{const X=R[0].clientX-R[1].clientX,A=R[0].clientY-R[1].clientY;return Math.sqrt(X*X+A*A)},Um=R=>({x:(R[0].clientX+R[1].clientX)/2,y:(R[0].clientY+R[1].clientY)/2}),v2=R=>{if(R.touches.length===2){R.preventDefault();const X=Hm(R.touches),A=Um(R.touches);v({active:!0,initialDistance:X,initialZoom:i,initialPan:{...l},initialCenter:A})}},b2=R=>{if(R.touches.length===2&&g.active){R.preventDefault();const A=Hm(R.touches)/g.initialDistance;let q=g.initialZoom*A;q=Math.min(Math.max(q,.25),5);const Me=Um(R.touches),ge=Me.x-g.initialCenter.x,Le=Me.y-g.initialCenter.y;a(q),c({x:g.initialPan.x+ge,y:g.initialPan.y+Le})}},w2=R=>{R.touches.length<2&&v({active:!1,initialDistance:0,initialZoom:1,initialPan:{x:0,y:0},initialCenter:{x:0,y:0}})};O.useEffect(()=>{if(d){const R=A=>y2(A),X=()=>x2();return window.addEventListener("mousemove",R),window.addEventListener("mouseup",X),()=>{window.removeEventListener("mousemove",R),window.removeEventListener("mouseup",X)}}},[d,p]),O.useEffect(()=>{const R=A=>{if(A.code==="Space"&&!A.repeat){if(A.target.tagName==="INPUT"||A.target.tagName==="TEXTAREA")return;A.preventDefault(),m(!0)}if(A.code==="Escape"&&En&&rr&&(A.preventDefault(),Qt()),A.code==="Enter"&&En&&rr&&(A.preventDefault(),hi()),A.code==="Escape"&&Pe&&(A.preventDefault(),je()),(A.code==="Delete"||A.code==="Backspace")&&Jt&&kt!==null){if(A.target.tagName==="INPUT"||A.target.tagName==="TEXTAREA")return;const q=ft[Jt];q&&(q.shapeType==="path"||q.shapeType==="blob")&&q.editPointsVisible&&(A.preventDefault(),sr(Jt,kt),rn(null))}if((A.metaKey||A.ctrlKey)&&A.key.toLowerCase()==="g"&&!A.shiftKey){if(A.target.tagName==="INPUT"||A.target.tagName==="TEXTAREA")return;Se.length>=2&&(A.preventDefault(),lt.getState().groupSelected())}if((A.metaKey||A.ctrlKey)&&A.shiftKey&&A.key.toLowerCase()==="g"){if(A.target.tagName==="INPUT"||A.target.tagName==="TEXTAREA")return;ve&&(A.preventDefault(),lt.getState().ungroup(ve))}if((A.metaKey||A.ctrlKey)&&A.key.toLowerCase()==="c"&&!A.shiftKey){if(A.target.tagName==="INPUT"||A.target.tagName==="TEXTAREA")return;const q=lt.getState();(q.selectedGroupId||q.selectedElementIds.length>0||q.selectedShapeId||q.selectedTextId)&&(A.preventDefault(),q.copySelection())}if((A.metaKey||A.ctrlKey)&&A.key.toLowerCase()==="v"&&!A.shiftKey){if(A.target.tagName==="INPUT"||A.target.tagName==="TEXTAREA")return;const q=lt.getState();q.clipboard&&(A.preventDefault(),q.pasteClipboard())}},X=A=>{A.code==="Space"&&(m(!1),u(!1))};return window.addEventListener("keydown",R),window.addEventListener("keyup",X),()=>{window.removeEventListener("keydown",R),window.removeEventListener("keyup",X)}},[En,rr,Qt,hi,Jt,kt,ft,sr,Se,ve,Pe,je]);const _2=R=>{if(En&&rr){const X=De(R.clientX,R.clientY);Ps(X)}},Pn=En&&rr?ft[rr]:null,uu=((Wm=Pn==null?void 0:Pn.controlPoints)==null?void 0:Wm.length)>0?Pn.controlPoints[Pn.controlPoints.length-1]:null;return o.jsxs("div",{className:`court-canvas ${En?"court-canvas--drawing":""}`,onClick:u2,onMouseMove:_2,children:[En&&o.jsx("div",{className:"court-canvas__drawing-indicator",children:"Click to add points  Double-click or Enter to finish  Escape to cancel"}),o.jsxs("div",{className:"court-canvas__zoom-controls",children:[o.jsx("button",{onClick:h2,className:"court-canvas__zoom-btn",title:"Zoom In (Ctrl + Scroll)",children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"11",cy:"11",r:"8"}),o.jsx("line",{x1:"11",y1:"8",x2:"11",y2:"14"}),o.jsx("line",{x1:"8",y1:"11",x2:"14",y2:"11"}),o.jsx("path",{d:"m21 21-4.35-4.35"})]})}),o.jsx("button",{onClick:p2,className:"court-canvas__zoom-btn",title:"Zoom Out (Ctrl + Scroll)",children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"11",cy:"11",r:"8"}),o.jsx("line",{x1:"8",y1:"11",x2:"14",y2:"11"}),o.jsx("path",{d:"m21 21-4.35-4.35"})]})}),o.jsx("button",{onClick:f2,className:"court-canvas__zoom-btn",title:"Reset View",children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M1 4v6h6"}),o.jsx("path",{d:"M23 20v-6h-6"}),o.jsx("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"})]})}),o.jsxs("span",{className:"court-canvas__zoom-level",title:"Scroll to pan, Ctrl+Scroll to zoom, Space+Drag to pan",children:[Math.round(i*100),"%"]})]}),o.jsx("div",{ref:s,className:"court-canvas__viewport",onWheel:m2,onMouseDown:g2,onTouchStart:v2,onTouchMove:b2,onTouchEnd:w2,style:{cursor:d?"grabbing":f?"grab":void 0,touchAction:"none"},children:o.jsx("div",{className:"court-canvas__transform-wrapper",style:{transform:`translate(${l.x}px, ${l.y}px) scale(${i})`,transformOrigin:"center center"},children:o.jsxs("svg",{ref:r,className:"court-canvas__svg",viewBox:`0 0 ${Ze.width_mm} ${Ze.length_mm}`,preserveAspectRatio:"xMidYMid meet",children:[o.jsx("defs",{children:Ze.boundary&&Ze.boundary.type!=="rectangle"&&Ze.boundary.controlPoints&&o.jsx("clipPath",{id:"surface-boundary-clip",children:o.jsx("path",{d:X0(Ze.boundary,Ze.width_mm,Ze.length_mm)})})}),o.jsx("g",{clipPath:Ze.boundary&&Ze.boundary.type!=="rectangle"&&Ze.boundary.controlPoints?"url(#surface-boundary-clip)":void 0,children:o.jsx("rect",{x:"0",y:"0",width:Ze.width_mm,height:Ze.length_mm,fill:Ze.color.hex,className:"court-canvas__surface"})}),Ze.boundary&&Ze.boundary.type!=="rectangle"&&Ze.boundary.controlPoints&&o.jsx("path",{d:X0(Ze.boundary,Ze.width_mm,Ze.length_mm),fill:"none",stroke:"#94a3b8",strokeWidth:"60",strokeDasharray:"300 200",pointerEvents:"none"}),Object.values(Mt).map(R=>R.visible===!1?null:o.jsx(S5,{zone:R,isSelected:R.id===es,onMouseDown:X=>Bm(X,R.id),onTouchStart:X=>Bm(X,R.id),onDoubleClick:X=>a2(X,R.id),onScaleStart:(X,A)=>l2(X,R.id,A),onRotateStart:X=>c2(X,R.id)},R.id)),cn.map(R=>{if(R.startsWith("court-")){const X=Pr[R];return!X||X.visible===!1?null:o.jsx(E5,{court:X,isSelected:R===Qr,onMouseDown:A=>it(A,R),onTouchStart:A=>it(A,R),onDoubleClick:A=>Nn(A,R),svgRef:r},R)}if(R.startsWith("track-")){const X=_t[R];return!X||X.visible===!1?null:o.jsx(l5,{track:X,isSelected:R===hs,onMouseDown:A=>ir(A,R),onTouchStart:A=>ir(A,R),onDoubleClick:A=>xa(A,R),svgRef:r},R)}if(R.startsWith("motif-")){const X=Ln[R];return!X||X.visible===!1?null:o.jsx(d5,{motif:X,isSelected:R===Rr,onMouseDown:A=>en(A,R),onTouchStart:A=>en(A,R),onDoubleClick:A=>Hl(A,R),onScaleStart:(A,q)=>Ul(A,R,q),onRotateStart:A=>i2(A,R)},R)}if(R.startsWith("shape-")){const X=ft[R];if(!X||X.visible===!1)return null;const A=R===Jt||Se.includes(R);return X.shapeType==="blob"?o.jsx(V0,{shape:X,isSelected:A,onMouseDown:q=>vr(q,R),onTouchStart:q=>vr(q,R),onDoubleClick:q=>Zi(q,R),onScaleStart:(q,Me)=>Ji(q,R,Me),onRotateStart:q=>Qi(q,R),onPointDrag:(q,Me,ge)=>Lr(R,q,Me,ge),onHandleDrag:(q,Me,ge,Le)=>Xi(R,q,Me,ge,Le),onDragEnd:()=>ui(),selectedPointIndex:R===Jt?kt:null,onPointSelect:q=>rn(q),onPointDelete:q=>sr(R,q)},R):X.shapeType==="path"?o.jsx(Y0,{shape:X,isSelected:A,onMouseDown:q=>vr(q,R),onTouchStart:q=>vr(q,R),onDoubleClick:q=>Zi(q,R),onScaleStart:(q,Me)=>Ji(q,R,Me),onRotateStart:q=>Qi(q,R),onPointDrag:(q,Me,ge)=>Tn(R,q,Me,ge),onHandleDrag:(q,Me,ge,Le)=>pi(R,q,Me,ge,Le),onDragEnd:()=>As(),selectedPointIndex:R===Jt?kt:null,onPointSelect:q=>rn(q),onPointDelete:q=>sr(R,q)},R):o.jsx(G0,{shape:X,isSelected:A,onMouseDown:q=>vr(q,R),onTouchStart:q=>vr(q,R),onDoubleClick:q=>Zi(q,R),onScaleStart:(q,Me)=>Ji(q,R,Me),onRotateStart:q=>Qi(q,R)},R)}if(R.startsWith("text-")){const X=Kt[R];return!X||X.visible===!1?null:o.jsx(q0,{text:X,isSelected:R===wn,isEditing:R===_n,onMouseDown:A=>Wl(A,R),onTouchStart:A=>Wl(A,R),onDoubleClick:A=>Im(A,R),onScaleStart:(A,q)=>zm(A,R,q),onRotateStart:A=>Fm(A,R),onContentChange:A=>ns(R,A),onEditComplete:()=>dn()},R)}if(R.startsWith("group-")){const X=ee[R];return!X||X.visible===!1?null:o.jsx("g",{children:X.childIds.map(A=>{if(A.startsWith("shape-")){const q=ft[A];if(!q||q.visible===!1)return null;const Me=A===Jt||Se.includes(A);return q.shapeType==="blob"?o.jsx(V0,{shape:q,isSelected:Me,onMouseDown:ge=>vr(ge,A),onTouchStart:ge=>vr(ge,A),onDoubleClick:ge=>Zi(ge,A),onScaleStart:(ge,Le)=>Ji(ge,A,Le),onRotateStart:ge=>Qi(ge,A),onPointDrag:(ge,Le,Ne)=>Lr(A,ge,Le,Ne),onHandleDrag:(ge,Le,Ne,_e)=>Xi(A,ge,Le,Ne,_e),onDragEnd:()=>ui(),selectedPointIndex:A===Jt?kt:null,onPointSelect:ge=>rn(ge),onPointDelete:ge=>sr(A,ge)},A):q.shapeType==="path"?o.jsx(Y0,{shape:q,isSelected:Me,onMouseDown:ge=>vr(ge,A),onTouchStart:ge=>vr(ge,A),onDoubleClick:ge=>Zi(ge,A),onScaleStart:(ge,Le)=>Ji(ge,A,Le),onRotateStart:ge=>Qi(ge,A),onPointDrag:(ge,Le,Ne)=>Tn(A,ge,Le,Ne),onHandleDrag:(ge,Le,Ne,_e)=>pi(A,ge,Le,Ne,_e),onDragEnd:()=>As(),selectedPointIndex:A===Jt?kt:null,onPointSelect:ge=>rn(ge),onPointDelete:ge=>sr(A,ge)},A):o.jsx(G0,{shape:q,isSelected:Me,onMouseDown:ge=>vr(ge,A),onTouchStart:ge=>vr(ge,A),onDoubleClick:ge=>Zi(ge,A),onScaleStart:(ge,Le)=>Ji(ge,A,Le),onRotateStart:ge=>Qi(ge,A)},A)}if(A.startsWith("text-")){const q=Kt[A];return!q||q.visible===!1?null:o.jsx(q0,{text:q,isSelected:A===wn,isEditing:A===_n,onMouseDown:Me=>Wl(Me,A),onTouchStart:Me=>Wl(Me,A),onDoubleClick:Me=>Im(Me,A),onScaleStart:(Me,ge)=>zm(Me,A,ge),onRotateStart:Me=>Fm(Me,A),onContentChange:Me=>ns(A,Me),onEditComplete:()=>dn()},A)}return null})},R)}return null}),Object.keys(ee).map(R=>o.jsx(j5,{groupId:R,scale:i,screenToSVG:De,onDragStart:(X,A)=>{w(A),J(X),y(!0)},onScaleStart:(X,A,q)=>d2(X,A,q)},R)),En&&Pn&&uu&&Jn&&o.jsx("line",{x1:Pn.position.x+uu.x*Pn.width_mm,y1:Pn.position.y+uu.y*Pn.height_mm,x2:Jn.x,y2:Jn.y,stroke:"#3b82f6",strokeWidth:"50",strokeDasharray:"100 100",opacity:"0.6",pointerEvents:"none"}),En&&Pn&&((Gm=Pn.controlPoints)==null?void 0:Gm.map((R,X)=>o.jsx("circle",{cx:Pn.position.x+R.x*Pn.width_mm,cy:Pn.position.y+R.y*Pn.height_mm,r:"80",fill:"#3b82f6",stroke:"#fff",strokeWidth:"20",pointerEvents:"none"},`preview-point-${X}`)))]})})}),o.jsxs("div",{className:"court-canvas__info",children:[o.jsxs("span",{children:[(Ze.width_mm/1e3).toFixed(1),"m  ",(Ze.length_mm/1e3).toFixed(1),"m"]}),Or&&o.jsxs("span",{className:"court-canvas__grid-indicator",children:["Grid: ",Qn,"mm"]})]}),cn.length===0&&o.jsxs("div",{className:"court-canvas__empty-state",children:[o.jsx("div",{className:"court-canvas__empty-icon",children:o.jsxs("svg",{width:"72",height:"72",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("path",{d:"M12 2L14.4 8.4L21 9.6L16.2 14.4L17.6 21L12 17.6L6.4 21L7.8 14.4L3 9.6L9.6 8.4L12 2Z",fill:"rgba(255,255,255,0.15)",stroke:"currentColor",strokeWidth:"1.5",strokeLinejoin:"round"}),o.jsx("circle",{cx:"19",cy:"5",r:"1.5",fill:"currentColor",opacity:"0.6"}),o.jsx("circle",{cx:"5",cy:"18",r:"1",fill:"currentColor",opacity:"0.4"}),o.jsx("circle",{cx:"20",cy:"16",r:"0.8",fill:"currentColor",opacity:"0.5"})]})}),o.jsx("h3",{className:"court-canvas__empty-title",children:"Your canvas is ready"}),o.jsx("p",{className:"court-canvas__empty-text",children:"Design your perfect TPV surface in minutes"}),o.jsxs("div",{className:"court-canvas__empty-hints",children:[o.jsxs("div",{className:"court-canvas__hint",children:[o.jsx("span",{className:"court-canvas__hint-icon",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),o.jsx("line",{x1:"9",y1:"3",x2:"9",y2:"21"})]})}),o.jsxs("span",{children:["Add ",o.jsx("strong",{children:"Courts"}),", ",o.jsx("strong",{children:"Tracks"}),", ",o.jsx("strong",{children:"Shapes"})," or ",o.jsx("strong",{children:"Designs"})]})]}),o.jsxs("div",{className:"court-canvas__hint",children:[o.jsx("span",{className:"court-canvas__hint-icon",children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M12 5v14M5 12h14"})})}),o.jsx("span",{children:"Click elements in the library to place them"})]}),o.jsxs("div",{className:"court-canvas__hint",children:[o.jsx("span",{className:"court-canvas__hint-icon",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M5 9l4 4-4 4"}),o.jsx("path",{d:"M12 4h7a2 2 0 012 2v12a2 2 0 01-2 2h-7"})]})}),o.jsx("span",{children:"Arrange, customise colours and export"})]})]})]})]})});function E5({court:t,isSelected:e,onMouseDown:n,onTouchStart:r,onDoubleClick:s,svgRef:i}){var d;const{markings:a,zones:l}=KE(t),c=((d=t.courtSurfaceColor)==null?void 0:d.hex)||null;return o.jsxs("g",{className:`court-canvas__court ${e?"court-canvas__court--selected":""}`,transform:JE(t),style:{cursor:"move"},children:[c&&o.jsx("rect",{x:"0",y:"0",width:t.template.dimensions.width_mm,height:t.template.dimensions.length_mm,fill:c,className:"court-canvas__court-surface"}),o.jsx("rect",{x:"0",y:"0",width:t.template.dimensions.width_mm,height:t.template.dimensions.length_mm,fill:"none",pointerEvents:"all",onMouseDown:n,onTouchStart:r,onDoubleClick:s,style:{cursor:"move"}}),l.map(u=>o.jsx(T5,{zone:u},u.id)),a.map(u=>o.jsx(N5,{marking:u},u.id)),e&&o.jsxs(o.Fragment,{children:[o.jsx("rect",{x:"0",y:"0",width:t.template.dimensions.width_mm,height:t.template.dimensions.length_mm,fill:"none",stroke:"#007bff",strokeWidth:"100",strokeDasharray:"400 400",className:"court-canvas__selection-outline"}),o.jsx(QE,{court:t,svgRef:i})]})]})}function T5({zone:t}){switch(t.type){case"rect":return o.jsx("rect",{x:t.x,y:t.y,width:t.width,height:t.height,fill:t.fill});case"circle":return o.jsx("circle",{cx:t.cx,cy:t.cy,r:t.r,fill:t.fill});case"polygon":return o.jsx("polygon",{points:t.points,fill:t.fill});default:return null}}function N5({marking:t}){switch(t.type){case"line":return o.jsx("line",{x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,stroke:t.stroke,strokeWidth:t.strokeWidth});case"rect":return o.jsx("rect",{x:t.x,y:t.y,width:t.width,height:t.height,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill});case"circle":return o.jsx("circle",{cx:t.cx,cy:t.cy,r:t.r,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill});case"path":return o.jsx("path",{d:t.d,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill});case"polyline":return o.jsx("polyline",{points:t.points,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill});default:return null}}const E1={"track-flexible":{id:"track-flexible",name:"Running Track",type:"running-track",trackType:"curved",standard:"Flexible Design",category:"track",description:"Flexible running track - adjust size, lanes, and corner radius to fit your surface",parameters:{numLanes:4,laneWidth_mm:1220,width_mm:25e3,height_mm:15e3,cornerRadius:{topLeft:3e3,topRight:3e3,bottomLeft:3e3,bottomRight:3e3},lineWidth_mm:50,startingBoxes:{enabled:!1,depth_mm:400,lineWidth_mm:50}},defaultLineColor:"RH31",defaultTrackSurfaceColor:"RH01",calculatedDimensions:{totalWidth_mm:25e3,totalLength_mm:15e3}},"track-straight":{id:"track-straight",name:"Straight Track",type:"running-track",trackType:"straight",standard:"Sprint Track",category:"track",description:"Straight sprint track - perfect for 60m, 100m, or custom length sprints",parameters:{numLanes:6,laneWidth_mm:1220,width_mm:7320,height_mm:1e5,cornerRadius:{topLeft:0,topRight:0,bottomLeft:0,bottomRight:0},lineWidth_mm:50,startingBoxes:{enabled:!1,depth_mm:400,lineWidth_mm:50}},defaultLineColor:"RH31",defaultTrackSurfaceColor:"RH01",calculatedDimensions:{totalWidth_mm:7320,totalLength_mm:1e5}}};function P5(){return Object.values(E1)}function R5(t){return E1[t]||null}/*! @license DOMPurify 3.3.0 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.0/LICENSE */var Ju,K0;function Z0(){if(K0)return Ju;K0=1;const{entries:t,setPrototypeOf:e,isFrozen:n,getPrototypeOf:r,getOwnPropertyDescriptor:s}=Object;let{freeze:i,seal:a,create:l}=Object,{apply:c,construct:d}=typeof Reflect<"u"&&Reflect;i||(i=function(re){return re}),a||(a=function(re){return re}),c||(c=function(re,ye){for(var le=arguments.length,U=new Array(le>2?le-2:0),ae=2;ae<le;ae++)U[ae-2]=arguments[ae];return re.apply(ye,U)}),d||(d=function(re){for(var ye=arguments.length,le=new Array(ye>1?ye-1:0),U=1;U<ye;U++)le[U-1]=arguments[U];return new re(...le)});const u=E(Array.prototype.forEach),p=E(Array.prototype.lastIndexOf),h=E(Array.prototype.pop),f=E(Array.prototype.push),m=E(Array.prototype.splice),g=E(String.prototype.toLowerCase),v=E(String.prototype.toString),x=E(String.prototype.match),y=E(String.prototype.replace),b=E(String.prototype.indexOf),w=E(String.prototype.trim),j=E(Object.prototype.hasOwnProperty),_=E(RegExp.prototype.test),S=T(TypeError);function E(B){return function(re){re instanceof RegExp&&(re.lastIndex=0);for(var ye=arguments.length,le=new Array(ye>1?ye-1:0),U=1;U<ye;U++)le[U-1]=arguments[U];return c(B,re,le)}}function T(B){return function(){for(var re=arguments.length,ye=new Array(re),le=0;le<re;le++)ye[le]=arguments[le];return d(B,ye)}}function M(B,re){let ye=arguments.length>2&&arguments[2]!==void 0?arguments[2]:g;e&&e(B,null);let le=re.length;for(;le--;){let U=re[le];if(typeof U=="string"){const ae=ye(U);ae!==U&&(n(re)||(re[le]=ae),U=ae)}B[U]=!0}return B}function Z(B){for(let re=0;re<B.length;re++)j(B,re)||(B[re]=null);return B}function N(B){const re=l(null);for(const[ye,le]of t(B))j(B,ye)&&(Array.isArray(le)?re[ye]=Z(le):le&&typeof le=="object"&&le.constructor===Object?re[ye]=N(le):re[ye]=le);return re}function G(B,re){for(;B!==null;){const le=s(B,re);if(le){if(le.get)return E(le.get);if(typeof le.value=="function")return E(le.value)}B=r(B)}function ye(){return null}return ye}const C=i(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),F=i(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),pe=i(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),V=i(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),J=i(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),I=i(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),K=i(["#text"]),z=i(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),W=i(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),fe=i(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),ue=i(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),ne=a(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ke=a(/<%[\w\W]*|[\w\W]*%>/gm),ce=a(/\$\{[\w\W]*/gm),$e=a(/^data-[\-\w.\u00B7-\uFFFF]+$/),ze=a(/^aria-[\-\w]+$/),Ue=a(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),Ge=a(/^(?:\w+script|data):/i),at=a(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Ve=a(/^html$/i),k=a(/^[a-z][.\w]*(-[.\w]+)+$/i);var Q=Object.freeze({__proto__:null,ARIA_ATTR:ze,ATTR_WHITESPACE:at,CUSTOM_ELEMENT:k,DATA_ATTR:$e,DOCTYPE_NAME:Ve,ERB_EXPR:ke,IS_ALLOWED_URI:Ue,IS_SCRIPT_OR_DATA:Ge,MUSTACHE_EXPR:ne,TMPLIT_EXPR:ce});const oe={element:1,text:3,progressingInstruction:7,comment:8,document:9},D=function(){return typeof window>"u"?null:window},P=function(re,ye){if(typeof re!="object"||typeof re.createPolicy!="function")return null;let le=null;const U="data-tt-policy-suffix";ye&&ye.hasAttribute(U)&&(le=ye.getAttribute(U));const ae="dompurify"+(le?"#"+le:"");try{return re.createPolicy(ae,{createHTML(xe){return xe},createScriptURL(xe){return xe}})}catch{return console.warn("TrustedTypes policy "+ae+" could not be created."),null}},$=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Y(){let B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:D();const re=je=>Y(je);if(re.version="3.3.0",re.removed=[],!B||!B.document||B.document.nodeType!==oe.document||!B.Element)return re.isSupported=!1,re;let{document:ye}=B;const le=ye,U=le.currentScript,{DocumentFragment:ae,HTMLTemplateElement:xe,Node:Te,Element:He,NodeFilter:Ee,NamedNodeMap:ie=B.NamedNodeMap||B.MozNamedAttrMap,HTMLFormElement:he,DOMParser:Xe,trustedTypes:tt}=B,nt=He.prototype,yt=G(nt,"cloneNode"),ht=G(nt,"remove"),Fe=G(nt,"nextSibling"),de=G(nt,"childNodes"),te=G(nt,"parentNode");if(typeof xe=="function"){const je=ye.createElement("template");je.content&&je.content.ownerDocument&&(ye=je.content.ownerDocument)}let me,Ye="";const{implementation:xt,createNodeIterator:Ce,createDocumentFragment:wt,getElementsByTagName:pt}=ye,{importNode:Ct}=le;let Ke=$();re.isSupported=typeof t=="function"&&typeof te=="function"&&xt&&xt.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Xt,ERB_EXPR:bn,TMPLIT_EXPR:Nr,DATA_ATTR:Jn,ARIA_ATTR:Ps,IS_SCRIPT_OR_DATA:be,ATTR_WHITESPACE:qe,CUSTOM_ELEMENT:kt}=Q;let{IS_ALLOWED_URI:rn}=Q,Ze=null;const Pr=M({},[...C,...F,...pe,...J,...K]);let _t=null;const Ln=M({},[...z,...W,...fe,...ue]);let ft=Object.seal(l(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Kt=null,Mt=null;const cn=Object.seal(l(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Qr=!0,hs=!0,Rr=!1,Jt=!0,wn=!1,es=!0,_n=!1,Or=!1,Qn=!1,Dn=!1,xr=!1,Ar=!1,Rs=!0,ps=!1;const di="user-content-";let ts=!0,Mr=!1,er={},In=null;const fs=M({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Sn=null;const kn=M({},["audio","video","img","source","image","track"]);let dn=null;const $r=M({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),tr="http://www.w3.org/1998/Math/MathML",zn="http://www.w3.org/2000/svg",jn="http://www.w3.org/1999/xhtml";let nr=jn,un=!1,Cn=null;const $t=M({},[tr,zn,jn],v);let jt=M({},["mi","mo","mn","ms","mtext"]),mn=M({},["annotation-xml"]);const Nt=M({},["title","style","font","a","script"]);let ns=null;const Os=["application/xhtml+xml","text/html"],qi="text/html";let Pt=null,Lr=null;const Xi=ye.createElement("form"),ui=function(H){return H instanceof RegExp||H instanceof Function},En=function(){let H=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Lr&&Lr===H)){if((!H||typeof H!="object")&&(H={}),H=N(H),ns=Os.indexOf(H.PARSER_MEDIA_TYPE)===-1?qi:H.PARSER_MEDIA_TYPE,Pt=ns==="application/xhtml+xml"?v:g,Ze=j(H,"ALLOWED_TAGS")?M({},H.ALLOWED_TAGS,Pt):Pr,_t=j(H,"ALLOWED_ATTR")?M({},H.ALLOWED_ATTR,Pt):Ln,Cn=j(H,"ALLOWED_NAMESPACES")?M({},H.ALLOWED_NAMESPACES,v):$t,dn=j(H,"ADD_URI_SAFE_ATTR")?M(N($r),H.ADD_URI_SAFE_ATTR,Pt):$r,Sn=j(H,"ADD_DATA_URI_TAGS")?M(N(kn),H.ADD_DATA_URI_TAGS,Pt):kn,In=j(H,"FORBID_CONTENTS")?M({},H.FORBID_CONTENTS,Pt):fs,Kt=j(H,"FORBID_TAGS")?M({},H.FORBID_TAGS,Pt):N({}),Mt=j(H,"FORBID_ATTR")?M({},H.FORBID_ATTR,Pt):N({}),er=j(H,"USE_PROFILES")?H.USE_PROFILES:!1,Qr=H.ALLOW_ARIA_ATTR!==!1,hs=H.ALLOW_DATA_ATTR!==!1,Rr=H.ALLOW_UNKNOWN_PROTOCOLS||!1,Jt=H.ALLOW_SELF_CLOSE_IN_ATTR!==!1,wn=H.SAFE_FOR_TEMPLATES||!1,es=H.SAFE_FOR_XML!==!1,_n=H.WHOLE_DOCUMENT||!1,Dn=H.RETURN_DOM||!1,xr=H.RETURN_DOM_FRAGMENT||!1,Ar=H.RETURN_TRUSTED_TYPE||!1,Qn=H.FORCE_BODY||!1,Rs=H.SANITIZE_DOM!==!1,ps=H.SANITIZE_NAMED_PROPS||!1,ts=H.KEEP_CONTENT!==!1,Mr=H.IN_PLACE||!1,rn=H.ALLOWED_URI_REGEXP||Ue,nr=H.NAMESPACE||jn,jt=H.MATHML_TEXT_INTEGRATION_POINTS||jt,mn=H.HTML_INTEGRATION_POINTS||mn,ft=H.CUSTOM_ELEMENT_HANDLING||{},H.CUSTOM_ELEMENT_HANDLING&&ui(H.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(ft.tagNameCheck=H.CUSTOM_ELEMENT_HANDLING.tagNameCheck),H.CUSTOM_ELEMENT_HANDLING&&ui(H.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(ft.attributeNameCheck=H.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),H.CUSTOM_ELEMENT_HANDLING&&typeof H.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(ft.allowCustomizedBuiltInElements=H.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),wn&&(hs=!1),xr&&(Dn=!0),er&&(Ze=M({},K),_t=[],er.html===!0&&(M(Ze,C),M(_t,z)),er.svg===!0&&(M(Ze,F),M(_t,W),M(_t,ue)),er.svgFilters===!0&&(M(Ze,pe),M(_t,W),M(_t,ue)),er.mathMl===!0&&(M(Ze,J),M(_t,fe),M(_t,ue))),H.ADD_TAGS&&(typeof H.ADD_TAGS=="function"?cn.tagCheck=H.ADD_TAGS:(Ze===Pr&&(Ze=N(Ze)),M(Ze,H.ADD_TAGS,Pt))),H.ADD_ATTR&&(typeof H.ADD_ATTR=="function"?cn.attributeCheck=H.ADD_ATTR:(_t===Ln&&(_t=N(_t)),M(_t,H.ADD_ATTR,Pt))),H.ADD_URI_SAFE_ATTR&&M(dn,H.ADD_URI_SAFE_ATTR,Pt),H.FORBID_CONTENTS&&(In===fs&&(In=N(In)),M(In,H.FORBID_CONTENTS,Pt)),ts&&(Ze["#text"]=!0),_n&&M(Ze,["html","head","body"]),Ze.table&&(M(Ze,["tbody"]),delete Kt.tbody),H.TRUSTED_TYPES_POLICY){if(typeof H.TRUSTED_TYPES_POLICY.createHTML!="function")throw S('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof H.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw S('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');me=H.TRUSTED_TYPES_POLICY,Ye=me.createHTML("")}else me===void 0&&(me=P(tt,U)),me!==null&&typeof Ye=="string"&&(Ye=me.createHTML(""));i&&i(H),Lr=H}},rr=M({},[...F,...pe,...V]),Ki=M({},[...J,...I]),hi=function(H){let we=te(H);(!we||!we.tagName)&&(we={namespaceURI:nr,tagName:"template"});const Ae=g(H.tagName),dt=g(we.tagName);return Cn[H.namespaceURI]?H.namespaceURI===zn?we.namespaceURI===jn?Ae==="svg":we.namespaceURI===tr?Ae==="svg"&&(dt==="annotation-xml"||jt[dt]):!!rr[Ae]:H.namespaceURI===tr?we.namespaceURI===jn?Ae==="math":we.namespaceURI===zn?Ae==="math"&&mn[dt]:!!Ki[Ae]:H.namespaceURI===jn?we.namespaceURI===zn&&!mn[dt]||we.namespaceURI===tr&&!jt[dt]?!1:!Ki[Ae]&&(Nt[Ae]||!rr[Ae]):!!(ns==="application/xhtml+xml"&&Cn[H.namespaceURI]):!1},Qt=function(H){f(re.removed,{element:H});try{te(H).removeChild(H)}catch{ht(H)}},Tn=function(H,we){try{f(re.removed,{attribute:we.getAttributeNode(H),from:we})}catch{f(re.removed,{attribute:null,from:we})}if(we.removeAttribute(H),H==="is")if(Dn||xr)try{Qt(we)}catch{}else try{we.setAttribute(H,"")}catch{}},pi=function(H){let we=null,Ae=null;if(Qn)H="<remove></remove>"+H;else{const De=x(H,/^[\r\n\t ]+/);Ae=De&&De[0]}ns==="application/xhtml+xml"&&nr===jn&&(H='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+H+"</body></html>");const dt=me?me.createHTML(H):H;if(nr===jn)try{we=new Xe().parseFromString(dt,ns)}catch{}if(!we||!we.documentElement){we=xt.createDocument(nr,"template",null);try{we.documentElement.innerHTML=un?Ye:dt}catch{}}const gt=we.body||we.documentElement;return H&&Ae&&gt.insertBefore(ye.createTextNode(Ae),gt.childNodes[0]||null),nr===jn?pt.call(we,_n?"html":"body")[0]:_n?we.documentElement:gt},As=function(H){return Ce.call(H.ownerDocument||H,H,Ee.SHOW_ELEMENT|Ee.SHOW_COMMENT|Ee.SHOW_TEXT|Ee.SHOW_PROCESSING_INSTRUCTION|Ee.SHOW_CDATA_SECTION,null)},sr=function(H){return H instanceof he&&(typeof H.nodeName!="string"||typeof H.textContent!="string"||typeof H.removeChild!="function"||!(H.attributes instanceof ie)||typeof H.removeAttribute!="function"||typeof H.setAttribute!="function"||typeof H.namespaceURI!="string"||typeof H.insertBefore!="function"||typeof H.hasChildNodes!="function")},ee=function(H){return typeof Te=="function"&&H instanceof Te};function ve(je,H,we){u(je,Ae=>{Ae.call(re,H,we,Lr)})}const Se=function(H){let we=null;if(ve(Ke.beforeSanitizeElements,H,null),sr(H))return Qt(H),!0;const Ae=Pt(H.nodeName);if(ve(Ke.uponSanitizeElement,H,{tagName:Ae,allowedTags:Ze}),es&&H.hasChildNodes()&&!ee(H.firstElementChild)&&_(/<[/\w!]/g,H.innerHTML)&&_(/<[/\w!]/g,H.textContent)||H.nodeType===oe.progressingInstruction||es&&H.nodeType===oe.comment&&_(/<[/\w]/g,H.data))return Qt(H),!0;if(!(cn.tagCheck instanceof Function&&cn.tagCheck(Ae))&&(!Ze[Ae]||Kt[Ae])){if(!Kt[Ae]&&ct(Ae)&&(ft.tagNameCheck instanceof RegExp&&_(ft.tagNameCheck,Ae)||ft.tagNameCheck instanceof Function&&ft.tagNameCheck(Ae)))return!1;if(ts&&!In[Ae]){const dt=te(H)||H.parentNode,gt=de(H)||H.childNodes;if(gt&&dt){const De=gt.length;for(let it=De-1;it>=0;--it){const Nn=yt(gt[it],!0);Nn.__removalCount=(H.__removalCount||0)+1,dt.insertBefore(Nn,Fe(H))}}}return Qt(H),!0}return H instanceof He&&!hi(H)||(Ae==="noscript"||Ae==="noembed"||Ae==="noframes")&&_(/<\/no(script|embed|frames)/i,H.innerHTML)?(Qt(H),!0):(wn&&H.nodeType===oe.text&&(we=H.textContent,u([Xt,bn,Nr],dt=>{we=y(we,dt," ")}),H.textContent!==we&&(f(re.removed,{element:H.cloneNode()}),H.textContent=we)),ve(Ke.afterSanitizeElements,H,null),!1)},Pe=function(H,we,Ae){if(Rs&&(we==="id"||we==="name")&&(Ae in ye||Ae in Xi))return!1;if(!(hs&&!Mt[we]&&_(Jn,we))){if(!(Qr&&_(Ps,we))){if(!(cn.attributeCheck instanceof Function&&cn.attributeCheck(we,H))){if(!_t[we]||Mt[we]){if(!(ct(H)&&(ft.tagNameCheck instanceof RegExp&&_(ft.tagNameCheck,H)||ft.tagNameCheck instanceof Function&&ft.tagNameCheck(H))&&(ft.attributeNameCheck instanceof RegExp&&_(ft.attributeNameCheck,we)||ft.attributeNameCheck instanceof Function&&ft.attributeNameCheck(we,H))||we==="is"&&ft.allowCustomizedBuiltInElements&&(ft.tagNameCheck instanceof RegExp&&_(ft.tagNameCheck,Ae)||ft.tagNameCheck instanceof Function&&ft.tagNameCheck(Ae))))return!1}else if(!dn[we]){if(!_(rn,y(Ae,qe,""))){if(!((we==="src"||we==="xlink:href"||we==="href")&&H!=="script"&&b(Ae,"data:")===0&&Sn[H])){if(!(Rr&&!_(be,y(Ae,qe,"")))){if(Ae)return!1}}}}}}}return!0},ct=function(H){return H!=="annotation-xml"&&x(H,kt)},et=function(H){ve(Ke.beforeSanitizeAttributes,H,null);const{attributes:we}=H;if(!we||sr(H))return;const Ae={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:_t,forceKeepAttr:void 0};let dt=we.length;for(;dt--;){const gt=we[dt],{name:De,namespaceURI:it,value:Nn}=gt,ir=Pt(De),xa=Nn;let en=De==="value"?xa:w(xa);if(Ae.attrName=ir,Ae.attrValue=en,Ae.keepAttr=!0,Ae.forceKeepAttr=void 0,ve(Ke.uponSanitizeAttribute,H,Ae),en=Ae.attrValue,ps&&(ir==="id"||ir==="name")&&(Tn(De,H),en=di+en),es&&_(/((--!?|])>)|<\/(style|title|textarea)/i,en)){Tn(De,H);continue}if(ir==="attributename"&&x(en,"href")){Tn(De,H);continue}if(Ae.forceKeepAttr)continue;if(!Ae.keepAttr){Tn(De,H);continue}if(!Jt&&_(/\/>/i,en)){Tn(De,H);continue}wn&&u([Xt,bn,Nr],Ul=>{en=y(en,Ul," ")});const Hl=Pt(H.nodeName);if(!Pe(Hl,ir,en)){Tn(De,H);continue}if(me&&typeof tt=="object"&&typeof tt.getAttributeType=="function"&&!it)switch(tt.getAttributeType(Hl,ir)){case"TrustedHTML":{en=me.createHTML(en);break}case"TrustedScriptURL":{en=me.createScriptURL(en);break}}if(en!==xa)try{it?H.setAttributeNS(it,De,en):H.setAttribute(De,en),sr(H)?Qt(H):h(re.removed)}catch{Tn(De,H)}}ve(Ke.afterSanitizeAttributes,H,null)},Be=function je(H){let we=null;const Ae=As(H);for(ve(Ke.beforeSanitizeShadowDOM,H,null);we=Ae.nextNode();)ve(Ke.uponSanitizeShadowNode,we,null),Se(we),et(we),we.content instanceof ae&&je(we.content);ve(Ke.afterSanitizeShadowDOM,H,null)};return re.sanitize=function(je){let H=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},we=null,Ae=null,dt=null,gt=null;if(un=!je,un&&(je="<!-->"),typeof je!="string"&&!ee(je))if(typeof je.toString=="function"){if(je=je.toString(),typeof je!="string")throw S("dirty is not a string, aborting")}else throw S("toString is not a function");if(!re.isSupported)return je;if(Or||En(H),re.removed=[],typeof je=="string"&&(Mr=!1),Mr){if(je.nodeName){const Nn=Pt(je.nodeName);if(!Ze[Nn]||Kt[Nn])throw S("root node is forbidden and cannot be sanitized in-place")}}else if(je instanceof Te)we=pi("<!---->"),Ae=we.ownerDocument.importNode(je,!0),Ae.nodeType===oe.element&&Ae.nodeName==="BODY"||Ae.nodeName==="HTML"?we=Ae:we.appendChild(Ae);else{if(!Dn&&!wn&&!_n&&je.indexOf("<")===-1)return me&&Ar?me.createHTML(je):je;if(we=pi(je),!we)return Dn?null:Ar?Ye:""}we&&Qn&&Qt(we.firstChild);const De=As(Mr?je:we);for(;dt=De.nextNode();)Se(dt),et(dt),dt.content instanceof ae&&Be(dt.content);if(Mr)return je;if(Dn){if(xr)for(gt=wt.call(we.ownerDocument);we.firstChild;)gt.appendChild(we.firstChild);else gt=we;return(_t.shadowroot||_t.shadowrootmode)&&(gt=Ct.call(le,gt,!0)),gt}let it=_n?we.outerHTML:we.innerHTML;return _n&&Ze["!doctype"]&&we.ownerDocument&&we.ownerDocument.doctype&&we.ownerDocument.doctype.name&&_(Ve,we.ownerDocument.doctype.name)&&(it="<!DOCTYPE "+we.ownerDocument.doctype.name+`>
`+it),wn&&u([Xt,bn,Nr],Nn=>{it=y(it,Nn," ")}),me&&Ar?me.createHTML(it):it},re.setConfig=function(){let je=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};En(je),Or=!0},re.clearConfig=function(){Lr=null,Or=!1},re.isValidAttribute=function(je,H,we){Lr||En({});const Ae=Pt(je),dt=Pt(H);return Pe(Ae,dt,we)},re.addHook=function(je,H){typeof H=="function"&&f(Ke[je],H)},re.removeHook=function(je,H){if(H!==void 0){const we=p(Ke[je],H);return we===-1?void 0:m(Ke[je],we,1)[0]}return h(Ke[je])},re.removeHooks=function(je){Ke[je]=[]},re.removeAllHooks=function(){Ke=$()},re}var se=Y();return Ju=se,Ju}var O5=self.DOMPurify||(self.DOMPurify=Z0().default||Z0());const A5=jl(O5);function zf(t,e={}){if(!t||typeof t!="string")return console.warn("[SVG-SANITIZE] Invalid input:",typeof t),"";const n={USE_PROFILES:{svg:!0,svgFilters:!0},FORBID_TAGS:["script","foreignObject","iframe","embed"],FORBID_ATTR:["onload","onerror","onclick","onmouseover","onmouseout","onmouseenter","onmouseleave","onmousemove","onmousedown","onmouseup","onfocus","onblur","onkeydown","onkeyup","onkeypress","onsubmit","onreset","onselect","onchange","oninput","onanimationstart","onanimationend","onanimationiteration","ontransitionend","ontransitionrun","ontransitionstart","ontransitioncancel","xlink:href",...e.additionalForbiddenAttrs||[]],ALLOW_DATA_ATTR:!0,ALLOW_COMMENTS:!1,RETURN_DOM:!1,RETURN_DOM_FRAGMENT:!1,ALLOWED_URI_REGEXP:/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,HOOKS:{afterSanitizeAttributes:r=>{if(r.hasAttribute("href")){const s=r.getAttribute("href");s&&s.toLowerCase().trim().startsWith("javascript:")&&(r.removeAttribute("href"),console.warn("[SVG-SANITIZE] Removed javascript: href"))}if(r.hasAttribute("xlink:href")){const s=r.getAttribute("xlink:href");s&&(s.toLowerCase().trim().startsWith("javascript:")||s.toLowerCase().trim().startsWith("data:text/html"))&&(r.removeAttribute("xlink:href"),console.warn("[SVG-SANITIZE] Removed dangerous xlink:href"))}}},...e};try{const r=A5.sanitize(t,n);if(!r||!r.includes("<svg"))return console.error("[SVG-SANITIZE] Sanitization removed SVG content - input may be malicious"),"";const s=t.length,i=r.length,a=(s-i)/s*100;return a>10&&console.warn(`[SVG-SANITIZE] Removed ${a.toFixed(1)}% of content (${s-i} chars) - possible malicious SVG detected`),r}catch(r){return console.error("[SVG-SANITIZE] Sanitization failed:",r),""}}function M5(t){if(!t||typeof t!="string")return!1;const e=t.toLowerCase(),n=["<script","javascript:","onload=","onerror=","onclick=","onmouseover=","<foreignobject","<iframe","<embed","data:text/html"];for(const r of n)if(e.includes(r))return console.warn(`[SVG-VALIDATE] Dangerous pattern detected: ${r}`),!1;return e.includes("<svg")?!0:(console.warn("[SVG-VALIDATE] Content does not appear to be valid SVG (no <svg> tag found)"),!1)}function $5(t){return t.replace("#","").toLowerCase()}async function ji(t,e,n=null){try{let r;if(n)r=n,console.log(`[SVG-RECOLOR] Using provided SVG text (${r.length} chars)`);else{console.log("[SVG-RECOLOR] Fetching SVG from:",t);const m=await fetch(t);if(!m.ok)throw new Error(`Failed to fetch SVG: ${m.status} ${m.statusText}`);r=await m.text(),console.log(`[SVG-RECOLOR] Fetched SVG (${r.length} chars)`)}console.log("[SVG-RECOLOR] Sanitizing SVG...");const s=zf(r);if(!s)throw new Error("SVG sanitization failed - content rejected");const a=new DOMParser().parseFromString(s,"image/svg+xml"),l=a.querySelector("parsererror");if(l)throw new Error(`SVG parse error: ${l.textContent}`);const c=a.documentElement;if(c.tagName!=="svg")throw new Error("Invalid SVG: root element is not <svg>");const d=L5(c,e);console.log("[SVG-RECOLOR] Recoloring complete:",d);const p=new XMLSerializer().serializeToString(a),h=new Blob([p],{type:"image/svg+xml"});return{dataUrl:URL.createObjectURL(h),svgText:p,stats:d}}catch(r){throw console.error("[SVG-RECOLOR] Error:",r),r}}function L5(t,e){const n={totalElements:0,fillsReplaced:0,strokesReplaced:0,stopColorsReplaced:0,stylesProcessed:0,colorsNotMapped:new Set},r=t.querySelectorAll("*");n.totalElements=r.length;for(const a of r){const l=a.getAttribute("fill");if(l&&l!=="none"){const p=as(l,e,n.colorsNotMapped);p!==l&&(p==="transparent"||p==="none"?(a.setAttribute("fill","none"),a.setAttribute("fill-opacity","0")):a.setAttribute("fill",p),n.fillsReplaced++)}const c=a.getAttribute("stroke");if(c&&c!=="none"){const p=as(c,e,n.colorsNotMapped);p!==c&&(p==="transparent"||p==="none"?(a.setAttribute("stroke","none"),a.setAttribute("stroke-opacity","0")):a.setAttribute("stroke",p),n.strokesReplaced++)}const d=a.getAttribute("stop-color");if(d&&d!=="none"){const p=as(d,e,n.colorsNotMapped);p!==d&&(a.setAttribute("stop-color",p),n.stopColorsReplaced++)}const u=a.getAttribute("style");if(u){const p=ey(u,e,n);p!==u&&(a.setAttribute("style",p),n.stylesProcessed++)}}const s=t.querySelectorAll("style");for(const a of s){const l=a.textContent,c=I5(l,e,n);c!==l&&(a.textContent=c,n.stylesProcessed++)}const i=t.querySelectorAll("stop");for(const a of i){const l=a.getAttribute("stop-color");if(l&&l!=="none"){const d=as(l,e,n.colorsNotMapped);d!==l&&(a.setAttribute("stop-color",d),n.stopColorsReplaced++)}const c=a.getAttribute("style");if(c&&c.includes("stop-color")){const d=ey(c,e,n);d!==c&&(a.setAttribute("style",d),n.stylesProcessed++)}}return n}function as(t,e,n){const r=z5(t);if(!r)return t;const s=`#${r}`,i=e.get(s);if(i)return i.blendHex;const a=J0(r);if(!a)return t;const l=Q0(a);let c=null,d=1/0;for(const[u,p]of e.entries()){const h=J0(u.replace("#",""));if(!h)continue;const f=Q0(h),m=D5(l,f);if(m<d&&(d=m,c=p),m<=9)return console.log(`[SVG-RECOLOR] Tolerance match: ${s}  ${u} (E=${m.toFixed(2)})`),p.blendHex}return c?(console.log(`[SVG-RECOLOR] Fallback to nearest: ${s}  ${c.blendHex} (E=${d.toFixed(2)})`),n&&n.add(t),c.blendHex):(console.warn(`[SVG-RECOLOR] No mapping found: ${s}`),t)}function J0(t){if(t.length!==6)return null;const e=parseInt(t.substring(0,2),16),n=parseInt(t.substring(2,4),16),r=parseInt(t.substring(4,6),16);return isNaN(e)||isNaN(n)||isNaN(r)?null:{r:e,g:n,b:r}}function Q0(t){let e=t.r/255,n=t.g/255,r=t.b/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;const s=(e*.4124+n*.3576+r*.1805)*100,i=(e*.2126+n*.7152+r*.0722)*100,a=(e*.0193+n*.1192+r*.9505)*100,l=95.047,c=100,d=108.883;let u=s/l,p=i/c,h=a/d;return u=u>.008856?Math.pow(u,1/3):7.787*u+16/116,p=p>.008856?Math.pow(p,1/3):7.787*p+16/116,h=h>.008856?Math.pow(h,1/3):7.787*h+16/116,{L:116*p-16,a:500*(u-p),b:200*(p-h)}}function D5(t,e){const i=Math.PI*2,a=Math.PI,l=(t.L+e.L)/2,c=Math.sqrt(t.a*t.a+t.b*t.b),d=Math.sqrt(e.a*e.a+e.b*e.b),u=(c+d)/2,p=.5*(1-Math.sqrt(Math.pow(u,7)/(Math.pow(u,7)+Math.pow(25,7)))),h=t.a*(1+p),f=e.a*(1+p),m=Math.sqrt(h*h+t.b*t.b),g=Math.sqrt(f*f+e.b*e.b),v=(m+g)/2;let x=Math.atan2(t.b,h);x<0&&(x+=i);let y=Math.atan2(e.b,f);y<0&&(y+=i);const b=Math.abs(x-y)>a?(x+y+i)/2:(x+y)/2,w=1-.17*Math.cos(b-Math.PI/6)+.24*Math.cos(2*b)+.32*Math.cos(3*b+Math.PI/30)-.2*Math.cos(4*b-63*Math.PI/180);let j=y-x;Math.abs(j)>a&&(j=j>0?j-i:j+i);const _=e.L-t.L,S=g-m,E=2*Math.sqrt(m*g)*Math.sin(j/2),T=1+.015*Math.pow(l-50,2)/Math.sqrt(20+Math.pow(l-50,2)),M=1+.045*v,Z=1+.015*v*w,N=30*Math.PI/180*Math.exp(-Math.pow((b-275*Math.PI/180)/(25*Math.PI/180),2)),C=-(2*Math.sqrt(Math.pow(v,7)/(Math.pow(v,7)+Math.pow(25,7))))*Math.sin(2*N);return Math.sqrt(Math.pow(_/(1*T),2)+Math.pow(S/(1*M),2)+Math.pow(E/(1*Z),2)+C*(S/(1*M))*(E/(1*Z)))}function ey(t,e,n){let r=t;return r=r.replace(/fill:\s*([^;]+)/gi,(s,i)=>`fill: ${as(i.trim(),e,n.colorsNotMapped)}`),r=r.replace(/stroke:\s*([^;]+)/gi,(s,i)=>`stroke: ${as(i.trim(),e,n.colorsNotMapped)}`),r=r.replace(/stop-color:\s*([^;]+)/gi,(s,i)=>`stop-color: ${as(i.trim(),e,n.colorsNotMapped)}`),r}function I5(t,e,n){let r=t,s=0;return r=r.replace(/fill:\s*([^;}\s]+)/gi,(i,a)=>{const l=a.trim(),c=as(l,e,n.colorsNotMapped);return c!==l&&(s++,console.log(`[SVG-RECOLOR-CSS] Replaced fill: ${l}  ${c}`)),`fill: ${c}`}),r=r.replace(/stroke:\s*([^;}\s]+)/gi,(i,a)=>{const l=a.trim(),c=as(l,e,n.colorsNotMapped);return c!==l&&(s++,console.log(`[SVG-RECOLOR-CSS] Replaced stroke: ${l}  ${c}`)),`stroke: ${c}`}),r=r.replace(/stop-color:\s*([^;}\s]+)/gi,(i,a)=>{const l=a.trim(),c=as(l,e,n.colorsNotMapped);return c!==l&&(s++,console.log(`[SVG-RECOLOR-CSS] Replaced stop-color: ${l}  ${c}`)),`stop-color: ${c}`}),s>0&&console.log(`[SVG-RECOLOR-CSS] Total CSS color replacements: ${s}`),r}function z5(t){const e=t.trim().toLowerCase();if(e.match(/^#?[0-9a-f]{6}$/))return $5(e);const n=e.match(/^#?([0-9a-f]{3})$/);if(n)return n[1].split("").map(a=>a+a).join("");const r=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(r){const i=parseInt(r[1],10),a=parseInt(r[2],10),l=parseInt(r[3],10);return F5(i,a,l)}const s={white:"ffffff",black:"000000",red:"ff0000",green:"008000",blue:"0000ff",yellow:"ffff00",cyan:"00ffff",magenta:"ff00ff",gray:"808080",grey:"808080",orange:"ffa500",purple:"800080"};return s[e]?s[e]:null}function F5(t,e,n){const r=s=>Math.max(0,Math.min(255,s)).toString(16).padStart(2,"0");return`${r(t)}${r(e)}${r(n)}`}function Vo(t){const n=new DOMParser().parseFromString(t,"image/svg+xml"),r=n.querySelector("parsererror");if(r)return console.error("[SVG-REGION-TAGGER] Parse error:",r.textContent),t;const s=n.documentElement;if(!s.hasAttribute("viewBox")){const l=s.getAttribute("width"),c=s.getAttribute("height");if(l&&c){const d=parseFloat(l),u=parseFloat(c);!isNaN(d)&&!isNaN(u)&&(s.setAttribute("viewBox",`0 0 ${d} ${u}`),console.log(`[SVG-REGION-TAGGER] Added viewBox from dimensions: 0 0 ${d} ${u}`))}else{const d=B5(n);d&&(s.setAttribute("viewBox",`${d.x} ${d.y} ${d.width} ${d.height}`),console.log(`[SVG-REGION-TAGGER] Added viewBox from content bounds: ${d.x} ${d.y} ${d.width} ${d.height}`))}}let i=0;return n.querySelectorAll("path, rect, circle, ellipse, polygon, polyline, line").forEach(l=>{l.hasAttribute("data-region-id")||l.setAttribute("data-region-id",`region-${i++}`)}),console.log(`[SVG-REGION-TAGGER] Tagged ${i} regions`),new XMLSerializer().serializeToString(n)}function B5(t){try{const e=t.documentElement.cloneNode(!0),n=document.createElement("div");n.style.position="absolute",n.style.visibility="hidden",document.body.appendChild(n),n.appendChild(e);const r=e.getBBox();if(document.body.removeChild(n),r.width>0&&r.height>0)return{x:Math.floor(r.x),y:Math.floor(r.y),width:Math.ceil(r.width),height:Math.ceil(r.height)}}catch(e){console.warn("[SVG-REGION-TAGGER] Could not calculate content bounds:",e)}return null}function Io(t,e){if(!e||e.size===0)return t;const r=new DOMParser().parseFromString(t,"image/svg+xml"),s=r.querySelector("parsererror");if(s)return console.error("[SVG-REGION-OVERRIDES] Parse error:",s.textContent),t;let i=0;return e.forEach((a,l)=>{const c=typeof a=="string"?a:a.hex,d=r.querySelector(`[data-region-id="${l}"]`);if(d){const u=c==="transparent"||c==="none";if((d.hasAttribute("fill")||u)&&(u?(d.setAttribute("fill","none"),d.setAttribute("fill-opacity","0")):(d.setAttribute("fill",c),d.removeAttribute("fill-opacity")),i++),d.hasAttribute("stroke")&&d.getAttribute("stroke")!=="none"){const h=d.getAttribute("stroke");h&&h!=="#000"&&h!=="#000000"&&h!=="#fff"&&h!=="#ffffff"&&(u?(d.setAttribute("stroke","none"),d.setAttribute("stroke-opacity","0")):d.setAttribute("stroke",c))}const p=d.getAttribute("style");if(p&&p.includes("fill:"))if(u){const h=p.replace(/fill:\s*[^;]+/,"fill: none");d.setAttribute("style",h)}else{const h=p.replace(/fill:\s*[^;]+/,`fill: ${c}`);d.setAttribute("style",h)}}else console.warn(`[SVG-REGION-OVERRIDES] Region not found: ${l}`)}),console.log(`[SVG-REGION-OVERRIDES] Applied ${i} region overrides`),new XMLSerializer().serializeToString(r)}async function T1(t){var x,y;const e=await Ol(t),n=(e==null?void 0:e.design)||e;if(!n)throw new Error("Design not found");if(n.input_mode==="sports_surface")throw new Error("Cannot use a sports surface design as a motif");const r=n.original_svg_url;if(!r||r.startsWith("blob:"))throw new Error("Design does not have a valid original SVG. Please ensure the design was saved after generation.");if(!n.solid_color_mapping&&!n.color_mapping)throw new Error("Design does not have color mappings. Please ensure the design was saved after color mapping.");console.log("[MOTIF] Fetching original SVG from:",r);const s=((x=n.design_data)==null?void 0:x.region_overrides)||n.region_overrides||null,i=((y=n.design_data)==null?void 0:y.original_tagged_svg)||n.original_tagged_svg||null;console.log("[MOTIF] Region overrides:",s?Object.keys(s).length:0,"regions"),console.log("[MOTIF] Original tagged SVG:",i?"present":"not present");const a=s?new Map(Object.entries(s)):null,l=await H5(r);if(!l)throw new Error("Failed to load or sanitize the original SVG.");console.log("[MOTIF] Original SVG loaded, regenerating recolored versions...");let c=null,d=null;if(n.solid_color_mapping&&Object.keys(n.solid_color_mapping).length>0)try{const b=ty(n.solid_color_mapping);console.log("[MOTIF] Solid mapping has",b.size,"colors");const{svgText:w}=await ji(null,b,l);if(c=w,console.log("[MOTIF] Generated solid SVG:",c.length,"chars"),a&&a.size>0&&c){console.log("[MOTIF] Applying",a.size,"region overrides to solid SVG");let j=c;j=Vo(c),c=Io(j,a),console.log("[MOTIF] Applied region overrides to solid SVG")}}catch(b){console.error("[MOTIF] Failed to generate solid SVG:",b)}if(n.color_mapping&&Object.keys(n.color_mapping).length>0)try{const b=ty(n.color_mapping);console.log("[MOTIF] Blend mapping has",b.size,"colors");const{svgText:w}=await ji(null,b,l);if(d=w,console.log("[MOTIF] Generated blend SVG:",d.length,"chars"),a&&a.size>0&&d){console.log("[MOTIF] Applying",a.size,"region overrides to blend SVG");let j=Vo(d);d=Io(j,a),console.log("[MOTIF] Applied region overrides to blend SVG")}}catch(b){console.error("[MOTIF] Failed to generate blend SVG:",b)}if(!c&&!d)throw new Error("Failed to regenerate TPV-recolored SVG versions.");const u=n.dimensions||{};let p=u.widthMM||u.width_mm||5e3,h=u.lengthMM||u.length_mm||5e3;const f=p===5e3&&h===5e3,m=c||d;if(m){const b=Ff(m);if(b&&b.width&&b.height){const w=b.width/b.height;(f||Math.abs(w-1)>.01)&&(w>1?(p=5e3,h=Math.round(5e3/w)):w<1&&(h=5e3,p=Math.round(5e3*w)),console.log("[MOTIF] Corrected dimensions from SVG viewBox:",p,"x",h,"mm (aspect ratio:",w.toFixed(3),")"))}}const g=n.thumbnail_url||n.original_png_url||null,v=c&&d;return{sourceDesignId:t,sourceDesignName:n.name||"Unnamed Design",sourceThumbnailUrl:g,solidSvgContent:c,blendSvgContent:d,svgContent:c||d,hasBothVersions:v,originalWidth_mm:p,originalHeight_mm:h}}function ty(t){const e=new Map;if(!t||typeof t!="object")return e;for(const[n,r]of Object.entries(t)){const s=n.startsWith("#")?n:`#${n}`;e.set(s,r)}return e}async function H5(t){try{console.log("[MOTIF] Fetching SVG from:",t);const e=await fetch(t);if(!e.ok)return console.error("[MOTIF] Failed to fetch SVG:",e.status,e.statusText),null;const n=await e.text();if(console.log("[MOTIF] Fetched content length:",n.length,"chars"),console.log("[MOTIF] Content starts with:",n.substring(0,100)),!M5(n))return console.error("[MOTIF] SVG failed quick validation"),null;const r=zf(n);return r?(console.log("[MOTIF] Sanitized SVG length:",r.length,"chars"),r):(console.error("[MOTIF] SVG sanitization failed"),null)}catch(e){return console.error("[MOTIF] Error fetching SVG:",e),null}}async function N1(t={}){const e=await yd(t);return{designs:(e.designs||[]).filter(r=>r.input_mode==="sports_surface"?!1:r.thumbnail_url||r.original_svg_url||r.original_png_url),pagination:e.pagination}}function Ff(t){if(!t)return null;const e=t.match(/viewBox=["']([^"']+)["']/i);if(e){const s=e[1].split(/\s+/).map(Number);if(s.length>=4)return{width:s[2],height:s[3]}}const n=t.match(/\bwidth=["']?(\d+(?:\.\d+)?)/i),r=t.match(/\bheight=["']?(\d+(?:\.\d+)?)/i);return n&&r?{width:parseFloat(n[1]),height:parseFloat(r[1])}:null}const U5=Object.freeze(Object.defineProperty({__proto__:null,extractSVGDimensions:Ff,fetchMotifFromDesign:T1,listPlaygroundDesigns:N1},Symbol.toStringTag,{value:"Module"}));function P1({onOpenGenerator:t,mobileMode:e=!1,modalMode:n=!1,activeTab:r,onItemAdded:s}){const[i,a]=O.useState(null),[l,c]=O.useState("courts"),d=e?r:l,u=e?()=>{}:c,[p,h]=O.useState([]),[f,m]=O.useState(!1),[g,v]=O.useState(null),[x,y]=O.useState(null),{addCourt:b,addTrack:w,addMotif:j,addShape:_,courts:S,tracks:E,motifs:T,shapes:M}=lt(),Z=Object.keys(S).length,N=Object.keys(E).length,G=Object.keys(T).length,C=BE(),F=P5();O.useEffect(()=>{d==="designs"&&p.length===0&&!f&&pe()},[d]);const pe=async()=>{m(!0),v(null);try{const ne=await N1({limit:50});h(ne.designs||[])}catch(ne){console.error("[MOTIFS] Failed to load designs:",ne),v(ne.message||"Failed to load designs")}finally{m(!1)}},V=e||n,J=ne=>{const ke=HE(ne);ke&&(b(ne,ke),V&&s&&s())},I=ne=>{const ke=R5(ne);ke&&(w(ne,ke),V&&s&&s())},K=async ne=>{if(!x){y(ne);try{const ke=await T1(ne);j(ke.sourceDesignId,ke.sourceDesignName,ke.svgContent,ke.originalWidth_mm,ke.originalHeight_mm,ke.sourceThumbnailUrl,{solidSvgContent:ke.solidSvgContent,blendSvgContent:ke.blendSvgContent,hasBothVersions:ke.hasBothVersions}),V&&s&&s()}catch(ke){console.error("[MOTIFS] Failed to add motif:",ke),alert(`Failed to add motif: ${ke.message}`)}finally{y(null)}}},z=[{id:"rectangle",name:"Rectangle",icon:""},{id:"square",name:"Square",icon:""},{id:"circle",name:"Circle",icon:""},{id:"triangle",name:"Triangle",icon:""},{id:"pentagon",name:"Pentagon",icon:""},{id:"hexagon",name:"Hexagon",icon:""},{id:"blob",name:"Blob",icon:""}],W=Object.keys(M||{}).length,ue=(()=>{switch(d){case"courts":return{title:"Courts",count:Z,hint:"Select a court to add"};case"tracks":return{title:"Tracks",count:N,hint:"Select a track to add"};case"shapes":return{title:"Shapes",count:W,hint:"Tap a shape to add it"};case"designs":return{title:"Designs",count:G,hint:"Add your saved designs as motifs"};default:return{title:"Library",count:0,hint:""}}})();return o.jsxs("div",{className:`court-library ${e?"court-library--mobile":""}`,children:[!e&&o.jsxs("div",{className:"court-library__header",children:[o.jsxs("div",{className:"court-library__header-row",children:[o.jsx("h2",{children:ue.title}),o.jsxs("span",{className:"court-library__count",children:[ue.count," on canvas"]})]}),o.jsx("p",{children:ue.hint})]}),!e&&o.jsxs("div",{className:"court-library__tabs",children:[o.jsx("button",{className:`court-library__tab ${d==="courts"?"court-library__tab--active":""}`,onClick:()=>{u("courts"),a(null)},children:"Courts"}),o.jsx("button",{className:`court-library__tab ${d==="tracks"?"court-library__tab--active":""}`,onClick:()=>{u("tracks"),a(null)},children:"Tracks"}),o.jsx("button",{className:`court-library__tab ${d==="designs"?"court-library__tab--active":""}`,onClick:()=>{u("designs"),a(null)},children:"Designs"})]}),o.jsxs("div",{className:`court-library__list ${e?"court-library__list--mobile":""}`,children:[d==="courts"&&C.map(ne=>o.jsxs("div",{className:`court-library__item ${i===ne.id?"court-library__item--selected":""}`,onClick:()=>V?J(ne.id):a(ne.id),onDoubleClick:()=>!V&&J(ne.id),children:[o.jsx("div",{className:"court-library__preview",children:o.jsx(W5,{template:ne})}),o.jsxs("div",{className:"court-library__info",children:[o.jsx("div",{className:"court-library__name",children:ne.name}),o.jsxs("div",{className:"court-library__dimensions",children:[(ne.dimensions.width_mm/1e3).toFixed(1),"m  ",(ne.dimensions.length_mm/1e3).toFixed(1),"m"]}),o.jsx("div",{className:"court-library__standard",children:ne.standard})]}),i===ne.id&&o.jsx("button",{className:"court-library__add-btn",onClick:ke=>{ke.stopPropagation(),J(ne.id)},children:"+ ADD"})]},ne.id)),d==="tracks"&&F.map(ne=>o.jsxs("div",{className:`court-library__item ${i===ne.id?"court-library__item--selected":""}`,onClick:()=>V?I(ne.id):a(ne.id),onDoubleClick:()=>!V&&I(ne.id),children:[o.jsx("div",{className:"court-library__preview",children:o.jsx(V5,{template:ne})}),o.jsxs("div",{className:"court-library__info",children:[o.jsx("div",{className:"court-library__name",children:ne.name}),o.jsxs("div",{className:"court-library__standard",children:[ne.parameters.numLanes," Lanes  ",ne.standard]}),o.jsx("div",{className:"court-library__note",children:"Scales to fit canvas"})]}),i===ne.id&&o.jsx("button",{className:"court-library__add-btn",onClick:ke=>{ke.stopPropagation(),I(ne.id)},children:"+ ADD"})]},ne.id)),d==="shapes"&&o.jsx("div",{className:`court-library__shapes-grid ${e?"court-library__shapes-grid--mobile":""}`,children:z.map(ne=>o.jsxs("button",{className:"court-library__shape-btn",onClick:()=>{_(ne.id),e&&s&&s()},children:[o.jsx("span",{className:"court-library__shape-icon",children:ne.icon}),o.jsx("span",{className:"court-library__shape-name",children:ne.name})]},ne.id))}),d==="designs"&&o.jsxs(o.Fragment,{children:[f&&o.jsxs("div",{className:"court-library__loading",children:[o.jsx("div",{className:"court-library__spinner"}),o.jsx("p",{children:"Loading your designs..."})]}),g&&o.jsxs("div",{className:"court-library__error",children:[o.jsx("p",{children:g}),o.jsx("button",{onClick:pe,children:"Try Again"})]}),!f&&!g&&p.length===0&&o.jsxs("div",{className:"court-library__empty",children:[o.jsx("p",{children:"No designs found."}),o.jsx("p",{className:"court-library__empty-hint",children:"Generate new designs or save them to use as motifs."})]}),!f&&p.map(ne=>{var ke,ce;return o.jsxs("div",{className:`court-library__item ${i===ne.id?"court-library__item--selected":""} ${x===ne.id?"court-library__item--loading":""}`,onClick:()=>V?K(ne.id):a(ne.id),onDoubleClick:()=>!V&&K(ne.id),children:[o.jsx("div",{className:"court-library__preview",children:o.jsx(Y5,{design:ne})}),o.jsxs("div",{className:"court-library__info",children:[o.jsx("div",{className:"court-library__name",children:ne.name||"Unnamed Design"}),o.jsxs("div",{className:"court-library__dimensions",children:[((((ke=ne.design_data)==null?void 0:ke.widthMM)||5e3)/1e3).toFixed(1),"m  ",((((ce=ne.design_data)==null?void 0:ce.lengthMM)||5e3)/1e3).toFixed(1),"m"]}),o.jsx("div",{className:"court-library__note",children:"Playground Design"})]}),i===ne.id&&o.jsx("button",{className:"court-library__add-btn",onClick:$e=>{$e.stopPropagation(),K(ne.id)},disabled:x===ne.id,children:x===ne.id?"Adding...":"+ ADD"})]},ne.id)})]})]}),!e&&o.jsx("div",{className:"court-library__generate",children:o.jsxs("button",{className:"court-library__generate-btn",onClick:t,children:[o.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M12 5v14M5 12h14"})}),"Generate New Design"]})}),!e&&!n&&o.jsx("div",{className:"court-library__footer",children:o.jsxs("p",{className:"court-library__hint",children:[d==="courts"&&"Double-click a court to add it instantly",d==="tracks"&&"Double-click a track to add it instantly",d==="designs"&&"Double-click a design to add it as a motif"]})})]})}function W5({template:t}){const e=t.dimensions.width_mm,n=t.dimensions.length_mm,r=Math.min(62/e,62/n),s=e*r,i=n*r;return o.jsxs("svg",{width:"62",height:"62",viewBox:"0 0 62 62",className:"court-library__svg-preview",children:[o.jsx("rect",{x:(62-s)/2,y:(62-i)/2,width:s,height:i,fill:"#e5e7eb",stroke:"#9ca3af",strokeWidth:"1.5"}),t.markings.map((a,l)=>o.jsx(G5,{marking:a,scale:r,offsetX:(62-s)/2,offsetY:(62-i)/2},l))]})}function G5({marking:t,scale:e,offsetX:n,offsetY:r}){const{type:s,params:i}=t;switch(s){case"line":return o.jsx("line",{x1:i.x1*e+n,y1:i.y1*e+r,x2:i.x2*e+n,y2:i.y2*e+r,stroke:"#1e293b",strokeWidth:"1.5"});case"rectangle":return o.jsx("rect",{x:i.x*e+n,y:i.y*e+r,width:i.width*e,height:i.height*e,stroke:"#1e293b",strokeWidth:"1.5",fill:"none"});case"circle":return o.jsx("circle",{cx:i.cx*e+n,cy:i.cy*e+r,r:i.radius*e,stroke:"#1e293b",strokeWidth:"1.5",fill:"none"});case"arc":{const{cx:a,cy:l,radius:c,startAngle:d,endAngle:u}=i,p=d*Math.PI/180,h=u*Math.PI/180,f=(a+c*Math.cos(p))*e+n,m=(l+c*Math.sin(p))*e+r,g=(a+c*Math.cos(h))*e+n,v=(l+c*Math.sin(h))*e+r,x=u-d>180?1:0,y=`M ${f} ${m} A ${c*e} ${c*e} 0 ${x} 1 ${g} ${v}`;return o.jsx("path",{d:y,stroke:"#1e293b",strokeWidth:"1.5",fill:"none"})}default:return null}}function V5({template:t}){const{parameters:e}=t,n=e.width_mm,r=e.height_mm,s=Math.min(58/n,58/r),i=n*s,a=r*s,l=e.numLanes,c=e.laneWidth_mm*s,d=e.cornerRadius,p=(d.topLeft+d.topRight+d.bottomLeft+d.bottomRight)/4*s,h=(62-i)/2,f=(62-a)/2;return o.jsxs("svg",{width:"62",height:"62",viewBox:"0 0 62 62",className:"court-library__svg-preview",children:[o.jsx("rect",{x:h,y:f,width:i,height:a,rx:p,fill:"#e5e7eb"}),Array.from({length:l}).map((m,g)=>{const v=g*c,x=Math.max(0,p-v);return o.jsx("rect",{x:h+v,y:f+v,width:Math.max(0,i-v*2),height:Math.max(0,a-v*2),rx:x,stroke:"#1e293b",strokeWidth:"1",fill:"none"},g)})]})}function Y5({design:t}){const e=t.thumbnail_url||t.original_png_url;return e?o.jsx("img",{src:e,alt:t.name||"Design preview",className:"court-library__motif-img",style:{width:"62px",height:"62px",objectFit:"contain",borderRadius:"4px",backgroundColor:"#f3f4f6"},onError:n=>{n.target.style.display="none",n.target.nextSibling&&(n.target.nextSibling.style.display="flex")}}):o.jsx("div",{className:"court-library__motif-placeholder",style:{width:"62px",height:"62px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#e5e7eb",borderRadius:"4px",color:"#9ca3af",fontSize:"10px",textAlign:"center"},children:"No Preview"})}function q5({isOpen:t,onClose:e,onOpenGenerator:n}){return O.useEffect(()=>{if(!t)return;const r=s=>{s.key==="Escape"&&e()};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[t,e]),O.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[t]),t?o.jsx("div",{className:"court-library-modal__overlay",onClick:e,children:o.jsxs("div",{className:"court-library-modal__container",onClick:r=>r.stopPropagation(),children:[o.jsxs("div",{className:"court-library-modal__header",children:[o.jsx("h2",{children:"Element Library"}),o.jsx("p",{children:"Select courts, tracks, or designs to add to your canvas"}),o.jsx("button",{className:"court-library-modal__close",onClick:e,"aria-label":"Close",children:o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),o.jsx("div",{className:"court-library-modal__content",children:o.jsx(P1,{modalMode:!0,onItemAdded:e,onOpenGenerator:()=>{e(),n()}})})]})}):null}function ny({onEditSourceDesign:t}){var D,P;const{courts:e,tracks:n,motifs:r,shapes:s,texts:i,exclusionZones:a,groups:l,selectedCourtId:c,selectedTrackId:d,selectedMotifId:u,selectedShapeId:p,selectedTextId:h,selectedExclusionZoneId:f,selectedGroupId:m,editingGroupId:g,updateCourtPosition:v,updateCourtRotation:x,updateCourtScale:y,setLineColor:b,setZoneColor:w,setCourtSurfaceColor:j,resetCourtColors:_,removeCourt:S,removeTrack:E,removeMotif:T,updateMotifPosition:M,updateMotifRotation:Z,updateMotifScale:N,updateTrackParameters:G,enterGroup:C,exitGroup:F,ungroup:pe,deleteGroupWithChildren:V,addToHistory:J}=lt(),[I,K]=O.useState("transform"),[z,W]=O.useState(null);if(m){const $=l[m];return $?o.jsx(eT,{group:$,groupId:m,shapes:s,isEditing:g===m,onEnterGroup:()=>C(m),onExitGroup:()=>F(),onUngroup:()=>pe(m),onDelete:()=>V(m)}):null}if(f){const $=a[f];return $?o.jsx(Q5,{zone:$,zoneId:f}):null}if(h){const $=i[h];return $?o.jsx(J5,{text:$,textId:h}):null}if(p){const $=s[p];return $?o.jsx(Z5,{shape:$,shapeId:p}):null}if(u){const $=r[u];return $?o.jsx(K5,{motif:$,motifId:u,onEditSourceDesign:t}):null}if(d){const $=n[d];return $?o.jsx(X5,{track:$,trackId:d}):null}if(!c)return o.jsx("div",{className:"properties-panel properties-panel--empty",children:o.jsxs("div",{className:"properties-panel__empty-state",children:[o.jsx("p",{children:"No element selected"}),o.jsx("span",{className:"properties-panel__hint",children:"Click on a court, track, or motif to view and edit its properties"})]})});const fe=e[c];if(!fe)return null;const{position:ue,rotation:ne,scale:ke,template:ce,lineColorOverrides:$e,zoneColorOverrides:ze}=fe,Ue=($,Y)=>{const se=parseFloat(Y);isNaN(se)||v(c,{...ue,[$]:se})},Ge=$=>{const Y=parseFloat($);isNaN(Y)||x(c,Y)},at=$=>{const Y=parseFloat($);isNaN(Y)||Y<=0||y(c,Y)},Ve=()=>{window.confirm(`Delete ${ce.name}? This action cannot be undone.`)&&S(c)},k=$=>{if(!z)return;if(z.type==="courtSurface"&&$===null){j(c,null),W(null);return}if(!$)return;const Y={tpv_code:$.code,hex:$.hex,name:$.name};z.type==="line"?b(c,z.id,Y):z.type==="zone"?w(c,z.id,Y):z.type==="courtSurface"?j(c,Y):z.type==="allLines"&&ce.markings.forEach(se=>{b(c,se.id,Y)}),W(null)},Q=$=>{const Y=$e[$.id];if(Y)return{code:Y.tpv_code,hex:Y.hex,name:Y.name};const se=fn.find(B=>B.code===ce.defaultLineColor);return se?{code:se.code,hex:se.hex,name:se.name}:null},oe=$=>{const Y=ze[$.id];if(Y)return{code:Y.tpv_code,hex:Y.hex,name:Y.name};const se=fn.find(B=>B.code===$.defaultColor);return se?{code:se.code,hex:se.hex,name:se.name}:null};return o.jsxs("div",{className:"properties-panel",children:[o.jsxs("div",{className:"properties-panel__header",children:[o.jsx("h3",{children:"Properties"}),o.jsxs("div",{className:"properties-panel__court-info",children:[o.jsx("span",{className:"court-name",children:ce.name}),o.jsx("span",{className:"court-standard",children:ce.standard})]})]}),o.jsxs("div",{className:"properties-panel__tabs",children:[o.jsx("button",{className:`tab ${I==="transform"?"tab--active":""}`,onClick:()=>K("transform"),children:"Transform"}),o.jsx("button",{className:`tab ${I==="lines"?"tab--active":""}`,onClick:()=>K("lines"),children:"Lines"}),o.jsx("button",{className:`tab ${I==="zones"?"tab--active":""}`,onClick:()=>K("zones"),children:"Zones"})]}),o.jsxs("div",{className:"properties-panel__content",children:[I==="transform"&&o.jsxs("div",{className:"properties-section",children:[o.jsx("div",{className:"properties-section__header",children:o.jsx("h4",{children:"Transform"})}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Position"}),o.jsxs("div",{className:"property-input-row",children:[o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"X"}),o.jsx("input",{type:"number",value:Math.round(ue.x),onChange:$=>Ue("x",$.target.value),step:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"Y"}),o.jsx("input",{type:"number",value:Math.round(ue.y),onChange:$=>Ue("y",$.target.value),step:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Rotation"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"0",max:"360",value:ne,onChange:$=>Ge($.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:Math.round(ne),onChange:$=>Ge($.target.value),min:"0",max:"360"}),o.jsx("span",{className:"property-unit",children:""})]})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Scale"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"0.5",max:"2.0",step:"0.1",value:ke,onChange:$=>at($.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:ke.toFixed(2),onChange:$=>at($.target.value),min:"0.5",max:"2.0",step:"0.1"}),o.jsx("span",{className:"property-unit",children:""})]})]})]}),o.jsxs("div",{className:"property-group property-group--info",children:[o.jsx("label",{children:"Dimensions"}),o.jsx("div",{className:"property-info",children:o.jsxs("span",{children:[(ce.dimensions.width_mm*ke/1e3).toFixed(1),"m  ",(ce.dimensions.length_mm*ke/1e3).toFixed(1),"m"]})})]}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-delete",onClick:Ve,title:"Delete court (Delete key)",children:" Delete Court"})})]}),I==="lines"&&o.jsxs("div",{className:"properties-section",children:[o.jsxs("div",{className:"properties-section__header",children:[o.jsx("h4",{children:"Line Markings"}),o.jsx("button",{className:"btn-reset",onClick:()=>_(c),title:"Reset all colours to defaults",children:"Reset"})]}),o.jsxs("div",{className:"color-item color-item--all-lines",children:[o.jsxs("div",{className:"color-item__info",children:[o.jsx("span",{className:"color-item__name",children:"Change All Lines"}),o.jsx("span",{className:"color-item__hint",children:"Set all lines to same colour"})]}),o.jsx("button",{className:"color-item__swatch color-item__swatch--all",onClick:()=>W({type:"allLines"}),title:"Change all line colours at once",children:o.jsx("span",{style:{fontSize:"1rem"},children:""})})]}),o.jsx("div",{className:"color-list",children:ce.markings.map($=>{const Y=Q($);return o.jsxs("div",{className:"color-item",children:[o.jsxs("div",{className:"color-item__info",children:[o.jsx("span",{className:"color-item__name",children:$.name}),Y&&o.jsx("span",{className:"color-item__code",children:Y.code})]}),o.jsx("button",{className:"color-item__swatch",style:{backgroundColor:(Y==null?void 0:Y.hex)||"#000"},onClick:()=>W({type:"line",id:$.id}),title:(Y==null?void 0:Y.name)||"Select colour"})]},$.id)})})]}),I==="zones"&&o.jsxs("div",{className:"properties-section",children:[o.jsx("div",{className:"properties-section__header",children:o.jsx("h4",{children:"Fill Colours"})}),o.jsxs("div",{className:"color-item color-item--surface-fill",children:[o.jsxs("div",{className:"color-item__info",children:[o.jsx("span",{className:"color-item__name",children:"Court Surface"}),o.jsx("span",{className:"color-item__hint",children:fe.courtSurfaceColor?fe.courtSurfaceColor.name:"No Fill (transparent)"}),fe.courtSurfaceColor&&o.jsx("span",{className:"color-item__code",children:fe.courtSurfaceColor.tpv_code})]}),o.jsx("button",{className:`color-item__swatch ${fe.courtSurfaceColor?"":"color-item__swatch--no-fill"}`,style:{backgroundColor:((D=fe.courtSurfaceColor)==null?void 0:D.hex)||"transparent"},onClick:()=>W({type:"courtSurface"}),title:((P=fe.courtSurfaceColor)==null?void 0:P.name)||"No Fill - Click to select colour"})]}),ce.zones&&ce.zones.length>0&&o.jsx("div",{className:"properties-section__divider",children:o.jsx("span",{children:"Paint Zones"})}),ce.zones&&ce.zones.length>0&&o.jsx("div",{className:"color-list",children:ce.zones.map($=>{var se;const Y=oe($);return o.jsxs("div",{className:"color-item",children:[o.jsxs("div",{className:"color-item__info",children:[o.jsx("span",{className:"color-item__name",children:$.name}),o.jsxs("span",{className:"color-item__area",children:[((se=$.area_m2)==null?void 0:se.toFixed(1))||0," m"]}),Y&&o.jsx("span",{className:"color-item__code",children:Y.code})]}),o.jsx("button",{className:"color-item__swatch",style:{backgroundColor:(Y==null?void 0:Y.hex)||"#000"},onClick:()=>W({type:"zone",id:$.id}),title:(Y==null?void 0:Y.name)||"Select colour"})]},$.id)})})]})]}),z&&o.jsx("div",{className:"color-picker-modal",onClick:()=>W(null),children:o.jsxs("div",{className:"color-picker-modal__content",onClick:$=>$.stopPropagation(),children:[o.jsxs("div",{className:"color-picker-modal__header",children:[o.jsx("h4",{children:z.type==="allLines"?"Change All Line Colours":z.type==="courtSurface"?"Select Court Fill Colour":"Select TPV Colour"}),o.jsx("button",{onClick:()=>W(null),children:""})]}),o.jsxs("div",{className:"color-picker-grid",children:[z.type==="courtSurface"&&o.jsx("button",{className:"color-picker-swatch color-picker-swatch--no-fill",onClick:()=>k(null),title:"No Fill (transparent)",children:o.jsx("span",{className:"color-picker-swatch__code",children:"None"})}),fn.map($=>o.jsx("button",{className:"color-picker-swatch",style:{backgroundColor:$.hex},onClick:()=>k($),title:`${$.code} - ${$.name}`,children:o.jsx("span",{className:"color-picker-swatch__code",children:$.code})},$.code))]})]})})]})}function X5({track:t,trackId:e}){var Te,He,Ee;const{updateTrackParameters:n,updateTrackRotation:r,removeTrack:s,setTrackSurfaceColor:i,setTrackLineColor:a,setLaneSurfaceColor:l,resetLaneSurfaceColors:c,addToHistory:d}=lt(),{parameters:u,template:p,trackSurfaceColor:h,trackLineColor:f,laneSurfaceColors:m,rotation:g}=t,[v,x]=L.useState(!0),[y,b]=L.useState(!1),[w,j]=L.useState(!1),[_,S]=L.useState(null),[E,T]=L.useState(""),[M,Z]=L.useState(""),[N,G]=L.useState(""),[C,F]=L.useState(!1),[pe,V]=L.useState(!1),[J,I]=L.useState(!1),K=p.trackType==="straight",z=_1(u),W=((Te=z.lanes[0])==null?void 0:Te.perimeter)||0,fe=z.lanes[z.lanes.length-1],ue=(fe==null?void 0:fe.perimeter)||0,ne=K?[]:S1(z),ke=ie=>{const he=parseInt(ie);if(!(isNaN(he)||he<1||he>8))if(K){const Xe=he*u.laneWidth_mm;n(e,{numLanes:he,width_mm:Xe})}else n(e,{numLanes:he})},ce=ie=>{const he=parseFloat(ie)*1e3;return isNaN(he)||he<3e3?!1:(n(e,{width_mm:he}),!0)},$e=ie=>{const he=parseFloat(ie)*1e3;return isNaN(he)||he<3e3?!1:(n(e,{height_mm:he}),!0)},ze=()=>{F(!0),T((u.width_mm/1e3).toFixed(1))},Ue=()=>{F(!1),ce(E)},Ge=ie=>{ie.key==="Enter"?ie.target.blur():ie.key==="Escape"&&(F(!1),T((u.width_mm/1e3).toFixed(1)))},at=()=>{V(!0),Z((u.height_mm/1e3).toFixed(1))},Ve=()=>{V(!1),$e(M)},k=ie=>{ie.key==="Enter"?ie.target.blur():ie.key==="Escape"&&(V(!1),Z((u.height_mm/1e3).toFixed(1)))},Q=ie=>{let he=parseFloat(ie);return isNaN(he)?!1:(he=(he%360+360)%360,r(e,he),d(),!0)},oe=()=>{I(!0),G(g.toFixed(0))},D=()=>{I(!1),Q(N)},P=ie=>{ie.key==="Enter"?ie.target.blur():ie.key==="Escape"&&(I(!1),G(g.toFixed(0)))},$=(ie,he)=>{const Xe=parseFloat(he)*1e3;if(isNaN(Xe)||Xe<0)return;const tt=Math.min(u.width_mm,u.height_mm)/2,nt=Math.min(Xe,tt);v?n(e,{cornerRadius:{topLeft:nt,topRight:nt,bottomLeft:nt,bottomRight:nt}}):n(e,{cornerRadius:{...u.cornerRadius,[ie]:nt}})},Y=()=>{window.confirm(`Delete ${p.name}? This action cannot be undone.`)&&s(e)},se=ie=>{i(e,{tpv_code:ie.code,hex:ie.hex,name:ie.name}),b(!1)},B=ie=>{a(e,{tpv_code:ie.code,hex:ie.hex,name:ie.name}),j(!1)},re=ie=>{n(e,{startingBoxes:{...u.startingBoxes,enabled:ie}})},ye=ie=>{const he=parseFloat(ie)*1e3;isNaN(he)||he<100||n(e,{startingBoxes:{...u.startingBoxes,depth_mm:he}})},le=ie=>{n(e,{startingBoxes:{...u.startingBoxes,style:ie}})},U=ie=>{n(e,{startingBoxes:{...u.startingBoxes,direction:ie}})},ae=ie=>{const he=parseFloat(ie);isNaN(he)||he<0||he>100||n(e,{startingBoxes:{...u.startingBoxes,startPosition:he}})},xe=(u.cornerRadius.topLeft+u.cornerRadius.topRight+u.cornerRadius.bottomLeft+u.cornerRadius.bottomRight)/4;return o.jsxs("div",{className:"properties-panel",children:[o.jsxs("div",{className:"properties-panel__header",children:[o.jsx("h3",{children:"Track Properties"}),o.jsxs("div",{className:"properties-panel__court-info",children:[o.jsx("span",{className:"court-name",children:p.name}),o.jsx("span",{className:"court-standard",children:p.standard})]})]}),o.jsx("div",{className:"properties-panel__content",children:o.jsxs("div",{className:"properties-section",children:[o.jsx("div",{className:"properties-section__header",children:o.jsx("h4",{children:"Track Parameters"})}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Number of Lanes"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"1",max:"8",value:u.numLanes,onChange:ie=>ke(ie.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:u.numLanes,onChange:ie=>ke(ie.target.value),min:"1",max:"8"}),o.jsx("span",{className:"property-unit",children:"lanes"})]})]})]}),K?o.jsxs("div",{className:"property-group property-group--info",children:[o.jsx("label",{children:"Track Width"}),o.jsx("div",{className:"property-info",children:o.jsxs("span",{children:[(u.width_mm/1e3).toFixed(1),"m (Auto-calculated from lanes)"]})})]}):o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Track Width"}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("input",{type:"number",value:C?E:(u.width_mm/1e3).toFixed(1),onChange:ie=>T(ie.target.value),onFocus:ze,onBlur:Ue,onKeyDown:Ge,min:"3",max:"100",step:"0.5"}),o.jsx("span",{className:"property-unit",children:"m"})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:K?"Track Length":"Track Height"}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("input",{type:"number",value:pe?M:(u.height_mm/1e3).toFixed(1),onChange:ie=>Z(ie.target.value),onFocus:at,onBlur:Ve,onKeyDown:k,min:"3",max:"100",step:"0.5"}),o.jsx("span",{className:"property-unit",children:"m"})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Rotation"}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("input",{type:"number",value:J?N:g.toFixed(0),onChange:ie=>G(ie.target.value),onFocus:oe,onBlur:D,onKeyDown:P,min:"0",max:"360",step:"15"}),o.jsx("span",{className:"property-unit",children:""})]})]}),!K&&o.jsxs("div",{className:"property-group",children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[o.jsx("label",{children:"Corner Radius"}),o.jsx("button",{className:"btn-toggle",onClick:()=>x(!v),style:{padding:"0.25rem 0.5rem",fontSize:"0.75rem",background:v?"#0066CC":"#6b7280",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},title:v?"Click to edit corners independently":"Click to lock all corners together",children:v?" Locked":" Independent"})]}),v?o.jsxs("div",{className:"property-input-group",children:[o.jsx("input",{type:"number",value:(xe/1e3).toFixed(2),onChange:ie=>$("topLeft",ie.target.value),min:"0",max:(Math.min(u.width_mm,u.height_mm)/2e3).toFixed(0),step:"0.5"}),o.jsx("span",{className:"property-unit",children:"m"})]}):o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.5rem"},children:[o.jsxs("div",{children:[o.jsx("label",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Top Left"}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("input",{type:"number",value:(u.cornerRadius.topLeft/1e3).toFixed(2),onChange:ie=>$("topLeft",ie.target.value),min:"0",max:(Math.min(u.width_mm,u.height_mm)/2e3).toFixed(0),step:"0.5"}),o.jsx("span",{className:"property-unit",children:"m"})]})]}),o.jsxs("div",{children:[o.jsx("label",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Top Right"}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("input",{type:"number",value:(u.cornerRadius.topRight/1e3).toFixed(2),onChange:ie=>$("topRight",ie.target.value),min:"0",max:(Math.min(u.width_mm,u.height_mm)/2e3).toFixed(0),step:"0.5"}),o.jsx("span",{className:"property-unit",children:"m"})]})]}),o.jsxs("div",{children:[o.jsx("label",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Bottom Left"}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("input",{type:"number",value:(u.cornerRadius.bottomLeft/1e3).toFixed(2),onChange:ie=>$("bottomLeft",ie.target.value),min:"0",max:(Math.min(u.width_mm,u.height_mm)/2e3).toFixed(0),step:"0.5"}),o.jsx("span",{className:"property-unit",children:"m"})]})]}),o.jsxs("div",{children:[o.jsx("label",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Bottom Right"}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("input",{type:"number",value:(u.cornerRadius.bottomRight/1e3).toFixed(2),onChange:ie=>$("bottomRight",ie.target.value),min:"0",max:(Math.min(u.width_mm,u.height_mm)/2e3).toFixed(0),step:"0.5"}),o.jsx("span",{className:"property-unit",children:"m"})]})]})]})]}),o.jsxs("div",{className:"property-group property-group--info",children:[o.jsx("label",{children:"Lane Width"}),o.jsx("div",{className:"property-info",children:o.jsxs("span",{children:[(u.laneWidth_mm/1e3).toFixed(2),"m (Fixed)"]})})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Track Surface Colour"}),o.jsxs("div",{className:"color-item",children:[o.jsxs("div",{className:"color-item__info",children:[o.jsx("span",{className:"color-item__name",children:(h==null?void 0:h.name)||"Select Colour"}),h&&o.jsx("span",{className:"color-item__code",children:h.tpv_code})]}),o.jsx("button",{className:"color-item__swatch",style:{backgroundColor:(h==null?void 0:h.hex)||"#A5362F"},onClick:()=>b(!0),title:(h==null?void 0:h.name)||"Select colour"})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[o.jsx("label",{style:{margin:0},children:"Lane Colours"}),(m==null?void 0:m.some(ie=>ie!=null))&&o.jsx("button",{onClick:()=>c(e),title:"Reset all lanes to track surface colour",style:{padding:"0.25rem 0.5rem",fontSize:"0.7rem",background:"#f1f5f9",border:"1px solid #e2e8f0",borderRadius:"4px",cursor:"pointer",color:"#64748b"},children:"Reset All"})]}),o.jsx("div",{className:"lane-color-grid",children:z.lanes.map(ie=>{const he=(m==null?void 0:m[ie.laneNumber-1])||h,Xe=(m==null?void 0:m[ie.laneNumber-1])!=null;return o.jsxs("div",{className:"lane-color-item",children:[o.jsxs("span",{className:"lane-number",children:["Lane ",ie.laneNumber]}),o.jsx("button",{className:`color-item__swatch lane-swatch ${Xe?"lane-swatch--override":""}`,style:{backgroundColor:(he==null?void 0:he.hex)||"#A5362F"},onClick:()=>S({laneNumber:ie.laneNumber}),title:`${(he==null?void 0:he.name)||"Standard Red"}${Xe?" (custom)":" (default)"}`}),Xe&&o.jsx("button",{className:"lane-reset-btn",onClick:()=>l(e,ie.laneNumber,null),title:"Reset to track default",children:""})]},ie.laneNumber)})}),o.jsx("div",{style:{fontSize:"0.7rem",color:"#94a3b8",marginTop:"0.5rem"},children:"Click a swatch to change lane colour"})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Line Colour"}),o.jsxs("div",{className:"color-item",children:[o.jsxs("div",{className:"color-item__info",children:[o.jsx("span",{className:"color-item__name",children:(f==null?void 0:f.name)||"Cream"}),f&&o.jsx("span",{className:"color-item__code",children:f.tpv_code})]}),o.jsx("button",{className:"color-item__swatch",style:{backgroundColor:(f==null?void 0:f.hex)||"#E8E3D8"},onClick:()=>j(!0),title:(f==null?void 0:f.name)||"Select colour"})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[o.jsx("input",{type:"checkbox",checked:((He=u.startingBoxes)==null?void 0:He.enabled)||!1,onChange:ie=>re(ie.target.checked)}),"Show Starting Boxes"]}),((Ee=u.startingBoxes)==null?void 0:Ee.enabled)&&o.jsxs("div",{style:{marginTop:"0.75rem"},children:[o.jsxs("div",{className:"property-input-group",style:{marginBottom:"0.75rem"},children:[o.jsx("span",{className:"property-label",style:{fontSize:"0.875rem"},children:"Depth"}),o.jsx("input",{type:"number",value:(u.startingBoxes.depth_mm/1e3).toFixed(2),onChange:ie=>ye(ie.target.value),min:"0.1",max:"1.0",step:"0.05"}),o.jsx("span",{className:"property-unit",children:"m"})]}),!K&&o.jsxs("div",{style:{marginBottom:"0.75rem"},children:[o.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#64748b",marginBottom:"0.375rem"},children:"Start Style"}),o.jsxs("select",{value:u.startingBoxes.style||"staggered",onChange:ie=>le(ie.target.value),style:{width:"100%",padding:"0.5rem",border:"1px solid #e4e9f0",borderRadius:"6px",fontSize:"0.875rem",fontFamily:"inherit",background:"white"},children:[o.jsx("option",{value:"straight",children:"Straight Start"}),o.jsx("option",{value:"staggered",children:"Staggered Start"}),o.jsx("option",{value:"both",children:"Both (opposite ends)"})]})]}),o.jsxs("div",{style:{marginBottom:"0.75rem"},children:[o.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#64748b",marginBottom:"0.375rem"},children:"Direction of Travel"}),o.jsxs("select",{value:u.startingBoxes.direction||"counterclockwise",onChange:ie=>U(ie.target.value),style:{width:"100%",padding:"0.5rem",border:"1px solid #e4e9f0",borderRadius:"6px",fontSize:"0.875rem",fontFamily:"inherit",background:"white"},children:[o.jsx("option",{value:"counterclockwise",children:"Counterclockwise (Standard)"}),o.jsx("option",{value:"clockwise",children:"Clockwise"})]})]}),!K&&o.jsxs("div",{style:{marginBottom:"0.75rem"},children:[o.jsxs("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#64748b",marginBottom:"0.375rem"},children:["Start Position (",u.startingBoxes.startPosition||0,"%)"]}),o.jsx("input",{type:"range",min:"0",max:"100",step:"1",value:u.startingBoxes.startPosition||0,onChange:ie=>ae(ie.target.value),className:"property-slider",style:{width:"100%"}}),o.jsx("div",{style:{fontSize:"0.7rem",color:"#94a3b8",marginTop:"0.25rem"},children:"Slide to adjust where the start line appears around the track"})]}),o.jsx("div",{className:"property-info",style:{fontSize:"0.75rem",color:"#64748b",marginTop:"0.5rem"},children:"Boxes use track surface colour with white starting line and lane numbers"}),!K&&ne.length>0&&(u.startingBoxes.style==="staggered"||u.startingBoxes.style==="both")&&o.jsxs("div",{style:{marginTop:"0.75rem",padding:"0.5rem",background:"#f8fafc",borderRadius:"4px"},children:[o.jsx("div",{style:{fontSize:"0.75rem",fontWeight:"600",color:"#1e293b",marginBottom:"0.25rem"},children:"Auto-Calculated Staggers:"}),o.jsx("div",{style:{fontSize:"0.7rem",color:"#64748b",lineHeight:"1.4"},children:ne.map((ie,he)=>o.jsxs("div",{children:["Lane ",he+1,": ",(ie/1e3).toFixed(2),"m"]},he))}),o.jsx("div",{style:{fontSize:"0.65rem",color:"#64748b",marginTop:"0.25rem",fontStyle:"italic"},children:"Outer lanes start ahead to equalize distance"})]})]})]}),o.jsx("div",{className:"property-divider"}),o.jsx("div",{className:"properties-section__header",children:o.jsx("h4",{children:"Calculated Dimensions"})}),o.jsxs("div",{className:"property-group property-group--info",children:[o.jsx("label",{children:"Usable Infield"}),o.jsx("div",{className:"property-info",children:o.jsxs("span",{children:[(z.usableWidth/1e3).toFixed(1),"m  ",(z.usableHeight/1e3).toFixed(1),"m"]})})]}),o.jsxs("div",{className:"property-group property-group--info",children:[o.jsx("label",{children:"Lane 1 Perimeter"}),o.jsx("div",{className:"property-info",children:o.jsxs("span",{children:[W.toFixed(2),"m"]})})]}),u.numLanes>1&&!K&&o.jsxs("div",{className:"property-group property-group--info",children:[o.jsxs("label",{children:["Lane ",u.numLanes," Perimeter"]}),o.jsx("div",{className:"property-info",children:o.jsxs("span",{children:[ue.toFixed(2),"m"]})})]}),o.jsx("div",{className:"property-group",children:o.jsx("div",{className:"property-hint",style:{fontStyle:"normal",color:"#64748b",fontSize:"0.75rem",marginTop:"1rem"},children:" Tip: Use drag handles on the canvas or edit values here. Corner radius auto-adjusts when locked."})}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-delete",onClick:Y,title:"Delete track (Delete key)",children:" Delete Track"})})]})}),y&&o.jsx("div",{className:"color-picker-modal",onClick:()=>b(!1),children:o.jsxs("div",{className:"color-picker-modal__content",onClick:ie=>ie.stopPropagation(),children:[o.jsxs("div",{className:"color-picker-modal__header",children:[o.jsx("h4",{children:"Select Track Surface Colour"}),o.jsx("button",{onClick:()=>b(!1),children:""})]}),o.jsx("div",{className:"color-picker-grid",children:fn.map(ie=>o.jsx("button",{className:"color-picker-swatch",style:{backgroundColor:ie.hex},onClick:()=>se(ie),title:`${ie.code} - ${ie.name}`,children:o.jsx("span",{className:"color-picker-swatch__code",children:ie.code})},ie.code))})]})}),w&&o.jsx("div",{className:"color-picker-modal",onClick:()=>j(!1),children:o.jsxs("div",{className:"color-picker-modal__content",onClick:ie=>ie.stopPropagation(),children:[o.jsxs("div",{className:"color-picker-modal__header",children:[o.jsx("h4",{children:"Select Line Colour"}),o.jsx("button",{onClick:()=>j(!1),children:""})]}),o.jsx("div",{className:"color-picker-grid",children:fn.map(ie=>o.jsx("button",{className:"color-picker-swatch",style:{backgroundColor:ie.hex},onClick:()=>B(ie),title:`${ie.code} - ${ie.name}`,children:o.jsx("span",{className:"color-picker-swatch__code",children:ie.code})},ie.code))})]})}),_&&o.jsx("div",{className:"color-picker-modal",onClick:()=>S(null),children:o.jsxs("div",{className:"color-picker-modal__content",onClick:ie=>ie.stopPropagation(),children:[o.jsxs("div",{className:"color-picker-modal__header",children:[o.jsxs("h4",{children:["Lane ",_.laneNumber," Surface Colour"]}),o.jsx("button",{onClick:()=>S(null),children:""})]}),o.jsxs("div",{className:"color-picker-grid",children:[o.jsx("button",{className:"color-picker-swatch color-picker-swatch--default",onClick:()=>{l(e,_.laneNumber,null),S(null)},title:"Use track default colour",style:{backgroundColor:(h==null?void 0:h.hex)||"#A5362F"},children:o.jsx("span",{className:"color-picker-swatch__code",children:"Default"})}),fn.map(ie=>o.jsx("button",{className:"color-picker-swatch",style:{backgroundColor:ie.hex},onClick:()=>{l(e,_.laneNumber,{tpv_code:ie.code,hex:ie.hex,name:ie.name}),S(null)},title:`${ie.code} - ${ie.name}`,children:o.jsx("span",{className:"color-picker-swatch__code",children:ie.code})},ie.code))]})]})})]})}function K5({motif:t,motifId:e,onEditSourceDesign:n}){const{updateMotifPosition:r,updateMotifRotation:s,updateMotifScale:i,removeMotif:a,duplicateMotif:l,refreshMotif:c,setMotifViewMode:d}=lt(),{position:u,rotation:p,scale:h,sourceDesignName:f,sourceDesignId:m,originalWidth_mm:g,originalHeight_mm:v,sourceThumbnailUrl:x,viewMode:y,hasBothVersions:b}=t,[w,j]=L.useState(!1),[_,S]=L.useState(null),E=(V,J)=>{const I=parseFloat(J);isNaN(I)||r(e,{...u,[V]:I})},T=V=>{const J=parseFloat(V);isNaN(J)||s(e,J)},M=V=>{const J=parseFloat(V);isNaN(J)||J<=0||i(e,J)},Z=()=>{window.confirm("Delete this motif? This action cannot be undone.")&&a(e)},N=()=>{l(e)},G=()=>{if(n)n(m);else{if(!m){alert("Source design ID not found");return}window.open(`/studio/?design=${m}`,"_blank")}},C=async()=>{if(!w){j(!0),S(null);try{const V=await c(e);V.success||S(V.error||"Failed to refresh")}catch(V){S(V.message||"Failed to refresh")}finally{j(!1)}}},F=g*(h||1)/1e3,pe=v*(h||1)/1e3;return o.jsxs("div",{className:"properties-panel",children:[o.jsxs("div",{className:"properties-panel__header",children:[o.jsx("h3",{children:"Motif Properties"}),o.jsxs("div",{className:"properties-panel__court-info",children:[o.jsx("span",{className:"court-name",children:f||"Unnamed Motif"}),o.jsx("span",{className:"court-standard",children:"Playground Design"})]})]}),o.jsx("div",{className:"properties-panel__content",children:o.jsxs("div",{className:"properties-section",children:[x&&o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Preview"}),o.jsx("div",{style:{width:"100%",height:"80px",background:"#f3f4f6",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:o.jsx("img",{src:x,alt:f,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})})]}),ki.BLEND_MODE_ENABLED,o.jsx("div",{className:"properties-section__header",children:o.jsx("h4",{children:"Transform"})}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Position"}),o.jsxs("div",{className:"property-input-row",children:[o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"X"}),o.jsx("input",{type:"number",value:Math.round(u.x),onChange:V=>E("x",V.target.value),step:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"Y"}),o.jsx("input",{type:"number",value:Math.round(u.y),onChange:V=>E("y",V.target.value),step:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Rotation"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"0",max:"360",value:p||0,onChange:V=>T(V.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:Math.round(p||0),onChange:V=>T(V.target.value),min:"0",max:"360"}),o.jsx("span",{className:"property-unit",children:""})]})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsxs("label",{children:["Scale",o.jsx("span",{style:{fontSize:"0.7rem",color:"#64748b",marginLeft:"0.5rem"},children:"(aspect locked)"})]}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"0.1",max:"10",step:"0.1",value:Math.min(h||1,10),onChange:V=>M(V.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:(h||1).toFixed(2),onChange:V=>M(V.target.value),min:"0.1",step:"0.1"}),o.jsx("span",{className:"property-unit",children:""})]})]})]}),o.jsxs("div",{className:"property-group property-group--info",children:[o.jsx("label",{children:"Current Size"}),o.jsx("div",{className:"property-info",children:o.jsxs("span",{children:[F.toFixed(2),"m  ",pe.toFixed(2),"m"]})})]}),o.jsxs("div",{className:"property-group property-group--info",children:[o.jsx("label",{children:"Original Size"}),o.jsx("div",{className:"property-info",children:o.jsxs("span",{children:[(g/1e3).toFixed(2),"m  ",(v/1e3).toFixed(2),"m"]})})]}),o.jsx("div",{className:"properties-section__divider",style:{margin:"1rem 0"},children:o.jsx("span",{children:"Source Design"})}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-primary",onClick:G,title:"Edit the source playground design in a new tab",style:{width:"100%",padding:"0.5rem",background:"var(--color-primary, #1e4a7a)",color:"white",border:"none",borderRadius:"6px",fontSize:"0.875rem",fontFamily:"inherit",cursor:"pointer",marginBottom:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:" Edit Source Design"})}),o.jsxs("div",{className:"property-group property-group--actions",children:[o.jsx("button",{className:"btn-secondary",onClick:C,disabled:w,title:"Refresh this motif with the latest version from the source design",style:{width:"100%",padding:"0.5rem",background:w?"#e5e7eb":"#f3f4f6",border:"1px solid #e4e9f0",borderRadius:"6px",fontSize:"0.875rem",fontFamily:"inherit",cursor:w?"not-allowed":"pointer",marginBottom:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:w?" Refreshing...":" Refresh from Source"}),_&&o.jsx("div",{style:{fontSize:"0.75rem",color:"#dc2626",marginTop:"0.25rem"},children:_}),o.jsx("div",{style:{fontSize:"0.7rem",color:"#64748b",marginTop:"0.25rem"},children:"Click after editing the source design to update this motif"})]}),o.jsx("div",{className:"properties-section__divider",style:{margin:"1rem 0"},children:o.jsx("span",{children:"Actions"})}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-secondary",onClick:N,title:"Duplicate motif (Ctrl+D)",style:{width:"100%",padding:"0.5rem",background:"#f3f4f6",border:"1px solid #e4e9f0",borderRadius:"6px",fontSize:"0.875rem",fontFamily:"inherit",cursor:"pointer",marginBottom:"0.5rem"},children:" Duplicate Motif"})}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-delete",onClick:Z,title:"Delete motif (Delete key)",children:" Delete Motif"})}),o.jsx("div",{className:"property-group",children:o.jsx("div",{className:"property-hint",style:{fontStyle:"normal",color:"#64748b",fontSize:"0.75rem",marginTop:"1rem"},children:' Tip: Drag the motif on the canvas to reposition. Edit the source design and click "Refresh" to update.'})})]})})]})}function Z5({shape:t,shapeId:e}){var Fe;const{updateShapePosition:n,updateShapeDimensions:r,updateShapeSides:s,updateShapeCornerRadius:i,setShapeStarMode:a,setShapeInnerRadius:l,updateShapeRotation:c,setShapeFillColor:d,setShapeStroke:u,setShapeAspectLock:p,removeShape:h,duplicateShape:f,randomizeBlob:m,setBlobStyle:g,setEditPointsVisible:v,setPathClosed:x,setPathSmooth:y}=lt(),[b,w]=L.useState(!1),[j,_]=L.useState(!1),[S,E]=L.useState(""),[T,M]=L.useState(""),[Z,N]=L.useState(!1),[G,C]=L.useState(!1),{shapeType:F,sides:pe,width_mm:V,height_mm:J,cornerRadius:I,starMode:K,innerRadius:z,position:W,rotation:fe,fillColor:ue,strokeEnabled:ne,strokeColor:ke,strokeWidth_mm:ce,aspectLocked:$e,blobStyle:ze,editPointsVisible:Ue,closed:Ge,smooth:at,controlPoints:Ve}=t,k=F==="blob",Q=F==="path",oe=(de,te)=>{const me=parseFloat(te);isNaN(me)||n(e,{...W,[de]:me})},D=de=>{const te=parseFloat(de);if(isNaN(te)||te<100)return!1;if($e){const me=J/V;r(e,te,te*me)}else r(e,te,J);return!0},P=de=>{const te=parseFloat(de);if(isNaN(te)||te<100)return!1;if($e){const me=V/J;r(e,te*me,te)}else r(e,V,te);return!0},$=()=>{N(!0),E(V.toFixed(0))},Y=()=>{N(!1),D(S)},se=de=>{de.key==="Enter"?de.target.blur():de.key==="Escape"&&(N(!1),E(V.toFixed(0)))},B=()=>{C(!0),M(J.toFixed(0))},re=()=>{C(!1),P(T)},ye=de=>{de.key==="Enter"?de.target.blur():de.key==="Escape"&&(C(!1),M(J.toFixed(0)))},le=de=>{const te=parseInt(de);isNaN(te)||te<3||s(e,te)},U=de=>{const te=parseFloat(de);isNaN(te)||te<0||te>100||i(e,te)},ae=de=>{const te=parseFloat(de);isNaN(te)||c(e,te)},xe=de=>{d(e,{tpv_code:de.code,hex:de.hex,name:de.name}),w(!1)},Te=de=>{u(e,!0,{tpv_code:de.code,hex:de.hex,name:de.name},ce),_(!1)},He=de=>{de&&!ke?u(e,!0,{tpv_code:"RH31",hex:"#E8E3D8",name:"Cream"},ce):u(e,de,ke,ce)},Ee=de=>{const te=parseFloat(de);isNaN(te)||te<10||u(e,ne,ke,te)},ie=()=>{p(e,!$e)},he=()=>{window.confirm("Delete this shape? This action cannot be undone.")&&h(e)},Xe=()=>{f(e)},tt=[{sides:3,name:"Triangle",icon:""},{sides:4,name:"Rectangle",icon:""},{sides:5,name:"Pentagon",icon:""},{sides:6,name:"Hexagon",icon:""},{sides:8,name:"Octagon",icon:""},{sides:32,name:"Circle",icon:""},{sides:5,name:"Star",icon:"",starMode:!0}],nt=de=>{de.starMode?(a(e,!0),pe!==de.sides&&le(de.sides)):(K&&a(e,!1),le(de.sides))},yt=de=>{const te=parseFloat(de)/100;l(e,te)},ht=de=>de.starMode?K&&pe===de.sides:!K&&pe===de.sides;return o.jsxs("div",{className:"properties-panel",children:[o.jsxs("div",{className:"properties-panel__header",children:[o.jsx("h3",{children:k?"Blob Shape":Q?"Pen Path":"Shape Properties"}),o.jsxs("div",{className:"properties-panel__court-info",children:[o.jsx("span",{className:"court-name",children:k?((Fe=xd[ze||"organic"])==null?void 0:Fe.name)||"Organic":Q?Ge?"Closed Path":"Open Path":g5(pe,K)}),o.jsx("span",{className:"court-standard",children:k?" Blob":Q?` ${(Ve==null?void 0:Ve.length)||0} points`:`${y5(pe,K)} ${pe} ${K?"points":"sides"}`})]})]}),o.jsx("div",{className:"properties-panel__content",children:o.jsxs("div",{className:"properties-section",children:[k?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Style"}),o.jsx("select",{value:ze||"organic",onChange:de=>g(e,de.target.value),style:{width:"100%",padding:"0.5rem 0.75rem",border:"1px solid #e4e9f0",borderRadius:"6px",fontSize:"0.875rem",cursor:"pointer",background:"#fff"},children:Object.entries(xd).map(([de,te])=>o.jsxs("option",{value:de,children:[te.name," - ",te.description]},de))})]}),o.jsxs("div",{className:"property-group",children:[o.jsxs("button",{onClick:()=>m(e),style:{width:"100%",padding:"0.75rem 1rem",background:"#3b82f6",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[o.jsx("span",{style:{fontSize:"1.1rem"},children:""})," New Shape"]}),o.jsx("div",{style:{fontSize:"0.7rem",color:"#64748b",marginTop:"0.5rem",textAlign:"center"},children:"Generate a new random shape in the selected style"})]}),o.jsxs("div",{className:"property-group",children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer",padding:"0.5rem",border:"1px solid #e4e9f0",borderRadius:"6px",background:Ue?"#eff6ff":"#fff"},children:[o.jsx("input",{type:"checkbox",checked:Ue||!1,onChange:de=>v(e,de.target.checked),style:{width:"16px",height:"16px",cursor:"pointer"}}),o.jsx("span",{style:{fontSize:"0.875rem"},children:"Edit Points"})]}),Ue&&o.jsx("div",{style:{fontSize:"0.7rem",color:"#64748b",marginTop:"0.5rem"},children:"Drag points and handles on canvas for precise control"})]})]}):Q?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"property-group",children:[o.jsx("label",{style:{marginBottom:"0.5rem",display:"block"},children:"Path Options"}),o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer",padding:"0.5rem",border:"1px solid #e4e9f0",borderRadius:"6px",background:Ge?"#eff6ff":"#fff",marginBottom:"0.5rem"},children:[o.jsx("input",{type:"checkbox",checked:Ge||!1,onChange:de=>x(e,de.target.checked),style:{width:"16px",height:"16px",cursor:"pointer"}}),o.jsx("span",{style:{fontSize:"0.875rem"},children:"Closed Path"})]}),o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer",padding:"0.5rem",border:"1px solid #e4e9f0",borderRadius:"6px",background:at?"#eff6ff":"#fff"},children:[o.jsx("input",{type:"checkbox",checked:at||!1,onChange:de=>y(e,de.target.checked),style:{width:"16px",height:"16px",cursor:"pointer"}}),o.jsx("span",{style:{fontSize:"0.875rem"},children:"Smooth Curves"})]}),at&&o.jsx("div",{style:{fontSize:"0.7rem",color:"#64748b",marginTop:"0.5rem"},children:"Uses bezier curves for smooth transitions"})]}),o.jsxs("div",{className:"property-group",children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer",padding:"0.5rem",border:"1px solid #e4e9f0",borderRadius:"6px",background:Ue?"#eff6ff":"#fff"},children:[o.jsx("input",{type:"checkbox",checked:Ue||!1,onChange:de=>v(e,de.target.checked),style:{width:"16px",height:"16px",cursor:"pointer"}}),o.jsx("span",{style:{fontSize:"0.875rem"},children:"Edit Points"})]}),Ue&&o.jsxs("div",{style:{fontSize:"0.7rem",color:"#64748b",marginTop:"0.5rem"},children:["Drag points to reshape. ",at?"Drag handles for curve control.":"Enable smooth curves for bezier handles."]})]}),o.jsx("div",{className:"property-group",style:{background:"#f8fafc",padding:"0.75rem",borderRadius:"6px"},children:o.jsxs("div",{style:{fontSize:"0.8125rem",color:"#475569"},children:[o.jsx("strong",{children:(Ve==null?void 0:Ve.length)||0})," control points"]})})]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Shape Type"}),o.jsx("div",{className:"shape-presets",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"0.5rem",marginTop:"0.5rem"},children:tt.map(de=>{const te=ht(de);return o.jsxs("button",{onClick:()=>nt(de),title:de.name,style:{padding:"0.5rem",border:te?"2px solid #3b82f6":"1px solid #e4e9f0",borderRadius:"6px",background:te?"#eff6ff":"#fff",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",fontSize:"1.25rem"},children:[o.jsx("span",{children:de.icon}),o.jsx("span",{style:{fontSize:"0.65rem",color:"#64748b"},children:de.name})]},`${de.name}-${de.sides}`)})})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:K?"Number of Points":"Number of Sides"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"3",max:K?12:32,value:pe,onChange:de=>le(de.target.value),className:"property-slider"}),o.jsx("div",{className:"property-input-group property-input-group--compact",children:o.jsx("input",{type:"number",value:pe,onChange:de=>le(de.target.value),min:"3",max:K?12:32})})]})]}),K&&o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Star Depth"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"10",max:"90",value:Math.round((z||.5)*100),onChange:de=>yt(de.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:Math.round((z||.5)*100),onChange:de=>yt(de.target.value),min:"10",max:"90"}),o.jsx("span",{className:"property-unit",children:"%"})]})]}),o.jsx("div",{style:{fontSize:"0.7rem",color:"#64748b",marginTop:"0.25rem"},children:"Lower values = deeper points, higher = shallower"})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Corner Smoothing"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"0",max:"100",value:I,onChange:de=>U(de.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:I,onChange:de=>U(de.target.value),min:"0",max:"100"}),o.jsx("span",{className:"property-unit",children:"%"})]})]})]})]}),o.jsx("div",{className:"properties-section__divider",style:{margin:"1rem 0"},children:o.jsx("span",{children:"Dimensions"})}),o.jsxs("div",{className:"property-group",children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[o.jsx("label",{style:{margin:0},children:"Size"}),o.jsx("button",{onClick:ie,style:{padding:"0.25rem 0.5rem",fontSize:"0.75rem",background:$e?"#3b82f6":"#6b7280",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},title:$e?"Aspect ratio locked":"Aspect ratio unlocked",children:$e?" Locked":" Free"})]}),o.jsxs("div",{className:"property-input-row",children:[o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"W"}),o.jsx("input",{type:"number",value:Z?S:V.toFixed(0),onChange:de=>E(de.target.value),onFocus:$,onBlur:Y,onKeyDown:se,step:"100",min:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"H"}),o.jsx("input",{type:"number",value:G?T:J.toFixed(0),onChange:de=>M(de.target.value),onFocus:B,onBlur:re,onKeyDown:ye,step:"100",min:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]})]}),o.jsxs("div",{style:{fontSize:"0.7rem",color:"#64748b",marginTop:"0.25rem"},children:[(V/1e3).toFixed(2),"m  ",(J/1e3).toFixed(2),"m"]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Position"}),o.jsxs("div",{className:"property-input-row",children:[o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"X"}),o.jsx("input",{type:"number",value:Math.round(W.x),onChange:de=>oe("x",de.target.value),step:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"Y"}),o.jsx("input",{type:"number",value:Math.round(W.y),onChange:de=>oe("y",de.target.value),step:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Rotation"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"0",max:"360",value:fe||0,onChange:de=>ae(de.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:Math.round(fe||0),onChange:de=>ae(de.target.value),min:"0",max:"360"}),o.jsx("span",{className:"property-unit",children:""})]})]})]}),o.jsx("div",{className:"properties-section__divider",style:{margin:"1rem 0"},children:o.jsx("span",{children:"Appearance"})}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Fill Colour"}),o.jsxs("div",{className:"color-item",children:[o.jsxs("div",{className:"color-item__info",children:[o.jsx("span",{className:"color-item__name",children:(ue==null?void 0:ue.name)||"Select Colour"}),ue&&o.jsx("span",{className:"color-item__code",children:ue.tpv_code})]}),o.jsx("button",{className:"color-item__swatch",style:{backgroundColor:(ue==null?void 0:ue.hex)||"#609B63"},onClick:()=>w(!0),title:(ue==null?void 0:ue.name)||"Select colour"})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[o.jsx("input",{type:"checkbox",checked:ne||!1,onChange:de=>He(de.target.checked)}),"Border"]}),ne&&o.jsxs("div",{style:{marginTop:"0.5rem"},children:[o.jsxs("div",{className:"color-item",style:{marginBottom:"0.5rem"},children:[o.jsxs("div",{className:"color-item__info",children:[o.jsx("span",{className:"color-item__name",children:(ke==null?void 0:ke.name)||"Select Colour"}),ke&&o.jsx("span",{className:"color-item__code",children:ke.tpv_code})]}),o.jsx("button",{className:"color-item__swatch",style:{backgroundColor:(ke==null?void 0:ke.hex)||"#FFFFFF"},onClick:()=>_(!0),title:(ke==null?void 0:ke.name)||"Select colour"})]}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",style:{fontSize:"0.8rem"},children:"Width"}),o.jsx("input",{type:"number",value:ce,onChange:de=>Ee(de.target.value),step:"10",min:"10"}),o.jsx("span",{className:"property-unit",children:"mm"})]})]})]}),o.jsx("div",{className:"properties-section__divider",style:{margin:"1rem 0"},children:o.jsx("span",{children:"Actions"})}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-secondary",onClick:Xe,title:"Duplicate shape (Ctrl+D)",style:{width:"100%",padding:"0.5rem",background:"#f3f4f6",border:"1px solid #e4e9f0",borderRadius:"6px",fontSize:"0.875rem",fontFamily:"inherit",cursor:"pointer",marginBottom:"0.5rem"},children:" Duplicate Shape"})}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-delete",onClick:he,title:"Delete shape (Delete key)",children:" Delete Shape"})}),o.jsx("div",{className:"property-group",children:o.jsx("div",{className:"property-hint",style:{fontStyle:"normal",color:"#64748b",fontSize:"0.75rem",marginTop:"1rem"},children:" Tip: Drag corners to resize, drag the rotation handle above the shape to rotate. Hold Shift to snap rotation to 15 increments."})})]})}),b&&o.jsx("div",{className:"color-picker-modal",onClick:()=>w(!1),children:o.jsxs("div",{className:"color-picker-modal__content",onClick:de=>de.stopPropagation(),children:[o.jsxs("div",{className:"color-picker-modal__header",children:[o.jsx("h4",{children:"Select Fill Colour"}),o.jsx("button",{onClick:()=>w(!1),children:""})]}),o.jsx("div",{className:"color-picker-grid",children:fn.map(de=>o.jsx("button",{className:"color-picker-swatch",style:{backgroundColor:de.hex},onClick:()=>xe(de),title:`${de.code} - ${de.name}`,children:o.jsx("span",{className:"color-picker-swatch__code",children:de.code})},de.code))})]})}),j&&o.jsx("div",{className:"color-picker-modal",onClick:()=>_(!1),children:o.jsxs("div",{className:"color-picker-modal__content",onClick:de=>de.stopPropagation(),children:[o.jsxs("div",{className:"color-picker-modal__header",children:[o.jsx("h4",{children:"Select Border Colour"}),o.jsx("button",{onClick:()=>_(!1),children:""})]}),o.jsx("div",{className:"color-picker-grid",children:fn.map(de=>o.jsx("button",{className:"color-picker-swatch",style:{backgroundColor:de.hex},onClick:()=>Te(de),title:`${de.code} - ${de.name}`,children:o.jsx("span",{className:"color-picker-swatch__code",children:de.code})},de.code))})]})})]})}function J5({text:t,textId:e}){const{updateTextContent:n,updateTextPosition:r,updateTextFontSize:s,updateTextFont:i,updateTextAlign:a,updateTextRotation:l,setTextFillColor:c,setTextStrokeColor:d,updateTextStrokeWidth:u,removeText:p,duplicateText:h}=lt(),[f,m]=L.useState(!1),[g,v]=L.useState(!1),{content:x,fontFamily:y,fontSize_mm:b,fontWeight:w,fontStyle:j,textAlign:_,position:S,rotation:E,fillColor:T,strokeColor:M,strokeWidth_mm:Z}=t,N=w5(),G=ce=>{n(e,ce)},C=(ce,$e)=>{const ze=parseFloat($e);isNaN(ze)||r(e,{...S,[ce]:ze})},F=ce=>{const $e=parseFloat(ce);isNaN($e)||$e<50||s(e,$e)},pe=ce=>{i(e,ce,w,j)},V=()=>{i(e,y,w==="bold"?"normal":"bold",j)},J=()=>{i(e,y,w,j==="italic"?"normal":"italic")},I=ce=>{a(e,ce)},K=ce=>{const $e=parseFloat(ce);isNaN($e)||l(e,$e)},z=ce=>{c(e,{tpv_code:ce.code,hex:ce.hex,name:ce.name}),m(!1)},W=ce=>{d(e,{tpv_code:ce.code,hex:ce.hex,name:ce.name}),(!Z||Z===0)&&u(e,Math.round(b*.05)),v(!1)},fe=ce=>{const $e=parseFloat(ce);isNaN($e)||$e<0||u(e,$e)},ue=()=>{d(e,null),u(e,0)},ne=()=>{window.confirm("Delete this text? This action cannot be undone.")&&p(e)},ke=()=>{h(e)};return o.jsxs("div",{className:"properties-panel",children:[o.jsxs("div",{className:"properties-panel__header",children:[o.jsx("h3",{children:"Text Properties"}),o.jsxs("div",{className:"properties-panel__court-info",children:[o.jsx("span",{className:"court-name",style:{fontFamily:y},children:x||"Text Label"}),o.jsx("span",{className:"court-standard",children:"T Text Element"})]})]}),o.jsx("div",{className:"properties-panel__content",children:o.jsxs("div",{className:"properties-section",children:[o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Text Content"}),o.jsx("input",{type:"text",value:x,onChange:ce=>G(ce.target.value),placeholder:"Enter text...",style:{width:"100%",padding:"0.5rem",border:"1px solid #e4e9f0",borderRadius:"6px",fontFamily:y,fontSize:"1rem"}})]}),o.jsx("div",{className:"properties-section__divider",style:{margin:"1rem 0"},children:o.jsx("span",{children:"Typography"})}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Font Family"}),o.jsx("select",{value:y,onChange:ce=>pe(ce.target.value),style:{width:"100%",padding:"0.5rem",border:"1px solid #e4e9f0",borderRadius:"6px",fontFamily:"inherit",fontSize:"0.875rem"},children:N.map(ce=>o.jsx("option",{value:ce.family,style:{fontFamily:ce.family},children:ce.name},ce.name))})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Font Size"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"100",max:"2000",step:"50",value:b,onChange:ce=>F(ce.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:b.toFixed(0),onChange:ce=>F(ce.target.value),min:"50",step:"50"}),o.jsx("span",{className:"property-unit",children:"mm"})]})]}),o.jsxs("div",{style:{fontSize:"0.7rem",color:"#64748b",marginTop:"0.25rem"},children:[" ",(b/1e3).toFixed(2),"m height"]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Style"}),o.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[o.jsx("button",{onClick:V,style:{flex:1,padding:"0.5rem",border:w==="bold"?"2px solid #3b82f6":"1px solid #e4e9f0",borderRadius:"6px",background:w==="bold"?"#eff6ff":"#fff",fontWeight:"bold",fontSize:"1rem",cursor:"pointer"},title:"Bold",children:"B"}),o.jsx("button",{onClick:J,style:{flex:1,padding:"0.5rem",border:j==="italic"?"2px solid #3b82f6":"1px solid #e4e9f0",borderRadius:"6px",background:j==="italic"?"#eff6ff":"#fff",fontStyle:"italic",fontSize:"1rem",cursor:"pointer"},title:"Italic",children:"I"})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Alignment"}),o.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[o.jsx("button",{onClick:()=>I("left"),style:{flex:1,padding:"0.5rem",border:_==="left"?"2px solid #3b82f6":"1px solid #e4e9f0",borderRadius:"6px",background:_==="left"?"#eff6ff":"#fff",cursor:"pointer"},title:"Align Left",children:""}),o.jsx("button",{onClick:()=>I("center"),style:{flex:1,padding:"0.5rem",border:_==="center"?"2px solid #3b82f6":"1px solid #e4e9f0",borderRadius:"6px",background:_==="center"?"#eff6ff":"#fff",cursor:"pointer"},title:"Align Center",children:""}),o.jsx("button",{onClick:()=>I("right"),style:{flex:1,padding:"0.5rem",border:_==="right"?"2px solid #3b82f6":"1px solid #e4e9f0",borderRadius:"6px",background:_==="right"?"#eff6ff":"#fff",cursor:"pointer"},title:"Align Right",children:""})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Text Colour"}),o.jsxs("div",{className:"color-item",children:[o.jsxs("div",{className:"color-item__info",children:[o.jsx("span",{className:"color-item__name",children:(T==null?void 0:T.name)||"Select Colour"}),T&&o.jsx("span",{className:"color-item__code",children:T.tpv_code})]}),o.jsx("button",{className:"color-item__swatch",style:{backgroundColor:(T==null?void 0:T.hex)||"#1C1C1C"},onClick:()=>m(!0),title:(T==null?void 0:T.name)||"Select colour"})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Outline"}),M?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"color-item",children:[o.jsxs("div",{className:"color-item__info",children:[o.jsx("span",{className:"color-item__name",children:M.name}),o.jsx("span",{className:"color-item__code",children:M.tpv_code})]}),o.jsx("button",{className:"color-item__swatch",style:{backgroundColor:M.hex},onClick:()=>v(!0),title:M.name})]}),o.jsxs("div",{className:"property-input-row",style:{marginTop:"0.5rem"},children:[o.jsx("input",{type:"range",min:"1",max:Math.round(b*.2),step:"1",value:Z||0,onChange:ce=>fe(ce.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:Math.round(Z||0),onChange:ce=>fe(ce.target.value),min:"0",step:"1"}),o.jsx("span",{className:"property-unit",children:"mm"})]})]}),o.jsx("button",{onClick:ue,style:{marginTop:"0.5rem",padding:"0.25rem 0.5rem",fontSize:"0.75rem",background:"#fee2e2",border:"1px solid #fecaca",borderRadius:"4px",color:"#dc2626",cursor:"pointer"},children:"Remove Outline"})]}):o.jsx("button",{onClick:()=>v(!0),style:{width:"100%",padding:"0.5rem",background:"#f3f4f6",border:"1px dashed #d1d5db",borderRadius:"6px",fontSize:"0.875rem",color:"#6b7280",cursor:"pointer"},children:"+ Add Outline"})]}),o.jsx("div",{className:"properties-section__divider",style:{margin:"1rem 0"},children:o.jsx("span",{children:"Transform"})}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Position"}),o.jsxs("div",{className:"property-input-row",children:[o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"X"}),o.jsx("input",{type:"number",value:Math.round(S.x),onChange:ce=>C("x",ce.target.value),step:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"Y"}),o.jsx("input",{type:"number",value:Math.round(S.y),onChange:ce=>C("y",ce.target.value),step:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Rotation"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"0",max:"360",value:E||0,onChange:ce=>K(ce.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:Math.round(E||0),onChange:ce=>K(ce.target.value),min:"0",max:"360"}),o.jsx("span",{className:"property-unit",children:""})]})]})]}),o.jsx("div",{className:"properties-section__divider",style:{margin:"1rem 0"},children:o.jsx("span",{children:"Actions"})}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-secondary",onClick:ke,title:"Duplicate text (Ctrl+D)",style:{width:"100%",padding:"0.5rem",background:"#f3f4f6",border:"1px solid #e4e9f0",borderRadius:"6px",fontSize:"0.875rem",fontFamily:"inherit",cursor:"pointer",marginBottom:"0.5rem"},children:" Duplicate Text"})}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-delete",onClick:ne,title:"Delete text (Delete key)",children:" Delete Text"})}),o.jsx("div",{className:"property-group",children:o.jsx("div",{className:"property-hint",style:{fontStyle:"normal",color:"#64748b",fontSize:"0.75rem",marginTop:"1rem"},children:" Tip: Double-click text on canvas to edit inline. Drag corners to change font size. Hold Shift while rotating to snap to 15 increments."})})]})}),f&&o.jsx("div",{className:"color-picker-modal",onClick:()=>m(!1),children:o.jsxs("div",{className:"color-picker-modal__content",onClick:ce=>ce.stopPropagation(),children:[o.jsxs("div",{className:"color-picker-modal__header",children:[o.jsx("h4",{children:"Select Text Colour"}),o.jsx("button",{onClick:()=>m(!1),children:""})]}),o.jsx("div",{className:"color-picker-grid",children:fn.map(ce=>o.jsx("button",{className:"color-picker-swatch",style:{backgroundColor:ce.hex},onClick:()=>z(ce),title:`${ce.code} - ${ce.name}`,children:o.jsx("span",{className:"color-picker-swatch__code",children:ce.code})},ce.code))})]})}),g&&o.jsx("div",{className:"color-picker-modal",onClick:()=>v(!1),children:o.jsxs("div",{className:"color-picker-modal__content",onClick:ce=>ce.stopPropagation(),children:[o.jsxs("div",{className:"color-picker-modal__header",children:[o.jsx("h4",{children:"Select Outline Colour"}),o.jsx("button",{onClick:()=>v(!1),children:""})]}),o.jsx("div",{className:"color-picker-grid",children:fn.map(ce=>o.jsx("button",{className:"color-picker-swatch",style:{backgroundColor:ce.hex},onClick:()=>W(ce),title:`${ce.code} - ${ce.name}`,children:o.jsx("span",{className:"color-picker-swatch__code",children:ce.code})},ce.code))})]})})]})}function Q5({zone:t,zoneId:e}){const{updateExclusionZonePosition:n,updateExclusionZoneDimensions:r,updateExclusionZoneRotation:s,updateExclusionZoneCornerRadius:i,removeExclusionZone:a,duplicateExclusionZone:l,addToHistory:c}=lt(),{position:d,rotation:u,width_mm:p,height_mm:h,sides:f,cornerRadius:m,customName:g}=t,v=(T,M)=>{const Z=parseFloat(M);isNaN(Z)||n(e,{...d,[T]:Z})},x=(T,M)=>{const Z=parseFloat(M);isNaN(Z)||Z<500||(T==="width"?r(e,Z,h):r(e,p,Z),c())},y=T=>{const M=parseFloat(T);isNaN(M)||(s(e,M),c())},b=T=>{const M=parseFloat(T);isNaN(M)||i(e,M)},w=()=>{window.confirm("Delete this exclusion zone? This action cannot be undone.")&&a(e)},j=()=>{l(e)},_=p*h/1e6,S=g||"Exclusion Zone",E=f===4?"Rectangle":f>=32?"Circle":`${f}-sided`;return o.jsxs("div",{className:"properties-panel",children:[o.jsxs("div",{className:"properties-panel__header",children:[o.jsx("h3",{children:"Exclusion Zone"}),o.jsxs("div",{className:"properties-panel__court-info",children:[o.jsx("span",{className:"court-name",children:S}),o.jsx("span",{className:"court-standard",style:{background:"#f87171",color:"white"},children:"Excluded Area"})]})]}),o.jsx("div",{className:"properties-panel__content",children:o.jsxs("div",{className:"properties-section",children:[o.jsx("div",{className:"property-group",style:{background:"#fef2f2",padding:"0.75rem",borderRadius:"6px",marginBottom:"1rem",border:"1px solid #fecaca"},children:o.jsx("p",{style:{fontSize:"0.75rem",color:"#991b1b",margin:0},children:"This area represents a building, planter, or other obstacle. It is excluded from material calculations."})}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Dimensions"}),o.jsxs("div",{className:"property-input-row",children:[o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"W"}),o.jsx("input",{type:"number",value:Math.round(p),onChange:T=>x("width",T.target.value),step:"100",min:"500"}),o.jsx("span",{className:"property-unit",children:"mm"})]}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"H"}),o.jsx("input",{type:"number",value:Math.round(h),onChange:T=>x("height",T.target.value),step:"100",min:"500"}),o.jsx("span",{className:"property-unit",children:"mm"})]})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Position"}),o.jsxs("div",{className:"property-input-row",children:[o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"X"}),o.jsx("input",{type:"number",value:Math.round(d.x),onChange:T=>v("x",T.target.value),step:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"Y"}),o.jsx("input",{type:"number",value:Math.round(d.y),onChange:T=>v("y",T.target.value),step:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Rotation"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"0",max:"360",value:u||0,onChange:T=>y(T.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:Math.round(u||0),onChange:T=>y(T.target.value),min:"0",max:"360"}),o.jsx("span",{className:"property-unit",children:""})]})]})]}),f===4&&o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Corner Radius"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"0",max:"100",value:m||0,onChange:T=>b(T.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:Math.round(m||0),onChange:T=>b(T.target.value),min:"0",max:"100"}),o.jsx("span",{className:"property-unit",children:"%"})]})]})]}),o.jsx("div",{className:"properties-section__divider",style:{margin:"1rem 0"},children:o.jsx("span",{children:"Exclusion Info"})}),o.jsxs("div",{className:"property-group property-group--info",children:[o.jsx("label",{children:"Shape"}),o.jsx("div",{className:"property-info",children:o.jsx("span",{children:E})})]}),o.jsxs("div",{className:"property-group property-group--info",children:[o.jsx("label",{children:"Excluded Area"}),o.jsx("div",{className:"property-info",style:{color:"#dc2626"},children:o.jsxs("span",{children:[_.toFixed(2)," m"]})})]}),o.jsx("div",{className:"properties-section__divider",style:{margin:"1rem 0"},children:o.jsx("span",{children:"Actions"})}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-secondary",onClick:j,title:"Duplicate exclusion zone",style:{width:"100%",padding:"0.5rem",background:"#f3f4f6",border:"1px solid #e4e9f0",borderRadius:"6px",fontSize:"0.875rem",fontFamily:"inherit",cursor:"pointer",marginBottom:"0.5rem"},children:"Duplicate Zone"})}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-delete",onClick:w,title:"Delete exclusion zone",children:"Delete Zone"})}),o.jsx("div",{className:"property-group",children:o.jsx("div",{className:"property-hint",style:{fontStyle:"normal",color:"#64748b",fontSize:"0.75rem",marginTop:"1rem"},children:"Drag the zone on the canvas to reposition. Use handles to resize."})})]})})]})}function eT({group:t,groupId:e,shapes:n,isEditing:r,onEnterGroup:s,onExitGroup:i,onUngroup:a,onDelete:l}){const c=t.customName||"Group",d=t.childIds.map(p=>n[p]).filter(Boolean),u=t.bounds||{width:0,height:0};return o.jsx("div",{className:"properties-panel properties-panel--group",children:o.jsxs("div",{className:"properties-panel__scroll-container",children:[o.jsxs("div",{className:"properties-panel__header",children:[o.jsxs("div",{className:"properties-panel__title-row",children:[o.jsx("span",{className:"properties-panel__icon",style:{color:"#9333ea"},children:""}),o.jsx("h3",{className:"properties-panel__title",children:c})]}),o.jsxs("span",{className:"properties-panel__subtitle",children:[t.childIds.length," element",t.childIds.length!==1?"s":""]})]}),o.jsxs("div",{className:"properties-panel__content",children:[o.jsxs("div",{className:"property-section",children:[o.jsx("div",{className:"property-group",style:{marginBottom:"1rem"},children:r?o.jsx("button",{className:"property-btn property-btn--secondary property-btn--full",onClick:i,style:{borderColor:"#9333ea",color:"#9333ea"},children:" Exit Group Editing"}):o.jsx("button",{className:"property-btn property-btn--primary property-btn--full",onClick:s,style:{background:"#9333ea"},children:"Edit Group Elements"})}),r&&o.jsx("div",{className:"property-hint",style:{fontSize:"0.75rem",color:"#9333ea",marginBottom:"1rem"},children:"Click on individual elements to select and edit them"})]}),o.jsxs("div",{className:"property-section",children:[o.jsx("h4",{className:"property-section__title",children:"Dimensions"}),o.jsxs("div",{className:"property-group",children:[o.jsxs("div",{className:"property-row",children:[o.jsx("label",{className:"property-label",children:"Width"}),o.jsxs("span",{className:"property-value",children:[(u.width/1e3).toFixed(2),"m"]})]}),o.jsxs("div",{className:"property-row",children:[o.jsx("label",{className:"property-label",children:"Height"}),o.jsxs("span",{className:"property-value",children:[(u.height/1e3).toFixed(2),"m"]})]})]})]}),o.jsxs("div",{className:"property-section",children:[o.jsxs("h4",{className:"property-section__title",children:["Elements (",d.length,")"]}),o.jsx("div",{className:"property-group",children:o.jsx("div",{style:{maxHeight:"150px",overflowY:"auto",borderRadius:"6px",border:"1px solid #e5e7eb"},children:d.map((p,h)=>o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",borderBottom:h<d.length-1?"1px solid #f1f5f9":"none",fontSize:"0.8rem"},children:[o.jsx("span",{style:{color:"#9333ea"},children:p.shapeType==="blob"?"":""}),o.jsx("span",{style:{color:"#475569"},children:p.customName||`${p.blobStyle||p.shapeType} ${h+1}`}),o.jsxs("span",{style:{marginLeft:"auto",fontSize:"0.7rem",color:"#9ca3af"},children:[(p.width_mm/1e3).toFixed(1),"m"]})]},p.id))})})]}),o.jsxs("div",{className:"property-section",children:[o.jsx("h4",{className:"property-section__title",children:"Actions"}),o.jsxs("div",{className:"property-group",style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[o.jsx("button",{className:"property-btn property-btn--secondary property-btn--full",onClick:a,title:"Dissolve the group and make elements independent",children:" Ungroup Elements"}),o.jsx("button",{className:"property-btn property-btn--danger property-btn--full",onClick:()=>{confirm(`Delete "${c}" and all its elements?`)&&l()},title:"Delete group and all its elements",children:" Delete Group"})]})]}),o.jsx("div",{className:"property-group",children:o.jsxs("div",{className:"property-hint",style:{fontStyle:"normal",color:"#64748b",fontSize:"0.75rem",marginTop:"1rem"},children:[o.jsx("strong",{children:"Tip:"})," Double-click a group to edit its contents. Press Escape to exit.",o.jsx("br",{}),o.jsx("strong",{children:"Shortcuts:"})," G to group, G to ungroup."]})})]})]})})}function tT(){const{courts:t,tracks:e,motifs:n,shapes:r,texts:s,exclusionZones:i,groups:a,elementOrder:l,selectedCourtId:c,selectedTrackId:d,selectedMotifId:u,selectedShapeId:p,selectedTextId:h,selectedExclusionZoneId:f,selectedGroupId:m,editingGroupId:g,setElementOrder:v,selectCourt:x,selectTrack:y,selectMotif:b,selectShape:w,selectText:j,selectExclusionZone:_,selectGroup:S,deselectGroup:E,enterGroup:T,exitGroup:M,ungroup:Z,deleteGroupWithChildren:N,bringToFront:G,sendToBack:C,duplicateCourt:F,duplicateTrack:pe,duplicateMotif:V,duplicateShape:J,duplicateText:I,removeCourt:K,removeTrack:z,removeMotif:W,removeShape:fe,removeText:ue,removeExclusionZone:ne,renameElement:ke,toggleElementLock:ce,toggleElementVisibility:$e,addToHistory:ze}=lt(),[Ue,Ge]=O.useState(null),[at,Ve]=O.useState(null),[k,Q]=O.useState(null),[oe,D]=O.useState(null),[P,$]=O.useState(""),[Y,se]=O.useState(new Set);O.useEffect(()=>{const te=()=>Q(null);if(k)return document.addEventListener("click",te),()=>document.removeEventListener("click",te)},[k]);const B=[...l].filter(te=>!te.startsWith("group-")).reverse(),re=te=>{var me,Ye,xt;if(te.startsWith("court-")){const Ce=t[te];return{type:"court",name:(Ce==null?void 0:Ce.customName)||((me=Ce==null?void 0:Ce.template)==null?void 0:me.name)||"Unknown Court",icon:"",sport:((Ye=Ce==null?void 0:Ce.template)==null?void 0:Ye.sport)||"",locked:(Ce==null?void 0:Ce.locked)||!1,visible:(Ce==null?void 0:Ce.visible)!==!1}}else if(te.startsWith("track-")){const Ce=e[te];return{type:"track",name:(Ce==null?void 0:Ce.customName)||((xt=Ce==null?void 0:Ce.template)==null?void 0:xt.name)||"Unknown Track",icon:"",sport:"athletics",locked:(Ce==null?void 0:Ce.locked)||!1,visible:(Ce==null?void 0:Ce.visible)!==!1}}else if(te.startsWith("motif-")){const Ce=n[te];return{type:"motif",name:(Ce==null?void 0:Ce.customName)||(Ce==null?void 0:Ce.sourceDesignName)||"Unknown Motif",icon:"",sport:"playground",locked:(Ce==null?void 0:Ce.locked)||!1,visible:(Ce==null?void 0:Ce.visible)!==!1}}else if(te.startsWith("shape-")){const Ce=r[te];let wt="Shape",pt="";if((Ce==null?void 0:Ce.shapeType)==="blob")wt={organic:"Organic Blob",splashy:"Splashy Blob",cloudy:"Cloudy Blob",rocky:"Rocky Blob"}[Ce.blobStyle]||"Blob",pt="";else if((Ce==null?void 0:Ce.shapeType)==="path")wt=Ce.closed?"Custom Shape":"Path",pt="";else if(Ce!=null&&Ce.starMode)wt=`${Ce.sides||5}-Point Star`,pt="";else if(Ce!=null&&Ce.sides){const Ct=Ce.sides;Ct>=32?(wt="Circle",pt=""):Ct===3?(wt="Triangle",pt=""):Ct===4?(wt="Rectangle",pt=""):Ct===5?(wt="Pentagon",pt=""):Ct===6?(wt="Hexagon",pt=""):Ct===8?(wt="Octagon",pt=""):(wt=`${Ct}-gon`,pt="")}return{type:"shape",name:(Ce==null?void 0:Ce.customName)||wt,icon:pt,sport:"shape",locked:(Ce==null?void 0:Ce.locked)||!1,visible:(Ce==null?void 0:Ce.visible)!==!1}}else if(te.startsWith("text-")){const Ce=s[te],wt=(Ce==null?void 0:Ce.content)||"Text Label",pt=wt.length>20?wt.substring(0,20)+"...":wt;return{type:"text",name:(Ce==null?void 0:Ce.customName)||pt,icon:"T",sport:"text",locked:(Ce==null?void 0:Ce.locked)||!1,visible:(Ce==null?void 0:Ce.visible)!==!1}}else if(te.startsWith("exclusion-")){const Ce=i[te];return{type:"exclusion",name:(Ce==null?void 0:Ce.customName)||"Exclusion Zone",icon:"",sport:"exclusion",locked:(Ce==null?void 0:Ce.locked)||!1,visible:(Ce==null?void 0:Ce.visible)!==!1}}return{type:"unknown",name:"Unknown",icon:"",sport:"",locked:!1,visible:!0}},ye=te=>te===c||te===d||te===u||te===p||te===h||te===f,le=te=>{te.startsWith("court-")?x(te):te.startsWith("track-")?y(te):te.startsWith("motif-")?b(te):te.startsWith("shape-")?w(te):te.startsWith("text-")?j(te):te.startsWith("exclusion-")&&_(te)},U=(te,me)=>{Ge(me),te.dataTransfer.effectAllowed="move",te.dataTransfer.setData("text/plain",me),setTimeout(()=>{te.target.classList.add("layer-item--dragging")},0)},ae=te=>{te.target.classList.remove("layer-item--dragging"),Ge(null),Ve(null)},xe=(te,me)=>{te.preventDefault(),te.dataTransfer.dropEffect="move",me!==Ue&&Ve(me)},Te=()=>{Ve(null)},He=(te,me)=>{if(te.preventDefault(),!Ue||Ue===me){Ge(null),Ve(null);return}const Ye=[...l],xt=Ye.indexOf(Ue),Ce=Ye.indexOf(me);if(xt===-1||Ce===-1)return;Ye.splice(xt,1);const wt=B.indexOf(Ue),pt=B.indexOf(me);wt<pt,Ye.splice(Ce,0,Ue),v(Ye),ze(),Ge(null),Ve(null)},Ee=(te,me)=>{te.stopPropagation(),G(me),Q(null)},ie=(te,me)=>{te.stopPropagation(),C(me),Q(null)},he=(te,me)=>{te.stopPropagation(),me.startsWith("court-")?F(me):me.startsWith("track-")?pe(me):me.startsWith("motif-")?V(me):me.startsWith("shape-")?J(me):me.startsWith("text-")&&I(me),Q(null)},Xe=(te,me)=>{te.stopPropagation();const Ye=re(me);confirm(`Delete "${Ye.name}"?`)&&(me.startsWith("court-")?K(me):me.startsWith("track-")?z(me):me.startsWith("motif-")?W(me):me.startsWith("shape-")?fe(me):me.startsWith("text-")?ue(me):me.startsWith("exclusion-")&&ne(me)),Q(null)},tt=(te,me)=>{te.stopPropagation();const Ye=re(me);D(me),$(Ye.name),Q(null)},nt=te=>{P.trim()&&ke(te,P.trim()),D(null),$("")},yt=(te,me)=>{te.key==="Enter"?nt(me):te.key==="Escape"&&(D(null),$(""))},ht=(te,me)=>{te.stopPropagation(),ce(me),Q(null)},Fe=(te,me)=>{te.stopPropagation(),$e(me),Q(null)},de=(te,me)=>{te.stopPropagation(),Q(k===me?null:me)};return B.length===0&&Object.keys(a).length===0?o.jsx("div",{className:"layers-panel layers-panel--empty",children:o.jsxs("div",{className:"layers-panel__empty-state",children:[o.jsx("span",{className:"layers-panel__empty-icon",children:""}),o.jsx("p",{children:"No elements yet"}),o.jsx("span",{className:"layers-panel__empty-hint",children:"Add courts, tracks, motifs, shapes, or text"})]})}):o.jsxs("div",{className:"layers-panel",children:[o.jsxs("div",{className:"layers-panel__header",children:[o.jsx("h4",{children:"Layers"}),o.jsx("span",{className:"layers-panel__count",children:B.length})]}),o.jsx("div",{className:"layers-panel__hint",children:"Drag to reorder layers. Top = front, bottom = back."}),o.jsx("div",{className:"layers-panel__list",children:B.map((te,me)=>{const Ye=re(te),xt=ye(te),Ce=te===at,wt=me===0,pt=me===B.length-1,Ct=oe===te;return o.jsxs("div",{className:`layer-item ${xt?"layer-item--selected":""} ${Ce?"layer-item--drag-over":""} ${Ye.locked?"layer-item--locked":""} ${Ye.visible?"":"layer-item--hidden"}`,draggable:!Ye.locked&&!Ct,onDragStart:Ke=>U(Ke,te),onDragEnd:ae,onDragOver:Ke=>xe(Ke,te),onDragLeave:Te,onDrop:Ke=>He(Ke,te),onClick:()=>!Ct&&le(te),children:[o.jsx("span",{className:`layer-item__handle ${Ye.locked?"layer-item__handle--disabled":""}`,title:Ye.locked?"Locked":"Drag to reorder",children:Ye.locked?"":""}),Ct?o.jsx("input",{type:"text",className:"layer-item__rename-input",value:P,onChange:Ke=>$(Ke.target.value),onBlur:()=>nt(te),onKeyDown:Ke=>yt(Ke,te),autoFocus:!0,onClick:Ke=>Ke.stopPropagation()}):o.jsx("span",{className:`layer-item__name ${Ye.visible?"":"layer-item__name--hidden"}`,children:Ye.name}),o.jsx("div",{className:"layer-item__indicators",children:!Ye.visible&&o.jsx("span",{className:"layer-item__indicator",title:"Hidden",children:""})}),o.jsxs("div",{className:"layer-item__actions",children:[o.jsx("button",{className:"layer-item__menu-btn",onClick:Ke=>de(Ke,te),title:"More actions",children:""}),k===te&&o.jsxs("div",{className:"layer-item__menu",children:[o.jsx("button",{onClick:Ke=>Ee(Ke,te),disabled:wt,children:" Bring to Front"}),o.jsx("button",{onClick:Ke=>ie(Ke,te),disabled:pt,children:" Send to Back"}),o.jsx("div",{className:"layer-item__menu-divider"}),o.jsx("button",{onClick:Ke=>he(Ke,te),children:" Duplicate"}),o.jsx("button",{onClick:Ke=>tt(Ke,te),children:" Rename"}),o.jsx("div",{className:"layer-item__menu-divider"}),o.jsx("button",{onClick:Ke=>ht(Ke,te),children:Ye.locked?" Unlock":" Lock"}),o.jsx("button",{onClick:Ke=>Fe(Ke,te),children:Ye.visible?" Hide":" Show"}),o.jsx("div",{className:"layer-item__menu-divider"}),o.jsx("button",{onClick:Ke=>Xe(Ke,te),className:"layer-item__menu-delete",children:" Delete"})]})]})]},te)})}),Object.keys(a).length>0&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"layers-panel__section-divider",children:o.jsx("span",{children:"Groups"})}),o.jsx("div",{className:"layers-panel__list layers-panel__list--groups",children:Object.entries(a).map(([te,me])=>{const Ye=Y.has(te),xt=m===te,Ce=g===te,wt=me.customName||"Group";return o.jsxs("div",{className:"layer-group",children:[o.jsxs("div",{className:`layer-item layer-item--group ${xt?"layer-item--selected":""} ${Ce?"layer-item--editing":""} ${me.locked?"layer-item--locked":""}`,onClick:()=>!me.locked&&S(te),onDoubleClick:()=>!me.locked&&T(te),children:[o.jsx("button",{className:"layer-item__expand-btn",onClick:pt=>{pt.stopPropagation(),se(Ct=>{const Ke=new Set(Ct);return Ke.has(te)?Ke.delete(te):Ke.add(te),Ke})},title:Ye?"Collapse":"Expand",children:Ye?"":""}),o.jsx("span",{className:"layer-item__handle layer-item__handle--group",children:me.locked?"":""}),o.jsxs("span",{className:"layer-item__name",children:[wt,o.jsxs("span",{className:"layer-item__child-count",children:["(",me.childIds.length,")"]})]}),Ce&&o.jsx("span",{className:"layer-item__edit-indicator",title:"Editing group",children:""}),o.jsxs("div",{className:"layer-item__actions",children:[o.jsx("button",{className:"layer-item__menu-btn",onClick:pt=>de(pt,te),title:"More actions",children:""}),k===te&&o.jsxs("div",{className:"layer-item__menu",children:[o.jsx("button",{onClick:pt=>{pt.stopPropagation(),T(te),Q(null)},children:" Edit Group"}),o.jsx("button",{onClick:pt=>{pt.stopPropagation(),Z(te),Q(null)},children:" Ungroup"}),o.jsx("div",{className:"layer-item__menu-divider"}),o.jsx("button",{onClick:pt=>{pt.stopPropagation(),ce(te),Q(null)},children:me.locked?" Unlock":" Lock"}),o.jsx("div",{className:"layer-item__menu-divider"}),o.jsx("button",{onClick:pt=>{pt.stopPropagation(),confirm(`Delete group "${wt}" and all its contents?`)&&N(te),Q(null)},className:"layer-item__menu-delete",children:" Delete Group"})]})]})]}),Ye&&o.jsx("div",{className:"layer-group__children",children:me.childIds.map(pt=>{const Ct=re(pt),Ke=pt===p||pt===u;return o.jsxs("div",{className:`layer-item layer-item--child ${Ke?"layer-item--selected":""}`,onClick:Xt=>{Xt.stopPropagation(),Ce&&le(pt)},children:[o.jsx("span",{className:"layer-item__indent"}),o.jsx("span",{className:"layer-item__handle layer-item__handle--disabled",children:Ct.icon}),o.jsx("span",{className:`layer-item__name ${Ct.visible?"":"layer-item__name--hidden"}`,children:Ct.name})]},pt)})})]},te)})}),g&&o.jsx("div",{className:"layers-panel__exit-group",children:o.jsx("button",{className:"layers-panel__exit-group-btn",onClick:()=>M(),children:" Exit Group Editing"})})]}),Object.keys(i).length>0&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"layers-panel__section-divider",children:o.jsx("span",{children:"Exclusion Zones"})}),o.jsx("div",{className:"layers-panel__list layers-panel__list--exclusions",children:Object.keys(i).map(te=>{const me=re(te),Ye=ye(te);return o.jsxs("div",{className:`layer-item layer-item--exclusion ${Ye?"layer-item--selected":""} ${me.locked?"layer-item--locked":""} ${me.visible?"":"layer-item--hidden"}`,onClick:()=>le(te),children:[o.jsx("span",{className:"layer-item__handle layer-item__handle--disabled",children:me.icon}),o.jsx("span",{className:`layer-item__name ${me.visible?"":"layer-item__name--hidden"}`,children:me.name}),o.jsx("div",{className:"layer-item__indicators",children:!me.visible&&o.jsx("span",{className:"layer-item__indicator",title:"Hidden",children:""})}),o.jsxs("div",{className:"layer-item__actions",children:[o.jsx("button",{className:"layer-item__menu-btn",onClick:xt=>de(xt,te),title:"More actions",children:""}),k===te&&o.jsxs("div",{className:"layer-item__menu",children:[o.jsx("button",{onClick:xt=>tt(xt,te),children:" Rename"}),o.jsx("div",{className:"layer-item__menu-divider"}),o.jsx("button",{onClick:xt=>ht(xt,te),children:me.locked?" Unlock":" Lock"}),o.jsx("button",{onClick:xt=>Fe(xt,te),children:me.visible?" Hide":" Show"}),o.jsx("div",{className:"layer-item__menu-divider"}),o.jsx("button",{onClick:xt=>Xe(xt,te),className:"layer-item__menu-delete",children:" Delete"})]})]})]},te)})})]}),o.jsx("div",{className:"layers-panel__footer",children:o.jsx("span",{className:"layers-panel__shortcut-hint",children:"[ ] to reorder  G to group  G to ungroup"})})]})}async function R1(){var n,r;const t=await an.auth.getSession(),e=(r=(n=t==null?void 0:t.data)==null?void 0:n.session)==null?void 0:r.access_token;if(!e)throw new Error("Not authenticated");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function O1(t){const e=await R1(),n=await fetch("/api/projects/create",{method:"POST",headers:e,body:JSON.stringify(t)});if(!n.ok){const r=await n.json();throw new Error(r.error||"Unable to create project. Please check your connection and try again.")}return n.json()}async function Bf(){const t=await R1(),e=await fetch("/api/projects/list",{method:"GET",headers:t});if(!e.ok){const n=await e.json();throw new Error(n.error||"Unable to load your projects. Please refresh the page and try again.")}return e.json()}function nT(t,e={}){var n,r;return{type:"sports_surface",version:"1.0",name:e.name||t.name||"Untitled Design",description:e.description||t.description||"",tags:e.tags||t.tags||[],surface:t.surface,courts:rT(t.courts),tracks:sT(t.tracks),motifs:iT(t.motifs),exclusionZones:oT(t.exclusionZones),shapes:aT(t.shapes),texts:lT(t.texts),elementOrder:t.elementOrder||[],customMarkings:t.customMarkings||[],backgroundZones:t.backgroundZones||[],dimensions:{width_mm:((n=t.surface)==null?void 0:n.width_mm)||5e4,length_mm:((r=t.surface)==null?void 0:r.length_mm)||5e4}}}function rT(t){return t?Object.fromEntries(Object.entries(t).map(([e,n])=>[e,{id:n.id,templateId:n.templateId,template:n.template,position:n.position,rotation:n.rotation,scale:n.scale,lineColorOverrides:n.lineColorOverrides||{},zoneColorOverrides:n.zoneColorOverrides||{},courtSurfaceColor:n.courtSurfaceColor}])):{}}function sT(t){return t?Object.fromEntries(Object.entries(t).map(([e,n])=>[e,{id:n.id,templateId:n.templateId,template:n.template,position:n.position,rotation:n.rotation,parameters:n.parameters,trackSurfaceColor:n.trackSurfaceColor,laneSurfaceColors:n.laneSurfaceColors||[],trackLineColor:n.trackLineColor}])):{}}function iT(t){return t?Object.fromEntries(Object.entries(t).map(([e,n])=>[e,{id:n.id,type:"motif",sourceDesignId:n.sourceDesignId,sourceDesignName:n.sourceDesignName,sourceThumbnailUrl:n.sourceThumbnailUrl,svgContent:n.svgContent,originalWidth_mm:n.originalWidth_mm,originalHeight_mm:n.originalHeight_mm,position:n.position,rotation:n.rotation,scale:n.scale}])):{}}function oT(t){return t?Object.fromEntries(Object.entries(t).map(([e,n])=>[e,{id:n.id,type:"exclusion",shapeType:n.shapeType,sides:n.sides,width_mm:n.width_mm,height_mm:n.height_mm,position:n.position,rotation:n.rotation,cornerRadius:n.cornerRadius,locked:n.locked,visible:n.visible,customName:n.customName,controlPoints:n.controlPoints}])):{}}function aT(t){return t?Object.fromEntries(Object.entries(t).map(([e,n])=>[e,{id:n.id,shapeType:n.shapeType,controlPoints:n.controlPoints,width_mm:n.width_mm,height_mm:n.height_mm,position:n.position,rotation:n.rotation,fillColor:n.fillColor,strokeEnabled:n.strokeEnabled,strokeColor:n.strokeColor,strokeWidth_mm:n.strokeWidth_mm,sides:n.sides,cornerRadius:n.cornerRadius,closed:n.closed,smooth:n.smooth,editPointsVisible:n.editPointsVisible}])):{}}function lT(t){return t?Object.fromEntries(Object.entries(t).map(([e,n])=>[e,{id:n.id,content:n.content,fontFamily:n.fontFamily,fontSize_mm:n.fontSize_mm,fontWeight:n.fontWeight,fontStyle:n.fontStyle,textAlign:n.textAlign,position:n.position,rotation:n.rotation,fillColor:n.fillColor,strokeColor:n.strokeColor,strokeWidth_mm:n.strokeWidth_mm}])):{}}function cT(t){var r,s;const e=[];return t.surface||e.push("Surface configuration is required"),(!((r=t.surface)!=null&&r.width_mm)||!((s=t.surface)!=null&&s.length_mm))&&e.push("Surface dimensions are required"),t.courts&&Object.keys(t.courts).length>0||t.tracks&&Object.keys(t.tracks).length>0||t.motifs&&Object.keys(t.motifs).length>0||e.push("Add at least one court, track, or motif to save"),{valid:e.length===0,errors:e}}async function dT(t,e=400){return new Promise((n,r)=>{try{const s=t.cloneNode(!0);s.querySelectorAll(".court-canvas__court--selected, .transform-handles").forEach(m=>{m.classList.remove("court-canvas__court--selected")}),s.querySelectorAll(".transform-handles").forEach(m=>m.remove());const i=t.getAttribute("viewBox").split(" ").map(Number),a=i[2],l=i[3];let c,d;a>l?(c=e,d=Math.round(l/a*e)):(d=e,c=Math.round(a/l*e)),s.setAttribute("width",c),s.setAttribute("height",d);const u=new XMLSerializer().serializeToString(s),p=new Blob([u],{type:"image/svg+xml;charset=utf-8"}),h=URL.createObjectURL(p),f=new Image;f.onload=()=>{const m=document.createElement("canvas");m.width=c,m.height=d;const g=m.getContext("2d");g.fillStyle="#ffffff",g.fillRect(0,0,c,d),g.drawImage(f,0,0,c,d),m.toBlob(v=>{URL.revokeObjectURL(h),n(v)},"image/png",.9)},f.onerror=m=>{URL.revokeObjectURL(h),r(new Error("Failed to load SVG for thumbnail"))},f.src=h}catch(s){r(s)}})}async function uT(t){const n=`thumbnails/sports/${`sports-${Date.now()}-${Math.random().toString(36).substr(2,9)}.png`}`,{data:r,error:s}=await an.storage.from("tpv-studio-uploads").upload(n,t,{cacheControl:"3600",contentType:"image/png",upsert:!1});if(s)throw s;const{data:{publicUrl:i}}=an.storage.from("tpv-studio-uploads").getPublicUrl(n);return i}function hT({existingDesignId:t=null,initialName:e="",svgRef:n=null,onClose:r,onSaved:s}){const i=lt(K=>K.exportDesignData),[a,l]=O.useState(e),[c,d]=O.useState(""),[u,p]=O.useState(""),[h,f]=O.useState(""),[m,g]=O.useState(!1),[v,x]=O.useState([]),[y,b]=O.useState(!1),[w,j]=O.useState(""),[_,S]=O.useState("#1a365d"),[E,T]=O.useState(!1),[M,Z]=O.useState(!1),[N,G]=O.useState(!1),[C,F]=O.useState(null);O.useEffect(()=>{pe()},[]);const pe=async()=>{try{const{projects:K}=await Bf();x(K)}catch(K){console.error("Failed to load projects:",K),F("Failed to load projects")}},V=async()=>{if(!w.trim()){F("Project name is required");return}G(!0),F(null);try{const{project:K}=await O1({name:w.trim(),color:_});x([K,...v]),p(K.id),b(!1),j(""),S("#1a365d")}catch(K){console.error("Failed to create project:",K),F(K.message)}finally{G(!1)}},J=async(K=!1)=>{if(!a.trim()){F("Design name is required");return}const z=i(),W=cT(z);if(!W.valid){F(W.errors.join(", "));return}K?Z(!0):T(!0),F(null);try{let fe=null;if(n!=null&&n.current)try{console.log("[SPORTS-SAVE] Generating thumbnail...");const ce=await dT(n.current);console.log("[SPORTS-SAVE] Uploading thumbnail..."),fe=await uT(ce),console.log("[SPORTS-SAVE] Thumbnail uploaded:",fe)}catch(ce){console.warn("[SPORTS-SAVE] Thumbnail generation failed, continuing without:",ce)}const ue=nT(z,{name:a.trim(),description:c.trim()||"",tags:h.split(",").map(ce=>ce.trim()).filter(ce=>ce)});console.log("[SPORTS-SAVE] Serialized design data:",ue);const ne={name:a.trim(),description:c.trim()||null,project_id:u||null,tags:h.split(",").map(ce=>ce.trim()).filter(ce=>ce),is_public:m,design_data:ue,thumbnail_url:fe};t&&!K&&(ne.id=t);const ke=await If(ne);s&&s(ke,a.trim()),r()}catch(fe){console.error("Failed to save design:",fe),F(fe.message)}finally{T(!1),Z(!1)}},I=["#1a365d","#ff6b35","#4a90e2","#50c878","#9b59b6","#e74c3c"];return o.jsx("div",{className:"modal-overlay",onClick:r,children:o.jsxs("div",{className:"modal-content save-design-modal",onClick:K=>K.stopPropagation(),children:[o.jsxs("div",{className:"modal-header",children:[o.jsx("h2",{children:t?"Update Design":"Save Design"}),o.jsx("button",{onClick:r,className:"close-button",children:""})]}),o.jsxs("div",{className:"modal-body",children:[C&&o.jsx("div",{className:"error-message",children:C}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"design-name",children:"Design Name *"}),o.jsx("input",{id:"design-name",type:"text",value:a,onChange:K=>l(K.target.value),placeholder:"e.g., Multi-Sport Court Design",autoFocus:!0,disabled:E||M})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"design-description",children:"Description"}),o.jsx("textarea",{id:"design-description",value:c,onChange:K=>d(K.target.value),placeholder:"Optional notes about this sports surface design...",rows:3,disabled:E||M})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"design-project",children:"Project"}),y?o.jsxs("div",{className:"new-project-form",children:[o.jsxs("div",{className:"input-row",children:[o.jsx("input",{type:"text",value:w,onChange:K=>j(K.target.value),placeholder:"Project name...",disabled:N}),o.jsx("div",{className:"color-picker-inline",children:I.map(K=>o.jsx("button",{type:"button",className:`color-swatch ${_===K?"active":""}`,style:{backgroundColor:K},onClick:()=>S(K),disabled:N},K))})]}),o.jsxs("div",{className:"button-row",children:[o.jsx("button",{type:"button",onClick:V,className:"btn-primary btn-small",disabled:N,children:N?"Creating...":"Create"}),o.jsx("button",{type:"button",onClick:()=>b(!1),className:"btn-secondary btn-small",disabled:N,children:"Cancel"})]})]}):o.jsxs("div",{className:"project-selector",children:[o.jsxs("select",{id:"design-project",value:u,onChange:K=>p(K.target.value),disabled:E||M,children:[o.jsx("option",{value:"",children:"No Project"}),v.map(K=>o.jsxs("option",{value:K.id,children:[K.name," (",K.design_count," designs)"]},K.id))]}),o.jsx("button",{type:"button",onClick:()=>b(!0),className:"btn-secondary btn-small",disabled:E||M,children:"+ New Project"})]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"design-tags",children:"Tags"}),o.jsx("input",{id:"design-tags",type:"text",value:h,onChange:K=>f(K.target.value),placeholder:"e.g., tennis, multi-sport, school (comma-separated)",disabled:E||M}),o.jsx("small",{className:"help-text",children:"Separate tags with commas"})]}),o.jsx("div",{className:"form-group checkbox-group",children:o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:m,onChange:K=>g(K.target.checked),disabled:E||M}),o.jsx("span",{children:"Make this design public (shareable link)"})]})})]}),o.jsxs("div",{className:"modal-footer",children:[o.jsx("button",{onClick:r,className:"btn-secondary",disabled:E||M,children:"Cancel"}),t&&o.jsx("button",{onClick:()=>J(!0),className:"btn-secondary",disabled:E||M,children:M?"Saving...":"Save as New"}),o.jsx("button",{onClick:()=>J(!1),className:"btn-primary",disabled:E||M,children:E?"Saving...":t?"Update":"Save Design"})]})]})})}function Hf(t,e){var p,h,f,m;if(!t)throw new Error("SVG element not found");const n=t.cloneNode(!0);n.querySelectorAll('.court-canvas__selection-outline, .transform-handles, [class*="selection"], [class*="handle"]').forEach(g=>g.remove()),n.querySelectorAll("[stroke-dasharray]").forEach(g=>{g.getAttribute("stroke-dasharray")&&g.remove()});const i=document.createElementNS("http://www.w3.org/2000/svg","title");i.textContent=(e==null?void 0:e.name)||"Sports Surface Design",n.insertBefore(i,n.firstChild);const a=document.createElementNS("http://www.w3.org/2000/svg","desc");a.textContent=`Generated by TPV Designer. Dimensions: ${(((p=e==null?void 0:e.surface)==null?void 0:p.width_mm)/1e3).toFixed(1)}m  ${(((h=e==null?void 0:e.surface)==null?void 0:h.length_mm)/1e3).toFixed(1)}m`,n.insertBefore(a,n.firstChild.nextSibling),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");const l=((f=e==null?void 0:e.surface)==null?void 0:f.width_mm)||5e4,c=((m=e==null?void 0:e.surface)==null?void 0:m.length_mm)||5e4;n.setAttribute("width",`${l}mm`),n.setAttribute("height",`${c}mm`),n.setAttribute("data-tpv-studio","1.0"),n.setAttribute("data-design-type","sports_surface");let u=new XMLSerializer().serializeToString(n);return u=`<?xml version="1.0" encoding="UTF-8"?>
`+u,u}function pT(t,e="sports-surface.svg"){const n=new Blob([t],{type:"image/svg+xml"}),r=URL.createObjectURL(n),s=document.createElement("a");s.href=r,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)}async function fT(t,e,n="sports-surface.png",r=2){return new Promise((s,i)=>{try{const a=Hf(t,e),l=document.createElement("canvas"),c=l.getContext("2d"),d=t.getAttribute("viewBox");let u=1200,p=1200;if(d){const[,,g,v]=d.split(" ").map(Number),x=2400,y=v/g;u=Math.min(g/10,x),p=u*y}l.width=u*r,l.height=p*r;const h=new Image,f=new Blob([a],{type:"image/svg+xml;charset=utf-8"}),m=URL.createObjectURL(f);h.onload=()=>{c.fillStyle="#ffffff",c.fillRect(0,0,l.width,l.height),c.drawImage(h,0,0,l.width,l.height),l.toBlob(g=>{if(!g){i(new Error("Failed to create PNG blob"));return}const v=URL.createObjectURL(g),x=document.createElement("a");x.href=v,x.download=n,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(m),URL.revokeObjectURL(v),s()},"image/png",.95)},h.onerror=g=>{URL.revokeObjectURL(m),i(new Error("Failed to load SVG for PNG conversion"))},h.src=m}catch(a){i(a)}})}function Ta(t,e){const n=(t||"sports-surface").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").substring(0,50),r=new Date().toISOString().split("T")[0];return`${n}_${r}.${e}`}function _c(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var A1={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,s,i){function a(d,u){if(!s[d]){if(!r[d]){var p=typeof _c=="function"&&_c;if(!u&&p)return p(d,!0);if(l)return l(d,!0);var h=new Error("Cannot find module '"+d+"'");throw h.code="MODULE_NOT_FOUND",h}var f=s[d]={exports:{}};r[d][0].call(f.exports,function(m){var g=r[d][1][m];return a(g||m)},f,f.exports,n,r,s,i)}return s[d].exports}for(var l=typeof _c=="function"&&_c,c=0;c<i.length;c++)a(i[c]);return a}({1:[function(n,r,s){var i=n("./utils"),a=n("./support"),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(c){for(var d,u,p,h,f,m,g,v=[],x=0,y=c.length,b=y,w=i.getTypeOf(c)!=="string";x<c.length;)b=y-x,p=w?(d=c[x++],u=x<y?c[x++]:0,x<y?c[x++]:0):(d=c.charCodeAt(x++),u=x<y?c.charCodeAt(x++):0,x<y?c.charCodeAt(x++):0),h=d>>2,f=(3&d)<<4|u>>4,m=1<b?(15&u)<<2|p>>6:64,g=2<b?63&p:64,v.push(l.charAt(h)+l.charAt(f)+l.charAt(m)+l.charAt(g));return v.join("")},s.decode=function(c){var d,u,p,h,f,m,g=0,v=0,x="data:";if(c.substr(0,x.length)===x)throw new Error("Invalid base64 input, it looks like a data url.");var y,b=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===l.charAt(64)&&b--,c.charAt(c.length-2)===l.charAt(64)&&b--,b%1!=0)throw new Error("Invalid base64 input, bad content length.");for(y=a.uint8array?new Uint8Array(0|b):new Array(0|b);g<c.length;)d=l.indexOf(c.charAt(g++))<<2|(h=l.indexOf(c.charAt(g++)))>>4,u=(15&h)<<4|(f=l.indexOf(c.charAt(g++)))>>2,p=(3&f)<<6|(m=l.indexOf(c.charAt(g++))),y[v++]=d,f!==64&&(y[v++]=u),m!==64&&(y[v++]=p);return y}},{"./support":30,"./utils":32}],2:[function(n,r,s){var i=n("./external"),a=n("./stream/DataWorker"),l=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function d(u,p,h,f,m){this.compressedSize=u,this.uncompressedSize=p,this.crc32=h,this.compression=f,this.compressedContent=m}d.prototype={getContentWorker:function(){var u=new a(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),p=this;return u.on("end",function(){if(this.streamInfo.data_length!==p.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new a(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},d.createWorkerFrom=function(u,p,h){return u.pipe(new l).pipe(new c("uncompressedSize")).pipe(p.compressWorker(h)).pipe(new c("compressedSize")).withStreamInfo("compression",p)},r.exports=d},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,s){var i=n("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},s.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,s){var i=n("./utils"),a=function(){for(var l,c=[],d=0;d<256;d++){l=d;for(var u=0;u<8;u++)l=1&l?3988292384^l>>>1:l>>>1;c[d]=l}return c}();r.exports=function(l,c){return l!==void 0&&l.length?i.getTypeOf(l)!=="string"?function(d,u,p,h){var f=a,m=h+p;d^=-1;for(var g=h;g<m;g++)d=d>>>8^f[255&(d^u[g])];return-1^d}(0|c,l,l.length,0):function(d,u,p,h){var f=a,m=h+p;d^=-1;for(var g=h;g<m;g++)d=d>>>8^f[255&(d^u.charCodeAt(g))];return-1^d}(0|c,l,l.length,0):0}},{"./utils":32}],5:[function(n,r,s){s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(n,r,s){var i=null;i=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:i}},{lie:37}],7:[function(n,r,s){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",a=n("pako"),l=n("./utils"),c=n("./stream/GenericWorker"),d=i?"uint8array":"array";function u(p,h){c.call(this,"FlateWorker/"+p),this._pako=null,this._pakoAction=p,this._pakoOptions=h,this.meta={}}s.magic="\b\0",l.inherits(u,c),u.prototype.processChunk=function(p){this.meta=p.meta,this._pako===null&&this._createPako(),this._pako.push(l.transformTo(d,p.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var p=this;this._pako.onData=function(h){p.push({data:h,meta:p.meta})}},s.compressWorker=function(p){return new u("Deflate",p)},s.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,s){function i(f,m){var g,v="";for(g=0;g<m;g++)v+=String.fromCharCode(255&f),f>>>=8;return v}function a(f,m,g,v,x,y){var b,w,j=f.file,_=f.compression,S=y!==d.utf8encode,E=l.transformTo("string",y(j.name)),T=l.transformTo("string",d.utf8encode(j.name)),M=j.comment,Z=l.transformTo("string",y(M)),N=l.transformTo("string",d.utf8encode(M)),G=T.length!==j.name.length,C=N.length!==M.length,F="",pe="",V="",J=j.dir,I=j.date,K={crc32:0,compressedSize:0,uncompressedSize:0};m&&!g||(K.crc32=f.crc32,K.compressedSize=f.compressedSize,K.uncompressedSize=f.uncompressedSize);var z=0;m&&(z|=8),S||!G&&!C||(z|=2048);var W=0,fe=0;J&&(W|=16),x==="UNIX"?(fe=798,W|=function(ne,ke){var ce=ne;return ne||(ce=ke?16893:33204),(65535&ce)<<16}(j.unixPermissions,J)):(fe=20,W|=function(ne){return 63&(ne||0)}(j.dosPermissions)),b=I.getUTCHours(),b<<=6,b|=I.getUTCMinutes(),b<<=5,b|=I.getUTCSeconds()/2,w=I.getUTCFullYear()-1980,w<<=4,w|=I.getUTCMonth()+1,w<<=5,w|=I.getUTCDate(),G&&(pe=i(1,1)+i(u(E),4)+T,F+="up"+i(pe.length,2)+pe),C&&(V=i(1,1)+i(u(Z),4)+N,F+="uc"+i(V.length,2)+V);var ue="";return ue+=`
\0`,ue+=i(z,2),ue+=_.magic,ue+=i(b,2),ue+=i(w,2),ue+=i(K.crc32,4),ue+=i(K.compressedSize,4),ue+=i(K.uncompressedSize,4),ue+=i(E.length,2),ue+=i(F.length,2),{fileRecord:p.LOCAL_FILE_HEADER+ue+E+F,dirRecord:p.CENTRAL_FILE_HEADER+i(fe,2)+ue+i(Z.length,2)+"\0\0\0\0"+i(W,4)+i(v,4)+E+F+Z}}var l=n("../utils"),c=n("../stream/GenericWorker"),d=n("../utf8"),u=n("../crc32"),p=n("../signature");function h(f,m,g,v){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=g,this.encodeFileName=v,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}l.inherits(h,c),h.prototype.push=function(f){var m=f.meta.percent||0,g=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,c.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:g?(m+100*(g-v-1))/g:100}}))},h.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var m=this.streamFiles&&!f.file.dir;if(m){var g=a(f,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},h.prototype.closedSource=function(f){this.accumulate=!1;var m=this.streamFiles&&!f.file.dir,g=a(f,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),m)this.push({data:function(v){return p.DATA_DESCRIPTOR+i(v.crc32,4)+i(v.compressedSize,4)+i(v.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},h.prototype.flush=function(){for(var f=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var g=this.bytesWritten-f,v=function(x,y,b,w,j){var _=l.transformTo("string",j(w));return p.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(x,2)+i(x,2)+i(y,4)+i(b,4)+i(_.length,2)+_}(this.dirRecords.length,g,f,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},h.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},h.prototype.registerPrevious=function(f){this._sources.push(f);var m=this;return f.on("data",function(g){m.processChunk(g)}),f.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),f.on("error",function(g){m.error(g)}),this},h.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},h.prototype.error=function(f){var m=this._sources;if(!c.prototype.error.call(this,f))return!1;for(var g=0;g<m.length;g++)try{m[g].error(f)}catch{}return!0},h.prototype.lock=function(){c.prototype.lock.call(this);for(var f=this._sources,m=0;m<f.length;m++)f[m].lock()},r.exports=h},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,s){var i=n("../compressions"),a=n("./ZipFileWorker");s.generateWorker=function(l,c,d){var u=new a(c.streamFiles,d,c.platform,c.encodeFileName),p=0;try{l.forEach(function(h,f){p++;var m=function(y,b){var w=y||b,j=i[w];if(!j)throw new Error(w+" is not a valid compression method !");return j}(f.options.compression,c.compression),g=f.options.compressionOptions||c.compressionOptions||{},v=f.dir,x=f.date;f._compressWorker(m,g).withStreamInfo("file",{name:h,dir:v,date:x,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(u)}),u.entriesCount=p}catch(h){u.error(h)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,s){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new i;for(var l in this)typeof this[l]!="function"&&(a[l]=this[l]);return a}}(i.prototype=n("./object")).loadAsync=n("./load"),i.support=n("./support"),i.defaults=n("./defaults"),i.version="3.10.1",i.loadAsync=function(a,l){return new i().loadAsync(a,l)},i.external=n("./external"),r.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,s){var i=n("./utils"),a=n("./external"),l=n("./utf8"),c=n("./zipEntries"),d=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function p(h){return new a.Promise(function(f,m){var g=h.decompressed.getContentWorker().pipe(new d);g.on("error",function(v){m(v)}).on("end",function(){g.streamInfo.crc32!==h.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}r.exports=function(h,f){var m=this;return f=i.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:l.utf8decode}),u.isNode&&u.isStream(h)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",h,!0,f.optimizedBinaryString,f.base64).then(function(g){var v=new c(f);return v.load(g),v}).then(function(g){var v=[a.Promise.resolve(g)],x=g.files;if(f.checkCRC32)for(var y=0;y<x.length;y++)v.push(p(x[y]));return a.Promise.all(v)}).then(function(g){for(var v=g.shift(),x=v.files,y=0;y<x.length;y++){var b=x[y],w=b.fileNameStr,j=i.resolve(b.fileNameStr);m.file(j,b.decompressed,{binary:!0,optimizedBinaryString:!0,date:b.date,dir:b.dir,comment:b.fileCommentStr.length?b.fileCommentStr:null,unixPermissions:b.unixPermissions,dosPermissions:b.dosPermissions,createFolders:f.createFolders}),b.dir||(m.file(j).unsafeOriginalName=w)}return v.zipComment.length&&(m.comment=v.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,s){var i=n("../utils"),a=n("../stream/GenericWorker");function l(c,d){a.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(d)}i.inherits(l,a),l.prototype._bindStream=function(c){var d=this;(this._stream=c).pause(),c.on("data",function(u){d.push({data:u,meta:{percent:0}})}).on("error",function(u){d.isPaused?this.generatedError=u:d.error(u)}).on("end",function(){d.isPaused?d._upstreamEnded=!0:d.end()})},l.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},l.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=l},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,s){var i=n("readable-stream").Readable;function a(l,c,d){i.call(this,c),this._helper=l;var u=this;l.on("data",function(p,h){u.push(p)||u._helper.pause(),d&&d(h)}).on("error",function(p){u.emit("error",p)}).on("end",function(){u.push(null)})}n("../utils").inherits(a,i),a.prototype._read=function(){this._helper.resume()},r.exports=a},{"../utils":32,"readable-stream":16}],14:[function(n,r,s){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,a);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,a)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var a=new Buffer(i);return a.fill(0),a},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(n,r,s){function i(j,_,S){var E,T=l.getTypeOf(_),M=l.extend(S||{},u);M.date=M.date||new Date,M.compression!==null&&(M.compression=M.compression.toUpperCase()),typeof M.unixPermissions=="string"&&(M.unixPermissions=parseInt(M.unixPermissions,8)),M.unixPermissions&&16384&M.unixPermissions&&(M.dir=!0),M.dosPermissions&&16&M.dosPermissions&&(M.dir=!0),M.dir&&(j=x(j)),M.createFolders&&(E=v(j))&&y.call(this,E,!0);var Z=T==="string"&&M.binary===!1&&M.base64===!1;S&&S.binary!==void 0||(M.binary=!Z),(_ instanceof p&&_.uncompressedSize===0||M.dir||!_||_.length===0)&&(M.base64=!1,M.binary=!0,_="",M.compression="STORE",T="string");var N=null;N=_ instanceof p||_ instanceof c?_:m.isNode&&m.isStream(_)?new g(j,_):l.prepareContent(j,_,M.binary,M.optimizedBinaryString,M.base64);var G=new h(j,N,M);this.files[j]=G}var a=n("./utf8"),l=n("./utils"),c=n("./stream/GenericWorker"),d=n("./stream/StreamHelper"),u=n("./defaults"),p=n("./compressedObject"),h=n("./zipObject"),f=n("./generate"),m=n("./nodejsUtils"),g=n("./nodejs/NodejsStreamInputAdapter"),v=function(j){j.slice(-1)==="/"&&(j=j.substring(0,j.length-1));var _=j.lastIndexOf("/");return 0<_?j.substring(0,_):""},x=function(j){return j.slice(-1)!=="/"&&(j+="/"),j},y=function(j,_){return _=_!==void 0?_:u.createFolders,j=x(j),this.files[j]||i.call(this,j,null,{dir:!0,createFolders:_}),this.files[j]};function b(j){return Object.prototype.toString.call(j)==="[object RegExp]"}var w={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(j){var _,S,E;for(_ in this.files)E=this.files[_],(S=_.slice(this.root.length,_.length))&&_.slice(0,this.root.length)===this.root&&j(S,E)},filter:function(j){var _=[];return this.forEach(function(S,E){j(S,E)&&_.push(E)}),_},file:function(j,_,S){if(arguments.length!==1)return j=this.root+j,i.call(this,j,_,S),this;if(b(j)){var E=j;return this.filter(function(M,Z){return!Z.dir&&E.test(M)})}var T=this.files[this.root+j];return T&&!T.dir?T:null},folder:function(j){if(!j)return this;if(b(j))return this.filter(function(T,M){return M.dir&&j.test(T)});var _=this.root+j,S=y.call(this,_),E=this.clone();return E.root=S.name,E},remove:function(j){j=this.root+j;var _=this.files[j];if(_||(j.slice(-1)!=="/"&&(j+="/"),_=this.files[j]),_&&!_.dir)delete this.files[j];else for(var S=this.filter(function(T,M){return M.name.slice(0,j.length)===j}),E=0;E<S.length;E++)delete this.files[S[E].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(j){var _,S={};try{if((S=l.extend(j||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=S.type.toLowerCase(),S.compression=S.compression.toUpperCase(),S.type==="binarystring"&&(S.type="string"),!S.type)throw new Error("No output type specified.");l.checkSupport(S.type),S.platform!=="darwin"&&S.platform!=="freebsd"&&S.platform!=="linux"&&S.platform!=="sunos"||(S.platform="UNIX"),S.platform==="win32"&&(S.platform="DOS");var E=S.comment||this.comment||"";_=f.generateWorker(this,S,E)}catch(T){(_=new c("error")).error(T)}return new d(_,S.type||"string",S.mimeType)},generateAsync:function(j,_){return this.generateInternalStream(j).accumulate(_)},generateNodeStream:function(j,_){return(j=j||{}).type||(j.type="nodebuffer"),this.generateInternalStream(j).toNodejsStream(_)}};r.exports=w},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,s){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,s){var i=n("./DataReader");function a(l){i.call(this,l);for(var c=0;c<this.data.length;c++)l[c]=255&l[c]}n("../utils").inherits(a,i),a.prototype.byteAt=function(l){return this.data[this.zero+l]},a.prototype.lastIndexOfSignature=function(l){for(var c=l.charCodeAt(0),d=l.charCodeAt(1),u=l.charCodeAt(2),p=l.charCodeAt(3),h=this.length-4;0<=h;--h)if(this.data[h]===c&&this.data[h+1]===d&&this.data[h+2]===u&&this.data[h+3]===p)return h-this.zero;return-1},a.prototype.readAndCheckSignature=function(l){var c=l.charCodeAt(0),d=l.charCodeAt(1),u=l.charCodeAt(2),p=l.charCodeAt(3),h=this.readData(4);return c===h[0]&&d===h[1]&&u===h[2]&&p===h[3]},a.prototype.readData=function(l){if(this.checkOffset(l),l===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},r.exports=a},{"../utils":32,"./DataReader":18}],18:[function(n,r,s){var i=n("../utils");function a(l){this.data=l,this.length=l.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(l){this.checkIndex(this.index+l)},checkIndex:function(l){if(this.length<this.zero+l||l<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+l+"). Corrupted zip ?")},setIndex:function(l){this.checkIndex(l),this.index=l},skip:function(l){this.setIndex(this.index+l)},byteAt:function(){},readInt:function(l){var c,d=0;for(this.checkOffset(l),c=this.index+l-1;c>=this.index;c--)d=(d<<8)+this.byteAt(c);return this.index+=l,d},readString:function(l){return i.transformTo("string",this.readData(l))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var l=this.readInt(4);return new Date(Date.UTC(1980+(l>>25&127),(l>>21&15)-1,l>>16&31,l>>11&31,l>>5&63,(31&l)<<1))}},r.exports=a},{"../utils":32}],19:[function(n,r,s){var i=n("./Uint8ArrayReader");function a(l){i.call(this,l)}n("../utils").inherits(a,i),a.prototype.readData=function(l){this.checkOffset(l);var c=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},r.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,s){var i=n("./DataReader");function a(l){i.call(this,l)}n("../utils").inherits(a,i),a.prototype.byteAt=function(l){return this.data.charCodeAt(this.zero+l)},a.prototype.lastIndexOfSignature=function(l){return this.data.lastIndexOf(l)-this.zero},a.prototype.readAndCheckSignature=function(l){return l===this.readData(4)},a.prototype.readData=function(l){this.checkOffset(l);var c=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},r.exports=a},{"../utils":32,"./DataReader":18}],21:[function(n,r,s){var i=n("./ArrayReader");function a(l){i.call(this,l)}n("../utils").inherits(a,i),a.prototype.readData=function(l){if(this.checkOffset(l),l===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},r.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,s){var i=n("../utils"),a=n("../support"),l=n("./ArrayReader"),c=n("./StringReader"),d=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(p){var h=i.getTypeOf(p);return i.checkSupport(h),h!=="string"||a.uint8array?h==="nodebuffer"?new d(p):a.uint8array?new u(i.transformTo("uint8array",p)):new l(i.transformTo("array",p)):new c(p)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,s){s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,s){var i=n("./GenericWorker"),a=n("../utils");function l(c){i.call(this,"ConvertWorker to "+c),this.destType=c}a.inherits(l,i),l.prototype.processChunk=function(c){this.push({data:a.transformTo(this.destType,c.data),meta:c.meta})},r.exports=l},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,s){var i=n("./GenericWorker"),a=n("../crc32");function l(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(l,i),l.prototype.processChunk=function(c){this.streamInfo.crc32=a(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=l},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,s){var i=n("../utils"),a=n("./GenericWorker");function l(c){a.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}i.inherits(l,a),l.prototype.processChunk=function(c){if(c){var d=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=d+c.data.length}a.prototype.processChunk.call(this,c)},r.exports=l},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,s){var i=n("../utils"),a=n("./GenericWorker");function l(c){a.call(this,"DataWorker");var d=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){d.dataIsReady=!0,d.data=u,d.max=u&&u.length||0,d.type=i.getTypeOf(u),d.isPaused||d._tickAndRepeat()},function(u){d.error(u)})}i.inherits(l,a),l.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},l.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},l.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},l.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,d=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,d);break;case"uint8array":c=this.data.subarray(this.index,d);break;case"array":case"nodebuffer":c=this.data.slice(this.index,d)}return this.index=d,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=l},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,s){function i(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,l){return this._listeners[a].push(l),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,l){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].call(this,l)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var l=this;return a.on("data",function(c){l.processChunk(c)}),a.on("end",function(){l.end()}),a.on("error",function(c){l.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,l){return this.extraStreamInfo[a]=l,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},r.exports=i},{}],29:[function(n,r,s){var i=n("../utils"),a=n("./ConvertWorker"),l=n("./GenericWorker"),c=n("../base64"),d=n("../support"),u=n("../external"),p=null;if(d.nodestream)try{p=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function h(m,g){return new u.Promise(function(v,x){var y=[],b=m._internalType,w=m._outputType,j=m._mimeType;m.on("data",function(_,S){y.push(_),g&&g(S)}).on("error",function(_){y=[],x(_)}).on("end",function(){try{var _=function(S,E,T){switch(S){case"blob":return i.newBlob(i.transformTo("arraybuffer",E),T);case"base64":return c.encode(E);default:return i.transformTo(S,E)}}(w,function(S,E){var T,M=0,Z=null,N=0;for(T=0;T<E.length;T++)N+=E[T].length;switch(S){case"string":return E.join("");case"array":return Array.prototype.concat.apply([],E);case"uint8array":for(Z=new Uint8Array(N),T=0;T<E.length;T++)Z.set(E[T],M),M+=E[T].length;return Z;case"nodebuffer":return Buffer.concat(E);default:throw new Error("concat : unsupported type '"+S+"'")}}(b,y),j);v(_)}catch(S){x(S)}y=[]}).resume()})}function f(m,g,v){var x=g;switch(g){case"blob":case"arraybuffer":x="uint8array";break;case"base64":x="string"}try{this._internalType=x,this._outputType=g,this._mimeType=v,i.checkSupport(x),this._worker=m.pipe(new a(x)),m.lock()}catch(y){this._worker=new l("error"),this._worker.error(y)}}f.prototype={accumulate:function(m){return h(this,m)},on:function(m,g){var v=this;return m==="data"?this._worker.on(m,function(x){g.call(v,x.data,x.meta)}):this._worker.on(m,function(){i.delay(g,arguments,v)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:this._outputType!=="nodebuffer"},m)}},r.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,s){if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",s.nodebuffer=typeof Buffer<"u",s.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")s.blob=!1;else{var i=new ArrayBuffer(0);try{s.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(i),s.blob=a.getBlob("application/zip").size===0}catch{s.blob=!1}}}try{s.nodestream=!!n("readable-stream").Readable}catch{s.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,s){for(var i=n("./utils"),a=n("./support"),l=n("./nodejsUtils"),c=n("./stream/GenericWorker"),d=new Array(256),u=0;u<256;u++)d[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;d[254]=d[254]=1;function p(){c.call(this,"utf-8 decode"),this.leftOver=null}function h(){c.call(this,"utf-8 encode")}s.utf8encode=function(f){return a.nodebuffer?l.newBufferFrom(f,"utf-8"):function(m){var g,v,x,y,b,w=m.length,j=0;for(y=0;y<w;y++)(64512&(v=m.charCodeAt(y)))==55296&&y+1<w&&(64512&(x=m.charCodeAt(y+1)))==56320&&(v=65536+(v-55296<<10)+(x-56320),y++),j+=v<128?1:v<2048?2:v<65536?3:4;for(g=a.uint8array?new Uint8Array(j):new Array(j),y=b=0;b<j;y++)(64512&(v=m.charCodeAt(y)))==55296&&y+1<w&&(64512&(x=m.charCodeAt(y+1)))==56320&&(v=65536+(v-55296<<10)+(x-56320),y++),v<128?g[b++]=v:(v<2048?g[b++]=192|v>>>6:(v<65536?g[b++]=224|v>>>12:(g[b++]=240|v>>>18,g[b++]=128|v>>>12&63),g[b++]=128|v>>>6&63),g[b++]=128|63&v);return g}(f)},s.utf8decode=function(f){return a.nodebuffer?i.transformTo("nodebuffer",f).toString("utf-8"):function(m){var g,v,x,y,b=m.length,w=new Array(2*b);for(g=v=0;g<b;)if((x=m[g++])<128)w[v++]=x;else if(4<(y=d[x]))w[v++]=65533,g+=y-1;else{for(x&=y===2?31:y===3?15:7;1<y&&g<b;)x=x<<6|63&m[g++],y--;1<y?w[v++]=65533:x<65536?w[v++]=x:(x-=65536,w[v++]=55296|x>>10&1023,w[v++]=56320|1023&x)}return w.length!==v&&(w.subarray?w=w.subarray(0,v):w.length=v),i.applyFromCharCode(w)}(f=i.transformTo(a.uint8array?"uint8array":"array",f))},i.inherits(p,c),p.prototype.processChunk=function(f){var m=i.transformTo(a.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var g=m;(m=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),m.set(g,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var v=function(y,b){var w;for((b=b||y.length)>y.length&&(b=y.length),w=b-1;0<=w&&(192&y[w])==128;)w--;return w<0||w===0?b:w+d[y[w]]>b?w:b}(m),x=m;v!==m.length&&(a.uint8array?(x=m.subarray(0,v),this.leftOver=m.subarray(v,m.length)):(x=m.slice(0,v),this.leftOver=m.slice(v,m.length))),this.push({data:s.utf8decode(x),meta:f.meta})},p.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=p,i.inherits(h,c),h.prototype.processChunk=function(f){this.push({data:s.utf8encode(f.data),meta:f.meta})},s.Utf8EncodeWorker=h},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,s){var i=n("./support"),a=n("./base64"),l=n("./nodejsUtils"),c=n("./external");function d(g){return g}function u(g,v){for(var x=0;x<g.length;++x)v[x]=255&g.charCodeAt(x);return v}n("setimmediate"),s.newBlob=function(g,v){s.checkSupport("blob");try{return new Blob([g],{type:v})}catch{try{var x=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return x.append(g),x.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:function(g,v,x){var y=[],b=0,w=g.length;if(w<=x)return String.fromCharCode.apply(null,g);for(;b<w;)v==="array"||v==="nodebuffer"?y.push(String.fromCharCode.apply(null,g.slice(b,Math.min(b+x,w)))):y.push(String.fromCharCode.apply(null,g.subarray(b,Math.min(b+x,w)))),b+=x;return y.join("")},stringifyByChar:function(g){for(var v="",x=0;x<g.length;x++)v+=String.fromCharCode(g[x]);return v},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,l.allocBuffer(1)).length===1}catch{return!1}}()}};function h(g){var v=65536,x=s.getTypeOf(g),y=!0;if(x==="uint8array"?y=p.applyCanBeUsed.uint8array:x==="nodebuffer"&&(y=p.applyCanBeUsed.nodebuffer),y)for(;1<v;)try{return p.stringifyByChunk(g,x,v)}catch{v=Math.floor(v/2)}return p.stringifyByChar(g)}function f(g,v){for(var x=0;x<g.length;x++)v[x]=g[x];return v}s.applyFromCharCode=h;var m={};m.string={string:d,array:function(g){return u(g,new Array(g.length))},arraybuffer:function(g){return m.string.uint8array(g).buffer},uint8array:function(g){return u(g,new Uint8Array(g.length))},nodebuffer:function(g){return u(g,l.allocBuffer(g.length))}},m.array={string:h,array:d,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return l.newBufferFrom(g)}},m.arraybuffer={string:function(g){return h(new Uint8Array(g))},array:function(g){return f(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:d,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return l.newBufferFrom(new Uint8Array(g))}},m.uint8array={string:h,array:function(g){return f(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:d,nodebuffer:function(g){return l.newBufferFrom(g)}},m.nodebuffer={string:h,array:function(g){return f(g,new Array(g.length))},arraybuffer:function(g){return m.nodebuffer.uint8array(g).buffer},uint8array:function(g){return f(g,new Uint8Array(g.length))},nodebuffer:d},s.transformTo=function(g,v){if(v=v||"",!g)return v;s.checkSupport(g);var x=s.getTypeOf(v);return m[x][g](v)},s.resolve=function(g){for(var v=g.split("/"),x=[],y=0;y<v.length;y++){var b=v[y];b==="."||b===""&&y!==0&&y!==v.length-1||(b===".."?x.pop():x.push(b))}return x.join("/")},s.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":i.nodebuffer&&l.isBuffer(g)?"nodebuffer":i.uint8array&&g instanceof Uint8Array?"uint8array":i.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(g){if(!i[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(g){var v,x,y="";for(x=0;x<(g||"").length;x++)y+="\\x"+((v=g.charCodeAt(x))<16?"0":"")+v.toString(16).toUpperCase();return y},s.delay=function(g,v,x){setImmediate(function(){g.apply(x||null,v||[])})},s.inherits=function(g,v){function x(){}x.prototype=v.prototype,g.prototype=new x},s.extend=function(){var g,v,x={};for(g=0;g<arguments.length;g++)for(v in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],v)&&x[v]===void 0&&(x[v]=arguments[g][v]);return x},s.prepareContent=function(g,v,x,y,b){return c.Promise.resolve(v).then(function(w){return i.blob&&(w instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(w))!==-1)&&typeof FileReader<"u"?new c.Promise(function(j,_){var S=new FileReader;S.onload=function(E){j(E.target.result)},S.onerror=function(E){_(E.target.error)},S.readAsArrayBuffer(w)}):w}).then(function(w){var j=s.getTypeOf(w);return j?(j==="arraybuffer"?w=s.transformTo("uint8array",w):j==="string"&&(b?w=a.decode(w):x&&y!==!0&&(w=function(_){return u(_,i.uint8array?new Uint8Array(_.length):new Array(_.length))}(w))),w):c.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,s){var i=n("./reader/readerFor"),a=n("./utils"),l=n("./signature"),c=n("./zipEntry"),d=n("./support");function u(p){this.files=[],this.loadOptions=p}u.prototype={checkSignature:function(p){if(!this.reader.readAndCheckSignature(p)){this.reader.index-=4;var h=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(h)+", expected "+a.pretty(p)+")")}},isSignature:function(p,h){var f=this.reader.index;this.reader.setIndex(p);var m=this.reader.readString(4)===h;return this.reader.setIndex(f),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var p=this.reader.readData(this.zipCommentLength),h=d.uint8array?"uint8array":"array",f=a.transformTo(h,p);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var p,h,f,m=this.zip64EndOfCentralSize-44;0<m;)p=this.reader.readInt(2),h=this.reader.readInt(4),f=this.reader.readData(h),this.zip64ExtensibleData[p]={id:p,length:h,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var p,h;for(p=0;p<this.files.length;p++)h=this.files[p],this.reader.setIndex(h.localHeaderOffset),this.checkSignature(l.LOCAL_FILE_HEADER),h.readLocalPart(this.reader),h.handleUTF8(),h.processAttributes()},readCentralDir:function(){var p;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(l.CENTRAL_FILE_HEADER);)(p=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(p);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var p=this.reader.lastIndexOfSignature(l.CENTRAL_DIRECTORY_END);if(p<0)throw this.isSignature(0,l.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(p);var h=p;if(this.checkSignature(l.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(p=this.reader.lastIndexOfSignature(l.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(p),this.checkSignature(l.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,l.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(l.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(l.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var m=h-f;if(0<m)this.isSignature(h,l.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(p){this.reader=i(p)},load:function(p){this.prepareReader(p),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,s){var i=n("./reader/readerFor"),a=n("./utils"),l=n("./compressedObject"),c=n("./crc32"),d=n("./utf8"),u=n("./compressions"),p=n("./support");function h(f,m){this.options=f,this.loadOptions=m}h.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var m,g;if(f.skip(22),this.fileNameLength=f.readInt(2),g=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(v){for(var x in u)if(Object.prototype.hasOwnProperty.call(u,x)&&u[x].magic===v)return u[x];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new l(this.compressedSize,this.uncompressedSize,this.crc32,m,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var m=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(m),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=i(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var m,g,v,x=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<x;)m=f.readInt(2),g=f.readInt(2),v=f.readData(g),this.extraFields[m]={id:m,length:g,value:v};f.setIndex(x)},handleUTF8:function(){var f=p.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=d.utf8decode(this.fileName),this.fileCommentStr=d.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var g=a.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var x=a.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(x)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var m=i(f.value);return m.readInt(1)!==1||c(this.fileName)!==m.readInt(4)?null:d.utf8decode(m.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var m=i(f.value);return m.readInt(1)!==1||c(this.fileComment)!==m.readInt(4)?null:d.utf8decode(m.readData(f.length-5))}return null}},r.exports=h},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,s){function i(m,g,v){this.name=m,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=g,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}var a=n("./stream/StreamHelper"),l=n("./stream/DataWorker"),c=n("./utf8"),d=n("./compressedObject"),u=n("./stream/GenericWorker");i.prototype={internalStream:function(m){var g=null,v="string";try{if(!m)throw new Error("No output type specified.");var x=(v=m.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),g=this._decompressWorker();var y=!this._dataBinary;y&&!x&&(g=g.pipe(new c.Utf8EncodeWorker)),!y&&x&&(g=g.pipe(new c.Utf8DecodeWorker))}catch(b){(g=new u("error")).error(b)}return new a(g,v,"")},async:function(m,g){return this.internalStream(m).accumulate(g)},nodeStream:function(m,g){return this.internalStream(m||"nodebuffer").toNodejsStream(g)},_compressWorker:function(m,g){if(this._data instanceof d&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new c.Utf8EncodeWorker)),d.createWorkerFrom(v,m,g)},_decompressWorker:function(){return this._data instanceof d?this._data.getContentWorker():this._data instanceof u?this._data:new l(this._data)}};for(var p=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],h=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<p.length;f++)i.prototype[p[f]]=h;r.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,s){(function(i){var a,l,c=i.MutationObserver||i.WebKitMutationObserver;if(c){var d=0,u=new c(m),p=i.document.createTextNode("");u.observe(p,{characterData:!0}),a=function(){p.data=d=++d%2}}else if(i.setImmediate||i.MessageChannel===void 0)a="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var g=i.document.createElement("script");g.onreadystatechange=function(){m(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},i.document.documentElement.appendChild(g)}:function(){setTimeout(m,0)};else{var h=new i.MessageChannel;h.port1.onmessage=m,a=function(){h.port2.postMessage(0)}}var f=[];function m(){var g,v;l=!0;for(var x=f.length;x;){for(v=f,f=[],g=-1;++g<x;)v[g]();x=f.length}l=!1}r.exports=function(g){f.push(g)!==1||l||a()}}).call(this,typeof Us<"u"?Us:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,s){var i=n("immediate");function a(){}var l={},c=["REJECTED"],d=["FULFILLED"],u=["PENDING"];function p(x){if(typeof x!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,x!==a&&g(this,x)}function h(x,y,b){this.promise=x,typeof y=="function"&&(this.onFulfilled=y,this.callFulfilled=this.otherCallFulfilled),typeof b=="function"&&(this.onRejected=b,this.callRejected=this.otherCallRejected)}function f(x,y,b){i(function(){var w;try{w=y(b)}catch(j){return l.reject(x,j)}w===x?l.reject(x,new TypeError("Cannot resolve promise with itself")):l.resolve(x,w)})}function m(x){var y=x&&x.then;if(x&&(typeof x=="object"||typeof x=="function")&&typeof y=="function")return function(){y.apply(x,arguments)}}function g(x,y){var b=!1;function w(S){b||(b=!0,l.reject(x,S))}function j(S){b||(b=!0,l.resolve(x,S))}var _=v(function(){y(j,w)});_.status==="error"&&w(_.value)}function v(x,y){var b={};try{b.value=x(y),b.status="success"}catch(w){b.status="error",b.value=w}return b}(r.exports=p).prototype.finally=function(x){if(typeof x!="function")return this;var y=this.constructor;return this.then(function(b){return y.resolve(x()).then(function(){return b})},function(b){return y.resolve(x()).then(function(){throw b})})},p.prototype.catch=function(x){return this.then(null,x)},p.prototype.then=function(x,y){if(typeof x!="function"&&this.state===d||typeof y!="function"&&this.state===c)return this;var b=new this.constructor(a);return this.state!==u?f(b,this.state===d?x:y,this.outcome):this.queue.push(new h(b,x,y)),b},h.prototype.callFulfilled=function(x){l.resolve(this.promise,x)},h.prototype.otherCallFulfilled=function(x){f(this.promise,this.onFulfilled,x)},h.prototype.callRejected=function(x){l.reject(this.promise,x)},h.prototype.otherCallRejected=function(x){f(this.promise,this.onRejected,x)},l.resolve=function(x,y){var b=v(m,y);if(b.status==="error")return l.reject(x,b.value);var w=b.value;if(w)g(x,w);else{x.state=d,x.outcome=y;for(var j=-1,_=x.queue.length;++j<_;)x.queue[j].callFulfilled(y)}return x},l.reject=function(x,y){x.state=c,x.outcome=y;for(var b=-1,w=x.queue.length;++b<w;)x.queue[b].callRejected(y);return x},p.resolve=function(x){return x instanceof this?x:l.resolve(new this(a),x)},p.reject=function(x){var y=new this(a);return l.reject(y,x)},p.all=function(x){var y=this;if(Object.prototype.toString.call(x)!=="[object Array]")return this.reject(new TypeError("must be an array"));var b=x.length,w=!1;if(!b)return this.resolve([]);for(var j=new Array(b),_=0,S=-1,E=new this(a);++S<b;)T(x[S],S);return E;function T(M,Z){y.resolve(M).then(function(N){j[Z]=N,++_!==b||w||(w=!0,l.resolve(E,j))},function(N){w||(w=!0,l.reject(E,N))})}},p.race=function(x){var y=this;if(Object.prototype.toString.call(x)!=="[object Array]")return this.reject(new TypeError("must be an array"));var b=x.length,w=!1;if(!b)return this.resolve([]);for(var j=-1,_=new this(a);++j<b;)S=x[j],y.resolve(S).then(function(E){w||(w=!0,l.resolve(_,E))},function(E){w||(w=!0,l.reject(_,E))});var S;return _}},{immediate:36}],38:[function(n,r,s){var i={};(0,n("./lib/utils/common").assign)(i,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,s){var i=n("./zlib/deflate"),a=n("./utils/common"),l=n("./utils/strings"),c=n("./zlib/messages"),d=n("./zlib/zstream"),u=Object.prototype.toString,p=0,h=-1,f=0,m=8;function g(x){if(!(this instanceof g))return new g(x);this.options=a.assign({level:h,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},x||{});var y=this.options;y.raw&&0<y.windowBits?y.windowBits=-y.windowBits:y.gzip&&0<y.windowBits&&y.windowBits<16&&(y.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var b=i.deflateInit2(this.strm,y.level,y.method,y.windowBits,y.memLevel,y.strategy);if(b!==p)throw new Error(c[b]);if(y.header&&i.deflateSetHeader(this.strm,y.header),y.dictionary){var w;if(w=typeof y.dictionary=="string"?l.string2buf(y.dictionary):u.call(y.dictionary)==="[object ArrayBuffer]"?new Uint8Array(y.dictionary):y.dictionary,(b=i.deflateSetDictionary(this.strm,w))!==p)throw new Error(c[b]);this._dict_set=!0}}function v(x,y){var b=new g(y);if(b.push(x,!0),b.err)throw b.msg||c[b.err];return b.result}g.prototype.push=function(x,y){var b,w,j=this.strm,_=this.options.chunkSize;if(this.ended)return!1;w=y===~~y?y:y===!0?4:0,typeof x=="string"?j.input=l.string2buf(x):u.call(x)==="[object ArrayBuffer]"?j.input=new Uint8Array(x):j.input=x,j.next_in=0,j.avail_in=j.input.length;do{if(j.avail_out===0&&(j.output=new a.Buf8(_),j.next_out=0,j.avail_out=_),(b=i.deflate(j,w))!==1&&b!==p)return this.onEnd(b),!(this.ended=!0);j.avail_out!==0&&(j.avail_in!==0||w!==4&&w!==2)||(this.options.to==="string"?this.onData(l.buf2binstring(a.shrinkBuf(j.output,j.next_out))):this.onData(a.shrinkBuf(j.output,j.next_out)))}while((0<j.avail_in||j.avail_out===0)&&b!==1);return w===4?(b=i.deflateEnd(this.strm),this.onEnd(b),this.ended=!0,b===p):w!==2||(this.onEnd(p),!(j.avail_out=0))},g.prototype.onData=function(x){this.chunks.push(x)},g.prototype.onEnd=function(x){x===p&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=x,this.msg=this.strm.msg},s.Deflate=g,s.deflate=v,s.deflateRaw=function(x,y){return(y=y||{}).raw=!0,v(x,y)},s.gzip=function(x,y){return(y=y||{}).gzip=!0,v(x,y)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,s){var i=n("./zlib/inflate"),a=n("./utils/common"),l=n("./utils/strings"),c=n("./zlib/constants"),d=n("./zlib/messages"),u=n("./zlib/zstream"),p=n("./zlib/gzheader"),h=Object.prototype.toString;function f(g){if(!(this instanceof f))return new f(g);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},g||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||g&&g.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&!(15&v.windowBits)&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var x=i.inflateInit2(this.strm,v.windowBits);if(x!==c.Z_OK)throw new Error(d[x]);this.header=new p,i.inflateGetHeader(this.strm,this.header)}function m(g,v){var x=new f(v);if(x.push(g,!0),x.err)throw x.msg||d[x.err];return x.result}f.prototype.push=function(g,v){var x,y,b,w,j,_,S=this.strm,E=this.options.chunkSize,T=this.options.dictionary,M=!1;if(this.ended)return!1;y=v===~~v?v:v===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof g=="string"?S.input=l.binstring2buf(g):h.call(g)==="[object ArrayBuffer]"?S.input=new Uint8Array(g):S.input=g,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new a.Buf8(E),S.next_out=0,S.avail_out=E),(x=i.inflate(S,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&T&&(_=typeof T=="string"?l.string2buf(T):h.call(T)==="[object ArrayBuffer]"?new Uint8Array(T):T,x=i.inflateSetDictionary(this.strm,_)),x===c.Z_BUF_ERROR&&M===!0&&(x=c.Z_OK,M=!1),x!==c.Z_STREAM_END&&x!==c.Z_OK)return this.onEnd(x),!(this.ended=!0);S.next_out&&(S.avail_out!==0&&x!==c.Z_STREAM_END&&(S.avail_in!==0||y!==c.Z_FINISH&&y!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(b=l.utf8border(S.output,S.next_out),w=S.next_out-b,j=l.buf2string(S.output,b),S.next_out=w,S.avail_out=E-w,w&&a.arraySet(S.output,S.output,b,w,0),this.onData(j)):this.onData(a.shrinkBuf(S.output,S.next_out)))),S.avail_in===0&&S.avail_out===0&&(M=!0)}while((0<S.avail_in||S.avail_out===0)&&x!==c.Z_STREAM_END);return x===c.Z_STREAM_END&&(y=c.Z_FINISH),y===c.Z_FINISH?(x=i.inflateEnd(this.strm),this.onEnd(x),this.ended=!0,x===c.Z_OK):y!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(S.avail_out=0))},f.prototype.onData=function(g){this.chunks.push(g)},f.prototype.onEnd=function(g){g===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},s.Inflate=f,s.inflate=m,s.inflateRaw=function(g,v){return(v=v||{}).raw=!0,m(g,v)},s.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,s){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";s.assign=function(c){for(var d=Array.prototype.slice.call(arguments,1);d.length;){var u=d.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var p in u)u.hasOwnProperty(p)&&(c[p]=u[p])}}return c},s.shrinkBuf=function(c,d){return c.length===d?c:c.subarray?c.subarray(0,d):(c.length=d,c)};var a={arraySet:function(c,d,u,p,h){if(d.subarray&&c.subarray)c.set(d.subarray(u,u+p),h);else for(var f=0;f<p;f++)c[h+f]=d[u+f]},flattenChunks:function(c){var d,u,p,h,f,m;for(d=p=0,u=c.length;d<u;d++)p+=c[d].length;for(m=new Uint8Array(p),d=h=0,u=c.length;d<u;d++)f=c[d],m.set(f,h),h+=f.length;return m}},l={arraySet:function(c,d,u,p,h){for(var f=0;f<p;f++)c[h+f]=d[u+f]},flattenChunks:function(c){return[].concat.apply([],c)}};s.setTyped=function(c){c?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,a)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,l))},s.setTyped(i)},{}],42:[function(n,r,s){var i=n("./common"),a=!0,l=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{l=!1}for(var c=new i.Buf8(256),d=0;d<256;d++)c[d]=252<=d?6:248<=d?5:240<=d?4:224<=d?3:192<=d?2:1;function u(p,h){if(h<65537&&(p.subarray&&l||!p.subarray&&a))return String.fromCharCode.apply(null,i.shrinkBuf(p,h));for(var f="",m=0;m<h;m++)f+=String.fromCharCode(p[m]);return f}c[254]=c[254]=1,s.string2buf=function(p){var h,f,m,g,v,x=p.length,y=0;for(g=0;g<x;g++)(64512&(f=p.charCodeAt(g)))==55296&&g+1<x&&(64512&(m=p.charCodeAt(g+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),g++),y+=f<128?1:f<2048?2:f<65536?3:4;for(h=new i.Buf8(y),g=v=0;v<y;g++)(64512&(f=p.charCodeAt(g)))==55296&&g+1<x&&(64512&(m=p.charCodeAt(g+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),g++),f<128?h[v++]=f:(f<2048?h[v++]=192|f>>>6:(f<65536?h[v++]=224|f>>>12:(h[v++]=240|f>>>18,h[v++]=128|f>>>12&63),h[v++]=128|f>>>6&63),h[v++]=128|63&f);return h},s.buf2binstring=function(p){return u(p,p.length)},s.binstring2buf=function(p){for(var h=new i.Buf8(p.length),f=0,m=h.length;f<m;f++)h[f]=p.charCodeAt(f);return h},s.buf2string=function(p,h){var f,m,g,v,x=h||p.length,y=new Array(2*x);for(f=m=0;f<x;)if((g=p[f++])<128)y[m++]=g;else if(4<(v=c[g]))y[m++]=65533,f+=v-1;else{for(g&=v===2?31:v===3?15:7;1<v&&f<x;)g=g<<6|63&p[f++],v--;1<v?y[m++]=65533:g<65536?y[m++]=g:(g-=65536,y[m++]=55296|g>>10&1023,y[m++]=56320|1023&g)}return u(y,m)},s.utf8border=function(p,h){var f;for((h=h||p.length)>p.length&&(h=p.length),f=h-1;0<=f&&(192&p[f])==128;)f--;return f<0||f===0?h:f+c[p[f]]>h?f:h}},{"./common":41}],43:[function(n,r,s){r.exports=function(i,a,l,c){for(var d=65535&i|0,u=i>>>16&65535|0,p=0;l!==0;){for(l-=p=2e3<l?2e3:l;u=u+(d=d+a[c++]|0)|0,--p;);d%=65521,u%=65521}return d|u<<16|0}},{}],44:[function(n,r,s){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,s){var i=function(){for(var a,l=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;l[c]=a}return l}();r.exports=function(a,l,c,d){var u=i,p=d+c;a^=-1;for(var h=d;h<p;h++)a=a>>>8^u[255&(a^l[h])];return-1^a}},{}],46:[function(n,r,s){var i,a=n("../utils/common"),l=n("./trees"),c=n("./adler32"),d=n("./crc32"),u=n("./messages"),p=0,h=4,f=0,m=-2,g=-1,v=4,x=2,y=8,b=9,w=286,j=30,_=19,S=2*w+1,E=15,T=3,M=258,Z=M+T+1,N=42,G=113,C=1,F=2,pe=3,V=4;function J(k,Q){return k.msg=u[Q],Q}function I(k){return(k<<1)-(4<k?9:0)}function K(k){for(var Q=k.length;0<=--Q;)k[Q]=0}function z(k){var Q=k.state,oe=Q.pending;oe>k.avail_out&&(oe=k.avail_out),oe!==0&&(a.arraySet(k.output,Q.pending_buf,Q.pending_out,oe,k.next_out),k.next_out+=oe,Q.pending_out+=oe,k.total_out+=oe,k.avail_out-=oe,Q.pending-=oe,Q.pending===0&&(Q.pending_out=0))}function W(k,Q){l._tr_flush_block(k,0<=k.block_start?k.block_start:-1,k.strstart-k.block_start,Q),k.block_start=k.strstart,z(k.strm)}function fe(k,Q){k.pending_buf[k.pending++]=Q}function ue(k,Q){k.pending_buf[k.pending++]=Q>>>8&255,k.pending_buf[k.pending++]=255&Q}function ne(k,Q){var oe,D,P=k.max_chain_length,$=k.strstart,Y=k.prev_length,se=k.nice_match,B=k.strstart>k.w_size-Z?k.strstart-(k.w_size-Z):0,re=k.window,ye=k.w_mask,le=k.prev,U=k.strstart+M,ae=re[$+Y-1],xe=re[$+Y];k.prev_length>=k.good_match&&(P>>=2),se>k.lookahead&&(se=k.lookahead);do if(re[(oe=Q)+Y]===xe&&re[oe+Y-1]===ae&&re[oe]===re[$]&&re[++oe]===re[$+1]){$+=2,oe++;do;while(re[++$]===re[++oe]&&re[++$]===re[++oe]&&re[++$]===re[++oe]&&re[++$]===re[++oe]&&re[++$]===re[++oe]&&re[++$]===re[++oe]&&re[++$]===re[++oe]&&re[++$]===re[++oe]&&$<U);if(D=M-(U-$),$=U-M,Y<D){if(k.match_start=Q,se<=(Y=D))break;ae=re[$+Y-1],xe=re[$+Y]}}while((Q=le[Q&ye])>B&&--P!=0);return Y<=k.lookahead?Y:k.lookahead}function ke(k){var Q,oe,D,P,$,Y,se,B,re,ye,le=k.w_size;do{if(P=k.window_size-k.lookahead-k.strstart,k.strstart>=le+(le-Z)){for(a.arraySet(k.window,k.window,le,le,0),k.match_start-=le,k.strstart-=le,k.block_start-=le,Q=oe=k.hash_size;D=k.head[--Q],k.head[Q]=le<=D?D-le:0,--oe;);for(Q=oe=le;D=k.prev[--Q],k.prev[Q]=le<=D?D-le:0,--oe;);P+=le}if(k.strm.avail_in===0)break;if(Y=k.strm,se=k.window,B=k.strstart+k.lookahead,re=P,ye=void 0,ye=Y.avail_in,re<ye&&(ye=re),oe=ye===0?0:(Y.avail_in-=ye,a.arraySet(se,Y.input,Y.next_in,ye,B),Y.state.wrap===1?Y.adler=c(Y.adler,se,ye,B):Y.state.wrap===2&&(Y.adler=d(Y.adler,se,ye,B)),Y.next_in+=ye,Y.total_in+=ye,ye),k.lookahead+=oe,k.lookahead+k.insert>=T)for($=k.strstart-k.insert,k.ins_h=k.window[$],k.ins_h=(k.ins_h<<k.hash_shift^k.window[$+1])&k.hash_mask;k.insert&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[$+T-1])&k.hash_mask,k.prev[$&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=$,$++,k.insert--,!(k.lookahead+k.insert<T)););}while(k.lookahead<Z&&k.strm.avail_in!==0)}function ce(k,Q){for(var oe,D;;){if(k.lookahead<Z){if(ke(k),k.lookahead<Z&&Q===p)return C;if(k.lookahead===0)break}if(oe=0,k.lookahead>=T&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+T-1])&k.hash_mask,oe=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),oe!==0&&k.strstart-oe<=k.w_size-Z&&(k.match_length=ne(k,oe)),k.match_length>=T)if(D=l._tr_tally(k,k.strstart-k.match_start,k.match_length-T),k.lookahead-=k.match_length,k.match_length<=k.max_lazy_match&&k.lookahead>=T){for(k.match_length--;k.strstart++,k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+T-1])&k.hash_mask,oe=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart,--k.match_length!=0;);k.strstart++}else k.strstart+=k.match_length,k.match_length=0,k.ins_h=k.window[k.strstart],k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+1])&k.hash_mask;else D=l._tr_tally(k,0,k.window[k.strstart]),k.lookahead--,k.strstart++;if(D&&(W(k,!1),k.strm.avail_out===0))return C}return k.insert=k.strstart<T-1?k.strstart:T-1,Q===h?(W(k,!0),k.strm.avail_out===0?pe:V):k.last_lit&&(W(k,!1),k.strm.avail_out===0)?C:F}function $e(k,Q){for(var oe,D,P;;){if(k.lookahead<Z){if(ke(k),k.lookahead<Z&&Q===p)return C;if(k.lookahead===0)break}if(oe=0,k.lookahead>=T&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+T-1])&k.hash_mask,oe=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),k.prev_length=k.match_length,k.prev_match=k.match_start,k.match_length=T-1,oe!==0&&k.prev_length<k.max_lazy_match&&k.strstart-oe<=k.w_size-Z&&(k.match_length=ne(k,oe),k.match_length<=5&&(k.strategy===1||k.match_length===T&&4096<k.strstart-k.match_start)&&(k.match_length=T-1)),k.prev_length>=T&&k.match_length<=k.prev_length){for(P=k.strstart+k.lookahead-T,D=l._tr_tally(k,k.strstart-1-k.prev_match,k.prev_length-T),k.lookahead-=k.prev_length-1,k.prev_length-=2;++k.strstart<=P&&(k.ins_h=(k.ins_h<<k.hash_shift^k.window[k.strstart+T-1])&k.hash_mask,oe=k.prev[k.strstart&k.w_mask]=k.head[k.ins_h],k.head[k.ins_h]=k.strstart),--k.prev_length!=0;);if(k.match_available=0,k.match_length=T-1,k.strstart++,D&&(W(k,!1),k.strm.avail_out===0))return C}else if(k.match_available){if((D=l._tr_tally(k,0,k.window[k.strstart-1]))&&W(k,!1),k.strstart++,k.lookahead--,k.strm.avail_out===0)return C}else k.match_available=1,k.strstart++,k.lookahead--}return k.match_available&&(D=l._tr_tally(k,0,k.window[k.strstart-1]),k.match_available=0),k.insert=k.strstart<T-1?k.strstart:T-1,Q===h?(W(k,!0),k.strm.avail_out===0?pe:V):k.last_lit&&(W(k,!1),k.strm.avail_out===0)?C:F}function ze(k,Q,oe,D,P){this.good_length=k,this.max_lazy=Q,this.nice_length=oe,this.max_chain=D,this.func=P}function Ue(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*S),this.dyn_dtree=new a.Buf16(2*(2*j+1)),this.bl_tree=new a.Buf16(2*(2*_+1)),K(this.dyn_ltree),K(this.dyn_dtree),K(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(E+1),this.heap=new a.Buf16(2*w+1),K(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*w+1),K(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ge(k){var Q;return k&&k.state?(k.total_in=k.total_out=0,k.data_type=x,(Q=k.state).pending=0,Q.pending_out=0,Q.wrap<0&&(Q.wrap=-Q.wrap),Q.status=Q.wrap?N:G,k.adler=Q.wrap===2?0:1,Q.last_flush=p,l._tr_init(Q),f):J(k,m)}function at(k){var Q=Ge(k);return Q===f&&function(oe){oe.window_size=2*oe.w_size,K(oe.head),oe.max_lazy_match=i[oe.level].max_lazy,oe.good_match=i[oe.level].good_length,oe.nice_match=i[oe.level].nice_length,oe.max_chain_length=i[oe.level].max_chain,oe.strstart=0,oe.block_start=0,oe.lookahead=0,oe.insert=0,oe.match_length=oe.prev_length=T-1,oe.match_available=0,oe.ins_h=0}(k.state),Q}function Ve(k,Q,oe,D,P,$){if(!k)return m;var Y=1;if(Q===g&&(Q=6),D<0?(Y=0,D=-D):15<D&&(Y=2,D-=16),P<1||b<P||oe!==y||D<8||15<D||Q<0||9<Q||$<0||v<$)return J(k,m);D===8&&(D=9);var se=new Ue;return(k.state=se).strm=k,se.wrap=Y,se.gzhead=null,se.w_bits=D,se.w_size=1<<se.w_bits,se.w_mask=se.w_size-1,se.hash_bits=P+7,se.hash_size=1<<se.hash_bits,se.hash_mask=se.hash_size-1,se.hash_shift=~~((se.hash_bits+T-1)/T),se.window=new a.Buf8(2*se.w_size),se.head=new a.Buf16(se.hash_size),se.prev=new a.Buf16(se.w_size),se.lit_bufsize=1<<P+6,se.pending_buf_size=4*se.lit_bufsize,se.pending_buf=new a.Buf8(se.pending_buf_size),se.d_buf=1*se.lit_bufsize,se.l_buf=3*se.lit_bufsize,se.level=Q,se.strategy=$,se.method=oe,at(k)}i=[new ze(0,0,0,0,function(k,Q){var oe=65535;for(oe>k.pending_buf_size-5&&(oe=k.pending_buf_size-5);;){if(k.lookahead<=1){if(ke(k),k.lookahead===0&&Q===p)return C;if(k.lookahead===0)break}k.strstart+=k.lookahead,k.lookahead=0;var D=k.block_start+oe;if((k.strstart===0||k.strstart>=D)&&(k.lookahead=k.strstart-D,k.strstart=D,W(k,!1),k.strm.avail_out===0)||k.strstart-k.block_start>=k.w_size-Z&&(W(k,!1),k.strm.avail_out===0))return C}return k.insert=0,Q===h?(W(k,!0),k.strm.avail_out===0?pe:V):(k.strstart>k.block_start&&(W(k,!1),k.strm.avail_out),C)}),new ze(4,4,8,4,ce),new ze(4,5,16,8,ce),new ze(4,6,32,32,ce),new ze(4,4,16,16,$e),new ze(8,16,32,32,$e),new ze(8,16,128,128,$e),new ze(8,32,128,256,$e),new ze(32,128,258,1024,$e),new ze(32,258,258,4096,$e)],s.deflateInit=function(k,Q){return Ve(k,Q,y,15,8,0)},s.deflateInit2=Ve,s.deflateReset=at,s.deflateResetKeep=Ge,s.deflateSetHeader=function(k,Q){return k&&k.state?k.state.wrap!==2?m:(k.state.gzhead=Q,f):m},s.deflate=function(k,Q){var oe,D,P,$;if(!k||!k.state||5<Q||Q<0)return k?J(k,m):m;if(D=k.state,!k.output||!k.input&&k.avail_in!==0||D.status===666&&Q!==h)return J(k,k.avail_out===0?-5:m);if(D.strm=k,oe=D.last_flush,D.last_flush=Q,D.status===N)if(D.wrap===2)k.adler=0,fe(D,31),fe(D,139),fe(D,8),D.gzhead?(fe(D,(D.gzhead.text?1:0)+(D.gzhead.hcrc?2:0)+(D.gzhead.extra?4:0)+(D.gzhead.name?8:0)+(D.gzhead.comment?16:0)),fe(D,255&D.gzhead.time),fe(D,D.gzhead.time>>8&255),fe(D,D.gzhead.time>>16&255),fe(D,D.gzhead.time>>24&255),fe(D,D.level===9?2:2<=D.strategy||D.level<2?4:0),fe(D,255&D.gzhead.os),D.gzhead.extra&&D.gzhead.extra.length&&(fe(D,255&D.gzhead.extra.length),fe(D,D.gzhead.extra.length>>8&255)),D.gzhead.hcrc&&(k.adler=d(k.adler,D.pending_buf,D.pending,0)),D.gzindex=0,D.status=69):(fe(D,0),fe(D,0),fe(D,0),fe(D,0),fe(D,0),fe(D,D.level===9?2:2<=D.strategy||D.level<2?4:0),fe(D,3),D.status=G);else{var Y=y+(D.w_bits-8<<4)<<8;Y|=(2<=D.strategy||D.level<2?0:D.level<6?1:D.level===6?2:3)<<6,D.strstart!==0&&(Y|=32),Y+=31-Y%31,D.status=G,ue(D,Y),D.strstart!==0&&(ue(D,k.adler>>>16),ue(D,65535&k.adler)),k.adler=1}if(D.status===69)if(D.gzhead.extra){for(P=D.pending;D.gzindex<(65535&D.gzhead.extra.length)&&(D.pending!==D.pending_buf_size||(D.gzhead.hcrc&&D.pending>P&&(k.adler=d(k.adler,D.pending_buf,D.pending-P,P)),z(k),P=D.pending,D.pending!==D.pending_buf_size));)fe(D,255&D.gzhead.extra[D.gzindex]),D.gzindex++;D.gzhead.hcrc&&D.pending>P&&(k.adler=d(k.adler,D.pending_buf,D.pending-P,P)),D.gzindex===D.gzhead.extra.length&&(D.gzindex=0,D.status=73)}else D.status=73;if(D.status===73)if(D.gzhead.name){P=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>P&&(k.adler=d(k.adler,D.pending_buf,D.pending-P,P)),z(k),P=D.pending,D.pending===D.pending_buf_size)){$=1;break}$=D.gzindex<D.gzhead.name.length?255&D.gzhead.name.charCodeAt(D.gzindex++):0,fe(D,$)}while($!==0);D.gzhead.hcrc&&D.pending>P&&(k.adler=d(k.adler,D.pending_buf,D.pending-P,P)),$===0&&(D.gzindex=0,D.status=91)}else D.status=91;if(D.status===91)if(D.gzhead.comment){P=D.pending;do{if(D.pending===D.pending_buf_size&&(D.gzhead.hcrc&&D.pending>P&&(k.adler=d(k.adler,D.pending_buf,D.pending-P,P)),z(k),P=D.pending,D.pending===D.pending_buf_size)){$=1;break}$=D.gzindex<D.gzhead.comment.length?255&D.gzhead.comment.charCodeAt(D.gzindex++):0,fe(D,$)}while($!==0);D.gzhead.hcrc&&D.pending>P&&(k.adler=d(k.adler,D.pending_buf,D.pending-P,P)),$===0&&(D.status=103)}else D.status=103;if(D.status===103&&(D.gzhead.hcrc?(D.pending+2>D.pending_buf_size&&z(k),D.pending+2<=D.pending_buf_size&&(fe(D,255&k.adler),fe(D,k.adler>>8&255),k.adler=0,D.status=G)):D.status=G),D.pending!==0){if(z(k),k.avail_out===0)return D.last_flush=-1,f}else if(k.avail_in===0&&I(Q)<=I(oe)&&Q!==h)return J(k,-5);if(D.status===666&&k.avail_in!==0)return J(k,-5);if(k.avail_in!==0||D.lookahead!==0||Q!==p&&D.status!==666){var se=D.strategy===2?function(B,re){for(var ye;;){if(B.lookahead===0&&(ke(B),B.lookahead===0)){if(re===p)return C;break}if(B.match_length=0,ye=l._tr_tally(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++,ye&&(W(B,!1),B.strm.avail_out===0))return C}return B.insert=0,re===h?(W(B,!0),B.strm.avail_out===0?pe:V):B.last_lit&&(W(B,!1),B.strm.avail_out===0)?C:F}(D,Q):D.strategy===3?function(B,re){for(var ye,le,U,ae,xe=B.window;;){if(B.lookahead<=M){if(ke(B),B.lookahead<=M&&re===p)return C;if(B.lookahead===0)break}if(B.match_length=0,B.lookahead>=T&&0<B.strstart&&(le=xe[U=B.strstart-1])===xe[++U]&&le===xe[++U]&&le===xe[++U]){ae=B.strstart+M;do;while(le===xe[++U]&&le===xe[++U]&&le===xe[++U]&&le===xe[++U]&&le===xe[++U]&&le===xe[++U]&&le===xe[++U]&&le===xe[++U]&&U<ae);B.match_length=M-(ae-U),B.match_length>B.lookahead&&(B.match_length=B.lookahead)}if(B.match_length>=T?(ye=l._tr_tally(B,1,B.match_length-T),B.lookahead-=B.match_length,B.strstart+=B.match_length,B.match_length=0):(ye=l._tr_tally(B,0,B.window[B.strstart]),B.lookahead--,B.strstart++),ye&&(W(B,!1),B.strm.avail_out===0))return C}return B.insert=0,re===h?(W(B,!0),B.strm.avail_out===0?pe:V):B.last_lit&&(W(B,!1),B.strm.avail_out===0)?C:F}(D,Q):i[D.level].func(D,Q);if(se!==pe&&se!==V||(D.status=666),se===C||se===pe)return k.avail_out===0&&(D.last_flush=-1),f;if(se===F&&(Q===1?l._tr_align(D):Q!==5&&(l._tr_stored_block(D,0,0,!1),Q===3&&(K(D.head),D.lookahead===0&&(D.strstart=0,D.block_start=0,D.insert=0))),z(k),k.avail_out===0))return D.last_flush=-1,f}return Q!==h?f:D.wrap<=0?1:(D.wrap===2?(fe(D,255&k.adler),fe(D,k.adler>>8&255),fe(D,k.adler>>16&255),fe(D,k.adler>>24&255),fe(D,255&k.total_in),fe(D,k.total_in>>8&255),fe(D,k.total_in>>16&255),fe(D,k.total_in>>24&255)):(ue(D,k.adler>>>16),ue(D,65535&k.adler)),z(k),0<D.wrap&&(D.wrap=-D.wrap),D.pending!==0?f:1)},s.deflateEnd=function(k){var Q;return k&&k.state?(Q=k.state.status)!==N&&Q!==69&&Q!==73&&Q!==91&&Q!==103&&Q!==G&&Q!==666?J(k,m):(k.state=null,Q===G?J(k,-3):f):m},s.deflateSetDictionary=function(k,Q){var oe,D,P,$,Y,se,B,re,ye=Q.length;if(!k||!k.state||($=(oe=k.state).wrap)===2||$===1&&oe.status!==N||oe.lookahead)return m;for($===1&&(k.adler=c(k.adler,Q,ye,0)),oe.wrap=0,ye>=oe.w_size&&($===0&&(K(oe.head),oe.strstart=0,oe.block_start=0,oe.insert=0),re=new a.Buf8(oe.w_size),a.arraySet(re,Q,ye-oe.w_size,oe.w_size,0),Q=re,ye=oe.w_size),Y=k.avail_in,se=k.next_in,B=k.input,k.avail_in=ye,k.next_in=0,k.input=Q,ke(oe);oe.lookahead>=T;){for(D=oe.strstart,P=oe.lookahead-(T-1);oe.ins_h=(oe.ins_h<<oe.hash_shift^oe.window[D+T-1])&oe.hash_mask,oe.prev[D&oe.w_mask]=oe.head[oe.ins_h],oe.head[oe.ins_h]=D,D++,--P;);oe.strstart=D,oe.lookahead=T-1,ke(oe)}return oe.strstart+=oe.lookahead,oe.block_start=oe.strstart,oe.insert=oe.lookahead,oe.lookahead=0,oe.match_length=oe.prev_length=T-1,oe.match_available=0,k.next_in=se,k.input=B,k.avail_in=Y,oe.wrap=$,f},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,s){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,s){r.exports=function(i,a){var l,c,d,u,p,h,f,m,g,v,x,y,b,w,j,_,S,E,T,M,Z,N,G,C,F;l=i.state,c=i.next_in,C=i.input,d=c+(i.avail_in-5),u=i.next_out,F=i.output,p=u-(a-i.avail_out),h=u+(i.avail_out-257),f=l.dmax,m=l.wsize,g=l.whave,v=l.wnext,x=l.window,y=l.hold,b=l.bits,w=l.lencode,j=l.distcode,_=(1<<l.lenbits)-1,S=(1<<l.distbits)-1;e:do{b<15&&(y+=C[c++]<<b,b+=8,y+=C[c++]<<b,b+=8),E=w[y&_];t:for(;;){if(y>>>=T=E>>>24,b-=T,(T=E>>>16&255)===0)F[u++]=65535&E;else{if(!(16&T)){if(!(64&T)){E=w[(65535&E)+(y&(1<<T)-1)];continue t}if(32&T){l.mode=12;break e}i.msg="invalid literal/length code",l.mode=30;break e}M=65535&E,(T&=15)&&(b<T&&(y+=C[c++]<<b,b+=8),M+=y&(1<<T)-1,y>>>=T,b-=T),b<15&&(y+=C[c++]<<b,b+=8,y+=C[c++]<<b,b+=8),E=j[y&S];n:for(;;){if(y>>>=T=E>>>24,b-=T,!(16&(T=E>>>16&255))){if(!(64&T)){E=j[(65535&E)+(y&(1<<T)-1)];continue n}i.msg="invalid distance code",l.mode=30;break e}if(Z=65535&E,b<(T&=15)&&(y+=C[c++]<<b,(b+=8)<T&&(y+=C[c++]<<b,b+=8)),f<(Z+=y&(1<<T)-1)){i.msg="invalid distance too far back",l.mode=30;break e}if(y>>>=T,b-=T,(T=u-p)<Z){if(g<(T=Z-T)&&l.sane){i.msg="invalid distance too far back",l.mode=30;break e}if(G=x,(N=0)===v){if(N+=m-T,T<M){for(M-=T;F[u++]=x[N++],--T;);N=u-Z,G=F}}else if(v<T){if(N+=m+v-T,(T-=v)<M){for(M-=T;F[u++]=x[N++],--T;);if(N=0,v<M){for(M-=T=v;F[u++]=x[N++],--T;);N=u-Z,G=F}}}else if(N+=v-T,T<M){for(M-=T;F[u++]=x[N++],--T;);N=u-Z,G=F}for(;2<M;)F[u++]=G[N++],F[u++]=G[N++],F[u++]=G[N++],M-=3;M&&(F[u++]=G[N++],1<M&&(F[u++]=G[N++]))}else{for(N=u-Z;F[u++]=F[N++],F[u++]=F[N++],F[u++]=F[N++],2<(M-=3););M&&(F[u++]=F[N++],1<M&&(F[u++]=F[N++]))}break}}break}}while(c<d&&u<h);c-=M=b>>3,y&=(1<<(b-=M<<3))-1,i.next_in=c,i.next_out=u,i.avail_in=c<d?d-c+5:5-(c-d),i.avail_out=u<h?h-u+257:257-(u-h),l.hold=y,l.bits=b}},{}],49:[function(n,r,s){var i=n("../utils/common"),a=n("./adler32"),l=n("./crc32"),c=n("./inffast"),d=n("./inftrees"),u=1,p=2,h=0,f=-2,m=1,g=852,v=592;function x(N){return(N>>>24&255)+(N>>>8&65280)+((65280&N)<<8)+((255&N)<<24)}function y(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function b(N){var G;return N&&N.state?(G=N.state,N.total_in=N.total_out=G.total=0,N.msg="",G.wrap&&(N.adler=1&G.wrap),G.mode=m,G.last=0,G.havedict=0,G.dmax=32768,G.head=null,G.hold=0,G.bits=0,G.lencode=G.lendyn=new i.Buf32(g),G.distcode=G.distdyn=new i.Buf32(v),G.sane=1,G.back=-1,h):f}function w(N){var G;return N&&N.state?((G=N.state).wsize=0,G.whave=0,G.wnext=0,b(N)):f}function j(N,G){var C,F;return N&&N.state?(F=N.state,G<0?(C=0,G=-G):(C=1+(G>>4),G<48&&(G&=15)),G&&(G<8||15<G)?f:(F.window!==null&&F.wbits!==G&&(F.window=null),F.wrap=C,F.wbits=G,w(N))):f}function _(N,G){var C,F;return N?(F=new y,(N.state=F).window=null,(C=j(N,G))!==h&&(N.state=null),C):f}var S,E,T=!0;function M(N){if(T){var G;for(S=new i.Buf32(512),E=new i.Buf32(32),G=0;G<144;)N.lens[G++]=8;for(;G<256;)N.lens[G++]=9;for(;G<280;)N.lens[G++]=7;for(;G<288;)N.lens[G++]=8;for(d(u,N.lens,0,288,S,0,N.work,{bits:9}),G=0;G<32;)N.lens[G++]=5;d(p,N.lens,0,32,E,0,N.work,{bits:5}),T=!1}N.lencode=S,N.lenbits=9,N.distcode=E,N.distbits=5}function Z(N,G,C,F){var pe,V=N.state;return V.window===null&&(V.wsize=1<<V.wbits,V.wnext=0,V.whave=0,V.window=new i.Buf8(V.wsize)),F>=V.wsize?(i.arraySet(V.window,G,C-V.wsize,V.wsize,0),V.wnext=0,V.whave=V.wsize):(F<(pe=V.wsize-V.wnext)&&(pe=F),i.arraySet(V.window,G,C-F,pe,V.wnext),(F-=pe)?(i.arraySet(V.window,G,C-F,F,0),V.wnext=F,V.whave=V.wsize):(V.wnext+=pe,V.wnext===V.wsize&&(V.wnext=0),V.whave<V.wsize&&(V.whave+=pe))),0}s.inflateReset=w,s.inflateReset2=j,s.inflateResetKeep=b,s.inflateInit=function(N){return _(N,15)},s.inflateInit2=_,s.inflate=function(N,G){var C,F,pe,V,J,I,K,z,W,fe,ue,ne,ke,ce,$e,ze,Ue,Ge,at,Ve,k,Q,oe,D,P=0,$=new i.Buf8(4),Y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!N||!N.state||!N.output||!N.input&&N.avail_in!==0)return f;(C=N.state).mode===12&&(C.mode=13),J=N.next_out,pe=N.output,K=N.avail_out,V=N.next_in,F=N.input,I=N.avail_in,z=C.hold,W=C.bits,fe=I,ue=K,Q=h;e:for(;;)switch(C.mode){case m:if(C.wrap===0){C.mode=13;break}for(;W<16;){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}if(2&C.wrap&&z===35615){$[C.check=0]=255&z,$[1]=z>>>8&255,C.check=l(C.check,$,2,0),W=z=0,C.mode=2;break}if(C.flags=0,C.head&&(C.head.done=!1),!(1&C.wrap)||(((255&z)<<8)+(z>>8))%31){N.msg="incorrect header check",C.mode=30;break}if((15&z)!=8){N.msg="unknown compression method",C.mode=30;break}if(W-=4,k=8+(15&(z>>>=4)),C.wbits===0)C.wbits=k;else if(k>C.wbits){N.msg="invalid window size",C.mode=30;break}C.dmax=1<<k,N.adler=C.check=1,C.mode=512&z?10:12,W=z=0;break;case 2:for(;W<16;){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}if(C.flags=z,(255&C.flags)!=8){N.msg="unknown compression method",C.mode=30;break}if(57344&C.flags){N.msg="unknown header flags set",C.mode=30;break}C.head&&(C.head.text=z>>8&1),512&C.flags&&($[0]=255&z,$[1]=z>>>8&255,C.check=l(C.check,$,2,0)),W=z=0,C.mode=3;case 3:for(;W<32;){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}C.head&&(C.head.time=z),512&C.flags&&($[0]=255&z,$[1]=z>>>8&255,$[2]=z>>>16&255,$[3]=z>>>24&255,C.check=l(C.check,$,4,0)),W=z=0,C.mode=4;case 4:for(;W<16;){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}C.head&&(C.head.xflags=255&z,C.head.os=z>>8),512&C.flags&&($[0]=255&z,$[1]=z>>>8&255,C.check=l(C.check,$,2,0)),W=z=0,C.mode=5;case 5:if(1024&C.flags){for(;W<16;){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}C.length=z,C.head&&(C.head.extra_len=z),512&C.flags&&($[0]=255&z,$[1]=z>>>8&255,C.check=l(C.check,$,2,0)),W=z=0}else C.head&&(C.head.extra=null);C.mode=6;case 6:if(1024&C.flags&&(I<(ne=C.length)&&(ne=I),ne&&(C.head&&(k=C.head.extra_len-C.length,C.head.extra||(C.head.extra=new Array(C.head.extra_len)),i.arraySet(C.head.extra,F,V,ne,k)),512&C.flags&&(C.check=l(C.check,F,ne,V)),I-=ne,V+=ne,C.length-=ne),C.length))break e;C.length=0,C.mode=7;case 7:if(2048&C.flags){if(I===0)break e;for(ne=0;k=F[V+ne++],C.head&&k&&C.length<65536&&(C.head.name+=String.fromCharCode(k)),k&&ne<I;);if(512&C.flags&&(C.check=l(C.check,F,ne,V)),I-=ne,V+=ne,k)break e}else C.head&&(C.head.name=null);C.length=0,C.mode=8;case 8:if(4096&C.flags){if(I===0)break e;for(ne=0;k=F[V+ne++],C.head&&k&&C.length<65536&&(C.head.comment+=String.fromCharCode(k)),k&&ne<I;);if(512&C.flags&&(C.check=l(C.check,F,ne,V)),I-=ne,V+=ne,k)break e}else C.head&&(C.head.comment=null);C.mode=9;case 9:if(512&C.flags){for(;W<16;){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}if(z!==(65535&C.check)){N.msg="header crc mismatch",C.mode=30;break}W=z=0}C.head&&(C.head.hcrc=C.flags>>9&1,C.head.done=!0),N.adler=C.check=0,C.mode=12;break;case 10:for(;W<32;){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}N.adler=C.check=x(z),W=z=0,C.mode=11;case 11:if(C.havedict===0)return N.next_out=J,N.avail_out=K,N.next_in=V,N.avail_in=I,C.hold=z,C.bits=W,2;N.adler=C.check=1,C.mode=12;case 12:if(G===5||G===6)break e;case 13:if(C.last){z>>>=7&W,W-=7&W,C.mode=27;break}for(;W<3;){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}switch(C.last=1&z,W-=1,3&(z>>>=1)){case 0:C.mode=14;break;case 1:if(M(C),C.mode=20,G!==6)break;z>>>=2,W-=2;break e;case 2:C.mode=17;break;case 3:N.msg="invalid block type",C.mode=30}z>>>=2,W-=2;break;case 14:for(z>>>=7&W,W-=7&W;W<32;){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}if((65535&z)!=(z>>>16^65535)){N.msg="invalid stored block lengths",C.mode=30;break}if(C.length=65535&z,W=z=0,C.mode=15,G===6)break e;case 15:C.mode=16;case 16:if(ne=C.length){if(I<ne&&(ne=I),K<ne&&(ne=K),ne===0)break e;i.arraySet(pe,F,V,ne,J),I-=ne,V+=ne,K-=ne,J+=ne,C.length-=ne;break}C.mode=12;break;case 17:for(;W<14;){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}if(C.nlen=257+(31&z),z>>>=5,W-=5,C.ndist=1+(31&z),z>>>=5,W-=5,C.ncode=4+(15&z),z>>>=4,W-=4,286<C.nlen||30<C.ndist){N.msg="too many length or distance symbols",C.mode=30;break}C.have=0,C.mode=18;case 18:for(;C.have<C.ncode;){for(;W<3;){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}C.lens[Y[C.have++]]=7&z,z>>>=3,W-=3}for(;C.have<19;)C.lens[Y[C.have++]]=0;if(C.lencode=C.lendyn,C.lenbits=7,oe={bits:C.lenbits},Q=d(0,C.lens,0,19,C.lencode,0,C.work,oe),C.lenbits=oe.bits,Q){N.msg="invalid code lengths set",C.mode=30;break}C.have=0,C.mode=19;case 19:for(;C.have<C.nlen+C.ndist;){for(;ze=(P=C.lencode[z&(1<<C.lenbits)-1])>>>16&255,Ue=65535&P,!(($e=P>>>24)<=W);){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}if(Ue<16)z>>>=$e,W-=$e,C.lens[C.have++]=Ue;else{if(Ue===16){for(D=$e+2;W<D;){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}if(z>>>=$e,W-=$e,C.have===0){N.msg="invalid bit length repeat",C.mode=30;break}k=C.lens[C.have-1],ne=3+(3&z),z>>>=2,W-=2}else if(Ue===17){for(D=$e+3;W<D;){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}W-=$e,k=0,ne=3+(7&(z>>>=$e)),z>>>=3,W-=3}else{for(D=$e+7;W<D;){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}W-=$e,k=0,ne=11+(127&(z>>>=$e)),z>>>=7,W-=7}if(C.have+ne>C.nlen+C.ndist){N.msg="invalid bit length repeat",C.mode=30;break}for(;ne--;)C.lens[C.have++]=k}}if(C.mode===30)break;if(C.lens[256]===0){N.msg="invalid code -- missing end-of-block",C.mode=30;break}if(C.lenbits=9,oe={bits:C.lenbits},Q=d(u,C.lens,0,C.nlen,C.lencode,0,C.work,oe),C.lenbits=oe.bits,Q){N.msg="invalid literal/lengths set",C.mode=30;break}if(C.distbits=6,C.distcode=C.distdyn,oe={bits:C.distbits},Q=d(p,C.lens,C.nlen,C.ndist,C.distcode,0,C.work,oe),C.distbits=oe.bits,Q){N.msg="invalid distances set",C.mode=30;break}if(C.mode=20,G===6)break e;case 20:C.mode=21;case 21:if(6<=I&&258<=K){N.next_out=J,N.avail_out=K,N.next_in=V,N.avail_in=I,C.hold=z,C.bits=W,c(N,ue),J=N.next_out,pe=N.output,K=N.avail_out,V=N.next_in,F=N.input,I=N.avail_in,z=C.hold,W=C.bits,C.mode===12&&(C.back=-1);break}for(C.back=0;ze=(P=C.lencode[z&(1<<C.lenbits)-1])>>>16&255,Ue=65535&P,!(($e=P>>>24)<=W);){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}if(ze&&!(240&ze)){for(Ge=$e,at=ze,Ve=Ue;ze=(P=C.lencode[Ve+((z&(1<<Ge+at)-1)>>Ge)])>>>16&255,Ue=65535&P,!(Ge+($e=P>>>24)<=W);){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}z>>>=Ge,W-=Ge,C.back+=Ge}if(z>>>=$e,W-=$e,C.back+=$e,C.length=Ue,ze===0){C.mode=26;break}if(32&ze){C.back=-1,C.mode=12;break}if(64&ze){N.msg="invalid literal/length code",C.mode=30;break}C.extra=15&ze,C.mode=22;case 22:if(C.extra){for(D=C.extra;W<D;){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}C.length+=z&(1<<C.extra)-1,z>>>=C.extra,W-=C.extra,C.back+=C.extra}C.was=C.length,C.mode=23;case 23:for(;ze=(P=C.distcode[z&(1<<C.distbits)-1])>>>16&255,Ue=65535&P,!(($e=P>>>24)<=W);){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}if(!(240&ze)){for(Ge=$e,at=ze,Ve=Ue;ze=(P=C.distcode[Ve+((z&(1<<Ge+at)-1)>>Ge)])>>>16&255,Ue=65535&P,!(Ge+($e=P>>>24)<=W);){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}z>>>=Ge,W-=Ge,C.back+=Ge}if(z>>>=$e,W-=$e,C.back+=$e,64&ze){N.msg="invalid distance code",C.mode=30;break}C.offset=Ue,C.extra=15&ze,C.mode=24;case 24:if(C.extra){for(D=C.extra;W<D;){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}C.offset+=z&(1<<C.extra)-1,z>>>=C.extra,W-=C.extra,C.back+=C.extra}if(C.offset>C.dmax){N.msg="invalid distance too far back",C.mode=30;break}C.mode=25;case 25:if(K===0)break e;if(ne=ue-K,C.offset>ne){if((ne=C.offset-ne)>C.whave&&C.sane){N.msg="invalid distance too far back",C.mode=30;break}ke=ne>C.wnext?(ne-=C.wnext,C.wsize-ne):C.wnext-ne,ne>C.length&&(ne=C.length),ce=C.window}else ce=pe,ke=J-C.offset,ne=C.length;for(K<ne&&(ne=K),K-=ne,C.length-=ne;pe[J++]=ce[ke++],--ne;);C.length===0&&(C.mode=21);break;case 26:if(K===0)break e;pe[J++]=C.length,K--,C.mode=21;break;case 27:if(C.wrap){for(;W<32;){if(I===0)break e;I--,z|=F[V++]<<W,W+=8}if(ue-=K,N.total_out+=ue,C.total+=ue,ue&&(N.adler=C.check=C.flags?l(C.check,pe,ue,J-ue):a(C.check,pe,ue,J-ue)),ue=K,(C.flags?z:x(z))!==C.check){N.msg="incorrect data check",C.mode=30;break}W=z=0}C.mode=28;case 28:if(C.wrap&&C.flags){for(;W<32;){if(I===0)break e;I--,z+=F[V++]<<W,W+=8}if(z!==(4294967295&C.total)){N.msg="incorrect length check",C.mode=30;break}W=z=0}C.mode=29;case 29:Q=1;break e;case 30:Q=-3;break e;case 31:return-4;case 32:default:return f}return N.next_out=J,N.avail_out=K,N.next_in=V,N.avail_in=I,C.hold=z,C.bits=W,(C.wsize||ue!==N.avail_out&&C.mode<30&&(C.mode<27||G!==4))&&Z(N,N.output,N.next_out,ue-N.avail_out)?(C.mode=31,-4):(fe-=N.avail_in,ue-=N.avail_out,N.total_in+=fe,N.total_out+=ue,C.total+=ue,C.wrap&&ue&&(N.adler=C.check=C.flags?l(C.check,pe,ue,N.next_out-ue):a(C.check,pe,ue,N.next_out-ue)),N.data_type=C.bits+(C.last?64:0)+(C.mode===12?128:0)+(C.mode===20||C.mode===15?256:0),(fe==0&&ue===0||G===4)&&Q===h&&(Q=-5),Q)},s.inflateEnd=function(N){if(!N||!N.state)return f;var G=N.state;return G.window&&(G.window=null),N.state=null,h},s.inflateGetHeader=function(N,G){var C;return N&&N.state&&2&(C=N.state).wrap?((C.head=G).done=!1,h):f},s.inflateSetDictionary=function(N,G){var C,F=G.length;return N&&N.state?(C=N.state).wrap!==0&&C.mode!==11?f:C.mode===11&&a(1,G,F,0)!==C.check?-3:Z(N,G,F,F)?(C.mode=31,-4):(C.havedict=1,h):f},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,s){var i=n("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,p,h,f,m,g,v,x){var y,b,w,j,_,S,E,T,M,Z=x.bits,N=0,G=0,C=0,F=0,pe=0,V=0,J=0,I=0,K=0,z=0,W=null,fe=0,ue=new i.Buf16(16),ne=new i.Buf16(16),ke=null,ce=0;for(N=0;N<=15;N++)ue[N]=0;for(G=0;G<f;G++)ue[p[h+G]]++;for(pe=Z,F=15;1<=F&&ue[F]===0;F--);if(F<pe&&(pe=F),F===0)return m[g++]=20971520,m[g++]=20971520,x.bits=1,0;for(C=1;C<F&&ue[C]===0;C++);for(pe<C&&(pe=C),N=I=1;N<=15;N++)if(I<<=1,(I-=ue[N])<0)return-1;if(0<I&&(u===0||F!==1))return-1;for(ne[1]=0,N=1;N<15;N++)ne[N+1]=ne[N]+ue[N];for(G=0;G<f;G++)p[h+G]!==0&&(v[ne[p[h+G]]++]=G);if(S=u===0?(W=ke=v,19):u===1?(W=a,fe-=257,ke=l,ce-=257,256):(W=c,ke=d,-1),N=C,_=g,J=G=z=0,w=-1,j=(K=1<<(V=pe))-1,u===1&&852<K||u===2&&592<K)return 1;for(;;){for(E=N-J,M=v[G]<S?(T=0,v[G]):v[G]>S?(T=ke[ce+v[G]],W[fe+v[G]]):(T=96,0),y=1<<N-J,C=b=1<<V;m[_+(z>>J)+(b-=y)]=E<<24|T<<16|M|0,b!==0;);for(y=1<<N-1;z&y;)y>>=1;if(y!==0?(z&=y-1,z+=y):z=0,G++,--ue[N]==0){if(N===F)break;N=p[h+v[G]]}if(pe<N&&(z&j)!==w){for(J===0&&(J=pe),_+=C,I=1<<(V=N-J);V+J<F&&!((I-=ue[V+J])<=0);)V++,I<<=1;if(K+=1<<V,u===1&&852<K||u===2&&592<K)return 1;m[w=z&j]=pe<<24|V<<16|_-g|0}}return z!==0&&(m[_+z]=N-J<<24|64<<16|0),x.bits=pe,0}},{"../utils/common":41}],51:[function(n,r,s){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,s){var i=n("../utils/common"),a=0,l=1;function c(P){for(var $=P.length;0<=--$;)P[$]=0}var d=0,u=29,p=256,h=p+1+u,f=30,m=19,g=2*h+1,v=15,x=16,y=7,b=256,w=16,j=17,_=18,S=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],E=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Z=new Array(2*(h+2));c(Z);var N=new Array(2*f);c(N);var G=new Array(512);c(G);var C=new Array(256);c(C);var F=new Array(u);c(F);var pe,V,J,I=new Array(f);function K(P,$,Y,se,B){this.static_tree=P,this.extra_bits=$,this.extra_base=Y,this.elems=se,this.max_length=B,this.has_stree=P&&P.length}function z(P,$){this.dyn_tree=P,this.max_code=0,this.stat_desc=$}function W(P){return P<256?G[P]:G[256+(P>>>7)]}function fe(P,$){P.pending_buf[P.pending++]=255&$,P.pending_buf[P.pending++]=$>>>8&255}function ue(P,$,Y){P.bi_valid>x-Y?(P.bi_buf|=$<<P.bi_valid&65535,fe(P,P.bi_buf),P.bi_buf=$>>x-P.bi_valid,P.bi_valid+=Y-x):(P.bi_buf|=$<<P.bi_valid&65535,P.bi_valid+=Y)}function ne(P,$,Y){ue(P,Y[2*$],Y[2*$+1])}function ke(P,$){for(var Y=0;Y|=1&P,P>>>=1,Y<<=1,0<--$;);return Y>>>1}function ce(P,$,Y){var se,B,re=new Array(v+1),ye=0;for(se=1;se<=v;se++)re[se]=ye=ye+Y[se-1]<<1;for(B=0;B<=$;B++){var le=P[2*B+1];le!==0&&(P[2*B]=ke(re[le]++,le))}}function $e(P){var $;for($=0;$<h;$++)P.dyn_ltree[2*$]=0;for($=0;$<f;$++)P.dyn_dtree[2*$]=0;for($=0;$<m;$++)P.bl_tree[2*$]=0;P.dyn_ltree[2*b]=1,P.opt_len=P.static_len=0,P.last_lit=P.matches=0}function ze(P){8<P.bi_valid?fe(P,P.bi_buf):0<P.bi_valid&&(P.pending_buf[P.pending++]=P.bi_buf),P.bi_buf=0,P.bi_valid=0}function Ue(P,$,Y,se){var B=2*$,re=2*Y;return P[B]<P[re]||P[B]===P[re]&&se[$]<=se[Y]}function Ge(P,$,Y){for(var se=P.heap[Y],B=Y<<1;B<=P.heap_len&&(B<P.heap_len&&Ue($,P.heap[B+1],P.heap[B],P.depth)&&B++,!Ue($,se,P.heap[B],P.depth));)P.heap[Y]=P.heap[B],Y=B,B<<=1;P.heap[Y]=se}function at(P,$,Y){var se,B,re,ye,le=0;if(P.last_lit!==0)for(;se=P.pending_buf[P.d_buf+2*le]<<8|P.pending_buf[P.d_buf+2*le+1],B=P.pending_buf[P.l_buf+le],le++,se===0?ne(P,B,$):(ne(P,(re=C[B])+p+1,$),(ye=S[re])!==0&&ue(P,B-=F[re],ye),ne(P,re=W(--se),Y),(ye=E[re])!==0&&ue(P,se-=I[re],ye)),le<P.last_lit;);ne(P,b,$)}function Ve(P,$){var Y,se,B,re=$.dyn_tree,ye=$.stat_desc.static_tree,le=$.stat_desc.has_stree,U=$.stat_desc.elems,ae=-1;for(P.heap_len=0,P.heap_max=g,Y=0;Y<U;Y++)re[2*Y]!==0?(P.heap[++P.heap_len]=ae=Y,P.depth[Y]=0):re[2*Y+1]=0;for(;P.heap_len<2;)re[2*(B=P.heap[++P.heap_len]=ae<2?++ae:0)]=1,P.depth[B]=0,P.opt_len--,le&&(P.static_len-=ye[2*B+1]);for($.max_code=ae,Y=P.heap_len>>1;1<=Y;Y--)Ge(P,re,Y);for(B=U;Y=P.heap[1],P.heap[1]=P.heap[P.heap_len--],Ge(P,re,1),se=P.heap[1],P.heap[--P.heap_max]=Y,P.heap[--P.heap_max]=se,re[2*B]=re[2*Y]+re[2*se],P.depth[B]=(P.depth[Y]>=P.depth[se]?P.depth[Y]:P.depth[se])+1,re[2*Y+1]=re[2*se+1]=B,P.heap[1]=B++,Ge(P,re,1),2<=P.heap_len;);P.heap[--P.heap_max]=P.heap[1],function(xe,Te){var He,Ee,ie,he,Xe,tt,nt=Te.dyn_tree,yt=Te.max_code,ht=Te.stat_desc.static_tree,Fe=Te.stat_desc.has_stree,de=Te.stat_desc.extra_bits,te=Te.stat_desc.extra_base,me=Te.stat_desc.max_length,Ye=0;for(he=0;he<=v;he++)xe.bl_count[he]=0;for(nt[2*xe.heap[xe.heap_max]+1]=0,He=xe.heap_max+1;He<g;He++)me<(he=nt[2*nt[2*(Ee=xe.heap[He])+1]+1]+1)&&(he=me,Ye++),nt[2*Ee+1]=he,yt<Ee||(xe.bl_count[he]++,Xe=0,te<=Ee&&(Xe=de[Ee-te]),tt=nt[2*Ee],xe.opt_len+=tt*(he+Xe),Fe&&(xe.static_len+=tt*(ht[2*Ee+1]+Xe)));if(Ye!==0){do{for(he=me-1;xe.bl_count[he]===0;)he--;xe.bl_count[he]--,xe.bl_count[he+1]+=2,xe.bl_count[me]--,Ye-=2}while(0<Ye);for(he=me;he!==0;he--)for(Ee=xe.bl_count[he];Ee!==0;)yt<(ie=xe.heap[--He])||(nt[2*ie+1]!==he&&(xe.opt_len+=(he-nt[2*ie+1])*nt[2*ie],nt[2*ie+1]=he),Ee--)}}(P,$),ce(re,ae,P.bl_count)}function k(P,$,Y){var se,B,re=-1,ye=$[1],le=0,U=7,ae=4;for(ye===0&&(U=138,ae=3),$[2*(Y+1)+1]=65535,se=0;se<=Y;se++)B=ye,ye=$[2*(se+1)+1],++le<U&&B===ye||(le<ae?P.bl_tree[2*B]+=le:B!==0?(B!==re&&P.bl_tree[2*B]++,P.bl_tree[2*w]++):le<=10?P.bl_tree[2*j]++:P.bl_tree[2*_]++,re=B,ae=(le=0)===ye?(U=138,3):B===ye?(U=6,3):(U=7,4))}function Q(P,$,Y){var se,B,re=-1,ye=$[1],le=0,U=7,ae=4;for(ye===0&&(U=138,ae=3),se=0;se<=Y;se++)if(B=ye,ye=$[2*(se+1)+1],!(++le<U&&B===ye)){if(le<ae)for(;ne(P,B,P.bl_tree),--le!=0;);else B!==0?(B!==re&&(ne(P,B,P.bl_tree),le--),ne(P,w,P.bl_tree),ue(P,le-3,2)):le<=10?(ne(P,j,P.bl_tree),ue(P,le-3,3)):(ne(P,_,P.bl_tree),ue(P,le-11,7));re=B,ae=(le=0)===ye?(U=138,3):B===ye?(U=6,3):(U=7,4)}}c(I);var oe=!1;function D(P,$,Y,se){ue(P,(d<<1)+(se?1:0),3),function(B,re,ye,le){ze(B),fe(B,ye),fe(B,~ye),i.arraySet(B.pending_buf,B.window,re,ye,B.pending),B.pending+=ye}(P,$,Y)}s._tr_init=function(P){oe||(function(){var $,Y,se,B,re,ye=new Array(v+1);for(B=se=0;B<u-1;B++)for(F[B]=se,$=0;$<1<<S[B];$++)C[se++]=B;for(C[se-1]=B,B=re=0;B<16;B++)for(I[B]=re,$=0;$<1<<E[B];$++)G[re++]=B;for(re>>=7;B<f;B++)for(I[B]=re<<7,$=0;$<1<<E[B]-7;$++)G[256+re++]=B;for(Y=0;Y<=v;Y++)ye[Y]=0;for($=0;$<=143;)Z[2*$+1]=8,$++,ye[8]++;for(;$<=255;)Z[2*$+1]=9,$++,ye[9]++;for(;$<=279;)Z[2*$+1]=7,$++,ye[7]++;for(;$<=287;)Z[2*$+1]=8,$++,ye[8]++;for(ce(Z,h+1,ye),$=0;$<f;$++)N[2*$+1]=5,N[2*$]=ke($,5);pe=new K(Z,S,p+1,h,v),V=new K(N,E,0,f,v),J=new K(new Array(0),T,0,m,y)}(),oe=!0),P.l_desc=new z(P.dyn_ltree,pe),P.d_desc=new z(P.dyn_dtree,V),P.bl_desc=new z(P.bl_tree,J),P.bi_buf=0,P.bi_valid=0,$e(P)},s._tr_stored_block=D,s._tr_flush_block=function(P,$,Y,se){var B,re,ye=0;0<P.level?(P.strm.data_type===2&&(P.strm.data_type=function(le){var U,ae=4093624447;for(U=0;U<=31;U++,ae>>>=1)if(1&ae&&le.dyn_ltree[2*U]!==0)return a;if(le.dyn_ltree[18]!==0||le.dyn_ltree[20]!==0||le.dyn_ltree[26]!==0)return l;for(U=32;U<p;U++)if(le.dyn_ltree[2*U]!==0)return l;return a}(P)),Ve(P,P.l_desc),Ve(P,P.d_desc),ye=function(le){var U;for(k(le,le.dyn_ltree,le.l_desc.max_code),k(le,le.dyn_dtree,le.d_desc.max_code),Ve(le,le.bl_desc),U=m-1;3<=U&&le.bl_tree[2*M[U]+1]===0;U--);return le.opt_len+=3*(U+1)+5+5+4,U}(P),B=P.opt_len+3+7>>>3,(re=P.static_len+3+7>>>3)<=B&&(B=re)):B=re=Y+5,Y+4<=B&&$!==-1?D(P,$,Y,se):P.strategy===4||re===B?(ue(P,2+(se?1:0),3),at(P,Z,N)):(ue(P,4+(se?1:0),3),function(le,U,ae,xe){var Te;for(ue(le,U-257,5),ue(le,ae-1,5),ue(le,xe-4,4),Te=0;Te<xe;Te++)ue(le,le.bl_tree[2*M[Te]+1],3);Q(le,le.dyn_ltree,U-1),Q(le,le.dyn_dtree,ae-1)}(P,P.l_desc.max_code+1,P.d_desc.max_code+1,ye+1),at(P,P.dyn_ltree,P.dyn_dtree)),$e(P),se&&ze(P)},s._tr_tally=function(P,$,Y){return P.pending_buf[P.d_buf+2*P.last_lit]=$>>>8&255,P.pending_buf[P.d_buf+2*P.last_lit+1]=255&$,P.pending_buf[P.l_buf+P.last_lit]=255&Y,P.last_lit++,$===0?P.dyn_ltree[2*Y]++:(P.matches++,$--,P.dyn_ltree[2*(C[Y]+p+1)]++,P.dyn_dtree[2*W($)]++),P.last_lit===P.lit_bufsize-1},s._tr_align=function(P){ue(P,2,3),ne(P,b,Z),function($){$.bi_valid===16?(fe($,$.bi_buf),$.bi_buf=0,$.bi_valid=0):8<=$.bi_valid&&($.pending_buf[$.pending++]=255&$.bi_buf,$.bi_buf>>=8,$.bi_valid-=8)}(P)}},{"../utils/common":41}],53:[function(n,r,s){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,s){(function(i){(function(a,l){if(!a.setImmediate){var c,d,u,p,h=1,f={},m=!1,g=a.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(a);v=v&&v.setTimeout?v:a,c={}.toString.call(a.process)==="[object process]"?function(w){process.nextTick(function(){y(w)})}:function(){if(a.postMessage&&!a.importScripts){var w=!0,j=a.onmessage;return a.onmessage=function(){w=!1},a.postMessage("","*"),a.onmessage=j,w}}()?(p="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",b,!1):a.attachEvent("onmessage",b),function(w){a.postMessage(p+w,"*")}):a.MessageChannel?((u=new MessageChannel).port1.onmessage=function(w){y(w.data)},function(w){u.port2.postMessage(w)}):g&&"onreadystatechange"in g.createElement("script")?(d=g.documentElement,function(w){var j=g.createElement("script");j.onreadystatechange=function(){y(w),j.onreadystatechange=null,d.removeChild(j),j=null},d.appendChild(j)}):function(w){setTimeout(y,0,w)},v.setImmediate=function(w){typeof w!="function"&&(w=new Function(""+w));for(var j=new Array(arguments.length-1),_=0;_<j.length;_++)j[_]=arguments[_+1];var S={callback:w,args:j};return f[h]=S,c(h),h++},v.clearImmediate=x}function x(w){delete f[w]}function y(w){if(m)setTimeout(y,0,w);else{var j=f[w];if(j){m=!0;try{(function(_){var S=_.callback,E=_.args;switch(E.length){case 0:S();break;case 1:S(E[0]);break;case 2:S(E[0],E[1]);break;case 3:S(E[0],E[1],E[2]);break;default:S.apply(l,E)}})(j)}finally{x(w),m=!1}}}}function b(w){w.source===a&&typeof w.data=="string"&&w.data.indexOf(p)===0&&y(+w.data.slice(p.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof Us<"u"?Us:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(A1);var mT=A1.exports;const gT=jl(mT);function yT(t){let e="",n=t;for(;n>=0;)e=String.fromCharCode(n%26+65)+e,n=Math.floor(n/26)-1;return e}function xT(t,e){return`${yT(t)}${e+1}`}async function M1(t,e,n="design"){const s=Math.ceil(e.width/1e3),i=Math.ceil(e.length/1e3);console.log(`[SLICER] Creating ${s}${i} grid (${s*i} tiles) for ${e.width}mm  ${e.length}mm design`);const c=new DOMParser().parseFromString(t,"image/svg+xml").querySelector("svg");if(!c)throw new Error("Invalid SVG content");const d=c.getAttribute("viewBox");let u,p;if(d){const S=d.split(/\s+/).map(Number);u=S[2],p=S[3]}else u=parseFloat(c.getAttribute("width"))||1024,p=parseFloat(c.getAttribute("height"))||1024;console.log(`[SLICER] SVG internal dimensions: ${u}  ${p}`);const h=u/e.width,f=p/e.length,m=1e3*h,g=1e3*f;console.log(`[SLICER] Tile size in SVG units: ${m}  ${g}`);const v=c.innerHTML,x=c.getAttribute("xmlns")||"http://www.w3.org/2000/svg",y=new gT,b=y.folder("tiles"),w=[];for(let S=0;S<i;S++){const E=[];for(let T=0;T<s;T++){const M=xT(T,S);E.push(M);const Z=T*m,N=S*g,G=`${Z} ${N} ${m} ${g}`,C=`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="${x}" viewBox="${G}" width="1000mm" height="1000mm">
  <defs>
    <clipPath id="tile-clip">
      <rect x="${Z}" y="${N}" width="${m}" height="${g}"/>
    </clipPath>
  </defs>
  <g clip-path="url(#tile-clip)">
${v}
  </g>
</svg>`,F=`${$1(n)}_${M}.svg`;b.file(F,C)}w.push(E)}const j=vT(w,e,n);y.file("layout-guide.txt",j);const _=await y.generateAsync({type:"blob"});return console.log(`[SLICER] Created ZIP with ${s*i} tiles`),_}function vT(t,e,n){const r=t.length,s=t[0].length;let i=`TPV Studio - Tile Layout Guide
================================

Design: ${n}
Total Size: ${e.width}mm  ${e.length}mm (${e.width/1e3}m  ${e.length/1e3}m)
Tile Size: 1000mm  1000mm (1m  1m)
Grid: ${s} columns  ${r} rows (${s*r} tiles)

Layout (view from above):
-------------------------

`;const a=6;i+=""+("".repeat(a)+"").repeat(s-1)+"".repeat(a)+`
`;for(let l=0;l<r;l++){i+="";for(let c=0;c<s;c++){const d=t[l][c],u=a-d.length,p=Math.floor(u/2),h=u-p;i+=" ".repeat(p)+d+" ".repeat(h)+""}i+=`
`,l<r-1?i+=""+("".repeat(a)+"").repeat(s-1)+"".repeat(a)+`
`:i+=""+("".repeat(a)+"").repeat(s-1)+"".repeat(a)+`
`}return i+=`
Installation Notes:
-------------------
- Each tile is exactly 1m  1m
- Tiles are named by column (A-Z) and row (1-${r})
- Start from top-left corner (A1) when laying out
- Tiles align perfectly when placed edge-to-edge
- Edge tiles may contain partial content if design isn't exactly divisible by 1m

Generated by TPV Studio
`,i}function $1(t){return t.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"-").substring(0,50)}function L1(t,e){const n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}async function bT(t,e,n="design"){try{const r=await fetch(t);if(!r.ok)throw new Error(`Failed to fetch SVG: ${r.statusText}`);const s=await r.text(),i=await M1(s,e,n),a=`${$1(n)}-tiles-1mx1m.zip`;return L1(i,a),console.log(`[SLICER] Downloaded ${a}`),!0}catch(r){throw console.error("[SLICER] Failed to download tiles:",r),r}}var Vs;let wT=(Vs=class{static next(){return(++Vs.seed).toString(16).toUpperCase()}static peek(){return(Vs.seed+1).toString(16).toUpperCase()}},Gl(Vs,"seed",0),Vs);var Uf=wT;const _T=Uf;let ST=class{constructor(e=null){this.handle=_T.next(),this.ownerObjectHandle="0",this.subclassMarkers=[],e&&(Array.isArray(e)?this.subclassMarkers.push(...e):this.subclassMarkers.push(e))}tags(e){e.push(5,this.handle),e.push(330,this.ownerObjectHandle);for(const n of this.subclassMarkers)e.push(100,n)}};var Yt=ST;const kT=Yt;let jT=class extends kT{constructor(e,n,r){super(["AcDbSymbolTableRecord","AcDbLinetypeTableRecord"]),this.name=e,this.description=n,this.elements=r}tags(e){e.push(0,"LTYPE"),super.tags(e),e.push(2,this.name),e.push(3,this.description),e.push(70,0),e.push(72,65),e.push(73,this.elements.length),e.push(40,this.getElementsSum()),this.elements.forEach(n=>{e.push(49,n),e.push(74,0)})}getElementsSum(){return this.elements.reduce((e,n)=>e+Math.abs(n),0)}};var CT=jT;const ET=Yt;let TT=class extends ET{constructor(e,n,r=null){super(["AcDbSymbolTableRecord","AcDbLayerTableRecord"]),this.name=e,this.colorNumber=n,this.lineTypeName=r,this.shapes=[],this.trueColor=-1}tags(e){e.push(0,"LAYER"),super.tags(e),e.push(2,this.name),this.trueColor!==-1?e.push(420,this.trueColor):e.push(62,this.colorNumber),e.push(70,0),this.lineTypeName&&e.push(6,this.lineTypeName),e.push(390,1)}setTrueColor(e){this.trueColor=e}addShape(e){this.shapes.push(e),e.layer=this}getShapes(){return this.shapes}shapesTags(e,n){for(const r of this.shapes)r.ownerObjectHandle=e.handle,r.tags(n)}};var NT=TT;const PT=Yt;let RT=class extends PT{constructor(e){super("AcDbSymbolTable"),this.name=e,this.elements=[]}add(e){e.ownerObjectHandle=this.handle,this.elements.push(e)}tags(e){e.push(0,"TABLE"),e.push(2,this.name),super.tags(e),e.push(70,this.elements.length),this.elements.forEach(n=>{n.tags(e)}),e.push(0,"ENDTAB")}};var D1=RT;const OT=Yt,AT=D1;let MT=class extends AT{constructor(e){super(e),this.subclassMarkers.push("AcDbDimStyleTable")}tags(e){e.push(0,"TABLE"),e.push(2,this.name),OT.prototype.tags.call(this,e),e.push(70,this.elements.length),e.push(71,1);for(const n of this.elements)n.tags(e);e.push(0,"ENDTAB")}};var $T=MT;const LT=Yt;let DT=class extends LT{constructor(n){super(["AcDbSymbolTableRecord","AcDbTextStyleTableRecord"]);Gl(this,"fontFileName","txt");this.name=n}tags(n){n.push(0,"STYLE"),super.tags(n),n.push(2,this.name),n.push(70,0),n.push(40,0),n.push(41,1),n.push(50,0),n.push(71,0),n.push(42,1),n.push(3,this.fontFileName),n.push(4,"")}};var IT=DT;const zT=Yt;let FT=class extends zT{constructor(e,n){super(["AcDbSymbolTableRecord","AcDbViewportTableRecord"]),this.name=e,this.height=n}tags(e){e.push(0,"VPORT"),super.tags(e),e.push(2,this.name),e.push(40,this.height),e.push(70,0)}};var BT=FT;const HT=Yt;let UT=class extends HT{constructor(e){super(["AcDbSymbolTableRecord","AcDbRegAppTableRecord"]),this.name=e}tags(e){e.push(0,"APPID"),super.tags(e),e.push(2,this.name),e.push(70,0)}};var WT=UT;const ry=Yt;let GT=class extends ry{constructor(e){super(["AcDbEntity","AcDbBlockBegin"]),this.name=e,this.end=new ry(["AcDbEntity","AcDbBlockEnd"]),this.recordHandle=null}tags(e){e.push(0,"BLOCK"),super.tags(e),e.push(2,this.name),e.push(70,0),e.point(0,0),e.push(3,this.name),e.push(1,""),e.push(0,"ENDBLK"),this.end.tags(e)}};var VT=GT;const YT=Yt;let qT=class extends YT{constructor(e){super(["AcDbSymbolTableRecord","AcDbBlockTableRecord"]),this.name=e}tags(e){e.push(0,"BLOCK_RECORD"),super.tags(e),e.push(2,this.name),e.push(70,0),e.push(280,0),e.push(281,1)}};var XT=qT;const KT=Yt;let ZT=class extends KT{constructor(){super("AcDbDictionary"),this.children={}}addChildDictionary(e,n){n.ownerObjectHandle=this.handle,this.children[e]=n}tags(e){e.push(0,"DICTIONARY"),super.tags(e),e.push(281,1);const n=Object.entries(this.children);for(const s of n){const[i,a]=s;e.push(3,i),e.push(350,a.handle)}const r=Object.values(this.children);for(const s of r)s.tags(e)}};var JT=ZT;const QT=Yt;let eN=class extends QT{constructor(e,n,r,s){super(["AcDbEntity","AcDbLine"]),this.x1=e,this.y1=n,this.x2=r,this.y2=s}tags(e){e.push(0,"LINE"),super.tags(e),e.push(8,this.layer.name),e.point(this.x1,this.y1),e.push(11,this.x2),e.push(21,this.y2),e.push(31,0)}};var tN=eN;const nN=Yt;let rN=class extends nN{constructor(e,n,r,s,i,a){super(["AcDbEntity","AcDbLine"]),this.x1=e,this.y1=n,this.z1=r,this.x2=s,this.y2=i,this.z2=a}tags(e){e.push(0,"LINE"),super.tags(e),e.push(8,this.layer.name),e.point(this.x1,this.y1,this.z1),e.push(11,this.x2),e.push(21,this.y2),e.push(31,this.z2)}};var sN=rN;const iN=Yt;let oN=class extends iN{constructor(e,n,r,s,i){super(["AcDbEntity","AcDbCircle"]),this.x=e,this.y=n,this.r=r,this.startAngle=s,this.endAngle=i}tags(e){e.push(0,"ARC"),super.tags(e),e.push(8,this.layer.name),e.point(this.x,this.y),e.push(40,this.r),e.push(100,"AcDbArc"),e.push(50,this.startAngle),e.push(51,this.endAngle)}};var aN=oN;const lN=Yt;let cN=class extends lN{constructor(e,n,r){super(["AcDbEntity","AcDbCircle"]),this.x=e,this.y=n,this.r=r}tags(e){e.push(0,"CIRCLE"),super.tags(e),e.push(8,this.layer.name),e.point(this.x,this.y),e.push(40,this.r)}};var dN=cN;const uN=Yt;let hN=class extends uN{constructor(e,n,r,s,i,a,l,c){super(["AcDbEntity","AcDbCircle"]),this.x=e,this.y=n,this.z=r,this.r=s,this.thickness=i,this.extrusionDirectionX=a,this.extrusionDirectionY=l,this.extrusionDirectionZ=c}tags(e){e.push(0,"CIRCLE"),super.tags(e),e.push(8,this.layer.name),e.point(this.x,this.y,this.z),e.push(40,this.r),e.push(39,this.thickness),e.push(210,this.extrusionDirectionX),e.push(220,this.extrusionDirectionY),e.push(230,this.extrusionDirectionZ)}};var pN=hN;const fN=Yt,sy=["left","center","right"],iy=["baseline","bottom","middle","top"];let mN=class extends fN{constructor(e,n,r,s,i,a="left",l="baseline"){super(["AcDbEntity","AcDbText"]),this.x=e,this.y=n,this.height=r,this.rotation=s,this.value=i,this.hAlign=a,this.vAlign=l}tags(e){e.push(0,"TEXT"),super.tags(e),e.push(8,this.layer.name),e.point(this.x,this.y),e.push(40,this.height),e.push(1,this.value),e.push(50,this.rotation),sy.includes(this.hAlign,1)||iy.includes(this.vAlign,1)?(e.push(72,Math.max(sy.indexOf(this.hAlign),0)),e.push(11,this.x),e.push(21,this.y),e.push(31,0),e.push(100,"AcDbText"),e.push(73,Math.max(iy.indexOf(this.vAlign),0))):e.push(100,"AcDbText")}};var gN=mN;const yN=Yt;let xN=class extends yN{constructor(e,n=!1,r=0,s=0){super(["AcDbEntity","AcDbPolyline"]),this.points=e,this.closed=n,this.startWidth=r,this.endWidth=s}tags(e){e.push(0,"LWPOLYLINE"),super.tags(e),e.push(8,this.layer.name),e.push(6,"ByLayer"),e.push(62,256),e.push(370,-1),e.push(90,this.points.length),e.push(70,this.closed?1:0),this.points.forEach(n=>{const[r,s,i]=n;e.push(10,r),e.push(20,s),(this.startWidth!==0||this.endWidth!==0)&&(e.push(40,this.startWidth),e.push(41,this.endWidth)),i!==void 0&&e.push(42,i)})}};var vN=xN;const bN=Yt;let wN=class extends bN{constructor(e,n,r){super(["AcDbEntity","AcDbVertex","AcDb3dPolylineVertex"]),this.x=e,this.y=n,this.z=r}tags(e){e.push(0,"VERTEX"),super.tags(e),e.push(8,this.layer.name),e.point(this.x,this.y,this.z),e.push(70,32)}};var _N=wN;const SN=Yt,kN=Uf,jN=_N;let CN=class extends SN{constructor(e){super(["AcDbEntity","AcDb3dPolyline"]),this.verticies=e.map(n=>{const[r,s,i]=n,a=new jN(r,s,i);return a.ownerObjectHandle=this.handle,a}),this.seqendHandle=kN.next()}tags(e){e.push(0,"POLYLINE"),super.tags(e),e.push(8,this.layer.name),e.push(66,1),e.push(70,0),e.point(0,0),this.verticies.forEach(n=>{n.layer=this.layer,n.tags(e)}),e.push(0,"SEQEND"),e.push(5,this.seqendHandle),e.push(100,"AcDbEntity"),e.push(8,this.layer.name)}};var EN=CN;const TN=Yt;let NN=class extends TN{constructor(e,n,r,s,i,a,l,c,d,u,p,h){super(["AcDbEntity","AcDbFace"]),this.x1=e,this.y1=n,this.z1=r,this.x2=s,this.y2=i,this.z2=a,this.x3=l,this.y3=c,this.z3=d,this.x4=u,this.y4=p,this.z4=h}tags(e){e.push(0,"3DFACE"),super.tags(e),e.push(8,this.layer.name),e.point(this.x1,this.y1,this.z1),e.push(11,this.x2),e.push(21,this.y2),e.push(31,this.z2),e.push(12,this.x3),e.push(22,this.y3),e.push(32,this.z3),e.push(13,this.x4),e.push(23,this.y4),e.push(33,this.z4)}};var PN=NN;const RN=Yt;let ON=class extends RN{constructor(e,n){super(["AcDbEntity","AcDbPoint"]),this.x=e,this.y=n}tags(e){e.push(0,"POINT"),super.tags(e),e.push(8,this.layer.name),e.point(this.x,this.y)}};var AN=ON;const MN=Yt;let $N=class extends MN{constructor(e,n=3,r=null,s=null,i=[]){if(super(["AcDbEntity","AcDbSpline"]),e.length<n+1)throw new Error(`For degree ${n} spline, expected at least ${n+1} control points, but received only ${e.length}`);if(r==null){r=[];for(let p=0;p<n+1;p++)r.push(0);for(let p=1;p<e.length-n;p++)r.push(p);for(let p=0;p<n+1;p++)r.push(e.length-n)}if(r.length!==e.length+n+1)throw new Error(`Invalid knot vector length. Expected ${e.length+n+1} but received ${r.length}.`);this.controlPoints=e,this.knots=r,this.fitPoints=i,this.degree=n,this.weights=s;const a=0,l=0,c=this.weights?1:0,d=1,u=0;this.type=a*1+l*2+c*4+d*8+u*16}tags(e){e.push(0,"SPLINE"),super.tags(e),e.push(8,this.layer.name),e.push(210,0),e.push(220,0),e.push(230,1),e.push(70,this.type),e.push(71,this.degree),e.push(72,this.knots.length),e.push(73,this.controlPoints.length),e.push(74,this.fitPoints.length),e.push(42,1e-7),e.push(43,1e-7),e.push(44,1e-10),this.knots.forEach(n=>{e.push(40,n)}),this.weights&&this.weights.forEach(n=>{e.push(41,n)}),this.controlPoints.forEach(n=>{e.point(n[0],n[1])})}};var LN=$N;const DN=Yt;let IN=class extends DN{constructor(e,n,r,s,i,a,l){super(["AcDbEntity","AcDbEllipse"]),this.x=e,this.y=n,this.majorAxisX=r,this.majorAxisY=s,this.axisRatio=i,this.startAngle=a,this.endAngle=l}tags(e){e.push(0,"ELLIPSE"),super.tags(e),e.push(8,this.layer.name),e.point(this.x,this.y),e.push(11,this.majorAxisX),e.push(21,this.majorAxisY),e.push(31,0),e.push(40,this.axisRatio),e.push(41,this.startAngle),e.push(42,this.endAngle)}};var zN=IN;let FN=class{constructor(){this.lines=[]}point(e,n,r=0){this.push(10,e),this.push(20,n),this.push(30,r)}start(e){this.push(0,"SECTION"),this.push(2,e)}end(){this.push(0,"ENDSEC")}addHeaderVariable(e,n){this.push(9,`$${e}`),n.forEach(r=>{this.push(r[0],r[1])})}push(e,n){this.lines.push(e,n)}toDxfString(){return this.lines.join(`
`)}};var BN=FN;const HN=CT,UN=NT,Sc=D1,WN=$T,GN=IT,VN=BT,YN=WT,qN=VT,XN=XT,oy=JT,KN=tN,ZN=sN,JN=aN,QN=dN,eP=pN,tP=gN,kc=vN,nP=EN,rP=PN,sP=AN,iP=LN,oP=zN,aP=BN,lP=Uf;let ta=class bi{constructor(){this.layers={},this.activeLayer=null,this.lineTypes={},this.headers={},this.tables={},this.blocks={},this.dictionary=new oy,this.setUnits("Unitless");for(const e of bi.LINE_TYPES)this.addLineType(e.name,e.description,e.elements);for(const e of bi.LAYERS)this.addLayer(e.name,e.colorNumber,e.lineTypeName);this.setActiveLayer("0"),this.generateAutocadExtras()}addLineType(e,n,r){return this.lineTypes[e]=new HN(e,n,r),this}addLayer(e,n,r){return this.layers[e]=new UN(e,n,r),this}setActiveLayer(e){return this.activeLayer=this.layers[e],this}addTable(e){const n=new Sc(e);return this.tables[e]=n,n}addBlock(e){const n=new qN(e);return this.blocks[e]=n,n}drawLine(e,n,r,s){return this.activeLayer.addShape(new KN(e,n,r,s)),this}drawLine3d(e,n,r,s,i,a){return this.activeLayer.addShape(new ZN(e,n,r,s,i,a)),this}drawPoint(e,n){return this.activeLayer.addShape(new sP(e,n)),this}drawRect(e,n,r,s,i,a){const l=r-e,c=s-n;a=a||0;let d=null;return i?d=new kc([[e+l-i,n,a],[e+l,n+i],[e+l,n+c-i,a],[e+l-i,n+c],[e+i,n+c,a],[e,n+c-i],[e,n+i,a],[e+i,n]],!0):d=new kc([[e,n],[e,n+c],[e+l,n+c],[e+l,n]],!0),this.activeLayer.addShape(d),this}drawPolygon(e,n,r,s,i=0,a=!1){const l=2*Math.PI/r,c=[];let d=s;const u=i*Math.PI/180;a&&(d=s/Math.cos(Math.PI/r));for(let p=0;p<r;p++)c.push([e+d*Math.sin(u+p*l),n+d*Math.cos(u+p*l)]);return this.activeLayer.addShape(new kc(c,!0)),this}drawArc(e,n,r,s,i){return this.activeLayer.addShape(new JN(e,n,r,s,i)),this}drawCircle(e,n,r){return this.activeLayer.addShape(new QN(e,n,r)),this}drawCylinder(e,n,r,s,i,a,l,c){return this.activeLayer.addShape(new eP(e,n,r,s,i,a,l,c)),this}drawText(e,n,r,s,i,a="left",l="baseline"){return this.activeLayer.addShape(new tP(e,n,r,s,i,a,l)),this}drawPolyline(e,n=!1,r=0,s=0){return this.activeLayer.addShape(new kc(e,n,r,s)),this}drawPolyline3d(e){return e.forEach(n=>{if(n.length!==3)throw"Require 3D coordinates"}),this.activeLayer.addShape(new nP(e)),this}setTrueColor(e){return this.activeLayer.setTrueColor(e),this}drawSpline(e,n=3,r=null,s=null,i=[]){return this.activeLayer.addShape(new iP(e,n,r,s,i)),this}drawEllipse(e,n,r,s,i,a=0,l=2*Math.PI){return this.activeLayer.addShape(new oP(e,n,r,s,i,a,l)),this}drawFace(e,n,r,s,i,a,l,c,d,u,p,h){return this.activeLayer.addShape(new rP(e,n,r,s,i,a,l,c,d,u,p,h)),this}_ltypeTable(){const e=new Sc("LTYPE"),n=Object.values(this.lineTypes);for(const r of n)e.add(r);return e}_layerTable(e){const n=new Sc("LAYER"),r=Object.values(this.layers);for(const s of r)n.add(s);return n}header(e,n){return this.headers[e]=n,this}setUnits(e){return typeof bi.UNITS[e]<"u"?bi.UNITS[e]:bi.UNITS.Unitless,this.header("INSUNITS",[[70,bi.UNITS[e]]]),this}generateAutocadExtras(){this.headers.ACADVER||this.header("ACADVER",[[1,"AC1021"]]),this.lineTypes.ByBlock||this.addLineType("ByBlock","",[]),this.lineTypes.ByLayer||this.addLineType("ByLayer","",[]);let e=this.tables.VPORT;e||(e=this.addTable("VPORT"));let n=this.tables.STYLE;n||(n=this.addTable("STYLE")),this.tables.VIEW||this.addTable("VIEW"),this.tables.UCS||this.addTable("UCS");let r=this.tables.APPID;if(r||(r=this.addTable("APPID")),!this.tables.DIMSTYLE){const i=new WN("DIMSTYLE");this.tables.DIMSTYLE=i}e.add(new VN("*ACTIVE",1e3)),n.add(new GN("standard")),r.add(new YN("ACAD")),this.modelSpace=this.addBlock("*Model_Space"),this.addBlock("*Paper_Space");const s=new oy;this.dictionary.addChildDictionary("ACAD_GROUP",s)}_tagsManager(){const e=new aP,n=new Sc("BLOCK_RECORD"),r=Object.values(this.blocks);for(const d of r){const u=new XN(d.name);n.add(u)}const s=this._ltypeTable(),i=this._layerTable();e.start("HEADER"),e.addHeaderVariable("HANDSEED",[[5,lP.peek()]]);const a=Object.entries(this.headers);for(const d of a){const[u,p]=d;e.addHeaderVariable(u,p)}e.end(),e.start("CLASSES"),e.end(),e.start("TABLES"),s.tags(e),i.tags(e);const l=Object.values(this.tables);for(const d of l)d.tags(e);n.tags(e),e.end(),e.start("BLOCKS");for(const d of r)d.tags(e);e.end(),e.start("ENTITIES");const c=Object.values(this.layers);for(const d of c)d.shapesTags(this.modelSpace,e);return e.end(),e.start("OBJECTS"),this.dictionary.tags(e),e.end(),e.push(0,"EOF"),e}toDxfString(){return this._tagsManager().toDxfString()}};ta.ACI={LAYER:0,RED:1,YELLOW:2,GREEN:3,CYAN:4,BLUE:5,MAGENTA:6,WHITE:7};ta.LINE_TYPES=[{name:"CONTINUOUS",description:"______",elements:[]},{name:"DASHED",description:"_ _ _ ",elements:[5,-5]},{name:"DOTTED",description:". . . ",elements:[0,-5]}];ta.LAYERS=[{name:"0",colorNumber:ta.ACI.WHITE,lineTypeName:"CONTINUOUS"}];ta.UNITS={Unitless:0,Inches:1,Feet:2,Miles:3,Millimeters:4,Centimeters:5,Meters:6,Kilometers:7,Microinches:8,Mils:9,Yards:10,Angstroms:11,Nanometers:12,Microns:13,Decimeters:14,Decameters:15,Hectometers:16,Gigameters:17,"Astronomical units":18,"Light years":19,Parsecs:20};var cP=ta,dP=cP;const uP=jl(dP);function hP(t,e=2){if(!t)return[];const n=[];let r=[],s=0,i=0,a=0,l=0;const c=pP(t);for(const d of c){const u=d.type,p=d.args;switch(u){case"M":r.length>0&&n.push(r),s=p[0],i=p[1],a=s,l=i,r=[{x:s,y:i}];break;case"m":r.length>0&&n.push(r),s+=p[0],i+=p[1],a=s,l=i,r=[{x:s,y:i}];break;case"L":s=p[0],i=p[1],r.push({x:s,y:i});break;case"l":s+=p[0],i+=p[1],r.push({x:s,y:i});break;case"H":s=p[0],r.push({x:s,y:i});break;case"h":s+=p[0],r.push({x:s,y:i});break;case"V":i=p[0],r.push({x:s,y:i});break;case"v":i+=p[0],r.push({x:s,y:i});break;case"C":{const h=vp(s,i,p[0],p[1],p[2],p[3],p[4],p[5],e);r.push(...h.slice(1)),s=p[4],i=p[5]}break;case"c":{const h=vp(s,i,s+p[0],i+p[1],s+p[2],i+p[3],s+p[4],i+p[5],e);r.push(...h.slice(1)),s+=p[4],i+=p[5]}break;case"Q":{const h=ay(s,i,p[0],p[1],p[2],p[3],e);r.push(...h.slice(1)),s=p[2],i=p[3]}break;case"q":{const h=ay(s,i,s+p[0],i+p[1],s+p[2],i+p[3],e);r.push(...h.slice(1)),s+=p[2],i+=p[3]}break;case"A":{const h=ly(s,i,p[0],p[1],p[2],p[3],p[4],p[5],p[6],e);r.push(...h.slice(1)),s=p[5],i=p[6]}break;case"a":{const h=s+p[5],f=i+p[6],m=ly(s,i,p[0],p[1],p[2],p[3],p[4],h,f,e);r.push(...m.slice(1)),s=h,i=f}break;case"Z":case"z":r.length>0&&(r.push({x:a,y:l}),s=a,i=l);break}}return r.length>0&&n.push(r),n}function pP(t){const e=[],n=/([MmLlHhVvCcSsQqTtAaZz])([^MmLlHhVvCcSsQqTtAaZz]*)/g,r=[...t.matchAll(n)];for(const s of r){const i=s[1],l=s[2].trim().split(/[\s,]+/).filter(c=>c.length>0).map(Number);e.push({type:i,args:l})}return e}function vp(t,e,n,r,s,i,a,l,c){const d=[{x:t,y:e}];return bp(t,e,n,r,s,i,a,l,c,d),d.push({x:a,y:l}),d}function bp(t,e,n,r,s,i,a,l,c,d){const u=a-t,p=l-e;if(Math.sqrt(u*u+p*p)<.001)return;const f=cy(n,r,t,e,a,l),m=cy(s,i,t,e,a,l);if(f<c&&m<c)return;const g=(t+n)/2,v=(e+r)/2,x=(n+s)/2,y=(r+i)/2,b=(s+a)/2,w=(i+l)/2,j=(g+x)/2,_=(v+y)/2,S=(x+b)/2,E=(y+w)/2,T=(j+S)/2,M=(_+E)/2;bp(t,e,g,v,j,_,T,M,c,d),d.push({x:T,y:M}),bp(T,M,S,E,b,w,a,l,c,d)}function ay(t,e,n,r,s,i,a){const l=t+.6666666666666666*(n-t),c=e+2/3*(r-e),d=s+2/3*(n-s),u=i+2/3*(r-i);return vp(t,e,l,c,d,u,s,i,a)}function ly(t,e,n,r,s,i,a,l,c,d){if(n===0||r===0)return[{x:t,y:e},{x:l,y:c}];const u=fP(t,e,n,r,s,i,a,l,c);if(!u)return[{x:t,y:e},{x:l,y:c}];const{cx:p,cy:h,theta1:f,dtheta:m,rx:g,ry:v}=u,x=s*Math.PI/180,y=(g+v)/2,b=Math.abs(m)*y,w=Math.max(4,Math.ceil(b/(2*Math.sqrt(2*d*y)))),j=[];for(let _=0;_<=w;_++){const S=f+m*_/w,E=Math.cos(S),T=Math.sin(S),M=Math.cos(x),Z=Math.sin(x),N=p+g*E*M-v*T*Z,G=h+g*E*Z+v*T*M;j.push({x:N,y:G})}return j}function fP(t,e,n,r,s,i,a,l,c){const d=s*Math.PI/180,u=Math.cos(d),p=Math.sin(d),h=(t-l)/2,f=(e-c)/2,m=u*h+p*f,g=-p*h+u*f;n=Math.abs(n),r=Math.abs(r);const v=m*m/(n*n)+g*g/(r*r);if(v>1){const K=Math.sqrt(v);n*=K,r*=K}const x=n*n,y=r*r,b=m*m,w=g*g;let j=(x*y-x*w-y*b)/(x*w+y*b);j<0&&(j=0);const _=(i!==a?1:-1)*Math.sqrt(j),S=_*(n*g)/r,E=_*-(r*m)/n,T=u*S-p*E+(t+l)/2,M=p*S+u*E+(e+c)/2,Z=(m-S)/n,N=(g-E)/r,G=(-m-S)/n,C=(-g-E)/r,F=Math.sqrt(Z*Z+N*N),pe=(N>=0?1:-1)*Math.acos(Z/F),V=Z*G+N*C,J=Z*C-N*G;let I=Math.acos(Math.max(-1,Math.min(1,V/(F*Math.sqrt(G*G+C*C)))));return J<0&&(I=-I),!a&&I>0&&(I-=2*Math.PI),a&&I<0&&(I+=2*Math.PI),{cx:T,cy:M,theta1:pe,dtheta:I,rx:n,ry:r}}function cy(t,e,n,r,s,i){const a=s-n,l=i-r,c=Math.sqrt(a*a+l*l);return c===0?Math.sqrt((t-n)**2+(e-r)**2):Math.abs((l*t-a*e+s*r-i*n)/c)}function mP(t,e,n,r,s=0,i=0){if(t=parseFloat(t)||0,e=parseFloat(e)||0,n=parseFloat(n)||0,r=parseFloat(r)||0,s=parseFloat(s)||0,i=parseFloat(i)||s,s===0&&i===0)return[{x:t,y:e},{x:t+n,y:e},{x:t+n,y:e+r},{x:t,y:e+r},{x:t,y:e}];s=Math.min(s,n/2),i=Math.min(i,r/2);const a=[],l=8;for(let c=0;c<=l;c++){const d=-Math.PI/2+Math.PI/2*(c/l);a.push({x:t+n-s+s*Math.cos(d),y:e+i+i*Math.sin(d)})}for(let c=0;c<=l;c++){const d=0+Math.PI/2*(c/l);a.push({x:t+n-s+s*Math.cos(d),y:e+r-i+i*Math.sin(d)})}for(let c=0;c<=l;c++){const d=Math.PI/2+Math.PI/2*(c/l);a.push({x:t+s+s*Math.cos(d),y:e+r-i+i*Math.sin(d)})}for(let c=0;c<=l;c++){const d=Math.PI+Math.PI/2*(c/l);a.push({x:t+s+s*Math.cos(d),y:e+i+i*Math.sin(d)})}return a.push(a[0]),a}function gP(t,e,n,r=32){t=parseFloat(t)||0,e=parseFloat(e)||0,n=parseFloat(n)||0;const s=[];for(let i=0;i<=r;i++){const a=2*Math.PI*i/r;s.push({x:t+n*Math.cos(a),y:e+n*Math.sin(a)})}return s}function yP(t,e,n,r,s=32){t=parseFloat(t)||0,e=parseFloat(e)||0,n=parseFloat(n)||0,r=parseFloat(r)||0;const i=[];for(let a=0;a<=s;a++){const l=2*Math.PI*a/s;i.push({x:t+n*Math.cos(l),y:e+r*Math.sin(l)})}return i}function xP(t){if(!t)return[];const e=t.trim().split(/[\s,]+/).map(Number),n=[];for(let r=0;r<e.length;r+=2)r+1<e.length&&n.push({x:e[r],y:e[r+1]});return n.length>0&&n.push({x:n[0].x,y:n[0].y}),n}function vP(t){if(!t)return[];const e=t.trim().split(/[\s,]+/).map(Number),n=[];for(let r=0;r<e.length;r+=2)r+1<e.length&&n.push({x:e[r],y:e[r+1]});return n}function bP(t,e,n,r){return[{x:parseFloat(t)||0,y:parseFloat(e)||0},{x:parseFloat(n)||0,y:parseFloat(r)||0}]}function wP(t,e){if(!e||!t.length)return t;const n=_P(e);return t.map(r=>kP(r,n))}function _P(t){let e=[1,0,0,1,0,0];const n=t.match(/\w+\([^)]+\)/g)||[];for(const r of n){const s=r.match(/(\w+)\(([^)]+)\)/);if(!s)continue;const i=s[1],a=s[2].split(/[\s,]+/).map(Number);let l;switch(i){case"translate":l=[1,0,0,1,a[0]||0,a[1]||0];break;case"scale":l=[a[0]||1,0,0,a[1]??a[0]??1,0,0];break;case"rotate":const c=(a[0]||0)*Math.PI/180,d=Math.cos(c),u=Math.sin(c);if(a.length===3){const p=a[1],h=a[2];l=[d,u,-u,d,p-d*p+u*h,h-u*p-d*h]}else l=[d,u,-u,d,0,0];break;case"matrix":for(l=a.slice(0,6);l.length<6;)l.push(0);break;default:continue}e=SP(e,l)}return e}function SP(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}function kP(t,e){return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}}const Qu={"#A5362F":"RH01","#E21F2F":"RH02","#609B63":"RH10","#3BB44A":"RH11","#006C55":"RH12","#0075BC":"RH20","#493D8C":"RH21","#47AFE3":"RH22","#039DC4":"RH23","#00A6A3":"RH26","#E4C4AA":"RH30","#E8E3D8":"RH31","#8B5F3C":"RH32","#E5A144":"RH40","#FFD833":"RH41","#F15B32":"RH50","#59595B":"RH60","#939598":"RH61","#D9D9D6":"RH65","#231F20":"RH70","#E8457E":"RH90"},eh={RH01:1,RH02:1,RH10:3,RH11:3,RH12:3,RH20:5,RH21:6,RH22:4,RH23:4,RH26:4,RH30:52,RH31:7,RH32:38,RH40:2,RH41:2,RH50:30,RH60:8,RH61:8,RH65:9,RH70:250,RH90:6,OUTER_BORDER:2,NOTES:4};function jP(t,e){const{widthMm:n,lengthMm:r,designName:s="TPV Design",seed:i}=e,a=new uP,l=CP(t),c=n/l.width,d=r/l.height,u=new Map,p=t.querySelectorAll("path, rect, circle, ellipse, polygon, polyline, line");for(const f of p){const m=f.getAttribute("display"),g=f.getAttribute("visibility");if(m==="none"||g==="hidden")continue;const v=EP(f);if(!v||v==="none"||v==="transparent")continue;const y=TP(v)||"UNKNOWN";u.has(y)||u.set(y,[]);const b=NP(f);if(!b||b.length===0)continue;const w=f.getAttribute("transform"),_=(w?wP(b,w):b).map(S=>({x:S.x*c,y:r-S.y*d}));u.get(y).push(_)}for(const[f,m]of u){const g=eh[f]||7;a.addLayer(f,g,"CONTINUOUS"),a.setActiveLayer(f);for(const v of m)if(v.length>=2){const x=v.length>2&&Math.abs(v[0].x-v[v.length-1].x)<.01&&Math.abs(v[0].y-v[v.length-1].y)<.01,y=v.map(b=>[b.x,b.y]);x&&y.length>1&&y.pop(),a.drawPolyline(y,x)}}a.addLayer("OUTER_BORDER",eh.OUTER_BORDER,"CONTINUOUS"),a.setActiveLayer("OUTER_BORDER"),a.drawPolyline([[0,0],[n,0],[n,r],[0,r]],!0),a.addLayer("NOTES",eh.NOTES,"CONTINUOUS"),a.setActiveLayer("NOTES");const h=[`Project: ${s}`,`Size: ${(n/1e3).toFixed(2)}m x ${(r/1e3).toFixed(2)}m`,`Generated: ${new Date().toISOString().split("T")[0]}`,i?`Seed: ${i}`:null,"TPV Studio | rosehilltpv.com"].filter(Boolean).join("\\P");return a.drawText(10,-50,100,0,h),a.toDxfString()}function CP(t){const e=t.getAttribute("viewBox");if(e){const[s,i,a,l]=e.split(/\s+/).map(Number);return{minX:s,minY:i,width:a,height:l}}const n=parseFloat(t.getAttribute("width"))||1e3,r=parseFloat(t.getAttribute("height"))||1e3;return{minX:0,minY:0,width:n,height:r}}function EP(t){const e=t.getAttribute("style");if(e){const r=e.match(/fill:\s*([^;]+)/i);if(r)return dy(r[1].trim())}const n=t.getAttribute("fill");return n?dy(n):"#000000"}function dy(t){if(!t)return null;if(t.startsWith("#"))return t.length===4?"#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]:t.toUpperCase();const e=t.match(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i);if(e){const n=parseInt(e[1]).toString(16).padStart(2,"0"),r=parseInt(e[2]).toString(16).padStart(2,"0"),s=parseInt(e[3]).toString(16).padStart(2,"0");return`#${n}${r}${s}`.toUpperCase()}return t}function TP(t){if(!t)return null;const e=t.toUpperCase();if(Qu[e])return Qu[e];let n=null,r=1/0;const s=uy(e);if(!s)return null;for(const[i,a]of Object.entries(Qu)){const l=uy(i);if(!l)continue;const c=Math.sqrt(Math.pow(s.r-l.r,2)+Math.pow(s.g-l.g,2)+Math.pow(s.b-l.b,2));c<r&&(r=c,n=a)}return r<=50?n:null}function uy(t){if(!t||!t.startsWith("#"))return null;const e=t.match(/^#([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function NP(t){switch(t.tagName.toLowerCase()){case"path":const n=t.getAttribute("d"),r=hP(n,2);return r.length>0?r[0]:[];case"rect":return mP(t.getAttribute("x"),t.getAttribute("y"),t.getAttribute("width"),t.getAttribute("height"),t.getAttribute("rx"),t.getAttribute("ry"));case"circle":return gP(t.getAttribute("cx"),t.getAttribute("cy"),t.getAttribute("r"),32);case"ellipse":return yP(t.getAttribute("cx"),t.getAttribute("cy"),t.getAttribute("rx"),t.getAttribute("ry"),32);case"polygon":return xP(t.getAttribute("points"));case"polyline":return vP(t.getAttribute("points"));case"line":return bP(t.getAttribute("x1"),t.getAttribute("y1"),t.getAttribute("x2"),t.getAttribute("y2"));default:return[]}}function PP(t,e="design.dxf"){const n=new Blob([t],{type:"application/dxf"}),r=URL.createObjectURL(n),s=document.createElement("a");s.href=r,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)}function RP(t){const e=t.cloneNode(!0),n=[".court-canvas__selection-outline",".transform-handles",".track-resize-handles",'[class*="selection"]','[class*="handle"]',"[stroke-dasharray]"];for(const r of n)e.querySelectorAll(r).forEach(s=>s.remove());return e}async function OP(t){const e=Object.values(t||{});return e.length===0?[]:(await Promise.all(e.map(async r=>{try{const s=await Ol(r.sourceDesignId),i=(s==null?void 0:s.design)||s;if(!i)return console.warn(`[EXPORT] Could not fetch design for motif ${r.id}`),null;console.log("[EXPORT] Loaded design for motif:",i.name),console.log("[EXPORT] Design has solid_recipes:",!!i.solid_recipes),console.log("[EXPORT] Design has blend_recipes:",!!i.blend_recipes);const a=r.scale||1,l=r.originalWidth_mm*a/1e3,c=r.originalHeight_mm*a/1e3,d=l*c,u=r.viewMode||"solid",p=u==="blend"?i.blend_recipes:i.solid_recipes;return console.log(`[EXPORT] Using ${u} recipes:`,(p==null?void 0:p.length)||0,"recipes"),{id:r.id,name:r.customName||r.sourceDesignName||i.name||"Motif",areaM2:d,viewMode:u,widthM:l,heightM:c,recipes:p||[]}}catch(s){return console.error(`[EXPORT] Error processing motif ${r.id}:`,s),null}}))).filter(Boolean)}function hy({svgRef:t}){const[e,n]=O.useState(!1),[r,s]=O.useState(null),i=O.useRef(null),a=lt(w=>w.exportDesignData),l=lt(w=>w.surface),c=lt(w=>w.designName),d=lt(w=>w.motifs),u=lt(w=>w.shapes),p=lt(w=>w.texts),h=lt(w=>w.exclusionZones);O.useEffect(()=>{const w=j=>{i.current&&!i.current.contains(j.target)&&n(!1)};return e&&document.addEventListener("mousedown",w),()=>{document.removeEventListener("mousedown",w)}},[e]);const f=()=>t!=null&&t.current?t.current:document.querySelector(".court-canvas__svg"),m=async()=>{s("svg");try{const w=f();if(!w)throw new Error("Canvas not found");const j=a(),_=Hf(w,j),S=Ta(j.name,"svg");pT(_,S)}catch(w){console.error("SVG export failed:",w),alert("Failed to export SVG: "+w.message)}finally{s(null),n(!1)}},g=async()=>{s("png");try{const w=f();if(!w)throw new Error("Canvas not found");const j=a(),_=Ta(j.name,"png");await fT(w,j,_,2)}catch(w){console.error("PNG export failed:",w),alert("Failed to export PNG: "+w.message)}finally{s(null),n(!1)}},v=async()=>{s("pdf"),n(!1);try{const w=f();if(!w)throw new Error("Canvas not found");const j=await Vr.getSession();if(!(j!=null&&j.access_token))throw new Error("Authentication required for PDF export");const _=a(),S=_.name||"TPV Design",E=w.cloneNode(!0);E.querySelectorAll('[class*="selected"], .transform-handles, .track-resize-handles, .court-canvas__selection-outline, [class*="selection"], [class*="handle"], [stroke-dasharray]').forEach(F=>F.remove()),E.setAttribute("xmlns","http://www.w3.org/2000/svg"),E.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");const T=new XMLSerializer().serializeToString(E);console.log("[EXPORT] Generating PDF report via API...");const M=await OP(d);console.log("[EXPORT] Motifs for PDF:",M.length);const Z=await fetch("/api/export-sports-pdf",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j.access_token}`},body:JSON.stringify({svgString:T,designName:S,surface:_.surface,courts:_.courts,tracks:_.tracks,shapes:u,texts:p,motifs:M,exclusionZones:h,dimensions:{widthMM:_.surface.width_mm,lengthMM:_.surface.length_mm}})});if(!Z.ok){const F=await Z.json().catch(()=>({error:"Unknown error"}));throw new Error(F.error||`Server error: ${Z.status}`)}const N=await Z.blob(),G=Ta(S,"pdf"),C=document.createElement("a");C.href=URL.createObjectURL(N),C.download=G,document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(C.href),console.log("[EXPORT] PDF downloaded:",G)}catch(w){console.error("PDF export failed:",w),alert("Failed to export PDF: "+w.message)}finally{s(null)}},x=async()=>{s("tiles"),n(!1);try{const w=f();if(!w)throw new Error("Canvas not found");const _=new XMLSerializer().serializeToString(w),S={width:l.width_mm,length:l.length_mm},E=c||"sports-surface",T=await M1(_,S,E),M=`${E.replace(/[^a-zA-Z0-9-_]/g,"-")}-tiles-1mx1m.zip`;L1(T,M),console.log("[EXPORT] Tiles ZIP downloaded:",M)}catch(w){console.error("Tiles export failed:",w),alert("Failed to export tiles: "+w.message)}finally{s(null)}},y=async()=>{s("dxf"),n(!1);try{const w=f();if(!w)throw new Error("Canvas not found");const j=a(),_=RP(w),S=jP(_,{widthMm:j.surface.width_mm,lengthMm:j.surface.length_mm,designName:j.name||"Sports Surface",seed:j.seed}),E=Ta(j.name,"dxf");PP(S,E),console.log("[EXPORT] DXF downloaded:",E)}catch(w){console.error("DXF export failed:",w),alert("Failed to export DXF: "+w.message)}finally{s(null)}},b=async()=>{s("canvas-pdf"),n(!1);try{const w=f();if(!w)throw new Error("Canvas not found");const j=await Vr.getSession();if(!(j!=null&&j.access_token))throw new Error("Authentication required for PDF export");const _=a(),S=_.name||"TPV Design",E=w.cloneNode(!0);E.querySelectorAll('[class*="selected"], .transform-handles, .track-resize-handles, .court-canvas__selection-outline, [class*="selection"], [class*="handle"], [stroke-dasharray]').forEach(C=>C.remove()),E.setAttribute("xmlns","http://www.w3.org/2000/svg"),E.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");const T=new XMLSerializer().serializeToString(E),M=await fetch("/api/export-canvas-pdf",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${j.access_token}`},body:JSON.stringify({svgString:T,designName:S,widthMm:_.surface.width_mm,lengthMm:_.surface.length_mm,designType:"sports"})});if(!M.ok){const C=await M.json().catch(()=>({error:"Unknown error"}));throw new Error(C.error||`Server error: ${M.status}`)}const Z=await M.blob(),N=Ta(S,"pdf").replace(".pdf","-canvas.pdf"),G=document.createElement("a");G.href=URL.createObjectURL(Z),G.download=N,document.body.appendChild(G),G.click(),document.body.removeChild(G),URL.revokeObjectURL(G.href),console.log("[EXPORT] Canvas PDF downloaded:",N)}catch(w){console.error("Canvas PDF export failed:",w),alert("Failed to export Canvas PDF: "+w.message)}finally{s(null)}};return o.jsxs("div",{className:"export-menu",ref:i,children:[o.jsxs("button",{className:"sports-toolbar__btn-export",onClick:()=>n(!e),title:"Export Design",children:["Export",o.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:e?"M18 15l-6-6-6 6":"M6 9l6 6 6-6"})})]}),e&&o.jsxs("div",{className:"export-menu__dropdown",children:[o.jsxs("button",{className:"export-menu__item",onClick:m,disabled:r!==null,children:[o.jsx("span",{className:"export-menu__icon",children:""}),o.jsxs("div",{className:"export-menu__item-content",children:[o.jsx("span",{className:"export-menu__item-title",children:r==="svg"?"Exporting...":"Download SVG"}),o.jsx("span",{className:"export-menu__item-desc",children:"Vector format for CAD/printing"})]})]}),o.jsxs("button",{className:"export-menu__item",onClick:g,disabled:r!==null,children:[o.jsx("span",{className:"export-menu__icon",children:""}),o.jsxs("div",{className:"export-menu__item-content",children:[o.jsx("span",{className:"export-menu__item-title",children:r==="png"?"Exporting...":"Download PNG"}),o.jsx("span",{className:"export-menu__item-desc",children:"High-res image for presentations"})]})]}),o.jsxs("button",{className:"export-menu__item",onClick:x,disabled:r!==null,children:[o.jsx("span",{className:"export-menu__icon",children:""}),o.jsxs("div",{className:"export-menu__item-content",children:[o.jsx("span",{className:"export-menu__item-title",children:r==="tiles"?"Generating...":"Download Tiles ZIP"}),o.jsx("span",{className:"export-menu__item-desc",children:"1m1m SVG tiles for large-format printing"})]})]}),o.jsx("div",{className:"export-menu__divider"}),o.jsxs("button",{className:"export-menu__item",onClick:v,disabled:r!==null,children:[o.jsx("span",{className:"export-menu__icon",children:""}),o.jsxs("div",{className:"export-menu__item-content",children:[o.jsx("span",{className:"export-menu__item-title",children:r==="pdf"?"Generating...":"Materials Report (PDF)"}),o.jsx("span",{className:"export-menu__item-desc",children:"TPV quantities & specifications"})]})]}),o.jsxs("button",{className:"export-menu__item",onClick:b,disabled:r!==null,children:[o.jsx("span",{className:"export-menu__icon",children:""}),o.jsxs("div",{className:"export-menu__item-content",children:[o.jsx("span",{className:"export-menu__item-title",children:r==="canvas-pdf"?"Generating...":"Canvas PDF (1:100)"}),o.jsx("span",{className:"export-menu__item-desc",children:"Scaled design with dimensions"})]})]}),o.jsx("div",{className:"export-menu__divider"}),o.jsxs("button",{className:"export-menu__item",onClick:y,disabled:r!==null,children:[o.jsx("span",{className:"export-menu__icon",children:""}),o.jsxs("div",{className:"export-menu__item-content",children:[o.jsx("span",{className:"export-menu__item-title",children:r==="dxf"?"Exporting...":"Download DXF"}),o.jsx("span",{className:"export-menu__item-desc",children:"CAD format for AutoCAD/Rhino"})]})]})]})]})}function AP({isOpen:t,onClose:e}){if(!t)return null;const n=[{category:"Selection",items:[{keys:["Delete"],description:"Remove selected element"},{keys:["Escape"],description:"Deselect / exit group edit"}]},{category:"Edit",items:[{keys:["Ctrl","Z"],description:"Undo"},{keys:["Ctrl","Shift","Z"],description:"Redo"},{keys:["Ctrl","D"],description:"Duplicate selected"},{keys:["Ctrl","C"],description:"Copy selection"},{keys:["Ctrl","V"],description:"Paste"}]},{category:"Groups",items:[{keys:["Ctrl","G"],description:"Group selected elements"},{keys:["Ctrl","Shift","G"],description:"Ungroup selected group"}]},{category:"Move",items:[{keys:["Arrow Keys"],description:"Nudge element (10mm)"},{keys:["Shift","Arrow Keys"],description:"Large nudge (100mm)"}]},{category:"Layers",items:[{keys:["["],description:"Send backward"},{keys:["]"],description:"Bring forward"}]},{category:"View",items:[{keys:["G"],description:"Toggle snap to grid"},{keys:["?"],description:"Show this help"}]}],s=navigator.platform.toUpperCase().indexOf("MAC")>=0?"":"Ctrl";return o.jsx("div",{className:"keyboard-shortcuts-overlay",onClick:e,style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},children:o.jsxs("div",{className:"keyboard-shortcuts-modal",onClick:i=>i.stopPropagation(),style:{background:"#fff",borderRadius:"8px",padding:"24px",maxWidth:"480px",width:"90%",maxHeight:"80vh",overflow:"auto",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.2)"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[o.jsx("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:600},children:"Keyboard Shortcuts"}),o.jsx("button",{onClick:e,style:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer",padding:"4px 8px",color:"#666"},"aria-label":"Close",children:""})]}),n.map(i=>o.jsxs("div",{style:{marginBottom:"20px"},children:[o.jsx("h3",{style:{fontSize:"0.75rem",fontWeight:600,textTransform:"uppercase",color:"#666",marginBottom:"8px",letterSpacing:"0.5px"},children:i.category}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:i.items.map((a,l)=>o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"4px 0"},children:[o.jsx("span",{style:{color:"#333",fontSize:"0.9rem"},children:a.description}),o.jsx("div",{style:{display:"flex",gap:"4px"},children:a.keys.map((c,d)=>o.jsx("kbd",{style:{display:"inline-block",padding:"4px 8px",fontSize:"0.75rem",fontFamily:"system-ui, -apple-system, sans-serif",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:"4px",boxShadow:"0 1px 2px rgba(0,0,0,0.1)",minWidth:"24px",textAlign:"center"},children:c==="Ctrl"?s:c},d))})]},l))})]},i.category)),o.jsxs("p",{style:{fontSize:"0.8rem",color:"#888",marginTop:"16px",paddingTop:"16px",borderTop:"1px solid #eee",marginBottom:0},children:["Press ",o.jsx("kbd",{style:{padding:"2px 6px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:"3px",fontSize:"0.75rem"},children:"?"})," at any time to show this help"]})]})})}class MP{async _getAuthHeaders(){const e=await Vr.getSession(),n={"Content-Type":"application/json"};return e!=null&&e.access_token&&(n.Authorization=`Bearer ${e.access_token}`),n}async generateRecraft(e){const n={prompt:e.prompt,width_mm:e.widthMM||5e3,length_mm:e.lengthMM||5e3,max_colours:e.maxColours||6,seed:e.seed||null},r=await this._getAuthHeaders(),s=await fetch("/api/recraft-generate",{method:"POST",headers:r,body:JSON.stringify(n)});if(!s.ok){const i=await s.json();throw new Error(i.error||"Recraft generation failed")}return s.json()}async vectorizeImage(e){const n={image_url:e.image_url,width_mm:e.width_mm||5e3,length_mm:e.length_mm||5e3,seed:e.seed||null},r=await this._getAuthHeaders(),s=await fetch("/api/recraft-vectorize",{method:"POST",headers:r,body:JSON.stringify(n)});if(!s.ok){const i=await s.json();throw new Error(i.error||"Vectorization failed")}return s.json()}async processUploadedSVG(e){const n={svg_url:e.svg_url,width_mm:e.width_mm||5e3,length_mm:e.length_mm||5e3},r=await this._getAuthHeaders(),s=await fetch("/api/process-uploaded-svg",{method:"POST",headers:r,body:JSON.stringify(n)});if(!s.ok){const i=await s.json();throw new Error(i.error||"SVG processing failed")}return s.json()}async getRecraftStatus(e){const n=await this._getAuthHeaders(),r=await fetch(`/api/studio-job-status?jobId=${e}`,{headers:n});if(!r.ok){const s=await r.json();throw new Error(s.error||"Status fetch failed")}return r.json()}async waitForRecraftCompletion(e,n=null,r=2e3){return new Promise((s,i)=>{const a=async()=>{var l,c,d,u;try{const p=await this.getRecraftStatus(e);n&&n(p),p.status==="completed"?((l=p.result)==null?void 0:l.svg_url)?(console.log("[API] Recraft job complete with SVG output"),s(p)):(console.error("[API] Recraft job completed but no SVG output"),i(new Error("Job completed but no output received"))):p.status==="failed"?(c=p.result)!=null&&c.svg_url?(console.warn("[API] Job failed compliance but has output (non-compliant)"),s(p)):i(new Error(p.error||"Job failed")):(p.status==="retrying"&&console.log(`[API] Retrying: ${(d=p.recraft)==null?void 0:d.attempt_current}/${(u=p.recraft)==null?void 0:u.attempt_max}`),setTimeout(a,r))}catch(p){i(p)}};a()})}async matchColor(e,n=2){const r=await fetch("/api/match-color",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hex:e,max_components:n})});if(!r.ok){const s=await r.json();throw new Error(s.error||"Color matching failed")}return r.json()}async generateDesignName(e){const n={prompt:e.prompt,colors:e.colors||[],dimensions:e.dimensions||{}},r=await this._getAuthHeaders(),s=await fetch("/api/generate-design-name",{method:"POST",headers:r,body:JSON.stringify(n)});if(!s.ok){const i=await s.json();throw new Error(i.error||"Name generation failed")}return s.json()}async inspireSimpleCreateJob(e){const n={prompt:e.prompt,surface:{width_mm:e.lengthMM||5e3,height_mm:e.widthMM||5e3},max_colours:e.maxColours||6,try_simpler:e.trySimpler||!1};e.seed&&(n.seed=e.seed);const r=await fetch("/api/studio-inspire-simple",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok){const s=await r.json();throw new Error(s.message||"Unable to start design generation. Please check your connection and try again.")}return r.json()}async inspireSimpleGetStatus(e){const n=await this._getAuthHeaders(),r=await fetch(`/api/studio-job-status?jobId=${e}`,{headers:n});if(!r.ok){const s=await r.json();throw new Error(s.message||"Unable to check generation status. Please try again.")}return r.json()}async inspireSimpleWaitForCompletion(e,n=null,r=2e3){return new Promise((s,i)=>{const a=async()=>{var l;try{const c=await this.inspireSimpleGetStatus(e);n&&n(c),c.status==="completed"?((l=c.result)==null?void 0:l.final_url)?(console.log("[API] Job complete with JPG output, resolving"),s(c)):(console.log("[API] Job completed but no output received"),i(new Error("Job completed but no output received"))):c.status==="failed"?i(new Error(c.error||"Job failed")):setTimeout(a,r)}catch(c){i(c)}};a()})}async draftify(e){const n=await fetch(T0.DRAFTIFY,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok){const r=await n.json();throw new Error(r.message||"Unable to convert image to vector format. Please try a different image.")}return n.json()}async generateGeometric(e){const n={brief:e.prompt||e.brief,canvas:{width_mm:e.lengthMM||5e3,height_mm:e.widthMM||5e3},options:{mood:e.mood||"playful",composition:e.composition||"mixed",colorCount:e.maxColours||e.colorCount||5,seed:e.seed},validate:!0},r=await fetch(T0.GEOMETRIC_GENERATE,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok){const s=await r.json();throw new Error(s.message||"Unable to generate design. Please try a different prompt or settings.")}return r.json()}}const gi=new MP;function $P({recipes:t,onClose:e}){if(!t||t.length===0)return o.jsxs("div",{className:"solid-summary-empty",children:[o.jsx("p",{children:"No colours in design."}),o.jsx("button",{onClick:e,className:"close-button",children:"Close"})]});const n=t.reduce((r,s)=>r+s.targetColor.areaPct,0);return o.jsxs("div",{className:"solid-color-summary",children:[o.jsxs("div",{className:"summary-header",children:[o.jsx("h3",{children:"TPV Colours Used"}),o.jsx("button",{onClick:e,className:"close-button-icon",children:""})]}),o.jsx("div",{className:"summary-info",children:o.jsxs("p",{className:"summary-description",children:["This design uses ",o.jsx("strong",{children:t.length})," pure TPV colour",t.length!==1?"s":""," (no blending required)"]})}),o.jsx("div",{className:"colors-list",children:t.map((r,s)=>{const i=r.chosenRecipe.components[0],a=r.targetColor.areaPct;return o.jsxs("div",{className:"color-item",children:[o.jsx("div",{className:"color-swatch",style:{backgroundColor:r.blendColor.hex},title:`${i.code} - ${i.name}`}),o.jsxs("div",{className:"color-details",children:[o.jsxs("div",{className:"color-primary",children:[o.jsx("span",{className:"color-code",children:i.code}),o.jsx("span",{className:"color-name",children:i.name})]}),o.jsxs("div",{className:"color-secondary",children:[o.jsx("span",{className:"hex-value",children:r.blendColor.hex}),o.jsxs("span",{className:"coverage-badge",children:[a.toFixed(1),"%"]})]})]})]},s)})}),o.jsxs("div",{className:"summary-footer",children:[o.jsxs("div",{className:"footer-stat",children:[o.jsx("span",{className:"stat-label",children:"Total Coverage:"}),o.jsxs("span",{className:"stat-value",children:[n.toFixed(1),"%"]})]}),o.jsxs("div",{className:"footer-stat",children:[o.jsx("span",{className:"stat-label",children:"TPV Colours:"}),o.jsx("span",{className:"stat-value",children:t.length})]})]}),o.jsx("style",{jsx:!0,children:`
        .solid-color-summary {
          background: #fff;
          border-radius: 8px;
          border: 1px solid #ddd;
          padding: 2rem;
          max-width: 800px;
          margin: 2rem auto;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .solid-summary-empty {
          background: #fff;
          border-radius: 8px;
          padding: 2rem;
          text-align: center;
        }

        .summary-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1.5rem;
          padding-bottom: 1rem;
          border-bottom: 2px solid #1a365d;
        }

        .summary-header h3 {
          margin: 0;
          color: #1a365d;
          font-size: 1.8rem;
        }

        .close-button-icon {
          background: none;
          border: none;
          font-size: 2rem;
          color: #666;
          cursor: pointer;
          padding: 0;
          width: 32px;
          height: 32px;
          line-height: 1;
          transition: color 0.2s;
        }

        .close-button-icon:hover {
          color: #333;
        }

        .summary-info {
          background: #f9f9f9;
          padding: 1rem;
          border-radius: 6px;
          margin-bottom: 1.5rem;
        }

        .summary-description {
          margin: 0;
          color: #333;
          font-size: 1rem;
          line-height: 1.5;
        }

        /* Colors List */
        .colors-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
          margin-bottom: 1.5rem;
        }

        .color-item {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem;
          background: #f9f9f9;
          border-radius: 6px;
          border: 1px solid #e0e0e0;
          transition: all 0.2s;
        }

        .color-item:hover {
          border-color: #ff6b35;
          box-shadow: 0 2px 8px rgba(255, 107, 53, 0.15);
        }

        .color-swatch {
          width: 60px;
          height: 60px;
          border-radius: 8px;
          border: 2px solid #ddd;
          flex-shrink: 0;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .color-details {
          flex: 1;
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .color-primary {
          display: flex;
          align-items: baseline;
          gap: 0.5rem;
        }

        .color-code {
          font-family: 'Courier New', monospace;
          font-weight: 700;
          font-size: 1.2rem;
          color: #1a365d;
        }

        .color-name {
          font-size: 1.1rem;
          color: #333;
          font-weight: 500;
        }

        .color-secondary {
          display: flex;
          align-items: center;
          gap: 1rem;
        }

        .hex-value {
          font-family: 'Courier New', monospace;
          font-size: 0.9rem;
          color: #666;
        }

        .coverage-badge {
          background: #ff6b35;
          color: white;
          padding: 0.25rem 0.75rem;
          border-radius: 12px;
          font-weight: 600;
          font-size: 0.9rem;
        }

        /* Summary Footer */
        .summary-footer {
          display: flex;
          justify-content: space-around;
          padding: 1.5rem;
          background: #f9f9f9;
          border-radius: 6px;
          border: 2px solid #ff6b35;
        }

        .footer-stat {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 0.5rem;
        }

        .stat-label {
          font-size: 0.9rem;
          color: #666;
          font-weight: 500;
        }

        .stat-value {
          font-size: 1.5rem;
          font-weight: 700;
          color: #1a365d;
        }

        .close-button {
          padding: 0.75rem 1.5rem;
          background: #ff6b35;
          color: white;
          border: none;
          border-radius: 4px;
          font-weight: 600;
          cursor: pointer;
          transition: background 0.2s;
        }

        .close-button:hover {
          background: #e55a25;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
          .solid-color-summary {
            padding: 1rem;
          }

          .summary-header h3 {
            font-size: 1.4rem;
          }

          .color-item {
            flex-direction: column;
            align-items: flex-start;
          }

          .color-swatch {
            width: 100%;
            height: 50px;
          }

          .summary-footer {
            flex-direction: column;
            gap: 1rem;
          }
        }
      `})]})}function Wf({content:t,position:e="top"}){const[n,r]=O.useState(!1);return o.jsxs("div",{className:"help-icon-container",children:[o.jsx("button",{className:"help-icon",onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),onClick:s=>{s.preventDefault(),s.stopPropagation(),r(!n)},type:"button","aria-label":"Help",children:"?"}),n&&o.jsx("div",{className:`help-tooltip help-tooltip-${e}`,children:t}),o.jsx("style",{children:`
        .help-icon-container {
          position: relative;
          display: inline-block;
        }

        .help-icon {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          width: 18px;
          height: 18px;
          border-radius: 50%;
          background: #6b7280;
          color: white;
          border: none;
          font-size: 12px;
          font-weight: 600;
          cursor: help;
          transition: all 0.2s;
          padding: 0;
          line-height: 1;
        }

        .help-icon:hover {
          background: #374151;
          transform: scale(1.1);
        }

        .help-tooltip {
          position: absolute;
          z-index: 1000;
          background: #1f2937;
          color: white;
          padding: 0.75rem 1rem;
          border-radius: 6px;
          font-size: 0.875rem;
          line-height: 1.5;
          max-width: 300px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
          pointer-events: none;
          white-space: normal;
        }

        .help-tooltip-top {
          bottom: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
        }

        .help-tooltip-top::after {
          content: '';
          position: absolute;
          top: 100%;
          left: 50%;
          transform: translateX(-50%);
          border: 6px solid transparent;
          border-top-color: #1f2937;
        }

        .help-tooltip-bottom {
          top: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
        }

        .help-tooltip-bottom::after {
          content: '';
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          border: 6px solid transparent;
          border-bottom-color: #1f2937;
        }

        .help-tooltip-right {
          left: calc(100% + 8px);
          top: 50%;
          transform: translateY(-50%);
        }

        .help-tooltip-right::after {
          content: '';
          position: absolute;
          right: 100%;
          top: 50%;
          transform: translateY(-50%);
          border: 6px solid transparent;
          border-right-color: #1f2937;
        }

        .help-tooltip-left {
          right: calc(100% + 8px);
          top: 50%;
          transform: translateY(-50%);
        }

        .help-tooltip-left::after {
          content: '';
          position: absolute;
          left: 100%;
          top: 50%;
          transform: translateY(-50%);
          border: 6px solid transparent;
          border-left-color: #1f2937;
        }

        @media (max-width: 768px) {
          .help-tooltip {
            max-width: 250px;
            font-size: 0.8125rem;
            padding: 0.625rem 0.875rem;
          }
        }
      `})]})}function LP({recipes:t,mode:e="blend",onColorClick:n,selectedColor:r,editedColors:s,onResetAll:i}){if(!t||t.length===0)return null;const a=h=>!s||s.size===0?!1:s.has(h.originalColor.hex.toLowerCase()),l=h=>{if(!s||s.size===0)return!1;const f=s.get(h.originalColor.hex.toLowerCase());return(f==null?void 0:f.newHex)==="transparent"||(f==null?void 0:f.newHex)==="none"},c=s&&s.size>0,d=h=>{const f=h.toLowerCase();return fn.find(m=>m.hex.toLowerCase()===f)},u=h=>{if(l(h))return"Transparent";if(e==="solid"){const f=d(h.blendColor.hex);if(f)return`${f.code} - ${f.name}`}return h.blendColor.hex},p=h=>{if(!r)return!1;const f=r.blendHex||r.hex;return h.blendColor.hex===f||h.targetColor.hex===f};return o.jsxs("div",{className:"color-legend",children:[o.jsxs("div",{className:"legend-header",children:[o.jsxs("div",{className:"legend-header-left",children:[o.jsx("span",{className:"legend-title",children:"Colours"}),o.jsx(Wf,{content:"Click any colour to edit all instances of that colour across the design. Changes apply to every region using that colour.",position:"right"}),n&&o.jsx("span",{className:"edit-hint",children:"(click to edit)"})]}),c&&i&&o.jsx("button",{onClick:i,className:"reset-all-btn",title:"Reset all colours to original",children:"Reset All"})]}),o.jsx("div",{className:"legend-colors",children:t.map((h,f)=>o.jsxs("div",{className:`color-item ${n?"clickable":""} ${p(h)?"selected":""}`,onClick:()=>{n&&n({hex:h.targetColor.hex,originalHex:h.originalColor.hex,blendHex:h.blendColor.hex,areaPct:h.targetColor.areaPct,recipe:h.chosenRecipe,targetColor:h.targetColor,isAddedFromEdit:h.isAddedFromEdit||!1,chosenRecipe:h.chosenRecipe},"palette")},title:n?"Click to edit this colour":"",children:[o.jsxs("div",{className:"color-swatch-wrapper",children:[o.jsx("div",{className:`color-swatch ${l(h)?"transparent-swatch":""}`,style:l(h)?{}:{backgroundColor:h.blendColor.hex}}),l(h)&&o.jsx("span",{className:"transparent-indicator",title:"Made transparent",children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",width:"14",height:"14",children:[o.jsx("circle",{cx:"12",cy:"12",r:"10"}),o.jsx("line",{x1:"4",y1:"4",x2:"20",y2:"20"})]})}),a(h)&&!l(h)&&o.jsx("span",{className:"edit-indicator",title:"Colour has been modified",children:o.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"12",height:"12",children:o.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"})})})]}),o.jsxs("div",{className:"color-info",children:[o.jsx("span",{className:e==="solid"?"tpv-label":"hex-value",children:u(h)}),o.jsxs("span",{className:"coverage",children:[h.targetColor.areaPct.toFixed(1),"%"]})]})]},f))}),o.jsx("style",{jsx:!0,children:`
        .color-legend {
          background: rgba(255, 255, 255, 0.95);
          border: 1px solid #ddd;
          border-radius: 8px;
          padding: 1rem;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
          width: 100%;
        }

        .legend-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          gap: 0.5rem;
          margin-bottom: 0.75rem;
          padding-bottom: 0.5rem;
          border-bottom: 1px solid #e0e0e0;
        }

        .legend-header-left {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .legend-title {
          font-weight: 600;
          color: #1a365d;
          font-size: 0.95rem;
        }

        .edit-hint {
          font-size: 0.75rem;
          color: #ff6b35;
          font-weight: normal;
        }

        .reset-all-btn {
          padding: 0.25rem 0.5rem;
          font-size: 0.7rem;
          font-weight: 600;
          color: #ff6b35;
          background: #fff5f0;
          border: 1px solid #ff6b35;
          border-radius: 4px;
          cursor: pointer;
          transition: all 0.2s;
        }

        .reset-all-btn:hover {
          background: #ff6b35;
          color: white;
        }

        .legend-colors {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
          gap: 0.75rem;
        }

        .color-item {
          display: flex;
          align-items: center;
          gap: 0.75rem;
          padding: 0.5rem;
          border-radius: 4px;
          background: white;
          border: 1px solid #e8e8e8;
          transition: all 0.2s;
        }

        .color-item.clickable {
          cursor: pointer;
        }

        .color-item.clickable:hover {
          border-color: #ff6b35;
          background: #fff9f7;
          box-shadow: 0 2px 4px rgba(255, 107, 53, 0.15);
          transform: translateY(-2px);
        }

        .color-item.selected {
          border-color: #ff6b35;
          border-width: 2px;
          background: #fff9f7;
          box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.2);
          transform: translateY(-2px);
        }

        .color-swatch-wrapper {
          position: relative;
          flex-shrink: 0;
        }

        .color-swatch {
          width: 40px;
          height: 40px;
          border-radius: 4px;
          border: 2px solid #ddd;
        }

        .color-swatch.transparent-swatch {
          background:
            linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%),
            linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%);
          background-size: 8px 8px;
          background-position: 0 0, 4px 4px;
          background-color: white;
          border-color: #999;
        }

        .transparent-indicator {
          position: absolute;
          top: -4px;
          right: -4px;
          width: 18px;
          height: 18px;
          background: #6b7280;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .transparent-indicator svg {
          width: 12px;
          height: 12px;
        }

        .edit-indicator {
          position: absolute;
          top: -4px;
          right: -4px;
          width: 16px;
          height: 16px;
          background: #ff6b35;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .edit-indicator svg {
          width: 10px;
          height: 10px;
        }

        .color-info {
          display: flex;
          flex-direction: column;
          gap: 0.25rem;
          font-size: 0.85rem;
        }

        .hex-value {
          font-family: 'Courier New', monospace;
          font-weight: 600;
          color: #333;
        }

        .tpv-label {
          font-weight: 600;
          color: #1a365d;
          font-size: 0.9rem;
        }

        .coverage {
          color: #666;
          font-size: 0.8rem;
        }

        /* Mobile - compact horizontal grid of swatches */
        @media (max-width: 768px) {
          .color-legend {
            padding: 0.75rem;
          }

          .legend-header {
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
          }

          .legend-title {
            font-size: 0.85rem;
          }

          .edit-hint {
            font-size: 0.7rem;
          }

          .reset-all-btn {
            font-size: 0.65rem;
            padding: 0.2rem 0.4rem;
            min-height: 28px;
          }

          /* Horizontal scrolling grid of swatches */
          .legend-colors {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: flex-start;
          }

          .color-item {
            flex-direction: column;
            padding: 0.25rem;
            border-radius: 6px;
            width: auto;
            min-width: 44px;
          }

          /* Hide text info on mobile - just show swatches */
          .color-info {
            display: none;
          }

          .color-swatch {
            width: 44px;
            height: 44px;
            border-radius: 6px;
          }

          .color-item.selected {
            transform: none;
            box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.4);
          }

          .color-item.clickable:hover {
            transform: none;
          }

          .edit-indicator {
            top: -2px;
            right: -2px;
            width: 14px;
            height: 14px;
          }

          .edit-indicator svg {
            width: 8px;
            height: 8px;
          }
        }

        @media (max-width: 480px) {
          .color-legend {
            padding: 0.5rem;
          }

          .legend-colors {
            gap: 0.35rem;
          }

          .color-swatch {
            width: 40px;
            height: 40px;
          }

          .color-item {
            min-width: 40px;
          }
        }
      `})]})}const DP=[{code:"RH01",name:"Standard Red",hex:"#A5362F"},{code:"RH02",name:"Bright Red",hex:"#E21F2F"},{code:"RH10",name:"Standard Green",hex:"#609B63"},{code:"RH11",name:"Bright Green",hex:"#3BB44A"},{code:"RH12",name:"Dark Green",hex:"#006C55"},{code:"RH20",name:"Standard Blue",hex:"#0075BC"},{code:"RH21",name:"Purple",hex:"#493D8C"},{code:"RH22",name:"Light Blue",hex:"#47AFE3"},{code:"RH23",name:"Azure",hex:"#039DC4"},{code:"RH26",name:"Turquoise",hex:"#00A6A3"},{code:"RH30",name:"Standard Beige",hex:"#E4C4AA"},{code:"RH31",name:"Cream",hex:"#E8E3D8"},{code:"RH32",name:"Brown",hex:"#8B5F3C"},{code:"RH90",name:"Funky Pink",hex:"#E8457E"},{code:"RH40",name:"Mustard Yellow",hex:"#E5A144"},{code:"RH41",name:"Bright Yellow",hex:"#FFD833"},{code:"RH50",name:"Orange",hex:"#F15B32"},{code:"RH60",name:"Dark Grey",hex:"#59595B"},{code:"RH61",name:"Light Grey",hex:"#939598"},{code:"RH65",name:"Pale Grey",hex:"#D9D9D6"},{code:"RH70",name:"Black",hex:"#231F20"}];function IP({blendSvgUrl:t,recipes:e,mode:n="blend",onColorClick:r,onRegionClick:s,onEyedropperCancel:i,onMakeTransparent:a,onSelectTPVColor:l,selectedColor:c,editedColors:d,onResetAll:u,designName:p="",onNameChange:h,isNameLoading:f=!1,onInSituClick:m,eyedropperActive:g=!1,eyedropperRegion:v=null,onRegionUndo:x,onRegionRedo:y,canUndo:b=!1,canRedo:w=!1,regionOverridesCount:j=0}){const[_,S]=O.useState(null),[E,T]=O.useState(null),M=O.useRef(null),Z=O.useRef(null);O.useRef(null);const[N,G]=O.useState(1),[C,F]=O.useState({x:0,y:0}),[pe,V]=O.useState(!1),[J,I]=O.useState({x:0,y:0}),K=O.useRef(null),z=O.useRef(!1),[W,fe]=O.useState(()=>localStorage.getItem("tpv_color_editing_tip_dismissed")!=="true"),ue=()=>{fe(!1),localStorage.setItem("tpv_color_editing_tip_dismissed","true")};O.useEffect(()=>{if(!t){T(null);return}(async()=>{try{const Y=await(await fetch(t)).text();T(Y);const se=Y.includes("data-region-id"),B=(Y.match(/data-region-id/g)||[]).length;console.log("[SVGPreview] Fetched inline SVG content - length:",Y.length,"hasRegionTags:",se,"regionCount:",B)}catch($){console.error("[SVGPreview] Failed to fetch SVG content:",$),T(null)}})()},[t]);const ne=O.useMemo(()=>{if(!E)return null;console.log("[SVGPreview] Sanitizing SVG content...");const P=zf(E);return P?(console.log("[SVGPreview] SVG sanitization complete - length:",P.length),console.log("[SVGPreview] Sanitized content preview:",P.substring(0,200)),P.includes("<svg")?P.replace(/<svg([^>]*)>/i,(Y,se)=>(se.includes("width=")||(se+=' width="100%"'),se.includes("height=")||(se+=' height="100%"'),`<svg${se}>`)):(console.error("[SVGPreview] Sanitized SVG does not contain <svg> tag!"),null)):(console.error("[SVGPreview] SVG sanitization failed - content rejected"),null)},[E]);O.useEffect(()=>{if(!c||!t){S(null);return}(async()=>{try{console.log("[SVGPreview] Creating highlight for color:",c);const $=new Image;$.crossOrigin="anonymous";const Y=new Promise((Ee,ie)=>{$.onload=()=>{console.log("[SVGPreview] Image loaded:",$.width,"x",$.height),Ee()},$.onerror=he=>{console.error("[SVGPreview] Image load error:",he),ie(he)}});$.src=t,await Y;const se=document.createElement("canvas");se.width=$.naturalWidth||$.width||1e3,se.height=$.naturalHeight||$.height||1e3;const B=se.getContext("2d");B.drawImage($,0,0);const ye=B.getImageData(0,0,se.width,se.height).data,le=c.hex,U=ke(le);console.log("[SVGPreview] Target color:",le,U);const ae=new Set;let xe=0;for(let Ee=0;Ee<se.height;Ee++)for(let ie=0;ie<se.width;ie++){const he=(Ee*se.width+ie)*4,Xe=ye[he],tt=ye[he+1],nt=ye[he+2];ye[he+3]>0&&ce(Xe,tt,nt,U)&&(ae.add(`${ie},${Ee}`),xe++)}if(console.log("[SVGPreview] Matched pixels:",xe),xe===0){console.warn("[SVGPreview] No pixels matched the target color"),S(null);return}const Te=B.createImageData(se.width,se.height);for(let Ee=0;Ee<se.height;Ee++)for(let ie=0;ie<se.width;ie++){const he=(Ee*se.width+ie)*4;ae.has(`${ie},${Ee}`)&&(!ae.has(`${ie-1},${Ee}`)||!ae.has(`${ie+1},${Ee}`)||!ae.has(`${ie},${Ee-1}`)||!ae.has(`${ie},${Ee+1}`))&&(Te.data[he]=255,Te.data[he+1]=0,Te.data[he+2]=255,Te.data[he+3]=255)}B.clearRect(0,0,se.width,se.height),B.putImageData(Te,0,0);const He=se.toDataURL();console.log("[SVGPreview] Highlight mask created"),S(He)}catch($){console.error("[SVGPreview] Failed to create highlight mask:",$),S(null)}})()},[c,t]);const ke=P=>{const $=P.replace("#","");return{r:parseInt($.substring(0,2),16),g:parseInt($.substring(2,4),16),b:parseInt($.substring(4,6),16)}},ce=(P,$,Y,se)=>Math.abs(P-se.r)<=50&&Math.abs($-se.g)<=50&&Math.abs(Y-se.b)<=50,$e=async(P,$)=>{try{if(!M.current||!t)return null;const Y=new Image;Y.crossOrigin="anonymous";const se=new Promise((Ee,ie)=>{Y.onload=Ee,Y.onerror=ie});Y.src=t,await se;const B=document.createElement("canvas");B.width=Y.naturalWidth||Y.width||1e3,B.height=Y.naturalHeight||Y.height||1e3;const re=B.getContext("2d");re.drawImage(Y,0,0);const ye=M.current.getBoundingClientRect(),le=B.width/ye.width,U=B.height/ye.height,ae=Math.floor(P*le),xe=Math.floor($*U),He=re.getImageData(ae,xe,1,1).data;return{r:He[0],g:He[1],b:He[2],a:He[3]}}catch(Y){return console.error("[SVGPreview] Failed to get color at position:",Y),null}},ze=()=>{G(P=>Math.min(P*1.5,5))},Ue=()=>{G(P=>Math.max(P/1.5,.5))},Ge=()=>{G(1),F({x:0,y:0})},at=P=>{P.preventDefault();const $=P.deltaY*-.001;G(Y=>Math.min(Math.max(Y+$,.5),5))},Ve=P=>{P.button===0&&(V(!0),I({x:P.clientX-C.x,y:P.clientY-C.y}),z.current=!1)},k=P=>{if(!pe)return;const $=Math.abs(P.clientX-(J.x+C.x)),Y=Math.abs(P.clientY-(J.y+C.y));($>5||Y>5)&&(z.current=!0),F({x:P.clientX-J.x,y:P.clientY-J.y})},Q=()=>{V(!1)};O.useEffect(()=>{if(pe)return document.addEventListener("mousemove",k),document.addEventListener("mouseup",Q),()=>{document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",Q)}},[pe,J,C]);const oe=P=>{let $=P;for(;$&&$!==Z.current;){if($.hasAttribute&&$.hasAttribute("data-region-id"))return $;$=$.parentElement}return null},D=async P=>{var le,U;if(z.current){console.log("[SVGPreview] Click ignored - was dragging");return}if(console.log("[SVGPreview] Click detected - onRegionClick:",!!s,"inlineSvgContent:",!!E,"target:",P.target.tagName),s&&E){console.log("[SVGPreview] Attempting region detection on target:",P.target);const ae=oe(P.target);if(console.log("[SVGPreview] Found region element:",ae),ae){const xe=ae.getAttribute("data-region-id"),Te=ae.getAttribute("fill")||((U=(le=ae.getAttribute("style"))==null?void 0:le.match(/fill:\s*([^;]+)/))==null?void 0:U[1]);console.log("[SVGPreview] Region clicked:",xe,"fill:",Te),s({regionId:xe,sourceColor:Te,element:ae});return}else console.log("[SVGPreview] No region element found from target")}else console.log("[SVGPreview] Region detection skipped - onRegionClick:",!!s,"inlineSvgContent:",!!E);if(!r||!e||e.length===0)return;const $=P.currentTarget.getBoundingClientRect(),Y=P.clientX-$.left,se=P.clientY-$.top;console.log("[SVGPreview] Clicked at:",Y,se);const B=await $e(Y,se);if(!B||B.a===0){console.log("[SVGPreview] Clicked on transparent area");return}console.log("[SVGPreview] Clicked color:",B);let re=null,ye=1/0;for(const ae of e){const xe=ae.targetColor.hex,Te=ke(xe);if(ce(B.r,B.g,B.b,Te)){const He=Math.sqrt(Math.pow(B.r-Te.r,2)+Math.pow(B.g-Te.g,2)+Math.pow(B.b-Te.b,2));He<ye&&(ye=He,re=ae)}}re?(console.log("[SVGPreview] Matched recipe:",re.targetColor.hex),r({hex:re.targetColor.hex,originalHex:re.originalColor.hex,blendHex:re.blendColor.hex,areaPct:re.targetColor.areaPct,recipe:re.chosenRecipe,targetColor:re.targetColor,isAddedFromEdit:re.isAddedFromEdit||!1,chosenRecipe:re.chosenRecipe})):console.log("[SVGPreview] No matching recipe found for clicked color")};return t?o.jsxs("div",{className:"svg-preview",children:[o.jsxs("div",{className:"preview-header",children:[o.jsxs("div",{className:"design-name-container",children:[h?o.jsx("input",{type:"text",className:"design-name-input",value:p,onChange:P=>h(P.target.value),placeholder:f?"Generating name...":"Enter project name"}):o.jsx("h3",{children:p||"TPV Blend Design"}),f&&o.jsx("span",{className:"name-loading",children:"Generating..."})]}),c&&o.jsxs("span",{className:"editing-hint",children:["Editing: ",c.hex||c.blendHex]})]}),W&&r&&o.jsxs("div",{className:"color-editing-tip",children:[o.jsx("div",{className:"tip-icon",children:""}),o.jsxs("div",{className:"tip-content",children:[o.jsx("strong",{children:"Tip:"})," Click colours in the legend below to edit all instances, or click directly on the design to edit individual regions."]}),o.jsx("button",{onClick:ue,className:"tip-close",title:"Dismiss tip",children:""})]}),o.jsxs("div",{className:"svg-display-container",children:[o.jsxs("div",{className:"svg-panel",children:[o.jsxs("div",{className:"zoom-controls",children:[o.jsx("button",{onClick:ze,className:"zoom-btn",title:"Zoom In",children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"11",cy:"11",r:"8"}),o.jsx("line",{x1:"11",y1:"8",x2:"11",y2:"14"}),o.jsx("line",{x1:"8",y1:"11",x2:"14",y2:"11"}),o.jsx("path",{d:"m21 21-4.35-4.35"})]})}),o.jsx("button",{onClick:Ue,className:"zoom-btn",title:"Zoom Out",children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"11",cy:"11",r:"8"}),o.jsx("line",{x1:"8",y1:"11",x2:"14",y2:"11"}),o.jsx("path",{d:"m21 21-4.35-4.35"})]})}),o.jsx("button",{onClick:Ge,className:"zoom-btn",title:"Reset View",children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M1 4v6h6"}),o.jsx("path",{d:"M23 20v-6h-6"}),o.jsx("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"})]})}),o.jsxs("span",{className:"zoom-level",children:[Math.round(N*100),"%"]})]}),j>0&&o.jsxs("div",{className:"undo-redo-controls",children:[o.jsx("button",{onClick:x,className:"undo-redo-btn",title:"Undo (Ctrl+Z)",disabled:!b,children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M3 7v6h6"}),o.jsx("path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"})]})}),o.jsx("button",{onClick:y,className:"undo-redo-btn",title:"Redo (Ctrl+Y)",disabled:!w,children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M21 7v6h-6"}),o.jsx("path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7"})]})})]}),m&&o.jsxs("button",{onClick:m,className:"in-situ-btn",title:"Upload a photo of your installation site and see how this design will look in place with realistic perspective",children:[o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),o.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),o.jsx("path",{d:"m21 15-5-5L5 21"})]}),o.jsx("span",{children:"Preview In-Situ"})]}),o.jsx("div",{ref:K,className:"svg-wrapper",onWheel:at,children:o.jsxs("div",{className:"svg-image-container",onClick:D,onMouseDown:Ve,style:{transform:`translate(${C.x}px, ${C.y}px) scale(${N})`,cursor:pe?"grabbing":N>1?"grab":g?"crosshair":r?"pointer":"default"},children:[ne?o.jsx("div",{ref:Z,className:"svg-inline-container",style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},dangerouslySetInnerHTML:{__html:ne}}):o.jsx("img",{ref:M,src:t,alt:"TPV blend design",className:"svg-image"}),_&&o.jsx("img",{src:_,alt:"Colour highlight",className:"svg-highlight-mask"})]})}),g&&v&&o.jsx("div",{className:"eyedropper-overlay",children:o.jsxs("div",{className:"eyedropper-content",children:[o.jsx("div",{className:"eyedropper-header",children:o.jsxs("div",{className:"eyedropper-color-indicator",children:[o.jsx("div",{className:"eyedropper-color-swatch",style:{backgroundColor:v.sourceColor}}),o.jsx("span",{children:"Click another area to copy its colour, or select a TPV colour:"})]})}),o.jsx("div",{className:"eyedropper-palette",children:o.jsx("div",{className:"palette-grid",children:DP.map(P=>o.jsx("button",{className:"palette-swatch",style:{backgroundColor:P.hex},onClick:$=>{$.stopPropagation(),l&&l({hex:P.hex,code:P.code,name:P.name})},title:`${P.name} (${P.code})`},P.code))})}),o.jsxs("div",{className:"eyedropper-actions",children:[o.jsxs("button",{className:"eyedropper-transparent",onClick:P=>{P.stopPropagation(),a&&a()},title:"Remove fill from this region",children:[o.jsx("span",{className:"transparent-icon",children:""}),"Make Transparent"]}),o.jsx("button",{className:"eyedropper-cancel",onClick:P=>{P.stopPropagation(),i&&i()},children:"Cancel (Esc)"})]})]})})]}),e&&e.length>0&&o.jsx("div",{className:"legend-sidebar",children:o.jsx(LP,{recipes:e,mode:n,onColorClick:r,selectedColor:c,editedColors:d,onResetAll:u})})]}),o.jsx("style",{jsx:!0,children:`
        .svg-preview {
          background: #fff;
          border-radius: 8px;
          border: 1px solid #ddd;
          padding: 1.5rem;
          margin-top: 1.5rem;
        }

        .preview-header {
          margin-bottom: 1.5rem;
          display: flex;
          align-items: center;
          justify-content: space-between;
          flex-wrap: wrap;
          gap: 0.5rem;
        }

        .design-name-container {
          display: flex;
          align-items: center;
          gap: 0.75rem;
          flex: 1;
        }

        .preview-header h3 {
          margin: 0;
          color: #1a365d;
          font-size: 1.5rem;
        }

        .design-name-input {
          font-family: var(--font-heading), 'Overpass', sans-serif;
          font-size: 1.5rem;
          font-weight: 600;
          color: #1a365d;
          border: none;
          border-bottom: 2px solid transparent;
          background: transparent;
          padding: 0.25rem 0;
          width: 100%;
          max-width: 400px;
          transition: border-color 0.2s;
        }

        .design-name-input:hover {
          border-bottom-color: #e5e7eb;
        }

        .design-name-input:focus {
          outline: none;
          border-bottom-color: #ff6b35;
        }

        .design-name-input::placeholder {
          color: #9ca3af;
          font-weight: normal;
        }

        .name-loading {
          font-size: 0.75rem;
          color: #9ca3af;
          font-style: italic;
        }

        /* Color Editing Tip Banner */
        .color-editing-tip {
          display: flex;
          align-items: center;
          gap: 0.75rem;
          padding: 0.875rem 1rem;
          background: linear-gradient(to right, #fff7ed, #fffbeb);
          border: 1px solid #fed7aa;
          border-radius: 6px;
          margin-bottom: 1rem;
          font-size: 0.875rem;
          line-height: 1.5;
        }

        .tip-icon {
          font-size: 1.25rem;
          flex-shrink: 0;
        }

        .tip-content {
          flex: 1;
          color: #78350f;
        }

        .tip-content strong {
          color: #92400e;
        }

        .tip-close {
          background: none;
          border: none;
          font-size: 1.5rem;
          color: #92400e;
          cursor: pointer;
          padding: 0;
          line-height: 1;
          opacity: 0.6;
          transition: opacity 0.2s;
          flex-shrink: 0;
        }

        .tip-close:hover {
          opacity: 1;
        }

        /* SVG Display */
        .svg-display-container {
          display: flex;
          flex-direction: column;
          gap: 1.5rem;
          align-items: stretch;
        }

        .svg-panel {
          position: relative;
          flex: 1;
          border: 1px solid #e0e0e0;
          border-radius: 6px;
          overflow: hidden;
          background: #fafafa;
        }

        /* Zoom Controls */
        .zoom-controls {
          position: absolute;
          top: 1rem;
          right: 1rem;
          display: flex;
          gap: 0.5rem;
          background: white;
          border-radius: 8px;
          padding: 0.5rem;
          box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
          z-index: 10;
          align-items: center;
        }

        .zoom-btn {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 36px;
          height: 36px;
          padding: 0;
          background: white;
          border: 1px solid #e0e0e0;
          border-radius: 6px;
          cursor: pointer;
          color: #1a365d;
          transition: all 0.2s ease;
        }

        .zoom-btn:hover {
          background: #f8fafc;
          border-color: #1e4a7a;
          transform: translateY(-1px);
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .zoom-btn:active {
          transform: translateY(0);
        }

        .zoom-btn svg {
          width: 20px;
          height: 20px;
        }

        .zoom-level {
          font-size: 0.875rem;
          font-weight: 600;
          color: #1a365d;
          min-width: 50px;
          text-align: center;
          padding: 0 0.5rem;
        }

        /* Undo/Redo Controls */
        .undo-redo-controls {
          position: absolute;
          top: 5rem;
          right: 1rem;
          display: flex;
          gap: 0.5rem;
          background: white;
          border-radius: 8px;
          padding: 0.5rem;
          box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
          z-index: 10;
        }

        .undo-redo-btn {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 36px;
          height: 36px;
          padding: 0;
          background: white;
          border: 1px solid #e0e0e0;
          border-radius: 6px;
          cursor: pointer;
          color: #1a365d;
          transition: all 0.2s ease;
        }

        .undo-redo-btn:hover:not(:disabled) {
          background: #f8fafc;
          border-color: #1e4a7a;
          transform: translateY(-1px);
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .undo-redo-btn:active:not(:disabled) {
          transform: translateY(0);
        }

        .undo-redo-btn:disabled {
          opacity: 0.4;
          cursor: not-allowed;
        }

        .undo-redo-btn svg {
          width: 20px;
          height: 20px;
        }

        .in-situ-btn {
          position: absolute;
          top: 1rem;
          left: 1rem;
          display: flex;
          align-items: center;
          gap: 0.5rem;
          padding: 0.5rem 1rem;
          background: #ff6b35;
          color: white;
          border: none;
          border-radius: 6px;
          font-size: 0.875rem;
          font-weight: 500;
          cursor: pointer;
          box-shadow: 0 2px 12px rgba(255, 107, 53, 0.3);
          z-index: 10;
          transition: all 0.2s ease;
        }

        .in-situ-btn:hover {
          background: #e55a2b;
          transform: translateY(-1px);
          box-shadow: 0 4px 16px rgba(255, 107, 53, 0.4);
        }

        .in-situ-btn:active {
          transform: translateY(0);
        }

        .in-situ-btn svg {
          width: 18px;
          height: 18px;
        }

        .svg-wrapper {
          padding: 2rem;
          background: white;
          min-height: 400px;
          display: flex;
          align-items: center;
          justify-content: center;
          overflow: hidden;
          position: relative;
        }

        .svg-image-container {
          position: relative;
          display: inline-block;
          user-select: none;
          transition: transform 0.1s ease-out;
          transform-origin: center center;
        }

        .svg-image {
          max-width: 100%;
          height: auto;
          display: block;
          border-radius: 4px;
          pointer-events: ${r?"auto":"none"};
        }

        .svg-inline-container {
          max-width: 100%;
          display: block;
          border-radius: 4px;
        }

        .svg-inline-container svg {
          max-width: 100%;
          height: auto;
          display: block;
        }

        .svg-highlight-mask {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          pointer-events: none;
          border-radius: 4px;
          filter: drop-shadow(0 0 3px rgba(255, 0, 255, 0.8)) drop-shadow(0 0 1px rgba(0, 0, 0, 0.6));
          animation: pulse 2s ease-in-out infinite;
        }

        .eyedropper-overlay {
          position: absolute;
          top: 20px;
          left: 50%;
          transform: translateX(-50%);
          z-index: 100;
        }

        .eyedropper-content {
          background: white;
          border-radius: 12px;
          padding: 16px 20px;
          box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
          display: flex;
          flex-direction: column;
          gap: 12px;
          border: 2px solid #3b82f6;
          max-width: 320px;
        }

        .eyedropper-header {
          display: flex;
          align-items: center;
          gap: 12px;
        }

        .eyedropper-color-indicator {
          display: flex;
          align-items: center;
          gap: 12px;
          font-size: 0.9rem;
          font-weight: 500;
          color: #111827;
        }

        .eyedropper-color-swatch {
          width: 28px;
          height: 28px;
          border-radius: 6px;
          border: 2px solid #d1d5db;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
          flex-shrink: 0;
        }

        .eyedropper-palette {
          padding: 10px;
          background: #f9fafb;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
        }

        .palette-grid {
          display: grid;
          grid-template-columns: repeat(7, 1fr);
          gap: 4px;
        }

        .palette-swatch {
          width: 32px;
          height: 32px;
          border: 2px solid rgba(0, 0, 0, 0.15);
          border-radius: 4px;
          cursor: pointer;
          padding: 0;
          transition: all 0.15s ease;
        }

        .palette-swatch:hover {
          transform: scale(1.15);
          z-index: 1;
          box-shadow: 0 3px 8px rgba(0, 0, 0, 0.25);
          border-color: #3b82f6;
        }

        .eyedropper-cancel {
          padding: 8px 16px;
          background: #ef4444;
          color: white;
          border: none;
          border-radius: 6px;
          font-size: 0.9rem;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.2s;
          white-space: nowrap;
        }

        .eyedropper-cancel:hover {
          background: #dc2626;
          box-shadow: 0 2px 6px rgba(239, 68, 68, 0.3);
        }

        .eyedropper-actions {
          display: flex;
          gap: 8px;
          align-items: center;
          justify-content: center;
        }

        .eyedropper-transparent {
          display: flex;
          align-items: center;
          gap: 6px;
          padding: 8px 14px;
          background: linear-gradient(135deg, #f3f4f6 25%, #d1d5db 25%, #d1d5db 50%, #f3f4f6 50%, #f3f4f6 75%, #d1d5db 75%);
          background-size: 8px 8px;
          color: #374151;
          border: 2px solid #6b7280;
          border-radius: 6px;
          font-size: 0.9rem;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.2s;
          white-space: nowrap;
        }

        .eyedropper-transparent:hover {
          border-color: #374151;
          box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
          transform: translateY(-1px);
        }

        .transparent-icon {
          width: 16px;
          height: 16px;
          background: linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%),
                      linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%);
          background-size: 8px 8px;
          background-position: 0 0, 4px 4px;
          background-color: white;
          border: 1px solid #999;
          border-radius: 2px;
          display: inline-block;
          font-size: 0;
        }

        @keyframes pulse {
          0%, 100% {
            opacity: 0.8;
          }
          50% {
            opacity: 1;
          }
        }

        .editing-hint {
          font-size: 0.9rem;
          color: #ff6b35;
          font-weight: 500;
          margin-left: 1rem;
        }

        .legend-sidebar {
          width: 100%;
        }

        @media (max-width: 768px) {
          .svg-preview {
            padding: 0.5rem;
            margin-top: 0.75rem;
            border-radius: 6px;
          }

          .preview-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.25rem;
            margin-bottom: 0.5rem;
          }

          .preview-header h3 {
            font-size: 1.1rem;
          }

          .design-name-input {
            font-size: 1.1rem;
            max-width: 100%;
          }

          .editing-hint {
            margin-left: 0;
            font-size: 0.75rem;
          }

          .svg-panel {
            border: none;
            border-radius: 0;
          }

          .svg-wrapper {
            padding: 0;
            min-height: auto;
          }

          /* Position zoom controls at bottom-right on mobile */
          .zoom-controls {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            top: auto;
            flex-direction: column;
            gap: 0.25rem;
            padding: 0.25rem;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            z-index: 50;
          }

          /* Position undo/redo controls above zoom on mobile */
          .undo-redo-controls {
            position: fixed;
            bottom: 12rem;
            right: 1rem;
            top: auto;
            gap: 0.25rem;
            padding: 0.25rem;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            z-index: 50;
          }

          /* Make buttons circular and compact on mobile */
          .zoom-btn,
          .undo-redo-btn {
            width: 44px;
            height: 44px;
            padding: 0;
            border-radius: 50%;
            min-width: unset;
            font-size: 1.1rem;
          }

          /* Hide text labels on mobile */
          .zoom-btn span {
            display: none;
          }

          /* In-situ button - compact on mobile */
          .in-situ-btn {
            padding: 0.4rem;
            font-size: 0;
            top: 0.5rem;
            left: 0.5rem;
            border-radius: 50%;
            width: 36px;
            height: 36px;
          }

          .in-situ-btn span {
            display: none;
          }

          .in-situ-btn svg {
            width: 18px;
            height: 18px;
          }

          .svg-image-container {
            /* Allow zoom on mobile via buttons */
            cursor: default !important;
          }
        }

        /* Extra small screens */
        @media (max-width: 480px) {
          .svg-preview {
            padding: 0.25rem;
            margin-top: 0.5rem;
          }

          .preview-header {
            padding: 0 0.25rem;
          }

          .preview-header h3 {
            font-size: 1rem;
          }

          .design-name-input {
            font-size: 1rem;
          }
        }
      `})]}):null}var Sr={},Al={},zP=typeof Us=="object"&&Us&&Us.Object===Object&&Us,I1=zP,FP=I1,BP=typeof self=="object"&&self&&self.Object===Object&&self,HP=FP||BP||Function("return this")(),us=HP,UP=us,WP=UP.Symbol,Ml=WP,py=Ml,z1=Object.prototype,GP=z1.hasOwnProperty,VP=z1.toString,Na=py?py.toStringTag:void 0;function YP(t){var e=GP.call(t,Na),n=t[Na];try{t[Na]=void 0;var r=!0}catch{}var s=VP.call(t);return r&&(e?t[Na]=n:delete t[Na]),s}var qP=YP,XP=Object.prototype,KP=XP.toString;function ZP(t){return KP.call(t)}var JP=ZP,fy=Ml,QP=qP,eR=JP,tR="[object Null]",nR="[object Undefined]",my=fy?fy.toStringTag:void 0;function rR(t){return t==null?t===void 0?nR:tR:my&&my in Object(t)?QP(t):eR(t)}var Bi=rR,sR=Array.isArray,Zr=sR;function iR(t){return t!=null&&typeof t=="object"}var Es=iR,oR=Bi,aR=Zr,lR=Es,cR="[object String]";function dR(t){return typeof t=="string"||!aR(t)&&lR(t)&&oR(t)==cR}var uR=dR;function hR(t){return function(e,n,r){for(var s=-1,i=Object(e),a=r(e),l=a.length;l--;){var c=a[t?l:++s];if(n(i[c],c,i)===!1)break}return e}}var pR=hR,fR=pR,mR=fR(),gR=mR;function yR(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var xR=yR,vR=Bi,bR=Es,wR="[object Arguments]";function _R(t){return bR(t)&&vR(t)==wR}var SR=_R,gy=SR,kR=Es,F1=Object.prototype,jR=F1.hasOwnProperty,CR=F1.propertyIsEnumerable,ER=gy(function(){return arguments}())?gy:function(t){return kR(t)&&jR.call(t,"callee")&&!CR.call(t,"callee")},B1=ER,bd={exports:{}};function TR(){return!1}var NR=TR;bd.exports;(function(t,e){var n=us,r=NR,s=e&&!e.nodeType&&e,i=s&&!0&&t&&!t.nodeType&&t,a=i&&i.exports===s,l=a?n.Buffer:void 0,c=l?l.isBuffer:void 0,d=c||r;t.exports=d})(bd,bd.exports);var Gf=bd.exports,PR=9007199254740991,RR=/^(?:0|[1-9]\d*)$/;function OR(t,e){var n=typeof t;return e=e??PR,!!e&&(n=="number"||n!="symbol"&&RR.test(t))&&t>-1&&t%1==0&&t<e}var H1=OR,AR=9007199254740991;function MR(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=AR}var Vf=MR,$R=Bi,LR=Vf,DR=Es,IR="[object Arguments]",zR="[object Array]",FR="[object Boolean]",BR="[object Date]",HR="[object Error]",UR="[object Function]",WR="[object Map]",GR="[object Number]",VR="[object Object]",YR="[object RegExp]",qR="[object Set]",XR="[object String]",KR="[object WeakMap]",ZR="[object ArrayBuffer]",JR="[object DataView]",QR="[object Float32Array]",e3="[object Float64Array]",t3="[object Int8Array]",n3="[object Int16Array]",r3="[object Int32Array]",s3="[object Uint8Array]",i3="[object Uint8ClampedArray]",o3="[object Uint16Array]",a3="[object Uint32Array]",Dt={};Dt[QR]=Dt[e3]=Dt[t3]=Dt[n3]=Dt[r3]=Dt[s3]=Dt[i3]=Dt[o3]=Dt[a3]=!0;Dt[IR]=Dt[zR]=Dt[ZR]=Dt[FR]=Dt[JR]=Dt[BR]=Dt[HR]=Dt[UR]=Dt[WR]=Dt[GR]=Dt[VR]=Dt[YR]=Dt[qR]=Dt[XR]=Dt[KR]=!1;function l3(t){return DR(t)&&LR(t.length)&&!!Dt[$R(t)]}var c3=l3;function d3(t){return function(e){return t(e)}}var Yf=d3,wd={exports:{}};wd.exports;(function(t,e){var n=I1,r=e&&!e.nodeType&&e,s=r&&!0&&t&&!t.nodeType&&t,i=s&&s.exports===r,a=i&&n.process,l=function(){try{var c=s&&s.require&&s.require("util").types;return c||a&&a.binding&&a.binding("util")}catch{}}();t.exports=l})(wd,wd.exports);var qf=wd.exports,u3=c3,h3=Yf,yy=qf,xy=yy&&yy.isTypedArray,p3=xy?h3(xy):u3,U1=p3,f3=xR,m3=B1,g3=Zr,y3=Gf,x3=H1,v3=U1,b3=Object.prototype,w3=b3.hasOwnProperty;function _3(t,e){var n=g3(t),r=!n&&m3(t),s=!n&&!r&&y3(t),i=!n&&!r&&!s&&v3(t),a=n||r||s||i,l=a?f3(t.length,String):[],c=l.length;for(var d in t)(e||w3.call(t,d))&&!(a&&(d=="length"||s&&(d=="offset"||d=="parent")||i&&(d=="buffer"||d=="byteLength"||d=="byteOffset")||x3(d,c)))&&l.push(d);return l}var W1=_3,S3=Object.prototype;function k3(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||S3;return t===n}var Xf=k3;function j3(t,e){return function(n){return t(e(n))}}var G1=j3,C3=G1,E3=C3(Object.keys,Object),T3=E3,N3=Xf,P3=T3,R3=Object.prototype,O3=R3.hasOwnProperty;function A3(t){if(!N3(t))return P3(t);var e=[];for(var n in Object(t))O3.call(t,n)&&n!="constructor"&&e.push(n);return e}var M3=A3;function $3(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var la=$3,L3=Bi,D3=la,I3="[object AsyncFunction]",z3="[object Function]",F3="[object GeneratorFunction]",B3="[object Proxy]";function H3(t){if(!D3(t))return!1;var e=L3(t);return e==z3||e==F3||e==I3||e==B3}var V1=H3,U3=V1,W3=Vf;function G3(t){return t!=null&&W3(t.length)&&!U3(t)}var Xd=G3,V3=W1,Y3=M3,q3=Xd;function X3(t){return q3(t)?V3(t):Y3(t)}var $l=X3,K3=gR,Z3=$l;function J3(t,e){return t&&K3(t,e,Z3)}var Y1=J3;function Q3(t){return t}var q1=Q3,eO=q1;function tO(t){return typeof t=="function"?t:eO}var nO=tO,rO=Y1,sO=nO;function iO(t,e){return t&&rO(t,sO(e))}var Kf=iO,oO=G1,aO=oO(Object.getPrototypeOf,Object),Zf=aO,lO=Bi,cO=Zf,dO=Es,uO="[object Object]",hO=Function.prototype,pO=Object.prototype,X1=hO.toString,fO=pO.hasOwnProperty,mO=X1.call(Object);function gO(t){if(!dO(t)||lO(t)!=uO)return!1;var e=cO(t);if(e===null)return!0;var n=fO.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&X1.call(n)==mO}var yO=gO;function xO(t,e){for(var n=-1,r=t==null?0:t.length,s=Array(r);++n<r;)s[n]=e(t[n],n,t);return s}var K1=xO;function vO(){this.__data__=[],this.size=0}var bO=vO;function wO(t,e){return t===e||t!==t&&e!==e}var Jf=wO,_O=Jf;function SO(t,e){for(var n=t.length;n--;)if(_O(t[n][0],e))return n;return-1}var Kd=SO,kO=Kd,jO=Array.prototype,CO=jO.splice;function EO(t){var e=this.__data__,n=kO(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():CO.call(e,n,1),--this.size,!0}var TO=EO,NO=Kd;function PO(t){var e=this.__data__,n=NO(e,t);return n<0?void 0:e[n][1]}var RO=PO,OO=Kd;function AO(t){return OO(this.__data__,t)>-1}var MO=AO,$O=Kd;function LO(t,e){var n=this.__data__,r=$O(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}var DO=LO,IO=bO,zO=TO,FO=RO,BO=MO,HO=DO;function ca(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}ca.prototype.clear=IO;ca.prototype.delete=zO;ca.prototype.get=FO;ca.prototype.has=BO;ca.prototype.set=HO;var Zd=ca,UO=Zd;function WO(){this.__data__=new UO,this.size=0}var GO=WO;function VO(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}var YO=VO;function qO(t){return this.__data__.get(t)}var XO=qO;function KO(t){return this.__data__.has(t)}var ZO=KO,JO=us,QO=JO["__core-js_shared__"],eA=QO,th=eA,vy=function(){var t=/[^.]+$/.exec(th&&th.keys&&th.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function tA(t){return!!vy&&vy in t}var nA=tA,rA=Function.prototype,sA=rA.toString;function iA(t){if(t!=null){try{return sA.call(t)}catch{}try{return t+""}catch{}}return""}var Z1=iA,oA=V1,aA=nA,lA=la,cA=Z1,dA=/[\\^$.*+?()[\]{}|]/g,uA=/^\[object .+?Constructor\]$/,hA=Function.prototype,pA=Object.prototype,fA=hA.toString,mA=pA.hasOwnProperty,gA=RegExp("^"+fA.call(mA).replace(dA,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function yA(t){if(!lA(t)||aA(t))return!1;var e=oA(t)?gA:uA;return e.test(cA(t))}var xA=yA;function vA(t,e){return t==null?void 0:t[e]}var bA=vA,wA=xA,_A=bA;function SA(t,e){var n=_A(t,e);return wA(n)?n:void 0}var Hi=SA,kA=Hi,jA=us,CA=kA(jA,"Map"),Qf=CA,EA=Hi,TA=EA(Object,"create"),Jd=TA,by=Jd;function NA(){this.__data__=by?by(null):{},this.size=0}var PA=NA;function RA(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var OA=RA,AA=Jd,MA="__lodash_hash_undefined__",$A=Object.prototype,LA=$A.hasOwnProperty;function DA(t){var e=this.__data__;if(AA){var n=e[t];return n===MA?void 0:n}return LA.call(e,t)?e[t]:void 0}var IA=DA,zA=Jd,FA=Object.prototype,BA=FA.hasOwnProperty;function HA(t){var e=this.__data__;return zA?e[t]!==void 0:BA.call(e,t)}var UA=HA,WA=Jd,GA="__lodash_hash_undefined__";function VA(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=WA&&e===void 0?GA:e,this}var YA=VA,qA=PA,XA=OA,KA=IA,ZA=UA,JA=YA;function da(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}da.prototype.clear=qA;da.prototype.delete=XA;da.prototype.get=KA;da.prototype.has=ZA;da.prototype.set=JA;var QA=da,wy=QA,eM=Zd,tM=Qf;function nM(){this.size=0,this.__data__={hash:new wy,map:new(tM||eM),string:new wy}}var rM=nM;function sM(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var iM=sM,oM=iM;function aM(t,e){var n=t.__data__;return oM(e)?n[typeof e=="string"?"string":"hash"]:n.map}var Qd=aM,lM=Qd;function cM(t){var e=lM(this,t).delete(t);return this.size-=e?1:0,e}var dM=cM,uM=Qd;function hM(t){return uM(this,t).get(t)}var pM=hM,fM=Qd;function mM(t){return fM(this,t).has(t)}var gM=mM,yM=Qd;function xM(t,e){var n=yM(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}var vM=xM,bM=rM,wM=dM,_M=pM,SM=gM,kM=vM;function ua(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}ua.prototype.clear=bM;ua.prototype.delete=wM;ua.prototype.get=_M;ua.prototype.has=SM;ua.prototype.set=kM;var em=ua,jM=Zd,CM=Qf,EM=em,TM=200;function NM(t,e){var n=this.__data__;if(n instanceof jM){var r=n.__data__;if(!CM||r.length<TM-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new EM(r)}return n.set(t,e),this.size=n.size,this}var PM=NM,RM=Zd,OM=GO,AM=YO,MM=XO,$M=ZO,LM=PM;function ha(t){var e=this.__data__=new RM(t);this.size=e.size}ha.prototype.clear=OM;ha.prototype.delete=AM;ha.prototype.get=MM;ha.prototype.has=$M;ha.prototype.set=LM;var tm=ha,DM="__lodash_hash_undefined__";function IM(t){return this.__data__.set(t,DM),this}var zM=IM;function FM(t){return this.__data__.has(t)}var BM=FM,HM=em,UM=zM,WM=BM;function _d(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new HM;++e<n;)this.add(t[e])}_d.prototype.add=_d.prototype.push=UM;_d.prototype.has=WM;var GM=_d;function VM(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}var YM=VM;function qM(t,e){return t.has(e)}var XM=qM,KM=GM,ZM=YM,JM=XM,QM=1,e4=2;function t4(t,e,n,r,s,i){var a=n&QM,l=t.length,c=e.length;if(l!=c&&!(a&&c>l))return!1;var d=i.get(t),u=i.get(e);if(d&&u)return d==e&&u==t;var p=-1,h=!0,f=n&e4?new KM:void 0;for(i.set(t,e),i.set(e,t);++p<l;){var m=t[p],g=e[p];if(r)var v=a?r(g,m,p,e,t,i):r(m,g,p,t,e,i);if(v!==void 0){if(v)continue;h=!1;break}if(f){if(!ZM(e,function(x,y){if(!JM(f,y)&&(m===x||s(m,x,n,r,i)))return f.push(y)})){h=!1;break}}else if(!(m===g||s(m,g,n,r,i))){h=!1;break}}return i.delete(t),i.delete(e),h}var J1=t4,n4=us,r4=n4.Uint8Array,Q1=r4;function s4(t){var e=-1,n=Array(t.size);return t.forEach(function(r,s){n[++e]=[s,r]}),n}var i4=s4;function o4(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var a4=o4,_y=Ml,Sy=Q1,l4=Jf,c4=J1,d4=i4,u4=a4,h4=1,p4=2,f4="[object Boolean]",m4="[object Date]",g4="[object Error]",y4="[object Map]",x4="[object Number]",v4="[object RegExp]",b4="[object Set]",w4="[object String]",_4="[object Symbol]",S4="[object ArrayBuffer]",k4="[object DataView]",ky=_y?_y.prototype:void 0,nh=ky?ky.valueOf:void 0;function j4(t,e,n,r,s,i,a){switch(n){case k4:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case S4:return!(t.byteLength!=e.byteLength||!i(new Sy(t),new Sy(e)));case f4:case m4:case x4:return l4(+t,+e);case g4:return t.name==e.name&&t.message==e.message;case v4:case w4:return t==e+"";case y4:var l=d4;case b4:var c=r&h4;if(l||(l=u4),t.size!=e.size&&!c)return!1;var d=a.get(t);if(d)return d==e;r|=p4,a.set(t,e);var u=c4(l(t),l(e),r,s,i,a);return a.delete(t),u;case _4:if(nh)return nh.call(t)==nh.call(e)}return!1}var C4=j4;function E4(t,e){for(var n=-1,r=e.length,s=t.length;++n<r;)t[s+n]=e[n];return t}var e_=E4,T4=e_,N4=Zr;function P4(t,e,n){var r=e(t);return N4(t)?r:T4(r,n(t))}var t_=P4;function R4(t,e){for(var n=-1,r=t==null?0:t.length,s=0,i=[];++n<r;){var a=t[n];e(a,n,t)&&(i[s++]=a)}return i}var O4=R4;function A4(){return[]}var n_=A4,M4=O4,$4=n_,L4=Object.prototype,D4=L4.propertyIsEnumerable,jy=Object.getOwnPropertySymbols,I4=jy?function(t){return t==null?[]:(t=Object(t),M4(jy(t),function(e){return D4.call(t,e)}))}:$4,nm=I4,z4=t_,F4=nm,B4=$l;function H4(t){return z4(t,B4,F4)}var r_=H4,Cy=r_,U4=1,W4=Object.prototype,G4=W4.hasOwnProperty;function V4(t,e,n,r,s,i){var a=n&U4,l=Cy(t),c=l.length,d=Cy(e),u=d.length;if(c!=u&&!a)return!1;for(var p=c;p--;){var h=l[p];if(!(a?h in e:G4.call(e,h)))return!1}var f=i.get(t),m=i.get(e);if(f&&m)return f==e&&m==t;var g=!0;i.set(t,e),i.set(e,t);for(var v=a;++p<c;){h=l[p];var x=t[h],y=e[h];if(r)var b=a?r(y,x,h,e,t,i):r(x,y,h,t,e,i);if(!(b===void 0?x===y||s(x,y,n,r,i):b)){g=!1;break}v||(v=h=="constructor")}if(g&&!v){var w=t.constructor,j=e.constructor;w!=j&&"constructor"in t&&"constructor"in e&&!(typeof w=="function"&&w instanceof w&&typeof j=="function"&&j instanceof j)&&(g=!1)}return i.delete(t),i.delete(e),g}var Y4=V4,q4=Hi,X4=us,K4=q4(X4,"DataView"),Z4=K4,J4=Hi,Q4=us,e6=J4(Q4,"Promise"),t6=e6,n6=Hi,r6=us,s6=n6(r6,"Set"),i6=s6,o6=Hi,a6=us,l6=o6(a6,"WeakMap"),c6=l6,wp=Z4,_p=Qf,Sp=t6,kp=i6,jp=c6,s_=Bi,pa=Z1,Ey="[object Map]",d6="[object Object]",Ty="[object Promise]",Ny="[object Set]",Py="[object WeakMap]",Ry="[object DataView]",u6=pa(wp),h6=pa(_p),p6=pa(Sp),f6=pa(kp),m6=pa(jp),wi=s_;(wp&&wi(new wp(new ArrayBuffer(1)))!=Ry||_p&&wi(new _p)!=Ey||Sp&&wi(Sp.resolve())!=Ty||kp&&wi(new kp)!=Ny||jp&&wi(new jp)!=Py)&&(wi=function(t){var e=s_(t),n=e==d6?t.constructor:void 0,r=n?pa(n):"";if(r)switch(r){case u6:return Ry;case h6:return Ey;case p6:return Ty;case f6:return Ny;case m6:return Py}return e});var eu=wi,rh=tm,g6=J1,y6=C4,x6=Y4,Oy=eu,Ay=Zr,My=Gf,v6=U1,b6=1,$y="[object Arguments]",Ly="[object Array]",jc="[object Object]",w6=Object.prototype,Dy=w6.hasOwnProperty;function _6(t,e,n,r,s,i){var a=Ay(t),l=Ay(e),c=a?Ly:Oy(t),d=l?Ly:Oy(e);c=c==$y?jc:c,d=d==$y?jc:d;var u=c==jc,p=d==jc,h=c==d;if(h&&My(t)){if(!My(e))return!1;a=!0,u=!1}if(h&&!u)return i||(i=new rh),a||v6(t)?g6(t,e,n,r,s,i):y6(t,e,c,n,r,s,i);if(!(n&b6)){var f=u&&Dy.call(t,"__wrapped__"),m=p&&Dy.call(e,"__wrapped__");if(f||m){var g=f?t.value():t,v=m?e.value():e;return i||(i=new rh),s(g,v,n,r,i)}}return h?(i||(i=new rh),x6(t,e,n,r,s,i)):!1}var S6=_6,k6=S6,Iy=Es;function i_(t,e,n,r,s){return t===e?!0:t==null||e==null||!Iy(t)&&!Iy(e)?t!==t&&e!==e:k6(t,e,n,r,i_,s)}var o_=i_,j6=tm,C6=o_,E6=1,T6=2;function N6(t,e,n,r){var s=n.length,i=s,a=!r;if(t==null)return!i;for(t=Object(t);s--;){var l=n[s];if(a&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++s<i;){l=n[s];var c=l[0],d=t[c],u=l[1];if(a&&l[2]){if(d===void 0&&!(c in t))return!1}else{var p=new j6;if(r)var h=r(d,u,c,t,e,p);if(!(h===void 0?C6(u,d,E6|T6,r,p):h))return!1}}return!0}var P6=N6,R6=la;function O6(t){return t===t&&!R6(t)}var a_=O6,A6=a_,M6=$l;function $6(t){for(var e=M6(t),n=e.length;n--;){var r=e[n],s=t[r];e[n]=[r,s,A6(s)]}return e}var L6=$6;function D6(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}var l_=D6,I6=P6,z6=L6,F6=l_;function B6(t){var e=z6(t);return e.length==1&&e[0][2]?F6(e[0][0],e[0][1]):function(n){return n===t||I6(n,t,e)}}var H6=B6,U6=Bi,W6=Es,G6="[object Symbol]";function V6(t){return typeof t=="symbol"||W6(t)&&U6(t)==G6}var rm=V6,Y6=Zr,q6=rm,X6=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,K6=/^\w*$/;function Z6(t,e){if(Y6(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||q6(t)?!0:K6.test(t)||!X6.test(t)||e!=null&&t in Object(e)}var sm=Z6,c_=em,J6="Expected a function";function im(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(J6);var n=function(){var r=arguments,s=e?e.apply(this,r):r[0],i=n.cache;if(i.has(s))return i.get(s);var a=t.apply(this,r);return n.cache=i.set(s,a)||i,a};return n.cache=new(im.Cache||c_),n}im.Cache=c_;var Q6=im,e$=Q6,t$=500;function n$(t){var e=e$(t,function(r){return n.size===t$&&n.clear(),r}),n=e.cache;return e}var r$=n$,s$=r$,i$=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,o$=/\\(\\)?/g,a$=s$(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(i$,function(n,r,s,i){e.push(s?i.replace(o$,"$1"):r||n)}),e}),l$=a$,zy=Ml,c$=K1,d$=Zr,u$=rm,Fy=zy?zy.prototype:void 0,By=Fy?Fy.toString:void 0;function d_(t){if(typeof t=="string")return t;if(d$(t))return c$(t,d_)+"";if(u$(t))return By?By.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}var h$=d_,p$=h$;function f$(t){return t==null?"":p$(t)}var m$=f$,g$=Zr,y$=sm,x$=l$,v$=m$;function b$(t,e){return g$(t)?t:y$(t,e)?[t]:x$(v$(t))}var u_=b$,w$=rm;function _$(t){if(typeof t=="string"||w$(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}var tu=_$,S$=u_,k$=tu;function j$(t,e){e=S$(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[k$(e[n++])];return n&&n==r?t:void 0}var h_=j$,C$=h_;function E$(t,e,n){var r=t==null?void 0:C$(t,e);return r===void 0?n:r}var T$=E$;function N$(t,e){return t!=null&&e in Object(t)}var P$=N$,R$=u_,O$=B1,A$=Zr,M$=H1,$$=Vf,L$=tu;function D$(t,e,n){e=R$(e,t);for(var r=-1,s=e.length,i=!1;++r<s;){var a=L$(e[r]);if(!(i=t!=null&&n(t,a)))break;t=t[a]}return i||++r!=s?i:(s=t==null?0:t.length,!!s&&$$(s)&&M$(a,s)&&(A$(t)||O$(t)))}var I$=D$,z$=P$,F$=I$;function B$(t,e){return t!=null&&F$(t,e,z$)}var H$=B$,U$=o_,W$=T$,G$=H$,V$=sm,Y$=a_,q$=l_,X$=tu,K$=1,Z$=2;function J$(t,e){return V$(t)&&Y$(e)?q$(X$(t),e):function(n){var r=W$(n,t);return r===void 0&&r===e?G$(n,t):U$(e,r,K$|Z$)}}var Q$=J$;function eL(t){return function(e){return e==null?void 0:e[t]}}var tL=eL,nL=h_;function rL(t){return function(e){return nL(e,t)}}var sL=rL,iL=tL,oL=sL,aL=sm,lL=tu;function cL(t){return aL(t)?iL(lL(t)):oL(t)}var dL=cL,uL=H6,hL=Q$,pL=q1,fL=Zr,mL=dL;function gL(t){return typeof t=="function"?t:t==null?pL:typeof t=="object"?fL(t)?hL(t[0],t[1]):uL(t):mL(t)}var yL=gL,xL=Xd;function vL(t,e){return function(n,r){if(n==null)return n;if(!xL(n))return t(n,r);for(var s=n.length,i=e?s:-1,a=Object(n);(e?i--:++i<s)&&r(a[i],i,a)!==!1;);return n}}var bL=vL,wL=Y1,_L=bL,SL=_L(wL),kL=SL,jL=kL,CL=Xd;function EL(t,e){var n=-1,r=CL(t)?Array(t.length):[];return jL(t,function(s,i,a){r[++n]=e(s,i,a)}),r}var TL=EL,NL=K1,PL=yL,RL=TL,OL=Zr;function AL(t,e){var n=OL(t)?NL:RL;return n(t,PL(e))}var ML=AL;Object.defineProperty(Al,"__esModule",{value:!0});Al.flattenNames=void 0;var $L=uR,LL=nu($L),DL=Kf,IL=nu(DL),zL=yO,FL=nu(zL),BL=ML,HL=nu(BL);function nu(t){return t&&t.__esModule?t:{default:t}}var UL=Al.flattenNames=function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=[];return(0,HL.default)(e,function(r){Array.isArray(r)?t(r).map(function(s){return n.push(s)}):(0,FL.default)(r)?(0,IL.default)(r,function(s,i){s===!0&&n.push(i),n.push(i+"-"+s)}):(0,LL.default)(r)&&n.push(r)}),n};Al.default=UL;var Ll={};function WL(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}var GL=WL,VL=Hi,YL=function(){try{var t=VL(Object,"defineProperty");return t({},"",{}),t}catch{}}(),qL=YL,Hy=qL;function XL(t,e,n){e=="__proto__"&&Hy?Hy(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}var p_=XL,KL=p_,ZL=Jf,JL=Object.prototype,QL=JL.hasOwnProperty;function eD(t,e,n){var r=t[e];(!(QL.call(t,e)&&ZL(r,n))||n===void 0&&!(e in t))&&KL(t,e,n)}var f_=eD,tD=f_,nD=p_;function rD(t,e,n,r){var s=!n;n||(n={});for(var i=-1,a=e.length;++i<a;){var l=e[i],c=r?r(n[l],t[l],l,n,t):void 0;c===void 0&&(c=t[l]),s?nD(n,l,c):tD(n,l,c)}return n}var ru=rD,sD=ru,iD=$l;function oD(t,e){return t&&sD(e,iD(e),t)}var aD=oD;function lD(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var cD=lD,dD=la,uD=Xf,hD=cD,pD=Object.prototype,fD=pD.hasOwnProperty;function mD(t){if(!dD(t))return hD(t);var e=uD(t),n=[];for(var r in t)r=="constructor"&&(e||!fD.call(t,r))||n.push(r);return n}var gD=mD,yD=W1,xD=gD,vD=Xd;function bD(t){return vD(t)?yD(t,!0):xD(t)}var om=bD,wD=ru,_D=om;function SD(t,e){return t&&wD(e,_D(e),t)}var kD=SD,Sd={exports:{}};Sd.exports;(function(t,e){var n=us,r=e&&!e.nodeType&&e,s=r&&!0&&t&&!t.nodeType&&t,i=s&&s.exports===r,a=i?n.Buffer:void 0,l=a?a.allocUnsafe:void 0;function c(d,u){if(u)return d.slice();var p=d.length,h=l?l(p):new d.constructor(p);return d.copy(h),h}t.exports=c})(Sd,Sd.exports);var jD=Sd.exports;function CD(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var ED=CD,TD=ru,ND=nm;function PD(t,e){return TD(t,ND(t),e)}var RD=PD,OD=e_,AD=Zf,MD=nm,$D=n_,LD=Object.getOwnPropertySymbols,DD=LD?function(t){for(var e=[];t;)OD(e,MD(t)),t=AD(t);return e}:$D,m_=DD,ID=ru,zD=m_;function FD(t,e){return ID(t,zD(t),e)}var BD=FD,HD=t_,UD=m_,WD=om;function GD(t){return HD(t,WD,UD)}var VD=GD,YD=Object.prototype,qD=YD.hasOwnProperty;function XD(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&qD.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var KD=XD,Uy=Q1;function ZD(t){var e=new t.constructor(t.byteLength);return new Uy(e).set(new Uy(t)),e}var am=ZD,JD=am;function QD(t,e){var n=e?JD(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var eI=QD,tI=/\w*$/;function nI(t){var e=new t.constructor(t.source,tI.exec(t));return e.lastIndex=t.lastIndex,e}var rI=nI,Wy=Ml,Gy=Wy?Wy.prototype:void 0,Vy=Gy?Gy.valueOf:void 0;function sI(t){return Vy?Object(Vy.call(t)):{}}var iI=sI,oI=am;function aI(t,e){var n=e?oI(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var lI=aI,cI=am,dI=eI,uI=rI,hI=iI,pI=lI,fI="[object Boolean]",mI="[object Date]",gI="[object Map]",yI="[object Number]",xI="[object RegExp]",vI="[object Set]",bI="[object String]",wI="[object Symbol]",_I="[object ArrayBuffer]",SI="[object DataView]",kI="[object Float32Array]",jI="[object Float64Array]",CI="[object Int8Array]",EI="[object Int16Array]",TI="[object Int32Array]",NI="[object Uint8Array]",PI="[object Uint8ClampedArray]",RI="[object Uint16Array]",OI="[object Uint32Array]";function AI(t,e,n){var r=t.constructor;switch(e){case _I:return cI(t);case fI:case mI:return new r(+t);case SI:return dI(t,n);case kI:case jI:case CI:case EI:case TI:case NI:case PI:case RI:case OI:return pI(t,n);case gI:return new r;case yI:case bI:return new r(t);case xI:return uI(t);case vI:return new r;case wI:return hI(t)}}var MI=AI,$I=la,Yy=Object.create,LI=function(){function t(){}return function(e){if(!$I(e))return{};if(Yy)return Yy(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}(),DI=LI,II=DI,zI=Zf,FI=Xf;function BI(t){return typeof t.constructor=="function"&&!FI(t)?II(zI(t)):{}}var HI=BI,UI=eu,WI=Es,GI="[object Map]";function VI(t){return WI(t)&&UI(t)==GI}var YI=VI,qI=YI,XI=Yf,qy=qf,Xy=qy&&qy.isMap,KI=Xy?XI(Xy):qI,ZI=KI,JI=eu,QI=Es,e8="[object Set]";function t8(t){return QI(t)&&JI(t)==e8}var n8=t8,r8=n8,s8=Yf,Ky=qf,Zy=Ky&&Ky.isSet,i8=Zy?s8(Zy):r8,o8=i8,a8=tm,l8=GL,c8=f_,d8=aD,u8=kD,h8=jD,p8=ED,f8=RD,m8=BD,g8=r_,y8=VD,x8=eu,v8=KD,b8=MI,w8=HI,_8=Zr,S8=Gf,k8=ZI,j8=la,C8=o8,E8=$l,T8=om,N8=1,P8=2,R8=4,g_="[object Arguments]",O8="[object Array]",A8="[object Boolean]",M8="[object Date]",$8="[object Error]",y_="[object Function]",L8="[object GeneratorFunction]",D8="[object Map]",I8="[object Number]",x_="[object Object]",z8="[object RegExp]",F8="[object Set]",B8="[object String]",H8="[object Symbol]",U8="[object WeakMap]",W8="[object ArrayBuffer]",G8="[object DataView]",V8="[object Float32Array]",Y8="[object Float64Array]",q8="[object Int8Array]",X8="[object Int16Array]",K8="[object Int32Array]",Z8="[object Uint8Array]",J8="[object Uint8ClampedArray]",Q8="[object Uint16Array]",ez="[object Uint32Array]",Ot={};Ot[g_]=Ot[O8]=Ot[W8]=Ot[G8]=Ot[A8]=Ot[M8]=Ot[V8]=Ot[Y8]=Ot[q8]=Ot[X8]=Ot[K8]=Ot[D8]=Ot[I8]=Ot[x_]=Ot[z8]=Ot[F8]=Ot[B8]=Ot[H8]=Ot[Z8]=Ot[J8]=Ot[Q8]=Ot[ez]=!0;Ot[$8]=Ot[y_]=Ot[U8]=!1;function Bc(t,e,n,r,s,i){var a,l=e&N8,c=e&P8,d=e&R8;if(n&&(a=s?n(t,r,s,i):n(t)),a!==void 0)return a;if(!j8(t))return t;var u=_8(t);if(u){if(a=v8(t),!l)return p8(t,a)}else{var p=x8(t),h=p==y_||p==L8;if(S8(t))return h8(t,l);if(p==x_||p==g_||h&&!s){if(a=c||h?{}:w8(t),!l)return c?m8(t,u8(a,t)):f8(t,d8(a,t))}else{if(!Ot[p])return s?t:{};a=b8(t,p,l)}}i||(i=new a8);var f=i.get(t);if(f)return f;i.set(t,a),C8(t)?t.forEach(function(v){a.add(Bc(v,e,n,v,t,i))}):k8(t)&&t.forEach(function(v,x){a.set(x,Bc(v,e,n,x,t,i))});var m=d?c?y8:g8:c?T8:E8,g=u?void 0:m(t);return l8(g||t,function(v,x){g&&(x=v,v=t[x]),c8(a,x,Bc(v,e,n,x,t,i))}),a}var tz=Bc,nz=tz,rz=1,sz=4;function iz(t){return nz(t,rz|sz)}var oz=iz;Object.defineProperty(Ll,"__esModule",{value:!0});Ll.mergeClasses=void 0;var az=Kf,lz=v_(az),cz=oz,dz=v_(cz),uz=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};function v_(t){return t&&t.__esModule?t:{default:t}}var hz=Ll.mergeClasses=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=e.default&&(0,dz.default)(e.default)||{};return n.map(function(s){var i=e[s];return i&&(0,lz.default)(i,function(a,l){r[l]||(r[l]={}),r[l]=uz({},r[l],i[l])}),s}),r};Ll.default=hz;var Dl={};Object.defineProperty(Dl,"__esModule",{value:!0});Dl.autoprefix=void 0;var pz=Kf,Jy=mz(pz),fz=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};function mz(t){return t&&t.__esModule?t:{default:t}}var gz={borderRadius:function(e){return{msBorderRadius:e,MozBorderRadius:e,OBorderRadius:e,WebkitBorderRadius:e,borderRadius:e}},boxShadow:function(e){return{msBoxShadow:e,MozBoxShadow:e,OBoxShadow:e,WebkitBoxShadow:e,boxShadow:e}},userSelect:function(e){return{WebkitTouchCallout:e,KhtmlUserSelect:e,MozUserSelect:e,msUserSelect:e,WebkitUserSelect:e,userSelect:e}},flex:function(e){return{WebkitBoxFlex:e,MozBoxFlex:e,WebkitFlex:e,msFlex:e,flex:e}},flexBasis:function(e){return{WebkitFlexBasis:e,flexBasis:e}},justifyContent:function(e){return{WebkitJustifyContent:e,justifyContent:e}},transition:function(e){return{msTransition:e,MozTransition:e,OTransition:e,WebkitTransition:e,transition:e}},transform:function(e){return{msTransform:e,MozTransform:e,OTransform:e,WebkitTransform:e,transform:e}},absolute:function(e){var n=e&&e.split(" ");return{position:"absolute",top:n&&n[0],right:n&&n[1],bottom:n&&n[2],left:n&&n[3]}},extend:function(e,n){var r=n[e];return r||{extend:e}}},yz=Dl.autoprefix=function(e){var n={};return(0,Jy.default)(e,function(r,s){var i={};(0,Jy.default)(r,function(a,l){var c=gz[l];c?i=fz({},i,c(a)):i[l]=a}),n[s]=i}),n};Dl.default=yz;var Il={};Object.defineProperty(Il,"__esModule",{value:!0});Il.hover=void 0;var xz=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},vz=O,sh=bz(vz);function bz(t){return t&&t.__esModule?t:{default:t}}function wz(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qy(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function _z(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var Sz=Il.hover=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"span";return function(r){_z(s,r);function s(){var i,a,l,c;wz(this,s);for(var d=arguments.length,u=Array(d),p=0;p<d;p++)u[p]=arguments[p];return c=(a=(l=Qy(this,(i=s.__proto__||Object.getPrototypeOf(s)).call.apply(i,[this].concat(u))),l),l.state={hover:!1},l.handleMouseOver=function(){return l.setState({hover:!0})},l.handleMouseOut=function(){return l.setState({hover:!1})},l.render=function(){return sh.default.createElement(n,{onMouseOver:l.handleMouseOver,onMouseOut:l.handleMouseOut},sh.default.createElement(e,xz({},l.props,l.state)))},a),Qy(l,c)}return s}(sh.default.Component)};Il.default=Sz;var zl={};Object.defineProperty(zl,"__esModule",{value:!0});zl.active=void 0;var kz=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},jz=O,ih=Cz(jz);function Cz(t){return t&&t.__esModule?t:{default:t}}function Ez(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ex(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function Tz(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var Nz=zl.active=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"span";return function(r){Tz(s,r);function s(){var i,a,l,c;Ez(this,s);for(var d=arguments.length,u=Array(d),p=0;p<d;p++)u[p]=arguments[p];return c=(a=(l=ex(this,(i=s.__proto__||Object.getPrototypeOf(s)).call.apply(i,[this].concat(u))),l),l.state={active:!1},l.handleMouseDown=function(){return l.setState({active:!0})},l.handleMouseUp=function(){return l.setState({active:!1})},l.render=function(){return ih.default.createElement(n,{onMouseDown:l.handleMouseDown,onMouseUp:l.handleMouseUp},ih.default.createElement(e,kz({},l.props,l.state)))},a),ex(l,c)}return s}(ih.default.Component)};zl.default=Nz;var lm={};Object.defineProperty(lm,"__esModule",{value:!0});var Pz=function(e,n){var r={},s=function(a){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;r[a]=l};return e===0&&s("first-child"),e===n-1&&s("last-child"),(e===0||e%2===0)&&s("even"),Math.abs(e%2)===1&&s("odd"),s("nth-child",e),r};lm.default=Pz;Object.defineProperty(Sr,"__esModule",{value:!0});Sr.ReactCSS=Sr.loop=Sr.handleActive=cm=Sr.handleHover=Sr.hover=void 0;var Rz=Al,Oz=fa(Rz),Az=Ll,Mz=fa(Az),$z=Dl,Lz=fa($z),Dz=Il,b_=fa(Dz),Iz=zl,zz=fa(Iz),Fz=lm,Bz=fa(Fz);function fa(t){return t&&t.__esModule?t:{default:t}}Sr.hover=b_.default;var cm=Sr.handleHover=b_.default;Sr.handleActive=zz.default;Sr.loop=Bz.default;var Hz=Sr.ReactCSS=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];var i=(0,Oz.default)(r),a=(0,Mz.default)(e,i);return(0,Lz.default)(a)},mt=Sr.default=Hz,Uz=function(e,n,r,s,i){var a=i.clientWidth,l=i.clientHeight,c=typeof e.pageX=="number"?e.pageX:e.touches[0].pageX,d=typeof e.pageY=="number"?e.pageY:e.touches[0].pageY,u=c-(i.getBoundingClientRect().left+window.pageXOffset),p=d-(i.getBoundingClientRect().top+window.pageYOffset);if(r==="vertical"){var h=void 0;if(p<0?h=0:p>l?h=1:h=Math.round(p*100/l)/100,n.a!==h)return{h:n.h,s:n.s,l:n.l,a:h,source:"rgb"}}else{var f=void 0;if(u<0?f=0:u>a?f=1:f=Math.round(u*100/a)/100,s!==f)return{h:n.h,s:n.s,l:n.l,a:f,source:"rgb"}}return null},oh={},Wz=function(e,n,r,s){if(typeof document>"u"&&!s)return null;var i=s?new s:document.createElement("canvas");i.width=r*2,i.height=r*2;var a=i.getContext("2d");return a?(a.fillStyle=e,a.fillRect(0,0,i.width,i.height),a.fillStyle=n,a.fillRect(0,0,r,r),a.translate(r,r),a.fillRect(0,0,r,r),i.toDataURL()):null},Gz=function(e,n,r,s){var i=e+"-"+n+"-"+r+(s?"-server":"");if(oh[i])return oh[i];var a=Wz(e,n,r,s);return oh[i]=a,a},tx=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ma=function(e){var n=e.white,r=e.grey,s=e.size,i=e.renderers,a=e.borderRadius,l=e.boxShadow,c=e.children,d=mt({default:{grid:{borderRadius:a,boxShadow:l,absolute:"0px 0px 0px 0px",background:"url("+Gz(n,r,s,i.canvas)+") center left"}}});return O.isValidElement(c)?L.cloneElement(c,tx({},c.props,{style:tx({},c.props.style,d.grid)})):L.createElement("div",{style:d.grid})};ma.defaultProps={size:8,white:"transparent",grey:"rgba(0,0,0,.08)",renderers:{}};var Vz=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Yz=function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function qz(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function nx(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function Xz(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var dm=function(t){Xz(e,t);function e(){var n,r,s,i;qz(this,e);for(var a=arguments.length,l=Array(a),c=0;c<a;c++)l[c]=arguments[c];return i=(r=(s=nx(this,(n=e.__proto__||Object.getPrototypeOf(e)).call.apply(n,[this].concat(l))),s),s.handleChange=function(d){var u=Uz(d,s.props.hsl,s.props.direction,s.props.a,s.container);u&&typeof s.props.onChange=="function"&&s.props.onChange(u,d)},s.handleMouseDown=function(d){s.handleChange(d),window.addEventListener("mousemove",s.handleChange),window.addEventListener("mouseup",s.handleMouseUp)},s.handleMouseUp=function(){s.unbindEventListeners()},s.unbindEventListeners=function(){window.removeEventListener("mousemove",s.handleChange),window.removeEventListener("mouseup",s.handleMouseUp)},r),nx(s,i)}return Yz(e,[{key:"componentWillUnmount",value:function(){this.unbindEventListeners()}},{key:"render",value:function(){var r=this,s=this.props.rgb,i=mt({default:{alpha:{absolute:"0px 0px 0px 0px",borderRadius:this.props.radius},checkboard:{absolute:"0px 0px 0px 0px",overflow:"hidden",borderRadius:this.props.radius},gradient:{absolute:"0px 0px 0px 0px",background:"linear-gradient(to right, rgba("+s.r+","+s.g+","+s.b+`, 0) 0%,
           rgba(`+s.r+","+s.g+","+s.b+", 1) 100%)",boxShadow:this.props.shadow,borderRadius:this.props.radius},container:{position:"relative",height:"100%",margin:"0 3px"},pointer:{position:"absolute",left:s.a*100+"%"},slider:{width:"4px",borderRadius:"1px",height:"8px",boxShadow:"0 0 2px rgba(0, 0, 0, .6)",background:"#fff",marginTop:"1px",transform:"translateX(-2px)"}},vertical:{gradient:{background:"linear-gradient(to bottom, rgba("+s.r+","+s.g+","+s.b+`, 0) 0%,
           rgba(`+s.r+","+s.g+","+s.b+", 1) 100%)"},pointer:{left:0,top:s.a*100+"%"}},overwrite:Vz({},this.props.style)},{vertical:this.props.direction==="vertical",overwrite:!0});return L.createElement("div",{style:i.alpha},L.createElement("div",{style:i.checkboard},L.createElement(ma,{renderers:this.props.renderers})),L.createElement("div",{style:i.gradient}),L.createElement("div",{style:i.container,ref:function(l){return r.container=l},onMouseDown:this.handleMouseDown,onTouchMove:this.handleChange,onTouchStart:this.handleChange},L.createElement("div",{style:i.pointer},this.props.pointer?L.createElement(this.props.pointer,this.props):L.createElement("div",{style:i.slider}))))}}]),e}(O.PureComponent||O.Component),Kz=function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function Zz(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Jz(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qz(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function eF(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var tF=1,w_=38,nF=40,rF=[w_,nF],sF=function(e){return rF.indexOf(e)>-1},iF=function(e){return Number(String(e).replace(/%/g,""))},oF=1,bt=function(t){eF(e,t);function e(n){Jz(this,e);var r=Qz(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.handleBlur=function(){r.state.blurValue&&r.setState({value:r.state.blurValue,blurValue:null})},r.handleChange=function(s){r.setUpdatedValue(s.target.value,s)},r.handleKeyDown=function(s){var i=iF(s.target.value);if(!isNaN(i)&&sF(s.keyCode)){var a=r.getArrowOffset(),l=s.keyCode===w_?i+a:i-a;r.setUpdatedValue(l,s)}},r.handleDrag=function(s){if(r.props.dragLabel){var i=Math.round(r.props.value+s.movementX);i>=0&&i<=r.props.dragMax&&r.props.onChange&&r.props.onChange(r.getValueObjectWithLabel(i),s)}},r.handleMouseDown=function(s){r.props.dragLabel&&(s.preventDefault(),r.handleDrag(s),window.addEventListener("mousemove",r.handleDrag),window.addEventListener("mouseup",r.handleMouseUp))},r.handleMouseUp=function(){r.unbindEventListeners()},r.unbindEventListeners=function(){window.removeEventListener("mousemove",r.handleDrag),window.removeEventListener("mouseup",r.handleMouseUp)},r.state={value:String(n.value).toUpperCase(),blurValue:String(n.value).toUpperCase()},r.inputId="rc-editable-input-"+oF++,r}return Kz(e,[{key:"componentDidUpdate",value:function(r,s){this.props.value!==this.state.value&&(r.value!==this.props.value||s.value!==this.state.value)&&(this.input===document.activeElement?this.setState({blurValue:String(this.props.value).toUpperCase()}):this.setState({value:String(this.props.value).toUpperCase(),blurValue:!this.state.blurValue&&String(this.props.value).toUpperCase()}))}},{key:"componentWillUnmount",value:function(){this.unbindEventListeners()}},{key:"getValueObjectWithLabel",value:function(r){return Zz({},this.props.label,r)}},{key:"getArrowOffset",value:function(){return this.props.arrowOffset||tF}},{key:"setUpdatedValue",value:function(r,s){var i=this.props.label?this.getValueObjectWithLabel(r):r;this.props.onChange&&this.props.onChange(i,s),this.setState({value:r})}},{key:"render",value:function(){var r=this,s=mt({default:{wrap:{position:"relative"}},"user-override":{wrap:this.props.style&&this.props.style.wrap?this.props.style.wrap:{},input:this.props.style&&this.props.style.input?this.props.style.input:{},label:this.props.style&&this.props.style.label?this.props.style.label:{}},"dragLabel-true":{label:{cursor:"ew-resize"}}},{"user-override":!0},this.props);return L.createElement("div",{style:s.wrap},L.createElement("input",{id:this.inputId,style:s.input,ref:function(a){return r.input=a},value:this.state.value,onKeyDown:this.handleKeyDown,onChange:this.handleChange,onBlur:this.handleBlur,placeholder:this.props.placeholder,spellCheck:"false"}),this.props.label&&!this.props.hideLabel?L.createElement("label",{htmlFor:this.inputId,style:s.label,onMouseDown:this.handleMouseDown},this.props.label):null)}}]),e}(O.PureComponent||O.Component),aF=function(e,n,r,s){var i=s.clientWidth,a=s.clientHeight,l=typeof e.pageX=="number"?e.pageX:e.touches[0].pageX,c=typeof e.pageY=="number"?e.pageY:e.touches[0].pageY,d=l-(s.getBoundingClientRect().left+window.pageXOffset),u=c-(s.getBoundingClientRect().top+window.pageYOffset);if(n==="vertical"){var p=void 0;if(u<0)p=359;else if(u>a)p=0;else{var h=-(u*100/a)+100;p=360*h/100}if(r.h!==p)return{h:p,s:r.s,l:r.l,a:r.a,source:"hsl"}}else{var f=void 0;if(d<0)f=0;else if(d>i)f=359;else{var m=d*100/i;f=360*m/100}if(r.h!==f)return{h:f,s:r.s,l:r.l,a:r.a,source:"hsl"}}return null},lF=function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function cF(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function rx(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function dF(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var ga=function(t){dF(e,t);function e(){var n,r,s,i;cF(this,e);for(var a=arguments.length,l=Array(a),c=0;c<a;c++)l[c]=arguments[c];return i=(r=(s=rx(this,(n=e.__proto__||Object.getPrototypeOf(e)).call.apply(n,[this].concat(l))),s),s.handleChange=function(d){var u=aF(d,s.props.direction,s.props.hsl,s.container);u&&typeof s.props.onChange=="function"&&s.props.onChange(u,d)},s.handleMouseDown=function(d){s.handleChange(d),window.addEventListener("mousemove",s.handleChange),window.addEventListener("mouseup",s.handleMouseUp)},s.handleMouseUp=function(){s.unbindEventListeners()},r),rx(s,i)}return lF(e,[{key:"componentWillUnmount",value:function(){this.unbindEventListeners()}},{key:"unbindEventListeners",value:function(){window.removeEventListener("mousemove",this.handleChange),window.removeEventListener("mouseup",this.handleMouseUp)}},{key:"render",value:function(){var r=this,s=this.props.direction,i=s===void 0?"horizontal":s,a=mt({default:{hue:{absolute:"0px 0px 0px 0px",borderRadius:this.props.radius,boxShadow:this.props.shadow},container:{padding:"0 2px",position:"relative",height:"100%",borderRadius:this.props.radius},pointer:{position:"absolute",left:this.props.hsl.h*100/360+"%"},slider:{marginTop:"1px",width:"4px",borderRadius:"1px",height:"8px",boxShadow:"0 0 2px rgba(0, 0, 0, .6)",background:"#fff",transform:"translateX(-2px)"}},vertical:{pointer:{left:"0px",top:-(this.props.hsl.h*100/360)+100+"%"}}},{vertical:i==="vertical"});return L.createElement("div",{style:a.hue},L.createElement("div",{className:"hue-"+i,style:a.container,ref:function(c){return r.container=c},onMouseDown:this.handleMouseDown,onTouchMove:this.handleChange,onTouchStart:this.handleChange},L.createElement("style",null,`
            .hue-horizontal {
              background: linear-gradient(to right, #f00 0%, #ff0 17%, #0f0
                33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);
              background: -webkit-linear-gradient(to right, #f00 0%, #ff0
                17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);
            }

            .hue-vertical {
              background: linear-gradient(to top, #f00 0%, #ff0 17%, #0f0 33%,
                #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);
              background: -webkit-linear-gradient(to top, #f00 0%, #ff0 17%,
                #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);
            }
          `),L.createElement("div",{style:a.pointer},this.props.pointer?L.createElement(this.props.pointer,this.props):L.createElement("div",{style:a.slider}))))}}]),e}(O.PureComponent||O.Component),__={exports:{}},uF="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",hF=uF,pF=hF;function S_(){}function k_(){}k_.resetWarningCache=S_;var fF=function(){function t(r,s,i,a,l,c){if(c!==pF){var d=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw d.name="Invariant Violation",d}}t.isRequired=t;function e(){return t}var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:k_,resetWarningCache:S_};return n.PropTypes=n,n};__.exports=fF();var mF=__.exports;const Ie=jl(mF);function gF(){this.__data__=[],this.size=0}function Fl(t,e){return t===e||t!==t&&e!==e}function su(t,e){for(var n=t.length;n--;)if(Fl(t[n][0],e))return n;return-1}var yF=Array.prototype,xF=yF.splice;function vF(t){var e=this.__data__,n=su(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():xF.call(e,n,1),--this.size,!0}function bF(t){var e=this.__data__,n=su(e,t);return n<0?void 0:e[n][1]}function wF(t){return su(this.__data__,t)>-1}function _F(t,e){var n=this.__data__,r=su(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function Ts(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ts.prototype.clear=gF;Ts.prototype.delete=vF;Ts.prototype.get=bF;Ts.prototype.has=wF;Ts.prototype.set=_F;function SF(){this.__data__=new Ts,this.size=0}function kF(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function jF(t){return this.__data__.get(t)}function CF(t){return this.__data__.has(t)}var j_=typeof global=="object"&&global&&global.Object===Object&&global,EF=typeof self=="object"&&self&&self.Object===Object&&self,Jr=j_||EF||Function("return this")(),ri=Jr.Symbol,C_=Object.prototype,TF=C_.hasOwnProperty,NF=C_.toString,Pa=ri?ri.toStringTag:void 0;function PF(t){var e=TF.call(t,Pa),n=t[Pa];try{t[Pa]=void 0;var r=!0}catch{}var s=NF.call(t);return r&&(e?t[Pa]=n:delete t[Pa]),s}var RF=Object.prototype,OF=RF.toString;function AF(t){return OF.call(t)}var MF="[object Null]",$F="[object Undefined]",sx=ri?ri.toStringTag:void 0;function Ui(t){return t==null?t===void 0?$F:MF:sx&&sx in Object(t)?PF(t):AF(t)}function Tr(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var LF="[object AsyncFunction]",DF="[object Function]",IF="[object GeneratorFunction]",zF="[object Proxy]";function um(t){if(!Tr(t))return!1;var e=Ui(t);return e==DF||e==IF||e==LF||e==zF}var ah=Jr["__core-js_shared__"],ix=function(){var t=/[^.]+$/.exec(ah&&ah.keys&&ah.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function FF(t){return!!ix&&ix in t}var BF=Function.prototype,HF=BF.toString;function Wi(t){if(t!=null){try{return HF.call(t)}catch{}try{return t+""}catch{}}return""}var UF=/[\\^$.*+?()[\]{}|]/g,WF=/^\[object .+?Constructor\]$/,GF=Function.prototype,VF=Object.prototype,YF=GF.toString,qF=VF.hasOwnProperty,XF=RegExp("^"+YF.call(qF).replace(UF,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function KF(t){if(!Tr(t)||FF(t))return!1;var e=um(t)?XF:WF;return e.test(Wi(t))}function ZF(t,e){return t==null?void 0:t[e]}function Gi(t,e){var n=ZF(t,e);return KF(n)?n:void 0}var Sl=Gi(Jr,"Map"),kl=Gi(Object,"create");function JF(){this.__data__=kl?kl(null):{},this.size=0}function QF(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var eB="__lodash_hash_undefined__",tB=Object.prototype,nB=tB.hasOwnProperty;function rB(t){var e=this.__data__;if(kl){var n=e[t];return n===eB?void 0:n}return nB.call(e,t)?e[t]:void 0}var sB=Object.prototype,iB=sB.hasOwnProperty;function oB(t){var e=this.__data__;return kl?e[t]!==void 0:iB.call(e,t)}var aB="__lodash_hash_undefined__";function lB(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=kl&&e===void 0?aB:e,this}function Ii(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ii.prototype.clear=JF;Ii.prototype.delete=QF;Ii.prototype.get=rB;Ii.prototype.has=oB;Ii.prototype.set=lB;function cB(){this.size=0,this.__data__={hash:new Ii,map:new(Sl||Ts),string:new Ii}}function dB(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function iu(t,e){var n=t.__data__;return dB(e)?n[typeof e=="string"?"string":"hash"]:n.map}function uB(t){var e=iu(this,t).delete(t);return this.size-=e?1:0,e}function hB(t){return iu(this,t).get(t)}function pB(t){return iu(this,t).has(t)}function fB(t,e){var n=iu(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function Ns(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ns.prototype.clear=cB;Ns.prototype.delete=uB;Ns.prototype.get=hB;Ns.prototype.has=pB;Ns.prototype.set=fB;var mB=200;function gB(t,e){var n=this.__data__;if(n instanceof Ts){var r=n.__data__;if(!Sl||r.length<mB-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Ns(r)}return n.set(t,e),this.size=n.size,this}function ds(t){var e=this.__data__=new Ts(t);this.size=e.size}ds.prototype.clear=SF;ds.prototype.delete=kF;ds.prototype.get=jF;ds.prototype.has=CF;ds.prototype.set=gB;var kd=function(){try{var t=Gi(Object,"defineProperty");return t({},"",{}),t}catch{}}();function hm(t,e,n){e=="__proto__"&&kd?kd(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Cp(t,e,n){(n!==void 0&&!Fl(t[e],n)||n===void 0&&!(e in t))&&hm(t,e,n)}function yB(t){return function(e,n,r){for(var s=-1,i=Object(e),a=r(e),l=a.length;l--;){var c=a[++s];if(n(i[c],c,i)===!1)break}return e}}var E_=yB(),T_=typeof ur=="object"&&ur&&!ur.nodeType&&ur,ox=T_&&typeof hr=="object"&&hr&&!hr.nodeType&&hr,xB=ox&&ox.exports===T_,ax=xB?Jr.Buffer:void 0;ax&&ax.allocUnsafe;function vB(t,e){return t.slice()}var jd=Jr.Uint8Array;function bB(t){var e=new t.constructor(t.byteLength);return new jd(e).set(new jd(t)),e}function wB(t,e){var n=bB(t.buffer);return new t.constructor(n,t.byteOffset,t.length)}function _B(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var lx=Object.create,SB=function(){function t(){}return function(e){if(!Tr(e))return{};if(lx)return lx(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function N_(t,e){return function(n){return t(e(n))}}var P_=N_(Object.getPrototypeOf,Object),kB=Object.prototype;function pm(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||kB;return t===n}function jB(t){return typeof t.constructor=="function"&&!pm(t)?SB(P_(t)):{}}function si(t){return t!=null&&typeof t=="object"}var CB="[object Arguments]";function cx(t){return si(t)&&Ui(t)==CB}var R_=Object.prototype,EB=R_.hasOwnProperty,TB=R_.propertyIsEnumerable,Cd=cx(function(){return arguments}())?cx:function(t){return si(t)&&EB.call(t,"callee")&&!TB.call(t,"callee")},mr=Array.isArray,NB=9007199254740991;function fm(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=NB}function ya(t){return t!=null&&fm(t.length)&&!um(t)}function PB(t){return si(t)&&ya(t)}function RB(){return!1}var O_=typeof ur=="object"&&ur&&!ur.nodeType&&ur,dx=O_&&typeof hr=="object"&&hr&&!hr.nodeType&&hr,OB=dx&&dx.exports===O_,ux=OB?Jr.Buffer:void 0,AB=ux?ux.isBuffer:void 0,Ed=AB||RB,MB="[object Object]",$B=Function.prototype,LB=Object.prototype,A_=$B.toString,DB=LB.hasOwnProperty,IB=A_.call(Object);function zB(t){if(!si(t)||Ui(t)!=MB)return!1;var e=P_(t);if(e===null)return!0;var n=DB.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&A_.call(n)==IB}var FB="[object Arguments]",BB="[object Array]",HB="[object Boolean]",UB="[object Date]",WB="[object Error]",GB="[object Function]",VB="[object Map]",YB="[object Number]",qB="[object Object]",XB="[object RegExp]",KB="[object Set]",ZB="[object String]",JB="[object WeakMap]",QB="[object ArrayBuffer]",eH="[object DataView]",tH="[object Float32Array]",nH="[object Float64Array]",rH="[object Int8Array]",sH="[object Int16Array]",iH="[object Int32Array]",oH="[object Uint8Array]",aH="[object Uint8ClampedArray]",lH="[object Uint16Array]",cH="[object Uint32Array]",It={};It[tH]=It[nH]=It[rH]=It[sH]=It[iH]=It[oH]=It[aH]=It[lH]=It[cH]=!0;It[FB]=It[BB]=It[QB]=It[HB]=It[eH]=It[UB]=It[WB]=It[GB]=It[VB]=It[YB]=It[qB]=It[XB]=It[KB]=It[ZB]=It[JB]=!1;function dH(t){return si(t)&&fm(t.length)&&!!It[Ui(t)]}function uH(t){return function(e){return t(e)}}var M_=typeof ur=="object"&&ur&&!ur.nodeType&&ur,tl=M_&&typeof hr=="object"&&hr&&!hr.nodeType&&hr,hH=tl&&tl.exports===M_,lh=hH&&j_.process,hx=function(){try{var t=tl&&tl.require&&tl.require("util").types;return t||lh&&lh.binding&&lh.binding("util")}catch{}}(),px=hx&&hx.isTypedArray,mm=px?uH(px):dH;function Ep(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var pH=Object.prototype,fH=pH.hasOwnProperty;function mH(t,e,n){var r=t[e];(!(fH.call(t,e)&&Fl(r,n))||n===void 0&&!(e in t))&&hm(t,e,n)}function gH(t,e,n,r){var s=!n;n||(n={});for(var i=-1,a=e.length;++i<a;){var l=e[i],c=void 0;c===void 0&&(c=t[l]),s?hm(n,l,c):mH(n,l,c)}return n}function yH(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var xH=9007199254740991,vH=/^(?:0|[1-9]\d*)$/;function gm(t,e){var n=typeof t;return e=e??xH,!!e&&(n=="number"||n!="symbol"&&vH.test(t))&&t>-1&&t%1==0&&t<e}var bH=Object.prototype,wH=bH.hasOwnProperty;function $_(t,e){var n=mr(t),r=!n&&Cd(t),s=!n&&!r&&Ed(t),i=!n&&!r&&!s&&mm(t),a=n||r||s||i,l=a?yH(t.length,String):[],c=l.length;for(var d in t)(e||wH.call(t,d))&&!(a&&(d=="length"||s&&(d=="offset"||d=="parent")||i&&(d=="buffer"||d=="byteLength"||d=="byteOffset")||gm(d,c)))&&l.push(d);return l}function _H(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var SH=Object.prototype,kH=SH.hasOwnProperty;function jH(t){if(!Tr(t))return _H(t);var e=pm(t),n=[];for(var r in t)r=="constructor"&&(e||!kH.call(t,r))||n.push(r);return n}function L_(t){return ya(t)?$_(t,!0):jH(t)}function CH(t){return gH(t,L_(t))}function EH(t,e,n,r,s,i,a){var l=Ep(t,n),c=Ep(e,n),d=a.get(c);if(d){Cp(t,n,d);return}var u=i?i(l,c,n+"",t,e,a):void 0,p=u===void 0;if(p){var h=mr(c),f=!h&&Ed(c),m=!h&&!f&&mm(c);u=c,h||f||m?mr(l)?u=l:PB(l)?u=_B(l):f?(p=!1,u=vB(c)):m?(p=!1,u=wB(c)):u=[]:zB(c)||Cd(c)?(u=l,Cd(l)?u=CH(l):(!Tr(l)||um(l))&&(u=jB(c))):p=!1}p&&(a.set(c,u),s(u,c,r,i,a),a.delete(c)),Cp(t,n,u)}function D_(t,e,n,r,s){t!==e&&E_(e,function(i,a){if(s||(s=new ds),Tr(i))EH(t,e,a,n,D_,r,s);else{var l=r?r(Ep(t,a),i,a+"",t,e,s):void 0;l===void 0&&(l=i),Cp(t,a,l)}},L_)}function ou(t){return t}function TH(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}var fx=Math.max;function NH(t,e,n){return e=fx(e===void 0?t.length-1:e,0),function(){for(var r=arguments,s=-1,i=fx(r.length-e,0),a=Array(i);++s<i;)a[s]=r[e+s];s=-1;for(var l=Array(e+1);++s<e;)l[s]=r[s];return l[e]=n(a),TH(t,this,l)}}function PH(t){return function(){return t}}var RH=kd?function(t,e){return kd(t,"toString",{configurable:!0,enumerable:!1,value:PH(e),writable:!0})}:ou,OH=800,AH=16,MH=Date.now;function $H(t){var e=0,n=0;return function(){var r=MH(),s=AH-(r-n);if(n=r,s>0){if(++e>=OH)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var LH=$H(RH);function DH(t,e){return LH(NH(t,e,ou),t+"")}function IH(t,e,n){if(!Tr(n))return!1;var r=typeof e;return(r=="number"?ya(n)&&gm(e,n.length):r=="string"&&e in n)?Fl(n[e],t):!1}function zH(t){return DH(function(e,n){var r=-1,s=n.length,i=s>1?n[s-1]:void 0,a=s>2?n[2]:void 0;for(i=t.length>3&&typeof i=="function"?(s--,i):void 0,a&&IH(n[0],n[1],a)&&(i=s<3?void 0:i,s=1),e=Object(e);++r<s;){var l=n[r];l&&t(e,l,r,i)}return e})}var Kn=zH(function(t,e,n){D_(t,e,n)}),Bl=function(e){var n=e.zDepth,r=e.radius,s=e.background,i=e.children,a=e.styles,l=a===void 0?{}:a,c=mt(Kn({default:{wrap:{position:"relative",display:"inline-block"},content:{position:"relative"},bg:{absolute:"0px 0px 0px 0px",boxShadow:"0 "+n+"px "+n*4+"px rgba(0,0,0,.24)",borderRadius:r,background:s}},"zDepth-0":{bg:{boxShadow:"none"}},"zDepth-1":{bg:{boxShadow:"0 2px 10px rgba(0,0,0,.12), 0 2px 5px rgba(0,0,0,.16)"}},"zDepth-2":{bg:{boxShadow:"0 6px 20px rgba(0,0,0,.19), 0 8px 17px rgba(0,0,0,.2)"}},"zDepth-3":{bg:{boxShadow:"0 17px 50px rgba(0,0,0,.19), 0 12px 15px rgba(0,0,0,.24)"}},"zDepth-4":{bg:{boxShadow:"0 25px 55px rgba(0,0,0,.21), 0 16px 28px rgba(0,0,0,.22)"}},"zDepth-5":{bg:{boxShadow:"0 40px 77px rgba(0,0,0,.22), 0 27px 24px rgba(0,0,0,.2)"}},square:{bg:{borderRadius:"0"}},circle:{bg:{borderRadius:"50%"}}},l),{"zDepth-1":n===1});return L.createElement("div",{style:c.wrap},L.createElement("div",{style:c.bg}),L.createElement("div",{style:c.content},i))};Bl.propTypes={background:Ie.string,zDepth:Ie.oneOf([0,1,2,3,4,5]),radius:Ie.number,styles:Ie.object};Bl.defaultProps={background:"#fff",zDepth:1,radius:2,styles:{}};var ch=function(){return Jr.Date.now()},FH=/\s/;function BH(t){for(var e=t.length;e--&&FH.test(t.charAt(e)););return e}var HH=/^\s+/;function UH(t){return t&&t.slice(0,BH(t)+1).replace(HH,"")}var WH="[object Symbol]";function au(t){return typeof t=="symbol"||si(t)&&Ui(t)==WH}var mx=NaN,GH=/^[-+]0x[0-9a-f]+$/i,VH=/^0b[01]+$/i,YH=/^0o[0-7]+$/i,qH=parseInt;function gx(t){if(typeof t=="number")return t;if(au(t))return mx;if(Tr(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Tr(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=UH(t);var n=VH.test(t);return n||YH.test(t)?qH(t.slice(2),n?2:8):GH.test(t)?mx:+t}var XH="Expected a function",KH=Math.max,ZH=Math.min;function I_(t,e,n){var r,s,i,a,l,c,d=0,u=!1,p=!1,h=!0;if(typeof t!="function")throw new TypeError(XH);e=gx(e)||0,Tr(n)&&(u=!!n.leading,p="maxWait"in n,i=p?KH(gx(n.maxWait)||0,e):i,h="trailing"in n?!!n.trailing:h);function f(_){var S=r,E=s;return r=s=void 0,d=_,a=t.apply(E,S),a}function m(_){return d=_,l=setTimeout(x,e),u?f(_):a}function g(_){var S=_-c,E=_-d,T=e-S;return p?ZH(T,i-E):T}function v(_){var S=_-c,E=_-d;return c===void 0||S>=e||S<0||p&&E>=i}function x(){var _=ch();if(v(_))return y(_);l=setTimeout(x,g(_))}function y(_){return l=void 0,h&&r?f(_):(r=s=void 0,a)}function b(){l!==void 0&&clearTimeout(l),d=0,r=c=s=l=void 0}function w(){return l===void 0?a:y(ch())}function j(){var _=ch(),S=v(_);if(r=arguments,s=this,c=_,S){if(l===void 0)return m(c);if(p)return clearTimeout(l),l=setTimeout(x,e),f(c)}return l===void 0&&(l=setTimeout(x,e)),a}return j.cancel=b,j.flush=w,j}var JH="Expected a function";function QH(t,e,n){var r=!0,s=!0;if(typeof t!="function")throw new TypeError(JH);return Tr(n)&&(r="leading"in n?!!n.leading:r,s="trailing"in n?!!n.trailing:s),I_(t,e,{leading:r,maxWait:e,trailing:s})}var e7=function(e,n,r){var s=r.getBoundingClientRect(),i=s.width,a=s.height,l=typeof e.pageX=="number"?e.pageX:e.touches[0].pageX,c=typeof e.pageY=="number"?e.pageY:e.touches[0].pageY,d=l-(r.getBoundingClientRect().left+window.pageXOffset),u=c-(r.getBoundingClientRect().top+window.pageYOffset);d<0?d=0:d>i&&(d=i),u<0?u=0:u>a&&(u=a);var p=d/i,h=1-u/a;return{h:n.h,s:p,v:h,a:n.a,source:"hsv"}},t7=function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function n7(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r7(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function s7(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var lu=function(t){s7(e,t);function e(n){n7(this,e);var r=r7(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n));return r.handleChange=function(s){typeof r.props.onChange=="function"&&r.throttle(r.props.onChange,e7(s,r.props.hsl,r.container),s)},r.handleMouseDown=function(s){r.handleChange(s);var i=r.getContainerRenderWindow();i.addEventListener("mousemove",r.handleChange),i.addEventListener("mouseup",r.handleMouseUp)},r.handleMouseUp=function(){r.unbindEventListeners()},r.throttle=QH(function(s,i,a){s(i,a)},50),r}return t7(e,[{key:"componentWillUnmount",value:function(){this.throttle.cancel(),this.unbindEventListeners()}},{key:"getContainerRenderWindow",value:function(){for(var r=this.container,s=window;!s.document.contains(r)&&s.parent!==s;)s=s.parent;return s}},{key:"unbindEventListeners",value:function(){var r=this.getContainerRenderWindow();r.removeEventListener("mousemove",this.handleChange),r.removeEventListener("mouseup",this.handleMouseUp)}},{key:"render",value:function(){var r=this,s=this.props.style||{},i=s.color,a=s.white,l=s.black,c=s.pointer,d=s.circle,u=mt({default:{color:{absolute:"0px 0px 0px 0px",background:"hsl("+this.props.hsl.h+",100%, 50%)",borderRadius:this.props.radius},white:{absolute:"0px 0px 0px 0px",borderRadius:this.props.radius},black:{absolute:"0px 0px 0px 0px",boxShadow:this.props.shadow,borderRadius:this.props.radius},pointer:{position:"absolute",top:-(this.props.hsv.v*100)+100+"%",left:this.props.hsv.s*100+"%",cursor:"default"},circle:{width:"4px",height:"4px",boxShadow:`0 0 0 1.5px #fff, inset 0 0 1px 1px rgba(0,0,0,.3),
            0 0 1px 2px rgba(0,0,0,.4)`,borderRadius:"50%",cursor:"hand",transform:"translate(-2px, -2px)"}},custom:{color:i,white:a,black:l,pointer:c,circle:d}},{custom:!!this.props.style});return L.createElement("div",{style:u.color,ref:function(h){return r.container=h},onMouseDown:this.handleMouseDown,onTouchMove:this.handleChange,onTouchStart:this.handleChange},L.createElement("style",null,`
          .saturation-white {
            background: -webkit-linear-gradient(to right, #fff, rgba(255,255,255,0));
            background: linear-gradient(to right, #fff, rgba(255,255,255,0));
          }
          .saturation-black {
            background: -webkit-linear-gradient(to top, #000, rgba(0,0,0,0));
            background: linear-gradient(to top, #000, rgba(0,0,0,0));
          }
        `),L.createElement("div",{style:u.white,className:"saturation-white"},L.createElement("div",{style:u.black,className:"saturation-black"}),L.createElement("div",{style:u.pointer},this.props.pointer?L.createElement(this.props.pointer,this.props):L.createElement("div",{style:u.circle}))))}}]),e}(O.PureComponent||O.Component);function i7(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}var o7=N_(Object.keys,Object),a7=Object.prototype,l7=a7.hasOwnProperty;function c7(t){if(!pm(t))return o7(t);var e=[];for(var n in Object(t))l7.call(t,n)&&n!="constructor"&&e.push(n);return e}function ym(t){return ya(t)?$_(t):c7(t)}function d7(t,e){return t&&E_(t,e,ym)}function u7(t,e){return function(n,r){if(n==null)return n;if(!ya(n))return t(n,r);for(var s=n.length,i=-1,a=Object(n);++i<s&&r(a[i],i,a)!==!1;);return n}}var z_=u7(d7);function h7(t){return typeof t=="function"?t:ou}function p7(t,e){var n=mr(t)?i7:z_;return n(t,h7(e))}function Td(t){"@babel/helpers - typeof";return Td=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Td(t)}var f7=/^\s+/,m7=/\s+$/;function Qe(t,e){if(t=t||"",e=e||{},t instanceof Qe)return t;if(!(this instanceof Qe))return new Qe(t,e);var n=g7(t);this._originalInput=t,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||n.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=n.ok}Qe.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),n,r,s,i,a,l;return n=e.r/255,r=e.g/255,s=e.b/255,n<=.03928?i=n/12.92:i=Math.pow((n+.055)/1.055,2.4),r<=.03928?a=r/12.92:a=Math.pow((r+.055)/1.055,2.4),s<=.03928?l=s/12.92:l=Math.pow((s+.055)/1.055,2.4),.2126*i+.7152*a+.0722*l},setAlpha:function(e){return this._a=F_(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=xx(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=xx(this._r,this._g,this._b),n=Math.round(e.h*360),r=Math.round(e.s*100),s=Math.round(e.v*100);return this._a==1?"hsv("+n+", "+r+"%, "+s+"%)":"hsva("+n+", "+r+"%, "+s+"%, "+this._roundA+")"},toHsl:function(){var e=yx(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=yx(this._r,this._g,this._b),n=Math.round(e.h*360),r=Math.round(e.s*100),s=Math.round(e.l*100);return this._a==1?"hsl("+n+", "+r+"%, "+s+"%)":"hsla("+n+", "+r+"%, "+s+"%, "+this._roundA+")"},toHex:function(e){return vx(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return b7(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(Ft(this._r,255)*100)+"%",g:Math.round(Ft(this._g,255)*100)+"%",b:Math.round(Ft(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(Ft(this._r,255)*100)+"%, "+Math.round(Ft(this._g,255)*100)+"%, "+Math.round(Ft(this._b,255)*100)+"%)":"rgba("+Math.round(Ft(this._r,255)*100)+"%, "+Math.round(Ft(this._g,255)*100)+"%, "+Math.round(Ft(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:O7[vx(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var n="#"+bx(this._r,this._g,this._b,this._a),r=n,s=this._gradientType?"GradientType = 1, ":"";if(e){var i=Qe(e);r="#"+bx(i._r,i._g,i._b,i._a)}return"progid:DXImageTransform.Microsoft.gradient("+s+"startColorstr="+n+",endColorstr="+r+")"},toString:function(e){var n=!!e;e=e||this._format;var r=!1,s=this._a<1&&this._a>=0,i=!n&&s&&(e==="hex"||e==="hex6"||e==="hex3"||e==="hex4"||e==="hex8"||e==="name");return i?e==="name"&&this._a===0?this.toName():this.toRgbString():(e==="rgb"&&(r=this.toRgbString()),e==="prgb"&&(r=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(r=this.toHexString()),e==="hex3"&&(r=this.toHexString(!0)),e==="hex4"&&(r=this.toHex8String(!0)),e==="hex8"&&(r=this.toHex8String()),e==="name"&&(r=this.toName()),e==="hsl"&&(r=this.toHslString()),e==="hsv"&&(r=this.toHsvString()),r||this.toHexString())},clone:function(){return Qe(this.toString())},_applyModification:function(e,n){var r=e.apply(null,[this].concat([].slice.call(n)));return this._r=r._r,this._g=r._g,this._b=r._b,this.setAlpha(r._a),this},lighten:function(){return this._applyModification(k7,arguments)},brighten:function(){return this._applyModification(j7,arguments)},darken:function(){return this._applyModification(C7,arguments)},desaturate:function(){return this._applyModification(w7,arguments)},saturate:function(){return this._applyModification(_7,arguments)},greyscale:function(){return this._applyModification(S7,arguments)},spin:function(){return this._applyModification(E7,arguments)},_applyCombination:function(e,n){return e.apply(null,[this].concat([].slice.call(n)))},analogous:function(){return this._applyCombination(P7,arguments)},complement:function(){return this._applyCombination(T7,arguments)},monochromatic:function(){return this._applyCombination(R7,arguments)},splitcomplement:function(){return this._applyCombination(N7,arguments)},triad:function(){return this._applyCombination(wx,[3])},tetrad:function(){return this._applyCombination(wx,[4])}};Qe.fromRatio=function(t,e){if(Td(t)=="object"){var n={};for(var r in t)t.hasOwnProperty(r)&&(r==="a"?n[r]=t[r]:n[r]=Fa(t[r]));t=n}return Qe(t,e)};function g7(t){var e={r:0,g:0,b:0},n=1,r=null,s=null,i=null,a=!1,l=!1;return typeof t=="string"&&(t=L7(t)),Td(t)=="object"&&(ms(t.r)&&ms(t.g)&&ms(t.b)?(e=y7(t.r,t.g,t.b),a=!0,l=String(t.r).substr(-1)==="%"?"prgb":"rgb"):ms(t.h)&&ms(t.s)&&ms(t.v)?(r=Fa(t.s),s=Fa(t.v),e=v7(t.h,r,s),a=!0,l="hsv"):ms(t.h)&&ms(t.s)&&ms(t.l)&&(r=Fa(t.s),i=Fa(t.l),e=x7(t.h,r,i),a=!0,l="hsl"),t.hasOwnProperty("a")&&(n=t.a)),n=F_(n),{ok:a,format:t.format||l,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:n}}function y7(t,e,n){return{r:Ft(t,255)*255,g:Ft(e,255)*255,b:Ft(n,255)*255}}function yx(t,e,n){t=Ft(t,255),e=Ft(e,255),n=Ft(n,255);var r=Math.max(t,e,n),s=Math.min(t,e,n),i,a,l=(r+s)/2;if(r==s)i=a=0;else{var c=r-s;switch(a=l>.5?c/(2-r-s):c/(r+s),r){case t:i=(e-n)/c+(e<n?6:0);break;case e:i=(n-t)/c+2;break;case n:i=(t-e)/c+4;break}i/=6}return{h:i,s:a,l}}function x7(t,e,n){var r,s,i;t=Ft(t,360),e=Ft(e,100),n=Ft(n,100);function a(d,u,p){return p<0&&(p+=1),p>1&&(p-=1),p<1/6?d+(u-d)*6*p:p<1/2?u:p<2/3?d+(u-d)*(2/3-p)*6:d}if(e===0)r=s=i=n;else{var l=n<.5?n*(1+e):n+e-n*e,c=2*n-l;r=a(c,l,t+1/3),s=a(c,l,t),i=a(c,l,t-1/3)}return{r:r*255,g:s*255,b:i*255}}function xx(t,e,n){t=Ft(t,255),e=Ft(e,255),n=Ft(n,255);var r=Math.max(t,e,n),s=Math.min(t,e,n),i,a,l=r,c=r-s;if(a=r===0?0:c/r,r==s)i=0;else{switch(r){case t:i=(e-n)/c+(e<n?6:0);break;case e:i=(n-t)/c+2;break;case n:i=(t-e)/c+4;break}i/=6}return{h:i,s:a,v:l}}function v7(t,e,n){t=Ft(t,360)*6,e=Ft(e,100),n=Ft(n,100);var r=Math.floor(t),s=t-r,i=n*(1-e),a=n*(1-s*e),l=n*(1-(1-s)*e),c=r%6,d=[n,a,i,i,l,n][c],u=[l,n,n,a,i,i][c],p=[i,i,l,n,n,a][c];return{r:d*255,g:u*255,b:p*255}}function vx(t,e,n,r){var s=[Yr(Math.round(t).toString(16)),Yr(Math.round(e).toString(16)),Yr(Math.round(n).toString(16))];return r&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0):s.join("")}function b7(t,e,n,r,s){var i=[Yr(Math.round(t).toString(16)),Yr(Math.round(e).toString(16)),Yr(Math.round(n).toString(16)),Yr(B_(r))];return s&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)&&i[3].charAt(0)==i[3].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0)+i[3].charAt(0):i.join("")}function bx(t,e,n,r){var s=[Yr(B_(r)),Yr(Math.round(t).toString(16)),Yr(Math.round(e).toString(16)),Yr(Math.round(n).toString(16))];return s.join("")}Qe.equals=function(t,e){return!t||!e?!1:Qe(t).toRgbString()==Qe(e).toRgbString()};Qe.random=function(){return Qe.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function w7(t,e){e=e===0?0:e||10;var n=Qe(t).toHsl();return n.s-=e/100,n.s=cu(n.s),Qe(n)}function _7(t,e){e=e===0?0:e||10;var n=Qe(t).toHsl();return n.s+=e/100,n.s=cu(n.s),Qe(n)}function S7(t){return Qe(t).desaturate(100)}function k7(t,e){e=e===0?0:e||10;var n=Qe(t).toHsl();return n.l+=e/100,n.l=cu(n.l),Qe(n)}function j7(t,e){e=e===0?0:e||10;var n=Qe(t).toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(255*-(e/100)))),n.g=Math.max(0,Math.min(255,n.g-Math.round(255*-(e/100)))),n.b=Math.max(0,Math.min(255,n.b-Math.round(255*-(e/100)))),Qe(n)}function C7(t,e){e=e===0?0:e||10;var n=Qe(t).toHsl();return n.l-=e/100,n.l=cu(n.l),Qe(n)}function E7(t,e){var n=Qe(t).toHsl(),r=(n.h+e)%360;return n.h=r<0?360+r:r,Qe(n)}function T7(t){var e=Qe(t).toHsl();return e.h=(e.h+180)%360,Qe(e)}function wx(t,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var n=Qe(t).toHsl(),r=[Qe(t)],s=360/e,i=1;i<e;i++)r.push(Qe({h:(n.h+i*s)%360,s:n.s,l:n.l}));return r}function N7(t){var e=Qe(t).toHsl(),n=e.h;return[Qe(t),Qe({h:(n+72)%360,s:e.s,l:e.l}),Qe({h:(n+216)%360,s:e.s,l:e.l})]}function P7(t,e,n){e=e||6,n=n||30;var r=Qe(t).toHsl(),s=360/n,i=[Qe(t)];for(r.h=(r.h-(s*e>>1)+720)%360;--e;)r.h=(r.h+s)%360,i.push(Qe(r));return i}function R7(t,e){e=e||6;for(var n=Qe(t).toHsv(),r=n.h,s=n.s,i=n.v,a=[],l=1/e;e--;)a.push(Qe({h:r,s,v:i})),i=(i+l)%1;return a}Qe.mix=function(t,e,n){n=n===0?0:n||50;var r=Qe(t).toRgb(),s=Qe(e).toRgb(),i=n/100,a={r:(s.r-r.r)*i+r.r,g:(s.g-r.g)*i+r.g,b:(s.b-r.b)*i+r.b,a:(s.a-r.a)*i+r.a};return Qe(a)};Qe.readability=function(t,e){var n=Qe(t),r=Qe(e);return(Math.max(n.getLuminance(),r.getLuminance())+.05)/(Math.min(n.getLuminance(),r.getLuminance())+.05)};Qe.isReadable=function(t,e,n){var r=Qe.readability(t,e),s,i;switch(i=!1,s=D7(n),s.level+s.size){case"AAsmall":case"AAAlarge":i=r>=4.5;break;case"AAlarge":i=r>=3;break;case"AAAsmall":i=r>=7;break}return i};Qe.mostReadable=function(t,e,n){var r=null,s=0,i,a,l,c;n=n||{},a=n.includeFallbackColors,l=n.level,c=n.size;for(var d=0;d<e.length;d++)i=Qe.readability(t,e[d]),i>s&&(s=i,r=Qe(e[d]));return Qe.isReadable(t,r,{level:l,size:c})||!a?r:(n.includeFallbackColors=!1,Qe.mostReadable(t,["#fff","#000"],n))};var Tp=Qe.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},O7=Qe.hexNames=A7(Tp);function A7(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[t[n]]=n);return e}function F_(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function Ft(t,e){M7(t)&&(t="100%");var n=$7(t);return t=Math.min(e,Math.max(0,parseFloat(t))),n&&(t=parseInt(t*e,10)/100),Math.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function cu(t){return Math.min(1,Math.max(0,t))}function or(t){return parseInt(t,16)}function M7(t){return typeof t=="string"&&t.indexOf(".")!=-1&&parseFloat(t)===1}function $7(t){return typeof t=="string"&&t.indexOf("%")!=-1}function Yr(t){return t.length==1?"0"+t:""+t}function Fa(t){return t<=1&&(t=t*100+"%"),t}function B_(t){return Math.round(parseFloat(t)*255).toString(16)}function _x(t){return or(t)/255}var Fr=function(){var t="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",n="(?:"+e+")|(?:"+t+")",r="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?",s="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?";return{CSS_UNIT:new RegExp(n),rgb:new RegExp("rgb"+r),rgba:new RegExp("rgba"+s),hsl:new RegExp("hsl"+r),hsla:new RegExp("hsla"+s),hsv:new RegExp("hsv"+r),hsva:new RegExp("hsva"+s),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function ms(t){return!!Fr.CSS_UNIT.exec(t)}function L7(t){t=t.replace(f7,"").replace(m7,"").toLowerCase();var e=!1;if(Tp[t])t=Tp[t],e=!0;else if(t=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var n;return(n=Fr.rgb.exec(t))?{r:n[1],g:n[2],b:n[3]}:(n=Fr.rgba.exec(t))?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=Fr.hsl.exec(t))?{h:n[1],s:n[2],l:n[3]}:(n=Fr.hsla.exec(t))?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=Fr.hsv.exec(t))?{h:n[1],s:n[2],v:n[3]}:(n=Fr.hsva.exec(t))?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=Fr.hex8.exec(t))?{r:or(n[1]),g:or(n[2]),b:or(n[3]),a:_x(n[4]),format:e?"name":"hex8"}:(n=Fr.hex6.exec(t))?{r:or(n[1]),g:or(n[2]),b:or(n[3]),format:e?"name":"hex"}:(n=Fr.hex4.exec(t))?{r:or(n[1]+""+n[1]),g:or(n[2]+""+n[2]),b:or(n[3]+""+n[3]),a:_x(n[4]+""+n[4]),format:e?"name":"hex8"}:(n=Fr.hex3.exec(t))?{r:or(n[1]+""+n[1]),g:or(n[2]+""+n[2]),b:or(n[3]+""+n[3]),format:e?"name":"hex"}:!1}function D7(t){var e,n;return t=t||{level:"AA",size:"small"},e=(t.level||"AA").toUpperCase(),n=(t.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),n!=="small"&&n!=="large"&&(n="small"),{level:e,size:n}}var Sx=function(e){var n=["r","g","b","a","h","s","l","v"],r=0,s=0;return p7(n,function(i){if(e[i]&&(r+=1,isNaN(e[i])||(s+=1),i==="s"||i==="l")){var a=/^\d+%$/;a.test(e[i])&&(s+=1)}}),r===s?e:!1},Ba=function(e,n){var r=e.hex?Qe(e.hex):Qe(e),s=r.toHsl(),i=r.toHsv(),a=r.toRgb(),l=r.toHex();s.s===0&&(s.h=n||0,i.h=n||0);var c=l==="000000"&&a.a===0;return{hsl:s,hex:c?"transparent":"#"+l,rgb:a,hsv:i,oldHue:e.h||n||s.h,source:e.source}},ci=function(e){if(e==="transparent")return!0;var n=String(e).charAt(0)==="#"?1:0;return e.length!==4+n&&e.length<7+n&&Qe(e).isValid()},xm=function(e){if(!e)return"#fff";var n=Ba(e);if(n.hex==="transparent")return"rgba(0,0,0,0.4)";var r=(n.rgb.r*299+n.rgb.g*587+n.rgb.b*114)/1e3;return r>=128?"#000":"#fff"},dh=function(e,n){var r=e.replace("","");return Qe(n+" ("+r+")")._ok},Ra=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},I7=function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function z7(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function F7(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function B7(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var Zn=function(e){var n=function(r){B7(s,r);function s(i){z7(this,s);var a=F7(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return a.handleChange=function(l,c){var d=Sx(l);if(d){var u=Ba(l,l.h||a.state.oldHue);a.setState(u),a.props.onChangeComplete&&a.debounce(a.props.onChangeComplete,u,c),a.props.onChange&&a.props.onChange(u,c)}},a.handleSwatchHover=function(l,c){var d=Sx(l);if(d){var u=Ba(l,l.h||a.state.oldHue);a.props.onSwatchHover&&a.props.onSwatchHover(u,c)}},a.state=Ra({},Ba(i.color,0)),a.debounce=I_(function(l,c,d){l(c,d)},100),a}return I7(s,[{key:"render",value:function(){var a={};return this.props.onSwatchHover&&(a.onSwatchHover=this.handleSwatchHover),L.createElement(e,Ra({},this.props,this.state,{onChange:this.handleChange},a))}}],[{key:"getDerivedStateFromProps",value:function(a,l){return Ra({},Ba(a.color,l.oldHue))}}]),s}(O.PureComponent||O.Component);return n.propTypes=Ra({},e.propTypes),n.defaultProps=Ra({},e.defaultProps,{color:{h:250,s:.5,l:.2,a:1}}),n},H7=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},U7=function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function W7(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function kx(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function G7(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var V7=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"span";return function(r){G7(s,r);function s(){var i,a,l,c;W7(this,s);for(var d=arguments.length,u=Array(d),p=0;p<d;p++)u[p]=arguments[p];return c=(a=(l=kx(this,(i=s.__proto__||Object.getPrototypeOf(s)).call.apply(i,[this].concat(u))),l),l.state={focus:!1},l.handleFocus=function(){return l.setState({focus:!0})},l.handleBlur=function(){return l.setState({focus:!1})},a),kx(l,c)}return U7(s,[{key:"render",value:function(){return L.createElement(n,{onFocus:this.handleFocus,onBlur:this.handleBlur},L.createElement(e,H7({},this.props,this.state)))}}]),s}(L.Component)},jx=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Y7=13,q7=function(e){var n=e.color,r=e.style,s=e.onClick,i=s===void 0?function(){}:s,a=e.onHover,l=e.title,c=l===void 0?n:l,d=e.children,u=e.focus,p=e.focusStyle,h=p===void 0?{}:p,f=n==="transparent",m=mt({default:{swatch:jx({background:n,height:"100%",width:"100%",cursor:"pointer",position:"relative",outline:"none"},r,u?h:{})}}),g=function(w){return i(n,w)},v=function(w){return w.keyCode===Y7&&i(n,w)},x=function(w){return a(n,w)},y={};return a&&(y.onMouseOver=x),L.createElement("div",jx({style:m.swatch,onClick:g,title:c,tabIndex:0,onKeyDown:v},y),d,f&&L.createElement(ma,{borderRadius:m.swatch.borderRadius,boxShadow:"inset 0 0 0 1px rgba(0,0,0,0.1)"}))};const Vi=V7(q7);var X7=function(e){var n=e.direction,r=mt({default:{picker:{width:"18px",height:"18px",borderRadius:"50%",transform:"translate(-9px, -1px)",backgroundColor:"rgb(248, 248, 248)",boxShadow:"0 1px 4px 0 rgba(0, 0, 0, 0.37)"}},vertical:{picker:{transform:"translate(-3px, -9px)"}}},{vertical:n==="vertical"});return L.createElement("div",{style:r.picker})},K7=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},H_=function(e){var n=e.rgb,r=e.hsl,s=e.width,i=e.height,a=e.onChange,l=e.direction,c=e.style,d=e.renderers,u=e.pointer,p=e.className,h=p===void 0?"":p,f=mt({default:{picker:{position:"relative",width:s,height:i},alpha:{radius:"2px",style:c}}});return L.createElement("div",{style:f.picker,className:"alpha-picker "+h},L.createElement(dm,K7({},f.alpha,{rgb:n,hsl:r,pointer:u,renderers:d,onChange:a,direction:l})))};H_.defaultProps={width:"316px",height:"16px",direction:"horizontal",pointer:X7};Zn(H_);function U_(t,e){for(var n=-1,r=t==null?0:t.length,s=Array(r);++n<r;)s[n]=e(t[n],n,t);return s}var Z7="__lodash_hash_undefined__";function J7(t){return this.__data__.set(t,Z7),this}function Q7(t){return this.__data__.has(t)}function Nd(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new Ns;++e<n;)this.add(t[e])}Nd.prototype.add=Nd.prototype.push=J7;Nd.prototype.has=Q7;function eU(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function tU(t,e){return t.has(e)}var nU=1,rU=2;function W_(t,e,n,r,s,i){var a=n&nU,l=t.length,c=e.length;if(l!=c&&!(a&&c>l))return!1;var d=i.get(t),u=i.get(e);if(d&&u)return d==e&&u==t;var p=-1,h=!0,f=n&rU?new Nd:void 0;for(i.set(t,e),i.set(e,t);++p<l;){var m=t[p],g=e[p];if(r)var v=a?r(g,m,p,e,t,i):r(m,g,p,t,e,i);if(v!==void 0){if(v)continue;h=!1;break}if(f){if(!eU(e,function(x,y){if(!tU(f,y)&&(m===x||s(m,x,n,r,i)))return f.push(y)})){h=!1;break}}else if(!(m===g||s(m,g,n,r,i))){h=!1;break}}return i.delete(t),i.delete(e),h}function sU(t){var e=-1,n=Array(t.size);return t.forEach(function(r,s){n[++e]=[s,r]}),n}function iU(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var oU=1,aU=2,lU="[object Boolean]",cU="[object Date]",dU="[object Error]",uU="[object Map]",hU="[object Number]",pU="[object RegExp]",fU="[object Set]",mU="[object String]",gU="[object Symbol]",yU="[object ArrayBuffer]",xU="[object DataView]",Cx=ri?ri.prototype:void 0,uh=Cx?Cx.valueOf:void 0;function vU(t,e,n,r,s,i,a){switch(n){case xU:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case yU:return!(t.byteLength!=e.byteLength||!i(new jd(t),new jd(e)));case lU:case cU:case hU:return Fl(+t,+e);case dU:return t.name==e.name&&t.message==e.message;case pU:case mU:return t==e+"";case uU:var l=sU;case fU:var c=r&oU;if(l||(l=iU),t.size!=e.size&&!c)return!1;var d=a.get(t);if(d)return d==e;r|=aU,a.set(t,e);var u=W_(l(t),l(e),r,s,i,a);return a.delete(t),u;case gU:if(uh)return uh.call(t)==uh.call(e)}return!1}function bU(t,e){for(var n=-1,r=e.length,s=t.length;++n<r;)t[s+n]=e[n];return t}function wU(t,e,n){var r=e(t);return mr(t)?r:bU(r,n(t))}function _U(t,e){for(var n=-1,r=t==null?0:t.length,s=0,i=[];++n<r;){var a=t[n];e(a,n,t)&&(i[s++]=a)}return i}function SU(){return[]}var kU=Object.prototype,jU=kU.propertyIsEnumerable,Ex=Object.getOwnPropertySymbols,CU=Ex?function(t){return t==null?[]:(t=Object(t),_U(Ex(t),function(e){return jU.call(t,e)}))}:SU;function Tx(t){return wU(t,ym,CU)}var EU=1,TU=Object.prototype,NU=TU.hasOwnProperty;function PU(t,e,n,r,s,i){var a=n&EU,l=Tx(t),c=l.length,d=Tx(e),u=d.length;if(c!=u&&!a)return!1;for(var p=c;p--;){var h=l[p];if(!(a?h in e:NU.call(e,h)))return!1}var f=i.get(t),m=i.get(e);if(f&&m)return f==e&&m==t;var g=!0;i.set(t,e),i.set(e,t);for(var v=a;++p<c;){h=l[p];var x=t[h],y=e[h];if(r)var b=a?r(y,x,h,e,t,i):r(x,y,h,t,e,i);if(!(b===void 0?x===y||s(x,y,n,r,i):b)){g=!1;break}v||(v=h=="constructor")}if(g&&!v){var w=t.constructor,j=e.constructor;w!=j&&"constructor"in t&&"constructor"in e&&!(typeof w=="function"&&w instanceof w&&typeof j=="function"&&j instanceof j)&&(g=!1)}return i.delete(t),i.delete(e),g}var Np=Gi(Jr,"DataView"),Pp=Gi(Jr,"Promise"),Rp=Gi(Jr,"Set"),Op=Gi(Jr,"WeakMap"),Nx="[object Map]",RU="[object Object]",Px="[object Promise]",Rx="[object Set]",Ox="[object WeakMap]",Ax="[object DataView]",OU=Wi(Np),AU=Wi(Sl),MU=Wi(Pp),$U=Wi(Rp),LU=Wi(Op),Is=Ui;(Np&&Is(new Np(new ArrayBuffer(1)))!=Ax||Sl&&Is(new Sl)!=Nx||Pp&&Is(Pp.resolve())!=Px||Rp&&Is(new Rp)!=Rx||Op&&Is(new Op)!=Ox)&&(Is=function(t){var e=Ui(t),n=e==RU?t.constructor:void 0,r=n?Wi(n):"";if(r)switch(r){case OU:return Ax;case AU:return Nx;case MU:return Px;case $U:return Rx;case LU:return Ox}return e});var DU=1,Mx="[object Arguments]",$x="[object Array]",Cc="[object Object]",IU=Object.prototype,Lx=IU.hasOwnProperty;function zU(t,e,n,r,s,i){var a=mr(t),l=mr(e),c=a?$x:Is(t),d=l?$x:Is(e);c=c==Mx?Cc:c,d=d==Mx?Cc:d;var u=c==Cc,p=d==Cc,h=c==d;if(h&&Ed(t)){if(!Ed(e))return!1;a=!0,u=!1}if(h&&!u)return i||(i=new ds),a||mm(t)?W_(t,e,n,r,s,i):vU(t,e,c,n,r,s,i);if(!(n&DU)){var f=u&&Lx.call(t,"__wrapped__"),m=p&&Lx.call(e,"__wrapped__");if(f||m){var g=f?t.value():t,v=m?e.value():e;return i||(i=new ds),s(g,v,n,r,i)}}return h?(i||(i=new ds),PU(t,e,n,r,s,i)):!1}function vm(t,e,n,r,s){return t===e?!0:t==null||e==null||!si(t)&&!si(e)?t!==t&&e!==e:zU(t,e,n,r,vm,s)}var FU=1,BU=2;function HU(t,e,n,r){var s=n.length,i=s;if(t==null)return!i;for(t=Object(t);s--;){var a=n[s];if(a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++s<i;){a=n[s];var l=a[0],c=t[l],d=a[1];if(a[2]){if(c===void 0&&!(l in t))return!1}else{var u=new ds,p;if(!(p===void 0?vm(d,c,FU|BU,r,u):p))return!1}}return!0}function G_(t){return t===t&&!Tr(t)}function UU(t){for(var e=ym(t),n=e.length;n--;){var r=e[n],s=t[r];e[n]=[r,s,G_(s)]}return e}function V_(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function WU(t){var e=UU(t);return e.length==1&&e[0][2]?V_(e[0][0],e[0][1]):function(n){return n===t||HU(n,t,e)}}var GU=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,VU=/^\w*$/;function bm(t,e){if(mr(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||au(t)?!0:VU.test(t)||!GU.test(t)||e!=null&&t in Object(e)}var YU="Expected a function";function wm(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(YU);var n=function(){var r=arguments,s=e?e.apply(this,r):r[0],i=n.cache;if(i.has(s))return i.get(s);var a=t.apply(this,r);return n.cache=i.set(s,a)||i,a};return n.cache=new(wm.Cache||Ns),n}wm.Cache=Ns;var qU=500;function XU(t){var e=wm(t,function(r){return n.size===qU&&n.clear(),r}),n=e.cache;return e}var KU=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ZU=/\\(\\)?/g,JU=XU(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(KU,function(n,r,s,i){e.push(s?i.replace(ZU,"$1"):r||n)}),e}),Dx=ri?ri.prototype:void 0,Ix=Dx?Dx.toString:void 0;function Y_(t){if(typeof t=="string")return t;if(mr(t))return U_(t,Y_)+"";if(au(t))return Ix?Ix.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function QU(t){return t==null?"":Y_(t)}function q_(t,e){return mr(t)?t:bm(t,e)?[t]:JU(QU(t))}function du(t){if(typeof t=="string"||au(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function X_(t,e){e=q_(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[du(e[n++])];return n&&n==r?t:void 0}function e9(t,e,n){var r=t==null?void 0:X_(t,e);return r===void 0?n:r}function t9(t,e){return t!=null&&e in Object(t)}function n9(t,e,n){e=q_(e,t);for(var r=-1,s=e.length,i=!1;++r<s;){var a=du(e[r]);if(!(i=t!=null&&n(t,a)))break;t=t[a]}return i||++r!=s?i:(s=t==null?0:t.length,!!s&&fm(s)&&gm(a,s)&&(mr(t)||Cd(t)))}function r9(t,e){return t!=null&&n9(t,e,t9)}var s9=1,i9=2;function o9(t,e){return bm(t)&&G_(e)?V_(du(t),e):function(n){var r=e9(n,t);return r===void 0&&r===e?r9(n,t):vm(e,r,s9|i9)}}function a9(t){return function(e){return e==null?void 0:e[t]}}function l9(t){return function(e){return X_(e,t)}}function c9(t){return bm(t)?a9(du(t)):l9(t)}function d9(t){return typeof t=="function"?t:t==null?ou:typeof t=="object"?mr(t)?o9(t[0],t[1]):WU(t):c9(t)}function u9(t,e){var n=-1,r=ya(t)?Array(t.length):[];return z_(t,function(s,i,a){r[++n]=e(s,i,a)}),r}function Yi(t,e){var n=mr(t)?U_:u9;return n(t,d9(e))}var h9=function(e){var n=e.colors,r=e.onClick,s=e.onSwatchHover,i=mt({default:{swatches:{marginRight:"-10px"},swatch:{width:"22px",height:"22px",float:"left",marginRight:"10px",marginBottom:"10px",borderRadius:"4px"},clear:{clear:"both"}}});return L.createElement("div",{style:i.swatches},Yi(n,function(a){return L.createElement(Vi,{key:a,color:a,style:i.swatch,onClick:r,onHover:s,focusStyle:{boxShadow:"0 0 4px "+a}})}),L.createElement("div",{style:i.clear}))},_m=function(e){var n=e.onChange,r=e.onSwatchHover,s=e.hex,i=e.colors,a=e.width,l=e.triangle,c=e.styles,d=c===void 0?{}:c,u=e.className,p=u===void 0?"":u,h=s==="transparent",f=function(v,x){ci(v)&&n({hex:v,source:"hex"},x)},m=mt(Kn({default:{card:{width:a,background:"#fff",boxShadow:"0 1px rgba(0,0,0,.1)",borderRadius:"6px",position:"relative"},head:{height:"110px",background:s,borderRadius:"6px 6px 0 0",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},body:{padding:"10px"},label:{fontSize:"18px",color:xm(s),position:"relative"},triangle:{width:"0px",height:"0px",borderStyle:"solid",borderWidth:"0 10px 10px 10px",borderColor:"transparent transparent "+s+" transparent",position:"absolute",top:"-10px",left:"50%",marginLeft:"-10px"},input:{width:"100%",fontSize:"12px",color:"#666",border:"0px",outline:"none",height:"22px",boxShadow:"inset 0 0 0 1px #ddd",borderRadius:"4px",padding:"0 7px",boxSizing:"border-box"}},"hide-triangle":{triangle:{display:"none"}}},d),{"hide-triangle":l==="hide"});return L.createElement("div",{style:m.card,className:"block-picker "+p},L.createElement("div",{style:m.triangle}),L.createElement("div",{style:m.head},h&&L.createElement(ma,{borderRadius:"6px 6px 0 0"}),L.createElement("div",{style:m.label},s)),L.createElement("div",{style:m.body},L.createElement(h9,{colors:i,onClick:f,onSwatchHover:r}),L.createElement(bt,{style:{input:m.input},value:s,onChange:f})))};_m.propTypes={width:Ie.oneOfType([Ie.string,Ie.number]),colors:Ie.arrayOf(Ie.string),triangle:Ie.oneOf(["top","hide"]),styles:Ie.object};_m.defaultProps={width:170,colors:["#D9E3F0","#F47373","#697689","#37D67A","#2CCCE4","#555555","#dce775","#ff8a65","#ba68c8"],triangle:"top",styles:{}};Zn(_m);var lo={100:"#ffcdd2",300:"#e57373",500:"#f44336",700:"#d32f2f",900:"#b71c1c"},co={100:"#f8bbd0",300:"#f06292",500:"#e91e63",700:"#c2185b",900:"#880e4f"},uo={100:"#e1bee7",300:"#ba68c8",500:"#9c27b0",700:"#7b1fa2",900:"#4a148c"},ho={100:"#d1c4e9",300:"#9575cd",500:"#673ab7",700:"#512da8",900:"#311b92"},po={100:"#c5cae9",300:"#7986cb",500:"#3f51b5",700:"#303f9f",900:"#1a237e"},fo={100:"#bbdefb",300:"#64b5f6",500:"#2196f3",700:"#1976d2",900:"#0d47a1"},mo={100:"#b3e5fc",300:"#4fc3f7",500:"#03a9f4",700:"#0288d1",900:"#01579b"},go={100:"#b2ebf2",300:"#4dd0e1",500:"#00bcd4",700:"#0097a7",900:"#006064"},yo={100:"#b2dfdb",300:"#4db6ac",500:"#009688",700:"#00796b",900:"#004d40"},Ha={100:"#c8e6c9",300:"#81c784",500:"#4caf50",700:"#388e3c"},xo={100:"#dcedc8",300:"#aed581",500:"#8bc34a",700:"#689f38",900:"#33691e"},vo={100:"#f0f4c3",300:"#dce775",500:"#cddc39",700:"#afb42b",900:"#827717"},bo={100:"#fff9c4",300:"#fff176",500:"#ffeb3b",700:"#fbc02d",900:"#f57f17"},wo={100:"#ffecb3",300:"#ffd54f",500:"#ffc107",700:"#ffa000",900:"#ff6f00"},_o={100:"#ffe0b2",300:"#ffb74d",500:"#ff9800",700:"#f57c00",900:"#e65100"},So={100:"#ffccbc",300:"#ff8a65",500:"#ff5722",700:"#e64a19",900:"#bf360c"},ko={100:"#d7ccc8",300:"#a1887f",500:"#795548",700:"#5d4037",900:"#3e2723"},jo={100:"#cfd8dc",300:"#90a4ae",500:"#607d8b",700:"#455a64",900:"#263238"},K_=function(e){var n=e.color,r=e.onClick,s=e.onSwatchHover,i=e.hover,a=e.active,l=e.circleSize,c=e.circleSpacing,d=mt({default:{swatch:{width:l,height:l,marginRight:c,marginBottom:c,transform:"scale(1)",transition:"100ms transform ease"},Swatch:{borderRadius:"50%",background:"transparent",boxShadow:"inset 0 0 0 "+(l/2+1)+"px "+n,transition:"100ms box-shadow ease"}},hover:{swatch:{transform:"scale(1.2)"}},active:{Swatch:{boxShadow:"inset 0 0 0 3px "+n}}},{hover:i,active:a});return L.createElement("div",{style:d.swatch},L.createElement(Vi,{style:d.Swatch,color:n,onClick:r,onHover:s,focusStyle:{boxShadow:d.Swatch.boxShadow+", 0 0 5px "+n}}))};K_.defaultProps={circleSize:28,circleSpacing:14};const p9=cm(K_);var Sm=function(e){var n=e.width,r=e.onChange,s=e.onSwatchHover,i=e.colors,a=e.hex,l=e.circleSize,c=e.styles,d=c===void 0?{}:c,u=e.circleSpacing,p=e.className,h=p===void 0?"":p,f=mt(Kn({default:{card:{width:n,display:"flex",flexWrap:"wrap",marginRight:-u,marginBottom:-u}}},d)),m=function(v,x){return r({hex:v,source:"hex"},x)};return L.createElement("div",{style:f.card,className:"circle-picker "+h},Yi(i,function(g){return L.createElement(p9,{key:g,color:g,onClick:m,onSwatchHover:s,active:a===g.toLowerCase(),circleSize:l,circleSpacing:u})}))};Sm.propTypes={width:Ie.oneOfType([Ie.string,Ie.number]),circleSize:Ie.number,circleSpacing:Ie.number,styles:Ie.object};Sm.defaultProps={width:252,circleSize:28,circleSpacing:14,colors:[lo[500],co[500],uo[500],ho[500],po[500],fo[500],mo[500],go[500],yo[500],Ha[500],xo[500],vo[500],bo[500],wo[500],_o[500],So[500],ko[500],jo[500]],styles:{}};Zn(Sm);function zx(t){return t===void 0}var Z_={};Object.defineProperty(Z_,"__esModule",{value:!0});var Fx=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},f9=O,Bx=m9(f9);function m9(t){return t&&t.__esModule?t:{default:t}}function g9(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}var Ec=24,y9=Z_.default=function(t){var e=t.fill,n=e===void 0?"currentColor":e,r=t.width,s=r===void 0?Ec:r,i=t.height,a=i===void 0?Ec:i,l=t.style,c=l===void 0?{}:l,d=g9(t,["fill","width","height","style"]);return Bx.default.createElement("svg",Fx({viewBox:"0 0 "+Ec+" "+Ec,style:Fx({fill:n,width:s,height:a},c)},d),Bx.default.createElement("path",{d:"M12,18.17L8.83,15L7.42,16.41L12,21L16.59,16.41L15.17,15M12,5.83L15.17,9L16.58,7.59L12,3L7.41,7.59L8.83,9L12,5.83Z"}))},x9=function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function v9(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b9(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function w9(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var J_=function(t){w9(e,t);function e(n){v9(this,e);var r=b9(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.toggleViews=function(){r.state.view==="hex"?r.setState({view:"rgb"}):r.state.view==="rgb"?r.setState({view:"hsl"}):r.state.view==="hsl"&&(r.props.hsl.a===1?r.setState({view:"hex"}):r.setState({view:"rgb"}))},r.handleChange=function(s,i){s.hex?ci(s.hex)&&r.props.onChange({hex:s.hex,source:"hex"},i):s.r||s.g||s.b?r.props.onChange({r:s.r||r.props.rgb.r,g:s.g||r.props.rgb.g,b:s.b||r.props.rgb.b,source:"rgb"},i):s.a?(s.a<0?s.a=0:s.a>1&&(s.a=1),r.props.onChange({h:r.props.hsl.h,s:r.props.hsl.s,l:r.props.hsl.l,a:Math.round(s.a*100)/100,source:"rgb"},i)):(s.h||s.s||s.l)&&(typeof s.s=="string"&&s.s.includes("%")&&(s.s=s.s.replace("%","")),typeof s.l=="string"&&s.l.includes("%")&&(s.l=s.l.replace("%","")),s.s==1?s.s=.01:s.l==1&&(s.l=.01),r.props.onChange({h:s.h||r.props.hsl.h,s:Number(zx(s.s)?r.props.hsl.s:s.s),l:Number(zx(s.l)?r.props.hsl.l:s.l),source:"hsl"},i))},r.showHighlight=function(s){s.currentTarget.style.background="#eee"},r.hideHighlight=function(s){s.currentTarget.style.background="transparent"},n.hsl.a!==1&&n.view==="hex"?r.state={view:"rgb"}:r.state={view:n.view},r}return x9(e,[{key:"render",value:function(){var r=this,s=mt({default:{wrap:{paddingTop:"16px",display:"flex"},fields:{flex:"1",display:"flex",marginLeft:"-6px"},field:{paddingLeft:"6px",width:"100%"},alpha:{paddingLeft:"6px",width:"100%"},toggle:{width:"32px",textAlign:"right",position:"relative"},icon:{marginRight:"-4px",marginTop:"12px",cursor:"pointer",position:"relative"},iconHighlight:{position:"absolute",width:"24px",height:"28px",background:"#eee",borderRadius:"4px",top:"10px",left:"12px",display:"none"},input:{fontSize:"11px",color:"#333",width:"100%",borderRadius:"2px",border:"none",boxShadow:"inset 0 0 0 1px #dadada",height:"21px",textAlign:"center"},label:{textTransform:"uppercase",fontSize:"11px",lineHeight:"11px",color:"#969696",textAlign:"center",display:"block",marginTop:"12px"},svg:{fill:"#333",width:"24px",height:"24px",border:"1px transparent solid",borderRadius:"5px"}},disableAlpha:{alpha:{display:"none"}}},this.props,this.state),i=void 0;return this.state.view==="hex"?i=L.createElement("div",{style:s.fields,className:"flexbox-fix"},L.createElement("div",{style:s.field},L.createElement(bt,{style:{input:s.input,label:s.label},label:"hex",value:this.props.hex,onChange:this.handleChange}))):this.state.view==="rgb"?i=L.createElement("div",{style:s.fields,className:"flexbox-fix"},L.createElement("div",{style:s.field},L.createElement(bt,{style:{input:s.input,label:s.label},label:"r",value:this.props.rgb.r,onChange:this.handleChange})),L.createElement("div",{style:s.field},L.createElement(bt,{style:{input:s.input,label:s.label},label:"g",value:this.props.rgb.g,onChange:this.handleChange})),L.createElement("div",{style:s.field},L.createElement(bt,{style:{input:s.input,label:s.label},label:"b",value:this.props.rgb.b,onChange:this.handleChange})),L.createElement("div",{style:s.alpha},L.createElement(bt,{style:{input:s.input,label:s.label},label:"a",value:this.props.rgb.a,arrowOffset:.01,onChange:this.handleChange}))):this.state.view==="hsl"&&(i=L.createElement("div",{style:s.fields,className:"flexbox-fix"},L.createElement("div",{style:s.field},L.createElement(bt,{style:{input:s.input,label:s.label},label:"h",value:Math.round(this.props.hsl.h),onChange:this.handleChange})),L.createElement("div",{style:s.field},L.createElement(bt,{style:{input:s.input,label:s.label},label:"s",value:Math.round(this.props.hsl.s*100)+"%",onChange:this.handleChange})),L.createElement("div",{style:s.field},L.createElement(bt,{style:{input:s.input,label:s.label},label:"l",value:Math.round(this.props.hsl.l*100)+"%",onChange:this.handleChange})),L.createElement("div",{style:s.alpha},L.createElement(bt,{style:{input:s.input,label:s.label},label:"a",value:this.props.hsl.a,arrowOffset:.01,onChange:this.handleChange})))),L.createElement("div",{style:s.wrap,className:"flexbox-fix"},i,L.createElement("div",{style:s.toggle},L.createElement("div",{style:s.icon,onClick:this.toggleViews,ref:function(l){return r.icon=l}},L.createElement(y9,{style:s.svg,onMouseOver:this.showHighlight,onMouseEnter:this.showHighlight,onMouseOut:this.hideHighlight}))))}}],[{key:"getDerivedStateFromProps",value:function(r,s){return r.hsl.a!==1&&s.view==="hex"?{view:"rgb"}:null}}]),e}(L.Component);J_.defaultProps={view:"hex"};var Hx=function(){var e=mt({default:{picker:{width:"12px",height:"12px",borderRadius:"6px",transform:"translate(-6px, -1px)",backgroundColor:"rgb(248, 248, 248)",boxShadow:"0 1px 4px 0 rgba(0, 0, 0, 0.37)"}}});return L.createElement("div",{style:e.picker})},_9=function(){var e=mt({default:{picker:{width:"12px",height:"12px",borderRadius:"6px",boxShadow:"inset 0 0 0 1px #fff",transform:"translate(-6px, -6px)"}}});return L.createElement("div",{style:e.picker})},km=function(e){var n=e.width,r=e.onChange,s=e.disableAlpha,i=e.rgb,a=e.hsl,l=e.hsv,c=e.hex,d=e.renderers,u=e.styles,p=u===void 0?{}:u,h=e.className,f=h===void 0?"":h,m=e.defaultView,g=mt(Kn({default:{picker:{width:n,background:"#fff",borderRadius:"2px",boxShadow:"0 0 2px rgba(0,0,0,.3), 0 4px 8px rgba(0,0,0,.3)",boxSizing:"initial",fontFamily:"Menlo"},saturation:{width:"100%",paddingBottom:"55%",position:"relative",borderRadius:"2px 2px 0 0",overflow:"hidden"},Saturation:{radius:"2px 2px 0 0"},body:{padding:"16px 16px 12px"},controls:{display:"flex"},color:{width:"32px"},swatch:{marginTop:"6px",width:"16px",height:"16px",borderRadius:"8px",position:"relative",overflow:"hidden"},active:{absolute:"0px 0px 0px 0px",borderRadius:"8px",boxShadow:"inset 0 0 0 1px rgba(0,0,0,.1)",background:"rgba("+i.r+", "+i.g+", "+i.b+", "+i.a+")",zIndex:"2"},toggles:{flex:"1"},hue:{height:"10px",position:"relative",marginBottom:"8px"},Hue:{radius:"2px"},alpha:{height:"10px",position:"relative"},Alpha:{radius:"2px"}},disableAlpha:{color:{width:"22px"},alpha:{display:"none"},hue:{marginBottom:"0px"},swatch:{width:"10px",height:"10px",marginTop:"0px"}}},p),{disableAlpha:s});return L.createElement("div",{style:g.picker,className:"chrome-picker "+f},L.createElement("div",{style:g.saturation},L.createElement(lu,{style:g.Saturation,hsl:a,hsv:l,pointer:_9,onChange:r})),L.createElement("div",{style:g.body},L.createElement("div",{style:g.controls,className:"flexbox-fix"},L.createElement("div",{style:g.color},L.createElement("div",{style:g.swatch},L.createElement("div",{style:g.active}),L.createElement(ma,{renderers:d}))),L.createElement("div",{style:g.toggles},L.createElement("div",{style:g.hue},L.createElement(ga,{style:g.Hue,hsl:a,pointer:Hx,onChange:r})),L.createElement("div",{style:g.alpha},L.createElement(dm,{style:g.Alpha,rgb:i,hsl:a,pointer:Hx,renderers:d,onChange:r})))),L.createElement(J_,{rgb:i,hsl:a,hex:c,view:m,onChange:r,disableAlpha:s})))};km.propTypes={width:Ie.oneOfType([Ie.string,Ie.number]),disableAlpha:Ie.bool,styles:Ie.object,defaultView:Ie.oneOf(["hex","rgb","hsl"])};km.defaultProps={width:225,disableAlpha:!1,styles:{}};Zn(km);var S9=function(e){var n=e.color,r=e.onClick,s=r===void 0?function(){}:r,i=e.onSwatchHover,a=e.active,l=mt({default:{color:{background:n,width:"15px",height:"15px",float:"left",marginRight:"5px",marginBottom:"5px",position:"relative",cursor:"pointer"},dot:{absolute:"5px 5px 5px 5px",background:xm(n),borderRadius:"50%",opacity:"0"}},active:{dot:{opacity:"1"}},"color-#FFFFFF":{color:{boxShadow:"inset 0 0 0 1px #ddd"},dot:{background:"#000"}},transparent:{dot:{background:"#000"}}},{active:a,"color-#FFFFFF":n==="#FFFFFF",transparent:n==="transparent"});return L.createElement(Vi,{style:l.color,color:n,onClick:s,onHover:i,focusStyle:{boxShadow:"0 0 4px "+n}},L.createElement("div",{style:l.dot}))},k9=function(e){var n=e.hex,r=e.rgb,s=e.onChange,i=mt({default:{fields:{display:"flex",paddingBottom:"6px",paddingRight:"5px",position:"relative"},active:{position:"absolute",top:"6px",left:"5px",height:"9px",width:"9px",background:n},HEXwrap:{flex:"6",position:"relative"},HEXinput:{width:"80%",padding:"0px",paddingLeft:"20%",border:"none",outline:"none",background:"none",fontSize:"12px",color:"#333",height:"16px"},HEXlabel:{display:"none"},RGBwrap:{flex:"3",position:"relative"},RGBinput:{width:"70%",padding:"0px",paddingLeft:"30%",border:"none",outline:"none",background:"none",fontSize:"12px",color:"#333",height:"16px"},RGBlabel:{position:"absolute",top:"3px",left:"0px",lineHeight:"16px",textTransform:"uppercase",fontSize:"12px",color:"#999"}}}),a=function(c,d){c.r||c.g||c.b?s({r:c.r||r.r,g:c.g||r.g,b:c.b||r.b,source:"rgb"},d):s({hex:c.hex,source:"hex"},d)};return L.createElement("div",{style:i.fields,className:"flexbox-fix"},L.createElement("div",{style:i.active}),L.createElement(bt,{style:{wrap:i.HEXwrap,input:i.HEXinput,label:i.HEXlabel},label:"hex",value:n,onChange:a}),L.createElement(bt,{style:{wrap:i.RGBwrap,input:i.RGBinput,label:i.RGBlabel},label:"r",value:r.r,onChange:a}),L.createElement(bt,{style:{wrap:i.RGBwrap,input:i.RGBinput,label:i.RGBlabel},label:"g",value:r.g,onChange:a}),L.createElement(bt,{style:{wrap:i.RGBwrap,input:i.RGBinput,label:i.RGBlabel},label:"b",value:r.b,onChange:a}))},jm=function(e){var n=e.onChange,r=e.onSwatchHover,s=e.colors,i=e.hex,a=e.rgb,l=e.styles,c=l===void 0?{}:l,d=e.className,u=d===void 0?"":d,p=mt(Kn({default:{Compact:{background:"#f6f6f6",radius:"4px"},compact:{paddingTop:"5px",paddingLeft:"5px",boxSizing:"initial",width:"240px"},clear:{clear:"both"}}},c)),h=function(m,g){m.hex?ci(m.hex)&&n({hex:m.hex,source:"hex"},g):n(m,g)};return L.createElement(Bl,{style:p.Compact,styles:c},L.createElement("div",{style:p.compact,className:"compact-picker "+u},L.createElement("div",null,Yi(s,function(f){return L.createElement(S9,{key:f,color:f,active:f.toLowerCase()===i,onClick:h,onSwatchHover:r})}),L.createElement("div",{style:p.clear})),L.createElement(k9,{hex:i,rgb:a,onChange:h})))};jm.propTypes={colors:Ie.arrayOf(Ie.string),styles:Ie.object};jm.defaultProps={colors:["#4D4D4D","#999999","#FFFFFF","#F44E3B","#FE9200","#FCDC00","#DBDF00","#A4DD00","#68CCCA","#73D8FF","#AEA1FF","#FDA1FF","#333333","#808080","#cccccc","#D33115","#E27300","#FCC400","#B0BC00","#68BC00","#16A5A5","#009CE0","#7B64FF","#FA28FF","#000000","#666666","#B3B3B3","#9F0500","#C45100","#FB9E00","#808900","#194D33","#0C797D","#0062B1","#653294","#AB149E"],styles:{}};Zn(jm);var j9=function(e){var n=e.hover,r=e.color,s=e.onClick,i=e.onSwatchHover,a={position:"relative",zIndex:"2",outline:"2px solid #fff",boxShadow:"0 0 5px 2px rgba(0,0,0,0.25)"},l=mt({default:{swatch:{width:"25px",height:"25px",fontSize:"0"}},hover:{swatch:a}},{hover:n});return L.createElement("div",{style:l.swatch},L.createElement(Vi,{color:r,onClick:s,onHover:i,focusStyle:a}))};const C9=cm(j9);var Cm=function(e){var n=e.width,r=e.colors,s=e.onChange,i=e.onSwatchHover,a=e.triangle,l=e.styles,c=l===void 0?{}:l,d=e.className,u=d===void 0?"":d,p=mt(Kn({default:{card:{width:n,background:"#fff",border:"1px solid rgba(0,0,0,0.2)",boxShadow:"0 3px 12px rgba(0,0,0,0.15)",borderRadius:"4px",position:"relative",padding:"5px",display:"flex",flexWrap:"wrap"},triangle:{position:"absolute",border:"7px solid transparent",borderBottomColor:"#fff"},triangleShadow:{position:"absolute",border:"8px solid transparent",borderBottomColor:"rgba(0,0,0,0.15)"}},"hide-triangle":{triangle:{display:"none"},triangleShadow:{display:"none"}},"top-left-triangle":{triangle:{top:"-14px",left:"10px"},triangleShadow:{top:"-16px",left:"9px"}},"top-right-triangle":{triangle:{top:"-14px",right:"10px"},triangleShadow:{top:"-16px",right:"9px"}},"bottom-left-triangle":{triangle:{top:"35px",left:"10px",transform:"rotate(180deg)"},triangleShadow:{top:"37px",left:"9px",transform:"rotate(180deg)"}},"bottom-right-triangle":{triangle:{top:"35px",right:"10px",transform:"rotate(180deg)"},triangleShadow:{top:"37px",right:"9px",transform:"rotate(180deg)"}}},c),{"hide-triangle":a==="hide","top-left-triangle":a==="top-left","top-right-triangle":a==="top-right","bottom-left-triangle":a==="bottom-left","bottom-right-triangle":a==="bottom-right"}),h=function(m,g){return s({hex:m,source:"hex"},g)};return L.createElement("div",{style:p.card,className:"github-picker "+u},L.createElement("div",{style:p.triangleShadow}),L.createElement("div",{style:p.triangle}),Yi(r,function(f){return L.createElement(C9,{color:f,key:f,onClick:h,onSwatchHover:i})}))};Cm.propTypes={width:Ie.oneOfType([Ie.string,Ie.number]),colors:Ie.arrayOf(Ie.string),triangle:Ie.oneOf(["hide","top-left","top-right","bottom-left","bottom-right"]),styles:Ie.object};Cm.defaultProps={width:200,colors:["#B80000","#DB3E00","#FCCB00","#008B02","#006B76","#1273DE","#004DCF","#5300EB","#EB9694","#FAD0C3","#FEF3BD","#C1E1C5","#BEDADC","#C4DEF6","#BED3F3","#D4C4FB"],triangle:"top-left",styles:{}};Zn(Cm);var E9=function(e){var n=e.direction,r=mt({default:{picker:{width:"18px",height:"18px",borderRadius:"50%",transform:"translate(-9px, -1px)",backgroundColor:"rgb(248, 248, 248)",boxShadow:"0 1px 4px 0 rgba(0, 0, 0, 0.37)"}},vertical:{picker:{transform:"translate(-3px, -9px)"}}},{vertical:n==="vertical"});return L.createElement("div",{style:r.picker})},T9=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Em=function(e){var n=e.width,r=e.height,s=e.onChange,i=e.hsl,a=e.direction,l=e.pointer,c=e.styles,d=c===void 0?{}:c,u=e.className,p=u===void 0?"":u,h=mt(Kn({default:{picker:{position:"relative",width:n,height:r},hue:{radius:"2px"}}},d)),f=function(g){return s({a:1,h:g.h,l:.5,s:1})};return L.createElement("div",{style:h.picker,className:"hue-picker "+p},L.createElement(ga,T9({},h.hue,{hsl:i,pointer:l,onChange:f,direction:a})))};Em.propTypes={styles:Ie.object};Em.defaultProps={width:"316px",height:"16px",direction:"horizontal",pointer:E9,styles:{}};Zn(Em);var N9=function(e){var n=e.onChange,r=e.hex,s=e.rgb,i=e.styles,a=i===void 0?{}:i,l=e.className,c=l===void 0?"":l,d=mt(Kn({default:{material:{width:"98px",height:"98px",padding:"16px",fontFamily:"Roboto"},HEXwrap:{position:"relative"},HEXinput:{width:"100%",marginTop:"12px",fontSize:"15px",color:"#333",padding:"0px",border:"0px",borderBottom:"2px solid "+r,outline:"none",height:"30px"},HEXlabel:{position:"absolute",top:"0px",left:"0px",fontSize:"11px",color:"#999999",textTransform:"capitalize"},Hex:{style:{}},RGBwrap:{position:"relative"},RGBinput:{width:"100%",marginTop:"12px",fontSize:"15px",color:"#333",padding:"0px",border:"0px",borderBottom:"1px solid #eee",outline:"none",height:"30px"},RGBlabel:{position:"absolute",top:"0px",left:"0px",fontSize:"11px",color:"#999999",textTransform:"capitalize"},split:{display:"flex",marginRight:"-10px",paddingTop:"11px"},third:{flex:"1",paddingRight:"10px"}}},a)),u=function(h,f){h.hex?ci(h.hex)&&n({hex:h.hex,source:"hex"},f):(h.r||h.g||h.b)&&n({r:h.r||s.r,g:h.g||s.g,b:h.b||s.b,source:"rgb"},f)};return L.createElement(Bl,{styles:a},L.createElement("div",{style:d.material,className:"material-picker "+c},L.createElement(bt,{style:{wrap:d.HEXwrap,input:d.HEXinput,label:d.HEXlabel},label:"hex",value:r,onChange:u}),L.createElement("div",{style:d.split,className:"flexbox-fix"},L.createElement("div",{style:d.third},L.createElement(bt,{style:{wrap:d.RGBwrap,input:d.RGBinput,label:d.RGBlabel},label:"r",value:s.r,onChange:u})),L.createElement("div",{style:d.third},L.createElement(bt,{style:{wrap:d.RGBwrap,input:d.RGBinput,label:d.RGBlabel},label:"g",value:s.g,onChange:u})),L.createElement("div",{style:d.third},L.createElement(bt,{style:{wrap:d.RGBwrap,input:d.RGBinput,label:d.RGBlabel},label:"b",value:s.b,onChange:u})))))};Zn(N9);var P9=function(e){var n=e.onChange,r=e.rgb,s=e.hsv,i=e.hex,a=mt({default:{fields:{paddingTop:"5px",paddingBottom:"9px",width:"80px",position:"relative"},divider:{height:"5px"},RGBwrap:{position:"relative"},RGBinput:{marginLeft:"40%",width:"40%",height:"18px",border:"1px solid #888888",boxShadow:"inset 0 1px 1px rgba(0,0,0,.1), 0 1px 0 0 #ECECEC",marginBottom:"5px",fontSize:"13px",paddingLeft:"3px",marginRight:"10px"},RGBlabel:{left:"0px",top:"0px",width:"34px",textTransform:"uppercase",fontSize:"13px",height:"18px",lineHeight:"22px",position:"absolute"},HEXwrap:{position:"relative"},HEXinput:{marginLeft:"20%",width:"80%",height:"18px",border:"1px solid #888888",boxShadow:"inset 0 1px 1px rgba(0,0,0,.1), 0 1px 0 0 #ECECEC",marginBottom:"6px",fontSize:"13px",paddingLeft:"3px"},HEXlabel:{position:"absolute",top:"0px",left:"0px",width:"14px",textTransform:"uppercase",fontSize:"13px",height:"18px",lineHeight:"22px"},fieldSymbols:{position:"absolute",top:"5px",right:"-7px",fontSize:"13px"},symbol:{height:"20px",lineHeight:"22px",paddingBottom:"7px"}}}),l=function(d,u){d["#"]?ci(d["#"])&&n({hex:d["#"],source:"hex"},u):d.r||d.g||d.b?n({r:d.r||r.r,g:d.g||r.g,b:d.b||r.b,source:"rgb"},u):(d.h||d.s||d.v)&&n({h:d.h||s.h,s:d.s||s.s,v:d.v||s.v,source:"hsv"},u)};return L.createElement("div",{style:a.fields},L.createElement(bt,{style:{wrap:a.RGBwrap,input:a.RGBinput,label:a.RGBlabel},label:"h",value:Math.round(s.h),onChange:l}),L.createElement(bt,{style:{wrap:a.RGBwrap,input:a.RGBinput,label:a.RGBlabel},label:"s",value:Math.round(s.s*100),onChange:l}),L.createElement(bt,{style:{wrap:a.RGBwrap,input:a.RGBinput,label:a.RGBlabel},label:"v",value:Math.round(s.v*100),onChange:l}),L.createElement("div",{style:a.divider}),L.createElement(bt,{style:{wrap:a.RGBwrap,input:a.RGBinput,label:a.RGBlabel},label:"r",value:r.r,onChange:l}),L.createElement(bt,{style:{wrap:a.RGBwrap,input:a.RGBinput,label:a.RGBlabel},label:"g",value:r.g,onChange:l}),L.createElement(bt,{style:{wrap:a.RGBwrap,input:a.RGBinput,label:a.RGBlabel},label:"b",value:r.b,onChange:l}),L.createElement("div",{style:a.divider}),L.createElement(bt,{style:{wrap:a.HEXwrap,input:a.HEXinput,label:a.HEXlabel},label:"#",value:i.replace("#",""),onChange:l}),L.createElement("div",{style:a.fieldSymbols},L.createElement("div",{style:a.symbol},""),L.createElement("div",{style:a.symbol},"%"),L.createElement("div",{style:a.symbol},"%")))},R9=function(e){var n=e.hsl,r=mt({default:{picker:{width:"12px",height:"12px",borderRadius:"6px",boxShadow:"inset 0 0 0 1px #fff",transform:"translate(-6px, -6px)"}},"black-outline":{picker:{boxShadow:"inset 0 0 0 1px #000"}}},{"black-outline":n.l>.5});return L.createElement("div",{style:r.picker})},O9=function(){var e=mt({default:{triangle:{width:0,height:0,borderStyle:"solid",borderWidth:"4px 0 4px 6px",borderColor:"transparent transparent transparent #fff",position:"absolute",top:"1px",left:"1px"},triangleBorder:{width:0,height:0,borderStyle:"solid",borderWidth:"5px 0 5px 8px",borderColor:"transparent transparent transparent #555"},left:{Extend:"triangleBorder",transform:"translate(-13px, -4px)"},leftInside:{Extend:"triangle",transform:"translate(-8px, -5px)"},right:{Extend:"triangleBorder",transform:"translate(20px, -14px) rotate(180deg)"},rightInside:{Extend:"triangle",transform:"translate(-8px, -5px)"}}});return L.createElement("div",{style:e.pointer},L.createElement("div",{style:e.left},L.createElement("div",{style:e.leftInside})),L.createElement("div",{style:e.right},L.createElement("div",{style:e.rightInside})))},Ux=function(e){var n=e.onClick,r=e.label,s=e.children,i=e.active,a=mt({default:{button:{backgroundImage:"linear-gradient(-180deg, #FFFFFF 0%, #E6E6E6 100%)",border:"1px solid #878787",borderRadius:"2px",height:"20px",boxShadow:"0 1px 0 0 #EAEAEA",fontSize:"14px",color:"#000",lineHeight:"20px",textAlign:"center",marginBottom:"10px",cursor:"pointer"}},active:{button:{boxShadow:"0 0 0 1px #878787"}}},{active:i});return L.createElement("div",{style:a.button,onClick:n},r||s)},A9=function(e){var n=e.rgb,r=e.currentColor,s=mt({default:{swatches:{border:"1px solid #B3B3B3",borderBottom:"1px solid #F0F0F0",marginBottom:"2px",marginTop:"1px"},new:{height:"34px",background:"rgb("+n.r+","+n.g+", "+n.b+")",boxShadow:"inset 1px 0 0 #000, inset -1px 0 0 #000, inset 0 1px 0 #000"},current:{height:"34px",background:r,boxShadow:"inset 1px 0 0 #000, inset -1px 0 0 #000, inset 0 -1px 0 #000"},label:{fontSize:"14px",color:"#000",textAlign:"center"}}});return L.createElement("div",null,L.createElement("div",{style:s.label},"new"),L.createElement("div",{style:s.swatches},L.createElement("div",{style:s.new}),L.createElement("div",{style:s.current})),L.createElement("div",{style:s.label},"current"))},M9=function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function $9(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function L9(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function D9(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var Tm=function(t){D9(e,t);function e(n){$9(this,e);var r=L9(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.state={currentColor:n.hex},r}return M9(e,[{key:"render",value:function(){var r=this.props,s=r.styles,i=s===void 0?{}:s,a=r.className,l=a===void 0?"":a,c=mt(Kn({default:{picker:{background:"#DCDCDC",borderRadius:"4px",boxShadow:"0 0 0 1px rgba(0,0,0,.25), 0 8px 16px rgba(0,0,0,.15)",boxSizing:"initial",width:"513px"},head:{backgroundImage:"linear-gradient(-180deg, #F0F0F0 0%, #D4D4D4 100%)",borderBottom:"1px solid #B1B1B1",boxShadow:"inset 0 1px 0 0 rgba(255,255,255,.2), inset 0 -1px 0 0 rgba(0,0,0,.02)",height:"23px",lineHeight:"24px",borderRadius:"4px 4px 0 0",fontSize:"13px",color:"#4D4D4D",textAlign:"center"},body:{padding:"15px 15px 0",display:"flex"},saturation:{width:"256px",height:"256px",position:"relative",border:"2px solid #B3B3B3",borderBottom:"2px solid #F0F0F0",overflow:"hidden"},hue:{position:"relative",height:"256px",width:"19px",marginLeft:"10px",border:"2px solid #B3B3B3",borderBottom:"2px solid #F0F0F0"},controls:{width:"180px",marginLeft:"10px"},top:{display:"flex"},previews:{width:"60px"},actions:{flex:"1",marginLeft:"20px"}}},i));return L.createElement("div",{style:c.picker,className:"photoshop-picker "+l},L.createElement("div",{style:c.head},this.props.header),L.createElement("div",{style:c.body,className:"flexbox-fix"},L.createElement("div",{style:c.saturation},L.createElement(lu,{hsl:this.props.hsl,hsv:this.props.hsv,pointer:R9,onChange:this.props.onChange})),L.createElement("div",{style:c.hue},L.createElement(ga,{direction:"vertical",hsl:this.props.hsl,pointer:O9,onChange:this.props.onChange})),L.createElement("div",{style:c.controls},L.createElement("div",{style:c.top,className:"flexbox-fix"},L.createElement("div",{style:c.previews},L.createElement(A9,{rgb:this.props.rgb,currentColor:this.state.currentColor})),L.createElement("div",{style:c.actions},L.createElement(Ux,{label:"OK",onClick:this.props.onAccept,active:!0}),L.createElement(Ux,{label:"Cancel",onClick:this.props.onCancel}),L.createElement(P9,{onChange:this.props.onChange,rgb:this.props.rgb,hsv:this.props.hsv,hex:this.props.hex}))))))}}]),e}(L.Component);Tm.propTypes={header:Ie.string,styles:Ie.object};Tm.defaultProps={header:"Color Picker",styles:{}};Zn(Tm);var I9=function(e){var n=e.onChange,r=e.rgb,s=e.hsl,i=e.hex,a=e.disableAlpha,l=mt({default:{fields:{display:"flex",paddingTop:"4px"},single:{flex:"1",paddingLeft:"6px"},alpha:{flex:"1",paddingLeft:"6px"},double:{flex:"2"},input:{width:"80%",padding:"4px 10% 3px",border:"none",boxShadow:"inset 0 0 0 1px #ccc",fontSize:"11px"},label:{display:"block",textAlign:"center",fontSize:"11px",color:"#222",paddingTop:"3px",paddingBottom:"4px",textTransform:"capitalize"}},disableAlpha:{alpha:{display:"none"}}},{disableAlpha:a}),c=function(u,p){u.hex?ci(u.hex)&&n({hex:u.hex,source:"hex"},p):u.r||u.g||u.b?n({r:u.r||r.r,g:u.g||r.g,b:u.b||r.b,a:r.a,source:"rgb"},p):u.a&&(u.a<0?u.a=0:u.a>100&&(u.a=100),u.a/=100,n({h:s.h,s:s.s,l:s.l,a:u.a,source:"rgb"},p))};return L.createElement("div",{style:l.fields,className:"flexbox-fix"},L.createElement("div",{style:l.double},L.createElement(bt,{style:{input:l.input,label:l.label},label:"hex",value:i.replace("#",""),onChange:c})),L.createElement("div",{style:l.single},L.createElement(bt,{style:{input:l.input,label:l.label},label:"r",value:r.r,onChange:c,dragLabel:"true",dragMax:"255"})),L.createElement("div",{style:l.single},L.createElement(bt,{style:{input:l.input,label:l.label},label:"g",value:r.g,onChange:c,dragLabel:"true",dragMax:"255"})),L.createElement("div",{style:l.single},L.createElement(bt,{style:{input:l.input,label:l.label},label:"b",value:r.b,onChange:c,dragLabel:"true",dragMax:"255"})),L.createElement("div",{style:l.alpha},L.createElement(bt,{style:{input:l.input,label:l.label},label:"a",value:Math.round(r.a*100),onChange:c,dragLabel:"true",dragMax:"100"})))},z9=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Q_=function(e){var n=e.colors,r=e.onClick,s=r===void 0?function(){}:r,i=e.onSwatchHover,a=mt({default:{colors:{margin:"0 -10px",padding:"10px 0 0 10px",borderTop:"1px solid #eee",display:"flex",flexWrap:"wrap",position:"relative"},swatchWrap:{width:"16px",height:"16px",margin:"0 10px 10px 0"},swatch:{borderRadius:"3px",boxShadow:"inset 0 0 0 1px rgba(0,0,0,.15)"}},"no-presets":{colors:{display:"none"}}},{"no-presets":!n||!n.length}),l=function(d,u){s({hex:d,source:"hex"},u)};return L.createElement("div",{style:a.colors,className:"flexbox-fix"},n.map(function(c){var d=typeof c=="string"?{color:c}:c,u=""+d.color+(d.title||"");return L.createElement("div",{key:u,style:a.swatchWrap},L.createElement(Vi,z9({},d,{style:a.swatch,onClick:l,onHover:i,focusStyle:{boxShadow:"inset 0 0 0 1px rgba(0,0,0,.15), 0 0 4px "+d.color}})))}))};Q_.propTypes={colors:Ie.arrayOf(Ie.oneOfType([Ie.string,Ie.shape({color:Ie.string,title:Ie.string})])).isRequired};var F9=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Nm=function(e){var n=e.width,r=e.rgb,s=e.hex,i=e.hsv,a=e.hsl,l=e.onChange,c=e.onSwatchHover,d=e.disableAlpha,u=e.presetColors,p=e.renderers,h=e.styles,f=h===void 0?{}:h,m=e.className,g=m===void 0?"":m,v=mt(Kn({default:F9({picker:{width:n,padding:"10px 10px 0",boxSizing:"initial",background:"#fff",borderRadius:"4px",boxShadow:"0 0 0 1px rgba(0,0,0,.15), 0 8px 16px rgba(0,0,0,.15)"},saturation:{width:"100%",paddingBottom:"75%",position:"relative",overflow:"hidden"},Saturation:{radius:"3px",shadow:"inset 0 0 0 1px rgba(0,0,0,.15), inset 0 0 4px rgba(0,0,0,.25)"},controls:{display:"flex"},sliders:{padding:"4px 0",flex:"1"},color:{width:"24px",height:"24px",position:"relative",marginTop:"4px",marginLeft:"4px",borderRadius:"3px"},activeColor:{absolute:"0px 0px 0px 0px",borderRadius:"2px",background:"rgba("+r.r+","+r.g+","+r.b+","+r.a+")",boxShadow:"inset 0 0 0 1px rgba(0,0,0,.15), inset 0 0 4px rgba(0,0,0,.25)"},hue:{position:"relative",height:"10px",overflow:"hidden"},Hue:{radius:"2px",shadow:"inset 0 0 0 1px rgba(0,0,0,.15), inset 0 0 4px rgba(0,0,0,.25)"},alpha:{position:"relative",height:"10px",marginTop:"4px",overflow:"hidden"},Alpha:{radius:"2px",shadow:"inset 0 0 0 1px rgba(0,0,0,.15), inset 0 0 4px rgba(0,0,0,.25)"}},f),disableAlpha:{color:{height:"10px"},hue:{height:"10px"},alpha:{display:"none"}}},f),{disableAlpha:d});return L.createElement("div",{style:v.picker,className:"sketch-picker "+g},L.createElement("div",{style:v.saturation},L.createElement(lu,{style:v.Saturation,hsl:a,hsv:i,onChange:l})),L.createElement("div",{style:v.controls,className:"flexbox-fix"},L.createElement("div",{style:v.sliders},L.createElement("div",{style:v.hue},L.createElement(ga,{style:v.Hue,hsl:a,onChange:l})),L.createElement("div",{style:v.alpha},L.createElement(dm,{style:v.Alpha,rgb:r,hsl:a,renderers:p,onChange:l}))),L.createElement("div",{style:v.color},L.createElement(ma,null),L.createElement("div",{style:v.activeColor}))),L.createElement(I9,{rgb:r,hsl:a,hex:s,onChange:l,disableAlpha:d}),L.createElement(Q_,{colors:u,onClick:l,onSwatchHover:c}))};Nm.propTypes={disableAlpha:Ie.bool,width:Ie.oneOfType([Ie.string,Ie.number]),styles:Ie.object};Nm.defaultProps={disableAlpha:!1,width:200,styles:{},presetColors:["#D0021B","#F5A623","#F8E71C","#8B572A","#7ED321","#417505","#BD10E0","#9013FE","#4A90E2","#50E3C2","#B8E986","#000000","#4A4A4A","#9B9B9B","#FFFFFF"]};Zn(Nm);var Oa=function(e){var n=e.hsl,r=e.offset,s=e.onClick,i=s===void 0?function(){}:s,a=e.active,l=e.first,c=e.last,d=mt({default:{swatch:{height:"12px",background:"hsl("+n.h+", 50%, "+r*100+"%)",cursor:"pointer"}},first:{swatch:{borderRadius:"2px 0 0 2px"}},last:{swatch:{borderRadius:"0 2px 2px 0"}},active:{swatch:{transform:"scaleY(1.8)",borderRadius:"3.6px/2px"}}},{active:a,first:l,last:c}),u=function(h){return i({h:n.h,s:.5,l:r,source:"hsl"},h)};return L.createElement("div",{style:d.swatch,onClick:u})},B9=function(e){var n=e.onClick,r=e.hsl,s=mt({default:{swatches:{marginTop:"20px"},swatch:{boxSizing:"border-box",width:"20%",paddingRight:"1px",float:"left"},clear:{clear:"both"}}}),i=.1;return L.createElement("div",{style:s.swatches},L.createElement("div",{style:s.swatch},L.createElement(Oa,{hsl:r,offset:".80",active:Math.abs(r.l-.8)<i&&Math.abs(r.s-.5)<i,onClick:n,first:!0})),L.createElement("div",{style:s.swatch},L.createElement(Oa,{hsl:r,offset:".65",active:Math.abs(r.l-.65)<i&&Math.abs(r.s-.5)<i,onClick:n})),L.createElement("div",{style:s.swatch},L.createElement(Oa,{hsl:r,offset:".50",active:Math.abs(r.l-.5)<i&&Math.abs(r.s-.5)<i,onClick:n})),L.createElement("div",{style:s.swatch},L.createElement(Oa,{hsl:r,offset:".35",active:Math.abs(r.l-.35)<i&&Math.abs(r.s-.5)<i,onClick:n})),L.createElement("div",{style:s.swatch},L.createElement(Oa,{hsl:r,offset:".20",active:Math.abs(r.l-.2)<i&&Math.abs(r.s-.5)<i,onClick:n,last:!0})),L.createElement("div",{style:s.clear}))},H9=function(){var e=mt({default:{picker:{width:"14px",height:"14px",borderRadius:"6px",transform:"translate(-7px, -1px)",backgroundColor:"rgb(248, 248, 248)",boxShadow:"0 1px 4px 0 rgba(0, 0, 0, 0.37)"}}});return L.createElement("div",{style:e.picker})},Pm=function(e){var n=e.hsl,r=e.onChange,s=e.pointer,i=e.styles,a=i===void 0?{}:i,l=e.className,c=l===void 0?"":l,d=mt(Kn({default:{hue:{height:"12px",position:"relative"},Hue:{radius:"2px"}}},a));return L.createElement("div",{style:d.wrap||{},className:"slider-picker "+c},L.createElement("div",{style:d.hue},L.createElement(ga,{style:d.Hue,hsl:n,pointer:s,onChange:r})),L.createElement("div",{style:d.swatches},L.createElement(B9,{hsl:n,onClick:r})))};Pm.propTypes={styles:Ie.object};Pm.defaultProps={pointer:H9,styles:{}};Zn(Pm);var e2={};Object.defineProperty(e2,"__esModule",{value:!0});var Wx=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},U9=O,Gx=W9(U9);function W9(t){return t&&t.__esModule?t:{default:t}}function G9(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}var Tc=24,V9=e2.default=function(t){var e=t.fill,n=e===void 0?"currentColor":e,r=t.width,s=r===void 0?Tc:r,i=t.height,a=i===void 0?Tc:i,l=t.style,c=l===void 0?{}:l,d=G9(t,["fill","width","height","style"]);return Gx.default.createElement("svg",Wx({viewBox:"0 0 "+Tc+" "+Tc,style:Wx({fill:n,width:s,height:a},c)},d),Gx.default.createElement("path",{d:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"}))},Y9=function(e){var n=e.color,r=e.onClick,s=r===void 0?function(){}:r,i=e.onSwatchHover,a=e.first,l=e.last,c=e.active,d=mt({default:{color:{width:"40px",height:"24px",cursor:"pointer",background:n,marginBottom:"1px"},check:{color:xm(n),marginLeft:"8px",display:"none"}},first:{color:{overflow:"hidden",borderRadius:"2px 2px 0 0"}},last:{color:{overflow:"hidden",borderRadius:"0 0 2px 2px"}},active:{check:{display:"block"}},"color-#FFFFFF":{color:{boxShadow:"inset 0 0 0 1px #ddd"},check:{color:"#333"}},transparent:{check:{color:"#333"}}},{first:a,last:l,active:c,"color-#FFFFFF":n==="#FFFFFF",transparent:n==="transparent"});return L.createElement(Vi,{color:n,style:d.color,onClick:s,onHover:i,focusStyle:{boxShadow:"0 0 4px "+n}},L.createElement("div",{style:d.check},L.createElement(V9,null)))},q9=function(e){var n=e.onClick,r=e.onSwatchHover,s=e.group,i=e.active,a=mt({default:{group:{paddingBottom:"10px",width:"40px",float:"left",marginRight:"10px"}}});return L.createElement("div",{style:a.group},Yi(s,function(l,c){return L.createElement(Y9,{key:l,color:l,active:l.toLowerCase()===i,first:c===0,last:c===s.length-1,onClick:n,onSwatchHover:r})}))},Rm=function(e){var n=e.width,r=e.height,s=e.onChange,i=e.onSwatchHover,a=e.colors,l=e.hex,c=e.styles,d=c===void 0?{}:c,u=e.className,p=u===void 0?"":u,h=mt(Kn({default:{picker:{width:n,height:r},overflow:{height:r,overflowY:"scroll"},body:{padding:"16px 0 6px 16px"},clear:{clear:"both"}}},d)),f=function(g,v){return s({hex:g,source:"hex"},v)};return L.createElement("div",{style:h.picker,className:"swatches-picker "+p},L.createElement(Bl,null,L.createElement("div",{style:h.overflow},L.createElement("div",{style:h.body},Yi(a,function(m){return L.createElement(q9,{key:m.toString(),group:m,active:l,onClick:f,onSwatchHover:i})}),L.createElement("div",{style:h.clear})))))};Rm.propTypes={width:Ie.oneOfType([Ie.string,Ie.number]),height:Ie.oneOfType([Ie.string,Ie.number]),colors:Ie.arrayOf(Ie.arrayOf(Ie.string)),styles:Ie.object};Rm.defaultProps={width:320,height:240,colors:[[lo[900],lo[700],lo[500],lo[300],lo[100]],[co[900],co[700],co[500],co[300],co[100]],[uo[900],uo[700],uo[500],uo[300],uo[100]],[ho[900],ho[700],ho[500],ho[300],ho[100]],[po[900],po[700],po[500],po[300],po[100]],[fo[900],fo[700],fo[500],fo[300],fo[100]],[mo[900],mo[700],mo[500],mo[300],mo[100]],[go[900],go[700],go[500],go[300],go[100]],[yo[900],yo[700],yo[500],yo[300],yo[100]],["#194D33",Ha[700],Ha[500],Ha[300],Ha[100]],[xo[900],xo[700],xo[500],xo[300],xo[100]],[vo[900],vo[700],vo[500],vo[300],vo[100]],[bo[900],bo[700],bo[500],bo[300],bo[100]],[wo[900],wo[700],wo[500],wo[300],wo[100]],[_o[900],_o[700],_o[500],_o[300],_o[100]],[So[900],So[700],So[500],So[300],So[100]],[ko[900],ko[700],ko[500],ko[300],ko[100]],[jo[900],jo[700],jo[500],jo[300],jo[100]],["#000000","#525252","#969696","#D9D9D9","#FFFFFF"]],styles:{}};Zn(Rm);var Om=function(e){var n=e.onChange,r=e.onSwatchHover,s=e.hex,i=e.colors,a=e.width,l=e.triangle,c=e.styles,d=c===void 0?{}:c,u=e.className,p=u===void 0?"":u,h=mt(Kn({default:{card:{width:a,background:"#fff",border:"0 solid rgba(0,0,0,0.25)",boxShadow:"0 1px 4px rgba(0,0,0,0.25)",borderRadius:"4px",position:"relative"},body:{padding:"15px 9px 9px 15px"},label:{fontSize:"18px",color:"#fff"},triangle:{width:"0px",height:"0px",borderStyle:"solid",borderWidth:"0 9px 10px 9px",borderColor:"transparent transparent #fff transparent",position:"absolute"},triangleShadow:{width:"0px",height:"0px",borderStyle:"solid",borderWidth:"0 9px 10px 9px",borderColor:"transparent transparent rgba(0,0,0,.1) transparent",position:"absolute"},hash:{background:"#F0F0F0",height:"30px",width:"30px",borderRadius:"4px 0 0 4px",float:"left",color:"#98A1A4",display:"flex",alignItems:"center",justifyContent:"center"},input:{width:"100px",fontSize:"14px",color:"#666",border:"0px",outline:"none",height:"28px",boxShadow:"inset 0 0 0 1px #F0F0F0",boxSizing:"content-box",borderRadius:"0 4px 4px 0",float:"left",paddingLeft:"8px"},swatch:{width:"30px",height:"30px",float:"left",borderRadius:"4px",margin:"0 6px 6px 0"},clear:{clear:"both"}},"hide-triangle":{triangle:{display:"none"},triangleShadow:{display:"none"}},"top-left-triangle":{triangle:{top:"-10px",left:"12px"},triangleShadow:{top:"-11px",left:"12px"}},"top-right-triangle":{triangle:{top:"-10px",right:"12px"},triangleShadow:{top:"-11px",right:"12px"}}},d),{"hide-triangle":l==="hide","top-left-triangle":l==="top-left","top-right-triangle":l==="top-right"}),f=function(g,v){ci(g)&&n({hex:g,source:"hex"},v)};return L.createElement("div",{style:h.card,className:"twitter-picker "+p},L.createElement("div",{style:h.triangleShadow}),L.createElement("div",{style:h.triangle}),L.createElement("div",{style:h.body},Yi(i,function(m,g){return L.createElement(Vi,{key:g,color:m,hex:m,style:h.swatch,onClick:f,onHover:r,focusStyle:{boxShadow:"0 0 4px "+m}})}),L.createElement("div",{style:h.hash},"#"),L.createElement(bt,{label:null,style:{input:h.input},value:s.replace("#",""),onChange:f}),L.createElement("div",{style:h.clear})))};Om.propTypes={width:Ie.oneOfType([Ie.string,Ie.number]),triangle:Ie.oneOf(["hide","top-left","top-right"]),colors:Ie.arrayOf(Ie.string),styles:Ie.object};Om.defaultProps={width:276,colors:["#FF6900","#FCB900","#7BDCB5","#00D084","#8ED1FC","#0693E3","#ABB8C3","#EB144C","#F78DA7","#9900EF"],triangle:"top-left",styles:{}};Zn(Om);var Am=function(e){var n=mt({default:{picker:{width:"20px",height:"20px",borderRadius:"22px",border:"2px #fff solid",transform:"translate(-12px, -13px)",background:"hsl("+Math.round(e.hsl.h)+", "+Math.round(e.hsl.s*100)+"%, "+Math.round(e.hsl.l*100)+"%)"}}});return L.createElement("div",{style:n.picker})};Am.propTypes={hsl:Ie.shape({h:Ie.number,s:Ie.number,l:Ie.number,a:Ie.number})};Am.defaultProps={hsl:{a:1,h:249.94,l:.2,s:.5}};var Mm=function(e){var n=mt({default:{picker:{width:"20px",height:"20px",borderRadius:"22px",transform:"translate(-10px, -7px)",background:"hsl("+Math.round(e.hsl.h)+", 100%, 50%)",border:"2px white solid"}}});return L.createElement("div",{style:n.picker})};Mm.propTypes={hsl:Ie.shape({h:Ie.number,s:Ie.number,l:Ie.number,a:Ie.number})};Mm.defaultProps={hsl:{a:1,h:249.94,l:.2,s:.5}};var X9=function(e){var n=e.onChange,r=e.rgb,s=e.hsl,i=e.hex,a=e.hsv,l=function(f,m){if(f.hex)ci(f.hex)&&n({hex:f.hex,source:"hex"},m);else if(f.rgb){var g=f.rgb.split(",");dh(f.rgb,"rgb")&&n({r:g[0],g:g[1],b:g[2],a:1,source:"rgb"},m)}else if(f.hsv){var v=f.hsv.split(",");dh(f.hsv,"hsv")&&(v[2]=v[2].replace("%",""),v[1]=v[1].replace("%",""),v[0]=v[0].replace("",""),v[1]==1?v[1]=.01:v[2]==1&&(v[2]=.01),n({h:Number(v[0]),s:Number(v[1]),v:Number(v[2]),source:"hsv"},m))}else if(f.hsl){var x=f.hsl.split(",");dh(f.hsl,"hsl")&&(x[2]=x[2].replace("%",""),x[1]=x[1].replace("%",""),x[0]=x[0].replace("",""),p[1]==1?p[1]=.01:p[2]==1&&(p[2]=.01),n({h:Number(x[0]),s:Number(x[1]),v:Number(x[2]),source:"hsl"},m))}},c=mt({default:{wrap:{display:"flex",height:"100px",marginTop:"4px"},fields:{width:"100%"},column:{paddingTop:"10px",display:"flex",justifyContent:"space-between"},double:{padding:"0px 4.4px",boxSizing:"border-box"},input:{width:"100%",height:"38px",boxSizing:"border-box",padding:"4px 10% 3px",textAlign:"center",border:"1px solid #dadce0",fontSize:"11px",textTransform:"lowercase",borderRadius:"5px",outline:"none",fontFamily:"Roboto,Arial,sans-serif"},input2:{height:"38px",width:"100%",border:"1px solid #dadce0",boxSizing:"border-box",fontSize:"11px",textTransform:"lowercase",borderRadius:"5px",outline:"none",paddingLeft:"10px",fontFamily:"Roboto,Arial,sans-serif"},label:{textAlign:"center",fontSize:"12px",background:"#fff",position:"absolute",textTransform:"uppercase",color:"#3c4043",width:"35px",top:"-6px",left:"0",right:"0",marginLeft:"auto",marginRight:"auto",fontFamily:"Roboto,Arial,sans-serif"},label2:{left:"10px",textAlign:"center",fontSize:"12px",background:"#fff",position:"absolute",textTransform:"uppercase",color:"#3c4043",width:"32px",top:"-6px",fontFamily:"Roboto,Arial,sans-serif"},single:{flexGrow:"1",margin:"0px 4.4px"}}}),d=r.r+", "+r.g+", "+r.b,u=Math.round(s.h)+", "+Math.round(s.s*100)+"%, "+Math.round(s.l*100)+"%",p=Math.round(a.h)+", "+Math.round(a.s*100)+"%, "+Math.round(a.v*100)+"%";return L.createElement("div",{style:c.wrap,className:"flexbox-fix"},L.createElement("div",{style:c.fields},L.createElement("div",{style:c.double},L.createElement(bt,{style:{input:c.input,label:c.label},label:"hex",value:i,onChange:l})),L.createElement("div",{style:c.column},L.createElement("div",{style:c.single},L.createElement(bt,{style:{input:c.input2,label:c.label2},label:"rgb",value:d,onChange:l})),L.createElement("div",{style:c.single},L.createElement(bt,{style:{input:c.input2,label:c.label2},label:"hsv",value:p,onChange:l})),L.createElement("div",{style:c.single},L.createElement(bt,{style:{input:c.input2,label:c.label2},label:"hsl",value:u,onChange:l})))))},$m=function(e){var n=e.width,r=e.onChange,s=e.rgb,i=e.hsl,a=e.hsv,l=e.hex,c=e.header,d=e.styles,u=d===void 0?{}:d,p=e.className,h=p===void 0?"":p,f=mt(Kn({default:{picker:{width:n,background:"#fff",border:"1px solid #dfe1e5",boxSizing:"initial",display:"flex",flexWrap:"wrap",borderRadius:"8px 8px 0px 0px"},head:{height:"57px",width:"100%",paddingTop:"16px",paddingBottom:"16px",paddingLeft:"16px",fontSize:"20px",boxSizing:"border-box",fontFamily:"Roboto-Regular,HelveticaNeue,Arial,sans-serif"},saturation:{width:"70%",padding:"0px",position:"relative",overflow:"hidden"},swatch:{width:"30%",height:"228px",padding:"0px",background:"rgba("+s.r+", "+s.g+", "+s.b+", 1)",position:"relative",overflow:"hidden"},body:{margin:"auto",width:"95%"},controls:{display:"flex",boxSizing:"border-box",height:"52px",paddingTop:"22px"},color:{width:"32px"},hue:{height:"8px",position:"relative",margin:"0px 16px 0px 16px",width:"100%"},Hue:{radius:"2px"}}},u));return L.createElement("div",{style:f.picker,className:"google-picker "+h},L.createElement("div",{style:f.head},c),L.createElement("div",{style:f.swatch}),L.createElement("div",{style:f.saturation},L.createElement(lu,{hsl:i,hsv:a,pointer:Am,onChange:r})),L.createElement("div",{style:f.body},L.createElement("div",{style:f.controls,className:"flexbox-fix"},L.createElement("div",{style:f.hue},L.createElement(ga,{style:f.Hue,hsl:i,radius:"4px",pointer:Mm,onChange:r}))),L.createElement(X9,{rgb:s,hsl:i,hex:l,hsv:a,onChange:r})))};$m.propTypes={width:Ie.oneOfType([Ie.string,Ie.number]),styles:Ie.object,header:Ie.string};$m.defaultProps={width:652,styles:{},header:"Color picker"};Zn($m);function K9({color:t,mode:e="blend",onColorChange:n,onClose:r}){var u;const[s,i]=O.useState((t==null?void 0:t.hex)||"#000000");O.useEffect(()=>{t!=null&&t.hex&&i(t.hex)},[t==null?void 0:t.hex]);const a=()=>{t!=null&&t.originalHex&&(i(t.originalHex),n&&n(t.originalHex))},l=p=>{const h=p.hex;i(h),n&&n(h)},c=()=>{i("transparent"),n&&n("transparent")},d=s==="transparent"||s==="none";return t?o.jsxs("div",{className:"color-editor-panel",children:[o.jsxs("div",{className:"editor-header",children:[o.jsx("h3",{children:"Edit Colour"}),o.jsx("button",{onClick:r,className:"close-button",children:""})]}),o.jsxs("div",{className:"editor-content",children:[o.jsxs("div",{className:"color-info-section",children:[o.jsx("div",{className:"color-display",children:o.jsxs("div",{className:"swatch-pair",children:[o.jsxs("div",{className:"swatch-group",children:[o.jsx("div",{className:"swatch original",style:{backgroundColor:t.originalHex||t.hex},title:"Original colour"}),o.jsx("span",{className:"swatch-label",children:"Original"})]}),o.jsx("span",{className:"arrow",children:""}),o.jsxs("div",{className:"swatch-group",children:[o.jsx("div",{className:`swatch current ${d?"transparent-preview":""}`,style:d?{}:{backgroundColor:s},title:"Current colour"}),o.jsx("span",{className:"swatch-label",children:d?"Transparent":"Current"})]})]})}),o.jsxs("div",{className:"color-details",children:[o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"label",children:"Hex:"}),o.jsx("span",{className:"value",children:s})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"label",children:"Coverage:"}),o.jsxs("span",{className:"value",children:[((u=t.areaPct)==null?void 0:u.toFixed(1))||0,"%"]})]})]})]}),o.jsxs("div",{className:"transparent-section",children:[o.jsx("h4",{children:"Remove Fill"}),o.jsxs("button",{className:`transparent-option ${d?"selected":""}`,onClick:c,title:"Make this area transparent (remove fill)",children:[o.jsx("div",{className:"transparent-swatch"}),o.jsx("span",{children:"Make Transparent"})]})]}),o.jsxs("div",{className:"tpv-palette-section",children:[o.jsx("h4",{children:"Standard TPV Colours"}),o.jsx("p",{className:"palette-description",children:"Select a pure TPV colour (no blending required)"}),o.jsx("div",{className:"tpv-color-grid",children:fn.map(p=>o.jsxs("div",{className:`tpv-color-item ${s.toLowerCase()===p.hex.toLowerCase()?"selected":""}`,onClick:()=>l(p),title:`${p.code} - ${p.name}`,children:[o.jsx("div",{className:"tpv-color-swatch",style:{backgroundColor:p.hex}}),o.jsx("span",{className:"tpv-color-code",children:p.code})]},p.code))})]}),ki.BLEND_MODE_ENABLED,o.jsxs("div",{className:"solid-mode-info",children:[o.jsx("h4",{children:"Solid Mode Editing"}),o.jsx("p",{className:"info-description",children:"Select from the standard TPV colours above. Only solid TPV colours are available."}),o.jsx("button",{onClick:a,className:"reset-button",children:"Reset to Original Colour"})]})]}),o.jsx("style",{jsx:!0,children:`
        .color-editor-panel {
          position: fixed;
          top: 0;
          right: 0;
          width: 400px;
          height: 100vh;
          background: white;
          box-shadow: -4px 0 12px rgba(0, 0, 0, 0.15);
          z-index: 1000;
          display: flex;
          flex-direction: column;
          overflow: hidden;
        }

        .editor-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 1.5rem;
          border-bottom: 2px solid #1a365d;
          background: #f9f9f9;
        }

        .editor-header h3 {
          font-family: 'Overpass', sans-serif;
          margin: 0;
          color: #1e4a7a;
          font-size: 1.5rem;
          font-weight: 600;
        }

        .close-button {
          background: none;
          border: none;
          font-size: 2rem;
          color: #666;
          cursor: pointer;
          padding: 0;
          width: 32px;
          height: 32px;
          line-height: 1;
          transition: color 0.2s;
        }

        .close-button:hover {
          color: #333;
        }

        .editor-content {
          flex: 1;
          overflow-y: auto;
          padding: 1.5rem;
        }

        /* Color Info Section */
        .color-info-section {
          margin-bottom: 2rem;
          padding: 1rem;
          background: #f9f9f9;
          border-radius: 6px;
        }

        .color-display {
          margin-bottom: 1rem;
        }

        .swatch-pair {
          display: flex;
          align-items: center;
          gap: 1rem;
          justify-content: center;
        }

        .swatch-group {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 0.5rem;
        }

        .swatch {
          width: 60px;
          height: 60px;
          border-radius: 8px;
          border: 3px solid #ddd;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .swatch.original {
          border-color: #999;
        }

        .swatch.current {
          border-color: #ff6b35;
        }

        .swatch.transparent-preview {
          background:
            linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%),
            linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%);
          background-size: 10px 10px;
          background-position: 0 0, 5px 5px;
          background-color: white;
        }

        .swatch-label {
          font-size: 0.85rem;
          color: #666;
          font-weight: 500;
        }

        .arrow {
          font-size: 1.5rem;
          color: #666;
          font-weight: bold;
        }

        .color-details {
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .detail-row {
          display: flex;
          justify-content: space-between;
          align-items: center;
          font-size: 0.95rem;
        }

        .detail-row .label {
          font-weight: 600;
          color: #666;
        }

        .detail-row .value {
          font-family: 'Courier New', monospace;
          color: #333;
        }

        /* Transparent Section */
        .transparent-section {
          margin-bottom: 1.5rem;
          padding: 1rem;
          background: #f9f9f9;
          border-radius: 6px;
        }

        .transparent-section h4 {
          margin: 0 0 0.75rem 0;
          color: #1a365d;
          font-size: 1rem;
          font-weight: 600;
        }

        .transparent-option {
          display: flex;
          align-items: center;
          gap: 12px;
          width: 100%;
          padding: 12px 16px;
          background: white;
          border: 2px solid #d1d5db;
          border-radius: 8px;
          cursor: pointer;
          transition: all 0.2s;
          font-size: 0.95rem;
          font-weight: 500;
          color: #374151;
        }

        .transparent-option:hover {
          border-color: #6b7280;
          background: #fafafa;
        }

        .transparent-option.selected {
          border-color: #ff6b35;
          background: #fff5f0;
          box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.2);
        }

        .transparent-swatch {
          width: 32px;
          height: 32px;
          border-radius: 4px;
          border: 1px solid #999;
          background:
            linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%),
            linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%);
          background-size: 8px 8px;
          background-position: 0 0, 4px 4px;
          background-color: white;
        }

        /* TPV Palette Section */
        .tpv-palette-section {
          margin-bottom: 2rem;
          padding: 1rem;
          background: #f9f9f9;
          border-radius: 6px;
        }

        .tpv-palette-section h4 {
          margin: 0 0 0.5rem 0;
          color: #1a365d;
          font-size: 1rem;
          font-weight: 600;
        }

        .palette-description {
          margin: 0 0 1rem 0;
          font-size: 0.85rem;
          color: #666;
        }

        .tpv-color-grid {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 0.75rem;
        }

        .tpv-color-item {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 0.4rem;
          padding: 0.5rem;
          border: 2px solid transparent;
          border-radius: 6px;
          cursor: pointer;
          transition: all 0.2s;
          background: white;
        }

        .tpv-color-item:hover {
          border-color: #ff6b35;
          transform: translateY(-2px);
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .tpv-color-item.selected {
          border-color: #ff6b35;
          background: #fff5f0;
          box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.2);
        }

        .tpv-color-swatch {
          width: 100%;
          height: 50px;
          border-radius: 4px;
          border: 1px solid rgba(0, 0, 0, 0.1);
          box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .tpv-color-code {
          font-size: 0.75rem;
          font-weight: 600;
          color: #1a365d;
          font-family: 'Courier New', monospace;
        }

        /* Picker Section */
        .picker-section {
          margin-bottom: 1rem;
          padding: 1rem;
          background: #f9f9f9;
          border-radius: 6px;
        }

        .picker-section h4 {
          margin: 0 0 0.5rem 0;
          color: #1a365d;
          font-size: 1rem;
          font-weight: 600;
        }

        .picker-description {
          margin: 0 0 1rem 0;
          font-size: 0.85rem;
          color: #666;
        }

        .picker-section :global(.chrome-picker) {
          box-shadow: none !important;
          width: 100% !important;
        }

        .reset-button {
          width: 100%;
          padding: 0.75rem;
          margin-top: 1rem;
          background: #e0e0e0;
          color: #333;
          border: none;
          border-radius: 4px;
          font-weight: 600;
          cursor: pointer;
          transition: background 0.2s;
        }

        .reset-button:hover {
          background: #d0d0d0;
        }

        /* Solid Mode Info */
        .solid-mode-info {
          margin-bottom: 1rem;
          padding: 1rem;
          background: #fff5f0;
          border: 2px solid #ff6b35;
          border-radius: 6px;
        }

        .solid-mode-info h4 {
          margin: 0 0 0.5rem 0;
          color: #1a365d;
          font-size: 1rem;
          font-weight: 600;
        }

        .info-description {
          margin: 0;
          font-size: 0.85rem;
          color: #666;
          line-height: 1.5;
        }

        /* Mobile Responsive - Fullscreen Modal */
        @media (max-width: 768px) {
          .color-editor-panel {
            width: 100%;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 0;
          }

          .editor-header {
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 10;
          }

          .editor-header h3 {
            font-size: 1.25rem;
          }

          /* Larger close button for touch */
          .close-button {
            width: 44px;
            height: 44px;
            font-size: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
          }

          .editor-content {
            padding: 1rem;
          }

          /* Color swatches - larger for touch */
          .swatch {
            width: 50px;
            height: 50px;
          }

          .color-info-section {
            padding: 0.75rem;
            margin-bottom: 1.5rem;
          }

          /* TPV color grid - better touch targets */
          .tpv-color-grid {
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
          }

          .tpv-color-item {
            padding: 0.4rem;
            min-height: 44px;
          }

          .tpv-color-swatch {
            height: 36px;
          }

          .tpv-color-code {
            font-size: 0.65rem;
          }

          .tpv-palette-section {
            padding: 0.75rem;
            margin-bottom: 1.5rem;
          }

          .tpv-palette-section h4 {
            font-size: 0.9rem;
          }

          .palette-description {
            font-size: 0.8rem;
          }

          /* Picker section */
          .picker-section {
            padding: 0.75rem;
          }

          .picker-section h4 {
            font-size: 0.9rem;
          }

          .picker-description {
            font-size: 0.8rem;
          }

          /* Larger reset button for touch */
          .reset-button {
            min-height: 44px;
            font-size: 0.9rem;
          }

          .solid-mode-info {
            padding: 0.75rem;
          }

          .solid-mode-info h4 {
            font-size: 0.9rem;
          }

          .info-description {
            font-size: 0.8rem;
          }
        }

        /* Extra small screens */
        @media (max-width: 400px) {
          .tpv-color-grid {
            grid-template-columns: repeat(3, 1fr);
          }

          .tpv-color-swatch {
            height: 44px;
          }

          .swatch {
            width: 44px;
            height: 44px;
          }

          .swatch-pair {
            gap: 0.5rem;
          }

          .arrow {
            font-size: 1.2rem;
          }
        }
      `})]}):null}const Z9=fn;new Map(Z9.map((t,e)=>[t.code,e]));function t2(t){const{inputMode:e,prompt:n,selectedFile:r,lengthMM:s,widthMM:i,result:a,viewMode:l,blendRecipes:c,solidRecipes:d,colorMapping:u,solidColorMapping:p,solidEditedColors:h,blendEditedColors:f,blendSvgUrl:m,solidSvgUrl:g,arMapping:v,jobId:x,inSituData:y,regionOverrides:b,originalTaggedSvg:w}=t;console.log("[SERIALIZE] Serializing design with result:",a),console.log("[SERIALIZE] result.svg_url:",a==null?void 0:a.svg_url),console.log("[SERIALIZE] regionOverrides:",b),console.log("[SERIALIZE] regionOverrides size:",b==null?void 0:b.size),console.log("[SERIALIZE] originalTaggedSvg present:",!!w);const j=_=>_?_ instanceof Map?Object.fromEntries(_):_:null;return{input_mode:e,prompt:n||null,uploaded_file_url:(r==null?void 0:r.url)||null,dimensions:{widthMM:i,lengthMM:s},original_svg_url:(a==null?void 0:a.svg_url)||null,original_png_url:(a==null?void 0:a.png_url)||null,thumbnail_url:(a==null?void 0:a.thumb_url)||null,blend_recipes:c||null,solid_recipes:d||null,color_mapping:j(u),solid_color_mapping:j(p),solid_color_edits:j(h),blend_color_edits:j(f),final_blend_svg_url:m||null,final_solid_svg_url:g||null,preferred_view_mode:l||"solid",aspect_ratio_mapping:v||null,job_id:x||null,in_situ:y?{room_photo_url:y.room_photo_url||null,mask_url:y.mask_url||null,floor_dimensions_m:y.floor_dimensions_m||null,preview_url:y.preview_url||null,blend_opacity:y.blend_opacity||20,perspective_corners:y.perspective_corners||null}:null,region_overrides:j(b),original_tagged_svg:w||null}}function Ap(t){var i,a,l,c;console.log("[DESERIALIZE] Incoming savedData keys:",Object.keys(t||{})),console.log("[DESERIALIZE] savedData.region_overrides:",t==null?void 0:t.region_overrides),console.log("[DESERIALIZE] savedData.design_data:",t==null?void 0:t.design_data),console.log("[DESERIALIZE] savedData.design_data?.region_overrides:",(i=t==null?void 0:t.design_data)==null?void 0:i.region_overrides),console.log("[DESERIALIZE] savedData.original_tagged_svg present:",!!(t!=null&&t.original_tagged_svg)),console.log("[DESERIALIZE] savedData.design_data?.original_tagged_svg present:",!!((a=t==null?void 0:t.design_data)!=null&&a.original_tagged_svg));const e=d=>d?d instanceof Map?d:new Map(Object.entries(d)):new Map,n=d=>{var u;return t[d]??((u=t.design_data)==null?void 0:u[d])},r=n("region_overrides"),s=n("original_tagged_svg");return console.log("[DESERIALIZE] Final regionOverridesData:",r),console.log("[DESERIALIZE] Final originalTaggedSvgData present:",!!s),{inputMode:t.input_mode||n("input_mode"),prompt:n("prompt")||"",selectedFile:n("uploaded_file_url")?{url:n("uploaded_file_url"),name:n("uploaded_file_url").split("/").pop()}:null,lengthMM:((l=n("dimensions"))==null?void 0:l.lengthMM)||0,widthMM:((c=n("dimensions"))==null?void 0:c.widthMM)||0,result:{svg_url:n("original_svg_url"),png_url:n("original_png_url"),thumbnail_url:n("thumbnail_url")},blendRecipes:n("blend_recipes")||null,solidRecipes:n("solid_recipes")||null,colorMapping:e(n("color_mapping")),solidColorMapping:e(n("solid_color_mapping")),solidEditedColors:e(n("solid_color_edits")),blendEditedColors:e(n("blend_color_edits")),blendSvgUrl:null,solidSvgUrl:null,viewMode:"solid",arMapping:n("aspect_ratio_mapping"),jobId:n("job_id"),inSituData:n("in_situ")||null,regionOverrides:e(r),originalTaggedSvg:s||null,generating:!1,generatingBlends:!1,showFinalRecipes:!!t.blend_recipes,showSolidSummary:!!t.solid_recipes,colorEditorOpen:!1,selectedColor:null}}function J9(t){var n;const e=[];return t.inputMode||e.push("Input mode is required"),(!(t.widthMM>0)||!(t.lengthMM>0))&&e.push("Surface dimensions are required"),(n=t.result)!=null&&n.svg_url||e.push("No design to save - generate a design first"),{valid:e.length===0,errors:e}}function Q9({currentState:t,existingDesignId:e=null,initialName:n="",onClose:r,onSaved:s}){const[i,a]=O.useState(n),[l,c]=O.useState(""),[d,u]=O.useState(""),[p,h]=O.useState(""),[f,m]=O.useState(!1),[g,v]=O.useState([]),[x,y]=O.useState(!1),[b,w]=O.useState(""),[j,_]=O.useState("#1a365d"),[S,E]=O.useState(!1),[T,M]=O.useState(!1),[Z,N]=O.useState(!1),[G,C]=O.useState(null);O.useEffect(()=>{F()},[]);const F=async()=>{try{const{projects:I}=await Bf();v(I)}catch(I){console.error("Failed to load projects:",I),C("Failed to load projects")}},pe=async()=>{if(!b.trim()){C("Project name is required");return}N(!0),C(null);try{const{project:I}=await O1({name:b.trim(),color:j});v([I,...g]),u(I.id),y(!1),w(""),_("#1a365d")}catch(I){console.error("Failed to create project:",I),C(I.message)}finally{N(!1)}},V=async(I=!1)=>{if(!i.trim()){C("Design name is required");return}const K=J9(t);if(!K.valid){C(K.errors.join(", "));return}I?M(!0):E(!0),C(null);try{const z=t2(t);console.log("[SAVE-MODAL] Serialized design data:",z),console.log("[SAVE-MODAL] SVG URL from serialized data:",z.original_svg_url);const W={name:i.trim(),description:l.trim()||null,project_id:d||null,tags:p.split(",").map(ue=>ue.trim()).filter(ue=>ue),is_public:f,design_data:z};console.log("[SAVE-MODAL] Full save payload:",W),e&&!I&&(W.id=e);const fe=await If(W);s&&s(fe,i.trim()),r()}catch(z){console.error("Failed to save design:",z),C(z.message)}finally{E(!1),M(!1)}},J=["#1a365d","#ff6b35","#4a90e2","#50c878","#9b59b6","#e74c3c"];return o.jsx("div",{className:"modal-overlay",onClick:r,children:o.jsxs("div",{className:"modal-content save-design-modal",onClick:I=>I.stopPropagation(),children:[o.jsxs("div",{className:"modal-header",children:[o.jsx("h2",{children:e?"Update Design":"Save Design"}),o.jsx("button",{onClick:r,className:"close-button",children:""})]}),o.jsxs("div",{className:"modal-body",children:[G&&o.jsx("div",{className:"error-message",children:G}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"design-name",children:"Design Name *"}),o.jsx("input",{id:"design-name",type:"text",value:i,onChange:I=>a(I.target.value),placeholder:"e.g., Playground Design A",autoFocus:!0,disabled:S||T})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"design-description",children:"Description"}),o.jsx("textarea",{id:"design-description",value:l,onChange:I=>c(I.target.value),placeholder:"Optional notes about this design...",rows:3,disabled:S||T})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"design-project",children:"Project"}),x?o.jsxs("div",{className:"new-project-form",children:[o.jsxs("div",{className:"input-row",children:[o.jsx("input",{type:"text",value:b,onChange:I=>w(I.target.value),placeholder:"Project name...",disabled:Z}),o.jsx("div",{className:"color-picker-inline",children:J.map(I=>o.jsx("button",{type:"button",className:`color-swatch ${j===I?"active":""}`,style:{backgroundColor:I},onClick:()=>_(I),disabled:Z},I))})]}),o.jsxs("div",{className:"button-row",children:[o.jsx("button",{type:"button",onClick:pe,className:"btn-primary btn-small",disabled:Z,children:Z?"Creating...":"Create"}),o.jsx("button",{type:"button",onClick:()=>y(!1),className:"btn-secondary btn-small",disabled:Z,children:"Cancel"})]})]}):o.jsxs("div",{className:"project-selector",children:[o.jsxs("select",{id:"design-project",value:d,onChange:I=>u(I.target.value),disabled:S||T,children:[o.jsx("option",{value:"",children:"No Project"}),g.map(I=>o.jsxs("option",{value:I.id,children:[I.name," (",I.design_count," designs)"]},I.id))]}),o.jsx("button",{type:"button",onClick:()=>y(!0),className:"btn-secondary btn-small",disabled:S||T,children:"+ New Project"})]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"design-tags",children:"Tags"}),o.jsx("input",{id:"design-tags",type:"text",value:p,onChange:I=>h(I.target.value),placeholder:"e.g., playground, vibrant, geometric (comma-separated)",disabled:S||T}),o.jsx("small",{className:"help-text",children:"Separate tags with commas"})]}),o.jsx("div",{className:"form-group checkbox-group",children:o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:f,onChange:I=>m(I.target.checked),disabled:S||T}),o.jsx("span",{children:"Make this design public (shareable link)"})]})})]}),o.jsxs("div",{className:"modal-footer",children:[o.jsx("button",{onClick:r,className:"btn-secondary",disabled:S||T,children:"Cancel"}),e&&o.jsx("button",{onClick:()=>V(!0),className:"btn-secondary",disabled:S||T,children:T?"Saving...":"Save as New"}),o.jsx("button",{onClick:()=>V(!1),className:"btn-primary",disabled:S||T,children:S?"Saving...":e?"Update":"Save Design"})]})]})})}const eW=10*1024*1024,tW=["image/jpeg","image/png","image/jpg"];function nW({onPhotoUploaded:t,disabled:e=!1}){const[n,r]=O.useState(!1),[s,i]=O.useState(!1),[a,l]=O.useState(null),[c,d]=O.useState(null),u=O.useRef(null),p=y=>{y.preventDefault(),e||r(!0)},h=y=>{y.preventDefault(),r(!1)},f=async y=>{if(y.preventDefault(),r(!1),e)return;const b=y.dataTransfer.files;b.length>0&&await v(b[0])},m=()=>{!e&&u.current&&u.current.click()},g=async y=>{y.target.files.length>0&&await v(y.target.files[0])},v=async y=>{if(l(null),!tW.includes(y.type)){l("Please upload a JPG or PNG image");return}if(y.size>eW){l("Image must be under 10MB");return}const b=URL.createObjectURL(y);d(b),console.log("[IN-SITU-UPLOADER] Loading local file to get dimensions...");const w=await new Promise((j,_)=>{const S=new Image;S.onload=()=>{console.log("[IN-SITU-UPLOADER] Local image loaded, dimensions:",S.naturalWidth,"x",S.naturalHeight),j({width:S.naturalWidth,height:S.naturalHeight})},S.onerror=E=>{console.error("[IN-SITU-UPLOADER] Failed to load local image:",E),_(new Error("Failed to read image dimensions"))},S.src=b});i(!0);try{const _=`in-situ-photos/${`${Date.now()}-${Math.random().toString(36).substr(2,9)}.${y.type.split("/")[1]}`}`,{data:S,error:E}=await an.storage.from("tpv-studio-uploads").upload(_,y,{cacheControl:"3600",upsert:!1});if(E)throw E;const{data:{publicUrl:T}}=an.storage.from("tpv-studio-uploads").getPublicUrl(_);console.log("[IN-SITU-UPLOADER] Photo uploaded:",T),console.log("[IN-SITU-UPLOADER] Using dimensions from local file:",w),console.log("[IN-SITU-UPLOADER] Passing local blob URL for fast preview"),console.log("[IN-SITU-UPLOADER] Calling onPhotoUploaded callback..."),t({url:b,supabaseUrl:T,width:w.width,height:w.height,filename:y.name})}catch(j){console.error("[IN-SITU-UPLOADER] Upload failed:",j),l(j.message||"Upload failed"),URL.revokeObjectURL(b),d(null)}finally{i(!1)}},x=()=>{c&&URL.revokeObjectURL(c),d(null),l(null)};return o.jsxs("div",{className:"in-situ-uploader",children:[c?o.jsxs("div",{className:"preview-container",children:[o.jsx("img",{src:c,alt:"Site preview",className:"preview-image"}),s&&o.jsxs("div",{className:"upload-overlay",children:[o.jsx("div",{className:"upload-spinner"}),o.jsx("p",{children:"Uploading..."})]}),!s&&o.jsx("button",{className:"clear-button",onClick:x,title:"Remove photo",children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}):o.jsxs("div",{className:`upload-zone ${n?"dragging":""} ${e?"disabled":""}`,onDragOver:p,onDragLeave:h,onDrop:f,onClick:m,children:[o.jsx("input",{ref:u,type:"file",accept:"image/jpeg,image/png",onChange:g,style:{display:"none"},disabled:e}),o.jsx("div",{className:"upload-icon",children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),o.jsx("polyline",{points:"17 8 12 3 7 8"}),o.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]})}),o.jsxs("div",{className:"upload-text",children:[o.jsx("p",{className:"primary",children:n?"Drop photo here":"Upload site photo"}),o.jsx("p",{className:"secondary",children:"Drag & drop or click to browse"}),o.jsx("p",{className:"hint",children:"JPG or PNG, max 10MB"})]})]}),a&&o.jsx("div",{className:"error-message",children:a}),o.jsx("style",{children:`
        .in-situ-uploader {
          width: 100%;
        }

        .upload-zone {
          border: 2px dashed #d1d5db;
          border-radius: 8px;
          padding: 2rem;
          text-align: center;
          cursor: pointer;
          transition: all 0.2s;
          background: #f9fafb;
        }

        .upload-zone:hover {
          border-color: #ff6b35;
          background: #fff7f5;
        }

        .upload-zone.dragging {
          border-color: #ff6b35;
          background: #fff7f5;
          border-style: solid;
        }

        .upload-zone.disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .upload-zone.disabled:hover {
          border-color: #d1d5db;
          background: #f9fafb;
        }

        .upload-icon {
          width: 48px;
          height: 48px;
          margin: 0 auto 1rem;
          color: #9ca3af;
        }

        .upload-zone:hover .upload-icon {
          color: #ff6b35;
        }

        .upload-text .primary {
          font-size: 1rem;
          font-weight: 600;
          color: #374151;
          margin: 0 0 0.25rem;
        }

        .upload-text .secondary {
          font-size: 0.875rem;
          color: #6b7280;
          margin: 0 0 0.5rem;
        }

        .upload-text .hint {
          font-size: 0.75rem;
          color: #9ca3af;
          margin: 0;
        }

        .preview-container {
          position: relative;
          border-radius: 8px;
          overflow: hidden;
        }

        .preview-image {
          width: 100%;
          display: block;
          border-radius: 8px;
        }

        .upload-overlay {
          position: absolute;
          inset: 0;
          background: rgba(0, 0, 0, 0.6);
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          color: white;
        }

        .upload-spinner {
          width: 32px;
          height: 32px;
          border: 3px solid rgba(255, 255, 255, 0.3);
          border-top-color: white;
          border-radius: 50%;
          animation: spin 0.8s linear infinite;
          margin-bottom: 0.5rem;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        .clear-button {
          position: absolute;
          top: 0.5rem;
          right: 0.5rem;
          width: 32px;
          height: 32px;
          border-radius: 50%;
          background: rgba(0, 0, 0, 0.6);
          border: none;
          cursor: pointer;
          color: white;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: background 0.2s;
        }

        .clear-button:hover {
          background: rgba(0, 0, 0, 0.8);
        }

        .clear-button svg {
          width: 16px;
          height: 16px;
        }

        .error-message {
          margin-top: 0.75rem;
          padding: 0.5rem 0.75rem;
          background: #fef2f2;
          border: 1px solid #fecaca;
          border-radius: 4px;
          color: #dc2626;
          font-size: 0.875rem;
        }
      `})]})}function rW(t,e){const[n,r,s,i,a,l,c,d]=t,[u,p,h,f,m,g,v,x]=e,y=[[n,r,1,0,0,0,-u*n,-u*r],[0,0,0,n,r,1,-p*n,-p*r],[s,i,1,0,0,0,-h*s,-h*i],[0,0,0,s,i,1,-f*s,-f*i],[a,l,1,0,0,0,-m*a,-m*l],[0,0,0,a,l,1,-g*a,-g*l],[c,d,1,0,0,0,-v*c,-v*d],[0,0,0,c,d,1,-x*c,-x*d]],w=sW(y,[u,p,h,f,m,g,v,x]);return function(_,S){const E=w[6]*_+w[7]*S+1,T=(w[0]*_+w[1]*S+w[2])/E,M=(w[3]*_+w[4]*S+w[5])/E;return[T,M]}}function sW(t,e){const n=t.length,r=t.map((i,a)=>[...i,e[a]]);for(let i=0;i<n;i++){let a=i;for(let l=i+1;l<n;l++)Math.abs(r[l][i])>Math.abs(r[a][i])&&(a=l);[r[i],r[a]]=[r[a],r[i]];for(let l=i+1;l<n;l++){const c=r[l][i]/r[i][i];for(let d=i;d<=n;d++)r[l][d]-=c*r[i][d]}}const s=new Array(n);for(let i=n-1;i>=0;i--){s[i]=r[i][n];for(let a=i+1;a<n;a++)s[i]-=r[i][a]*s[a];s[i]/=r[i][i]}return s}function Lm(t){return new Promise((e,n)=>{const r=new Image;!t.startsWith("blob:")&&!t.startsWith("data:")?(r.crossOrigin="anonymous",console.log("[LOAD-IMAGE] Loading external URL with CORS:",t.substring(0,50))):console.log("[LOAD-IMAGE] Loading local URL (blob/data):",t.substring(0,50)),r.onload=()=>{console.log("[LOAD-IMAGE] Successfully loaded image:",t.substring(0,50)),e(r)},r.onerror=()=>{console.error("[LOAD-IMAGE] Failed to load image:",t),n(new Error(`Failed to load image: ${t}`))},r.src=t})}async function n2(t,e=1536){console.log("[RASTERIZE-SVG] Starting SVG rasterization:",t.substring(0,50),"maxSize:",e);const n=await Lm(t),{naturalWidth:r,naturalHeight:s}=n;console.log("[RASTERIZE-SVG] SVG loaded with dimensions:",r,"x",s);const i=Math.min(1,e/Math.max(r,s)),a=Math.round(r*i),l=Math.round(s*i);console.log("[RASTERIZE-SVG] Scaling to:",a,"x",l,"(scale:",i.toFixed(2),")");const c=document.createElement("canvas");return c.width=a,c.height=l,c.getContext("2d").drawImage(n,0,0,a,l),console.log("[RASTERIZE-SVG] Drew SVG to canvas"),new Promise((u,p)=>{const h=new Image;h.onload=()=>{console.log("[RASTERIZE-SVG] Successfully rasterized SVG to PNG"),u(h)},h.onerror=f=>{console.error("[RASTERIZE-SVG] Failed to convert canvas to image:",f),p(f)},h.src=c.toDataURL("image/png")})}function r2({photoCtx:t,photoImg:e,designImg:n,quad:r,opacity:s,shape:i,lighting:a}){const l=t.canvas;t.clearRect(0,0,l.width,l.height),t.drawImage(e,0,0,l.width,l.height);const c=n.width,d=n.height,u=[0,0,c,0,c,d,0,d],p=[r[0].x,r[0].y,r[1].x,r[1].y,r[2].x,r[2].y,r[3].x,r[3].y],h=rW(u,p),f=10,m=c/f,g=d/f,v=document.createElement("canvas");if(v.width=c,v.height=d,v.getContext("2d").drawImage(n,0,0),t.save(),t.globalAlpha=s,a&&a.enabled){const b=a.strength||.6,w=1+(a.baseBrightness-1)*b,j=1+(a.baseContrast-1)*b;t.filter=`brightness(${w}) contrast(${j})`}const y=i&&i.length>=3?i:r;t.beginPath(),t.moveTo(y[0].x,y[0].y);for(let b=1;b<y.length;b++)t.lineTo(y[b].x,y[b].y);t.closePath(),t.clip();for(let b=0;b<f;b++)for(let w=0;w<f;w++){const j=b*m,_=w*g,S=(b+1)*m,E=(w+1)*g,T=h(j,_),M=h(S,_),Z=h(S,E),N=h(j,E);Vx(t,v,j,_,S,_,j,E,T[0],T[1],M[0],M[1],N[0],N[1]),Vx(t,v,S,_,S,E,j,E,M[0],M[1],Z[0],Z[1],N[0],N[1])}t.restore()}function Vx(t,e,n,r,s,i,a,l,c,d,u,p,h,f){t.save(),t.beginPath(),t.moveTo(c,d),t.lineTo(u,p),t.lineTo(h,f),t.closePath(),t.clip();const m=(n-a)*(i-l)-(s-a)*(r-l);if(Math.abs(m)<.001){t.restore();return}const g=((c-h)*(i-l)-(u-h)*(r-l))/m,v=((d-f)*(i-l)-(p-f)*(r-l))/m,x=((n-a)*(u-h)-(s-a)*(c-h))/m,y=((n-a)*(p-f)-(s-a)*(d-f))/m,b=c-g*n-x*r,w=d-v*n-y*r;t.setTransform(g,v,x,y,b,w),t.drawImage(e,0,0),t.restore()}function iW(t,e="tpv-in-situ-preview.png"){t.toBlob(n=>{const r=URL.createObjectURL(n),s=document.createElement("a");s.href=r,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)},"image/png")}function oW(t,e,n,r){const s=n/r,i=t*.6,a=e*.6;let l,c;s>i/a?(l=i,c=i/s):(c=a,l=a*s);const d=(t-l)/2,u=(e-c)/2;return[{x:d,y:u},{x:d+l,y:u},{x:d+l,y:u+c},{x:d,y:u+c}]}function aW(t,e,n){let r=!1;for(let s=0,i=n.length-1;s<n.length;i=s++){const a=n[s].x,l=n[s].y,c=n[i].x,d=n[i].y;l>e!=d>e&&t<(c-a)*(e-l)/(d-l)+a&&(r=!r)}return r}function lW(t,e,n){t/=255,e/=255,n/=255;const r=Math.max(t,e,n),s=Math.min(t,e,n),i=(r+s)/2;if(r===s)return{h:0,s:0,l:i};const a=r-s,l=i>.5?a/(2-r-s):a/(r+s);let c;switch(r){case t:c=((e-n)/a+(e<n?6:0))/6;break;case e:c=((n-t)/a+2)/6;break;case n:c=((t-e)/a+4)/6;break}return{h:c,s:l,l:i}}function cW(t,e,n=2e3){if(!t||!e||e.length<3)return{avgLightness:.5,avgContrastProxy:.5};const r=Math.floor(Math.min(...e.map(y=>y.x))),s=Math.ceil(Math.max(...e.map(y=>y.x))),i=Math.floor(Math.min(...e.map(y=>y.y))),a=Math.ceil(Math.max(...e.map(y=>y.y))),l=s-r,c=a-i;if(l<=0||c<=0)return{avgLightness:.5,avgContrastProxy:.5};let d;try{d=t.getImageData(r,i,l,c)}catch(y){return console.warn("[LIGHTING] Failed to get image data:",y),{avgLightness:.5,avgContrastProxy:.5}}const u=d.data,p=[];let h=0;const f=n*5;for(;p.length<n&&h<f;){h++;const y=r+Math.random()*l,b=i+Math.random()*c;if(!aW(y,b,e))continue;const w=Math.floor(y-r),_=(Math.floor(b-i)*l+w)*4;if(_<0||_>=u.length-3)continue;const S=u[_],E=u[_+1],T=u[_+2],{l:M}=lW(S,E,T);p.push(M)}if(p.length===0)return{avgLightness:.5,avgContrastProxy:.5};const m=p.reduce((y,b)=>y+b,0)/p.length,g=p.reduce((y,b)=>y+Math.pow(b-m,2),0)/p.length,v=Math.sqrt(g),x=Math.min(1,v/.25);return{avgLightness:m,avgContrastProxy:x}}function dW(t){let e=1,n=1;const s=t.avgLightness-.5;return e+=s*.6,n+=(t.avgContrastProxy-.5)*.4,e=Math.max(.7,Math.min(1.3,e)),n=Math.max(.8,Math.min(1.25,n)),{brightness:e,contrast:n}}const uW=100;function hW({photoUrl:t,svgUrl:e,designSizeMm:n,initialQuad:r,initialShape:s,initialOpacity:i=.8,initialLighting:a,onChange:l}){const[c,d]=O.useState(null),[u,p]=O.useState(null),[h,f]=O.useState(r||null),[m,g]=O.useState(s||null),[v,x]=O.useState(Math.max(.3,Math.min(1,i))),[y,b]=O.useState(a||{enabled:!1,strength:.6,baseBrightness:1,baseContrast:1}),[w,j]=O.useState(!0),[_,S]=O.useState(null),[E,T]=O.useState(1),[M,Z]=O.useState("corners"),[N,G]=O.useState(null),[C,F]=O.useState(!1),[pe,V]=O.useState(null),[J,I]=O.useState(null),K=O.useRef(null),z=O.useRef(null),W=O.useRef(null),[fe,ue]=O.useState([]),ne=20;O.useEffect(()=>{ke()},[t,e]),O.useEffect(()=>{c&&u&&h&&ce()},[c,u,h,m,v,y,M,N,C,J]),O.useEffect(()=>{if(!c||!h||h.length!==4)return;const U=document.createElement("canvas");U.width=c.naturalWidth,U.height=c.naturalHeight;const ae=U.getContext("2d");ae.drawImage(c,0,0);const xe=cW(ae,h),{brightness:Te,contrast:He}=dW(xe);b(Ee=>({...Ee,baseBrightness:Te,baseContrast:He}))},[c,JSON.stringify(h)]),O.useEffect(()=>{const U=ae=>{if(M==="shape"&&(ae.key==="Delete"||ae.key==="Backspace")&&J!==null&&m&&m.length>3){ae.preventDefault();const xe=m.filter((Te,He)=>He!==J);g(xe),I(null),ze(h,v,xe)}};return window.addEventListener("keydown",U),()=>window.removeEventListener("keydown",U)},[M,J,m,h,v]);const ke=async()=>{var U;console.log("[FOUR-POINT] Starting to load images - photo:",t==null?void 0:t.substring(0,50),"svg:",e==null?void 0:e.substring(0,50)),j(!0),S(null);try{console.log("[FOUR-POINT] Loading photo and rasterizing SVG...");const[ae,xe]=await Promise.all([Lm(t),n2(e,1536)]);console.log("[FOUR-POINT] Both images loaded successfully - photo:",ae.naturalWidth,"x",ae.naturalHeight,"design:",xe.naturalWidth,"x",xe.naturalHeight),d(ae),p(xe);const Te=((U=z.current)==null?void 0:U.clientWidth)||800,He=500,Ee=Te/ae.naturalWidth,ie=He/ae.naturalHeight,he=Math.min(1,Ee,ie);if(T(he),console.log("[FOUR-POINT] Display scale set to:",he.toFixed(3)),r)console.log("[FOUR-POINT] Using provided initial quad");else{const Xe=oW(ae.naturalWidth,ae.naturalHeight,n.width_mm,n.length_mm);f(Xe),console.log("[FOUR-POINT] Initialized default quad")}}catch(ae){console.error("[FOUR-POINT] Failed to load images:",ae),S(ae.message)}finally{j(!1),console.log("[FOUR-POINT] Loading complete")}},ce=()=>{const U=K.current;if(!U||!c||!u||!h)return;U.width=c.naturalWidth,U.height=c.naturalHeight;const ae=U.getContext("2d");r2({photoCtx:ae,photoImg:c,designImg:u,quad:h,opacity:v,shape:m,lighting:y}),$e(ae)},$e=U=>{if(!h)return;U.setTransform(1,0,0,1,0,0);const ae=Math.max(8,Math.min(15,c.naturalWidth/80));if(M==="corners"){U.strokeStyle="rgba(255, 255, 255, 0.8)",U.lineWidth=2,U.setLineDash([5,5]),U.beginPath(),U.moveTo(h[0].x,h[0].y),U.lineTo(h[1].x,h[1].y),U.lineTo(h[2].x,h[2].y),U.lineTo(h[3].x,h[3].y),U.closePath(),U.stroke(),U.setLineDash([]);const xe=["TL","TR","BR","BL"];h.forEach((Te,He)=>{U.beginPath(),U.arc(Te.x,Te.y,ae,0,Math.PI*2),U.fillStyle=N===He?"#ff6b35":"rgba(255, 107, 53, 0.9)",U.fill(),U.strokeStyle="white",U.lineWidth=2,U.stroke(),U.fillStyle="white",U.font="10px sans-serif",U.textAlign="center",U.textBaseline="middle",U.fillText(xe[He],Te.x,Te.y)})}else{const xe=m||h;U.strokeStyle="rgba(34, 197, 94, 0.8)",U.lineWidth=2,U.setLineDash([]),U.beginPath(),U.moveTo(xe[0].x,xe[0].y);for(let Te=1;Te<xe.length;Te++)U.lineTo(xe[Te].x,xe[Te].y);U.closePath(),U.stroke(),xe.forEach((Te,He)=>{U.beginPath(),U.arc(Te.x,Te.y,ae*.8,0,Math.PI*2),J===He?U.fillStyle="#22c55e":N===He?U.fillStyle="#16a34a":U.fillStyle="rgba(34, 197, 94, 0.9)",U.fill(),U.strokeStyle="white",U.lineWidth=2,U.stroke()}),U.strokeStyle="rgba(255, 107, 53, 0.3)",U.lineWidth=1,U.setLineDash([3,3]),U.beginPath(),U.moveTo(h[0].x,h[0].y),U.lineTo(h[1].x,h[1].y),U.lineTo(h[2].x,h[2].y),U.lineTo(h[3].x,h[3].y),U.closePath(),U.stroke(),U.setLineDash([])}},ze=O.useCallback((U,ae,xe,Te)=>{W.current&&clearTimeout(W.current),W.current=setTimeout(()=>{l&&l({quad:U,opacity:ae,shape:xe,lighting:Te||y})},uW)},[l,y]),Ue=O.useCallback(()=>{ue(U=>{const ae=[...U,{quad:[...h],shape:m?[...m]:null,opacity:v,lighting:{...y}}];return ae.length>ne?ae.slice(-ne):ae})},[h,m,v,y]),Ge=()=>{if(fe.length===0)return;const U=fe[fe.length-1];ue(ae=>ae.slice(0,-1)),f(U.quad),g(U.shape),x(U.opacity),b(U.lighting),ze(U.quad,U.opacity,U.shape,U.lighting)},at=(U,ae)=>({x:U/E,y:ae/E}),Ve=(U,ae,xe)=>{if(!xe)return-1;const Te=25/E;for(let He=0;He<xe.length;He++){const Ee=xe[He].x-U,ie=xe[He].y-ae;if(Math.sqrt(Ee*Ee+ie*ie)<Te)return He}return-1},k=(U,ae,xe)=>{if(!xe||xe.length<3)return!1;let Te=!1;for(let He=0,Ee=xe.length-1;He<xe.length;Ee=He++){const ie=xe[He].x,he=xe[He].y,Xe=xe[Ee].x,tt=xe[Ee].y;he>ae!=tt>ae&&U<(Xe-ie)*(ae-he)/(tt-he)+ie&&(Te=!Te)}return Te},Q=U=>{if(M!=="shape"||!m||m.length<=3)return;const ae=K.current;if(!ae)return;const xe=ae.getBoundingClientRect(),Te=U.clientX-xe.left,He=U.clientY-xe.top,{x:Ee,y:ie}=at(Te,He),he=Ve(Ee,ie,m);if(he>=0){Ue();const Xe=m.filter((nt,yt)=>yt!==he);g(Xe),I(null);const tt=$(h,Xe);tt!==h?(f(tt),ze(tt,v,Xe)):ze(h,v,Xe)}},oe=U=>{const ae=K.current;if(!ae)return;const xe=ae.getBoundingClientRect(),Te=U.clientX-xe.left,He=U.clientY-xe.top,{x:Ee,y:ie}=at(Te,He);if(M==="corners"){const he=Ve(Ee,ie,h);he>=0?(Ue(),G(he),ae.setPointerCapture(U.pointerId)):k(Ee,ie,h)&&(Ue(),F(!0),V({x:Ee,y:ie}),ae.setPointerCapture(U.pointerId))}else{const he=m||h,Xe=Ve(Ee,ie,he);if(Xe>=0)Ue(),G(Xe),I(Xe),ae.setPointerCapture(U.pointerId);else{Ue();let tt=0,nt=1/0;for(let de=0;de<he.length;de++){const te=(de+1)%he.length,me=se(Ee,ie,he[de].x,he[de].y,he[te].x,he[te].y);me<nt&&(nt=me,tt=te)}const yt={x:Ee,y:ie},ht=[...he];ht.splice(tt,0,yt),g(ht),I(tt);const Fe=$(h,ht);Fe!==h?(f(Fe),ze(Fe,v,ht)):ze(h,v,ht)}}},D=U=>{if(N===null&&!C)return;const ae=K.current;if(!ae)return;const xe=ae.getBoundingClientRect(),Te=U.clientX-xe.left,He=U.clientY-xe.top,{x:Ee,y:ie}=at(Te,He),he=Math.max(0,Math.min(c.naturalWidth,Ee)),Xe=Math.max(0,Math.min(c.naturalHeight,ie));if(M==="corners"){if(C&&pe){const tt=he-pe.x,nt=Xe-pe.y,yt=h.map(Fe=>({x:Math.max(0,Math.min(c.naturalWidth,Fe.x+tt)),y:Math.max(0,Math.min(c.naturalHeight,Fe.y+nt))}));let ht=m;m&&(ht=m.map(Fe=>({x:Math.max(0,Math.min(c.naturalWidth,Fe.x+tt)),y:Math.max(0,Math.min(c.naturalHeight,Fe.y+nt))})),g(ht)),f(yt),V({x:he,y:Xe}),ze(yt,v,ht)}else if(N!==null){const tt=[...h];tt[N]={x:he,y:Xe},f(tt),ze(tt,v,m)}}else{const nt=[...m||h];nt[N]={x:he,y:Xe},g(nt),ze(h,v,nt)}},P=U=>{if(N!==null||C){const ae=K.current;if(ae&&ae.releasePointerCapture(U.pointerId),M==="shape"&&m&&N!==null){const xe=$(h,m);xe!==h&&(f(xe),ze(xe,v,m))}G(null),F(!1),V(null)}},$=(U,ae)=>{if(!ae||ae.length<3||!U)return U;const xe=U.reduce((Fe,de)=>Fe+de.x,0)/4,Te=U.reduce((Fe,de)=>Fe+de.y,0)/4,He=ae.reduce((Fe,de)=>Fe+de.x,0)/ae.length,Ee=ae.reduce((Fe,de)=>Fe+de.y,0)/ae.length;let ie=1;for(const Fe of ae){const de=Fe.x-xe,te=Fe.y-Te,me=Math.sqrt(de*de+te*te);if(me<1)continue;const Ye=Y(xe,Te,de,te,U);if(Ye>0&&me>Ye){const xt=me/Ye;ie=Math.max(ie,xt)}}let he=1/0;for(const Fe of ae){const de=Fe.x-xe,te=Fe.y-Te,me=Math.sqrt(de*de+te*te);if(me<1)continue;const Ye=Y(xe,Te,de,te,U);if(Ye>0){const xt=me/Ye;he=Math.min(he,xt)}}let Xe=ie;if(ie<=1&&he<1/0&&(Xe=he),Math.abs(Xe-1)<.01)return U;const tt=U.map(Fe=>({x:xe+(Fe.x-xe)*Xe,y:Te+(Fe.y-Te)*Xe})),nt=He-xe,yt=Ee-Te;return tt.map(Fe=>({x:Fe.x+nt,y:Fe.y+yt}))},Y=(U,ae,xe,Te,He)=>{let Ee=1/0;for(let ie=0;ie<4;ie++){const he=He[ie],Xe=He[(ie+1)%4],tt=Xe.x-he.x,nt=Xe.y-he.y,yt=xe*nt-Te*tt;if(Math.abs(yt)<1e-4)continue;const ht=((he.x-U)*nt-(he.y-ae)*tt)/yt,Fe=((he.x-U)*Te-(he.y-ae)*xe)/yt;ht>0&&Fe>=0&&Fe<=1&&(Ee=Math.min(Ee,ht*Math.sqrt(xe*xe+Te*Te)))}return Ee===1/0?0:Ee},se=(U,ae,xe,Te,He,Ee)=>{const ie=U-xe,he=ae-Te,Xe=He-xe,tt=Ee-Te,nt=ie*Xe+he*tt,yt=Xe*Xe+tt*tt;let ht=yt!==0?nt/yt:-1,Fe,de;return ht<0?(Fe=xe,de=Te):ht>1?(Fe=He,de=Ee):(Fe=xe+ht*Xe,de=Te+ht*tt),Math.sqrt((U-Fe)**2+(ae-de)**2)},B=()=>{M==="corners"?(m||g([...h]),Z("shape"),I(null)):(Z("corners"),I(null))},re=U=>{const ae=Math.max(.3,Math.min(1,parseFloat(U.target.value)/100));x(ae),ze(h,ae,m)},ye=U=>{const ae={...y,enabled:U.target.checked};b(ae),ze(h,v,m,ae)},le=U=>{const ae={...y,strength:parseFloat(U.target.value)/100};b(ae),ze(h,v,m,ae)};return w?o.jsxs("div",{className:"four-point-editor loading",children:[o.jsx("div",{className:"spinner"}),o.jsx("p",{children:"Loading preview..."})]}):_?o.jsx("div",{className:"four-point-editor error",children:o.jsxs("p",{children:["Failed to load: ",_]})}):o.jsxs("div",{className:"four-point-editor",ref:z,children:[o.jsxs("div",{className:"editor-header",children:[o.jsxs("div",{className:"header-title",children:[o.jsx("h3",{children:"Position Your Design"}),o.jsx(Wf,{content:o.jsxs("div",{children:[o.jsxs("p",{children:[o.jsx("strong",{children:"Corners Mode:"})," Drag the 4 corner handles (TL, TR, BR, BL) to position your design with perspective. You can also drag inside the design to move all corners at once."]}),o.jsxs("p",{style:{marginTop:"0.5rem"},children:[o.jsx("strong",{children:"Refine Shape Mode:"})," Click anywhere to add new vertices for precise shape control. Drag existing vertices to adjust. Double-click or press Delete/Backspace on a vertex to remove it."]}),o.jsxs("p",{style:{marginTop:"0.5rem"},children:[o.jsx("strong",{children:"Overlay Opacity:"})," Adjust transparency to see how the design blends with your photo."]}),o.jsxs("p",{style:{marginTop:"0.5rem"},children:[o.jsx("strong",{children:"Match Floor Lighting:"})," Automatically adjusts design brightness to match your floor's lighting conditions."]})]}),position:"right"})]}),o.jsx("p",{className:"instructions",children:M==="corners"?"Drag the corner handles (TL, TR, BR, BL) to position the design. Drag inside to move all corners.":"Click to add vertices, drag to move them, double-click or press Delete to remove."})]}),o.jsx("div",{className:"canvas-container",children:o.jsx("canvas",{ref:K,onPointerDown:oe,onPointerMove:D,onPointerUp:P,onPointerLeave:P,onDoubleClick:Q,style:{width:`${((c==null?void 0:c.naturalWidth)||800)*E}px`,height:`${((c==null?void 0:c.naturalHeight)||600)*E}px`,cursor:N!==null||C?"grabbing":M==="shape"?"crosshair":"move",touchAction:"none"}})}),o.jsxs("div",{className:"controls",children:[o.jsxs("div",{className:"mode-toggle",children:[o.jsx("button",{className:`toggle-btn ${M==="corners"?"active":""}`,onClick:()=>Z("corners"),children:"Corners"}),o.jsx("button",{className:`toggle-btn ${M==="shape"?"active":""}`,onClick:B,children:"Refine Shape"}),o.jsx("button",{className:"toggle-btn undo-btn",onClick:Ge,disabled:fe.length===0,title:"Undo last change",children:"Undo"})]}),o.jsxs("div",{className:"opacity-control",children:[o.jsxs("label",{children:["Overlay Opacity",o.jsxs("span",{className:"value",children:[Math.round(v*100),"%"]})]}),o.jsx("input",{type:"range",min:"30",max:"100",value:Math.round(v*100),onChange:re})]}),o.jsxs("div",{className:"lighting-control",children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:y.enabled,onChange:ye}),"Match floor lighting"]}),y.enabled&&o.jsxs("div",{className:"lighting-slider",children:[o.jsxs("label",{children:["Strength",o.jsxs("span",{className:"value",children:[Math.round(y.strength*100),"%"]})]}),o.jsx("input",{type:"range",min:"0",max:"100",value:Math.round(y.strength*100),onChange:le})]})]})]}),o.jsx("style",{children:`
        .four-point-editor {
          display: flex;
          flex-direction: column;
          height: 100%;
        }

        .four-point-editor.loading,
        .four-point-editor.error {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          min-height: 400px;
          color: #6b7280;
        }

        .four-point-editor .spinner {
          width: 40px;
          height: 40px;
          border: 3px solid #e5e7eb;
          border-top-color: #ff6b35;
          border-radius: 50%;
          animation: spin 0.8s linear infinite;
          margin-bottom: 1rem;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        .editor-header {
          padding-bottom: 1rem;
          border-bottom: 1px solid #e5e7eb;
          margin-bottom: 1rem;
        }

        .editor-header .header-title {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          margin-bottom: 0.5rem;
        }

        .editor-header h3 {
          margin: 0;
          font-size: 1.125rem;
          color: #1e4a7a;
        }

        .editor-header .instructions {
          margin: 0;
          font-size: 0.875rem;
          color: #6b7280;
        }

        .canvas-container {
          flex: 1;
          display: flex;
          align-items: center;
          justify-content: center;
          background: #f3f4f6;
          border-radius: 8px;
          overflow: hidden;
          min-height: 400px;
        }

        .canvas-container canvas {
          display: block;
        }

        .controls {
          padding-top: 1rem;
          border-top: 1px solid #e5e7eb;
          margin-top: 1rem;
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .mode-toggle {
          display: flex;
          gap: 0.5rem;
        }

        .toggle-btn {
          padding: 0.5rem 1rem;
          border: 1px solid #d1d5db;
          background: white;
          border-radius: 4px;
          font-size: 0.875rem;
          cursor: pointer;
          transition: all 0.2s;
        }

        .toggle-btn:hover {
          background: #f9fafb;
        }

        .toggle-btn.active {
          background: #ff6b35;
          color: white;
          border-color: #ff6b35;
        }

        .toggle-btn:disabled {
          opacity: 0.4;
          cursor: not-allowed;
        }

        .toggle-btn:disabled:hover {
          background: white;
        }

        .opacity-control {
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .opacity-control label {
          display: flex;
          justify-content: space-between;
          font-size: 0.875rem;
          font-weight: 500;
          color: #374151;
        }

        .opacity-control .value {
          font-weight: 400;
          color: #6b7280;
        }

        .opacity-control input[type="range"] {
          width: 100%;
          height: 6px;
          border-radius: 3px;
          background: #e5e7eb;
          outline: none;
          -webkit-appearance: none;
        }

        .opacity-control input[type="range"]::-webkit-slider-thumb {
          -webkit-appearance: none;
          width: 16px;
          height: 16px;
          border-radius: 50%;
          background: #ff6b35;
          cursor: pointer;
        }

        .lighting-control {
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .checkbox-label {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          font-size: 0.875rem;
          font-weight: 500;
          color: #374151;
          cursor: pointer;
        }

        .checkbox-label input[type="checkbox"] {
          width: 16px;
          height: 16px;
          cursor: pointer;
        }

        .lighting-slider {
          display: flex;
          flex-direction: column;
          gap: 0.25rem;
          padding-left: 1.5rem;
        }

        .lighting-slider label {
          display: flex;
          justify-content: space-between;
          font-size: 0.8rem;
          color: #6b7280;
        }

        .lighting-slider .value {
          font-weight: 400;
        }

        .lighting-slider input[type="range"] {
          width: 100%;
          height: 6px;
          border-radius: 3px;
          background: #e5e7eb;
          outline: none;
          -webkit-appearance: none;
        }

        .lighting-slider input[type="range"]::-webkit-slider-thumb {
          -webkit-appearance: none;
          width: 14px;
          height: 14px;
          border-radius: 50%;
          background: #22c55e;
          cursor: pointer;
        }
      `})]})}const ss={UPLOAD:"upload",POSITION:"position"};function s2({designUrl:t,designDimensions:e,onClose:n,onSaved:r}){const[s,i]=O.useState(ss.UPLOAD),[a,l]=O.useState(null),[c,d]=O.useState(null),[u,p]=O.useState(null),[h,f]=O.useState(.8),[m,g]=O.useState({enabled:!1,strength:.6,baseBrightness:1,baseContrast:1}),[v,x]=O.useState(!1),y=O.useRef(null);O.useEffect(()=>{if(t){console.log("[IN-SITU-MODAL] Design URL received:",t==null?void 0:t.substring(0,50));const T=new Image;!t.startsWith("blob:")&&!t.startsWith("data:")&&(T.crossOrigin="anonymous"),T.src=t}else console.warn("[IN-SITU-MODAL] No design URL provided")},[t]);const b=T=>{console.log("[IN-SITU-MODAL] Photo uploaded:",T),l(T),console.log("[IN-SITU-MODAL] Advancing to POSITION step, designUrl:",t==null?void 0:t.substring(0,50)),i(ss.POSITION)},w=({quad:T,opacity:M,shape:Z,lighting:N})=>{d(T),f(M),p(Z),N&&g(N)},j=async()=>{if(!a||!c)return null;try{console.log("[InSitu] Loading design from URL:",t);const[T,M]=await Promise.all([Lm(a.url),n2(t,1536)]);console.log("[InSitu] Successfully loaded design image");const Z=document.createElement("canvas");Z.width=T.naturalWidth,Z.height=T.naturalHeight;const N=Z.getContext("2d");return r2({photoCtx:N,photoImg:T,designImg:M,quad:c,opacity:h,shape:u,lighting:m}),Z}catch(T){return console.error("[InSitu] Failed to generate canvas:",T),alert(`Failed to load design: ${T.message}`),null}},_=async()=>{const T=await j();T&&iW(T,"tpv-in-situ-preview.png")},S=async()=>{if(!(!c||!a)){x(!0);try{const T=await j();if(!T)throw new Error("Failed to generate preview");const M=await new Promise(F=>T.toBlob(F,"image/png")),N=`in-situ-previews/${`${Date.now()}-${Math.random().toString(36).substr(2,9)}.png`}`,{error:G}=await an.storage.from("tpv-studio-uploads").upload(N,M,{contentType:"image/png",cacheControl:"3600"});if(G)throw G;const{data:{publicUrl:C}}=an.storage.from("tpv-studio-uploads").getPublicUrl(N);r&&r({photo_url:a.supabaseUrl||a.url,quad:c,shape:u,opacity:h,lighting:m,preview_url:C}),n()}catch(T){console.error("[IN-SITU] Save failed:",T),alert("Failed to save preview: "+T.message)}finally{x(!1)}}},E=()=>{switch(s){case ss.UPLOAD:return"Upload Site Photo";case ss.POSITION:return"Position Your Design";default:return"In-Situ Preview"}};return o.jsxs("div",{className:"modal-overlay in-situ-modal-overlay",onClick:n,children:[o.jsxs("div",{className:"modal-content in-situ-modal",onClick:T=>T.stopPropagation(),children:[o.jsxs("div",{className:"modal-header",children:[o.jsxs("div",{className:"header-left",children:[o.jsx("h2",{children:E()}),o.jsxs("div",{className:"step-indicator",children:[o.jsx("span",{className:s===ss.UPLOAD?"active":"completed",children:"1. Upload"}),o.jsx("span",{className:s===ss.POSITION?"active":"",children:"2. Position"})]})]}),o.jsx("button",{onClick:n,className:"close-button",children:""})]}),o.jsxs("div",{className:"modal-body",children:[s===ss.UPLOAD&&o.jsxs("div",{className:"upload-step",children:[o.jsx("p",{className:"step-description",children:"Upload a photo of your site to see how your TPV design will look when installed. For best results, use a photo taken from above or at a slight angle showing the floor area clearly."}),o.jsx(nW,{onPhotoUploaded:b})]}),s===ss.POSITION&&a&&o.jsx(hW,{ref:y,photoUrl:a.url,svgUrl:t,designSizeMm:{width_mm:e.width,length_mm:e.length},initialOpacity:.8,onChange:w})]}),s===ss.POSITION&&o.jsxs("div",{className:"modal-footer",children:[o.jsx("button",{onClick:()=>i(ss.UPLOAD),className:"btn-secondary",children:"Back"}),o.jsxs("div",{className:"footer-actions",children:[o.jsx("button",{onClick:_,disabled:!c,className:"btn-secondary",children:"Download PNG"}),o.jsx("button",{onClick:S,disabled:!c||v,className:"btn-primary",children:v?"Saving...":"Save to Project"})]})]})]}),o.jsx("style",{children:`
        .in-situ-modal-overlay {
          position: fixed;
          inset: 0;
          background: rgba(0, 0, 0, 0.6);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 1000;
          padding: 1rem;
        }

        .in-situ-modal {
          background: white;
          border-radius: 12px;
          width: 100%;
          max-width: 1000px;
          max-height: 90vh;
          display: flex;
          flex-direction: column;
          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .in-situ-modal .modal-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          padding: 1.25rem 1.5rem;
          border-bottom: 1px solid #e5e7eb;
        }

        .header-left {
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .in-situ-modal .modal-header h2 {
          margin: 0;
          font-size: 1.25rem;
          color: #1e4a7a;
        }

        .step-indicator {
          display: flex;
          gap: 1rem;
          font-size: 0.75rem;
        }

        .step-indicator span {
          color: #9ca3af;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
        }

        .step-indicator span.active {
          background: #fff7f5;
          color: #ff6b35;
          font-weight: 500;
        }

        .step-indicator span.completed {
          color: #22c55e;
        }

        .close-button {
          background: none;
          border: none;
          font-size: 1.5rem;
          cursor: pointer;
          color: #9ca3af;
          padding: 0;
          line-height: 1;
        }

        .close-button:hover {
          color: #374151;
        }

        .modal-body {
          flex: 1;
          padding: 1.5rem;
          overflow-y: auto;
          min-height: 500px;
        }

        .upload-step {
          display: flex;
          flex-direction: column;
          gap: 1.5rem;
        }

        .step-description {
          margin: 0;
          font-size: 0.875rem;
          color: #6b7280;
          line-height: 1.6;
        }

        .modal-footer {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 1rem 1.5rem;
          border-top: 1px solid #e5e7eb;
          background: #f9fafb;
          border-radius: 0 0 12px 12px;
        }

        .footer-actions {
          display: flex;
          gap: 0.5rem;
        }

        .btn-primary,
        .btn-secondary {
          padding: 0.5rem 1rem;
          border-radius: 4px;
          font-size: 0.875rem;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.2s;
          border: none;
        }

        .btn-primary {
          background: #ff6b35;
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          background: #e55a2b;
        }

        .btn-primary:disabled {
          background: #d1d5db;
          cursor: not-allowed;
        }

        .btn-secondary {
          background: white;
          color: #374151;
          border: 1px solid #d1d5db;
        }

        .btn-secondary:hover:not(:disabled) {
          background: #f9fafb;
        }

        .btn-secondary:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
          .in-situ-modal {
            max-width: 100%;
            max-height: 100vh;
            border-radius: 0;
          }

          .modal-body {
            padding: 1rem;
          }

          .step-indicator {
            display: none;
          }

          .modal-footer {
            border-radius: 0;
          }
        }
      `})]})}function pW({isOpen:t,onClose:e,onConfirm:n,aspectRatio:r,defaultLongestSide:s=5e3}){const[i,a]=O.useState(s),[l,c]=O.useState(s/1e3),u=(g=>{if(!r||r<=0)return{width:g,length:g};if(r>=1){const v=g,x=Math.round(g/r);return{width:v,length:x}}else{const v=g;return{width:Math.round(g*r),length:v}}})(i),p=r>=1?"landscape":"portrait",h=r>=1?`${r.toFixed(1)}:1`:`1:${(1/r).toFixed(1)}`,f=g=>{const v=parseFloat(g.target.value)||0;c(v),a(Math.round(v*1e3))},m=()=>{n(u.width,u.length),e()};return t?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"dimension-modal-overlay",onClick:e,children:o.jsxs("div",{className:"dimension-modal",onClick:g=>g.stopPropagation(),children:[o.jsxs("div",{className:"dimension-modal-header",children:[o.jsxs("div",{className:"dimension-modal-title",children:[o.jsx("h2",{children:"Set Installation Size"}),o.jsx(Wf,{content:o.jsxs("div",{children:[o.jsx("p",{children:o.jsx("strong",{children:"Why specify dimensions?"})}),o.jsx("p",{style:{marginTop:"0.5rem"},children:"Accurate dimensions are essential for:"}),o.jsxs("ul",{style:{marginTop:"0.5rem",marginBottom:0,paddingLeft:"1.25rem"},children:[o.jsx("li",{children:"Calculating exact material quantities"}),o.jsx("li",{children:"Generating PDF specifications for manufacturers"}),o.jsx("li",{children:"Slicing designs into 1m1m installation tiles"})]}),o.jsxs("p",{style:{marginTop:"0.5rem"},children:[o.jsx("strong",{children:"Tip:"})," Typical playground installations range from 3m to 20m on the longest side."]})]}),position:"bottom"})]}),o.jsx("button",{className:"dimension-modal-close",onClick:e,"aria-label":"Close",children:""})]}),o.jsxs("div",{className:"dimension-modal-body",children:[o.jsx("div",{className:"dimension-info",children:o.jsxs("p",{className:"dimension-aspect",children:["Your design has a ",o.jsxs("strong",{children:[h," ",p]})," aspect ratio"]})}),o.jsxs("div",{className:"dimension-input-group",children:[o.jsx("label",{htmlFor:"longest-dimension",children:"Installation Size (Longest Side)"}),o.jsxs("div",{className:"dimension-input-wrapper",children:[o.jsx("input",{id:"longest-dimension",type:"number",min:"0.1",max:"50",step:"0.1",value:l,onChange:f,className:"dimension-input"}),o.jsx("span",{className:"dimension-unit",children:"meters"})]}),o.jsx("p",{className:"dimension-help",children:"Enter the measurement of the longest side of your installation area. The other dimension will be calculated automatically based on your design's aspect ratio."})]}),o.jsxs("div",{className:"dimension-preview",children:[o.jsx("div",{className:"dimension-preview-title",children:"Calculated Dimensions:"}),o.jsxs("div",{className:"dimension-preview-values",children:[o.jsxs("div",{className:"dimension-preview-item",children:[o.jsx("span",{className:"dimension-preview-label",children:"Width:"}),o.jsxs("span",{className:"dimension-preview-value",children:[(u.width/1e3).toFixed(2),"m"]})]}),o.jsxs("div",{className:"dimension-preview-item",children:[o.jsx("span",{className:"dimension-preview-label",children:"Length:"}),o.jsxs("span",{className:"dimension-preview-value",children:[(u.length/1e3).toFixed(2),"m"]})]}),o.jsxs("div",{className:"dimension-preview-item",children:[o.jsx("span",{className:"dimension-preview-label",children:"Total Area:"}),o.jsxs("span",{className:"dimension-preview-value",children:[(u.width*u.length/1e6).toFixed(2),"m"]})]})]})]}),o.jsxs("div",{className:"dimension-note",children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"8",cy:"8",r:"7"}),o.jsx("line",{x1:"8",y1:"11",x2:"8",y2:"8"}),o.jsx("circle",{cx:"8",cy:"5",r:"0.5",fill:"currentColor"})]}),o.jsx("p",{children:"These dimensions will be used to calculate material quantities for your PDF specification and to slice your design into 1m1m installation tiles."})]})]}),o.jsxs("div",{className:"dimension-modal-footer",children:[o.jsx("button",{className:"dimension-btn dimension-btn-secondary",onClick:e,children:"Cancel"}),o.jsx("button",{className:"dimension-btn dimension-btn-primary",onClick:m,disabled:l<=0,children:"Confirm Size"})]})]})}),o.jsx("style",{children:`
        .dimension-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        padding: 20px;
        backdrop-filter: blur(4px);
      }

      .dimension-modal {
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 500px;
        width: 100%;
        max-height: 90vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        animation: dimensionModalSlideIn 0.3s ease-out;
      }

      @keyframes dimensionModalSlideIn {
        from {
          opacity: 0;
          transform: translateY(-20px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .dimension-modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 24px;
        border-bottom: 1px solid #e5e7eb;
      }

      .dimension-modal-title {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .dimension-modal-header h2 {
        margin: 0;
        font-size: 1.5rem;
        font-weight: 600;
        color: #111827;
      }

      .dimension-modal-close {
        background: none;
        border: none;
        font-size: 2rem;
        line-height: 1;
        color: #9ca3af;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        transition: all 0.2s;
      }

      .dimension-modal-close:hover {
        background: #f3f4f6;
        color: #111827;
      }

      .dimension-modal-body {
        padding: 24px;
        overflow-y: auto;
        flex: 1;
      }

      .dimension-info {
        background: #f0f9ff;
        border: 1px solid #bae6fd;
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 24px;
      }

      .dimension-aspect {
        margin: 0;
        color: #0c4a6e;
        font-size: 0.95rem;
        line-height: 1.5;
      }

      .dimension-input-group {
        margin-bottom: 24px;
      }

      .dimension-input-group label {
        display: block;
        font-weight: 600;
        color: #374151;
        margin-bottom: 8px;
        font-size: 0.95rem;
      }

      .dimension-input-wrapper {
        position: relative;
        display: flex;
        align-items: center;
      }

      .dimension-input {
        width: 100%;
        padding: 12px 16px;
        padding-right: 70px;
        font-size: 1.1rem;
        border: 2px solid #d1d5db;
        border-radius: 10px;
        transition: all 0.2s;
        font-family: inherit;
      }

      .dimension-input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .dimension-unit {
        position: absolute;
        right: 16px;
        color: #6b7280;
        font-weight: 500;
        pointer-events: none;
      }

      .dimension-help {
        margin: 8px 0 0 0;
        font-size: 0.85rem;
        color: #6b7280;
      }

      .dimension-preview {
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 24px;
      }

      .dimension-preview-title {
        font-weight: 600;
        color: #374151;
        margin-bottom: 16px;
        font-size: 0.95rem;
      }

      .dimension-preview-values {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .dimension-preview-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        background: white;
        border-radius: 8px;
      }

      .dimension-preview-label {
        color: #6b7280;
        font-size: 0.9rem;
      }

      .dimension-preview-value {
        font-weight: 600;
        color: #111827;
        font-size: 1.05rem;
      }

      .dimension-note {
        display: flex;
        gap: 12px;
        padding: 16px;
        background: #fffbeb;
        border: 1px solid #fde68a;
        border-radius: 10px;
      }

      .dimension-note svg {
        flex-shrink: 0;
        margin-top: 2px;
        color: #f59e0b;
      }

      .dimension-note p {
        margin: 0;
        font-size: 0.85rem;
        color: #78350f;
        line-height: 1.5;
      }

      .dimension-modal-footer {
        padding: 20px 24px;
        border-top: 1px solid #e5e7eb;
        display: flex;
        gap: 12px;
        justify-content: flex-end;
      }

      .dimension-btn {
        padding: 10px 24px;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.95rem;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
        font-family: inherit;
      }

      .dimension-btn-secondary {
        background: white;
        border: 1px solid #d1d5db;
        color: #374151;
      }

      .dimension-btn-secondary:hover {
        background: #f9fafb;
        border-color: #9ca3af;
      }

      .dimension-btn-primary {
        background: #3b82f6;
        color: white;
      }

      .dimension-btn-primary:hover {
        background: #2563eb;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
      }

      .dimension-btn-primary:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        box-shadow: none;
      }

      @media (max-width: 640px) {
        .dimension-modal {
          max-width: none;
          width: 100%;
          margin: 0;
          max-height: 100vh;
          border-radius: 0;
        }

        .dimension-modal-header {
          padding: 20px;
        }

        .dimension-modal-header h2 {
          font-size: 1.25rem;
        }

        .dimension-modal-body {
          padding: 20px;
        }

        .dimension-modal-footer {
          flex-direction: column-reverse;
          padding: 16px 20px;
        }

        .dimension-btn {
          width: 100%;
        }
      }
      `})]}):null}function fW(t,e,n){return"#"+[t,e,n].map(r=>r.toString(16).padStart(2,"0")).join("").toUpperCase()}async function mW(t,e={}){const{canvasSize:n=500,ignoreWhite:r=!0,ignoreTransparent:s=!0}=e;return new Promise((i,a)=>{const l=document.createElement("canvas");l.width=n,l.height=n;const c=l.getContext("2d",{willReadFrequently:!0}),d=new Image,u=new Blob([t],{type:"image/svg+xml"}),p=URL.createObjectURL(u);d.onload=()=>{try{c.clearRect(0,0,n,n);const h=Math.min(n/d.width,n/d.height),f=d.width*h,m=d.height*h,g=(n-f)/2,v=(n-m)/2;c.drawImage(d,g,v,f,m);const y=c.getImageData(0,0,n,n).data,b=new Map;let w=0;for(let _=0;_<y.length;_+=4){const S=y[_],E=y[_+1],T=y[_+2],M=y[_+3];if(s&&M<128||r&&S>250&&E>250&&T>250)continue;const Z=fW(S,E,T),N=b.get(Z)||0;b.set(Z,N+1),w++}const j=new Map;for(const[_,S]of b)j.set(_,{coverage:w>0?S/w*100:0,pixelCount:S});URL.revokeObjectURL(p),i(j)}catch(h){URL.revokeObjectURL(p),a(h)}},d.onerror=h=>{URL.revokeObjectURL(p),a(new Error("Failed to load SVG for coverage analysis"))},d.src=p})}function Oi(t){if(!t)return null;let e=t.replace("#","").toUpperCase();return e.length===3&&(e=e.split("").map(n=>n+n).join("")),"#"+e}function gW(t,e=10){const n=Array.from(t.entries()),r=new Map,s=new Set;for(const[i,a]of n){if(s.has(i))continue;let l=a.coverage,c=a.pixelCount;const d=Yx(i);for(const[u,p]of n){if(i===u||s.has(u))continue;const h=Yx(u);Math.max(Math.abs(d.r-h.r),Math.abs(d.g-h.g),Math.abs(d.b-h.b))<=e&&(l+=p.coverage,c+=p.pixelCount,s.add(u))}s.add(i),r.set(i,{coverage:l,pixelCount:c})}return r}function Yx(t){const e=t.replace("#","");return{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}}async function yW(t,e={}){try{const r=await(await fetch(t)).text();return mW(r,e)}catch(n){throw console.error("[CoverageAnalyzer] Failed to fetch SVG from URL:",n),n}}const xW=[{code:"RH01",name:"Standard Red",hex:"#A5362F"},{code:"RH02",name:"Bright Red",hex:"#E21F2F"},{code:"RH10",name:"Standard Green",hex:"#609B63"},{code:"RH11",name:"Bright Green",hex:"#3BB44A"},{code:"RH12",name:"Dark Green",hex:"#006C55"},{code:"RH20",name:"Standard Blue",hex:"#0075BC"},{code:"RH21",name:"Purple",hex:"#493D8C"},{code:"RH22",name:"Light Blue",hex:"#47AFE3"},{code:"RH23",name:"Azure",hex:"#039DC4"},{code:"RH26",name:"Turquoise",hex:"#00A6A3"},{code:"RH30",name:"Standard Beige",hex:"#E4C4AA"},{code:"RH31",name:"Cream",hex:"#E8E3D8"},{code:"RH32",name:"Brown",hex:"#8B5F3C"},{code:"RH90",name:"Funky Pink",hex:"#E8457E"},{code:"RH40",name:"Mustard Yellow",hex:"#E5A144"},{code:"RH41",name:"Bright Yellow",hex:"#FFD833"},{code:"RH50",name:"Orange",hex:"#F15B32"},{code:"RH60",name:"Dark Grey",hex:"#59595B"},{code:"RH61",name:"Light Grey",hex:"#939598"},{code:"RH65",name:"Pale Grey",hex:"#D9D9D6"},{code:"RH70",name:"Black",hex:"#231F20"}];function vW(t){if(!t)return null;const e=Oi(t);return xW.find(n=>Oi(n.hex)===e)||null}function qx(t){const e=t.replace("#","");return{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}}function Xx(t,e,n=10){const r=Oi(e);if(!r)return 0;for(const[l,c]of t)if(Oi(l)===r)return c.coverage;const s=qx(r);let i=null,a=1/0;for(const[l,c]of t){const d=qx(Oi(l)),u=Math.max(Math.abs(s.r-d.r),Math.abs(s.g-d.g),Math.abs(s.b-d.b));u<=n&&u<a&&(a=u,i=c)}return i?i.coverage:0}async function Kx(t,e,n,r="solid"){var s,i;if(!t||!e)return e||[];try{const a=await yW(t,{canvasSize:600,ignoreWhite:!0,ignoreTransparent:!0}),l=gW(a,5);console.log("[deriveCurrentColors] Coverage analysis:",l);const c=new Map;n&&n.size>0&&n.forEach(p=>{const h=typeof p=="string"?p:p.hex,f=Oi(h);f&&h!=="transparent"&&h!=="none"&&(!c.has(f)||p.tpvCode)&&c.set(f,{hex:f,tpvCode:p.tpvCode||null,tpvName:p.tpvName||null,editType:p.editType||"unknown",blendComponents:p.blendComponents||null})});const d=new Map;for(const p of e){const h=Oi(((s=p.blendColor)==null?void 0:s.hex)||((i=p.targetColor)==null?void 0:i.hex));if(!h)continue;const f=Xx(l,h,10);f>.1&&d.set(h,{...p,targetColor:{...p.targetColor,areaPct:f}})}for(const[p,h]of c)if(!d.has(p)){const f=Xx(l,p,10);if(f>.1){const m=h.tpvCode?{code:h.tpvCode,name:h.tpvName}:vW(p);d.set(p,{originalColor:{hex:p},targetColor:{hex:p,areaPct:f},blendColor:{hex:p},chosenRecipe:h.blendComponents?{components:h.blendComponents,deltaE:0,quality:"Custom Blend"}:{components:m?[{code:m.code,name:m.name,percentage:100,parts:10}]:[{code:"CUSTOM",name:"Custom Color",percentage:100,parts:10}],deltaE:0,quality:m?"Pure TPV Colour":"Custom"},tpvCode:h.tpvCode||(m==null?void 0:m.code)||null,tpvName:h.tpvName||(m==null?void 0:m.name)||null,isAddedFromEdit:!0})}}const u=Array.from(d.values()).sort((p,h)=>{var f,m;return(((f=h.targetColor)==null?void 0:f.areaPct)||0)-(((m=p.targetColor)==null?void 0:m.areaPct)||0)});return console.log("[deriveCurrentColors] Derived colors:",u.length,"colors"),u}catch(a){return console.error("[deriveCurrentColors] Failed to analyze coverage:",a),e}}function bW(t){if(!t||t.size===0)return!1;for(const e of t.values()){const n=typeof e=="string"?e:e.hex;if(n&&n!=="transparent"&&n!=="none")return!0}return!1}const Zx={landscape:[{name:"1:1",ratio:1,width:1024,height:1024},{name:"4:3",ratio:4/3,width:1024,height:768},{name:"3:2",ratio:3/2,width:1024,height:683},{name:"16:9",ratio:16/9,width:1024,height:576},{name:"2:1",ratio:2,width:1024,height:512},{name:"3:1",ratio:3,width:1024,height:341}],portrait:[{name:"1:1",ratio:1,width:1024,height:1024},{name:"3:4",ratio:3/4,width:768,height:1024},{name:"2:3",ratio:2/3,width:683,height:1024},{name:"9:16",ratio:9/16,width:576,height:1024},{name:"1:2",ratio:1/2,width:512,height:1024},{name:"1:3",ratio:1/3,width:341,height:1024}]},Aa={safeDifference:.3,tilingThreshold:3.5,framingThreshold:2.5};function wW(t,e){return t/e}function _W(t){return t>=.95&&t<=1.05?"square":t>1?"landscape":"portrait"}function SW(t,e){const n=e==="portrait"?Zx.portrait:Zx.landscape;let r=n[0],s=Math.abs(t-r.ratio);for(const i of n){const a=Math.abs(t-i.ratio);a<s&&(s=a,r=i)}return{...r,difference:s}}function kW(t,e,n){return t>=Aa.tilingThreshold||t<=1/Aa.tilingThreshold?{mode:"tiling",reason:"Extreme aspect ratio - design will repeat along length",warning:!0}:n>=Aa.safeDifference||t>=Aa.framingThreshold||t<=1/Aa.framingThreshold?{mode:"framing",reason:"Design panel centered with base color surround",warning:!1}:{mode:"full",reason:"Design fills entire surface",warning:!1}}function jW(t,e){const n=wW(t,e),r=_W(n),s=SW(n,r),i=kW(n,s.ratio,s.difference);return{user:{widthMM:t,heightMM:e,aspectRatio:n,orientation:r,formatted:`${(t/1e3).toFixed(1)}m  ${(e/1e3).toFixed(1)}m`},canonical:{name:s.name,ratio:s.ratio,width:s.width,height:s.height,difference:s.difference},layout:i,recraft:{width:s.width,height:s.height,metadata:{targetWidthMM:t,targetHeightMM:e,layoutMode:i.mode}}}}function CW(t){const{user:e,canonical:n,layout:r}=t;let s=`Generating ${n.name} design panel`;return r.mode==="full"?s+=` (fills ${e.formatted} surface)`:r.mode==="framing"?s+=` (centered in ${e.formatted} surface with base color surround)`:r.mode==="tiling"&&(s+=` (will repeat along ${e.formatted} surface)`),s}function EW(t){return t.layout.warning||t.layout.mode!=="full"}async function TW(t,e="tpv-studio-uploads"){try{const n=Date.now(),r=Math.random().toString(36).substring(7),s=t.name.split(".").pop(),a=`uploads/${`${n}-${r}.${s}`}`;console.log("[Upload] Uploading file:",t.name,"",a);const{data:l,error:c}=await an.storage.from(e).upload(a,t,{cacheControl:"3600",upsert:!1});if(c)return console.error("[Upload] Error:",c),{success:!1,error:c.message||"Failed to upload file"};const{data:{publicUrl:d}}=an.storage.from(e).getPublicUrl(a);return console.log("[Upload] Success:",d),{success:!0,url:d,path:a}}catch(n){return console.error("[Upload] Unexpected error:",n),{success:!1,error:n.message||"Unexpected error during upload"}}}function Jx(t,e={}){const{maxSizeMB:n=10,allowedTypes:r=["image/png","image/jpeg","image/svg+xml"]}=e;if(!t)return{valid:!1,error:"No file selected"};if(!r.includes(t.type))return{valid:!1,error:`Invalid file type. Allowed: ${r.map(a=>a.split("/")[1].toUpperCase()).join(", ")}`};const s=n*1024*1024;return t.size>s?{valid:!1,error:`File too large. Maximum size: ${n}MB`}:{valid:!0}}function NW({onExportSVG:t,onExportPNG:e,onExportPDF:n,onExportTiles:r,onExportDXF:s,onExportCanvasPDF:i,viewMode:a,exporting:l,disabled:c}){const[d,u]=O.useState(!1),p=O.useRef(null);O.useEffect(()=>{const m=g=>{p.current&&!p.current.contains(g.target)&&u(!1)};return d&&document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[d]);const h=a==="solid"?"Solid":"Blend",f=m=>{u(!1),m()};return o.jsxs("div",{className:"playground-export-menu",ref:p,children:[o.jsxs("button",{className:"action-bar__btn action-bar__btn--export",onClick:()=>u(!d),disabled:c||l,children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),o.jsx("polyline",{points:"7 10 12 15 17 10"}),o.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),l?"Exporting...":"Export",o.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginLeft:"0.25rem"},children:o.jsx("path",{d:d?"M18 15l-6-6-6 6":"M6 9l6 6 6-6"})})]}),d&&o.jsxs("div",{className:"playground-export-menu__dropdown",children:[o.jsxs("button",{className:"playground-export-menu__item",onClick:()=>f(t),children:[o.jsx("span",{className:"playground-export-menu__icon",children:""}),o.jsxs("div",{className:"playground-export-menu__content",children:[o.jsxs("span",{className:"playground-export-menu__title",children:["Download ",h," SVG"]}),o.jsx("span",{className:"playground-export-menu__desc",children:"Vector format for CAD/printing"})]})]}),o.jsxs("button",{className:"playground-export-menu__item",onClick:()=>f(e),children:[o.jsx("span",{className:"playground-export-menu__icon",children:""}),o.jsxs("div",{className:"playground-export-menu__content",children:[o.jsxs("span",{className:"playground-export-menu__title",children:["Download ",h," PNG"]}),o.jsx("span",{className:"playground-export-menu__desc",children:"High-res image for presentations"})]})]}),o.jsxs("button",{className:"playground-export-menu__item",onClick:()=>f(r),children:[o.jsx("span",{className:"playground-export-menu__icon",children:""}),o.jsxs("div",{className:"playground-export-menu__content",children:[o.jsx("span",{className:"playground-export-menu__title",children:"Download Tiles ZIP"}),o.jsx("span",{className:"playground-export-menu__desc",children:"1m1m SVG tiles for large printing"})]})]}),o.jsx("div",{className:"playground-export-menu__divider"}),o.jsxs("button",{className:"playground-export-menu__item",onClick:()=>f(n),children:[o.jsx("span",{className:"playground-export-menu__icon",children:""}),o.jsxs("div",{className:"playground-export-menu__content",children:[o.jsxs("span",{className:"playground-export-menu__title",children:[h," Recipe Report (PDF)"]}),o.jsx("span",{className:"playground-export-menu__desc",children:"TPV quantities & specifications"})]})]}),i&&o.jsxs("button",{className:"playground-export-menu__item",onClick:()=>f(i),children:[o.jsx("span",{className:"playground-export-menu__icon",children:""}),o.jsxs("div",{className:"playground-export-menu__content",children:[o.jsx("span",{className:"playground-export-menu__title",children:"Canvas PDF (1:100)"}),o.jsx("span",{className:"playground-export-menu__desc",children:"Scaled design with dimensions"})]})]}),s&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"playground-export-menu__divider"}),o.jsxs("button",{className:"playground-export-menu__item",onClick:()=>f(s),children:[o.jsx("span",{className:"playground-export-menu__icon",children:""}),o.jsxs("div",{className:"playground-export-menu__content",children:[o.jsx("span",{className:"playground-export-menu__title",children:"Download DXF"}),o.jsx("span",{className:"playground-export-menu__desc",children:"CAD format for AutoCAD/Rhino"})]})]})]})]})]})}function Ma(t){var n;if(!t)return null;if(t.type==="image/svg+xml")return"svg";if(t.type==="image/png"||t.type==="image/jpeg")return"image";const e=(n=t.name.split(".").pop())==null?void 0:n.toLowerCase();return e==="svg"?"svg":["png","jpg","jpeg"].includes(e)?"image":null}function PW({loadedDesign:t,onDesignSaved:e,isEmbedded:n=!1}){const r=vd(),{inputMode:s,prompt:i,lengthMM:a,widthMM:l,arMapping:c,uploadedFileUrl:d,result:u,jobId:p,blendRecipes:h,colorMapping:f,blendSvgUrl:m,blendEditedColors:g,solidRecipes:v,solidColorMapping:x,solidSvgUrl:y,solidEditedColors:b,viewMode:w,showFinalRecipes:j,showSolidSummary:_,regionOverrides:S,originalTaggedSvg:E,regionOverridesHistory:T,historyIndex:M,designName:Z,currentDesignId:N,hasUnsavedChanges:G,resetDesign:C}=r,F=r.setInputMode,pe=r.setPrompt,V=r.setDimensions,J=r.setArMapping;r.setGenerationResult;const I=r.setResult,K=r.setJobId;r.setBlendState;const z=r.setBlendRecipes,W=r.setColorMapping,fe=r.setBlendSvgUrl;r.setSolidState;const ue=r.setSolidRecipes,ne=r.setSolidColorMapping,ke=r.setSolidSvgUrl;r.updateBlendSvgUrl,r.updateSolidSvgUrl;const ce=r.setBlendEditedColors,$e=r.setSolidEditedColors;r.setViewMode;const ze=r.setShowFinalRecipes,Ue=r.setShowSolidSummary,Ge=r.setRegionOverrides;r.addRegionOverride;const at=r.setOriginalTaggedSvg,Ve=r.setRegionOverridesHistory,k=r.setHistoryIndex;r.canUndo,r.canRedo,r.undo,r.redo;const Q=r.setDesignName,oe=r.setCurrentDesignId,D=r.loadDesign,P=ee=>V(ee,a),$=ee=>V(l,ee),[Y,se]=O.useState(null),[B,re]=O.useState(null),[ye,le]=O.useState(!1),[U,ae]=O.useState(!1),[xe,Te]=O.useState(null),[He,Ee]=O.useState(null),[ie,he]=O.useState(""),[Xe,tt]=O.useState(null),[nt,yt]=O.useState(!1),[ht,Fe]=O.useState(null),[de,te]=O.useState(!1),[me,Ye]=O.useState(null),[xt,Ce]=O.useState([]),[wt,pt]=O.useState(!1),[Ct,Ke]=O.useState(!1),[Xt,bn]=O.useState(null),[Nr,Jn]=O.useState(!1),[Ps,be]=O.useState(!1),[qe,kt]=O.useState(!1),[rn,Ze]=O.useState(null),[Pr,_t]=O.useState(!1),[Ln,ft]=O.useState(null),[Kt,Mt]=O.useState(null),[cn,Qr]=O.useState(null),[hs,Rr]=O.useState(null),[Jt,wn]=O.useState(null),[es,_n]=O.useState(!1),[Or,Qn]=O.useState(null),Dn=O.useRef(null);O.useEffect(()=>{(y||m)&&Dn.current&&!Ct&&!nt&&setTimeout(()=>{var ee;(ee=Dn.current)==null||ee.scrollIntoView({behavior:"smooth",block:"start"})},300)},[y,m,Ct,nt]),O.useEffect(()=>{(async()=>{try{const ve=await yd({limit:1,offset:0});Qn(ve.designs.length>0),console.log("[INSPIRE] Existing designs check:",ve.designs.length>0?"User has designs":"No designs found")}catch(ve){console.error("[INSPIRE] Failed to check for existing designs:",ve),Qn(!0)}})()},[]),O.useEffect(()=>{s==="upload"?(V(null,null),console.log("[DIMENSION] Reset dimensions for upload mode")):s==="prompt"&&(l===null||a===null)&&(V(5e3,5e3),console.log("[DIMENSION] Restored default dimensions for prompt mode"))},[s,V]),O.useEffect(()=>()=>{m&&m.startsWith("blob:")&&URL.revokeObjectURL(m),y&&y.startsWith("blob:")&&URL.revokeObjectURL(y)},[]),O.useEffect(()=>{const ee=ve=>{ve.key==="Escape"&&de&&(te(!1),Ye(null))};return window.addEventListener("keydown",ee),()=>window.removeEventListener("keydown",ee)},[de]),O.useEffect(()=>{xt.length>0&&!wt&&Lr()},[xt,wt]),O.useEffect(()=>{(async()=>{if(!m&&!y){Rr(null),wn(null);return}if(!bW(S)){Rr(h),wn(v);return}_n(!0),console.log("[INSPIRE] Recalculating current recipes from edited SVG...");try{if(m&&h){const ve=await Kx(m,h,S,"blend");Rr(ve),console.log("[INSPIRE] Derived blend recipes:",ve.length)}if(y&&v){const ve=await Kx(y,v,S,"solid");wn(ve),console.log("[INSPIRE] Derived solid recipes:",ve.length)}}catch(ve){console.error("[INSPIRE] Failed to recalculate recipes:",ve),Rr(h),wn(v)}finally{_n(!1)}})()},[m,y,S,h,v]),O.useEffect(()=>{if(t){console.log("[INSPIRE] Loading design data:",t);const ee=Ap(t);console.log("[INSPIRE] Restored state:",ee),D(ee),t.name&&Q(t.name),t.id&&oe(t.id),console.log("[INSPIRE] Loaded design:",t.name),setTimeout(async()=>{var ve;if((ve=ee.result)!=null&&ve.svg_url){console.log("[INSPIRE] Regenerating SVGs from loaded design");let Se=ee.originalTaggedSvg||null;if(Se)console.log("[INSPIRE] Using saved tagged SVG with preserved region IDs"),at(Se);else try{const ct=await(await fetch(ee.result.svg_url)).text();Se=Vo(ct),at(Se),console.log("[INSPIRE] Tagged SVG with region IDs for loaded design")}catch(Pe){console.error("[INSPIRE] Failed to tag SVG regions:",Pe)}try{ee.blendRecipes&&ee.colorMapping&&await As(ee.result.svg_url,ee.colorMapping,ee.blendRecipes,ee.blendEditedColors,Se,ee.regionOverrides),ee.solidRecipes&&ee.solidColorMapping&&await sr(ee.result.svg_url,ee.solidColorMapping,ee.solidRecipes,ee.solidEditedColors,Se,ee.regionOverrides)}catch(Pe){console.error("[INSPIRE] Failed to regenerate SVGs:",Pe),Ee("Failed to restore design preview. Please try reloading.")}}},100)}},[t,D,Q,oe,at]);const xr=O.useRef(!1);O.useEffect(()=>{if(t||xr.current||!((u==null?void 0:u.svg_url)&&!m&&!y&&(h||v)))return;xr.current=!0,console.log("[INSPIRE] Detected design loaded directly into store, regenerating SVGs..."),(async()=>{let Se=E||null;if(Se)console.log("[INSPIRE] Using existing tagged SVG with preserved region IDs");else try{const ct=await(await fetch(u.svg_url)).text();Se=Vo(ct),at(Se),console.log("[INSPIRE] Tagged SVG with region IDs")}catch(Pe){console.error("[INSPIRE] Failed to tag SVG regions:",Pe)}try{h&&f&&await As(u.svg_url,f,h,g,Se,S),v&&x&&await sr(u.svg_url,x,v,b,Se,S)}catch(Pe){console.error("[INSPIRE] Failed to regenerate SVGs:",Pe),Ee("Failed to restore design preview. Please try reloading.")}})()},[u,m,y,h,v,f,x,t,S,E]),O.useEffect(()=>{u||(xr.current=!1)},[u]);const Ar=ee=>{var Pe;const ve=(Pe=ee.target.files)==null?void 0:Pe[0];if(!ve){se(null);return}const Se=Jx(ve,{maxSizeMB:10,allowedTypes:["image/png","image/jpeg","image/svg+xml"]});if(!Se.valid){Ee(Se.error),se(null);return}se(ve),Ee(null)},Rs=ee=>{ee.preventDefault(),ee.stopPropagation(),le(!0)},ps=ee=>{ee.preventDefault(),ee.stopPropagation(),ee.currentTarget===ee.target&&le(!1)},di=ee=>{ee.preventDefault(),ee.stopPropagation()},ts=ee=>{ee.preventDefault(),ee.stopPropagation(),le(!1);const ve=ee.dataTransfer.files;if(ve&&ve.length>0){const Se=ve[0],Pe=Jx(Se,{maxSizeMB:10,allowedTypes:["image/png","image/jpeg","image/svg+xml"]});if(!Pe.valid){Ee(Pe.error),se(null);return}se(Se),Ee(null)}},Mr=async()=>{var ee,ve;if(s==="prompt"&&!i.trim()){Ee("Please enter a design description");return}if(s==="upload"&&!Y){Ee("Please select a file to upload");return}if(s==="upload"&&Y&&!Ma(Y)){Ee("Unsupported file type. Please upload PNG, JPG, or SVG.");return}Ee(null),ae(!0),Te(null),I(null),K(null),he("Initialising..."),tt(null);try{let Se;if(s==="upload"&&Y){const Be=Ma(Y);he(Be==="svg"?"Uploading SVG file...":"Uploading image..."),re("Uploading...");const je=await TW(Y);if(!je.success)throw new Error(je.error||"Failed to upload file");if(re(null),Be==="svg"){if(he("Processing SVG..."),Se=await gi.processUploadedSVG({svg_url:je.url}),!Se.success)throw new Error(Se.error||"Failed to process SVG");K(Se.jobId),he(" SVG uploaded successfully!"),ae(!1);const H=await gi.getRecraftStatus(Se.jobId);Te(H),I(H.result),(ee=H.result)!=null&&ee.svg_url&&await $t(H.result.svg_url,Se.jobId);return}else{if(he("Starting vectorisation..."),Se=await gi.vectorizeImage({image_url:je.url}),!Se.success)throw new Error(Se.error||"Failed to start vectorisation");he(" AI is vectorising your image...")}}else if(s==="prompt"){const Be=jW(a,l);if(J(Be),console.log("[TPV-STUDIO] AR Mapping:",Be),console.log("[TPV-STUDIO] Layout:",CW(Be)),EW(Be)?he(`Generating ${Be.canonical.name} design panel...`):he("Initialising..."),Se=await gi.generateRecraft({prompt:i.trim(),lengthMM:Be.recraft.height,widthMM:Be.recraft.width}),!Se.success)throw new Error(Se.error||"Failed to start generation");he(" AI is creating your design...")}K(Se.jobId),he("Request submitted, waiting for processing...");let Pe=null,ct=Date.now();await gi.waitForRecraftCompletion(Se.jobId,Be=>{var H,we;Te(Be);const je=Math.floor((Date.now()-ct)/1e3);if(Be.status==="queued"){const Ae=[` Preparing your canvas... (${je}s)`,` Warming up the AI brushes... (${je}s)`,` Queueing your masterpiece... (${je}s)`,` Mixing digital paints... (${je}s)`,` AI is contemplating your vision... (${je}s)`,` Selecting the perfect colours... (${je}s)`,` Calculating vector paths... (${je}s)`,` Almost ready to create... (${je}s)`],dt=Math.floor(je/4)%Ae.length;he(Ae[dt])}else if(Be.status==="running")if(Pe!=="running")he(" AI is creating your design..."),Pe="running";else{const Ae=[` Creating vector shapes... (${je}s)`,` Applying colours and patterns... (${je}s)`,` Refining design details... (${je}s)`,` Finalising artwork... (${je}s)`],dt=Math.floor(je/5)%Ae.length;he(Ae[dt])}else if(Be.status==="retrying"){const Ae=((H=Be.recraft)==null?void 0:H.attempt_current)||0,dt=((we=Be.recraft)==null?void 0:we.attempt_max)||3;he(` Retrying generation (attempt ${Ae}/${dt})...`)}});const et=await gi.getRecraftStatus(Se.jobId);Te(et),I(et.result),et.status==="completed"&&(he(" Design ready!"),ae(!1),(ve=et.result)!=null&&ve.svg_url&&await $t(et.result.svg_url,Se.jobId))}catch(Se){console.error("Generation failed:",Se),Ee(Se.message),he(""),ae(!1)}},er=()=>{const ee=w==="solid"?y:m,ve=w==="solid"?"tpv-solid":"tpv-blend";if(ee){const Se=document.createElement("a");Se.href=ee,Se.download=`${ve}-${Date.now()}.svg`,document.body.appendChild(Se),Se.click(),document.body.removeChild(Se)}},In=async ee=>{try{const Se=await(await fetch(ee)).text(),et=new DOMParser().parseFromString(Se,"image/svg+xml").querySelector("svg");if(!et)return null;let Be,je;const H=et.getAttribute("viewBox");if(H){const Ae=H.split(/\s+/).map(Number);Be=Ae[2],je=Ae[3]}else Be=parseFloat(et.getAttribute("width"))||1024,je=parseFloat(et.getAttribute("height"))||1024;const we=Be/je;return console.log(`[DIMENSION] Detected aspect ratio: ${we.toFixed(2)} (${Be}${je})`),we}catch(ve){return console.error("[DIMENSION] Failed to detect aspect ratio:",ve),null}},fs=(ee,ve)=>{console.log(`[DIMENSION] User confirmed dimensions: ${ee}mm  ${ve}mm`),P(ee),$(ve),Qr({width:ee,height:ve}),Kt==="pdf"?setTimeout(()=>nr(ee,ve),100):Kt==="tiles"?setTimeout(()=>Cn(ee,ve),100):Kt==="insitu"?setTimeout(()=>kt(!0),100):Kt==="save"&&Jn(!0),Mt(null)},Sn=async()=>{const ee=w==="solid"?y:m;if(s==="upload"&&(!l||!a)){console.log("[DIMENSION] No dimensions set for upload, showing modal...");const ve=await In(ee);if(ve){ft(ve),Mt("insitu"),_t(!0);return}else{ft(1),Mt("insitu"),_t(!0);return}}kt(!0)},kn=()=>{const ee=w==="solid"?y:m,ve=w==="solid"?"tpv-solid":"tpv-blend";if(ee){const Se=new Image;Se.onload=()=>{const Pe=document.createElement("canvas");Pe.width=Se.naturalWidth||1e3,Pe.height=Se.naturalHeight||1e3,Pe.getContext("2d").drawImage(Se,0,0),Pe.toBlob(et=>{const Be=URL.createObjectURL(et),je=document.createElement("a");je.href=Be,je.download=`${ve}-${Date.now()}.png`,document.body.appendChild(je),je.click(),document.body.removeChild(je),URL.revokeObjectURL(Be)})},Se.src=ee}},dn=()=>{G()&&!window.confirm(`Start a new design?

You have unsaved changes that will be lost.`)||(C(),se(null),ae(!1),Te(null),Ee(null),he(""),tt(null),yt(!1),Fe(null),te(!1),Ye(null),Ke(!1),bn(null))},$r=async()=>{const ee=w==="solid"?y:m,ve=l>0&&a>0;if(s==="upload"&&!ve){console.log("[DIMENSION] No dimensions set for upload, showing modal before save...");const Pe=await In(ee);if(Pe){ft(Pe),Mt("save"),_t(!0);return}else{ft(1),Mt("save"),_t(!0);return}}Jn(!0)},[tr,zn]=O.useState(!1),jn=async()=>{const ee=w==="solid"?y:m;if(s==="upload"&&(!l||!a)){console.log("[DIMENSION] No dimensions set for upload, showing modal...");const ve=await In(ee);if(ve){ft(ve),Mt("pdf"),_t(!0);return}else{ft(1),Mt("pdf"),_t(!0);return}}await nr(l,a)},nr=async(ee,ve)=>{const Se=w==="solid"?y:m,Pe=w==="solid"?Jt||v:hs||h,ct=w==="solid"?"tpv-solid":"tpv-blend";if(!Se||!Pe){Ee("Cannot generate PDF: missing SVG or recipes");return}zn(!0),Ee(null);try{const Be=await(await fetch(Se)).text(),je=new AbortController,H=setTimeout(()=>je.abort(),3e4),we=await Vr.getSession(),Ae={"Content-Type":"application/json"};we!=null&&we.access_token&&(Ae.Authorization=`Bearer ${we.access_token}`);const dt=await fetch("/api/export-pdf",{method:"POST",headers:Ae,signal:je.signal,body:JSON.stringify({svgString:Be,designName:Z||i||"TPV Design",projectName:"TPV Studio",dimensions:{widthMM:ee,lengthMM:ve},recipes:Pe,mode:w,designId:p||""})});if(clearTimeout(H),!dt.ok){const Nn=dt.headers.get("content-type");if(Nn&&Nn.includes("application/json")){const ir=await dt.json();throw new Error(ir.message||"PDF generation failed")}else{const ir=await dt.text();throw console.error("PDF API error response:",ir),new Error(`Server error: ${dt.status}`)}}const gt=await dt.blob(),De=URL.createObjectURL(gt),it=document.createElement("a");it.href=De,it.download=`${ct}-${Date.now()}.pdf`,document.body.appendChild(it),it.click(),document.body.removeChild(it),URL.revokeObjectURL(De)}catch(et){console.error("PDF download error:",et),et.name==="AbortError"?Ee("PDF generation timed out. Please try again."):Ee(`PDF generation failed: ${et.message}`)}finally{zn(!1)}},un=async()=>{const ee=w==="solid"?y:m;if(!ee){Ee("No SVG available to slice");return}if(s==="upload"&&(!l||!a)){console.log("[DIMENSION] No dimensions set for upload, showing modal...");const ve=await In(ee);if(ve){ft(ve),Mt("tiles"),_t(!0);return}else{ft(1),Mt("tiles"),_t(!0);return}}await Cn(l,a)},Cn=async(ee,ve)=>{const Se=w==="solid"?y:m;try{await bT(Se,{width:ee,length:ve},Z||"tpv-design")}catch(Pe){console.error("Tile download error:",Pe),Ee(`Failed to download tiles: ${Pe.message}`)}},$t=async(ee=null,ve=null)=>{const Se=ee||(u==null?void 0:u.svg_url),Pe=ve||p;if(!Se){Ee("No SVG available to analyse");return}{console.log("[TPV-STUDIO] Blend mode disabled - skipping blend recipes, generating solid only"),Ee(null),he(" Processing design colours...");let ct=null;try{const Be=await(await fetch(Se)).text();ct=Vo(Be),at(ct),console.log("[TPV-STUDIO] Tagged SVG with region IDs")}catch(et){console.error("[TPV-STUDIO] Failed to tag SVG regions:",et)}await ns(Se,Pe,ct);return}},jt=async()=>{yt(!1),Fe(null),Ke(!1),bn(null),w==="solid"?$e(new Map):ce(new Map),u!=null&&u.svg_url&&await $t(u.svg_url,p)},mn=async ee=>{var ve;if(!Z){if(!i||s!=="prompt"){Y&&Q(`TPV Design  ${Y.name.replace(/\.[^/.]+$/,"")}`);return}be(!0);try{const Se=(ee==null?void 0:ee.slice(0,6).map(ct=>{var Be,je;const et=(je=(Be=ct.chosenRecipe)==null?void 0:Be.components)==null?void 0:je[0];return(et==null?void 0:et.name)||null}).filter(Boolean))||[],Pe=await gi.generateDesignName({prompt:i,colors:Se,dimensions:{widthMM:l,lengthMM:a}});Pe.success&&((ve=Pe.names)==null?void 0:ve.length)>0?Q(Pe.names[0]):Q(Nt(i))}catch(Se){console.error("[TPV-STUDIO] Name generation failed:",Se),Q(Nt(i))}finally{be(!1)}}},Nt=ee=>ee?`TPV Design  ${ee.split(/[,.]/)[0].trim().slice(0,40)}`:"TPV Playground Design",ns=async(ee=null,ve=null,Se=null)=>{const Pe=ee||(u==null?void 0:u.svg_url),ct=ve||p,et=Se||E;if(Pe)try{console.log("[TPV-STUDIO] Generating solid color version...");const Be=await fetch("/api/solid-recipes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({svg_url:Pe,job_id:ct,max_colors:15})}),je=await Be.json();if(!Be.ok)throw new Error(je.error||"Failed to generate solid recipes");if(je.success){ue(je.recipes);const H=new Map(Object.entries(je.colorMapping||{}));console.log("[TPV-STUDIO] Using API colorMapping with",H.size,"entries"),ne(H);try{const{dataUrl:we,stats:Ae}=await ji(Pe,H,et);ke(we),console.log("[TPV-STUDIO] Solid color SVG generated:",Ae),Ae.colorsNotMapped&&Ae.colorsNotMapped.size>0&&console.warn("[TPV-STUDIO] Unmapped colors in solid mode:",Array.from(Ae.colorsNotMapped)),mn(je.recipes)}catch(we){console.error("[TPV-STUDIO] Failed to generate solid SVG:",we)}}}catch(Be){console.error("[TPV-STUDIO] Solid generation failed:",Be)}},Os=(ee,ve="palette")=>{if(console.log("[TPV-STUDIO] Color clicked:",ee,"source:",ve,"in mode:",w),de&&me&&ve==="palette"){Pt(me.regionId,ee.hex),te(!1),Ye(null);return}ve==="palette"&&(w==="blend"?(bn(ee),Ke(!0),ze(!1)):(Fe(ee),yt(!0),Ue(!1)))},qi=ee=>{console.log("[TPV-STUDIO] Region clicked:",ee),de?(Pt(me.regionId,ee.sourceColor),te(!1),Ye(null)):(te(!0),Ye(ee))},Pt=(ee,ve)=>{const Se=typeof ve=="string"?{hex:ve,editType:"eyedrop"}:ve;console.log("[TPV-STUDIO] Queuing region recolor:",ee,"->",Se),Ce(Pe=>[...Pe,{regionId:ee,colorData:{...Se,hex:Se.hex.toLowerCase()},viewMode:w}])},Lr=async()=>{if(wt||xt.length===0)return;pt(!0);const ee=xt[0],ve=ee.colorData;console.log("[TPV-STUDIO] Processing queued region recolor:",ee.regionId,"->",ve);try{const Se=new Map(S);Se.set(ee.regionId,ve),ee.viewMode==="blend"?await Qt(null,null,Se):await Tn(null,null,Se),Ge(Se);const Pe=r.historyIndex,et=r.regionOverridesHistory.slice(0,Pe+1);et.push(new Map(Se)),et.length>50&&et.shift(),Ve(et),k(et.length-1),console.log("[TPV-STUDIO] Completed region recolor for:",ee.regionId)}catch(Se){console.error("[TPV-STUDIO] Failed to process region recolor:",Se)}finally{Ce(Se=>Se.slice(1)),pt(!1)}},Xi=()=>{console.log("[TPV-STUDIO] Eyedropper cancelled"),te(!1),Ye(null)},ui=()=>{me&&(console.log("[TPV-STUDIO] Making region transparent:",me.regionId),Pt(me.regionId,"transparent"),te(!1),Ye(null))},En=ee=>{if(!me)return;console.log("[TPV-STUDIO] Selecting TPV color for region:",me.regionId,ee);const ve={hex:ee.hex,tpvCode:ee.code,tpvName:ee.name,originalHex:me.sourceColor,editType:"solid"};Pt(me.regionId,ve),te(!1),Ye(null)},rr=async()=>{if(M<=0)return;const ee=M-1,ve=T[ee];console.log("[TPV-STUDIO] Undoing region override to index:",ee),Ge(new Map(ve)),k(ee),w==="blend"?await Qt(null,null,ve):await Tn(null,null,ve)},Ki=async()=>{if(M>=T.length-1)return;const ee=M+1,ve=T[ee];console.log("[TPV-STUDIO] Redoing region override to index:",ee),Ge(new Map(ve)),k(ee),w==="blend"?await Qt(null,null,ve):await Tn(null,null,ve)},hi=async ee=>{if(ht)if(console.log("[TPV-STUDIO] Color changed:",ht.hex,"->",ee,"in mode:",w),w==="solid"){const Se=(Jt||v).find(Pe=>Pe.targetColor.hex.toLowerCase()===ht.hex.toLowerCase());if(Se!=null&&Se.isAddedFromEdit){const Pe=ht.hex.toLowerCase(),ct=new Map(S);let et=0;const Be=fn.find(H=>H.hex.toLowerCase()===ee.toLowerCase());S.forEach((H,we)=>{(typeof H=="string"?H:H.hex).toLowerCase()===Pe&&(ct.set(we,{hex:ee,tpvCode:(Be==null?void 0:Be.code)||null,tpvName:(Be==null?void 0:Be.name)||null,originalHex:H.originalHex||Pe,editType:"solid"}),et++)}),console.log("[TPV-STUDIO] Updated",et,"region overrides for derived color:",Pe,"->",ee);const je=T.slice(0,M+1);je.push(new Map(ct)),je.length>50&&je.shift(),Ge(ct),Ve(je),k(je.length-1),Fe({...ht,hex:ee,blendHex:ee}),await Tn(b,ee,ct)}else{const Pe=new Map(b),ct=(Se==null?void 0:Se.mergedOriginalColors)||[ht.originalHex.toLowerCase()];console.log("[TPV-STUDIO] Updating",ct.length,"original colors:",ct),ct.forEach(et=>{Pe.set(et,{newHex:ee.toLowerCase()})}),$e(Pe),Fe({...ht,hex:ee,blendHex:ee}),await Tn(Pe,ee)}}else{const ve=new Map(g);ve.set(ht.originalHex.toLowerCase(),{newHex:ee.toLowerCase()}),ce(ve),Fe({...ht,hex:ee,blendHex:ee}),await Qt(ve,ee)}};O.useCallback(async({blendHex:ee,parts:ve,recipe:Se})=>{if(Xt)if(console.log("[TPV-STUDIO] Mixer blend changed:",Xt.originalHex,"->",ee,"recipe:",Se,"isAddedFromEdit:",Xt.isAddedFromEdit),Xt.isAddedFromEdit){const Pe=Xt.hex.toLowerCase(),ct=new Map(S);let et=0;S.forEach((je,H)=>{(typeof je=="string"?je:je.hex).toLowerCase()===Pe&&(ct.set(H,{hex:ee,originalHex:je.originalHex||Pe,editType:"blend",blendComponents:(Se==null?void 0:Se.components)||null}),et++)}),console.log("[TPV-STUDIO] Updated",et,"region overrides for derived blend color:",Pe,"->",ee),bn({...Xt,hex:ee,blendHex:ee}),await Qt(g,ee,ct);const Be=T.slice(0,M+1);Be.push(new Map(ct)),Be.length>50&&Be.shift(),Ge(ct),Ve(Be),k(Be.length-1)}else{const Pe=new Map(g);Pe.set(Xt.originalHex.toLowerCase(),{newHex:ee.toLowerCase(),recipe:Se,parts:ve}),ce(Pe),bn({...Xt,hex:ee,blendHex:ee}),await Qt(Pe,ee)}},[Xt,g,S,T,M,u,f]);const Qt=async(ee=null,ve=null,Se=null)=>{if(!(!(u!=null&&u.svg_url)||!f||!h))try{const Pe=new Map(f),ct=ee||g;ct.forEach((gt,De)=>{if(gt.newHex){const it=De.toLowerCase();Pe.set(it,{...Pe.get(it),blendHex:gt.newHex})}});const et=h.map(gt=>{const De=ct.get(gt.originalColor.hex.toLowerCase());if(De!=null&&De.newHex){const it={...gt,targetColor:{...gt.targetColor,hex:De.newHex},blendColor:{...gt.blendColor,hex:De.newHex}};return De.recipe&&De.recipe.components&&(it.chosenRecipe={...gt.chosenRecipe,components:De.recipe.components,deltaE:0,quality:"Excellent"}),it}return gt}),{svgText:Be,stats:je}=await ji(u.svg_url,Pe,E),H=Se!==null?Se:S,we=Io(Be,H);m&&m.startsWith("blob:")&&(URL.revokeObjectURL(m),console.log("[TPV-STUDIO] Revoked old blend blob URL"));const Ae=new Blob([we],{type:"image/svg+xml"}),dt=URL.createObjectURL(Ae);console.log("[TPV-STUDIO] Created new blend blob URL, SVG length:",we.length),fe(dt),W(Pe),z(et),console.log("[TPV-STUDIO] Blend SVG regenerated with edits:",je),H.size>0&&console.log("[TPV-STUDIO] Applied",H.size,"region overrides")}catch(Pe){console.error("[TPV-STUDIO] Failed to regenerate blend SVG:",Pe)}},Tn=async(ee=null,ve=null,Se=null)=>{if(!(!(u!=null&&u.svg_url)||!x||!v))try{const Pe=new Map(x),ct=ee||b;ct.forEach((gt,De)=>{if(gt.newHex){const it=De.toLowerCase();Pe.set(it,{...Pe.get(it),blendHex:gt.newHex})}});const et=v.map(gt=>{const De=ct.get(gt.originalColor.hex.toLowerCase());if(De!=null&&De.newHex){const it=fn.find(Nn=>Nn.hex.toLowerCase()===De.newHex.toLowerCase());return it?{...gt,targetColor:{...gt.targetColor,hex:De.newHex},blendColor:{hex:De.newHex,rgb:it.rgb,lab:it.lab},chosenRecipe:{components:[{code:it.code,name:it.name,hex:it.hex,rgb:it.rgb,lab:it.lab,ratio:1}],blendColor:{hex:it.hex,rgb:it.rgb,lab:it.lab},deltaE:0,quality:"Perfect"}}:{...gt,targetColor:{...gt.targetColor,hex:De.newHex},blendColor:{...gt.blendColor,hex:De.newHex}}}return gt}),{svgText:Be,stats:je}=await ji(u.svg_url,Pe,E),H=Se!==null?Se:S,we=Io(Be,H);y&&y.startsWith("blob:")&&(URL.revokeObjectURL(y),console.log("[TPV-STUDIO] Revoked old solid blob URL"));const Ae=new Blob([we],{type:"image/svg+xml"}),dt=URL.createObjectURL(Ae);console.log("[TPV-STUDIO] Created new solid blob URL, SVG length:",we.length),ke(dt),ne(Pe),ue(et),console.log("[TPV-STUDIO] Solid SVG regenerated with edits:",je),H.size>0&&console.log("[TPV-STUDIO] Applied",H.size,"region overrides")}catch(Pe){console.error("[TPV-STUDIO] Failed to regenerate solid SVG:",Pe)}},pi=ee=>{if(!(ee!=null&&ee.components))return null;const ve={};return ee.components.forEach(Se=>{Se.code&&Se.parts&&(ve[Se.code]=Se.parts)}),Object.keys(ve).length>0?{parts:ve}:null};O.useCallback(ee=>{var Se;if(!ee)return null;const ve=g.get((Se=ee.originalHex)==null?void 0:Se.toLowerCase());return ve!=null&&ve.recipe?ve.recipe:ee.isAddedFromEdit&&ee.chosenRecipe?pi(ee.chosenRecipe):ee.recipe||null},[g]);const As=async(ee,ve,Se,Pe,ct=null,et=null)=>{try{console.log("[INSPIRE] Regenerating blend SVG from state");const Be=new Map(ve);Pe&&Pe.size>0&&Pe.forEach((gt,De)=>{const it=De.toLowerCase();Be.has(it)&&Be.set(it,{...Be.get(it),blendHex:gt.newHex})});const{dataUrl:je,svgText:H}=await ji(ee,Be,ct);let we=H;et&&et.size>0&&(console.log("[INSPIRE] Applying",et.size,"region overrides to blend SVG"),we=Io(H,et));const Ae=new Blob([we],{type:"image/svg+xml"}),dt=URL.createObjectURL(Ae);fe(dt),console.log("[INSPIRE] Blend SVG regenerated")}catch(Be){console.error("[INSPIRE] Failed to regenerate blend SVG:",Be)}},sr=async(ee,ve,Se,Pe,ct=null,et=null)=>{try{console.log("[INSPIRE] Regenerating solid SVG from state");const Be=new Map(ve);Pe&&Pe.size>0&&Pe.forEach((gt,De)=>{const it=De.toLowerCase();Be.has(it)&&Be.set(it,{...Be.get(it),blendHex:gt.newHex})});const{dataUrl:je,svgText:H}=await ji(ee,Be,ct);let we=H;et&&et.size>0&&(console.log("[INSPIRE] Applying",et.size,"region overrides to solid SVG"),we=Io(H,et));const Ae=new Blob([we],{type:"image/svg+xml"}),dt=URL.createObjectURL(Ae);ke(dt),console.log("[INSPIRE] Solid SVG regenerated")}catch(Be){console.error("[INSPIRE] Failed to regenerate solid SVG:",Be)}};return o.jsxs("div",{className:`inspire-panel-recraft${n?" inspire-panel-recraft--embedded":""}`,children:[!n&&o.jsxs("div",{className:"panel-header",children:[o.jsx("h2",{children:"TPV Studio - Vector AI"}),o.jsx("p",{className:"subtitle",children:"AI-powered vector designs for playground surfacing"})]}),!u&&!U&&Or===!1&&o.jsxs("div",{className:"welcome-guidance",children:[o.jsx("div",{className:"welcome-icon",children:""}),o.jsx("h3",{children:"Create Your First Design"}),o.jsx("p",{children:"Choose how you'd like to create your TPV design below. You can describe what you want, upload an image to convert, or process an existing SVG file. Once generated, you'll be able to edit colours, export PDFs with specifications, and preview designs on-site."})]}),o.jsxs("div",{className:"input-mode-tabs",children:[o.jsxs("button",{className:`input-mode-tab ${s==="prompt"?"active":""}`,onClick:()=>{F("prompt"),se(null),Ee(null)},disabled:U,children:[o.jsxs("svg",{className:"mode-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M12 3l1.545 4.635L18.18 9.18l-4.635 1.545L12 15.36l-1.545-4.635L5.82 9.18l4.635-1.545L12 3z"}),o.jsx("path",{d:"M5 21l1.5-4.5L2 15l4.5-1.5L8 9l1.5 4.5L14 15l-4.5 1.5L8 21z",opacity:"0.5"})]}),o.jsx("span",{className:"mode-title",children:"Text Prompt"}),o.jsx("span",{className:"mode-description",children:"Describe your design"})]}),o.jsxs("button",{className:`input-mode-tab ${s==="upload"?"active":""}`,onClick:()=>{F("upload"),pe(""),Ee(null)},disabled:U,children:[o.jsxs("svg",{className:"mode-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),o.jsx("polyline",{points:"17 8 12 3 7 8"}),o.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),o.jsx("span",{className:"mode-title",children:"Upload Design"}),o.jsx("span",{className:"mode-description",children:"PNG, JPG, or SVG"})]})]}),o.jsxs("div",{className:"form-section",children:[s==="prompt"&&o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"prompt",children:"Design Description"}),o.jsx("textarea",{id:"prompt",value:i,onChange:ee=>pe(ee.target.value),placeholder:"e.g., calm ocean theme with big fish silhouettes and waves",rows:4,disabled:U,className:"prompt-input"}),o.jsx("p",{className:"helper-text",children:"Describe the design you want to generate. The AI will create a vector illustration based on your description. Perfect for creating completely new designs from scratch - just describe colors, themes, and elements you want."})]}),s==="upload"&&o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"design-upload",children:"Upload Design File"}),o.jsxs("div",{className:`drop-zone ${ye?"dragging":""} ${Y?"has-file":""}`,onDragEnter:Rs,onDragLeave:ps,onDragOver:di,onDrop:ts,children:[o.jsx("input",{id:"design-upload",type:"file",accept:".png,.jpg,.jpeg,.svg,image/png,image/jpeg,image/svg+xml",onChange:Ar,disabled:U,className:"file-input-hidden"}),o.jsx("label",{htmlFor:"design-upload",className:"drop-zone-content",children:Y?o.jsxs(o.Fragment,{children:[o.jsxs("svg",{className:"upload-icon success",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),o.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),o.jsx("span",{className:"file-name",children:Y.name}),o.jsx("span",{className:"file-type-badge",children:Ma(Y)==="svg"?"SVG - will process immediately":"Image - will vectorise with AI"}),o.jsx("span",{className:"drop-hint",children:"Click to change file"})]}):o.jsxs(o.Fragment,{children:[o.jsxs("svg",{className:"upload-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),o.jsx("polyline",{points:"17 8 12 3 7 8"}),o.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),o.jsx("span",{className:"drop-text",children:"Drag & drop your design here"}),o.jsx("span",{className:"drop-hint",children:"or click to browse"}),o.jsx("span",{className:"supported-formats",children:"PNG, JPG, or SVG"})]})})]}),o.jsxs("p",{className:"helper-text",children:["Upload your design file. ",o.jsx("strong",{children:"PNG/JPG"})," images will be vectorised with AI (~30 seconds). ",o.jsx("strong",{children:"SVG"})," files are processed immediately for TPV colour matching."]})]}),s==="prompt"&&o.jsxs("div",{className:"form-row",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"length",children:"Length (mm)"}),o.jsx("input",{id:"length",type:"number",value:a,onChange:ee=>$(parseInt(ee.target.value,10)),min:1e3,max:2e4,step:100,disabled:U})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"width",children:"Width (mm)"}),o.jsx("input",{id:"width",type:"number",value:l,onChange:ee=>P(parseInt(ee.target.value,10)),min:1e3,max:2e4,step:100,disabled:U})]})]}),He&&o.jsxs("div",{className:"error-message",children:[o.jsx("strong",{children:"Error:"})," ",He]}),B&&o.jsx("div",{className:"upload-progress",children:o.jsx("p",{children:B})}),o.jsx("button",{onClick:Mr,disabled:U||s==="prompt"&&!i.trim()||s==="upload"&&!Y,className:"generate-button",children:U?s==="upload"&&Y&&Ma(Y)==="svg"?"Processing...":"Generating...":s==="prompt"?"Generate Vector Design":Y&&Ma(Y)==="svg"?"Process SVG":"Vectorise & Process"})]}),U&&o.jsxs("div",{className:"progress-section",children:[o.jsx("div",{className:"progress-bar",children:o.jsx("div",{className:"progress-bar-fill"})}),o.jsx("p",{className:"progress-message",children:ie})]}),u&&!U&&o.jsxs("div",{className:"results-section",children:[c&&o.jsxs("div",{className:`ar-info ${c.layout.mode}`,children:[o.jsxs("div",{className:"ar-info-header",children:[o.jsx("strong",{children:"Layout:"})," ",c.layout.reason]}),o.jsxs("div",{className:"ar-info-details",children:[o.jsxs("span",{children:["Requested: ",c.user.formatted]}),o.jsx("span",{children:""}),o.jsxs("span",{children:["Generated: ",c.canonical.name," panel"]}),c.layout.mode==="framing"&&o.jsxs(o.Fragment,{children:[o.jsx("span",{children:""}),o.jsx("span",{className:"layout-note",children:"Panel centred with base colour surround"})]}),c.layout.mode==="tiling"&&o.jsxs(o.Fragment,{children:[o.jsx("span",{children:""}),o.jsx("span",{className:"layout-note",children:"Pattern will repeat along length"})]})]})]}),ki.BLEND_MODE_ENABLED,ki.BLEND_MODE_ENABLED,w==="solid"&&y&&v&&o.jsx("div",{ref:Dn,children:o.jsx(IP,{blendSvgUrl:y,recipes:Jt||v,mode:"solid",onColorClick:Os,onRegionClick:qi,onEyedropperCancel:Xi,onMakeTransparent:ui,onSelectTPVColor:En,selectedColor:ht,editedColors:b,onResetAll:jt,designName:Z,onNameChange:Q,isNameLoading:Ps,onInSituClick:Sn,eyedropperActive:de,eyedropperRegion:me,onRegionUndo:rr,onRegionRedo:Ki,canUndo:M>0,canRedo:M<T.length-1,regionOverridesCount:S.size})}),ki.BLEND_MODE_ENABLED,(m||y)&&o.jsxs("div",{className:"action-bar",children:[o.jsxs("button",{className:"action-bar__btn action-bar__btn--secondary",onClick:dn,title:"Start a new design",children:[o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M12 5v14M5 12h14"})}),"New"]}),o.jsxs("button",{className:"action-bar__btn action-bar__btn--primary",onClick:$r,title:"Save this design to your gallery",children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"}),o.jsx("polyline",{points:"17 21 17 13 7 13 7 21"}),o.jsx("polyline",{points:"7 3 7 8 15 8"})]}),"Save"]}),o.jsx(NW,{onExportSVG:er,onExportPNG:kn,onExportPDF:jn,onExportTiles:un,viewMode:w,exporting:tr,disabled:!(m||y)})]})]}),ki.BLEND_MODE_ENABLED,w==="solid"&&y&&v&&!_&&o.jsxs("div",{className:"finalize-section",children:[o.jsx("button",{onClick:()=>Ue(!0),className:"finalize-button",children:"View TPV Colours Used"}),o.jsx("p",{className:"finalize-hint",children:"See which pure TPV colours are used in this design"})]}),ki.BLEND_MODE_ENABLED,_&&v&&o.jsx($P,{recipes:Jt||v,onClose:()=>{Ue(!1)},isRecalculating:es}),nt&&ht&&o.jsx(K9,{color:ht,mode:w,onColorChange:hi,onClose:()=>{yt(!1),Fe(null)}}),Nr&&o.jsx(Q9,{currentState:{inputMode:s,prompt:i,selectedFile:Y,lengthMM:(cn==null?void 0:cn.height)||a,widthMM:(cn==null?void 0:cn.width)||l,result:u,viewMode:w,blendRecipes:h,solidRecipes:v,colorMapping:f,solidColorMapping:x,solidEditedColors:b,blendEditedColors:g,blendSvgUrl:m,solidSvgUrl:y,arMapping:c,jobId:p,inSituData:rn,regionOverrides:S,originalTaggedSvg:E},existingDesignId:N,initialName:Z,onClose:()=>{Jn(!1),Qr(null)},onSaved:(ee,ve)=>{Jn(!1),Qr(null),Qn(!0),ve&&Q(ve),e&&e(ve),console.log("[INSPIRE] Design saved:",ee)}}),qe&&o.jsx(s2,{designUrl:w==="solid"?y:m,designDimensions:{width:l,length:a},onClose:()=>kt(!1),onSaved:ee=>{console.log("[INSPIRE] In-situ preview saved:",ee),Ze(ee),kt(!1)}}),o.jsx(pW,{isOpen:Pr,onClose:()=>{_t(!1),Mt(null)},onConfirm:fs,aspectRatio:Ln,defaultLongestSide:5e3}),o.jsx("style",{jsx:!0,children:`
        .inspire-panel-recraft {
          max-width: var(--max-width-xl);
          margin: 0 auto;
          padding: var(--space-4);
        }

        .panel-header {
          text-align: center;
          margin-bottom: var(--space-6);
        }

        .panel-header h2 {
          font-family: var(--font-heading);
          font-size: var(--text-3xl);
          margin: 0 0 var(--space-2) 0;
          color: var(--color-primary);
          font-weight: var(--font-bold);
          letter-spacing: var(--tracking-tight);
        }

        .subtitle {
          color: var(--color-text-secondary);
          font-size: var(--text-base);
          line-height: var(--leading-relaxed);
        }

        /* Welcome Guidance */
        .welcome-guidance {
          background: linear-gradient(135deg, #fff5f0 0%, #fff9f7 100%);
          border: 2px solid #ff6b35;
          border-radius: var(--radius-lg);
          padding: var(--space-6);
          margin-bottom: var(--space-6);
          text-align: center;
        }

        .welcome-icon {
          font-size: 3rem;
          margin-bottom: var(--space-2);
        }

        .welcome-guidance h3 {
          margin: 0 0 var(--space-3);
          font-size: var(--text-xl);
          font-weight: var(--font-bold);
          color: var(--color-primary);
        }

        .welcome-guidance p {
          margin: 0;
          color: var(--color-text-secondary);
          font-size: var(--text-base);
          line-height: var(--leading-relaxed);
          max-width: 600px;
          margin-left: auto;
          margin-right: auto;
        }

        /* Input Mode Tabs - Enhanced cards */
        .input-mode-tabs {
          display: flex;
          gap: var(--space-2);
          margin-bottom: var(--space-3);
          background: var(--color-bg-subtle);
          padding: var(--space-1);
          border-radius: var(--radius-lg);
        }

        .input-mode-tab {
          flex: 1;
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: var(--space-1);
          padding: var(--space-3);
          background: var(--color-bg-card);
          border: 1px solid var(--color-border);
          border-radius: var(--radius-md);
          cursor: pointer;
          transition: all var(--transition-base);
        }

        .input-mode-tab:hover:not(:disabled) {
          border-color: var(--color-primary);
          transform: translateY(-2px);
          box-shadow: var(--shadow-md);
        }

        .input-mode-tab.active {
          background: linear-gradient(135deg, var(--color-bg-subtle) 0%, var(--color-bg-card) 100%);
          border-color: var(--color-primary);
          box-shadow: var(--shadow-glow);
        }

        .input-mode-tab:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .mode-icon {
          width: 28px;
          height: 28px;
          color: var(--color-text-secondary);
          transition: all var(--transition-base);
        }

        .input-mode-tab:hover:not(:disabled) .mode-icon {
          color: var(--color-primary);
          transform: scale(1.1);
        }

        .input-mode-tab.active .mode-icon {
          color: var(--color-primary);
        }

        .input-mode-tab .mode-title {
          font-family: var(--font-heading);
          font-size: var(--text-sm);
          font-weight: var(--font-semibold);
          color: var(--color-text-primary);
          margin-top: 0;
        }

        .input-mode-tab .mode-description {
          display: none; /* Hidden to save space */
        }

        .input-mode-tab.active .mode-title {
          color: var(--color-primary);
          font-weight: var(--font-bold);
        }

        /* Helper text */
        .helper-text {
          margin-top: var(--space-1);
          font-size: var(--text-sm);
          color: var(--color-text-tertiary);
          font-style: normal;
          line-height: var(--leading-snug);
        }

        /* Drag & Drop File Upload */
        .file-input-hidden {
          position: absolute;
          width: 1px;
          height: 1px;
          padding: 0;
          margin: -1px;
          overflow: hidden;
          clip: rect(0, 0, 0, 0);
          white-space: nowrap;
          border: 0;
        }

        .drop-zone {
          position: relative;
          width: 100%;
          min-height: 120px;
          border: 2px dashed var(--color-border);
          border-radius: var(--radius-lg);
          background: var(--color-bg-subtle);
          transition: all var(--transition-base);
        }

        .drop-zone.dragging {
          border-color: var(--color-primary);
          background: var(--color-primary-light);
          background: linear-gradient(135deg, rgba(30, 74, 122, 0.05) 0%, rgba(30, 74, 122, 0.1) 100%);
          box-shadow: var(--shadow-glow);
        }

        .drop-zone.has-file {
          border-color: var(--color-success);
          background: var(--color-success-light);
        }

        .drop-zone-content {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          gap: var(--space-1);
          padding: var(--space-4);
          cursor: pointer;
          min-height: 120px;
        }

        .upload-icon {
          width: 36px;
          height: 36px;
          color: var(--color-text-secondary);
          transition: all var(--transition-base);
        }

        .upload-icon.success {
          color: var(--color-success);
        }

        .drop-zone:hover .upload-icon {
          color: var(--color-primary);
          transform: scale(1.1);
        }

        .drop-zone.has-file:hover .upload-icon.success {
          color: var(--color-success);
        }

        .drop-text {
          font-size: var(--text-base);
          font-weight: var(--font-semibold);
          color: var(--color-text-primary);
        }

        .file-name {
          font-size: var(--text-base);
          font-weight: var(--font-semibold);
          color: var(--color-success);
          max-width: 100%;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
        }

        .drop-hint {
          font-size: var(--text-sm);
          color: var(--color-text-tertiary);
        }

        .file-type-badge {
          display: inline-block;
          font-size: var(--text-xs);
          color: var(--color-text-secondary);
          background: var(--color-bg-tertiary);
          padding: var(--space-1) var(--space-2);
          border-radius: var(--radius-sm);
          margin-top: var(--space-1);
        }

        .supported-formats {
          display: block;
          font-size: var(--text-xs);
          color: var(--color-text-tertiary);
          margin-top: var(--space-2);
          font-weight: var(--font-medium);
        }

        .drop-zone.dragging .drop-text,
        .drop-zone.dragging .drop-hint {
          color: var(--color-primary);
        }

        .upload-progress {
          padding: var(--space-2);
          background: var(--color-info-light);
          border: 1px solid var(--color-info);
          border-radius: var(--radius-md);
          color: var(--color-info);
          margin-bottom: var(--space-2);
          text-align: center;
          font-size: var(--text-sm);
        }

        .form-section {
          background: var(--color-bg-card);
          padding: var(--space-3);
          border-radius: var(--radius-lg);
          margin-bottom: var(--space-3);
          border: 1px solid var(--color-border);
          box-shadow: var(--shadow-xs);
        }

        .form-group {
          margin-bottom: var(--space-3);
        }

        .form-group label {
          display: block;
          margin-bottom: var(--space-2);
          font-weight: var(--font-semibold);
          color: var(--color-text-primary);
          font-size: var(--text-sm);
        }

        .prompt-input {
          width: 100%;
          padding: var(--space-3);
          border: 1px solid var(--color-border);
          border-radius: var(--radius-md);
          font-family: inherit;
          font-size: var(--text-base);
          background: var(--color-bg-card);
          color: var(--color-text-primary);
          transition: border-color var(--transition-base);
        }

        .prompt-input:focus {
          outline: none;
          border-color: var(--color-primary);
          box-shadow: var(--shadow-glow);
        }

        .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: var(--space-3);
        }

        input[type="number"] {
          width: 100%;
          padding: var(--space-2);
          border: 1px solid var(--color-border);
          border-radius: var(--radius-md);
          background: var(--color-bg-card);
          color: var(--color-text-primary);
          font-size: var(--text-base);
          transition: border-color var(--transition-base);
        }

        input[type="number"]:focus {
          outline: none;
          border-color: var(--color-primary);
          box-shadow: var(--shadow-glow);
        }

        .error-message {
          padding: var(--space-3);
          background: var(--color-error-light);
          border: 1px solid var(--color-error);
          border-radius: var(--radius-md);
          color: var(--color-error);
          margin-bottom: var(--space-4);
          font-size: var(--text-sm);
        }

        .generate-button {
          width: 100%;
          padding: var(--space-4);
          background: var(--color-accent);
          color: white;
          border: none;
          border-radius: var(--radius-md);
          font-size: var(--text-lg);
          font-weight: var(--font-semibold);
          cursor: pointer;
          transition: all var(--transition-base);
          box-shadow: var(--shadow-sm);
        }

        .generate-button:hover:not(:disabled) {
          background: var(--color-accent-hover);
          transform: translateY(-2px);
          box-shadow: 0 8px 24px rgba(255, 107, 53, 0.3);
        }

        .generate-button:disabled {
          background: var(--color-bg-subtle);
          color: var(--color-text-tertiary);
          cursor: not-allowed;
          transform: none;
          box-shadow: none;
        }

        .progress-section {
          padding: var(--space-4);
          background: var(--color-info-light);
          border-radius: var(--radius-lg);
          margin-bottom: var(--space-4);
          border: 1px solid var(--color-info);
        }

        .progress-bar {
          height: 4px;
          background: var(--color-border);
          border-radius: var(--radius-full);
          overflow: hidden;
          margin-bottom: var(--space-3);
        }

        .progress-bar-fill {
          height: 100%;
          background: var(--color-accent);
          animation: progress 2s ease-in-out infinite;
        }

        @keyframes progress {
          0% { transform: translateX(-100%); }
          100% { transform: translateX(100%); }
        }

        .progress-message {
          text-align: center;
          color: var(--color-text-secondary);
          font-weight: var(--font-medium);
          font-size: var(--text-base);
        }

        .results-section {
          background: var(--color-bg-card);
          padding: var(--space-4);
          border-radius: var(--radius-lg);
          border: 1px solid var(--color-border);
          box-shadow: var(--shadow-sm);
        }

        .results-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: var(--space-3);
        }

        .results-header h3 {
          font-family: var(--font-heading);
          margin: 0;
          color: var(--color-primary);
          font-size: var(--text-xl);
          font-weight: var(--font-bold);
        }

        /* Aspect Ratio Info */
        .ar-info {
          padding: var(--space-3) var(--space-4);
          border-radius: var(--radius-md);
          margin-bottom: var(--space-3);
          font-size: var(--text-sm);
        }

        .ar-info.full {
          background: var(--color-success-light);
          border: 1px solid var(--color-success);
        }

        .ar-info.framing {
          background: var(--color-warning-light);
          border: 1px solid var(--color-warning);
        }

        .ar-info.tiling {
          background: var(--color-info-light);
          border: 1px solid var(--color-info);
        }

        .ar-info-header {
          color: var(--color-text-primary);
          margin-bottom: var(--space-2);
          font-weight: var(--font-semibold);
        }

        .ar-info-details {
          display: flex;
          flex-wrap: wrap;
          gap: var(--space-2);
          align-items: center;
          color: var(--color-text-secondary);
          font-size: var(--text-sm);
        }

        .ar-info-details span {
          white-space: nowrap;
        }

        .layout-note {
          color: var(--color-accent);
          font-weight: var(--font-medium);
        }

        /* Mode Toggle Tabs */
        .mode-tabs {
          display: flex;
          gap: var(--space-2);
          margin-bottom: var(--space-3);
          background: var(--color-bg-subtle);
          padding: var(--space-1);
          border-radius: var(--radius-lg);
        }

        .mode-tab {
          flex: 1;
          display: flex;
          flex-direction: row;
          align-items: center;
          justify-content: center;
          gap: var(--space-2);
          padding: var(--space-2);
          background: var(--color-bg-card);
          border: 1px solid var(--color-border);
          border-radius: var(--radius-md);
          cursor: pointer;
          transition: all var(--transition-base);
        }

        .mode-tab:hover:not(:disabled) {
          border-color: var(--color-accent);
          transform: translateY(-2px);
          box-shadow: var(--shadow-md);
        }

        .mode-tab.active {
          background: var(--color-accent);
          border-color: var(--color-accent);
          box-shadow: var(--shadow-glow-accent);
        }

        .mode-tab:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .mode-title {
          font-family: var(--font-heading);
          font-size: var(--text-base);
          font-weight: var(--font-semibold);
          color: var(--color-primary);
        }

        .mode-description {
          display: none; /* Hidden to save space */
        }

        .mode-tab.active .mode-title {
          color: white;
          font-weight: var(--font-bold);
        }

        .svg-preview {
          margin: var(--space-2) 0;
          border: 1px solid var(--color-border);
          border-radius: var(--radius-md);
          background: var(--color-bg-subtle);
          padding: var(--space-2);
        }

        .design-preview {
          width: 100%;
          height: auto;
          display: block;
        }

        /* Finalize Section */
        .finalize-section {
          background: var(--color-accent-light);
          border: 2px solid var(--color-accent);
          border-radius: var(--radius-lg);
          padding: var(--space-3);
          margin-top: var(--space-3);
          text-align: center;
        }

        .finalize-button {
          width: 100%;
          max-width: 400px;
          padding: var(--space-3);
          background: var(--color-accent);
          color: white;
          border: none;
          border-radius: var(--radius-md);
          font-size: var(--text-base);
          font-weight: var(--font-semibold);
          cursor: pointer;
          transition: all var(--transition-base);
          box-shadow: var(--shadow-sm);
        }

        .finalize-button:hover {
          background: var(--color-accent-hover);
          transform: translateY(-1px);
          box-shadow: var(--shadow-md);
        }

        .finalize-hint {
          margin: var(--space-2) 0 0 0;
          color: var(--color-text-secondary);
          font-size: var(--text-xs);
        }

        /* Mixer Widget Container Styles */
        .mixer-widget-container {
          margin-top: var(--space-3);
          background: white;
          border-radius: 12px;
          padding: var(--space-3);
          box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .mixer-widget-header {
          display: flex;
          justify-content: flex-end;
          margin-bottom: var(--space-2);
          padding-bottom: var(--space-2);
          border-bottom: 2px solid var(--color-border);
        }

        .mixer-close-btn {
          padding: var(--space-2) var(--space-4);
          background: var(--color-primary);
          color: white;
          border: none;
          border-radius: 8px;
          font-weight: 600;
          font-size: var(--text-sm);
          cursor: pointer;
          transition: all 0.2s;
        }

        .mixer-close-btn:hover {
          background: #2563eb;
          box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
          transform: translateY(-1px);
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
          .inspire-panel-recraft {
            padding: var(--space-2);
          }

          .panel-header {
            margin-bottom: var(--space-4);
          }

          .panel-header h2 {
            font-size: var(--text-xl);
          }

          .subtitle {
            font-size: var(--text-sm);
          }

          .welcome-guidance {
            padding: var(--space-4);
            margin-bottom: var(--space-4);
          }

          .welcome-icon {
            font-size: 2rem;
          }

          .welcome-guidance h3 {
            font-size: var(--text-lg);
          }

          .welcome-guidance p {
            font-size: var(--text-sm);
          }

          /* Stack input mode tabs vertically on mobile */
          .input-mode-tabs {
            flex-direction: column;
            gap: var(--space-1);
          }

          .input-mode-tab {
            flex-direction: row;
            justify-content: flex-start;
            padding: var(--space-3);
            min-height: 44px;
          }

          .mode-icon {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
          }

          .input-mode-tab .mode-title {
            font-size: var(--text-sm);
            margin-top: 0;
          }

          .input-mode-tab .mode-description {
            display: none;
          }

          /* Form sections */
          .form-section {
            padding: var(--space-3);
          }

          .form-group label {
            font-size: var(--text-xs);
          }

          /* Stack form rows on mobile */
          .form-row {
            grid-template-columns: 1fr;
            gap: var(--space-2);
          }

          /* Drop zone adjustments */
          .drop-zone {
            min-height: 140px;
          }

          .drop-zone-content {
            padding: var(--space-4);
            min-height: 140px;
          }

          .upload-icon {
            width: 36px;
            height: 36px;
          }

          .drop-text {
            font-size: var(--text-sm);
          }

          /* Generate button */
          .generate-button {
            padding: var(--space-3);
            font-size: var(--text-base);
            min-height: 44px;
          }

          /* Results section - minimal padding for max image width */
          .results-section {
            padding: var(--space-2);
            border-radius: var(--radius-md);
          }

          .results-header h3 {
            font-size: var(--text-lg);
          }

          /* Mode tabs */
          .mode-tabs {
            flex-direction: column;
            gap: var(--space-1);
          }

          .mode-tab {
            flex-direction: row;
            justify-content: flex-start;
            padding: var(--space-3);
            min-height: 44px;
          }

          .mode-title {
            font-size: var(--text-sm);
          }

          .mode-description {
            display: none;
          }

          /* AR info */
          .ar-info {
            padding: var(--space-2) var(--space-3);
          }

          .ar-info-details {
            flex-direction: column;
            align-items: flex-start;
            gap: var(--space-1);
          }

          /* Finalize section */
          .finalize-section {
            padding: var(--space-3);
          }

          .finalize-button {
            padding: var(--space-3);
            font-size: var(--text-base);
          }
        }

        /* Extra small screens */
        @media (max-width: 480px) {
          .inspire-panel-recraft {
            padding: var(--space-1);
          }

          .panel-header h2 {
            font-size: var(--text-lg);
          }

          /* Results section - even less padding */
          .results-section {
            padding: var(--space-1);
            margin: 0 calc(-1 * var(--space-1));
            border-radius: 0;
          }

          .input-mode-tab {
            padding: var(--space-2);
          }

          .mode-tab {
            padding: var(--space-2);
          }
        }
      `})]})}function RW({isOpen:t,onClose:e}){const[n,r]=O.useState(!1),[s,i]=O.useState(!1),[a,l]=O.useState(!1),{addMotif:c}=lt(),d=vd(),{currentDesignId:u,blendSvgUrl:p,solidSvgUrl:h,designName:f}=d,m=p||h,g=!!u;O.useEffect(()=>{if(!t)return;const y=b=>{b.key==="Escape"&&e()};return window.addEventListener("keydown",y),()=>window.removeEventListener("keydown",y)},[t,e]),O.useEffect(()=>{t||(l(!1),r(!1),i(!1))},[t]);const v=O.useCallback((y,b)=>{console.log("[EDITOR] Design saved:",y,b),l(!1)},[]),x=async()=>{var y,b;if(!(!m||n)){r(!0);try{const{blendSvgUrl:w,solidSvgUrl:j,widthMM:_,lengthMM:S}=d;let E=null,T=null;if(j)try{E=await(await fetch(j)).text(),console.log("[EDITOR] Fetched solid SVG from blob:",E.length,"chars")}catch(I){console.error("[EDITOR] Failed to fetch solid SVG:",I)}if(w)try{T=await(await fetch(w)).text(),console.log("[EDITOR] Fetched blend SVG from blob:",T.length,"chars")}catch(I){console.error("[EDITOR] Failed to fetch blend SVG:",I)}if(!E&&!T)throw new Error("No SVG content available. Please ensure a design has been generated.");const Z=Ff(E||T);let N=_||5e3,G=S||5e3;if(Z){const I=Z.width/Z.height;I>1?(N=Math.max(_||5e3,5e3),G=N/I):(G=Math.max(S||5e3,5e3),N=G*I),console.log("[EDITOR] Using SVG aspect ratio:",I,"",N,"x",G,"mm")}i(!0);let C=u;const F=f||`Design ${new Date().toLocaleString("en-GB",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})}`,pe=t2(d);C=(await If({id:C||void 0,name:F,description:"",tags:[],design_data:pe,input_mode:d.inputMode})).design_id,d.setCurrentDesignId(C),d.setDesignName(F),i(!1);const J=((y=d.result)==null?void 0:y.thumb_url)||((b=d.result)==null?void 0:b.png_url)||null;c(C,F,E||T,N,G,J,{solidSvgContent:E,blendSvgContent:T,hasBothVersions:!!(E&&T)}),l(!0),setTimeout(()=>{e()},600)}catch(w){console.error("[EDITOR] Failed to add to canvas:",w),alert("Failed to add design to canvas: "+w.message),i(!1)}finally{r(!1)}}};return t?o.jsx("div",{className:"design-editor-overlay",children:o.jsxs("div",{className:"design-editor-modal",children:[o.jsxs("div",{className:"design-editor__header",children:[o.jsx("div",{className:"design-editor__title",children:o.jsx("h2",{children:"Design Editor"})}),o.jsx("div",{className:"design-editor__hint",children:"Generate a design with AI or upload your own SVG"}),o.jsx("button",{className:"design-editor__close",onClick:e,title:"Close (Esc)",children:o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),o.jsx("div",{className:"design-editor__content",children:o.jsx(PW,{onDesignSaved:v,isEmbedded:!0})}),o.jsx("div",{className:`design-editor__footer ${a?"design-editor__footer--success":""}`,children:a?o.jsxs("div",{className:"design-editor__success",children:[o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M20 6L9 17l-5-5"})}),o.jsx("span",{children:"Added to canvas!"})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"design-editor__status",children:m?g?o.jsxs("span",{className:"design-editor__saved-indicator",children:[o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M20 6L9 17l-5-5"})}),"Saved to library"]}):o.jsx("span",{className:"design-editor__unsaved-indicator",children:"Design ready  Will auto-save when added"}):o.jsx("span",{className:"design-editor__no-design",children:"Generate or upload a design to continue"})}),o.jsxs("div",{className:"design-editor__actions",children:[o.jsx("button",{className:"design-editor__btn design-editor__btn--secondary",onClick:e,children:"Cancel"}),o.jsx("button",{className:"design-editor__btn design-editor__btn--primary",onClick:x,disabled:!m||n,children:n?o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"design-editor__spinner"}),s?"Saving...":"Adding..."]}):o.jsxs(o.Fragment,{children:[o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),o.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"16"}),o.jsx("line",{x1:"8",y1:"12",x2:"16",y2:"12"})]}),"Add to Canvas"]})})]})]})})]})}):null}function OW(){const{addShape:t,addText:e,addExclusionZone:n,standaloneMode:r,startPathDrawing:s}=lt(),[i,a]=O.useState(!1);if(r)return null;const l=[{preset:"rectangle",icon:"",label:"Shape"},{preset:"blob",icon:"",label:"Blob"},{preset:"path",icon:"",label:"Pen"}],c=p=>{p==="path"?(s(),a(!1)):t(p)},d=()=>{e(),a(!1)},u=()=>{n("rectangle")};return o.jsxs("div",{className:`shape-toolbar ${i?"shape-toolbar--expanded":""}`,children:[o.jsxs("button",{className:"shape-toolbar__toggle",onClick:()=>a(!i),title:i?"Collapse elements panel":"Add elements",children:[o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("polygon",{points:"12 2 2 7 12 12 22 7 12 2"}),o.jsx("polyline",{points:"2 17 12 22 22 17"}),o.jsx("polyline",{points:"2 12 12 17 22 12"})]}),!i&&o.jsx("span",{className:"shape-toolbar__label",children:"Elements"})]}),i&&o.jsxs("div",{className:"shape-toolbar__shapes",children:[o.jsxs("button",{className:"shape-toolbar__btn shape-toolbar__btn--text",onClick:d,title:"Add Text Label",children:[o.jsx("span",{className:"shape-toolbar__icon",children:"T"}),o.jsx("span",{className:"shape-toolbar__name",children:"Text"})]}),o.jsx("div",{className:"shape-toolbar__divider"}),l.map(p=>o.jsxs("button",{className:"shape-toolbar__btn",onClick:()=>c(p.preset),title:`Add ${p.label}`,children:[o.jsx("span",{className:"shape-toolbar__icon",children:p.icon}),o.jsx("span",{className:"shape-toolbar__name",children:p.label})]},p.preset)),o.jsx("div",{className:"shape-toolbar__divider"}),o.jsxs("button",{className:"shape-toolbar__btn shape-toolbar__btn--exclusion",onClick:u,title:"Add Exclusion Zone (building, planter, obstacle)",children:[o.jsx("span",{className:"shape-toolbar__icon",style:{fontSize:"1rem"},children:""}),o.jsx("span",{className:"shape-toolbar__name",children:"Exclusion"})]})]})]})}function AW({loadedDesign:t}){var Xe,tt,nt,yt,ht,Fe,de,te,me,Ye,xt,Ce,wt,pt,Ct,Ke,Xt,bn,Nr,Jn,Ps;const[e,n]=O.useState(!1),[r,s]=O.useState(()=>{const be=lt.getState().surface;return be!=null&&be.width_mm?String(be.width_mm/1e3):"50"}),[i,a]=O.useState(()=>{const be=lt.getState().surface;return be!=null&&be.length_mm?String(be.length_mm/1e3):"50"}),[l,c]=O.useState(!1),[d,u]=O.useState(!1),[p,h]=O.useState(!1),[f,m]=O.useState(!1),[g,v]=O.useState(!1),[x,y]=O.useState(null),[b,w]=O.useState(!1),[j,_]=O.useState(null),[S,E]=O.useState(""),[T,M]=O.useState(!1),Z=O.useRef(null);O.useEffect(()=>{if(t){const be=t.design_data||{},qe=t.input_mode||be.input_mode||be.blend_recipes||be.solid_recipes,kt=be.courts||be.surface||be.tracks;if(console.log("[TPV] Design detection:",{id:t.id,name:t.name,hasDesignData:!!t.design_data,topLevelInputMode:t.input_mode,isPlaygroundDesign:qe,isSportsDesign:kt}),qe&&!kt){console.log("[TPV] Loading playground design into editor:",t.id,t.name);const rn=Ap(t),Ze=vd.getState();Ze.loadDesign(rn),t.name&&Ze.setDesignName(t.name),Ze.setCurrentDesignId(t.id),m(!0)}else t.design_data?(console.log("[SPORTS] Loading design from prop:",t.id,t.name),lt.getState().loadDesign(be),_(t.id),E(t.name||""),n(!1)):console.warn("[TPV] Design has no design_data and is not a playground design:",t.id,t.name)}},[t]);const{surface:N,courts:G,tracks:C,selectedCourtId:F,selectedTrackId:pe,selectedMotifId:V,selectedShapeId:J,selectedTextId:I,selectedGroupId:K,selectedElementIds:z,showCourtLibrary:W,showPropertiesPanel:fe,toggleCourtLibrary:ue,togglePropertiesPanel:ne,setSurfaceDimensions:ke,setSurfaceColor:ce,setSurfaceBoundaryPreset:$e,resetSurfaceBoundary:ze,updateBoundaryParams:Ue,resetDesign:Ge,hasUnsavedChanges:at,standaloneMode:Ve,toggleStandaloneMode:k,groupSelected:Q,ungroup:oe,alignElements:D,distributeElements:P,mobileLibraryOpen:$,mobilePropertiesOpen:Y,mobileColoursOpen:se,mobileActiveTab:B,setMobileLibraryOpen:re,setMobilePropertiesOpen:ye,setMobileColoursOpen:le,setMobileActiveTab:U,closeMobileSheets:ae}=lt(),xe=be=>{be.preventDefault();const qe=parseFloat(r)*1e3,kt=parseFloat(i)*1e3;qe>0&&kt>0&&(ke(qe,kt),n(!1))},Te=be=>{ce({tpv_code:be.code,hex:be.hex,name:be.name}),c(!1)},He=()=>{at()&&!window.confirm(`Start a new design?

You have unsaved changes that will be lost.`)||(Ge(),_(null),E(""),s("50"),a("50"))},Ee=()=>{const be=Z.current||document.querySelector(".court-canvas__svg");if(!be){alert("Canvas not ready");return}const qe=lt.getState().exportDesignData(),kt=Hf(be,qe),rn=new Blob([kt],{type:"image/svg+xml"}),Ze=URL.createObjectURL(rn);x&&URL.revokeObjectURL(x),y(Ze),v(!0)},ie=()=>{v(!1),x&&(URL.revokeObjectURL(x),y(null))},he=async be=>{if(!be){alert("Source design ID not found");return}try{const qe=await Ol(be),kt=(qe==null?void 0:qe.design)||qe;if(!kt)throw new Error("Design not found");const rn=Ap(kt),Ze=vd.getState();Ze.loadDesign(rn),kt.name&&Ze.setDesignName(kt.name),Ze.setCurrentDesignId(be),m(!0),console.log("[TPV] Loaded source design for editing:",kt.name)}catch(qe){console.error("[TPV] Failed to load source design:",qe),alert("Failed to load design: "+qe.message)}};return O.useEffect(()=>{if(!T)return;const be=()=>M(!1);return document.addEventListener("click",be),()=>document.removeEventListener("click",be)},[T]),O.useEffect(()=>{const be=qe=>{const kt=qe.target.tagName.toLowerCase();if(kt==="input"||kt==="textarea"||kt==="select")return;const{removeCourt:rn,removeTrack:Ze,removeMotif:Pr,removeShape:_t,removeText:Ln,deselectCourt:ft,deselectTrack:Kt,deselectMotif:Mt,deselectShape:cn,deselectText:Qr,stopEditingText:hs,undo:Rr,redo:Jt,canUndo:wn,canRedo:es,duplicateCourt:_n,duplicateMotif:Or,duplicateShape:Qn,duplicateText:Dn,updateCourtPosition:xr,updateTrackPosition:Ar,updateMotifPosition:Rs,updateShapePosition:ps,updateTextPosition:di,courts:ts,tracks:Mr,motifs:er,shapes:In,texts:fs,selectedMotifId:Sn,selectedShapeId:kn,selectedTextId:dn,editingTextId:$r,elementOrder:tr,setElementOrder:zn,toggleSnapToGrid:jn,snapToGrid:nr,addToHistory:un}=lt.getState(),Cn=F||pe||Sn||kn||dn;if(qe.key==="Delete"&&Cn&&!$r&&(qe.preventDefault(),F?rn(F):pe?Ze(pe):Sn?Pr(Sn):kn?_t(kn):dn&&Ln(dn)),qe.key==="Escape"&&($r?hs():Cn&&(F?ft():pe?Kt():Sn?Mt():kn?cn():dn&&Qr())),(qe.ctrlKey||qe.metaKey)&&qe.key==="z"&&!qe.shiftKey&&(qe.preventDefault(),wn()&&Rr()),(qe.ctrlKey||qe.metaKey)&&qe.key==="z"&&qe.shiftKey&&(qe.preventDefault(),es()&&Jt()),(qe.ctrlKey||qe.metaKey)&&qe.key==="d"&&Cn&&(qe.preventDefault(),F?_n(F):Sn?Or(Sn):kn?Qn(kn):dn&&Dn(dn)),Cn&&!$r&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(qe.key)){qe.preventDefault();const $t=qe.shiftKey?10:100;let jt=0,mn=0;if(qe.key==="ArrowLeft"&&(jt=-$t),qe.key==="ArrowRight"&&(jt=$t),qe.key==="ArrowUp"&&(mn=-$t),qe.key==="ArrowDown"&&(mn=$t),F){const Nt=ts[F];Nt&&(xr(F,{x:Nt.position.x+jt,y:Nt.position.y+mn}),un())}else if(pe){const Nt=Mr[pe];Nt&&(Ar(pe,{x:Nt.position.x+jt,y:Nt.position.y+mn}),un())}else if(Sn){const Nt=er[Sn];Nt&&(Rs(Sn,{x:Nt.position.x+jt,y:Nt.position.y+mn}),un())}else if(kn){const Nt=In[kn];Nt&&(ps(kn,{x:Nt.position.x+jt,y:Nt.position.y+mn}),un())}else if(dn){const Nt=fs[dn];Nt&&(di(dn,{x:Nt.position.x+jt,y:Nt.position.y+mn}),un())}}if(Cn&&(qe.key==="["||qe.key==="]")){qe.preventDefault();const $t=tr.indexOf(Cn);if($t===-1)return;const jt=[...tr];qe.key==="["&&$t>0?([jt[$t],jt[$t-1]]=[jt[$t-1],jt[$t]],zn(jt),un()):qe.key==="]"&&$t<tr.length-1&&([jt[$t],jt[$t+1]]=[jt[$t+1],jt[$t]],zn(jt),un())}(qe.key==="g"||qe.key==="G")&&(qe.preventDefault(),jn()),(qe.key==="?"||qe.shiftKey&&qe.key==="/")&&(qe.preventDefault(),h(!0))};return window.addEventListener("keydown",be),()=>window.removeEventListener("keydown",be)},[F,pe,V,J,I]),o.jsxs("div",{className:"sports-designer",children:[e&&o.jsx("div",{className:"sports-designer__modal-overlay",onClick:()=>n(!1),children:o.jsxs("div",{className:"sports-designer__modal",onClick:be=>be.stopPropagation(),children:[o.jsx("h2",{children:"Edit Surface Size"}),o.jsx("p",{children:"Adjust the dimensions of your sports surface"}),o.jsxs("form",{onSubmit:xe,children:[o.jsxs("div",{className:"sports-designer__dimension-inputs",children:[o.jsxs("div",{className:"sports-designer__input-group",children:[o.jsx("label",{htmlFor:"width",children:"Width (metres)"}),o.jsx("input",{id:"width",type:"number",min:"5",max:"100",step:"0.5",value:r,onChange:be=>s(be.target.value),required:!0,autoFocus:!0})]}),o.jsx("span",{className:"sports-designer__dimension-separator",children:""}),o.jsxs("div",{className:"sports-designer__input-group",children:[o.jsx("label",{htmlFor:"length",children:"Length (metres)"}),o.jsx("input",{id:"length",type:"number",min:"5",max:"100",step:"0.5",value:i,onChange:be=>a(be.target.value),required:!0})]})]}),o.jsx("p",{className:"sports-designer__dimension-hint",children:"Common sizes: 37m  34m (tennis), 40m  20m (futsal), 50m  50m (multi-sport)"}),o.jsxs("div",{className:"sports-designer__boundary-section",children:[o.jsx("label",{htmlFor:"boundary-shape",children:"Surface Shape"}),o.jsxs("div",{className:"sports-designer__boundary-options",children:[o.jsxs("select",{id:"boundary-shape",value:((Xe=N.boundary)==null?void 0:Xe.type)||"rectangle",onChange:be=>{const qe=be.target.value;qe==="rectangle"?ze():$e(qe)},className:"sports-designer__select",children:[o.jsx("option",{value:"rectangle",children:"Rectangle (default)"}),o.jsx("option",{value:"l-shape",children:"L-Shape"}),o.jsx("option",{value:"u-shape",children:"U-Shape"}),o.jsx("option",{value:"t-shape",children:"T-Shape"})]}),((tt=N.boundary)==null?void 0:tt.type)&&N.boundary.type!=="rectangle"&&o.jsx("button",{type:"button",className:"sports-designer__btn-secondary",onClick:ze,title:"Reset to rectangle",children:"Reset"})]}),((nt=N.boundary)==null?void 0:nt.type)==="l-shape"&&o.jsxs("div",{className:"sports-designer__boundary-params",children:[o.jsxs("div",{className:"sports-designer__param-row",children:[o.jsxs("label",{children:["Cut Width: ",Math.round((((yt=N.boundary.params)==null?void 0:yt.cutWidth)||.6)*100),"%"]}),o.jsx("input",{type:"range",min:"20",max:"80",value:(((ht=N.boundary.params)==null?void 0:ht.cutWidth)||.6)*100,onChange:be=>Ue({cutWidth:parseInt(be.target.value)/100})})]}),o.jsxs("div",{className:"sports-designer__param-row",children:[o.jsxs("label",{children:["Cut Height: ",Math.round((((Fe=N.boundary.params)==null?void 0:Fe.cutHeight)||.4)*100),"%"]}),o.jsx("input",{type:"range",min:"20",max:"80",value:(((de=N.boundary.params)==null?void 0:de.cutHeight)||.4)*100,onChange:be=>Ue({cutHeight:parseInt(be.target.value)/100})})]})]}),((te=N.boundary)==null?void 0:te.type)==="u-shape"&&o.jsxs("div",{className:"sports-designer__boundary-params",children:[o.jsxs("div",{className:"sports-designer__param-row",children:[o.jsxs("label",{children:["Cut Start: ",Math.round((((me=N.boundary.params)==null?void 0:me.cutStart)||.35)*100),"%"]}),o.jsx("input",{type:"range",min:"10",max:"45",value:(((Ye=N.boundary.params)==null?void 0:Ye.cutStart)||.35)*100,onChange:be=>Ue({cutStart:parseInt(be.target.value)/100})})]}),o.jsxs("div",{className:"sports-designer__param-row",children:[o.jsxs("label",{children:["Cut End: ",Math.round((((xt=N.boundary.params)==null?void 0:xt.cutEnd)||.65)*100),"%"]}),o.jsx("input",{type:"range",min:"55",max:"90",value:(((Ce=N.boundary.params)==null?void 0:Ce.cutEnd)||.65)*100,onChange:be=>Ue({cutEnd:parseInt(be.target.value)/100})})]}),o.jsxs("div",{className:"sports-designer__param-row",children:[o.jsxs("label",{children:["Cut Height: ",Math.round((((wt=N.boundary.params)==null?void 0:wt.cutHeight)||.4)*100),"%"]}),o.jsx("input",{type:"range",min:"20",max:"80",value:(((pt=N.boundary.params)==null?void 0:pt.cutHeight)||.4)*100,onChange:be=>Ue({cutHeight:parseInt(be.target.value)/100})})]})]}),((Ct=N.boundary)==null?void 0:Ct.type)==="t-shape"&&o.jsxs("div",{className:"sports-designer__boundary-params",children:[o.jsxs("div",{className:"sports-designer__param-row",children:[o.jsxs("label",{children:["Stem Start: ",Math.round((((Ke=N.boundary.params)==null?void 0:Ke.stemStart)||.3)*100),"%"]}),o.jsx("input",{type:"range",min:"10",max:"45",value:(((Xt=N.boundary.params)==null?void 0:Xt.stemStart)||.3)*100,onChange:be=>Ue({stemStart:parseInt(be.target.value)/100})})]}),o.jsxs("div",{className:"sports-designer__param-row",children:[o.jsxs("label",{children:["Stem End: ",Math.round((((bn=N.boundary.params)==null?void 0:bn.stemEnd)||.7)*100),"%"]}),o.jsx("input",{type:"range",min:"55",max:"90",value:(((Nr=N.boundary.params)==null?void 0:Nr.stemEnd)||.7)*100,onChange:be=>Ue({stemEnd:parseInt(be.target.value)/100})})]}),o.jsxs("div",{className:"sports-designer__param-row",children:[o.jsxs("label",{children:["Bar Height: ",Math.round((((Jn=N.boundary.params)==null?void 0:Jn.stemHeight)||.4)*100),"%"]}),o.jsx("input",{type:"range",min:"20",max:"80",value:(((Ps=N.boundary.params)==null?void 0:Ps.stemHeight)||.4)*100,onChange:be=>Ue({stemHeight:parseInt(be.target.value)/100})})]})]}),o.jsx("p",{className:"sports-designer__boundary-hint",children:"Non-rectangular shapes are useful for L-shaped buildings or irregular sites"})]}),o.jsx("button",{type:"submit",className:"sports-designer__btn-primary",children:"Update Surface"})]})]})}),o.jsxs(o.Fragment,{children:[o.jsxs("header",{className:"sports-designer__mobile-header",children:[o.jsx("span",{className:"sports-designer__mobile-header-title",children:"TPV Designer"}),o.jsxs("div",{className:"sports-designer__mobile-header-actions",children:[o.jsx("button",{className:"sports-designer__mobile-header-btn",onClick:()=>{s(String(N.width_mm/1e3)),a(String(N.length_mm/1e3)),n(!0)},title:"Surface settings",children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"12",cy:"12",r:"3"}),o.jsx("path",{d:"M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"})]})}),o.jsx(hy,{svgRef:Z,mobileMode:!0})]})]}),o.jsxs("nav",{className:"sports-designer__mobile-action-bar",children:[o.jsxs("button",{className:`sports-designer__mobile-action-btn ${$?"sports-designer__mobile-action-btn--active":""}`,onClick:()=>{ae(),re(!0)},children:[o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"12",cy:"12",r:"10"}),o.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"16"}),o.jsx("line",{x1:"8",y1:"12",x2:"16",y2:"12"})]}),o.jsx("span",{children:"Add"})]}),o.jsxs("button",{className:"sports-designer__mobile-action-btn",onClick:()=>{ae(),le(!0)},children:[o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"13.5",cy:"6.5",r:"2.5"}),o.jsx("circle",{cx:"17.5",cy:"10.5",r:"2.5"}),o.jsx("circle",{cx:"8.5",cy:"7.5",r:"2.5"}),o.jsx("circle",{cx:"6.5",cy:"12.5",r:"2.5"})]}),o.jsx("span",{children:"Colours"})]}),o.jsxs("button",{className:`sports-designer__mobile-action-btn ${F||pe||V||J||I?"":"sports-designer__mobile-action-btn--disabled"}`,onClick:()=>{(F||pe||V||J||I)&&(ae(),ye(!0))},disabled:!F&&!pe&&!V&&!J&&!I,children:[o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"4",y1:"21",x2:"4",y2:"14"}),o.jsx("line",{x1:"4",y1:"10",x2:"4",y2:"3"}),o.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"12"}),o.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"3"}),o.jsx("line",{x1:"20",y1:"21",x2:"20",y2:"16"}),o.jsx("line",{x1:"20",y1:"12",x2:"20",y2:"3"}),o.jsx("line",{x1:"1",y1:"14",x2:"7",y2:"14"}),o.jsx("line",{x1:"9",y1:"8",x2:"15",y2:"8"}),o.jsx("line",{x1:"17",y1:"16",x2:"23",y2:"16"})]}),o.jsx("span",{children:"Properties"})]}),o.jsxs("button",{className:"sports-designer__mobile-action-btn",onClick:()=>u(!0),children:[o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"}),o.jsx("polyline",{points:"17 21 17 13 7 13 7 21"}),o.jsx("polyline",{points:"7 3 7 8 15 8"})]}),o.jsx("span",{children:"Save"})]})]}),o.jsx("div",{className:`sports-designer__bottom-sheet-overlay ${$?"sports-designer__bottom-sheet-overlay--open":""}`,onClick:()=>re(!1)}),o.jsxs("div",{className:`sports-designer__bottom-sheet ${$?"sports-designer__bottom-sheet--open":""}`,children:[o.jsx("div",{className:"sports-designer__bottom-sheet-handle"}),o.jsxs("div",{className:"sports-designer__bottom-sheet-header",children:[o.jsx("h3",{children:"Add Element"}),o.jsx("button",{className:"sports-designer__bottom-sheet-close",onClick:()=>re(!1),children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),o.jsxs("div",{className:"sports-designer__mobile-tabs",children:[o.jsx("button",{className:`sports-designer__mobile-tab ${B==="courts"?"sports-designer__mobile-tab--active":""}`,onClick:()=>U("courts"),children:"Courts"}),o.jsx("button",{className:`sports-designer__mobile-tab ${B==="tracks"?"sports-designer__mobile-tab--active":""}`,onClick:()=>U("tracks"),children:"Tracks"}),o.jsx("button",{className:`sports-designer__mobile-tab ${B==="shapes"?"sports-designer__mobile-tab--active":""}`,onClick:()=>U("shapes"),children:"Shapes"}),o.jsx("button",{className:`sports-designer__mobile-tab ${B==="designs"?"sports-designer__mobile-tab--active":""}`,onClick:()=>U("designs"),children:"Designs"})]}),o.jsx("div",{className:"sports-designer__bottom-sheet-content",children:o.jsx(P1,{mobileMode:!0,activeTab:B,onItemAdded:()=>re(!1),onOpenGenerator:()=>{re(!1),m(!0)}})})]}),o.jsx("div",{className:`sports-designer__bottom-sheet-overlay ${se?"sports-designer__bottom-sheet-overlay--open":""}`,onClick:()=>le(!1)}),o.jsxs("div",{className:`sports-designer__bottom-sheet ${se?"sports-designer__bottom-sheet--open":""}`,children:[o.jsx("div",{className:"sports-designer__bottom-sheet-handle"}),o.jsxs("div",{className:"sports-designer__bottom-sheet-header",children:[o.jsx("h3",{children:"Surface Colour"}),o.jsx("button",{className:"sports-designer__bottom-sheet-close",onClick:()=>le(!1),children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),o.jsx("div",{className:"sports-designer__bottom-sheet-content",children:o.jsx("div",{className:"sports-designer__color-grid",children:fn.map(be=>o.jsx("button",{className:`sports-designer__color-swatch ${N.color.tpv_code===be.code?"sports-designer__color-swatch--selected":""}`,style:{backgroundColor:be.hex},onClick:()=>{Te(be),le(!1)},title:`${be.code} - ${be.name}`,children:o.jsx("span",{className:"sports-designer__color-code",children:be.code})},be.code))})})]}),o.jsx("div",{className:`sports-designer__bottom-sheet-overlay ${Y?"sports-designer__bottom-sheet-overlay--open":""}`,onClick:()=>ye(!1)}),o.jsxs("div",{className:`sports-designer__bottom-sheet ${Y?"sports-designer__bottom-sheet--open":""}`,children:[o.jsx("div",{className:"sports-designer__bottom-sheet-handle"}),o.jsxs("div",{className:"sports-designer__bottom-sheet-header",children:[o.jsx("h3",{children:"Properties"}),o.jsx("button",{className:"sports-designer__bottom-sheet-close",onClick:()=>ye(!1),children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),o.jsx("div",{className:"sports-designer__bottom-sheet-content",children:(F||pe||V||J||I)&&o.jsx(ny,{mobileMode:!0,onEditSourceDesign:he})})]}),o.jsxs("div",{className:"sports-designer__content",children:[!Ve&&o.jsxs("aside",{className:`sports-designer__sidebar ${W?"":"sports-designer__sidebar--collapsed"}`,children:[o.jsxs("div",{className:"sidebar-content",children:[o.jsx("div",{className:"sidebar-add-element",children:o.jsxs("button",{className:"sidebar-add-element__btn",onClick:()=>w(!0),children:[o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"12",cy:"12",r:"10"}),o.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"16"}),o.jsx("line",{x1:"8",y1:"12",x2:"16",y2:"12"})]}),"Add Courts & Designs"]})}),o.jsx(tT,{})]}),o.jsx("button",{className:"sidebar-toggle sidebar-toggle--left",onClick:ue,title:W?"Collapse panel":"Expand panel",children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:W?o.jsx("polyline",{points:"15 18 9 12 15 6"}):o.jsx("polyline",{points:"9 18 15 12 9 6"})})})]}),o.jsxs("main",{className:"sports-designer__canvas-container",children:[o.jsxs("div",{className:"sports-toolbar",children:[o.jsxs("div",{className:"sports-toolbar__group",children:[o.jsx("button",{className:`sports-toolbar__btn ${W?"sports-toolbar__btn--active":""}`,onClick:ue,title:"Element Library",disabled:Ve,children:o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),o.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),o.jsx("rect",{x:"3",y:"14",width:"7",height:"7"}),o.jsx("rect",{x:"14",y:"14",width:"7",height:"7"})]})}),o.jsx("button",{className:`sports-toolbar__btn ${fe&&(F||pe||V||J||I)?"sports-toolbar__btn--active":""}`,onClick:ne,title:"Properties",disabled:!F&&!pe&&!V&&!J&&!I||Ve,children:o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("line",{x1:"4",y1:"21",x2:"4",y2:"14"}),o.jsx("line",{x1:"4",y1:"10",x2:"4",y2:"3"}),o.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"12"}),o.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"3"}),o.jsx("line",{x1:"20",y1:"21",x2:"20",y2:"16"}),o.jsx("line",{x1:"20",y1:"12",x2:"20",y2:"3"}),o.jsx("line",{x1:"1",y1:"14",x2:"7",y2:"14"}),o.jsx("line",{x1:"9",y1:"8",x2:"15",y2:"8"}),o.jsx("line",{x1:"17",y1:"16",x2:"23",y2:"16"})]})})]}),o.jsx("div",{className:"sports-toolbar__divider"}),o.jsx("div",{className:"sports-toolbar__group",children:o.jsx("button",{className:`sports-toolbar__mode-toggle ${Ve?"sports-toolbar__mode-toggle--active":""}`,onClick:k,title:Ve?"Switch to Edit Mode":"Switch to Focus Mode",children:Ve?o.jsxs(o.Fragment,{children:[o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"})}),o.jsx("span",{children:"Focus"})]}):o.jsxs(o.Fragment,{children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),o.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),o.jsx("rect",{x:"3",y:"14",width:"7",height:"7"}),o.jsx("rect",{x:"14",y:"14",width:"7",height:"7"})]}),o.jsx("span",{children:"Edit"})]})})}),o.jsx("div",{className:"sports-toolbar__divider"}),o.jsxs("div",{className:"sports-toolbar__group",children:[o.jsxs("button",{className:"sports-toolbar__dimensions",onClick:()=>{s(String(N.width_mm/1e3)),a(String(N.length_mm/1e3)),n(!0)},title:"Click to edit surface size",children:[(N.width_mm/1e3).toFixed(0),"m  ",(N.length_mm/1e3).toFixed(0),"m"]}),o.jsx("button",{className:"sports-toolbar__color-swatch",style:{backgroundColor:N.color.hex},onClick:()=>c(!0),title:`${N.color.name} (${N.color.tpv_code}) - Click to change`})]}),o.jsx("div",{className:"sports-toolbar__divider"}),o.jsxs("div",{className:"sports-toolbar__group",children:[o.jsx("button",{className:"sports-toolbar__btn",disabled:!lt.getState().canUndo(),onClick:()=>lt.getState().undo(),title:"Undo (Ctrl+Z)",children:o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("path",{d:"M3 7v6h6"}),o.jsx("path",{d:"M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"})]})}),o.jsx("button",{className:"sports-toolbar__btn",disabled:!lt.getState().canRedo(),onClick:()=>lt.getState().redo(),title:"Redo (Ctrl+Shift+Z)",children:o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("path",{d:"M21 7v6h-6"}),o.jsx("path",{d:"M3 17a9 9 0 019-9 9 9 0 016 2.3l3 2.7"})]})})]}),(z.length>=2||K)&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"sports-toolbar__divider"}),o.jsxs("div",{className:"sports-toolbar__group",children:[z.length>=2&&o.jsx("button",{className:"sports-toolbar__btn",onClick:Q,title:"Group selected elements (Cmd+G)",children:o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1"}),o.jsx("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1"}),o.jsx("path",{d:"M10 7h4"}),o.jsx("path",{d:"M10 17h4"}),o.jsx("path",{d:"M7 10v4"}),o.jsx("path",{d:"M17 10v4"})]})}),K&&o.jsx("button",{className:"sports-toolbar__btn",onClick:()=>oe(K),title:"Ungroup (Cmd+Shift+G)",children:o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1"}),o.jsx("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1"}),o.jsx("path",{d:"M10 7h4",strokeDasharray:"2 2"}),o.jsx("path",{d:"M10 17h4",strokeDasharray:"2 2"}),o.jsx("path",{d:"M7 10v4",strokeDasharray:"2 2"}),o.jsx("path",{d:"M17 10v4",strokeDasharray:"2 2"})]})})]}),z.length>=2&&o.jsxs("div",{className:"sports-toolbar__align-dropdown",style:{position:"relative"},children:[o.jsx("button",{className:`sports-toolbar__btn ${T?"sports-toolbar__btn--active":""}`,onClick:()=>M(!T),title:"Align elements",children:o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("line",{x1:"21",y1:"10",x2:"3",y2:"10"}),o.jsx("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),o.jsx("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),o.jsx("line",{x1:"21",y1:"18",x2:"3",y2:"18"})]})}),T&&o.jsxs("div",{className:"sports-toolbar__align-menu",style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"4px",background:"white",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"8px",zIndex:100,minWidth:"120px"},onClick:be=>be.stopPropagation(),children:[o.jsx("div",{style:{fontSize:"10px",color:"#666",padding:"4px 8px",textTransform:"uppercase",fontWeight:600},children:"Align"}),o.jsx("button",{style:{display:"flex",alignItems:"center",gap:"8px",width:"100%",padding:"6px 8px",border:"none",background:"transparent",cursor:"pointer",borderRadius:"4px",fontSize:"12px"},onClick:()=>{D("left"),M(!1)},onMouseOver:be=>be.currentTarget.style.background="#f1f5f9",onMouseOut:be=>be.currentTarget.style.background="transparent",children:" Left"}),o.jsx("button",{style:{display:"flex",alignItems:"center",gap:"8px",width:"100%",padding:"6px 8px",border:"none",background:"transparent",cursor:"pointer",borderRadius:"4px",fontSize:"12px"},onClick:()=>{D("center"),M(!1)},onMouseOver:be=>be.currentTarget.style.background="#f1f5f9",onMouseOut:be=>be.currentTarget.style.background="transparent",children:" Center"}),o.jsx("button",{style:{display:"flex",alignItems:"center",gap:"8px",width:"100%",padding:"6px 8px",border:"none",background:"transparent",cursor:"pointer",borderRadius:"4px",fontSize:"12px"},onClick:()=>{D("right"),M(!1)},onMouseOver:be=>be.currentTarget.style.background="#f1f5f9",onMouseOut:be=>be.currentTarget.style.background="transparent",children:" Right"}),o.jsx("div",{style:{height:"1px",background:"#e5e7eb",margin:"4px 0"}}),o.jsx("button",{style:{display:"flex",alignItems:"center",gap:"8px",width:"100%",padding:"6px 8px",border:"none",background:"transparent",cursor:"pointer",borderRadius:"4px",fontSize:"12px"},onClick:()=>{D("top"),M(!1)},onMouseOver:be=>be.currentTarget.style.background="#f1f5f9",onMouseOut:be=>be.currentTarget.style.background="transparent",children:" Top"}),o.jsx("button",{style:{display:"flex",alignItems:"center",gap:"8px",width:"100%",padding:"6px 8px",border:"none",background:"transparent",cursor:"pointer",borderRadius:"4px",fontSize:"12px"},onClick:()=>{D("middle"),M(!1)},onMouseOver:be=>be.currentTarget.style.background="#f1f5f9",onMouseOut:be=>be.currentTarget.style.background="transparent",children:" Middle"}),o.jsx("button",{style:{display:"flex",alignItems:"center",gap:"8px",width:"100%",padding:"6px 8px",border:"none",background:"transparent",cursor:"pointer",borderRadius:"4px",fontSize:"12px"},onClick:()=>{D("bottom"),M(!1)},onMouseOver:be=>be.currentTarget.style.background="#f1f5f9",onMouseOut:be=>be.currentTarget.style.background="transparent",children:" Bottom"}),z.length>=3&&o.jsxs(o.Fragment,{children:[o.jsx("div",{style:{height:"1px",background:"#e5e7eb",margin:"4px 0"}}),o.jsx("div",{style:{fontSize:"10px",color:"#666",padding:"4px 8px",textTransform:"uppercase",fontWeight:600},children:"Distribute"}),o.jsx("button",{style:{display:"flex",alignItems:"center",gap:"8px",width:"100%",padding:"6px 8px",border:"none",background:"transparent",cursor:"pointer",borderRadius:"4px",fontSize:"12px"},onClick:()=>{P("horizontal"),M(!1)},onMouseOver:be=>be.currentTarget.style.background="#f1f5f9",onMouseOut:be=>be.currentTarget.style.background="transparent",children:" Horizontal"}),o.jsx("button",{style:{display:"flex",alignItems:"center",gap:"8px",width:"100%",padding:"6px 8px",border:"none",background:"transparent",cursor:"pointer",borderRadius:"4px",fontSize:"12px"},onClick:()=>{P("vertical"),M(!1)},onMouseOver:be=>be.currentTarget.style.background="#f1f5f9",onMouseOut:be=>be.currentTarget.style.background="transparent",children:" Vertical"})]})]})]})]}),o.jsx("div",{className:"sports-toolbar__divider"}),o.jsxs("div",{className:"sports-toolbar__group",children:[o.jsx("button",{className:"sports-toolbar__btn",onClick:He,title:"Start new design",children:o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),o.jsx("polyline",{points:"14 2 14 8 20 8"}),o.jsx("line",{x1:"12",y1:"18",x2:"12",y2:"12"}),o.jsx("line",{x1:"9",y1:"15",x2:"15",y2:"15"})]})}),o.jsx("button",{className:"sports-toolbar__btn",onClick:Ee,title:"View In-Situ Preview",children:o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),o.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),o.jsx("polyline",{points:"21 15 16 10 5 21"})]})}),o.jsx("button",{className:"sports-toolbar__btn",onClick:()=>h(!0),title:"Keyboard shortcuts (?)",children:o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("circle",{cx:"12",cy:"12",r:"10"}),o.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),o.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]})}),o.jsx("button",{className:"sports-toolbar__btn-primary",onClick:()=>u(!0),children:"Save"}),o.jsx(hy,{svgRef:Z})]})]}),o.jsx(C5,{ref:Z}),o.jsx(OW,{})]}),(F||pe||V||J||I)&&!Ve&&o.jsxs("aside",{className:`sports-designer__properties ${fe?"":"sports-designer__properties--collapsed"}`,children:[o.jsx("button",{className:"sidebar-toggle sidebar-toggle--right",onClick:ne,title:fe?"Collapse properties":"Expand properties",children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:fe?o.jsx("polyline",{points:"9 18 15 12 9 6"}):o.jsx("polyline",{points:"15 18 9 12 15 6"})})}),o.jsx("div",{className:"sidebar-content",children:o.jsx(ny,{onEditSourceDesign:he})})]})]}),l&&o.jsx("div",{className:"sports-designer__color-modal-overlay",onClick:()=>c(!1),children:o.jsxs("div",{className:"sports-designer__color-modal",onClick:be=>be.stopPropagation(),children:[o.jsxs("div",{className:"sports-designer__color-modal-header",children:[o.jsx("h4",{children:"Select Surface Colour"}),o.jsx("button",{onClick:()=>c(!1),children:""})]}),o.jsx("div",{className:"sports-designer__color-grid",children:fn.map(be=>o.jsx("button",{className:`sports-designer__color-swatch ${N.color.tpv_code===be.code?"sports-designer__color-swatch--selected":""}`,style:{backgroundColor:be.hex},onClick:()=>Te(be),title:`${be.code} - ${be.name}`,children:o.jsx("span",{className:"sports-designer__color-code",children:be.code})},be.code))})]})}),d&&o.jsx(hT,{existingDesignId:j,initialName:S,svgRef:Z,onClose:()=>u(!1),onSaved:(be,qe)=>{_(be.design_id),E(qe),console.log("[SPORTS] Design saved:",be.design_id)}}),o.jsx(AP,{isOpen:p,onClose:()=>h(!1)}),o.jsx(q5,{isOpen:b,onClose:()=>w(!1),onOpenGenerator:()=>m(!0)}),o.jsx(RW,{isOpen:f,onClose:()=>m(!1)}),g&&x&&o.jsx(s2,{designUrl:x,designDimensions:{width:N.width_mm,length:N.length_mm},onClose:ie,onSaved:be=>{console.log("[TPV] In-situ preview saved:",be),ie()}})]})]})}function MW({onShowDesigns:t,onShowAdmin:e,isAdmin:n,currentDesignName:r}){const[s,i]=O.useState(!1),a=async()=>{confirm("Sign out?")&&(await Vr.signOut(),window.location.reload())};return o.jsx("header",{className:"studio-header",children:o.jsxs("div",{className:"header-content",children:[o.jsxs("div",{className:"header-left",children:[o.jsx("h1",{className:"studio-title",children:"TPV Designer"}),r&&o.jsxs("span",{className:"current-design-indicator",children:[o.jsx("svg",{width:"4",height:"4",viewBox:"0 0 4 4",children:o.jsx("circle",{cx:"2",cy:"2",r:"2",fill:"currentColor"})}),r]})]}),o.jsxs("div",{className:"header-right",children:[o.jsxs("button",{onClick:t,className:"btn-my-designs",children:[o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"}),o.jsx("path",{d:"M9 22V12h6v10"})]}),"My Designs"]}),n&&o.jsxs("button",{onClick:e,className:"btn-admin",children:[o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M12 15a3 3 0 100-6 3 3 0 000 6z"}),o.jsx("path",{d:"M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"})]}),"Admin"]}),o.jsxs("div",{className:"user-menu",children:[o.jsx("button",{onClick:()=>i(!s),className:"user-menu-button",children:o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"}),o.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}),s&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"user-menu-backdrop",onClick:()=>i(!1)}),o.jsx("div",{className:"user-menu-dropdown",children:o.jsxs("button",{onClick:a,className:"menu-item sign-out",children:[o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9"})}),"Sign Out"]})})]})]})]})]})})}function $W({design:t,onLoad:e,onDelete:n,onUpdateMetadata:r}){var m;const[s,i]=O.useState(!1),[a,l]=O.useState(!1),c=async()=>{if(confirm(`Delete "${t.name}"? This cannot be undone.`)){l(!0);try{await n(t.id)}catch(g){console.error("Failed to delete design:",g),alert(`Failed to delete: ${g.message}`),l(!1)}}},d=g=>{const v=new Date(g),x=new Date,y=x-v,b=Math.floor(y/(1e3*60*60*24));return b===0?"Today":b===1?"Yesterday":b<7?`${b} days ago`:b<30?`${Math.floor(b/7)} weeks ago`:v.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:v.getFullYear()!==x.getFullYear()?"numeric":void 0})},u=t.input_mode==="sports_surface"||((m=t.design_data)==null?void 0:m.type)==="sports_surface",p=t.thumbnail_url||t.original_png_url||t.original_svg_url,f=u?{label:"Surface",icon:"",className:"type-surface"}:{label:"Motif",icon:"",className:"type-motif"};return o.jsxs("div",{className:`design-card ${a?"deleting":""}`,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:[o.jsxs("div",{className:`design-type-badge ${f.className}`,children:[o.jsx("span",{className:"type-icon",children:f.icon}),o.jsx("span",{className:"type-label",children:f.label})]}),o.jsxs("div",{className:"card-thumbnail",onClick:()=>e(t.id),children:[p?o.jsx("img",{src:p,alt:t.name}):o.jsx("div",{className:"no-thumbnail",children:o.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),o.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),o.jsx("polyline",{points:"21 15 16 10 5 21"})]})}),s&&o.jsx("div",{className:"thumbnail-overlay",children:o.jsx("button",{className:"btn-load",children:"Open"})})]}),o.jsxs("div",{className:"card-info",children:[o.jsx("h3",{className:"design-name",title:t.name,children:t.name}),t.description&&o.jsx("p",{className:"design-description",title:t.description,children:t.description}),o.jsxs("div",{className:"card-meta",children:[t.projects&&o.jsx("span",{className:"project-badge",style:{backgroundColor:t.projects.color||"#1a365d"},title:t.projects.name,children:t.projects.name}),o.jsx("span",{className:"design-date",title:new Date(t.updated_at).toLocaleString(),children:d(t.updated_at)})]}),t.tags&&t.tags.length>0&&o.jsxs("div",{className:"design-tags",children:[t.tags.slice(0,3).map((g,v)=>o.jsx("span",{className:"tag",children:g},v)),t.tags.length>3&&o.jsxs("span",{className:"tag more",children:["+",t.tags.length-3]})]})]}),s&&!a&&o.jsxs("div",{className:"card-actions",children:[o.jsx("button",{onClick:()=>e(t.id),className:"action-btn load-btn",title:"Load design",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),o.jsx("circle",{cx:"12",cy:"12",r:"3"})]})}),o.jsx("button",{onClick:c,className:"action-btn delete-btn",title:"Delete design",children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})})})]}),a&&o.jsx("div",{className:"deleting-overlay",children:o.jsx("div",{className:"spinner"})})]})}function LW({onClose:t,onLoadDesign:e}){const[n,r]=O.useState([]),[s,i]=O.useState([]),[a,l]=O.useState(!0),[c,d]=O.useState(null),[u,p]=O.useState(""),[h,f]=O.useState(""),[m,g]=O.useState(!1),[v,x]=O.useState(!1);O.useEffect(()=>{y()},[u,h]);const y=async()=>{l(!0),d(null);try{const[_,S]=await Promise.all([Bf(),yd({project_id:u||void 0,search:h||void 0,limit:12,offset:0})]);i(_.projects),r(S.designs),g(S.pagination.has_more)}catch(_){console.error("Failed to load designs:",_),d(_.message)}finally{l(!1)}},b=async()=>{if(!(v||!m)){x(!0);try{const _=await yd({project_id:u||void 0,search:h||void 0,limit:12,offset:n.length});r([...n,..._.designs]),g(_.pagination.has_more)}catch(_){console.error("Failed to load more designs:",_),d(_.message)}finally{x(!1)}}},w=async _=>{try{const{design:S}=await Ol(_);e(S),t()}catch(S){console.error("Failed to load design:",S),alert(`Failed to load design: ${S.message}`)}},j=async _=>{try{await xE(_),r(n.filter(S=>S.id!==_))}catch(S){throw console.error("Failed to delete design:",S),S}};return o.jsx("div",{className:"modal-overlay",onClick:t,children:o.jsxs("div",{className:"modal-content design-gallery-modal",onClick:_=>_.stopPropagation(),children:[o.jsxs("div",{className:"modal-header",children:[o.jsx("h2",{children:"My Designs"}),o.jsx("button",{onClick:t,className:"close-button",children:""})]}),o.jsxs("div",{className:"gallery-filters",children:[o.jsx("div",{className:"filter-group",children:o.jsx("input",{type:"text",placeholder:"Search designs...",value:h,onChange:_=>f(_.target.value),className:"search-input"})}),o.jsx("div",{className:"filter-group",children:o.jsxs("select",{value:u,onChange:_=>p(_.target.value),className:"project-filter",children:[o.jsx("option",{value:"",children:"All Projects"}),s.map(_=>o.jsxs("option",{value:_.id,children:[_.name," (",_.design_count,")"]},_.id))]})})]}),o.jsxs("div",{className:"modal-body",children:[c&&o.jsxs("div",{className:"error-message",children:[c,o.jsx("button",{onClick:y,className:"btn-retry",children:"Retry"})]}),a?o.jsxs("div",{className:"loading-state",children:[o.jsx("div",{className:"spinner-large"}),o.jsx("p",{children:"Loading your designs..."})]}):n.length===0?o.jsxs("div",{className:"empty-state",children:[o.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{d:"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"}),o.jsx("path",{d:"M17 21v-8H7v8M7 3v5h8"})]}),o.jsx("h3",{children:"No designs yet"}),o.jsx("p",{children:h||u?"No designs match your filters. Try adjusting your search.":"Create your first design to see it here!"})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"designs-grid",children:n.map(_=>o.jsx($W,{design:_,onLoad:w,onDelete:j},_.id))}),m&&o.jsx("div",{className:"load-more-section",children:o.jsx("button",{onClick:b,className:"btn-load-more",disabled:v,children:v?"Loading...":"Load More"})})]})]})]})})}function DW(){const[t,e]=O.useState([]),[n,r]=O.useState(0),[s,i]=O.useState(!1),[a,l]=O.useState(null),[c,d]=O.useState("all"),[u,p]=O.useState("all"),[h,f]=O.useState(""),[m,g]=O.useState(0),v=50,x=async()=>{var E,T;const _=await an.auth.getSession();return{"Content-Type":"application/json",Authorization:`Bearer ${(T=(E=_==null?void 0:_.data)==null?void 0:E.session)==null?void 0:T.access_token}`}},y=async()=>{i(!0),l(null);try{const _=await x(),S=new URLSearchParams({limit:v.toString(),offset:m.toString()});c!=="all"&&S.append("status",c),u!=="all"&&S.append("saved_status",u),h&&S.append("search",h);const E=await fetch(`/api/admin/jobs?${S.toString()}`,{headers:_}),T=await E.json();if(!E.ok)throw new Error(T.error||"Failed to fetch jobs");e(T.jobs),r(T.total)}catch(_){console.error("Failed to fetch jobs:",_),l(_.message)}finally{i(!1)}};O.useEffect(()=>{y()},[c,u,h,m]);const b=t.filter(_=>_.status==="completed").length,w=t.filter(_=>!_.is_saved&&_.status==="completed").length,j=t.filter(_=>_.is_saved).length;return o.jsxs("div",{className:"generations-tab",children:[o.jsxs("div",{className:"admin-stats-grid",children:[o.jsxs("div",{className:"admin-stat-card",children:[o.jsx("h3",{children:"Total Generations"}),o.jsx("p",{className:"stat-value",children:n}),o.jsx("span",{className:"stat-label",children:"All time"})]}),o.jsxs("div",{className:"admin-stat-card",children:[o.jsx("h3",{children:"Completed"}),o.jsx("p",{className:"stat-value",children:b}),o.jsx("span",{className:"stat-label",children:"Current page"})]}),o.jsxs("div",{className:"admin-stat-card success",children:[o.jsx("h3",{children:"Saved"}),o.jsx("p",{className:"stat-value",children:j}),o.jsx("span",{className:"stat-label",children:" Linked to designs"})]}),o.jsxs("div",{className:"admin-stat-card warning",children:[o.jsx("h3",{children:"Orphaned"}),o.jsx("p",{className:"stat-value",children:w}),o.jsx("span",{className:"stat-label",children:" Not saved"})]})]}),o.jsxs("div",{className:"admin-filters",children:[o.jsxs("div",{className:"filter-group",children:[o.jsx("label",{children:"Status:"}),o.jsxs("select",{value:c,onChange:_=>d(_.target.value),children:[o.jsx("option",{value:"all",children:"All"}),o.jsx("option",{value:"completed",children:"Completed"}),o.jsx("option",{value:"failed",children:"Failed"}),o.jsx("option",{value:"running",children:"Running"}),o.jsx("option",{value:"queued",children:"Queued"})]})]}),o.jsxs("div",{className:"filter-group",children:[o.jsx("label",{children:"Saved:"}),o.jsxs("select",{value:u,onChange:_=>p(_.target.value),children:[o.jsx("option",{value:"all",children:"All"}),o.jsx("option",{value:"saved",children:"Saved only"}),o.jsx("option",{value:"orphaned",children:"Orphaned only"})]})]}),o.jsxs("div",{className:"filter-group search",children:[o.jsx("label",{children:"Search prompt:"}),o.jsx("input",{type:"text",placeholder:"Search in prompts...",value:h,onChange:_=>f(_.target.value)})]})]}),s&&o.jsxs("div",{className:"admin-loading",children:[o.jsx("div",{className:"spinner"}),o.jsx("p",{children:"Loading jobs..."})]}),a&&o.jsx("div",{className:"admin-error",children:o.jsxs("p",{children:["Error: ",a]})}),!s&&t.length>0&&o.jsx("div",{className:"jobs-table-container",children:o.jsxs("table",{className:"jobs-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Thumbnail"}),o.jsx("th",{children:"Prompt"}),o.jsx("th",{children:"Dimensions"}),o.jsx("th",{children:"Status"}),o.jsx("th",{children:"Saved"}),o.jsx("th",{children:"User"}),o.jsx("th",{children:"Created"})]})}),o.jsx("tbody",{children:t.map(_=>o.jsxs("tr",{className:`job-row ${_.is_saved?"saved":"orphaned"} ${_.status}`,children:[o.jsx("td",{className:"thumbnail-cell",children:_.thumbnail_url?o.jsx("img",{src:_.thumbnail_url,alt:"Design",className:"job-thumbnail"}):o.jsx("div",{className:"thumbnail-placeholder",children:"No image"})}),o.jsx("td",{className:"prompt-cell",children:o.jsx("div",{className:"prompt-text",title:_.prompt,children:_.prompt||o.jsx("em",{children:"No prompt"})})}),o.jsx("td",{className:"dimensions-cell",children:_.width_mm&&_.length_mm?o.jsxs("span",{children:[_.width_mm,"  ",_.length_mm," mm"]}):o.jsx("em",{children:"N/A"})}),o.jsx("td",{className:"status-cell",children:o.jsx("span",{className:`status-badge ${_.status}`,children:_.status})}),o.jsx("td",{className:"saved-cell",children:_.is_saved?o.jsx("span",{className:"saved-badge",children:" Saved"}):o.jsx("span",{className:"orphaned-badge",children:" Orphaned"})}),o.jsx("td",{className:"user-cell",children:_.user_email}),o.jsx("td",{className:"date-cell",children:new Date(_.created_at).toLocaleDateString()})]},_.id))})]})}),!s&&t.length===0&&o.jsx("div",{className:"admin-empty",children:o.jsx("p",{children:"No jobs found matching your filters."})}),n>v&&o.jsxs("div",{className:"admin-pagination",children:[o.jsx("button",{onClick:()=>g(Math.max(0,m-v)),disabled:m===0,children:"Previous"}),o.jsxs("span",{children:["Showing ",m+1," to ",Math.min(m+v,n)," of ",n]}),o.jsx("button",{onClick:()=>g(m+v),disabled:m+v>=n,children:"Next"})]}),o.jsx("style",{children:`
        .jobs-table-container {
          overflow-x: auto;
          background: white;
          border-radius: 8px;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .jobs-table {
          width: 100%;
          border-collapse: collapse;
        }

        .jobs-table th {
          background: #f9fafb;
          padding: 1rem;
          text-align: left;
          font-weight: 600;
          font-size: 0.875rem;
          color: #374151;
          border-bottom: 1px solid #e5e7eb;
        }

        .jobs-table td {
          padding: 1rem;
          border-bottom: 1px solid #e5e7eb;
        }

        .job-row.saved {
          background: rgba(16, 185, 129, 0.03);
        }

        .job-row.orphaned {
          background: rgba(245, 158, 11, 0.03);
        }

        .thumbnail-cell {
          width: 80px;
        }

        .job-thumbnail {
          width: 64px;
          height: 64px;
          object-fit: cover;
          border-radius: 4px;
        }

        .thumbnail-placeholder {
          width: 64px;
          height: 64px;
          background: #f3f4f6;
          border-radius: 4px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 0.75rem;
          color: #9ca3af;
        }

        .prompt-cell {
          max-width: 300px;
        }

        .prompt-text {
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }

        .status-badge {
          display: inline-block;
          padding: 0.25rem 0.75rem;
          border-radius: 9999px;
          font-size: 0.75rem;
          font-weight: 500;
        }

        .status-badge.completed {
          background: #d1fae5;
          color: #065f46;
        }

        .status-badge.failed {
          background: #fee2e2;
          color: #991b1b;
        }

        .status-badge.running {
          background: #dbeafe;
          color: #1e40af;
        }

        .status-badge.queued {
          background: #e0e7ff;
          color: #3730a3;
        }

        .saved-badge {
          color: #059669;
          font-weight: 500;
        }

        .orphaned-badge {
          color: #d97706;
          font-weight: 500;
        }

        .user-cell {
          font-size: 0.875rem;
          color: #6b7280;
        }

        .date-cell {
          font-size: 0.875rem;
          color: #6b7280;
          white-space: nowrap;
        }

        .admin-stat-card.success {
          border-left: 4px solid #10b981;
        }

        .admin-stat-card.warning {
          border-left: 4px solid #f59e0b;
        }
      `})]})}function IW(){const[t,e]=O.useState([]),[n,r]=O.useState(null),[s,i]=O.useState(!1),[a,l]=O.useState(null),[c,d]=O.useState(!1),[u,p]=O.useState(new Set),[h,f]=O.useState("all"),m=async()=>{var _,S;const w=await an.auth.getSession();return{"Content-Type":"application/json",Authorization:`Bearer ${(S=(_=w==null?void 0:w.data)==null?void 0:_.session)==null?void 0:S.access_token}`}},g=async()=>{i(!0),l(null);try{const w=await m(),j=new URLSearchParams;h!=="all"&&j.append("age_filter",h);const _=await fetch(`/api/admin/recovery/orphaned?${j.toString()}`,{headers:w}),S=await _.json();if(!_.ok)throw new Error(S.error||"Failed to fetch orphaned jobs");e(S.orphaned_jobs),r(S.age_buckets)}catch(w){console.error("Failed to fetch orphaned jobs:",w),l(w.message)}finally{i(!1)}};O.useEffect(()=>{g()},[h]);const v=w=>{const j=new Set(u);j.has(w)?j.delete(w):j.add(w),p(j)},x=()=>{p(new Set(t.map(w=>w.id)))},y=()=>{p(new Set)},b=async()=>{if(u.size===0){alert("Please select at least one job to recover");return}if(confirm(`Recover ${u.size} orphaned ${u.size===1?"design":"designs"}?`)){d(!0),l(null);try{const w=await m(),j=await fetch("/api/admin/recovery/create",{method:"POST",headers:w,body:JSON.stringify({job_ids:Array.from(u)})}),_=await j.json();if(!j.ok)throw new Error(_.error||"Failed to recover designs");alert(`Successfully recovered ${_.recovered_count} ${_.recovered_count===1?"design":"designs"}!`),y(),await g()}catch(w){console.error("Failed to recover designs:",w),l(w.message),alert(`Recovery failed: ${w.message}`)}finally{d(!1)}}};return o.jsxs("div",{className:"recovery-tab",children:[o.jsxs("div",{className:"admin-stats-grid",children:[o.jsxs("div",{className:"admin-stat-card warning",children:[o.jsx("h3",{children:"Total Orphaned"}),o.jsx("p",{className:"stat-value",children:t.length}),o.jsx("span",{className:"stat-label",children:"Designs not saved"})]}),n&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"admin-stat-card",children:[o.jsx("h3",{children:"<24 hours"}),o.jsx("p",{className:"stat-value",children:n["<24h"]}),o.jsx("span",{className:"stat-label",children:"Recent"})]}),o.jsxs("div",{className:"admin-stat-card",children:[o.jsx("h3",{children:"1-7 days"}),o.jsx("p",{className:"stat-value",children:n["1-7d"]}),o.jsx("span",{className:"stat-label",children:"This week"})]}),o.jsxs("div",{className:"admin-stat-card",children:[o.jsx("h3",{children:">7 days"}),o.jsx("p",{className:"stat-value",children:n["7-30d"]+n[">30d"]}),o.jsx("span",{className:"stat-label",children:"Older"})]})]})]}),o.jsxs("div",{className:"recovery-controls",children:[o.jsx("div",{className:"admin-filters",children:o.jsxs("div",{className:"filter-group",children:[o.jsx("label",{children:"Age:"}),o.jsxs("select",{value:h,onChange:w=>f(w.target.value),children:[o.jsx("option",{value:"all",children:"All"}),o.jsx("option",{value:"24h",children:"<24 hours"}),o.jsx("option",{value:"7d",children:"<7 days"}),o.jsx("option",{value:"30d",children:"<30 days"})]})]})}),o.jsxs("div",{className:"bulk-actions",children:[o.jsx("button",{onClick:x,className:"btn-secondary",children:"Select All"}),o.jsxs("button",{onClick:y,className:"btn-secondary",children:["Clear (",u.size,")"]}),o.jsx("button",{onClick:b,disabled:u.size===0||c,className:"btn-primary",children:c?"Recovering...":`Recover Selected (${u.size})`})]})]}),s&&o.jsxs("div",{className:"admin-loading",children:[o.jsx("div",{className:"spinner"}),o.jsx("p",{children:"Loading orphaned jobs..."})]}),a&&o.jsx("div",{className:"admin-error",children:o.jsxs("p",{children:["Error: ",a]})}),!s&&t.length>0&&o.jsx("div",{className:"recovery-table-container",children:o.jsxs("table",{className:"recovery-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:"40px"},children:o.jsx("input",{type:"checkbox",checked:u.size===t.length,onChange:w=>w.target.checked?x():y()})}),o.jsx("th",{children:"Thumbnail"}),o.jsx("th",{children:"Prompt / Auto-name"}),o.jsx("th",{children:"Dimensions"}),o.jsx("th",{children:"Age"}),o.jsx("th",{children:"User"})]})}),o.jsx("tbody",{children:t.map(w=>o.jsxs("tr",{className:u.has(w.id)?"selected":"",onClick:()=>v(w.id),children:[o.jsx("td",{onClick:j=>j.stopPropagation(),children:o.jsx("input",{type:"checkbox",checked:u.has(w.id),onChange:()=>v(w.id)})}),o.jsx("td",{className:"thumbnail-cell",children:w.thumbnail_url?o.jsx("img",{src:w.thumbnail_url,alt:"Design",className:"job-thumbnail"}):o.jsx("div",{className:"thumbnail-placeholder",children:"No image"})}),o.jsxs("td",{className:"prompt-cell",children:[o.jsx("div",{className:"prompt-text",title:w.prompt,children:w.auto_name}),w.prompt&&w.prompt.length>50&&o.jsx("div",{className:"prompt-full",children:w.prompt})]}),o.jsx("td",{className:"dimensions-cell",children:w.width_mm&&w.length_mm?o.jsxs("span",{children:[w.width_mm,"  ",w.length_mm," mm"]}):o.jsx("em",{children:"N/A"})}),o.jsx("td",{className:"age-cell",children:o.jsxs("span",{className:`age-badge ${w.age_bucket.replace(/[<>]/g,"")}`,children:[w.age_days," ",w.age_days===1?"day":"days"]})}),o.jsx("td",{className:"user-cell",children:w.user_email})]},w.id))})]})}),!s&&t.length===0&&o.jsx("div",{className:"admin-empty",children:o.jsx("p",{children:"No orphaned jobs found. All designs have been saved!"})}),o.jsx("style",{children:`
        .recovery-controls {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1.5rem;
          flex-wrap: wrap;
          gap: 1rem;
        }

        .bulk-actions {
          display: flex;
          gap: 0.5rem;
        }

        .btn-primary {
          padding: 0.5rem 1rem;
          background: #ff6b35;
          color: white;
          border: none;
          border-radius: 4px;
          font-weight: 500;
          cursor: pointer;
        }

        .btn-primary:hover:not(:disabled) {
          background: #e55a2b;
        }

        .btn-primary:disabled {
          background: #d1d5db;
          cursor: not-allowed;
        }

        .btn-secondary {
          padding: 0.5rem 1rem;
          background: white;
          color: #374151;
          border: 1px solid #d1d5db;
          border-radius: 4px;
          font-weight: 500;
          cursor: pointer;
        }

        .btn-secondary:hover {
          background: #f9fafb;
        }

        .recovery-table-container {
          overflow-x: auto;
          background: white;
          border-radius: 8px;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .recovery-table {
          width: 100%;
          border-collapse: collapse;
        }

        .recovery-table th {
          background: #f9fafb;
          padding: 1rem;
          text-align: left;
          font-weight: 600;
          font-size: 0.875rem;
          color: #374151;
          border-bottom: 1px solid #e5e7eb;
        }

        .recovery-table td {
          padding: 1rem;
          border-bottom: 1px solid #e5e7eb;
        }

        .recovery-table tbody tr {
          cursor: pointer;
          transition: background 0.15s;
        }

        .recovery-table tbody tr:hover {
          background: #f9fafb;
        }

        .recovery-table tbody tr.selected {
          background: #eff6ff;
        }

        .age-badge {
          display: inline-block;
          padding: 0.25rem 0.75rem;
          border-radius: 9999px;
          font-size: 0.75rem;
          font-weight: 500;
        }

        .age-badge.24h {
          background: #fee2e2;
          color: #991b1b;
        }

        .age-badge.1-7d {
          background: #fed7aa;
          color: #92400e;
        }

        .age-badge.7-30d {
          background: #fef3c7;
          color: #78350f;
        }

        .age-badge.30d {
          background: #e5e7eb;
          color: #374151;
        }

        .prompt-full {
          font-size: 0.75rem;
          color: #6b7280;
          margin-top: 0.25rem;
          display: none;
        }

        .recovery-table tbody tr:hover .prompt-full {
          display: block;
        }
      `})]})}function zW({onClose:t}){const[e,n]=O.useState("overview"),[r,s]=O.useState(!0),[i,a]=O.useState(null),[l,c]=O.useState(null),[d,u]=O.useState([]),[p,h]=O.useState([]),[f,m]=O.useState(0),[g,v]=O.useState(null),x=async()=>{var E,T;const _=await an.auth.getSession();return{"Content-Type":"application/json",Authorization:`Bearer ${(T=(E=_==null?void 0:_.data)==null?void 0:E.session)==null?void 0:T.access_token}`}},y=async()=>{try{const _=await x(),S=await fetch("/api/admin/analytics/overview",{headers:_}),E=await S.json();if(!S.ok)throw new Error(E.error||"Failed to fetch overview");c(E.stats)}catch(_){console.error("Failed to fetch overview:",_),a(_.message)}},b=async()=>{try{const _=await x(),S=await fetch("/api/admin/users",{headers:_}),E=await S.json();if(!S.ok)throw new Error(E.error||"Failed to fetch users");u(E.users)}catch(_){console.error("Failed to fetch users:",_),a(_.message)}},w=async()=>{try{const _=await x(),S=await fetch("/api/admin/designs?limit=50",{headers:_}),E=await S.json();if(!S.ok)throw new Error(E.error||"Failed to fetch designs");h(E.designs),m(E.total)}catch(_){console.error("Failed to fetch designs:",_),a(_.message)}},j=async()=>{try{const _=await x(),S=await fetch("/api/admin/analytics/colours",{headers:_}),E=await S.json();if(!S.ok)throw new Error(E.error||"Failed to fetch colour analytics");v(E.analytics)}catch(_){console.error("Failed to fetch colours:",_),a(_.message)}};return O.useEffect(()=>{(async()=>{s(!0),await y(),s(!1)})()},[]),O.useEffect(()=>{e==="users"&&d.length===0?b():e==="designs"&&p.length===0?w():e==="colours"&&!g&&j()},[e]),r?o.jsxs("div",{className:"admin-loading",children:[o.jsx("div",{className:"spinner"}),o.jsx("p",{children:"Loading admin dashboard..."})]}):i?o.jsxs("div",{className:"admin-error",children:[o.jsx("h2",{children:"Access Denied"}),o.jsx("p",{children:i}),o.jsx("p",{children:"You need admin privileges to view this page."})]}):o.jsxs("div",{className:"admin-dashboard",children:[o.jsxs("header",{className:"admin-header",children:[o.jsxs("div",{className:"admin-header-left",children:[o.jsxs("button",{onClick:t,className:"btn-back",children:[o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),"Back to Studio"]}),o.jsx("h1",{children:"TPV Studio Admin"})]}),o.jsxs("nav",{className:"admin-nav",children:[o.jsx("button",{className:e==="overview"?"active":"",onClick:()=>n("overview"),children:"Overview"}),o.jsx("button",{className:e==="generations"?"active":"",onClick:()=>n("generations"),children:"Generations"}),o.jsx("button",{className:e==="recovery"?"active":"",onClick:()=>n("recovery"),children:"Recovery"}),o.jsx("button",{className:e==="users"?"active":"",onClick:()=>n("users"),children:"Users"}),o.jsx("button",{className:e==="designs"?"active":"",onClick:()=>n("designs"),children:"Designs"}),o.jsx("button",{className:e==="colours"?"active":"",onClick:()=>n("colours"),children:"Colour Analytics"})]})]}),o.jsxs("main",{className:"admin-content",children:[e==="overview"&&l&&o.jsx(FW,{stats:l}),e==="generations"&&o.jsx(DW,{}),e==="recovery"&&o.jsx(IW,{}),e==="users"&&o.jsx(BW,{users:d}),e==="designs"&&o.jsx(HW,{designs:p,total:f}),e==="colours"&&g&&o.jsx(UW,{analytics:g})]}),o.jsx("style",{jsx:!0,children:`
        .admin-dashboard {
          min-height: 100vh;
          background: #f8fafc;
        }

        .admin-header {
          background: white;
          border-bottom: 1px solid #e5e7eb;
          padding: 20px 40px;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
        }

        .admin-header-left {
          display: flex;
          flex-direction: column;
          gap: 8px;
        }

        .btn-back {
          display: inline-flex;
          align-items: center;
          gap: 6px;
          padding: 6px 12px;
          background: #f3f4f6;
          border: 1px solid #e5e7eb;
          border-radius: 6px;
          font-size: 13px;
          color: #6b7280;
          cursor: pointer;
          transition: all 0.2s;
          width: fit-content;
        }

        .btn-back:hover {
          background: #e5e7eb;
          color: #374151;
        }

        .admin-header h1 {
          margin: 0;
          font-size: 24px;
          color: #1e4a7a;
        }

        .admin-nav {
          display: flex;
          gap: 8px;
        }

        .admin-nav button {
          padding: 8px 16px;
          border: 1px solid #e5e7eb;
          background: white;
          border-radius: 6px;
          cursor: pointer;
          font-size: 14px;
          color: #64748b;
          transition: all 0.2s;
        }

        .admin-nav button:hover {
          background: #f8fafc;
          color: #1e4a7a;
        }

        .admin-nav button.active {
          background: #1e4a7a;
          color: white;
          border-color: #1e4a7a;
        }

        .admin-content {
          padding: 24px 40px;
        }

        .admin-loading,
        .admin-error {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          min-height: 50vh;
          text-align: center;
        }

        .admin-error h2 {
          color: #dc2626;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 3px solid #e5e7eb;
          border-top-color: #1e4a7a;
          border-radius: 50%;
          animation: spin 0.8s linear infinite;
          margin-bottom: 16px;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}function FW({stats:t}){return o.jsxs("div",{className:"overview-panel",children:[o.jsx("h2",{children:"Dashboard Overview"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-card",children:[o.jsx("div",{className:"stat-value",children:t.totals.users}),o.jsx("div",{className:"stat-label",children:"Total Users"})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("div",{className:"stat-value",children:t.totals.designs}),o.jsx("div",{className:"stat-label",children:"Total Designs"})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("div",{className:"stat-value",children:t.totals.projects}),o.jsx("div",{className:"stat-label",children:"Total Projects"})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("div",{className:"stat-value",children:t.totals.jobs}),o.jsx("div",{className:"stat-label",children:"AI Jobs Run"})]})]}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-card highlight",children:[o.jsx("div",{className:"stat-value",children:t.activity.active_users_30d}),o.jsx("div",{className:"stat-label",children:"Active Users (30d)"})]}),o.jsxs("div",{className:"stat-card highlight",children:[o.jsx("div",{className:"stat-value",children:t.activity.designs_7d}),o.jsx("div",{className:"stat-label",children:"Designs This Week"})]}),o.jsxs("div",{className:"stat-card highlight",children:[o.jsx("div",{className:"stat-value",children:t.activity.designs_30d}),o.jsx("div",{className:"stat-label",children:"Designs This Month"})]}),o.jsxs("div",{className:"stat-card highlight",children:[o.jsxs("div",{className:"stat-value",children:[t.activity.job_success_rate,"%"]}),o.jsx("div",{className:"stat-label",children:"Job Success Rate"})]})]}),o.jsx("h3",{children:"Activity Timeline (14 Days)"}),o.jsx("div",{className:"activity-chart",children:t.timeline.map((e,n)=>o.jsxs("div",{className:"bar-container",children:[o.jsx("div",{className:"bar",style:{height:`${Math.max(4,e.count*20)}px`},title:`${e.date}: ${e.count} designs`}),o.jsx("div",{className:"bar-label",children:e.date.split("-")[2]})]},n))}),o.jsxs("div",{className:"breakdowns",children:[o.jsxs("div",{className:"breakdown-card",children:[o.jsx("h4",{children:"Input Mode"}),o.jsxs("div",{className:"breakdown-items",children:[o.jsxs("div",{className:"breakdown-item",children:[o.jsx("span",{children:"Prompt"}),o.jsx("strong",{children:t.breakdowns.input_mode.prompt})]}),o.jsxs("div",{className:"breakdown-item",children:[o.jsx("span",{children:"Image Upload"}),o.jsx("strong",{children:t.breakdowns.input_mode.image})]}),o.jsxs("div",{className:"breakdown-item",children:[o.jsx("span",{children:"SVG Upload"}),o.jsx("strong",{children:t.breakdowns.input_mode.svg})]})]})]}),o.jsxs("div",{className:"breakdown-card",children:[o.jsx("h4",{children:"View Mode Preference"}),o.jsxs("div",{className:"breakdown-items",children:[o.jsxs("div",{className:"breakdown-item",children:[o.jsx("span",{children:"Solid TPV"}),o.jsx("strong",{children:t.breakdowns.view_mode.solid})]}),o.jsxs("div",{className:"breakdown-item",children:[o.jsx("span",{children:"Blend TPV"}),o.jsx("strong",{children:t.breakdowns.view_mode.blend})]})]})]})]}),o.jsx("style",{jsx:!0,children:`
        .overview-panel h2 {
          margin: 0 0 24px 0;
          color: #1a202c;
        }

        .overview-panel h3 {
          margin: 32px 0 16px 0;
          color: #1a202c;
        }

        .stats-grid {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 16px;
          margin-bottom: 16px;
        }

        .stat-card {
          background: white;
          padding: 20px;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
        }

        .stat-card.highlight {
          border-color: #1e4a7a;
          border-width: 2px;
        }

        .stat-value {
          font-size: 32px;
          font-weight: 700;
          color: #1e4a7a;
        }

        .stat-label {
          font-size: 14px;
          color: #64748b;
          margin-top: 4px;
        }

        .activity-chart {
          display: flex;
          align-items: flex-end;
          gap: 8px;
          height: 120px;
          padding: 16px;
          background: white;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
        }

        .bar-container {
          flex: 1;
          display: flex;
          flex-direction: column;
          align-items: center;
        }

        .bar {
          width: 100%;
          background: #1e4a7a;
          border-radius: 4px 4px 0 0;
          min-height: 4px;
        }

        .bar-label {
          font-size: 10px;
          color: #64748b;
          margin-top: 4px;
        }

        .breakdowns {
          display: grid;
          grid-template-columns: repeat(2, 1fr);
          gap: 16px;
          margin-top: 24px;
        }

        .breakdown-card {
          background: white;
          padding: 20px;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
        }

        .breakdown-card h4 {
          margin: 0 0 12px 0;
          color: #1a202c;
        }

        .breakdown-item {
          display: flex;
          justify-content: space-between;
          padding: 8px 0;
          border-bottom: 1px solid #f3f4f6;
        }

        .breakdown-item:last-child {
          border-bottom: none;
        }

        .breakdown-item span {
          color: #64748b;
        }

        .breakdown-item strong {
          color: #1a202c;
        }
      `})]})}function BW({users:t}){return o.jsxs("div",{className:"users-panel",children:[o.jsxs("h2",{children:["User Management (",t.length," users)"]}),o.jsxs("table",{className:"users-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Email"}),o.jsx("th",{children:"Role"}),o.jsx("th",{children:"Designs"}),o.jsx("th",{children:"Projects"}),o.jsx("th",{children:"Jobs"}),o.jsx("th",{children:"Last Design"}),o.jsx("th",{children:"Joined"})]})}),o.jsx("tbody",{children:t.map(e=>o.jsxs("tr",{children:[o.jsx("td",{children:e.email}),o.jsx("td",{children:o.jsx("span",{className:`role-badge ${e.role}`,children:e.role})}),o.jsx("td",{children:e.design_count}),o.jsx("td",{children:e.project_count}),o.jsx("td",{children:e.job_count}),o.jsx("td",{children:e.last_design_at?new Date(e.last_design_at).toLocaleDateString():"-"}),o.jsx("td",{children:new Date(e.created_at).toLocaleDateString()})]},e.id))})]}),o.jsx("style",{jsx:!0,children:`
        .users-panel h2 {
          margin: 0 0 24px 0;
          color: #1a202c;
        }

        .users-table {
          width: 100%;
          background: white;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
          border-collapse: collapse;
        }

        .users-table th,
        .users-table td {
          padding: 12px 16px;
          text-align: left;
          border-bottom: 1px solid #e5e7eb;
        }

        .users-table th {
          background: #f8fafc;
          font-weight: 600;
          color: #64748b;
          font-size: 12px;
          text-transform: uppercase;
        }

        .users-table td {
          font-size: 14px;
          color: #1a202c;
        }

        .role-badge {
          padding: 4px 8px;
          border-radius: 4px;
          font-size: 12px;
          font-weight: 500;
        }

        .role-badge.user {
          background: #f3f4f6;
          color: #64748b;
        }

        .role-badge.admin {
          background: #dbeafe;
          color: #1e40af;
        }

        .role-badge.superadmin {
          background: #fef3c7;
          color: #92400e;
        }
      `})]})}function HW({designs:t,total:e}){return o.jsxs("div",{className:"designs-panel",children:[o.jsxs("h2",{children:["All Designs (",e," total)"]}),o.jsx("div",{className:"designs-grid",children:t.map(n=>o.jsxs("div",{className:"design-card",children:[o.jsx("div",{className:"design-thumbnail",children:n.thumbnail_url||n.original_png_url?o.jsx("img",{src:n.thumbnail_url||n.original_png_url,alt:n.name}):o.jsx("div",{className:"no-image",children:"No preview"})}),o.jsxs("div",{className:"design-info",children:[o.jsx("h4",{children:n.name}),o.jsx("p",{className:"design-user",children:n.user_email}),o.jsx("p",{className:"design-date",children:new Date(n.created_at).toLocaleDateString()}),n.project&&o.jsx("span",{className:"project-badge",style:{backgroundColor:n.project.color||"#64748b"},children:n.project.name})]})]},n.id))}),o.jsx("style",{jsx:!0,children:`
        .designs-panel h2 {
          margin: 0 0 24px 0;
          color: #1a202c;
        }

        .designs-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
          gap: 16px;
        }

        .design-card {
          background: white;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
          overflow: hidden;
        }

        .design-thumbnail {
          aspect-ratio: 1;
          background: #f3f4f6;
          overflow: hidden;
        }

        .design-thumbnail img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }

        .no-image {
          width: 100%;
          height: 100%;
          display: flex;
          align-items: center;
          justify-content: center;
          color: #9ca3af;
          font-size: 14px;
        }

        .design-info {
          padding: 12px;
        }

        .design-info h4 {
          margin: 0 0 4px 0;
          font-size: 14px;
          color: #1a202c;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }

        .design-user {
          margin: 0;
          font-size: 12px;
          color: #64748b;
        }

        .design-date {
          margin: 4px 0;
          font-size: 12px;
          color: #9ca3af;
        }

        .project-badge {
          display: inline-block;
          padding: 2px 8px;
          border-radius: 10px;
          font-size: 10px;
          color: white;
        }
      `})]})}function UW({analytics:t}){return o.jsxs("div",{className:"colours-panel",children:[o.jsx("h2",{children:"Colour Usage Analytics"}),o.jsxs("div",{className:"colour-stats",children:[o.jsxs("div",{className:"stat-card",children:[o.jsx("div",{className:"stat-value",children:t.totals.designs_analysed}),o.jsx("div",{className:"stat-label",children:"Designs Analysed"})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("div",{className:"stat-value",children:t.totals.colour_usages}),o.jsx("div",{className:"stat-label",children:"Total Colour Uses"})]})]}),o.jsx("h3",{children:"Top 10 TPV Colours"}),o.jsx("div",{className:"colour-list",children:t.top_colours.map((e,n)=>o.jsxs("div",{className:"colour-item",children:[o.jsxs("span",{className:"colour-rank",children:["#",n+1]}),o.jsx("div",{className:"colour-swatch",style:{backgroundColor:e.hex}}),o.jsxs("div",{className:"colour-info",children:[o.jsx("strong",{children:e.code}),o.jsx("span",{children:e.name})]}),o.jsxs("div",{className:"colour-count",children:[e.count," uses"]})]},e.code))}),o.jsx("h3",{children:"Colour Family Breakdown"}),o.jsx("div",{className:"family-bars",children:Object.entries(t.families).map(([e,n])=>o.jsxs("div",{className:"family-bar",children:[o.jsx("span",{className:"family-name",children:e}),o.jsx("div",{className:"bar-bg",children:o.jsx("div",{className:"bar-fill",style:{width:`${n/t.totals.colour_usages*100}%`,backgroundColor:WW(e)}})}),o.jsx("span",{className:"family-count",children:n})]},e))}),t.top_blends.length>0&&o.jsxs(o.Fragment,{children:[o.jsx("h3",{children:"Top Blend Combinations"}),o.jsx("div",{className:"blend-list",children:t.top_blends.map((e,n)=>o.jsxs("div",{className:"blend-item",children:[o.jsx("div",{className:"blend-swatches",children:e.components.map((r,s)=>o.jsx("div",{className:"blend-swatch",style:{backgroundColor:r.hex},title:`${r.code} - ${r.name}`},s))}),o.jsx("div",{className:"blend-codes",children:e.components.map(r=>r.code).join(" + ")}),o.jsxs("div",{className:"blend-count",children:[e.count," uses"]})]},n))})]}),o.jsx("style",{jsx:!0,children:`
        .colours-panel h2 {
          margin: 0 0 24px 0;
          color: #1a202c;
        }

        .colours-panel h3 {
          margin: 32px 0 16px 0;
          color: #1a202c;
        }

        .colour-stats {
          display: grid;
          grid-template-columns: repeat(2, 1fr);
          gap: 16px;
          margin-bottom: 24px;
        }

        .stat-card {
          background: white;
          padding: 20px;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
        }

        .stat-value {
          font-size: 32px;
          font-weight: 700;
          color: #1e4a7a;
        }

        .stat-label {
          font-size: 14px;
          color: #64748b;
          margin-top: 4px;
        }

        .colour-list {
          background: white;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
          overflow: hidden;
        }

        .colour-item {
          display: flex;
          align-items: center;
          gap: 12px;
          padding: 12px 16px;
          border-bottom: 1px solid #f3f4f6;
        }

        .colour-item:last-child {
          border-bottom: none;
        }

        .colour-rank {
          width: 30px;
          font-size: 12px;
          color: #9ca3af;
        }

        .colour-swatch {
          width: 32px;
          height: 32px;
          border-radius: 6px;
          border: 1px solid #e5e7eb;
        }

        .colour-info {
          flex: 1;
        }

        .colour-info strong {
          display: block;
          color: #1a202c;
        }

        .colour-info span {
          font-size: 12px;
          color: #64748b;
        }

        .colour-count {
          font-weight: 600;
          color: #1e4a7a;
        }

        .family-bars {
          background: white;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
          padding: 16px;
        }

        .family-bar {
          display: flex;
          align-items: center;
          gap: 12px;
          margin-bottom: 12px;
        }

        .family-bar:last-child {
          margin-bottom: 0;
        }

        .family-name {
          width: 80px;
          font-size: 14px;
          color: #64748b;
          text-transform: capitalize;
        }

        .bar-bg {
          flex: 1;
          height: 20px;
          background: #f3f4f6;
          border-radius: 4px;
          overflow: hidden;
        }

        .bar-fill {
          height: 100%;
          border-radius: 4px;
        }

        .family-count {
          width: 50px;
          text-align: right;
          font-weight: 600;
          color: #1a202c;
        }

        .blend-list {
          background: white;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
          overflow: hidden;
        }

        .blend-item {
          display: flex;
          align-items: center;
          gap: 12px;
          padding: 12px 16px;
          border-bottom: 1px solid #f3f4f6;
        }

        .blend-item:last-child {
          border-bottom: none;
        }

        .blend-swatches {
          display: flex;
          gap: 4px;
        }

        .blend-swatch {
          width: 24px;
          height: 24px;
          border-radius: 4px;
          border: 1px solid #e5e7eb;
        }

        .blend-codes {
          flex: 1;
          font-size: 14px;
          color: #1a202c;
        }

        .blend-count {
          font-weight: 600;
          color: #1e4a7a;
        }
      `})]})}function WW(t){return{reds:"#dc2626",greens:"#16a34a",blues:"#2563eb",yellows:"#ca8a04",neutrals:"#6b7280"}[t]||"#6b7280"}const hh=[{code:"RH30",name:"Beige",hex:"#E4C4AA"},{code:"RH31",name:"Cream",hex:"#E8E3D8"},{code:"RH41",name:"Bright Yellow",hex:"#FFD833"},{code:"RH40",name:"Mustard",hex:"#E5A144"},{code:"RH50",name:"Orange",hex:"#F15B32"},{code:"RH01",name:"Standard Red",hex:"#A5362F"},{code:"RH02",name:"Bright Red",hex:"#E21F2F"},{code:"RH90",name:"Funky Pink",hex:"#E8457E"},{code:"RH21",name:"Purple",hex:"#493D8C"},{code:"RH20",name:"Standard Blue",hex:"#0075BC"},{code:"RH22",name:"Light Blue",hex:"#47AFE3"},{code:"RH23",name:"Azure",hex:"#039DC4"},{code:"RH26",name:"Turquoise",hex:"#00A6A3"},{code:"RH12",name:"Dark Green",hex:"#006C55"},{code:"RH10",name:"Standard Green",hex:"#609B63"},{code:"RH11",name:"Bright Green",hex:"#3BB44A"},{code:"RH32",name:"Brown",hex:"#8B5F3C"},{code:"RH65",name:"Pale Grey",hex:"#D9D9D6"},{code:"RH61",name:"Light Grey",hex:"#939598"},{code:"RH60",name:"Dark Grey",hex:"#59595B"},{code:"RH70",name:"Black",hex:"#231F20"}],Qx=["ocean theme with dolphins and waves","jungle adventure with parrots","solar system with planets","garden with butterflies and flowers","racing track with cars","underwater coral reef scene","dinosaur footprints trail","rainbow with clouds"],GW=[...Array(60)].map(t=>({delay:`${Math.random()*3}s`,x:`${Math.random()*100}%`,y:`${Math.random()*100}%`,size:`${8+Math.random()*12}px`}));function VW(){const[t,e]=O.useState(""),[n,r]=O.useState(""),[s,i]=O.useState(""),[a,l]=O.useState(!1),[c,d]=O.useState(!1),[u,p]=O.useState(0);O.useEffect(()=>{const m=setInterval(()=>{p(g=>(g+1)%Qx.length)},5e3);return()=>clearInterval(m)},[]);const h=async m=>{m.preventDefault(),i(""),l(!0);try{await Vr.signIn(t,n)}catch(g){i(g.message||"Sign in failed")}finally{l(!1)}},f=m=>{var g;(g=document.getElementById(m))==null||g.scrollIntoView({behavior:"smooth"})};return o.jsxs("div",{className:"landing-page",children:[o.jsxs("nav",{className:"landing-nav",children:[o.jsxs("div",{className:"nav-logo",children:[o.jsxs("div",{className:"logo-main",children:[o.jsxs("span",{className:"logo-text",children:["Rosehill TPV",o.jsx("sup",{children:""})]}),o.jsx("span",{className:"logo-accent",children:"Studio"})]}),o.jsx("span",{className:"logo-byline",children:"by Rosehill Sports & Play"})]}),o.jsxs("div",{className:"nav-links",children:[o.jsx("button",{onClick:()=>f("features"),children:"Features"}),o.jsx("button",{onClick:()=>f("palette"),children:"Colours"}),o.jsx("button",{onClick:()=>d(!0),className:"nav-cta",children:"Sign In"})]})]}),o.jsxs("section",{className:"hero",children:[o.jsx("div",{className:"hero-background",children:o.jsx("div",{className:"granule-field",children:GW.map((m,g)=>o.jsx("div",{className:"granule",style:{"--delay":m.delay,"--x":m.x,"--y":m.y,"--color":hh[g%hh.length].hex,"--size":m.size}},g))})}),o.jsxs("div",{className:"hero-content",children:[o.jsxs("div",{className:"hero-badge",children:["Rosehill TPV",o.jsx("sup",{children:""})," Surface Design Platform"]}),o.jsxs("h1",{children:[o.jsx("span",{className:"hero-line-1",children:"Design Any"}),o.jsxs("span",{className:"hero-line-2",children:["Rosehill TPV",o.jsx("sup",{children:""})," Surface"]})]}),o.jsxs("p",{className:"hero-subtitle",children:["From AI-generated playground art to professional sports courts  one powerful design platform for all your Rosehill TPV",o.jsx("sup",{children:""})," surfaces."]}),o.jsxs("div",{className:"hero-ctas",children:[o.jsxs("button",{onClick:()=>d(!0),className:"cta-primary",children:["Start Designing",o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M5 12h14M12 5l7 7-7 7"})})]}),o.jsx("button",{onClick:()=>f("how-it-works"),className:"cta-secondary",children:"See How It Works"})]})]}),o.jsx("div",{className:"hero-visual",children:o.jsx("div",{className:"mockup-container",children:o.jsxs("div",{className:"mockup-screen",children:[o.jsx("div",{className:"mockup-header",children:o.jsxs("div",{className:"mockup-dots",children:[o.jsx("span",{}),o.jsx("span",{}),o.jsx("span",{})]})}),o.jsxs("div",{className:"mockup-content",children:[o.jsx("div",{className:"mockup-input",children:o.jsx("span",{className:"typing-text",children:Qx[u]},u)}),o.jsxs("div",{className:"mockup-preview",children:[o.jsx("div",{className:"preview-shape shape-1"}),o.jsx("div",{className:"preview-shape shape-2"}),o.jsx("div",{className:"preview-shape shape-3"})]})]})]})})})]}),o.jsxs("section",{className:"unified-showcase",children:[o.jsxs("div",{className:"section-header",children:[o.jsx("span",{className:"section-tag",children:"One Powerful Tool"}),o.jsx("h2",{children:"Design Any Surface"}),o.jsx("p",{className:"section-subtitle",children:"Courts, tracks, playgrounds, and custom graphics  all in one canvas"})]}),o.jsx("div",{className:"showcase-container",children:o.jsxs("div",{className:"showcase-card",children:[o.jsxs("div",{className:"showcase-canvas",children:[o.jsxs("div",{className:"canvas-preview",children:[o.jsx("div",{className:"canvas-grid"}),o.jsxs("div",{className:"canvas-surface",children:[o.jsx("div",{className:"surface-court"}),o.jsx("div",{className:"surface-motif"})]})]}),o.jsxs("div",{className:"capability-pill pill-courts",children:[o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("rect",{x:"2",y:"4",width:"20",height:"16",rx:"2"}),o.jsx("circle",{cx:"12",cy:"12",r:"3"}),o.jsx("path",{d:"M2 12h4M18 12h4"})]}),o.jsx("span",{children:"Courts & Tracks"})]}),o.jsxs("div",{className:"capability-pill pill-ai",children:[o.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2z"})}),o.jsx("span",{children:"AI Artwork"})]}),o.jsxs("div",{className:"capability-pill pill-upload",children:[o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),o.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),o.jsx("path",{d:"M21 15l-5-5L5 21"})]}),o.jsx("span",{children:"Custom Images"})]}),o.jsxs("div",{className:"capability-pill pill-layers",children:[o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),o.jsx("path",{d:"M2 17l10 5 10-5"}),o.jsx("path",{d:"M2 12l10 5 10-5"})]}),o.jsx("span",{children:"Layer & Combine"})]})]}),o.jsx("div",{className:"showcase-tagline",children:"One canvas. Unlimited possibilities."}),o.jsxs("div",{className:"showcase-features",children:[o.jsxs("div",{className:"showcase-feature",children:[o.jsx("div",{className:"feature-badge ai-badge",children:"AI-POWERED"}),o.jsx("span",{children:"Generate motifs from text descriptions"})]}),o.jsxs("div",{className:"showcase-feature",children:[o.jsx("div",{className:"feature-badge template-badge",children:"TEMPLATES"}),o.jsx("span",{children:"15+ professional court layouts"})]}),o.jsxs("div",{className:"showcase-feature",children:[o.jsx("div",{className:"feature-badge compose-badge",children:"COMPOSE"}),o.jsx("span",{children:"Mix courts, tracks & artwork freely"})]})]}),o.jsxs("button",{onClick:()=>d(!0),className:"cta-primary showcase-cta",children:["Start Designing",o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M5 12h14M12 5l7 7-7 7"})})]})]})})]}),o.jsxs("section",{id:"how-it-works",className:"how-it-works",children:[o.jsxs("div",{className:"section-header",children:[o.jsx("span",{className:"section-tag",children:"Process"}),o.jsx("h2",{children:"Three Steps to Production-Ready Designs"})]}),o.jsxs("div",{className:"steps-container",children:[o.jsxs("div",{className:"step",children:[o.jsx("div",{className:"step-number",children:"01"}),o.jsx("div",{className:"step-icon",children:o.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),o.jsx("path",{d:"M3 9h18M9 21V9"})]})}),o.jsx("h3",{children:"Set Up Your Surface"}),o.jsx("p",{children:"Define your dimensions and choose your base colour. Start with any size from small playgrounds to full athletic facilities."})]}),o.jsx("div",{className:"step-connector",children:o.jsx("svg",{viewBox:"0 0 100 20",preserveAspectRatio:"none",children:o.jsx("path",{d:"M0 10 Q50 10 100 10",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeDasharray:"4 4"})})}),o.jsxs("div",{className:"step",children:[o.jsx("div",{className:"step-number",children:"02"}),o.jsx("div",{className:"step-icon",children:o.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),o.jsx("path",{d:"M2 17l10 5 10-5"}),o.jsx("path",{d:"M2 12l10 5 10-5"})]})}),o.jsx("h3",{children:"Add Elements"}),o.jsx("p",{children:"Drop in courts and tracks from the library, generate AI artwork, upload your own designs  layer and combine freely."})]}),o.jsx("div",{className:"step-connector",children:o.jsx("svg",{viewBox:"0 0 100 20",preserveAspectRatio:"none",children:o.jsx("path",{d:"M0 10 Q50 10 100 10",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeDasharray:"4 4"})})}),o.jsxs("div",{className:"step",children:[o.jsx("div",{className:"step-number",children:"03"}),o.jsx("div",{className:"step-icon",children:o.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),o.jsx("path",{d:"M14 2v6h6M12 18v-6M9 15l3 3 3-3"})]})}),o.jsx("h3",{children:"Export & Build"}),o.jsx("p",{children:"Generate professional PDFs with material specifications, colour recipes, and exact quantities for installation."})]})]})]}),o.jsxs("section",{id:"features",className:"features",children:[o.jsxs("div",{className:"section-header",children:[o.jsx("span",{className:"section-tag",children:"Capabilities"}),o.jsxs("h2",{children:["Everything You Need to Design Rosehill TPV",o.jsx("sup",{children:""})," Surfaces"]})]}),o.jsxs("div",{className:"features-grid unified-features",children:[o.jsxs("div",{className:"feature-card feature-highlight",children:[o.jsx("div",{className:"feature-icon",children:o.jsx("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2z"})})}),o.jsx("h3",{children:"AI Text-to-Vector"}),o.jsxs("p",{children:["Describe any concept in natural language. Our AI transforms your words into production-ready vector designs optimised for Rosehill TPV",o.jsx("sup",{children:""})," surfaces."]}),o.jsx("div",{className:"feature-example",children:'"vibrant underwater scene with coral reef"'})]}),o.jsxs("div",{className:"feature-card",children:[o.jsx("div",{className:"feature-icon",children:o.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("rect",{x:"2",y:"4",width:"20",height:"16",rx:"2"}),o.jsx("circle",{cx:"12",cy:"12",r:"3"}),o.jsx("path",{d:"M2 12h4M18 12h4"})]})}),o.jsx("h3",{children:"Court & Track Library"}),o.jsx("p",{children:"15+ professional templates including basketball, tennis, netball, futsal, and running tracks."})]}),o.jsxs("div",{className:"feature-card",children:[o.jsx("div",{className:"feature-icon",children:o.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),o.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),o.jsx("path",{d:"M21 15l-5-5L5 21"})]})}),o.jsx("h3",{children:"Image Vectorisation"}),o.jsxs("p",{children:["Upload any image and convert it to clean vectors optimised for Rosehill TPV",o.jsx("sup",{children:""})," production."]})]}),o.jsxs("div",{className:"feature-card",children:[o.jsx("div",{className:"feature-icon",children:o.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("circle",{cx:"13.5",cy:"6.5",r:"2.5"}),o.jsx("circle",{cx:"17.5",cy:"10.5",r:"2.5"}),o.jsx("circle",{cx:"8.5",cy:"7.5",r:"2.5"}),o.jsx("circle",{cx:"6.5",cy:"12.5",r:"2.5"})]})}),o.jsx("h3",{children:"Colour Matching"}),o.jsxs("p",{children:["Automatic colour matching to the Rosehill TPV",o.jsx("sup",{children:""})," palette with precise specifications."]})]}),o.jsxs("div",{className:"feature-card",children:[o.jsx("div",{className:"feature-icon",children:o.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),o.jsx("path",{d:"M2 17l10 5 10-5"}),o.jsx("path",{d:"M2 12l10 5 10-5"})]})}),o.jsx("h3",{children:"Layer Management"}),o.jsx("p",{children:"Combine courts, tracks, and motifs freely. Drag, rotate, and layer with precision controls."})]}),o.jsxs("div",{className:"feature-card",children:[o.jsx("div",{className:"feature-icon",children:o.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),o.jsx("path",{d:"M14 2v6h6M12 18v-6M9 15l3 3 3-3"})]})}),o.jsx("h3",{children:"PDF Specifications"}),o.jsx("p",{children:"Export production-ready material specs with colour specifications and installation guides."})]})]})]}),o.jsxs("section",{id:"palette",className:"palette-section",children:[o.jsxs("div",{className:"section-header light",children:[o.jsx("span",{className:"section-tag",children:"Palette"}),o.jsxs("h2",{children:["21 Standard Rosehill TPV",o.jsx("sup",{children:""})," Colours"]}),o.jsxs("p",{className:"section-subtitle",children:["The complete Rosehill TPV",o.jsx("sup",{children:""})," granule palette at your fingertips"]})]}),o.jsx("div",{className:"palette-grid",children:hh.map((m,g)=>o.jsxs("div",{className:"palette-swatch",style:{"--swatch-color":m.hex,"--delay":`${g*.03}s`},children:[o.jsx("div",{className:"swatch-color"}),o.jsxs("div",{className:"swatch-info",children:[o.jsx("span",{className:"swatch-name",children:m.name}),o.jsx("span",{className:"swatch-code",children:m.code})]})]},m.code))})]}),o.jsx("section",{className:"benefits",children:o.jsxs("div",{className:"benefits-grid benefits-grid-4",children:[o.jsxs("div",{className:"benefit",children:[o.jsx("div",{className:"benefit-metric",children:"10x"}),o.jsx("div",{className:"benefit-label",children:"Faster Design"}),o.jsx("p",{children:"What took hours now takes minutes with AI and templates."})]}),o.jsxs("div",{className:"benefit",children:[o.jsx("div",{className:"benefit-metric",children:"100%"}),o.jsx("div",{className:"benefit-label",children:"Production Accurate"}),o.jsxs("p",{children:["Exact Rosehill TPV",o.jsx("sup",{children:""})," granule specs with precise specifications."]})]}),o.jsxs("div",{className:"benefit",children:[o.jsx("div",{className:"benefit-metric infinite-symbol",children:""}),o.jsx("div",{className:"benefit-label",children:"Combinations"}),o.jsx("p",{children:"Mix courts, tracks, and artwork in unlimited configurations."})]}),o.jsxs("div",{className:"benefit",children:[o.jsx("div",{className:"benefit-metric",children:"21"}),o.jsx("div",{className:"benefit-label",children:"Standard Colours"}),o.jsxs("p",{children:["Complete Rosehill TPV",o.jsx("sup",{children:""})," standard colour palette."]})]})]})}),o.jsx("footer",{className:"landing-footer",children:o.jsxs("div",{className:"footer-content",children:[o.jsxs("div",{className:"footer-brand",children:[o.jsxs("span",{className:"footer-logo",children:["Rosehill TPV",o.jsx("sup",{children:""})," Studio"]}),o.jsx("span",{className:"footer-tagline",children:"A web app by Rosehill Sports & Play"}),o.jsx("span",{className:"footer-division",children:"A Division of Rosehill Group"})]}),o.jsxs("div",{className:"footer-links",children:[o.jsx("a",{href:"https://rosehilltpv.com",target:"_blank",rel:"noopener noreferrer",children:"rosehilltpv.com"}),o.jsx("a",{href:"mailto:info@rosehill.group",children:"info@rosehill.group"})]})]})}),o.jsx("section",{className:"cta-footer",children:o.jsxs("div",{className:"cta-content",children:[o.jsx("h2",{children:"Ready to Design Your Surface?"}),o.jsxs("p",{children:["Create playgrounds or sports facilities with production-ready Rosehill TPV",o.jsx("sup",{children:""})," specifications."]}),o.jsxs("button",{onClick:()=>d(!0),className:"cta-primary large",children:["Sign In to Rosehill TPV",o.jsx("sup",{children:""})," Studio",o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M5 12h14M12 5l7 7-7 7"})})]}),o.jsxs("p",{className:"cta-note",children:["Need an account? Contact ",o.jsx("a",{href:"mailto:info@rosehill.group",children:"info@rosehill.group"})]})]})}),c&&o.jsx("div",{className:"modal-overlay",onClick:()=>d(!1),children:o.jsxs("div",{className:"sign-in-modal",onClick:m=>m.stopPropagation(),children:[o.jsx("button",{className:"modal-close",onClick:()=>d(!1),children:o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})}),o.jsxs("div",{className:"modal-header",children:[o.jsx("h2",{children:"Sign In"}),o.jsxs("p",{children:["Access your Rosehill TPV",o.jsx("sup",{children:""})," Studio account"]})]}),s&&o.jsx("div",{className:"form-error",children:s}),o.jsxs("form",{onSubmit:h,children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{children:"Email"}),o.jsx("input",{type:"email",value:t,onChange:m=>e(m.target.value),placeholder:"your.email@company.com",required:!0})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{children:"Password"}),o.jsx("input",{type:"password",value:n,onChange:m=>r(m.target.value),required:!0})]}),o.jsx("button",{type:"submit",disabled:a,className:"submit-btn",children:a?"Signing in...":"Sign In"})]}),o.jsx("p",{className:"modal-footer-text",children:"Don't have an account? Contact your administrator."})]})}),o.jsx("style",{jsx:!0,children:`
        /* ============================================
           TPV STUDIO LANDING PAGE
           Aesthetic: Sophisticated Industrial-Creative
           ============================================ */

        @import url('https://fonts.googleapis.com/css2?family=Overpass:wght@300;400;500;600;700&family=Source+Sans+Pro:wght@300;400;600;700&display=swap');

        .landing-page {
          --primary: #1a365d;
          --primary-light: #2a4a73;
          --accent: #ff6b35;
          --accent-hover: #e55a2a;
          --text: #1a202c;
          --text-secondary: #64748b;
          --text-light: #94a3b8;
          --bg: #fafbfc;
          --bg-dark: #0f172a;
          --card: #ffffff;
          --border: #e2e8f0;

          font-family: 'Source Sans Pro', sans-serif;
          background: var(--bg);
          color: var(--text);
          overflow-x: hidden;
        }

        /* Navigation */
        .landing-nav {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          z-index: 1000;
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 1rem 3rem;
          background: rgba(255, 255, 255, 0.9);
          backdrop-filter: blur(12px);
          border-bottom: 1px solid var(--border);
        }

        .nav-logo {
          font-family: 'Overpass', sans-serif;
          font-size: 1.5rem;
          font-weight: 700;
        }

        .logo-text {
          color: var(--primary);
        }

        .logo-accent {
          color: var(--accent);
        }

        .nav-links {
          display: flex;
          align-items: center;
          gap: 2rem;
        }

        .nav-links button {
          background: none;
          border: none;
          font-family: inherit;
          font-size: 0.875rem;
          font-weight: 500;
          color: var(--text-secondary);
          cursor: pointer;
          transition: color 0.2s;
        }

        .nav-links button:hover {
          color: var(--text);
        }

        .nav-cta {
          background: var(--primary) !important;
          color: white !important;
          padding: 0.5rem 1.25rem !important;
          border-radius: 6px !important;
        }

        .nav-cta:hover {
          background: var(--primary-light) !important;
        }

        .logo-main {
          display: flex;
          align-items: baseline;
          gap: 0.25rem;
        }

        .logo-byline {
          display: block;
          font-size: 0.625rem;
          font-weight: 400;
          color: var(--text-light);
          margin-top: 2px;
          letter-spacing: 0.02em;
        }

        .landing-page sup {
          font-size: 0.6em;
          vertical-align: super;
          line-height: 0;
        }

        /* Hero Section */
        .hero {
          min-height: 100vh;
          display: grid;
          grid-template-columns: 1fr 1fr;
          align-items: center;
          padding: 8rem 4rem 4rem;
          position: relative;
          overflow: hidden;
        }

        .hero-background {
          position: absolute;
          inset: 0;
          pointer-events: none;
        }

        .granule-field {
          position: absolute;
          inset: 0;
        }

        .granule {
          position: absolute;
          left: var(--x);
          top: var(--y);
          width: var(--size);
          height: var(--size);
          background: var(--color);
          border-radius: 50%;
          opacity: 0.15;
          animation: float 8s ease-in-out infinite;
          animation-delay: var(--delay);
        }

        @keyframes float {
          0%, 100% { transform: translateY(0) scale(1); }
          50% { transform: translateY(-20px) scale(1.1); }
        }

        .hero-content {
          position: relative;
          z-index: 10;
        }

        .hero-badge {
          display: inline-block;
          padding: 0.5rem 1rem;
          background: rgba(30, 74, 122, 0.1);
          color: var(--primary);
          font-size: 0.75rem;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.1em;
          border-radius: 50px;
          margin-bottom: 1.5rem;
        }

        .hero h1 {
          font-family: 'Overpass', sans-serif;
          font-size: 3.5rem;
          font-weight: 700;
          line-height: 1.1;
          margin: 0 0 1.5rem;
        }

        .hero-line-1 {
          display: block;
          color: var(--text-secondary);
        }

        .hero-line-2 {
          display: block;
          color: var(--primary);
        }

        .hero-subtitle {
          font-size: 1.125rem;
          color: var(--text-secondary);
          line-height: 1.7;
          max-width: 480px;
          margin-bottom: 2rem;
        }

        .hero-ctas {
          display: flex;
          gap: 1rem;
        }

        .cta-primary {
          display: inline-flex;
          align-items: center;
          gap: 0.5rem;
          padding: 0.875rem 1.5rem;
          background: var(--accent);
          color: white;
          border: none;
          border-radius: 8px;
          font-family: inherit;
          font-size: 0.9375rem;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.2s;
        }

        .cta-primary:hover {
          background: var(--accent-hover);
          transform: translateY(-2px);
          box-shadow: 0 8px 24px rgba(255, 107, 53, 0.3);
        }

        .cta-primary.large {
          padding: 1rem 2rem;
          font-size: 1rem;
        }

        .cta-secondary {
          padding: 0.875rem 1.5rem;
          background: white;
          color: var(--text);
          border: 2px solid var(--border);
          border-radius: 8px;
          font-family: inherit;
          font-size: 0.9375rem;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.2s;
        }

        .cta-secondary:hover {
          border-color: var(--primary);
          color: var(--primary);
        }

        /* Hero Visual / Mockup */
        .hero-visual {
          position: relative;
          z-index: 10;
          display: flex;
          justify-content: center;
        }

        .mockup-container {
          perspective: 1000px;
        }

        .mockup-screen {
          width: 400px;
          background: white;
          border-radius: 12px;
          box-shadow: 0 24px 80px rgba(0, 0, 0, 0.15);
          overflow: hidden;
          transform: rotateY(-5deg) rotateX(2deg);
          animation: mockupFloat 6s ease-in-out infinite;
        }

        @keyframes mockupFloat {
          0%, 100% { transform: rotateY(-5deg) rotateX(2deg) translateY(0); }
          50% { transform: rotateY(-5deg) rotateX(2deg) translateY(-10px); }
        }

        .mockup-header {
          padding: 0.75rem 1rem;
          background: #f8f8f8;
          border-bottom: 1px solid #eee;
        }

        .mockup-dots {
          display: flex;
          gap: 6px;
        }

        .mockup-dots span {
          width: 10px;
          height: 10px;
          border-radius: 50%;
          background: #ddd;
        }

        .mockup-dots span:nth-child(1) { background: #ff5f56; }
        .mockup-dots span:nth-child(2) { background: #ffbd2e; }
        .mockup-dots span:nth-child(3) { background: #27ca41; }

        .mockup-content {
          padding: 1.5rem;
        }

        .mockup-input {
          background: #f5f5f5;
          padding: 1rem;
          border-radius: 8px;
          font-size: 0.875rem;
          color: var(--text-secondary);
          margin-bottom: 1.5rem;
          display: flex;
          align-items: center;
        }

        .typing-text {
          display: inline-block;
          overflow: hidden;
          white-space: nowrap;
          border-right: 2px solid var(--primary);
          animation: typing 5s steps(40, end) forwards, blink 0.7s step-end infinite;
        }

        @keyframes typing {
          0% { max-width: 0; }
          35% { max-width: 500px; }
          65% { max-width: 500px; }
          100% { max-width: 0; }
        }

        @keyframes blink {
          50% { border-color: transparent; }
        }

        .mockup-preview {
          height: 180px;
          background: linear-gradient(135deg, #e8f4f8, #f0f4ff);
          border-radius: 8px;
          position: relative;
          overflow: hidden;
        }

        .preview-shape {
          position: absolute;
          border-radius: 50%;
          animation: shapeReveal 4s ease-out infinite;
        }

        .shape-1 {
          width: 80px;
          height: 80px;
          background: var(--accent);
          opacity: 0.8;
          top: 20%;
          left: 15%;
          animation-delay: 0s;
        }

        .shape-2 {
          width: 60px;
          height: 60px;
          background: #30D5C8;
          opacity: 0.8;
          top: 40%;
          left: 50%;
          animation-delay: 0.3s;
        }

        .shape-3 {
          width: 100px;
          height: 100px;
          background: var(--primary);
          opacity: 0.8;
          top: 50%;
          right: 10%;
          animation-delay: 0.6s;
        }

        @keyframes shapeReveal {
          0%, 100% { transform: scale(0.8); opacity: 0.4; }
          50% { transform: scale(1); opacity: 0.8; }
        }

        /* Section Headers */
        .section-header {
          text-align: center;
          margin-bottom: 4rem;
        }

        .section-header.light h2,
        .section-header.light .section-subtitle {
          color: white;
        }

        .section-header.light .section-tag {
          background: rgba(255, 255, 255, 0.1);
          color: rgba(255, 255, 255, 0.9);
        }

        .section-tag {
          display: inline-block;
          padding: 0.375rem 0.875rem;
          background: rgba(30, 74, 122, 0.1);
          color: var(--primary);
          font-size: 0.6875rem;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.15em;
          border-radius: 50px;
          margin-bottom: 1rem;
        }

        .section-header h2 {
          font-family: 'Overpass', sans-serif;
          font-size: 2.5rem;
          font-weight: 700;
          color: var(--text);
          margin: 0;
        }

        .section-subtitle {
          margin-top: 1rem;
          font-size: 1.125rem;
          color: var(--text-secondary);
        }

        /* How It Works */
        .how-it-works {
          padding: 6rem 4rem;
          background: white;
        }

        .steps-container {
          display: flex;
          align-items: flex-start;
          justify-content: center;
          gap: 1rem;
        }

        .step {
          flex: 1;
          max-width: 280px;
          text-align: center;
          padding: 2rem 1.5rem;
        }

        .step-number {
          font-family: 'Overpass', sans-serif;
          font-size: 3rem;
          font-weight: 700;
          color: rgba(30, 74, 122, 0.1);
          margin-bottom: 1rem;
        }

        .step-icon {
          width: 64px;
          height: 64px;
          margin: 0 auto 1.5rem;
          display: flex;
          align-items: center;
          justify-content: center;
          background: rgba(255, 107, 53, 0.1);
          border-radius: 16px;
          color: var(--accent);
        }

        .step h3 {
          font-family: 'Overpass', sans-serif;
          font-size: 1.25rem;
          font-weight: 600;
          margin: 0 0 0.75rem;
          color: var(--text);
        }

        .step p {
          font-size: 0.9375rem;
          color: var(--text-secondary);
          line-height: 1.6;
          margin: 0;
        }

        .step-connector {
          width: 100px;
          padding-top: 5rem;
          color: var(--border);
        }

        /* Features */
        .features {
          padding: 6rem 4rem;
          background: var(--bg);
        }

        .features-grid {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 1.5rem;
          max-width: 1200px;
          margin: 0 auto;
        }

        .feature-card {
          background: white;
          padding: 2rem;
          border-radius: 12px;
          border: 1px solid var(--border);
          transition: all 0.3s;
        }

        .feature-card:hover {
          transform: translateY(-4px);
          box-shadow: 0 12px 40px rgba(0, 0, 0, 0.08);
        }

        .feature-highlight {
          grid-column: span 2;
          background: linear-gradient(135deg, var(--primary), var(--primary-light));
          color: white;
          border: none;
        }

        .feature-highlight .feature-icon {
          background: rgba(255, 255, 255, 0.2);
          color: white;
        }

        .feature-highlight h3 {
          color: white;
        }

        .feature-highlight p {
          color: rgba(255, 255, 255, 0.9);
        }

        .feature-icon {
          width: 56px;
          height: 56px;
          display: flex;
          align-items: center;
          justify-content: center;
          background: rgba(30, 74, 122, 0.1);
          border-radius: 12px;
          color: var(--primary);
          margin-bottom: 1.25rem;
        }

        .feature-card h3 {
          font-family: 'Overpass', sans-serif;
          font-size: 1.125rem;
          font-weight: 600;
          margin: 0 0 0.5rem;
        }

        .feature-card p {
          font-size: 0.875rem;
          color: var(--text-secondary);
          line-height: 1.6;
          margin: 0;
        }

        .feature-example {
          margin-top: 1.5rem;
          padding: 0.875rem 1rem;
          background: rgba(255, 255, 255, 0.1);
          border-radius: 8px;
          font-size: 0.8125rem;
          font-style: italic;
          opacity: 0.9;
        }

        /* Unified Showcase Section */
        .unified-showcase {
          padding: 6rem 4rem;
          background: white;
        }

        .showcase-container {
          max-width: 900px;
          margin: 0 auto;
        }

        .showcase-card {
          background: linear-gradient(135deg, #f8fafc, #f1f5f9);
          border-radius: 24px;
          padding: 3rem;
          border: 1px solid var(--border);
          text-align: center;
        }

        .showcase-canvas {
          position: relative;
          height: 280px;
          margin-bottom: 2rem;
        }

        .canvas-preview {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 240px;
          height: 160px;
          background: white;
          border-radius: 12px;
          border: 2px solid var(--border);
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
          overflow: hidden;
        }

        .canvas-grid {
          position: absolute;
          inset: 0;
          background-image:
            linear-gradient(rgba(30, 74, 122, 0.05) 1px, transparent 1px),
            linear-gradient(90deg, rgba(30, 74, 122, 0.05) 1px, transparent 1px);
          background-size: 20px 20px;
        }

        .canvas-surface {
          position: absolute;
          inset: 10px;
          background: #e8f4f8;
          border-radius: 4px;
        }

        .surface-court {
          position: absolute;
          top: 20%;
          left: 15%;
          width: 70%;
          height: 60%;
          border: 2px solid #00a6a3;
          border-radius: 4px;
          opacity: 0.8;
        }

        .surface-court::before {
          content: '';
          position: absolute;
          top: 50%;
          left: 0;
          right: 0;
          height: 2px;
          background: #00a6a3;
        }

        .surface-court::after {
          content: '';
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 20px;
          height: 20px;
          border: 2px solid #00a6a3;
          border-radius: 50%;
        }

        .surface-motif {
          position: absolute;
          bottom: 10%;
          right: 10%;
          width: 35px;
          height: 35px;
          background: var(--accent);
          border-radius: 50%;
          opacity: 0.8;
          animation: motifPulse 3s ease-in-out infinite;
        }

        @keyframes motifPulse {
          0%, 100% { transform: scale(1); opacity: 0.8; }
          50% { transform: scale(1.1); opacity: 1; }
        }

        .capability-pill {
          position: absolute;
          display: flex;
          align-items: center;
          gap: 0.5rem;
          padding: 0.625rem 1rem;
          background: white;
          border-radius: 50px;
          box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
          font-size: 0.8125rem;
          font-weight: 500;
          color: var(--text);
          animation: pillFloat 4s ease-in-out infinite;
        }

        .pill-courts {
          top: 10%;
          left: 5%;
          animation-delay: 0s;
        }

        .pill-courts svg {
          color: #00a6a3;
        }

        .pill-ai {
          top: 5%;
          right: 10%;
          animation-delay: 0.5s;
        }

        .pill-ai svg {
          color: var(--accent);
        }

        .pill-upload {
          bottom: 15%;
          left: 8%;
          animation-delay: 1s;
        }

        .pill-upload svg {
          color: var(--primary);
        }

        .pill-layers {
          bottom: 10%;
          right: 5%;
          animation-delay: 1.5s;
        }

        .pill-layers svg {
          color: #30D5C8;
        }

        @keyframes pillFloat {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-8px); }
        }

        .showcase-tagline {
          font-family: 'Overpass', sans-serif;
          font-size: 1.5rem;
          font-weight: 600;
          color: var(--text);
          margin-bottom: 2rem;
        }

        .showcase-features {
          display: flex;
          justify-content: center;
          gap: 2rem;
          flex-wrap: wrap;
          margin-bottom: 2rem;
        }

        .showcase-feature {
          display: flex;
          align-items: center;
          gap: 0.625rem;
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .feature-badge {
          padding: 0.25rem 0.625rem;
          border-radius: 50px;
          font-size: 0.625rem;
          font-weight: 700;
          letter-spacing: 0.05em;
        }

        .ai-badge {
          background: rgba(255, 107, 53, 0.1);
          color: var(--accent);
        }

        .template-badge {
          background: rgba(0, 166, 163, 0.1);
          color: #00a6a3;
        }

        .compose-badge {
          background: rgba(30, 74, 122, 0.1);
          color: var(--primary);
        }

        .showcase-cta {
          margin: 0 auto;
        }

        /* Unified Features Grid */
        .unified-features {
          grid-template-columns: repeat(3, 1fr);
        }

        /* Infinite symbol styling */
        .infinite-symbol {
          font-size: 3.5rem;
          line-height: 1;
        }

        /* Benefits Grid 4 columns */
        .benefits-grid-4 {
          grid-template-columns: repeat(4, 1fr);
        }

        /* Palette Section */
        .palette-section {
          padding: 6rem 4rem;
          background: var(--bg-dark);
        }

        .palette-grid {
          display: grid;
          grid-template-columns: repeat(7, 1fr);
          gap: 1rem;
          max-width: 1000px;
          margin: 0 auto;
        }

        .palette-swatch {
          animation: swatchReveal 0.5s ease-out forwards;
          animation-delay: var(--delay);
          opacity: 0;
          transform: translateY(20px);
        }

        @keyframes swatchReveal {
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .swatch-color {
          aspect-ratio: 1;
          background: var(--swatch-color);
          border-radius: 8px;
          margin-bottom: 0.5rem;
          transition: transform 0.2s;
        }

        .palette-swatch:hover .swatch-color {
          transform: scale(1.1);
        }

        .swatch-info {
          text-align: center;
        }

        .swatch-name {
          display: block;
          font-size: 0.6875rem;
          font-weight: 500;
          color: white;
        }

        .swatch-code {
          display: block;
          font-size: 0.625rem;
          color: rgba(255, 255, 255, 0.5);
        }

        /* Benefits */
        .benefits {
          padding: 6rem 4rem;
          background: white;
        }

        .benefits-grid {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 3rem;
          max-width: 1000px;
          margin: 0 auto;
          text-align: center;
        }

        .benefit-metric {
          font-family: 'Overpass', sans-serif;
          font-size: 4rem;
          font-weight: 700;
          color: var(--accent);
          line-height: 1;
        }

        .benefit-label {
          font-family: 'Overpass', sans-serif;
          font-size: 1.125rem;
          font-weight: 600;
          color: var(--text);
          margin: 0.5rem 0 1rem;
        }

        .benefit p {
          font-size: 0.875rem;
          color: var(--text-secondary);
          line-height: 1.6;
          margin: 0;
        }

        /* Company Footer */
        .landing-footer {
          padding: 3rem 4rem;
          background: var(--bg-dark);
          border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-content {
          max-width: 1200px;
          margin: 0 auto;
          display: flex;
          justify-content: space-between;
          align-items: center;
          flex-wrap: wrap;
          gap: 2rem;
        }

        .footer-brand {
          display: flex;
          flex-direction: column;
          gap: 0.25rem;
        }

        .footer-logo {
          font-family: 'Overpass', sans-serif;
          font-size: 1.25rem;
          font-weight: 600;
          color: white;
        }

        .footer-tagline {
          font-size: 0.875rem;
          color: rgba(255, 255, 255, 0.8);
        }

        .footer-division {
          font-size: 0.75rem;
          color: rgba(255, 255, 255, 0.5);
        }

        .footer-links {
          display: flex;
          gap: 2rem;
        }

        .footer-links a {
          font-size: 0.875rem;
          color: rgba(255, 255, 255, 0.7);
          text-decoration: none;
          transition: color 0.2s;
        }

        .footer-links a:hover {
          color: var(--accent);
        }

        /* CTA Footer */
        .cta-footer {
          padding: 6rem 4rem;
          background: var(--bg);
          text-align: center;
        }

        .cta-content h2 {
          font-family: 'Overpass', sans-serif;
          font-size: 2.5rem;
          font-weight: 700;
          color: var(--text);
          margin: 0 0 1rem;
        }

        .cta-content > p {
          font-size: 1.125rem;
          color: var(--text-secondary);
          margin-bottom: 2rem;
        }

        .cta-note {
          margin-top: 1.5rem;
          font-size: 0.875rem;
          color: var(--text-light);
        }

        .cta-note a {
          color: var(--primary);
          text-decoration: none;
        }

        .cta-note a:hover {
          text-decoration: underline;
        }

        /* Modal */
        .modal-overlay {
          position: fixed;
          inset: 0;
          background: rgba(0, 0, 0, 0.5);
          backdrop-filter: blur(4px);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 2000;
          padding: 2rem;
        }

        .sign-in-modal {
          background: white;
          border-radius: 16px;
          padding: 2.5rem;
          width: 100%;
          max-width: 400px;
          position: relative;
          animation: modalSlide 0.3s ease-out;
        }

        @keyframes modalSlide {
          from {
            opacity: 0;
            transform: translateY(-20px);
          }
        }

        .modal-close {
          position: absolute;
          top: 1rem;
          right: 1rem;
          width: 32px;
          height: 32px;
          display: flex;
          align-items: center;
          justify-content: center;
          background: none;
          border: none;
          color: var(--text-light);
          cursor: pointer;
          border-radius: 6px;
          transition: all 0.2s;
        }

        .modal-close:hover {
          background: var(--bg);
          color: var(--text);
        }

        .modal-header {
          text-align: center;
          margin-bottom: 1.5rem;
        }

        .modal-header h2 {
          font-family: 'Overpass', sans-serif;
          font-size: 1.5rem;
          font-weight: 600;
          margin: 0 0 0.25rem;
        }

        .modal-header p {
          font-size: 0.875rem;
          color: var(--text-secondary);
          margin: 0;
        }

        .form-error {
          padding: 0.75rem 1rem;
          background: #fef2f2;
          color: #dc2626;
          border-radius: 8px;
          font-size: 0.875rem;
          margin-bottom: 1rem;
        }

        .form-group {
          margin-bottom: 1rem;
        }

        .form-group label {
          display: block;
          font-size: 0.875rem;
          font-weight: 500;
          margin-bottom: 0.5rem;
        }

        .form-group input {
          width: 100%;
          padding: 0.75rem 1rem;
          border: 1px solid var(--border);
          border-radius: 8px;
          font-family: inherit;
          font-size: 0.9375rem;
          transition: all 0.2s;
        }

        .form-group input:focus {
          outline: none;
          border-color: var(--primary);
          box-shadow: 0 0 0 3px rgba(30, 74, 122, 0.1);
        }

        .submit-btn {
          width: 100%;
          padding: 0.875rem;
          background: var(--accent);
          color: white;
          border: none;
          border-radius: 8px;
          font-family: inherit;
          font-size: 0.9375rem;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.2s;
        }

        .submit-btn:hover:not(:disabled) {
          background: var(--accent-hover);
        }

        .submit-btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }

        .modal-footer-text {
          text-align: center;
          font-size: 0.8125rem;
          color: var(--text-light);
          margin: 1.5rem 0 0;
        }

        /* Responsive */
        @media (max-width: 1024px) {
          .hero {
            grid-template-columns: 1fr;
            text-align: center;
          }

          .hero-content {
            max-width: 600px;
            margin: 0 auto;
          }

          .hero-subtitle {
            margin-left: auto;
            margin-right: auto;
          }

          .hero-ctas {
            justify-content: center;
          }

          .hero-visual {
            display: none;
          }

          .showcase-canvas {
            height: 240px;
          }

          .capability-pill {
            padding: 0.5rem 0.75rem;
            font-size: 0.75rem;
          }

          .features-grid {
            grid-template-columns: repeat(2, 1fr);
          }

          .unified-features {
            grid-template-columns: repeat(2, 1fr);
          }

          .feature-highlight {
            grid-column: span 2;
          }

          .benefits-grid-4 {
            grid-template-columns: repeat(2, 1fr);
          }

          .palette-grid {
            grid-template-columns: repeat(5, 1fr);
          }
        }

        @media (max-width: 768px) {
          .landing-nav {
            padding: 1rem 1.5rem;
          }

          .nav-links {
            gap: 1rem;
          }

          .hero {
            padding: 6rem 1.5rem 3rem;
          }

          .hero h1 {
            font-size: 2.5rem;
          }

          .steps-container {
            flex-direction: column;
            gap: 0;
          }

          .step-connector {
            display: none;
          }

          .features-grid,
          .unified-features {
            grid-template-columns: 1fr;
          }

          .feature-highlight {
            grid-column: span 1;
          }

          .section-header h2 {
            font-size: 2rem;
          }

          .how-it-works,
          .features,
          .palette-section,
          .benefits,
          .cta-footer,
          .unified-showcase,
          .landing-footer {
            padding: 4rem 1.5rem;
          }

          .footer-content {
            flex-direction: column;
            text-align: center;
          }

          .footer-links {
            flex-direction: column;
            gap: 1rem;
          }

          .logo-byline {
            display: none;
          }

          .showcase-card {
            padding: 2rem 1.5rem;
          }

          .showcase-canvas {
            height: 200px;
          }

          .canvas-preview {
            width: 180px;
            height: 120px;
          }

          .capability-pill {
            display: none;
          }

          .showcase-features {
            flex-direction: column;
            gap: 1rem;
          }

          .showcase-tagline {
            font-size: 1.25rem;
          }

          .benefits-grid,
          .benefits-grid-4 {
            grid-template-columns: 1fr;
            gap: 2rem;
          }

          .palette-grid {
            grid-template-columns: repeat(4, 1fr);
          }
        }

        @media (max-width: 480px) {
          .nav-links button:not(.nav-cta) {
            display: none;
          }

          .hero h1 {
            font-size: 2rem;
          }

          .cta-content h2 {
            font-size: 1.75rem;
          }

          .palette-grid {
            grid-template-columns: repeat(3, 1fr);
          }
        }
      `})]})}function YW({user:t,onPasswordSet:e}){const[n,r]=O.useState(""),[s,i]=O.useState(""),[a,l]=O.useState(!1),[c,d]=O.useState(""),u=async p=>{if(p.preventDefault(),d(""),n.length<8){d("Password must be at least 8 characters long");return}if(!/[A-Z]/.test(n)){d("Password must contain at least one uppercase letter");return}if(!/[a-z]/.test(n)){d("Password must contain at least one lowercase letter");return}if(!/[0-9]/.test(n)){d("Password must contain at least one number");return}if(n!==s){d("Passwords do not match");return}l(!0);try{await Vr.updatePassword(n),e()}catch(h){d(h.message||"Failed to set password. Please try again.")}finally{l(!1)}};return o.jsx("div",{className:"tpv-studio",children:o.jsx("div",{className:"tpv-studio__container",style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh"},children:o.jsxs("div",{style:{maxWidth:"400px",width:"100%",padding:"2rem",background:"#fff",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[o.jsx("h2",{style:{marginBottom:"0.5rem",fontSize:"1.5rem"},children:"Welcome to TPV Studio"}),o.jsxs("p",{style:{marginBottom:"1.5rem",color:"#666",fontSize:"0.9rem"},children:["Please set a password for your account: ",o.jsx("strong",{children:t.email})]}),o.jsxs("form",{onSubmit:u,children:[o.jsxs("div",{style:{marginBottom:"1rem"},children:[o.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",fontWeight:"500"},children:"New Password"}),o.jsx("input",{type:"password",value:n,onChange:p=>r(p.target.value),placeholder:"Enter your password",required:!0,minLength:8,style:{width:"100%",padding:"0.75rem",border:"1px solid #ddd",borderRadius:"4px",fontSize:"1rem"}}),o.jsx("small",{style:{display:"block",marginTop:"0.25rem",color:"#666"},children:"At least 8 characters with uppercase, lowercase, and a number"})]}),o.jsxs("div",{style:{marginBottom:"1.5rem"},children:[o.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",fontWeight:"500"},children:"Confirm Password"}),o.jsx("input",{type:"password",value:s,onChange:p=>i(p.target.value),placeholder:"Confirm your password",required:!0,minLength:8,style:{width:"100%",padding:"0.75rem",border:"1px solid #ddd",borderRadius:"4px",fontSize:"1rem"}})]}),c&&o.jsx("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"#fee",border:"1px solid #fcc",borderRadius:"4px",color:"#c00",fontSize:"0.9rem"},children:c}),o.jsx("button",{type:"submit",disabled:a,style:{width:"100%",padding:"0.75rem",background:a?"#ccc":"#007bff",color:"#fff",border:"none",borderRadius:"4px",fontSize:"1rem",fontWeight:"500",cursor:a?"not-allowed":"pointer"},children:a?"Setting Password...":"Set Password"})]})]})})})}function qW(){const[t,e]=O.useState(null),[n,r]=O.useState(!0),[s,i]=O.useState(!1),[a,l]=O.useState(!1),[c,d]=O.useState(!1),[u,p]=O.useState(!1),[h,f]=O.useState(null),[m,g]=O.useState(null),v=async()=>{try{const w=await Vr.getSession();if(!(w!=null&&w.access_token)){d(!1);return}const j=await fetch("/api/admin/users",{headers:{Authorization:`Bearer ${w.access_token}`}});d(j.ok)}catch{console.error("[APP] Admin check failed"),d(!1)}},x=async w=>{try{console.log("[APP] Loading design from URL:",w);const{design:j}=await Ol(w);if(j){y(j);const _=new URL(window.location);_.searchParams.delete("design"),window.history.replaceState({},"",_)}}catch(j){console.error("[APP] Failed to load design from URL:",j)}};O.useEffect(()=>{Vr.getSession().then(j=>{var S;const _=(j==null?void 0:j.user)||null;if(e(_),r(!1),_){const E=(S=_.user_metadata)==null?void 0:S.password_setup_complete;p(!E),v();const M=new URLSearchParams(window.location.search).get("design");M&&x(M)}});const{data:w}=Vr.onAuthStateChange((j,_)=>{var E;const S=(_==null?void 0:_.user)||null;if(e(S),S){const T=(E=S.user_metadata)==null?void 0:E.password_setup_complete;p(!T),v()}else d(!1),p(!1)});return()=>w==null?void 0:w.unsubscribe()},[]);const y=w=>{f(w),g(w.name)},b=async()=>{p(!1);const w=await Vr.getSession();e((w==null?void 0:w.user)||null)};return n?o.jsx("div",{className:"tpv-studio",children:o.jsx("div",{className:"tpv-studio__container",children:o.jsxs("div",{className:"tpv-studio__empty",children:[o.jsx("div",{className:"tpv-studio__spinner"}),o.jsx("p",{children:"Loading..."})]})})}):t?u?o.jsx(YW,{user:t,onPasswordSet:b}):a?o.jsx("div",{className:"tpv-studio",children:o.jsx(zW,{onClose:()=>l(!1)})}):o.jsx(vE,{children:o.jsxs("div",{className:"tpv-studio",children:[o.jsx(MW,{onShowDesigns:()=>i(!0),onShowAdmin:()=>l(!0),isAdmin:c,currentDesignName:m}),o.jsx("main",{className:"tpv-studio__container tpv-studio__container--full",children:o.jsx(AW,{loadedDesign:h})}),s&&o.jsx(LW,{onClose:()=>i(!1),onLoadDesign:y})]})}):o.jsx(VW,{})}ph.createRoot(document.getElementById("root")).render(o.jsx(L.StrictMode,{children:o.jsx(qW,{})}))});export default XW();
//# sourceMappingURL=index-Bcu6-ii2.js.map
