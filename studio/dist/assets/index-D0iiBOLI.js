var J2=Object.defineProperty;var Q2=(t,e,n)=>e in t?J2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ek=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var rc=(t,e,n)=>Q2(t,typeof e!="symbol"?e+"":e,n);var _G=ek((fr,mr)=>{function tk(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();var Qs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $l(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function nk(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var s=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:function(){return t[r]}})}),n}var Cv={exports:{}},Wd={},Ev={exports:{}},bt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dl=Symbol.for("react.element"),rk=Symbol.for("react.portal"),sk=Symbol.for("react.fragment"),ik=Symbol.for("react.strict_mode"),ok=Symbol.for("react.profiler"),ak=Symbol.for("react.provider"),lk=Symbol.for("react.context"),ck=Symbol.for("react.forward_ref"),dk=Symbol.for("react.suspense"),uk=Symbol.for("react.memo"),hk=Symbol.for("react.lazy"),fg=Symbol.iterator;function pk(t){return t===null||typeof t!="object"?null:(t=fg&&t[fg]||t["@@iterator"],typeof t=="function"?t:null)}var Tv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Nv=Object.assign,Pv={};function la(t,e,n){this.props=t,this.context=e,this.refs=Pv,this.updater=n||Tv}la.prototype.isReactComponent={};la.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};la.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Rv(){}Rv.prototype=la.prototype;function qp(t,e,n){this.props=t,this.context=e,this.refs=Pv,this.updater=n||Tv}var Xp=qp.prototype=new Rv;Xp.constructor=qp;Nv(Xp,la.prototype);Xp.isPureReactComponent=!0;var mg=Array.isArray,Ov=Object.prototype.hasOwnProperty,Zp={current:null},Av={key:!0,ref:!0,__self:!0,__source:!0};function Mv(t,e,n){var r,s={},i=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(i=""+e.key),e)Ov.call(e,r)&&!Av.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];s.children=c}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:Dl,type:t,key:i,ref:a,props:s,_owner:Zp.current}}function fk(t,e){return{$$typeof:Dl,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Kp(t){return typeof t=="object"&&t!==null&&t.$$typeof===Dl}function mk(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var gg=/\/+/g;function Cu(t,e){return typeof t=="object"&&t!==null&&t.key!=null?mk(""+t.key):e.toString(36)}function Hc(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(i){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case Dl:case rk:a=!0}}if(a)return a=t,s=s(a),t=r===""?"."+Cu(a,0):r,mg(s)?(n="",t!=null&&(n=t.replace(gg,"$&/")+"/"),Hc(s,e,n,"",function(d){return d})):s!=null&&(Kp(s)&&(s=fk(s,n+(!s.key||a&&a.key===s.key?"":(""+s.key).replace(gg,"$&/")+"/")+t)),e.push(s)),1;if(a=0,r=r===""?".":r+":",mg(t))for(var l=0;l<t.length;l++){i=t[l];var c=r+Cu(i,l);a+=Hc(i,e,n,c,s)}else if(c=pk(t),typeof c=="function")for(t=c.call(t),l=0;!(i=t.next()).done;)i=i.value,c=r+Cu(i,l++),a+=Hc(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function sc(t,e,n){if(t==null)return t;var r=[],s=0;return Hc(t,r,"","",function(i){return e.call(n,i,s++)}),r}function gk(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Wn={current:null},Uc={transition:null},yk={ReactCurrentDispatcher:Wn,ReactCurrentBatchConfig:Uc,ReactCurrentOwner:Zp};function $v(){throw Error("act(...) is not supported in production builds of React.")}bt.Children={map:sc,forEach:function(t,e,n){sc(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return sc(t,function(){e++}),e},toArray:function(t){return sc(t,function(e){return e})||[]},only:function(t){if(!Kp(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};bt.Component=la;bt.Fragment=sk;bt.Profiler=ok;bt.PureComponent=qp;bt.StrictMode=ik;bt.Suspense=dk;bt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yk;bt.act=$v;bt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=Nv({},t.props),s=t.key,i=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,a=Zp.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)Ov.call(e,c)&&!Av.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];r.children=l}return{$$typeof:Dl,type:t.type,key:s,ref:i,props:r,_owner:a}};bt.createContext=function(t){return t={$$typeof:lk,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:ak,_context:t},t.Consumer=t};bt.createElement=Mv;bt.createFactory=function(t){var e=Mv.bind(null,t);return e.type=t,e};bt.createRef=function(){return{current:null}};bt.forwardRef=function(t){return{$$typeof:ck,render:t}};bt.isValidElement=Kp;bt.lazy=function(t){return{$$typeof:hk,_payload:{_status:-1,_result:t},_init:gk}};bt.memo=function(t,e){return{$$typeof:uk,type:t,compare:e===void 0?null:e}};bt.startTransition=function(t){var e=Uc.transition;Uc.transition={};try{t()}finally{Uc.transition=e}};bt.unstable_act=$v;bt.useCallback=function(t,e){return Wn.current.useCallback(t,e)};bt.useContext=function(t){return Wn.current.useContext(t)};bt.useDebugValue=function(){};bt.useDeferredValue=function(t){return Wn.current.useDeferredValue(t)};bt.useEffect=function(t,e){return Wn.current.useEffect(t,e)};bt.useId=function(){return Wn.current.useId()};bt.useImperativeHandle=function(t,e,n){return Wn.current.useImperativeHandle(t,e,n)};bt.useInsertionEffect=function(t,e){return Wn.current.useInsertionEffect(t,e)};bt.useLayoutEffect=function(t,e){return Wn.current.useLayoutEffect(t,e)};bt.useMemo=function(t,e){return Wn.current.useMemo(t,e)};bt.useReducer=function(t,e,n){return Wn.current.useReducer(t,e,n)};bt.useRef=function(t){return Wn.current.useRef(t)};bt.useState=function(t){return Wn.current.useState(t)};bt.useSyncExternalStore=function(t,e,n){return Wn.current.useSyncExternalStore(t,e,n)};bt.useTransition=function(){return Wn.current.useTransition()};bt.version="18.3.1";Ev.exports=bt;var O=Ev.exports;const D=$l(O);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xk=O,vk=Symbol.for("react.element"),bk=Symbol.for("react.fragment"),wk=Object.prototype.hasOwnProperty,_k=xk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,kk={key:!0,ref:!0,__self:!0,__source:!0};function Dv(t,e,n){var r,s={},i=null,a=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)wk.call(e,r)&&!kk.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:vk,type:t,key:i,ref:a,props:s,_owner:_k.current}}Wd.Fragment=bk;Wd.jsx=Dv;Wd.jsxs=Dv;Cv.exports=Wd;var o=Cv.exports,Eh={},Lv={exports:{}},vr={},Iv={exports:{}},zv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(K,F){var Z=K.length;K.push(F);e:for(;0<Z;){var U=Z-1>>>1,X=K[U];if(0<s(X,F))K[U]=F,K[Z]=X,Z=U;else break e}}function n(K){return K.length===0?null:K[0]}function r(K){if(K.length===0)return null;var F=K[0],Z=K.pop();if(Z!==F){K[0]=Z;e:for(var U=0,X=K.length,ge=X>>>1;U<ge;){var de=2*(U+1)-1,Q=K[de],ke=de+1,Oe=K[ke];if(0>s(Q,Z))ke<X&&0>s(Oe,Q)?(K[U]=Oe,K[ke]=Z,U=ke):(K[U]=Q,K[de]=Z,U=de);else if(ke<X&&0>s(Oe,Z))K[U]=Oe,K[ke]=Z,U=ke;else break e}}return F}function s(K,F){var Z=K.sortIndex-F.sortIndex;return Z!==0?Z:K.id-F.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],d=[],u=1,h=null,p=3,f=!1,m=!1,y=!1,v=typeof setTimeout=="function"?setTimeout:null,x=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(K){for(var F=n(d);F!==null;){if(F.callback===null)r(d);else if(F.startTime<=K)r(d),F.sortIndex=F.expirationTime,e(c,F);else break;F=n(d)}}function b(K){if(y=!1,w(K),!m)if(n(c)!==null)m=!0,fe(k);else{var F=n(d);F!==null&&V(b,F.startTime-K)}}function k(K,F){m=!1,y&&(y=!1,x(E),E=-1),f=!0;var Z=p;try{for(w(F),h=n(c);h!==null&&(!(h.expirationTime>F)||K&&!W());){var U=h.callback;if(typeof U=="function"){h.callback=null,p=h.priorityLevel;var X=U(h.expirationTime<=F);F=t.unstable_now(),typeof X=="function"?h.callback=X:h===n(c)&&r(c),w(F)}else r(c);h=n(c)}if(h!==null)var ge=!0;else{var de=n(d);de!==null&&V(b,de.startTime-F),ge=!1}return ge}finally{h=null,p=Z,f=!1}}var _=!1,S=null,E=-1,T=5,R=-1;function W(){return!(t.unstable_now()-R<T)}function P(){if(S!==null){var K=t.unstable_now();R=K;var F=!0;try{F=S(!0,K)}finally{F?I():(_=!1,S=null)}}else _=!1}var I;if(typeof g=="function")I=function(){g(P)};else if(typeof MessageChannel<"u"){var C=new MessageChannel,$=C.port2;C.port1.onmessage=P,I=function(){$.postMessage(null)}}else I=function(){v(P,0)};function fe(K){S=K,_||(_=!0,I())}function V(K,F){E=v(function(){K(t.unstable_now())},F)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(K){K.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,fe(k))},t.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<K?Math.floor(1e3/K):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(K){switch(p){case 1:case 2:case 3:var F=3;break;default:F=p}var Z=p;p=F;try{return K()}finally{p=Z}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(K,F){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var Z=p;p=K;try{return F()}finally{p=Z}},t.unstable_scheduleCallback=function(K,F,Z){var U=t.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?U+Z:U):Z=U,K){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=Z+X,K={id:u++,callback:F,priorityLevel:K,startTime:Z,expirationTime:X,sortIndex:-1},Z>U?(K.sortIndex=Z,e(d,K),n(c)===null&&K===n(d)&&(y?(x(E),E=-1):y=!0,V(b,Z-U))):(K.sortIndex=X,e(c,K),m||f||(m=!0,fe(k))),K},t.unstable_shouldYield=W,t.unstable_wrapCallback=function(K){var F=p;return function(){var Z=p;p=F;try{return K.apply(this,arguments)}finally{p=Z}}}})(zv);Iv.exports=zv;var Sk=Iv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jk=O,yr=Sk;function Ae(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Fv=new Set,hl={};function Vi(t,e){Qo(t,e),Qo(t+"Capture",e)}function Qo(t,e){for(hl[t]=e,t=0;t<e.length;t++)Fv.add(e[t])}var Ms=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Th=Object.prototype.hasOwnProperty,Ck=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,yg={},xg={};function Ek(t){return Th.call(xg,t)?!0:Th.call(yg,t)?!1:Ck.test(t)?xg[t]=!0:(yg[t]=!0,!1)}function Tk(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Nk(t,e,n,r){if(e===null||typeof e>"u"||Tk(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Gn(t,e,n,r,s,i,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=a}var jn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){jn[t]=new Gn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];jn[e]=new Gn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){jn[t]=new Gn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){jn[t]=new Gn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){jn[t]=new Gn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){jn[t]=new Gn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){jn[t]=new Gn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){jn[t]=new Gn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){jn[t]=new Gn(t,5,!1,t.toLowerCase(),null,!1,!1)});var Jp=/[\-:]([a-z])/g;function Qp(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Jp,Qp);jn[e]=new Gn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Jp,Qp);jn[e]=new Gn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Jp,Qp);jn[e]=new Gn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){jn[t]=new Gn(t,1,!1,t.toLowerCase(),null,!1,!1)});jn.xlinkHref=new Gn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){jn[t]=new Gn(t,1,!1,t.toLowerCase(),null,!0,!0)});function ef(t,e,n,r){var s=jn.hasOwnProperty(e)?jn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Nk(e,n,s,r)&&(n=null),r||s===null?Ek(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Is=jk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ic=Symbol.for("react.element"),Oo=Symbol.for("react.portal"),Ao=Symbol.for("react.fragment"),tf=Symbol.for("react.strict_mode"),Nh=Symbol.for("react.profiler"),Bv=Symbol.for("react.provider"),Hv=Symbol.for("react.context"),nf=Symbol.for("react.forward_ref"),Ph=Symbol.for("react.suspense"),Rh=Symbol.for("react.suspense_list"),rf=Symbol.for("react.memo"),Ys=Symbol.for("react.lazy"),Uv=Symbol.for("react.offscreen"),vg=Symbol.iterator;function Pa(t){return t===null||typeof t!="object"?null:(t=vg&&t[vg]||t["@@iterator"],typeof t=="function"?t:null)}var nn=Object.assign,Eu;function Ga(t){if(Eu===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Eu=e&&e[1]||""}return`
`+Eu+t}var Tu=!1;function Nu(t,e){if(!t||Tu)return"";Tu=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),i=r.stack.split(`
`),a=s.length-1,l=i.length-1;1<=a&&0<=l&&s[a]!==i[l];)l--;for(;1<=a&&0<=l;a--,l--)if(s[a]!==i[l]){if(a!==1||l!==1)do if(a--,l--,0>l||s[a]!==i[l]){var c=`
`+s[a].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=a&&0<=l);break}}}finally{Tu=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Ga(t):""}function Pk(t){switch(t.tag){case 5:return Ga(t.type);case 16:return Ga("Lazy");case 13:return Ga("Suspense");case 19:return Ga("SuspenseList");case 0:case 2:case 15:return t=Nu(t.type,!1),t;case 11:return t=Nu(t.type.render,!1),t;case 1:return t=Nu(t.type,!0),t;default:return""}}function Oh(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ao:return"Fragment";case Oo:return"Portal";case Nh:return"Profiler";case tf:return"StrictMode";case Ph:return"Suspense";case Rh:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Hv:return(t.displayName||"Context")+".Consumer";case Bv:return(t._context.displayName||"Context")+".Provider";case nf:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case rf:return e=t.displayName||null,e!==null?e:Oh(t.type)||"Memo";case Ys:e=t._payload,t=t._init;try{return Oh(t(e))}catch{}}return null}function Rk(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Oh(e);case 8:return e===tf?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ui(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Wv(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Ok(t){var e=Wv(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(a){r=""+a,i.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function oc(t){t._valueTracker||(t._valueTracker=Ok(t))}function Gv(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Wv(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function td(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Ah(t,e){var n=e.checked;return nn({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function bg(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=ui(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Vv(t,e){e=e.checked,e!=null&&ef(t,"checked",e,!1)}function Mh(t,e){Vv(t,e);var n=ui(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?$h(t,e.type,n):e.hasOwnProperty("defaultValue")&&$h(t,e.type,ui(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function wg(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function $h(t,e,n){(e!=="number"||td(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Va=Array.isArray;function Go(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+ui(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function Dh(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ae(91));return nn({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function _g(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Ae(92));if(Va(n)){if(1<n.length)throw Error(Ae(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:ui(n)}}function Yv(t,e){var n=ui(e.value),r=ui(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function kg(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function qv(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Lh(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?qv(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ac,Xv=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ac=ac||document.createElement("div"),ac.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ac.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function pl(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Qa={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ak=["Webkit","ms","Moz","O"];Object.keys(Qa).forEach(function(t){Ak.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Qa[e]=Qa[t]})});function Zv(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Qa.hasOwnProperty(t)&&Qa[t]?(""+e).trim():e+"px"}function Kv(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=Zv(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var Mk=nn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ih(t,e){if(e){if(Mk[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ae(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ae(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ae(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ae(62))}}function zh(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Fh=null;function sf(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Bh=null,Vo=null,Yo=null;function Sg(t){if(t=zl(t)){if(typeof Bh!="function")throw Error(Ae(280));var e=t.stateNode;e&&(e=Xd(e),Bh(t.stateNode,t.type,e))}}function Jv(t){Vo?Yo?Yo.push(t):Yo=[t]:Vo=t}function Qv(){if(Vo){var t=Vo,e=Yo;if(Yo=Vo=null,Sg(t),e)for(t=0;t<e.length;t++)Sg(e[t])}}function eb(t,e){return t(e)}function tb(){}var Pu=!1;function nb(t,e,n){if(Pu)return t(e,n);Pu=!0;try{return eb(t,e,n)}finally{Pu=!1,(Vo!==null||Yo!==null)&&(tb(),Qv())}}function fl(t,e){var n=t.stateNode;if(n===null)return null;var r=Xd(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Ae(231,e,typeof n));return n}var Hh=!1;if(Ms)try{var Ra={};Object.defineProperty(Ra,"passive",{get:function(){Hh=!0}}),window.addEventListener("test",Ra,Ra),window.removeEventListener("test",Ra,Ra)}catch{Hh=!1}function $k(t,e,n,r,s,i,a,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(u){this.onError(u)}}var el=!1,nd=null,rd=!1,Uh=null,Dk={onError:function(t){el=!0,nd=t}};function Lk(t,e,n,r,s,i,a,l,c){el=!1,nd=null,$k.apply(Dk,arguments)}function Ik(t,e,n,r,s,i,a,l,c){if(Lk.apply(this,arguments),el){if(el){var d=nd;el=!1,nd=null}else throw Error(Ae(198));rd||(rd=!0,Uh=d)}}function Yi(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function rb(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function jg(t){if(Yi(t)!==t)throw Error(Ae(188))}function zk(t){var e=t.alternate;if(!e){if(e=Yi(t),e===null)throw Error(Ae(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return jg(s),t;if(i===r)return jg(s),e;i=i.sibling}throw Error(Ae(188))}if(n.return!==r.return)n=s,r=i;else{for(var a=!1,l=s.child;l;){if(l===n){a=!0,n=s,r=i;break}if(l===r){a=!0,r=s,n=i;break}l=l.sibling}if(!a){for(l=i.child;l;){if(l===n){a=!0,n=i,r=s;break}if(l===r){a=!0,r=i,n=s;break}l=l.sibling}if(!a)throw Error(Ae(189))}}if(n.alternate!==r)throw Error(Ae(190))}if(n.tag!==3)throw Error(Ae(188));return n.stateNode.current===n?t:e}function sb(t){return t=zk(t),t!==null?ib(t):null}function ib(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=ib(t);if(e!==null)return e;t=t.sibling}return null}var ob=yr.unstable_scheduleCallback,Cg=yr.unstable_cancelCallback,Fk=yr.unstable_shouldYield,Bk=yr.unstable_requestPaint,dn=yr.unstable_now,Hk=yr.unstable_getCurrentPriorityLevel,of=yr.unstable_ImmediatePriority,ab=yr.unstable_UserBlockingPriority,sd=yr.unstable_NormalPriority,Uk=yr.unstable_LowPriority,lb=yr.unstable_IdlePriority,Gd=null,ms=null;function Wk(t){if(ms&&typeof ms.onCommitFiberRoot=="function")try{ms.onCommitFiberRoot(Gd,t,void 0,(t.current.flags&128)===128)}catch{}}var Qr=Math.clz32?Math.clz32:Yk,Gk=Math.log,Vk=Math.LN2;function Yk(t){return t>>>=0,t===0?32:31-(Gk(t)/Vk|0)|0}var lc=64,cc=4194304;function Ya(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function id(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,a=n&268435455;if(a!==0){var l=a&~s;l!==0?r=Ya(l):(i&=a,i!==0&&(r=Ya(i)))}else a=n&~s,a!==0?r=Ya(a):i!==0&&(r=Ya(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Qr(e),s=1<<n,r|=t[n],e&=~s;return r}function qk(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Xk(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var a=31-Qr(i),l=1<<a,c=s[a];c===-1?(!(l&n)||l&r)&&(s[a]=qk(l,e)):c<=e&&(t.expiredLanes|=l),i&=~l}}function Wh(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function cb(){var t=lc;return lc<<=1,!(lc&4194240)&&(lc=64),t}function Ru(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Ll(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Qr(e),t[e]=n}function Zk(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Qr(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function af(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Qr(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var At=0;function db(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var ub,lf,hb,pb,fb,Gh=!1,dc=[],ri=null,si=null,ii=null,ml=new Map,gl=new Map,Zs=[],Kk="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Eg(t,e){switch(t){case"focusin":case"focusout":ri=null;break;case"dragenter":case"dragleave":si=null;break;case"mouseover":case"mouseout":ii=null;break;case"pointerover":case"pointerout":ml.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":gl.delete(e.pointerId)}}function Oa(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=zl(e),e!==null&&lf(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function Jk(t,e,n,r,s){switch(e){case"focusin":return ri=Oa(ri,t,e,n,r,s),!0;case"dragenter":return si=Oa(si,t,e,n,r,s),!0;case"mouseover":return ii=Oa(ii,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return ml.set(i,Oa(ml.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,gl.set(i,Oa(gl.get(i)||null,t,e,n,r,s)),!0}return!1}function mb(t){var e=Ai(t.target);if(e!==null){var n=Yi(e);if(n!==null){if(e=n.tag,e===13){if(e=rb(n),e!==null){t.blockedOn=e,fb(t.priority,function(){hb(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Wc(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Vh(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Fh=r,n.target.dispatchEvent(r),Fh=null}else return e=zl(n),e!==null&&lf(e),t.blockedOn=n,!1;e.shift()}return!0}function Tg(t,e,n){Wc(t)&&n.delete(e)}function Qk(){Gh=!1,ri!==null&&Wc(ri)&&(ri=null),si!==null&&Wc(si)&&(si=null),ii!==null&&Wc(ii)&&(ii=null),ml.forEach(Tg),gl.forEach(Tg)}function Aa(t,e){t.blockedOn===e&&(t.blockedOn=null,Gh||(Gh=!0,yr.unstable_scheduleCallback(yr.unstable_NormalPriority,Qk)))}function yl(t){function e(s){return Aa(s,t)}if(0<dc.length){Aa(dc[0],t);for(var n=1;n<dc.length;n++){var r=dc[n];r.blockedOn===t&&(r.blockedOn=null)}}for(ri!==null&&Aa(ri,t),si!==null&&Aa(si,t),ii!==null&&Aa(ii,t),ml.forEach(e),gl.forEach(e),n=0;n<Zs.length;n++)r=Zs[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Zs.length&&(n=Zs[0],n.blockedOn===null);)mb(n),n.blockedOn===null&&Zs.shift()}var qo=Is.ReactCurrentBatchConfig,od=!0;function eS(t,e,n,r){var s=At,i=qo.transition;qo.transition=null;try{At=1,cf(t,e,n,r)}finally{At=s,qo.transition=i}}function tS(t,e,n,r){var s=At,i=qo.transition;qo.transition=null;try{At=4,cf(t,e,n,r)}finally{At=s,qo.transition=i}}function cf(t,e,n,r){if(od){var s=Vh(t,e,n,r);if(s===null)Bu(t,e,r,ad,n),Eg(t,r);else if(Jk(s,t,e,n,r))r.stopPropagation();else if(Eg(t,r),e&4&&-1<Kk.indexOf(t)){for(;s!==null;){var i=zl(s);if(i!==null&&ub(i),i=Vh(t,e,n,r),i===null&&Bu(t,e,r,ad,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else Bu(t,e,r,null,n)}}var ad=null;function Vh(t,e,n,r){if(ad=null,t=sf(r),t=Ai(t),t!==null)if(e=Yi(t),e===null)t=null;else if(n=e.tag,n===13){if(t=rb(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return ad=t,null}function gb(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Hk()){case of:return 1;case ab:return 4;case sd:case Uk:return 16;case lb:return 536870912;default:return 16}default:return 16}}var ei=null,df=null,Gc=null;function yb(){if(Gc)return Gc;var t,e=df,n=e.length,r,s="value"in ei?ei.value:ei.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var a=n-t;for(r=1;r<=a&&e[n-r]===s[i-r];r++);return Gc=s.slice(t,1<r?1-r:void 0)}function Vc(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function uc(){return!0}function Ng(){return!1}function br(t){function e(n,r,s,i,a){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=a,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?uc:Ng,this.isPropagationStopped=Ng,this}return nn(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=uc)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=uc)},persist:function(){},isPersistent:uc}),e}var ca={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},uf=br(ca),Il=nn({},ca,{view:0,detail:0}),nS=br(Il),Ou,Au,Ma,Vd=nn({},Il,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:hf,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ma&&(Ma&&t.type==="mousemove"?(Ou=t.screenX-Ma.screenX,Au=t.screenY-Ma.screenY):Au=Ou=0,Ma=t),Ou)},movementY:function(t){return"movementY"in t?t.movementY:Au}}),Pg=br(Vd),rS=nn({},Vd,{dataTransfer:0}),sS=br(rS),iS=nn({},Il,{relatedTarget:0}),Mu=br(iS),oS=nn({},ca,{animationName:0,elapsedTime:0,pseudoElement:0}),aS=br(oS),lS=nn({},ca,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),cS=br(lS),dS=nn({},ca,{data:0}),Rg=br(dS),uS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fS(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=pS[t])?!!e[t]:!1}function hf(){return fS}var mS=nn({},Il,{key:function(t){if(t.key){var e=uS[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Vc(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?hS[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:hf,charCode:function(t){return t.type==="keypress"?Vc(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Vc(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),gS=br(mS),yS=nn({},Vd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Og=br(yS),xS=nn({},Il,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:hf}),vS=br(xS),bS=nn({},ca,{propertyName:0,elapsedTime:0,pseudoElement:0}),wS=br(bS),_S=nn({},Vd,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),kS=br(_S),SS=[9,13,27,32],pf=Ms&&"CompositionEvent"in window,tl=null;Ms&&"documentMode"in document&&(tl=document.documentMode);var jS=Ms&&"TextEvent"in window&&!tl,xb=Ms&&(!pf||tl&&8<tl&&11>=tl),Ag=" ",Mg=!1;function vb(t,e){switch(t){case"keyup":return SS.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function bb(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Mo=!1;function CS(t,e){switch(t){case"compositionend":return bb(e);case"keypress":return e.which!==32?null:(Mg=!0,Ag);case"textInput":return t=e.data,t===Ag&&Mg?null:t;default:return null}}function ES(t,e){if(Mo)return t==="compositionend"||!pf&&vb(t,e)?(t=yb(),Gc=df=ei=null,Mo=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return xb&&e.locale!=="ko"?null:e.data;default:return null}}var TS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $g(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!TS[t.type]:e==="textarea"}function wb(t,e,n,r){Jv(r),e=ld(e,"onChange"),0<e.length&&(n=new uf("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var nl=null,xl=null;function NS(t){Ob(t,0)}function Yd(t){var e=Lo(t);if(Gv(e))return t}function PS(t,e){if(t==="change")return e}var _b=!1;if(Ms){var $u;if(Ms){var Du="oninput"in document;if(!Du){var Dg=document.createElement("div");Dg.setAttribute("oninput","return;"),Du=typeof Dg.oninput=="function"}$u=Du}else $u=!1;_b=$u&&(!document.documentMode||9<document.documentMode)}function Lg(){nl&&(nl.detachEvent("onpropertychange",kb),xl=nl=null)}function kb(t){if(t.propertyName==="value"&&Yd(xl)){var e=[];wb(e,xl,t,sf(t)),nb(NS,e)}}function RS(t,e,n){t==="focusin"?(Lg(),nl=e,xl=n,nl.attachEvent("onpropertychange",kb)):t==="focusout"&&Lg()}function OS(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Yd(xl)}function AS(t,e){if(t==="click")return Yd(e)}function MS(t,e){if(t==="input"||t==="change")return Yd(e)}function $S(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var ts=typeof Object.is=="function"?Object.is:$S;function vl(t,e){if(ts(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Th.call(e,s)||!ts(t[s],e[s]))return!1}return!0}function Ig(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function zg(t,e){var n=Ig(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Ig(n)}}function Sb(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Sb(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function jb(){for(var t=window,e=td();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=td(t.document)}return e}function ff(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function DS(t){var e=jb(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Sb(n.ownerDocument.documentElement,n)){if(r!==null&&ff(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=zg(n,i);var a=zg(n,r);s&&a&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var LS=Ms&&"documentMode"in document&&11>=document.documentMode,$o=null,Yh=null,rl=null,qh=!1;function Fg(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;qh||$o==null||$o!==td(r)||(r=$o,"selectionStart"in r&&ff(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),rl&&vl(rl,r)||(rl=r,r=ld(Yh,"onSelect"),0<r.length&&(e=new uf("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=$o)))}function hc(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Do={animationend:hc("Animation","AnimationEnd"),animationiteration:hc("Animation","AnimationIteration"),animationstart:hc("Animation","AnimationStart"),transitionend:hc("Transition","TransitionEnd")},Lu={},Cb={};Ms&&(Cb=document.createElement("div").style,"AnimationEvent"in window||(delete Do.animationend.animation,delete Do.animationiteration.animation,delete Do.animationstart.animation),"TransitionEvent"in window||delete Do.transitionend.transition);function qd(t){if(Lu[t])return Lu[t];if(!Do[t])return t;var e=Do[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Cb)return Lu[t]=e[n];return t}var Eb=qd("animationend"),Tb=qd("animationiteration"),Nb=qd("animationstart"),Pb=qd("transitionend"),Rb=new Map,Bg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function mi(t,e){Rb.set(t,e),Vi(e,[t])}for(var Iu=0;Iu<Bg.length;Iu++){var zu=Bg[Iu],IS=zu.toLowerCase(),zS=zu[0].toUpperCase()+zu.slice(1);mi(IS,"on"+zS)}mi(Eb,"onAnimationEnd");mi(Tb,"onAnimationIteration");mi(Nb,"onAnimationStart");mi("dblclick","onDoubleClick");mi("focusin","onFocus");mi("focusout","onBlur");mi(Pb,"onTransitionEnd");Qo("onMouseEnter",["mouseout","mouseover"]);Qo("onMouseLeave",["mouseout","mouseover"]);Qo("onPointerEnter",["pointerout","pointerover"]);Qo("onPointerLeave",["pointerout","pointerover"]);Vi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Vi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Vi("onBeforeInput",["compositionend","keypress","textInput","paste"]);Vi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Vi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Vi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var qa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),FS=new Set("cancel close invalid load scroll toggle".split(" ").concat(qa));function Hg(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,Ik(r,e,void 0,t),t.currentTarget=null}function Ob(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var a=r.length-1;0<=a;a--){var l=r[a],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==i&&s.isPropagationStopped())break e;Hg(s,l,d),i=c}else for(a=0;a<r.length;a++){if(l=r[a],c=l.instance,d=l.currentTarget,l=l.listener,c!==i&&s.isPropagationStopped())break e;Hg(s,l,d),i=c}}}if(rd)throw t=Uh,rd=!1,Uh=null,t}function Wt(t,e){var n=e[Qh];n===void 0&&(n=e[Qh]=new Set);var r=t+"__bubble";n.has(r)||(Ab(e,t,2,!1),n.add(r))}function Fu(t,e,n){var r=0;e&&(r|=4),Ab(n,t,r,e)}var pc="_reactListening"+Math.random().toString(36).slice(2);function bl(t){if(!t[pc]){t[pc]=!0,Fv.forEach(function(n){n!=="selectionchange"&&(FS.has(n)||Fu(n,!1,t),Fu(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[pc]||(e[pc]=!0,Fu("selectionchange",!1,e))}}function Ab(t,e,n,r){switch(gb(e)){case 1:var s=eS;break;case 4:s=tS;break;default:s=cf}n=s.bind(null,e,n,t),s=void 0,!Hh||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function Bu(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(a===4)for(a=r.return;a!==null;){var c=a.tag;if((c===3||c===4)&&(c=a.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;a=a.return}for(;l!==null;){if(a=Ai(l),a===null)return;if(c=a.tag,c===5||c===6){r=i=a;continue e}l=l.parentNode}}r=r.return}nb(function(){var d=i,u=sf(n),h=[];e:{var p=Rb.get(t);if(p!==void 0){var f=uf,m=t;switch(t){case"keypress":if(Vc(n)===0)break e;case"keydown":case"keyup":f=gS;break;case"focusin":m="focus",f=Mu;break;case"focusout":m="blur",f=Mu;break;case"beforeblur":case"afterblur":f=Mu;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=Pg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=sS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=vS;break;case Eb:case Tb:case Nb:f=aS;break;case Pb:f=wS;break;case"scroll":f=nS;break;case"wheel":f=kS;break;case"copy":case"cut":case"paste":f=cS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=Og}var y=(e&4)!==0,v=!y&&t==="scroll",x=y?p!==null?p+"Capture":null:p;y=[];for(var g=d,w;g!==null;){w=g;var b=w.stateNode;if(w.tag===5&&b!==null&&(w=b,x!==null&&(b=fl(g,x),b!=null&&y.push(wl(g,b,w)))),v)break;g=g.return}0<y.length&&(p=new f(p,m,null,n,u),h.push({event:p,listeners:y}))}}if(!(e&7)){e:{if(p=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",p&&n!==Fh&&(m=n.relatedTarget||n.fromElement)&&(Ai(m)||m[$s]))break e;if((f||p)&&(p=u.window===u?u:(p=u.ownerDocument)?p.defaultView||p.parentWindow:window,f?(m=n.relatedTarget||n.toElement,f=d,m=m?Ai(m):null,m!==null&&(v=Yi(m),m!==v||m.tag!==5&&m.tag!==6)&&(m=null)):(f=null,m=d),f!==m)){if(y=Pg,b="onMouseLeave",x="onMouseEnter",g="mouse",(t==="pointerout"||t==="pointerover")&&(y=Og,b="onPointerLeave",x="onPointerEnter",g="pointer"),v=f==null?p:Lo(f),w=m==null?p:Lo(m),p=new y(b,g+"leave",f,n,u),p.target=v,p.relatedTarget=w,b=null,Ai(u)===d&&(y=new y(x,g+"enter",m,n,u),y.target=w,y.relatedTarget=v,b=y),v=b,f&&m)t:{for(y=f,x=m,g=0,w=y;w;w=oo(w))g++;for(w=0,b=x;b;b=oo(b))w++;for(;0<g-w;)y=oo(y),g--;for(;0<w-g;)x=oo(x),w--;for(;g--;){if(y===x||x!==null&&y===x.alternate)break t;y=oo(y),x=oo(x)}y=null}else y=null;f!==null&&Ug(h,p,f,y,!1),m!==null&&v!==null&&Ug(h,v,m,y,!0)}}e:{if(p=d?Lo(d):window,f=p.nodeName&&p.nodeName.toLowerCase(),f==="select"||f==="input"&&p.type==="file")var k=PS;else if($g(p))if(_b)k=MS;else{k=OS;var _=RS}else(f=p.nodeName)&&f.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(k=AS);if(k&&(k=k(t,d))){wb(h,k,n,u);break e}_&&_(t,p,d),t==="focusout"&&(_=p._wrapperState)&&_.controlled&&p.type==="number"&&$h(p,"number",p.value)}switch(_=d?Lo(d):window,t){case"focusin":($g(_)||_.contentEditable==="true")&&($o=_,Yh=d,rl=null);break;case"focusout":rl=Yh=$o=null;break;case"mousedown":qh=!0;break;case"contextmenu":case"mouseup":case"dragend":qh=!1,Fg(h,n,u);break;case"selectionchange":if(LS)break;case"keydown":case"keyup":Fg(h,n,u)}var S;if(pf)e:{switch(t){case"compositionstart":var E="onCompositionStart";break e;case"compositionend":E="onCompositionEnd";break e;case"compositionupdate":E="onCompositionUpdate";break e}E=void 0}else Mo?vb(t,n)&&(E="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(E="onCompositionStart");E&&(xb&&n.locale!=="ko"&&(Mo||E!=="onCompositionStart"?E==="onCompositionEnd"&&Mo&&(S=yb()):(ei=u,df="value"in ei?ei.value:ei.textContent,Mo=!0)),_=ld(d,E),0<_.length&&(E=new Rg(E,t,null,n,u),h.push({event:E,listeners:_}),S?E.data=S:(S=bb(n),S!==null&&(E.data=S)))),(S=jS?CS(t,n):ES(t,n))&&(d=ld(d,"onBeforeInput"),0<d.length&&(u=new Rg("onBeforeInput","beforeinput",null,n,u),h.push({event:u,listeners:d}),u.data=S))}Ob(h,e)})}function wl(t,e,n){return{instance:t,listener:e,currentTarget:n}}function ld(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=fl(t,n),i!=null&&r.unshift(wl(t,i,s)),i=fl(t,e),i!=null&&r.push(wl(t,i,s))),t=t.return}return r}function oo(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Ug(t,e,n,r,s){for(var i=e._reactName,a=[];n!==null&&n!==r;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&d!==null&&(l=d,s?(c=fl(n,i),c!=null&&a.unshift(wl(n,c,l))):s||(c=fl(n,i),c!=null&&a.push(wl(n,c,l)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var BS=/\r\n?/g,HS=/\u0000|\uFFFD/g;function Wg(t){return(typeof t=="string"?t:""+t).replace(BS,`
`).replace(HS,"")}function fc(t,e,n){if(e=Wg(e),Wg(t)!==e&&n)throw Error(Ae(425))}function cd(){}var Xh=null,Zh=null;function Kh(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Jh=typeof setTimeout=="function"?setTimeout:void 0,US=typeof clearTimeout=="function"?clearTimeout:void 0,Gg=typeof Promise=="function"?Promise:void 0,WS=typeof queueMicrotask=="function"?queueMicrotask:typeof Gg<"u"?function(t){return Gg.resolve(null).then(t).catch(GS)}:Jh;function GS(t){setTimeout(function(){throw t})}function Hu(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),yl(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);yl(e)}function oi(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Vg(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var da=Math.random().toString(36).slice(2),ps="__reactFiber$"+da,_l="__reactProps$"+da,$s="__reactContainer$"+da,Qh="__reactEvents$"+da,VS="__reactListeners$"+da,YS="__reactHandles$"+da;function Ai(t){var e=t[ps];if(e)return e;for(var n=t.parentNode;n;){if(e=n[$s]||n[ps]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Vg(t);t!==null;){if(n=t[ps])return n;t=Vg(t)}return e}t=n,n=t.parentNode}return null}function zl(t){return t=t[ps]||t[$s],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Lo(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Ae(33))}function Xd(t){return t[_l]||null}var ep=[],Io=-1;function gi(t){return{current:t}}function Yt(t){0>Io||(t.current=ep[Io],ep[Io]=null,Io--)}function Ft(t,e){Io++,ep[Io]=t.current,t.current=e}var hi={},In=gi(hi),Qn=gi(!1),Fi=hi;function ea(t,e){var n=t.type.contextTypes;if(!n)return hi;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function er(t){return t=t.childContextTypes,t!=null}function dd(){Yt(Qn),Yt(In)}function Yg(t,e,n){if(In.current!==hi)throw Error(Ae(168));Ft(In,e),Ft(Qn,n)}function Mb(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(Ae(108,Rk(t)||"Unknown",s));return nn({},n,r)}function ud(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||hi,Fi=In.current,Ft(In,t),Ft(Qn,Qn.current),!0}function qg(t,e,n){var r=t.stateNode;if(!r)throw Error(Ae(169));n?(t=Mb(t,e,Fi),r.__reactInternalMemoizedMergedChildContext=t,Yt(Qn),Yt(In),Ft(In,t)):Yt(Qn),Ft(Qn,n)}var Ns=null,Zd=!1,Uu=!1;function $b(t){Ns===null?Ns=[t]:Ns.push(t)}function qS(t){Zd=!0,$b(t)}function yi(){if(!Uu&&Ns!==null){Uu=!0;var t=0,e=At;try{var n=Ns;for(At=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Ns=null,Zd=!1}catch(s){throw Ns!==null&&(Ns=Ns.slice(t+1)),ob(of,yi),s}finally{At=e,Uu=!1}}return null}var zo=[],Fo=0,hd=null,pd=0,Er=[],Tr=0,Bi=null,Rs=1,Os="";function Si(t,e){zo[Fo++]=pd,zo[Fo++]=hd,hd=t,pd=e}function Db(t,e,n){Er[Tr++]=Rs,Er[Tr++]=Os,Er[Tr++]=Bi,Bi=t;var r=Rs;t=Os;var s=32-Qr(r)-1;r&=~(1<<s),n+=1;var i=32-Qr(e)+s;if(30<i){var a=s-s%5;i=(r&(1<<a)-1).toString(32),r>>=a,s-=a,Rs=1<<32-Qr(e)+s|n<<s|r,Os=i+t}else Rs=1<<i|n<<s|r,Os=t}function mf(t){t.return!==null&&(Si(t,1),Db(t,1,0))}function gf(t){for(;t===hd;)hd=zo[--Fo],zo[Fo]=null,pd=zo[--Fo],zo[Fo]=null;for(;t===Bi;)Bi=Er[--Tr],Er[Tr]=null,Os=Er[--Tr],Er[Tr]=null,Rs=Er[--Tr],Er[Tr]=null}var gr=null,pr=null,Zt=!1,Zr=null;function Lb(t,e){var n=Pr(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Xg(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,gr=t,pr=oi(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,gr=t,pr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Bi!==null?{id:Rs,overflow:Os}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Pr(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,gr=t,pr=null,!0):!1;default:return!1}}function tp(t){return(t.mode&1)!==0&&(t.flags&128)===0}function np(t){if(Zt){var e=pr;if(e){var n=e;if(!Xg(t,e)){if(tp(t))throw Error(Ae(418));e=oi(n.nextSibling);var r=gr;e&&Xg(t,e)?Lb(r,n):(t.flags=t.flags&-4097|2,Zt=!1,gr=t)}}else{if(tp(t))throw Error(Ae(418));t.flags=t.flags&-4097|2,Zt=!1,gr=t}}}function Zg(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;gr=t}function mc(t){if(t!==gr)return!1;if(!Zt)return Zg(t),Zt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Kh(t.type,t.memoizedProps)),e&&(e=pr)){if(tp(t))throw Ib(),Error(Ae(418));for(;e;)Lb(t,e),e=oi(e.nextSibling)}if(Zg(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Ae(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){pr=oi(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}pr=null}}else pr=gr?oi(t.stateNode.nextSibling):null;return!0}function Ib(){for(var t=pr;t;)t=oi(t.nextSibling)}function ta(){pr=gr=null,Zt=!1}function yf(t){Zr===null?Zr=[t]:Zr.push(t)}var XS=Is.ReactCurrentBatchConfig;function $a(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Ae(309));var r=n.stateNode}if(!r)throw Error(Ae(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(a){var l=s.refs;a===null?delete l[i]:l[i]=a},e._stringRef=i,e)}if(typeof t!="string")throw Error(Ae(284));if(!n._owner)throw Error(Ae(290,t))}return t}function gc(t,e){throw t=Object.prototype.toString.call(e),Error(Ae(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Kg(t){var e=t._init;return e(t._payload)}function zb(t){function e(x,g){if(t){var w=x.deletions;w===null?(x.deletions=[g],x.flags|=16):w.push(g)}}function n(x,g){if(!t)return null;for(;g!==null;)e(x,g),g=g.sibling;return null}function r(x,g){for(x=new Map;g!==null;)g.key!==null?x.set(g.key,g):x.set(g.index,g),g=g.sibling;return x}function s(x,g){return x=di(x,g),x.index=0,x.sibling=null,x}function i(x,g,w){return x.index=w,t?(w=x.alternate,w!==null?(w=w.index,w<g?(x.flags|=2,g):w):(x.flags|=2,g)):(x.flags|=1048576,g)}function a(x){return t&&x.alternate===null&&(x.flags|=2),x}function l(x,g,w,b){return g===null||g.tag!==6?(g=Zu(w,x.mode,b),g.return=x,g):(g=s(g,w),g.return=x,g)}function c(x,g,w,b){var k=w.type;return k===Ao?u(x,g,w.props.children,b,w.key):g!==null&&(g.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Ys&&Kg(k)===g.type)?(b=s(g,w.props),b.ref=$a(x,g,w),b.return=x,b):(b=Qc(w.type,w.key,w.props,null,x.mode,b),b.ref=$a(x,g,w),b.return=x,b)}function d(x,g,w,b){return g===null||g.tag!==4||g.stateNode.containerInfo!==w.containerInfo||g.stateNode.implementation!==w.implementation?(g=Ku(w,x.mode,b),g.return=x,g):(g=s(g,w.children||[]),g.return=x,g)}function u(x,g,w,b,k){return g===null||g.tag!==7?(g=Ii(w,x.mode,b,k),g.return=x,g):(g=s(g,w),g.return=x,g)}function h(x,g,w){if(typeof g=="string"&&g!==""||typeof g=="number")return g=Zu(""+g,x.mode,w),g.return=x,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case ic:return w=Qc(g.type,g.key,g.props,null,x.mode,w),w.ref=$a(x,null,g),w.return=x,w;case Oo:return g=Ku(g,x.mode,w),g.return=x,g;case Ys:var b=g._init;return h(x,b(g._payload),w)}if(Va(g)||Pa(g))return g=Ii(g,x.mode,w,null),g.return=x,g;gc(x,g)}return null}function p(x,g,w,b){var k=g!==null?g.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return k!==null?null:l(x,g,""+w,b);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case ic:return w.key===k?c(x,g,w,b):null;case Oo:return w.key===k?d(x,g,w,b):null;case Ys:return k=w._init,p(x,g,k(w._payload),b)}if(Va(w)||Pa(w))return k!==null?null:u(x,g,w,b,null);gc(x,w)}return null}function f(x,g,w,b,k){if(typeof b=="string"&&b!==""||typeof b=="number")return x=x.get(w)||null,l(g,x,""+b,k);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case ic:return x=x.get(b.key===null?w:b.key)||null,c(g,x,b,k);case Oo:return x=x.get(b.key===null?w:b.key)||null,d(g,x,b,k);case Ys:var _=b._init;return f(x,g,w,_(b._payload),k)}if(Va(b)||Pa(b))return x=x.get(w)||null,u(g,x,b,k,null);gc(g,b)}return null}function m(x,g,w,b){for(var k=null,_=null,S=g,E=g=0,T=null;S!==null&&E<w.length;E++){S.index>E?(T=S,S=null):T=S.sibling;var R=p(x,S,w[E],b);if(R===null){S===null&&(S=T);break}t&&S&&R.alternate===null&&e(x,S),g=i(R,g,E),_===null?k=R:_.sibling=R,_=R,S=T}if(E===w.length)return n(x,S),Zt&&Si(x,E),k;if(S===null){for(;E<w.length;E++)S=h(x,w[E],b),S!==null&&(g=i(S,g,E),_===null?k=S:_.sibling=S,_=S);return Zt&&Si(x,E),k}for(S=r(x,S);E<w.length;E++)T=f(S,x,E,w[E],b),T!==null&&(t&&T.alternate!==null&&S.delete(T.key===null?E:T.key),g=i(T,g,E),_===null?k=T:_.sibling=T,_=T);return t&&S.forEach(function(W){return e(x,W)}),Zt&&Si(x,E),k}function y(x,g,w,b){var k=Pa(w);if(typeof k!="function")throw Error(Ae(150));if(w=k.call(w),w==null)throw Error(Ae(151));for(var _=k=null,S=g,E=g=0,T=null,R=w.next();S!==null&&!R.done;E++,R=w.next()){S.index>E?(T=S,S=null):T=S.sibling;var W=p(x,S,R.value,b);if(W===null){S===null&&(S=T);break}t&&S&&W.alternate===null&&e(x,S),g=i(W,g,E),_===null?k=W:_.sibling=W,_=W,S=T}if(R.done)return n(x,S),Zt&&Si(x,E),k;if(S===null){for(;!R.done;E++,R=w.next())R=h(x,R.value,b),R!==null&&(g=i(R,g,E),_===null?k=R:_.sibling=R,_=R);return Zt&&Si(x,E),k}for(S=r(x,S);!R.done;E++,R=w.next())R=f(S,x,E,R.value,b),R!==null&&(t&&R.alternate!==null&&S.delete(R.key===null?E:R.key),g=i(R,g,E),_===null?k=R:_.sibling=R,_=R);return t&&S.forEach(function(P){return e(x,P)}),Zt&&Si(x,E),k}function v(x,g,w,b){if(typeof w=="object"&&w!==null&&w.type===Ao&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case ic:e:{for(var k=w.key,_=g;_!==null;){if(_.key===k){if(k=w.type,k===Ao){if(_.tag===7){n(x,_.sibling),g=s(_,w.props.children),g.return=x,x=g;break e}}else if(_.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Ys&&Kg(k)===_.type){n(x,_.sibling),g=s(_,w.props),g.ref=$a(x,_,w),g.return=x,x=g;break e}n(x,_);break}else e(x,_);_=_.sibling}w.type===Ao?(g=Ii(w.props.children,x.mode,b,w.key),g.return=x,x=g):(b=Qc(w.type,w.key,w.props,null,x.mode,b),b.ref=$a(x,g,w),b.return=x,x=b)}return a(x);case Oo:e:{for(_=w.key;g!==null;){if(g.key===_)if(g.tag===4&&g.stateNode.containerInfo===w.containerInfo&&g.stateNode.implementation===w.implementation){n(x,g.sibling),g=s(g,w.children||[]),g.return=x,x=g;break e}else{n(x,g);break}else e(x,g);g=g.sibling}g=Ku(w,x.mode,b),g.return=x,x=g}return a(x);case Ys:return _=w._init,v(x,g,_(w._payload),b)}if(Va(w))return m(x,g,w,b);if(Pa(w))return y(x,g,w,b);gc(x,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,g!==null&&g.tag===6?(n(x,g.sibling),g=s(g,w),g.return=x,x=g):(n(x,g),g=Zu(w,x.mode,b),g.return=x,x=g),a(x)):n(x,g)}return v}var na=zb(!0),Fb=zb(!1),fd=gi(null),md=null,Bo=null,xf=null;function vf(){xf=Bo=md=null}function bf(t){var e=fd.current;Yt(fd),t._currentValue=e}function rp(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Xo(t,e){md=t,xf=Bo=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Jn=!0),t.firstContext=null)}function Or(t){var e=t._currentValue;if(xf!==t)if(t={context:t,memoizedValue:e,next:null},Bo===null){if(md===null)throw Error(Ae(308));Bo=t,md.dependencies={lanes:0,firstContext:t}}else Bo=Bo.next=t;return e}var Mi=null;function wf(t){Mi===null?Mi=[t]:Mi.push(t)}function Bb(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,wf(e)):(n.next=s.next,s.next=n),e.interleaved=n,Ds(t,r)}function Ds(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var qs=!1;function _f(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Hb(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function As(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ai(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Et&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Ds(t,n)}return s=r.interleaved,s===null?(e.next=e,wf(r)):(e.next=s.next,s.next=e),r.interleaved=e,Ds(t,n)}function Yc(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,af(t,n)}}function Jg(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=a:i=i.next=a,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function gd(t,e,n,r){var s=t.updateQueue;qs=!1;var i=s.firstBaseUpdate,a=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,d=c.next;c.next=null,a===null?i=d:a.next=d,a=c;var u=t.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==a&&(l===null?u.firstBaseUpdate=d:l.next=d,u.lastBaseUpdate=c))}if(i!==null){var h=s.baseState;a=0,u=d=c=null,l=i;do{var p=l.lane,f=l.eventTime;if((r&p)===p){u!==null&&(u=u.next={eventTime:f,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var m=t,y=l;switch(p=e,f=n,y.tag){case 1:if(m=y.payload,typeof m=="function"){h=m.call(f,h,p);break e}h=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=y.payload,p=typeof m=="function"?m.call(f,h,p):m,p==null)break e;h=nn({},h,p);break e;case 2:qs=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,p=s.effects,p===null?s.effects=[l]:p.push(l))}else f={eventTime:f,lane:p,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(d=u=f,c=h):u=u.next=f,a|=p;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;p=l,l=p.next,p.next=null,s.lastBaseUpdate=p,s.shared.pending=null}}while(!0);if(u===null&&(c=h),s.baseState=c,s.firstBaseUpdate=d,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do a|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Ui|=a,t.lanes=a,t.memoizedState=h}}function Qg(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(Ae(191,s));s.call(r)}}}var Fl={},gs=gi(Fl),kl=gi(Fl),Sl=gi(Fl);function $i(t){if(t===Fl)throw Error(Ae(174));return t}function kf(t,e){switch(Ft(Sl,e),Ft(kl,t),Ft(gs,Fl),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Lh(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Lh(e,t)}Yt(gs),Ft(gs,e)}function ra(){Yt(gs),Yt(kl),Yt(Sl)}function Ub(t){$i(Sl.current);var e=$i(gs.current),n=Lh(e,t.type);e!==n&&(Ft(kl,t),Ft(gs,n))}function Sf(t){kl.current===t&&(Yt(gs),Yt(kl))}var en=gi(0);function yd(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Wu=[];function jf(){for(var t=0;t<Wu.length;t++)Wu[t]._workInProgressVersionPrimary=null;Wu.length=0}var qc=Is.ReactCurrentDispatcher,Gu=Is.ReactCurrentBatchConfig,Hi=0,tn=null,mn=null,vn=null,xd=!1,sl=!1,jl=0,ZS=0;function Mn(){throw Error(Ae(321))}function Cf(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!ts(t[n],e[n]))return!1;return!0}function Ef(t,e,n,r,s,i){if(Hi=i,tn=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,qc.current=t===null||t.memoizedState===null?ej:tj,t=n(r,s),sl){i=0;do{if(sl=!1,jl=0,25<=i)throw Error(Ae(301));i+=1,vn=mn=null,e.updateQueue=null,qc.current=nj,t=n(r,s)}while(sl)}if(qc.current=vd,e=mn!==null&&mn.next!==null,Hi=0,vn=mn=tn=null,xd=!1,e)throw Error(Ae(300));return t}function Tf(){var t=jl!==0;return jl=0,t}function us(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return vn===null?tn.memoizedState=vn=t:vn=vn.next=t,vn}function Ar(){if(mn===null){var t=tn.alternate;t=t!==null?t.memoizedState:null}else t=mn.next;var e=vn===null?tn.memoizedState:vn.next;if(e!==null)vn=e,mn=t;else{if(t===null)throw Error(Ae(310));mn=t,t={memoizedState:mn.memoizedState,baseState:mn.baseState,baseQueue:mn.baseQueue,queue:mn.queue,next:null},vn===null?tn.memoizedState=vn=t:vn=vn.next=t}return vn}function Cl(t,e){return typeof e=="function"?e(t):e}function Vu(t){var e=Ar(),n=e.queue;if(n===null)throw Error(Ae(311));n.lastRenderedReducer=t;var r=mn,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var a=s.next;s.next=i.next,i.next=a}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var l=a=null,c=null,d=i;do{var u=d.lane;if((Hi&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=h,a=r):c=c.next=h,tn.lanes|=u,Ui|=u}d=d.next}while(d!==null&&d!==i);c===null?a=r:c.next=l,ts(r,e.memoizedState)||(Jn=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,tn.lanes|=i,Ui|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Yu(t){var e=Ar(),n=e.queue;if(n===null)throw Error(Ae(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var a=s=s.next;do i=t(i,a.action),a=a.next;while(a!==s);ts(i,e.memoizedState)||(Jn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function Wb(){}function Gb(t,e){var n=tn,r=Ar(),s=e(),i=!ts(r.memoizedState,s);if(i&&(r.memoizedState=s,Jn=!0),r=r.queue,Nf(qb.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||vn!==null&&vn.memoizedState.tag&1){if(n.flags|=2048,El(9,Yb.bind(null,n,r,s,e),void 0,null),bn===null)throw Error(Ae(349));Hi&30||Vb(n,e,s)}return s}function Vb(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=tn.updateQueue,e===null?(e={lastEffect:null,stores:null},tn.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Yb(t,e,n,r){e.value=n,e.getSnapshot=r,Xb(e)&&Zb(t)}function qb(t,e,n){return n(function(){Xb(e)&&Zb(t)})}function Xb(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!ts(t,n)}catch{return!0}}function Zb(t){var e=Ds(t,1);e!==null&&es(e,t,1,-1)}function e0(t){var e=us();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Cl,lastRenderedState:t},e.queue=t,t=t.dispatch=QS.bind(null,tn,t),[e.memoizedState,t]}function El(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=tn.updateQueue,e===null?(e={lastEffect:null,stores:null},tn.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Kb(){return Ar().memoizedState}function Xc(t,e,n,r){var s=us();tn.flags|=t,s.memoizedState=El(1|e,n,void 0,r===void 0?null:r)}function Kd(t,e,n,r){var s=Ar();r=r===void 0?null:r;var i=void 0;if(mn!==null){var a=mn.memoizedState;if(i=a.destroy,r!==null&&Cf(r,a.deps)){s.memoizedState=El(e,n,i,r);return}}tn.flags|=t,s.memoizedState=El(1|e,n,i,r)}function t0(t,e){return Xc(8390656,8,t,e)}function Nf(t,e){return Kd(2048,8,t,e)}function Jb(t,e){return Kd(4,2,t,e)}function Qb(t,e){return Kd(4,4,t,e)}function ew(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function tw(t,e,n){return n=n!=null?n.concat([t]):null,Kd(4,4,ew.bind(null,e,t),n)}function Pf(){}function nw(t,e){var n=Ar();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Cf(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function rw(t,e){var n=Ar();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Cf(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function sw(t,e,n){return Hi&21?(ts(n,e)||(n=cb(),tn.lanes|=n,Ui|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Jn=!0),t.memoizedState=n)}function KS(t,e){var n=At;At=n!==0&&4>n?n:4,t(!0);var r=Gu.transition;Gu.transition={};try{t(!1),e()}finally{At=n,Gu.transition=r}}function iw(){return Ar().memoizedState}function JS(t,e,n){var r=ci(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},ow(t))aw(e,n);else if(n=Bb(t,e,n,r),n!==null){var s=Un();es(n,t,r,s),lw(n,e,r)}}function QS(t,e,n){var r=ci(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(ow(t))aw(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var a=e.lastRenderedState,l=i(a,n);if(s.hasEagerState=!0,s.eagerState=l,ts(l,a)){var c=e.interleaved;c===null?(s.next=s,wf(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=Bb(t,e,s,r),n!==null&&(s=Un(),es(n,t,r,s),lw(n,e,r))}}function ow(t){var e=t.alternate;return t===tn||e!==null&&e===tn}function aw(t,e){sl=xd=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function lw(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,af(t,n)}}var vd={readContext:Or,useCallback:Mn,useContext:Mn,useEffect:Mn,useImperativeHandle:Mn,useInsertionEffect:Mn,useLayoutEffect:Mn,useMemo:Mn,useReducer:Mn,useRef:Mn,useState:Mn,useDebugValue:Mn,useDeferredValue:Mn,useTransition:Mn,useMutableSource:Mn,useSyncExternalStore:Mn,useId:Mn,unstable_isNewReconciler:!1},ej={readContext:Or,useCallback:function(t,e){return us().memoizedState=[t,e===void 0?null:e],t},useContext:Or,useEffect:t0,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Xc(4194308,4,ew.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Xc(4194308,4,t,e)},useInsertionEffect:function(t,e){return Xc(4,2,t,e)},useMemo:function(t,e){var n=us();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=us();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=JS.bind(null,tn,t),[r.memoizedState,t]},useRef:function(t){var e=us();return t={current:t},e.memoizedState=t},useState:e0,useDebugValue:Pf,useDeferredValue:function(t){return us().memoizedState=t},useTransition:function(){var t=e0(!1),e=t[0];return t=KS.bind(null,t[1]),us().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=tn,s=us();if(Zt){if(n===void 0)throw Error(Ae(407));n=n()}else{if(n=e(),bn===null)throw Error(Ae(349));Hi&30||Vb(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,t0(qb.bind(null,r,i,t),[t]),r.flags|=2048,El(9,Yb.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=us(),e=bn.identifierPrefix;if(Zt){var n=Os,r=Rs;n=(r&~(1<<32-Qr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=jl++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=ZS++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},tj={readContext:Or,useCallback:nw,useContext:Or,useEffect:Nf,useImperativeHandle:tw,useInsertionEffect:Jb,useLayoutEffect:Qb,useMemo:rw,useReducer:Vu,useRef:Kb,useState:function(){return Vu(Cl)},useDebugValue:Pf,useDeferredValue:function(t){var e=Ar();return sw(e,mn.memoizedState,t)},useTransition:function(){var t=Vu(Cl)[0],e=Ar().memoizedState;return[t,e]},useMutableSource:Wb,useSyncExternalStore:Gb,useId:iw,unstable_isNewReconciler:!1},nj={readContext:Or,useCallback:nw,useContext:Or,useEffect:Nf,useImperativeHandle:tw,useInsertionEffect:Jb,useLayoutEffect:Qb,useMemo:rw,useReducer:Yu,useRef:Kb,useState:function(){return Yu(Cl)},useDebugValue:Pf,useDeferredValue:function(t){var e=Ar();return mn===null?e.memoizedState=t:sw(e,mn.memoizedState,t)},useTransition:function(){var t=Yu(Cl)[0],e=Ar().memoizedState;return[t,e]},useMutableSource:Wb,useSyncExternalStore:Gb,useId:iw,unstable_isNewReconciler:!1};function Vr(t,e){if(t&&t.defaultProps){e=nn({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function sp(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:nn({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Jd={isMounted:function(t){return(t=t._reactInternals)?Yi(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Un(),s=ci(t),i=As(r,s);i.payload=e,n!=null&&(i.callback=n),e=ai(t,i,s),e!==null&&(es(e,t,s,r),Yc(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Un(),s=ci(t),i=As(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=ai(t,i,s),e!==null&&(es(e,t,s,r),Yc(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Un(),r=ci(t),s=As(n,r);s.tag=2,e!=null&&(s.callback=e),e=ai(t,s,r),e!==null&&(es(e,t,r,n),Yc(e,t,r))}};function n0(t,e,n,r,s,i,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,a):e.prototype&&e.prototype.isPureReactComponent?!vl(n,r)||!vl(s,i):!0}function cw(t,e,n){var r=!1,s=hi,i=e.contextType;return typeof i=="object"&&i!==null?i=Or(i):(s=er(e)?Fi:In.current,r=e.contextTypes,i=(r=r!=null)?ea(t,s):hi),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Jd,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function r0(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Jd.enqueueReplaceState(e,e.state,null)}function ip(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},_f(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Or(i):(i=er(e)?Fi:In.current,s.context=ea(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(sp(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Jd.enqueueReplaceState(s,s.state,null),gd(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function sa(t,e){try{var n="",r=e;do n+=Pk(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function qu(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function op(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var rj=typeof WeakMap=="function"?WeakMap:Map;function dw(t,e,n){n=As(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){wd||(wd=!0,gp=r),op(t,e)},n}function uw(t,e,n){n=As(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){op(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){op(t,e),typeof r!="function"&&(li===null?li=new Set([this]):li.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}function s0(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new rj;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=yj.bind(null,t,e,n),e.then(t,t))}function i0(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function o0(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=As(-1,1),e.tag=2,ai(n,e,1))),n.lanes|=1),t)}var sj=Is.ReactCurrentOwner,Jn=!1;function Bn(t,e,n,r){e.child=t===null?Fb(e,null,n,r):na(e,t.child,n,r)}function a0(t,e,n,r,s){n=n.render;var i=e.ref;return Xo(e,s),r=Ef(t,e,n,r,i,s),n=Tf(),t!==null&&!Jn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Ls(t,e,s)):(Zt&&n&&mf(e),e.flags|=1,Bn(t,e,r,s),e.child)}function l0(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!If(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,hw(t,e,i,r,s)):(t=Qc(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var a=i.memoizedProps;if(n=n.compare,n=n!==null?n:vl,n(a,r)&&t.ref===e.ref)return Ls(t,e,s)}return e.flags|=1,t=di(i,r),t.ref=e.ref,t.return=e,e.child=t}function hw(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(vl(i,r)&&t.ref===e.ref)if(Jn=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Jn=!0);else return e.lanes=t.lanes,Ls(t,e,s)}return ap(t,e,n,r,s)}function pw(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ft(Uo,dr),dr|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ft(Uo,dr),dr|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,Ft(Uo,dr),dr|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,Ft(Uo,dr),dr|=r;return Bn(t,e,s,n),e.child}function fw(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function ap(t,e,n,r,s){var i=er(n)?Fi:In.current;return i=ea(e,i),Xo(e,s),n=Ef(t,e,n,r,i,s),r=Tf(),t!==null&&!Jn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Ls(t,e,s)):(Zt&&r&&mf(e),e.flags|=1,Bn(t,e,n,s),e.child)}function c0(t,e,n,r,s){if(er(n)){var i=!0;ud(e)}else i=!1;if(Xo(e,s),e.stateNode===null)Zc(t,e),cw(e,n,r),ip(e,n,r,s),r=!0;else if(t===null){var a=e.stateNode,l=e.memoizedProps;a.props=l;var c=a.context,d=n.contextType;typeof d=="object"&&d!==null?d=Or(d):(d=er(n)?Fi:In.current,d=ea(e,d));var u=n.getDerivedStateFromProps,h=typeof u=="function"||typeof a.getSnapshotBeforeUpdate=="function";h||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==r||c!==d)&&r0(e,a,r,d),qs=!1;var p=e.memoizedState;a.state=p,gd(e,r,a,s),c=e.memoizedState,l!==r||p!==c||Qn.current||qs?(typeof u=="function"&&(sp(e,n,u,r),c=e.memoizedState),(l=qs||n0(e,n,l,r,p,c,d))?(h||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),a.props=r,a.state=c,a.context=d,r=l):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,Hb(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:Vr(e.type,l),a.props=d,h=e.pendingProps,p=a.context,c=n.contextType,typeof c=="object"&&c!==null?c=Or(c):(c=er(n)?Fi:In.current,c=ea(e,c));var f=n.getDerivedStateFromProps;(u=typeof f=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(l!==h||p!==c)&&r0(e,a,r,c),qs=!1,p=e.memoizedState,a.state=p,gd(e,r,a,s);var m=e.memoizedState;l!==h||p!==m||Qn.current||qs?(typeof f=="function"&&(sp(e,n,f,r),m=e.memoizedState),(d=qs||n0(e,n,d,r,p,m,c)||!1)?(u||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,m,c),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,m,c)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=m),a.props=r,a.state=m,a.context=c,r=d):(typeof a.componentDidUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),r=!1)}return lp(t,e,n,r,i,s)}function lp(t,e,n,r,s,i){fw(t,e);var a=(e.flags&128)!==0;if(!r&&!a)return s&&qg(e,n,!1),Ls(t,e,i);r=e.stateNode,sj.current=e;var l=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&a?(e.child=na(e,t.child,null,i),e.child=na(e,null,l,i)):Bn(t,e,l,i),e.memoizedState=r.state,s&&qg(e,n,!0),e.child}function mw(t){var e=t.stateNode;e.pendingContext?Yg(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Yg(t,e.context,!1),kf(t,e.containerInfo)}function d0(t,e,n,r,s){return ta(),yf(s),e.flags|=256,Bn(t,e,n,r),e.child}var cp={dehydrated:null,treeContext:null,retryLane:0};function dp(t){return{baseLanes:t,cachePool:null,transitions:null}}function gw(t,e,n){var r=e.pendingProps,s=en.current,i=!1,a=(e.flags&128)!==0,l;if((l=a)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Ft(en,s&1),t===null)return np(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,t=r.fallback,i?(r=e.mode,i=e.child,a={mode:"hidden",children:a},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=a):i=tu(a,r,0,null),t=Ii(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=dp(n),e.memoizedState=cp,t):Rf(e,a));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return ij(t,e,a,r,l,s,n);if(i){i=r.fallback,a=e.mode,s=t.child,l=s.sibling;var c={mode:"hidden",children:r.children};return!(a&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=di(s,c),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?i=di(l,i):(i=Ii(i,a,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,a=t.child.memoizedState,a=a===null?dp(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},i.memoizedState=a,i.childLanes=t.childLanes&~n,e.memoizedState=cp,r}return i=t.child,t=i.sibling,r=di(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Rf(t,e){return e=tu({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function yc(t,e,n,r){return r!==null&&yf(r),na(e,t.child,null,n),t=Rf(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function ij(t,e,n,r,s,i,a){if(n)return e.flags&256?(e.flags&=-257,r=qu(Error(Ae(422))),yc(t,e,a,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=tu({mode:"visible",children:r.children},s,0,null),i=Ii(i,s,a,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&na(e,t.child,null,a),e.child.memoizedState=dp(a),e.memoizedState=cp,i);if(!(e.mode&1))return yc(t,e,a,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(Ae(419)),r=qu(i,r,void 0),yc(t,e,a,r)}if(l=(a&t.childLanes)!==0,Jn||l){if(r=bn,r!==null){switch(a&-a){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|a)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Ds(t,s),es(r,t,s,-1))}return Lf(),r=qu(Error(Ae(421))),yc(t,e,a,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=xj.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,pr=oi(s.nextSibling),gr=e,Zt=!0,Zr=null,t!==null&&(Er[Tr++]=Rs,Er[Tr++]=Os,Er[Tr++]=Bi,Rs=t.id,Os=t.overflow,Bi=e),e=Rf(e,r.children),e.flags|=4096,e)}function u0(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),rp(t.return,e,n)}function Xu(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function yw(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(Bn(t,e,r.children,n),r=en.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&u0(t,n,e);else if(t.tag===19)u0(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Ft(en,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&yd(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),Xu(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&yd(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}Xu(e,!0,n,null,i);break;case"together":Xu(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Zc(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Ls(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ui|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Ae(153));if(e.child!==null){for(t=e.child,n=di(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=di(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function oj(t,e,n){switch(e.tag){case 3:mw(e),ta();break;case 5:Ub(e);break;case 1:er(e.type)&&ud(e);break;case 4:kf(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Ft(fd,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Ft(en,en.current&1),e.flags|=128,null):n&e.child.childLanes?gw(t,e,n):(Ft(en,en.current&1),t=Ls(t,e,n),t!==null?t.sibling:null);Ft(en,en.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return yw(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Ft(en,en.current),r)break;return null;case 22:case 23:return e.lanes=0,pw(t,e,n)}return Ls(t,e,n)}var xw,up,vw,bw;xw=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};up=function(){};vw=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,$i(gs.current);var i=null;switch(n){case"input":s=Ah(t,s),r=Ah(t,r),i=[];break;case"select":s=nn({},s,{value:void 0}),r=nn({},r,{value:void 0}),i=[];break;case"textarea":s=Dh(t,s),r=Dh(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=cd)}Ih(n,r);var a;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var l=s[d];for(a in l)l.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(hl.hasOwnProperty(d)?i||(i=[]):(i=i||[]).push(d,null));for(d in r){var c=r[d];if(l=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(i||(i=[]),i.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(hl.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Wt("scroll",t),i||l===c||(i=[])):(i=i||[]).push(d,c))}n&&(i=i||[]).push("style",n);var d=i;(e.updateQueue=d)&&(e.flags|=4)}};bw=function(t,e,n,r){n!==r&&(e.flags|=4)};function Da(t,e){if(!Zt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function $n(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function aj(t,e,n){var r=e.pendingProps;switch(gf(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $n(e),null;case 1:return er(e.type)&&dd(),$n(e),null;case 3:return r=e.stateNode,ra(),Yt(Qn),Yt(In),jf(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(mc(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Zr!==null&&(vp(Zr),Zr=null))),up(t,e),$n(e),null;case 5:Sf(e);var s=$i(Sl.current);if(n=e.type,t!==null&&e.stateNode!=null)vw(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Ae(166));return $n(e),null}if(t=$i(gs.current),mc(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[ps]=e,r[_l]=i,t=(e.mode&1)!==0,n){case"dialog":Wt("cancel",r),Wt("close",r);break;case"iframe":case"object":case"embed":Wt("load",r);break;case"video":case"audio":for(s=0;s<qa.length;s++)Wt(qa[s],r);break;case"source":Wt("error",r);break;case"img":case"image":case"link":Wt("error",r),Wt("load",r);break;case"details":Wt("toggle",r);break;case"input":bg(r,i),Wt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},Wt("invalid",r);break;case"textarea":_g(r,i),Wt("invalid",r)}Ih(n,i),s=null;for(var a in i)if(i.hasOwnProperty(a)){var l=i[a];a==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&fc(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&fc(r.textContent,l,t),s=["children",""+l]):hl.hasOwnProperty(a)&&l!=null&&a==="onScroll"&&Wt("scroll",r)}switch(n){case"input":oc(r),wg(r,i,!0);break;case"textarea":oc(r),kg(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=cd)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=qv(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=a.createElement(n,{is:r.is}):(t=a.createElement(n),n==="select"&&(a=t,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):t=a.createElementNS(t,n),t[ps]=e,t[_l]=r,xw(t,e,!1,!1),e.stateNode=t;e:{switch(a=zh(n,r),n){case"dialog":Wt("cancel",t),Wt("close",t),s=r;break;case"iframe":case"object":case"embed":Wt("load",t),s=r;break;case"video":case"audio":for(s=0;s<qa.length;s++)Wt(qa[s],t);s=r;break;case"source":Wt("error",t),s=r;break;case"img":case"image":case"link":Wt("error",t),Wt("load",t),s=r;break;case"details":Wt("toggle",t),s=r;break;case"input":bg(t,r),s=Ah(t,r),Wt("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=nn({},r,{value:void 0}),Wt("invalid",t);break;case"textarea":_g(t,r),s=Dh(t,r),Wt("invalid",t);break;default:s=r}Ih(n,s),l=s;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?Kv(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Xv(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&pl(t,c):typeof c=="number"&&pl(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(hl.hasOwnProperty(i)?c!=null&&i==="onScroll"&&Wt("scroll",t):c!=null&&ef(t,i,c,a))}switch(n){case"input":oc(t),wg(t,r,!1);break;case"textarea":oc(t),kg(t);break;case"option":r.value!=null&&t.setAttribute("value",""+ui(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?Go(t,!!r.multiple,i,!1):r.defaultValue!=null&&Go(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=cd)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return $n(e),null;case 6:if(t&&e.stateNode!=null)bw(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Ae(166));if(n=$i(Sl.current),$i(gs.current),mc(e)){if(r=e.stateNode,n=e.memoizedProps,r[ps]=e,(i=r.nodeValue!==n)&&(t=gr,t!==null))switch(t.tag){case 3:fc(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&fc(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[ps]=e,e.stateNode=r}return $n(e),null;case 13:if(Yt(en),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Zt&&pr!==null&&e.mode&1&&!(e.flags&128))Ib(),ta(),e.flags|=98560,i=!1;else if(i=mc(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(Ae(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Ae(317));i[ps]=e}else ta(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;$n(e),i=!1}else Zr!==null&&(vp(Zr),Zr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||en.current&1?yn===0&&(yn=3):Lf())),e.updateQueue!==null&&(e.flags|=4),$n(e),null);case 4:return ra(),up(t,e),t===null&&bl(e.stateNode.containerInfo),$n(e),null;case 10:return bf(e.type._context),$n(e),null;case 17:return er(e.type)&&dd(),$n(e),null;case 19:if(Yt(en),i=e.memoizedState,i===null)return $n(e),null;if(r=(e.flags&128)!==0,a=i.rendering,a===null)if(r)Da(i,!1);else{if(yn!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=yd(t),a!==null){for(e.flags|=128,Da(i,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,a=i.alternate,a===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=a.childLanes,i.lanes=a.lanes,i.child=a.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=a.memoizedProps,i.memoizedState=a.memoizedState,i.updateQueue=a.updateQueue,i.type=a.type,t=a.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Ft(en,en.current&1|2),e.child}t=t.sibling}i.tail!==null&&dn()>ia&&(e.flags|=128,r=!0,Da(i,!1),e.lanes=4194304)}else{if(!r)if(t=yd(a),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Da(i,!0),i.tail===null&&i.tailMode==="hidden"&&!a.alternate&&!Zt)return $n(e),null}else 2*dn()-i.renderingStartTime>ia&&n!==1073741824&&(e.flags|=128,r=!0,Da(i,!1),e.lanes=4194304);i.isBackwards?(a.sibling=e.child,e.child=a):(n=i.last,n!==null?n.sibling=a:e.child=a,i.last=a)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=dn(),e.sibling=null,n=en.current,Ft(en,r?n&1|2:n&1),e):($n(e),null);case 22:case 23:return Df(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?dr&1073741824&&($n(e),e.subtreeFlags&6&&(e.flags|=8192)):$n(e),null;case 24:return null;case 25:return null}throw Error(Ae(156,e.tag))}function lj(t,e){switch(gf(e),e.tag){case 1:return er(e.type)&&dd(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return ra(),Yt(Qn),Yt(In),jf(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Sf(e),null;case 13:if(Yt(en),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Ae(340));ta()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Yt(en),null;case 4:return ra(),null;case 10:return bf(e.type._context),null;case 22:case 23:return Df(),null;case 24:return null;default:return null}}var xc=!1,Ln=!1,cj=typeof WeakSet=="function"?WeakSet:Set,We=null;function Ho(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){on(t,e,r)}else n.current=null}function hp(t,e,n){try{n()}catch(r){on(t,e,r)}}var h0=!1;function dj(t,e){if(Xh=od,t=jb(),ff(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var a=0,l=-1,c=-1,d=0,u=0,h=t,p=null;t:for(;;){for(var f;h!==n||s!==0&&h.nodeType!==3||(l=a+s),h!==i||r!==0&&h.nodeType!==3||(c=a+r),h.nodeType===3&&(a+=h.nodeValue.length),(f=h.firstChild)!==null;)p=h,h=f;for(;;){if(h===t)break t;if(p===n&&++d===s&&(l=a),p===i&&++u===r&&(c=a),(f=h.nextSibling)!==null)break;h=p,p=h.parentNode}h=f}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Zh={focusedElem:t,selectionRange:n},od=!1,We=e;We!==null;)if(e=We,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,We=t;else for(;We!==null;){e=We;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var y=m.memoizedProps,v=m.memoizedState,x=e.stateNode,g=x.getSnapshotBeforeUpdate(e.elementType===e.type?y:Vr(e.type,y),v);x.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ae(163))}}catch(b){on(e,e.return,b)}if(t=e.sibling,t!==null){t.return=e.return,We=t;break}We=e.return}return m=h0,h0=!1,m}function il(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&hp(e,n,i)}s=s.next}while(s!==r)}}function Qd(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function pp(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function ww(t){var e=t.alternate;e!==null&&(t.alternate=null,ww(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[ps],delete e[_l],delete e[Qh],delete e[VS],delete e[YS])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function _w(t){return t.tag===5||t.tag===3||t.tag===4}function p0(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||_w(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function fp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=cd));else if(r!==4&&(t=t.child,t!==null))for(fp(t,e,n),t=t.sibling;t!==null;)fp(t,e,n),t=t.sibling}function mp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(mp(t,e,n),t=t.sibling;t!==null;)mp(t,e,n),t=t.sibling}var kn=null,qr=!1;function Gs(t,e,n){for(n=n.child;n!==null;)kw(t,e,n),n=n.sibling}function kw(t,e,n){if(ms&&typeof ms.onCommitFiberUnmount=="function")try{ms.onCommitFiberUnmount(Gd,n)}catch{}switch(n.tag){case 5:Ln||Ho(n,e);case 6:var r=kn,s=qr;kn=null,Gs(t,e,n),kn=r,qr=s,kn!==null&&(qr?(t=kn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):kn.removeChild(n.stateNode));break;case 18:kn!==null&&(qr?(t=kn,n=n.stateNode,t.nodeType===8?Hu(t.parentNode,n):t.nodeType===1&&Hu(t,n),yl(t)):Hu(kn,n.stateNode));break;case 4:r=kn,s=qr,kn=n.stateNode.containerInfo,qr=!0,Gs(t,e,n),kn=r,qr=s;break;case 0:case 11:case 14:case 15:if(!Ln&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,a=i.destroy;i=i.tag,a!==void 0&&(i&2||i&4)&&hp(n,e,a),s=s.next}while(s!==r)}Gs(t,e,n);break;case 1:if(!Ln&&(Ho(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){on(n,e,l)}Gs(t,e,n);break;case 21:Gs(t,e,n);break;case 22:n.mode&1?(Ln=(r=Ln)||n.memoizedState!==null,Gs(t,e,n),Ln=r):Gs(t,e,n);break;default:Gs(t,e,n)}}function f0(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new cj),e.forEach(function(r){var s=vj.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function Hr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,a=e,l=a;e:for(;l!==null;){switch(l.tag){case 5:kn=l.stateNode,qr=!1;break e;case 3:kn=l.stateNode.containerInfo,qr=!0;break e;case 4:kn=l.stateNode.containerInfo,qr=!0;break e}l=l.return}if(kn===null)throw Error(Ae(160));kw(i,a,s),kn=null,qr=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(d){on(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Sw(e,t),e=e.sibling}function Sw(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Hr(e,t),cs(t),r&4){try{il(3,t,t.return),Qd(3,t)}catch(y){on(t,t.return,y)}try{il(5,t,t.return)}catch(y){on(t,t.return,y)}}break;case 1:Hr(e,t),cs(t),r&512&&n!==null&&Ho(n,n.return);break;case 5:if(Hr(e,t),cs(t),r&512&&n!==null&&Ho(n,n.return),t.flags&32){var s=t.stateNode;try{pl(s,"")}catch(y){on(t,t.return,y)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,a=n!==null?n.memoizedProps:i,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&Vv(s,i),zh(l,a);var d=zh(l,i);for(a=0;a<c.length;a+=2){var u=c[a],h=c[a+1];u==="style"?Kv(s,h):u==="dangerouslySetInnerHTML"?Xv(s,h):u==="children"?pl(s,h):ef(s,u,h,d)}switch(l){case"input":Mh(s,i);break;case"textarea":Yv(s,i);break;case"select":var p=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var f=i.value;f!=null?Go(s,!!i.multiple,f,!1):p!==!!i.multiple&&(i.defaultValue!=null?Go(s,!!i.multiple,i.defaultValue,!0):Go(s,!!i.multiple,i.multiple?[]:"",!1))}s[_l]=i}catch(y){on(t,t.return,y)}}break;case 6:if(Hr(e,t),cs(t),r&4){if(t.stateNode===null)throw Error(Ae(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(y){on(t,t.return,y)}}break;case 3:if(Hr(e,t),cs(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{yl(e.containerInfo)}catch(y){on(t,t.return,y)}break;case 4:Hr(e,t),cs(t);break;case 13:Hr(e,t),cs(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Mf=dn())),r&4&&f0(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Ln=(d=Ln)||u,Hr(e,t),Ln=d):Hr(e,t),cs(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!u&&t.mode&1)for(We=t,u=t.child;u!==null;){for(h=We=u;We!==null;){switch(p=We,f=p.child,p.tag){case 0:case 11:case 14:case 15:il(4,p,p.return);break;case 1:Ho(p,p.return);var m=p.stateNode;if(typeof m.componentWillUnmount=="function"){r=p,n=p.return;try{e=r,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(y){on(r,n,y)}}break;case 5:Ho(p,p.return);break;case 22:if(p.memoizedState!==null){g0(h);continue}}f!==null?(f.return=p,We=f):g0(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{s=h.stateNode,d?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=h.stateNode,c=h.memoizedProps.style,a=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=Zv("display",a))}catch(y){on(t,t.return,y)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(y){on(t,t.return,y)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Hr(e,t),cs(t),r&4&&f0(t);break;case 21:break;default:Hr(e,t),cs(t)}}function cs(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(_w(n)){var r=n;break e}n=n.return}throw Error(Ae(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(pl(s,""),r.flags&=-33);var i=p0(t);mp(t,i,s);break;case 3:case 4:var a=r.stateNode.containerInfo,l=p0(t);fp(t,l,a);break;default:throw Error(Ae(161))}}catch(c){on(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function uj(t,e,n){We=t,jw(t)}function jw(t,e,n){for(var r=(t.mode&1)!==0;We!==null;){var s=We,i=s.child;if(s.tag===22&&r){var a=s.memoizedState!==null||xc;if(!a){var l=s.alternate,c=l!==null&&l.memoizedState!==null||Ln;l=xc;var d=Ln;if(xc=a,(Ln=c)&&!d)for(We=s;We!==null;)a=We,c=a.child,a.tag===22&&a.memoizedState!==null?y0(s):c!==null?(c.return=a,We=c):y0(s);for(;i!==null;)We=i,jw(i),i=i.sibling;We=s,xc=l,Ln=d}m0(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,We=i):m0(t)}}function m0(t){for(;We!==null;){var e=We;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ln||Qd(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Ln)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Vr(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&Qg(e,i,r);break;case 3:var a=e.updateQueue;if(a!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Qg(e,a,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&yl(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ae(163))}Ln||e.flags&512&&pp(e)}catch(p){on(e,e.return,p)}}if(e===t){We=null;break}if(n=e.sibling,n!==null){n.return=e.return,We=n;break}We=e.return}}function g0(t){for(;We!==null;){var e=We;if(e===t){We=null;break}var n=e.sibling;if(n!==null){n.return=e.return,We=n;break}We=e.return}}function y0(t){for(;We!==null;){var e=We;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Qd(4,e)}catch(c){on(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){on(e,s,c)}}var i=e.return;try{pp(e)}catch(c){on(e,i,c)}break;case 5:var a=e.return;try{pp(e)}catch(c){on(e,a,c)}}}catch(c){on(e,e.return,c)}if(e===t){We=null;break}var l=e.sibling;if(l!==null){l.return=e.return,We=l;break}We=e.return}}var hj=Math.ceil,bd=Is.ReactCurrentDispatcher,Of=Is.ReactCurrentOwner,Rr=Is.ReactCurrentBatchConfig,Et=0,bn=null,pn=null,Sn=0,dr=0,Uo=gi(0),yn=0,Tl=null,Ui=0,eu=0,Af=0,ol=null,Kn=null,Mf=0,ia=1/0,Es=null,wd=!1,gp=null,li=null,vc=!1,ti=null,_d=0,al=0,yp=null,Kc=-1,Jc=0;function Un(){return Et&6?dn():Kc!==-1?Kc:Kc=dn()}function ci(t){return t.mode&1?Et&2&&Sn!==0?Sn&-Sn:XS.transition!==null?(Jc===0&&(Jc=cb()),Jc):(t=At,t!==0||(t=window.event,t=t===void 0?16:gb(t.type)),t):1}function es(t,e,n,r){if(50<al)throw al=0,yp=null,Error(Ae(185));Ll(t,n,r),(!(Et&2)||t!==bn)&&(t===bn&&(!(Et&2)&&(eu|=n),yn===4&&Ks(t,Sn)),tr(t,r),n===1&&Et===0&&!(e.mode&1)&&(ia=dn()+500,Zd&&yi()))}function tr(t,e){var n=t.callbackNode;Xk(t,e);var r=id(t,t===bn?Sn:0);if(r===0)n!==null&&Cg(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Cg(n),e===1)t.tag===0?qS(x0.bind(null,t)):$b(x0.bind(null,t)),WS(function(){!(Et&6)&&yi()}),n=null;else{switch(db(r)){case 1:n=of;break;case 4:n=ab;break;case 16:n=sd;break;case 536870912:n=lb;break;default:n=sd}n=Aw(n,Cw.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Cw(t,e){if(Kc=-1,Jc=0,Et&6)throw Error(Ae(327));var n=t.callbackNode;if(Zo()&&t.callbackNode!==n)return null;var r=id(t,t===bn?Sn:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=kd(t,r);else{e=r;var s=Et;Et|=2;var i=Tw();(bn!==t||Sn!==e)&&(Es=null,ia=dn()+500,Li(t,e));do try{mj();break}catch(l){Ew(t,l)}while(!0);vf(),bd.current=i,Et=s,pn!==null?e=0:(bn=null,Sn=0,e=yn)}if(e!==0){if(e===2&&(s=Wh(t),s!==0&&(r=s,e=xp(t,s))),e===1)throw n=Tl,Li(t,0),Ks(t,r),tr(t,dn()),n;if(e===6)Ks(t,r);else{if(s=t.current.alternate,!(r&30)&&!pj(s)&&(e=kd(t,r),e===2&&(i=Wh(t),i!==0&&(r=i,e=xp(t,i))),e===1))throw n=Tl,Li(t,0),Ks(t,r),tr(t,dn()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(Ae(345));case 2:ji(t,Kn,Es);break;case 3:if(Ks(t,r),(r&130023424)===r&&(e=Mf+500-dn(),10<e)){if(id(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){Un(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=Jh(ji.bind(null,t,Kn,Es),e);break}ji(t,Kn,Es);break;case 4:if(Ks(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var a=31-Qr(r);i=1<<a,a=e[a],a>s&&(s=a),r&=~i}if(r=s,r=dn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*hj(r/1960))-r,10<r){t.timeoutHandle=Jh(ji.bind(null,t,Kn,Es),r);break}ji(t,Kn,Es);break;case 5:ji(t,Kn,Es);break;default:throw Error(Ae(329))}}}return tr(t,dn()),t.callbackNode===n?Cw.bind(null,t):null}function xp(t,e){var n=ol;return t.current.memoizedState.isDehydrated&&(Li(t,e).flags|=256),t=kd(t,e),t!==2&&(e=Kn,Kn=n,e!==null&&vp(e)),t}function vp(t){Kn===null?Kn=t:Kn.push.apply(Kn,t)}function pj(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!ts(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ks(t,e){for(e&=~Af,e&=~eu,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Qr(e),r=1<<n;t[n]=-1,e&=~r}}function x0(t){if(Et&6)throw Error(Ae(327));Zo();var e=id(t,0);if(!(e&1))return tr(t,dn()),null;var n=kd(t,e);if(t.tag!==0&&n===2){var r=Wh(t);r!==0&&(e=r,n=xp(t,r))}if(n===1)throw n=Tl,Li(t,0),Ks(t,e),tr(t,dn()),n;if(n===6)throw Error(Ae(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ji(t,Kn,Es),tr(t,dn()),null}function $f(t,e){var n=Et;Et|=1;try{return t(e)}finally{Et=n,Et===0&&(ia=dn()+500,Zd&&yi())}}function Wi(t){ti!==null&&ti.tag===0&&!(Et&6)&&Zo();var e=Et;Et|=1;var n=Rr.transition,r=At;try{if(Rr.transition=null,At=1,t)return t()}finally{At=r,Rr.transition=n,Et=e,!(Et&6)&&yi()}}function Df(){dr=Uo.current,Yt(Uo)}function Li(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,US(n)),pn!==null)for(n=pn.return;n!==null;){var r=n;switch(gf(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&dd();break;case 3:ra(),Yt(Qn),Yt(In),jf();break;case 5:Sf(r);break;case 4:ra();break;case 13:Yt(en);break;case 19:Yt(en);break;case 10:bf(r.type._context);break;case 22:case 23:Df()}n=n.return}if(bn=t,pn=t=di(t.current,null),Sn=dr=e,yn=0,Tl=null,Af=eu=Ui=0,Kn=ol=null,Mi!==null){for(e=0;e<Mi.length;e++)if(n=Mi[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var a=i.next;i.next=s,r.next=a}n.pending=r}Mi=null}return t}function Ew(t,e){do{var n=pn;try{if(vf(),qc.current=vd,xd){for(var r=tn.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}xd=!1}if(Hi=0,vn=mn=tn=null,sl=!1,jl=0,Of.current=null,n===null||n.return===null){yn=1,Tl=e,pn=null;break}e:{var i=t,a=n.return,l=n,c=e;if(e=Sn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=l,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=i0(a);if(f!==null){f.flags&=-257,o0(f,a,l,i,e),f.mode&1&&s0(i,d,e),e=f,c=d;var m=e.updateQueue;if(m===null){var y=new Set;y.add(c),e.updateQueue=y}else m.add(c);break e}else{if(!(e&1)){s0(i,d,e),Lf();break e}c=Error(Ae(426))}}else if(Zt&&l.mode&1){var v=i0(a);if(v!==null){!(v.flags&65536)&&(v.flags|=256),o0(v,a,l,i,e),yf(sa(c,l));break e}}i=c=sa(c,l),yn!==4&&(yn=2),ol===null?ol=[i]:ol.push(i),i=a;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var x=dw(i,c,e);Jg(i,x);break e;case 1:l=c;var g=i.type,w=i.stateNode;if(!(i.flags&128)&&(typeof g.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(li===null||!li.has(w)))){i.flags|=65536,e&=-e,i.lanes|=e;var b=uw(i,l,e);Jg(i,b);break e}}i=i.return}while(i!==null)}Pw(n)}catch(k){e=k,pn===n&&n!==null&&(pn=n=n.return);continue}break}while(!0)}function Tw(){var t=bd.current;return bd.current=vd,t===null?vd:t}function Lf(){(yn===0||yn===3||yn===2)&&(yn=4),bn===null||!(Ui&268435455)&&!(eu&268435455)||Ks(bn,Sn)}function kd(t,e){var n=Et;Et|=2;var r=Tw();(bn!==t||Sn!==e)&&(Es=null,Li(t,e));do try{fj();break}catch(s){Ew(t,s)}while(!0);if(vf(),Et=n,bd.current=r,pn!==null)throw Error(Ae(261));return bn=null,Sn=0,yn}function fj(){for(;pn!==null;)Nw(pn)}function mj(){for(;pn!==null&&!Fk();)Nw(pn)}function Nw(t){var e=Ow(t.alternate,t,dr);t.memoizedProps=t.pendingProps,e===null?Pw(t):pn=e,Of.current=null}function Pw(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=lj(n,e),n!==null){n.flags&=32767,pn=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{yn=6,pn=null;return}}else if(n=aj(n,e,dr),n!==null){pn=n;return}if(e=e.sibling,e!==null){pn=e;return}pn=e=t}while(e!==null);yn===0&&(yn=5)}function ji(t,e,n){var r=At,s=Rr.transition;try{Rr.transition=null,At=1,gj(t,e,n,r)}finally{Rr.transition=s,At=r}return null}function gj(t,e,n,r){do Zo();while(ti!==null);if(Et&6)throw Error(Ae(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Ae(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(Zk(t,i),t===bn&&(pn=bn=null,Sn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||vc||(vc=!0,Aw(sd,function(){return Zo(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Rr.transition,Rr.transition=null;var a=At;At=1;var l=Et;Et|=4,Of.current=null,dj(t,n),Sw(n,t),DS(Zh),od=!!Xh,Zh=Xh=null,t.current=n,uj(n),Bk(),Et=l,At=a,Rr.transition=i}else t.current=n;if(vc&&(vc=!1,ti=t,_d=s),i=t.pendingLanes,i===0&&(li=null),Wk(n.stateNode),tr(t,dn()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(wd)throw wd=!1,t=gp,gp=null,t;return _d&1&&t.tag!==0&&Zo(),i=t.pendingLanes,i&1?t===yp?al++:(al=0,yp=t):al=0,yi(),null}function Zo(){if(ti!==null){var t=db(_d),e=Rr.transition,n=At;try{if(Rr.transition=null,At=16>t?16:t,ti===null)var r=!1;else{if(t=ti,ti=null,_d=0,Et&6)throw Error(Ae(331));var s=Et;for(Et|=4,We=t.current;We!==null;){var i=We,a=i.child;if(We.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(We=d;We!==null;){var u=We;switch(u.tag){case 0:case 11:case 15:il(8,u,i)}var h=u.child;if(h!==null)h.return=u,We=h;else for(;We!==null;){u=We;var p=u.sibling,f=u.return;if(ww(u),u===d){We=null;break}if(p!==null){p.return=f,We=p;break}We=f}}}var m=i.alternate;if(m!==null){var y=m.child;if(y!==null){m.child=null;do{var v=y.sibling;y.sibling=null,y=v}while(y!==null)}}We=i}}if(i.subtreeFlags&2064&&a!==null)a.return=i,We=a;else e:for(;We!==null;){if(i=We,i.flags&2048)switch(i.tag){case 0:case 11:case 15:il(9,i,i.return)}var x=i.sibling;if(x!==null){x.return=i.return,We=x;break e}We=i.return}}var g=t.current;for(We=g;We!==null;){a=We;var w=a.child;if(a.subtreeFlags&2064&&w!==null)w.return=a,We=w;else e:for(a=g;We!==null;){if(l=We,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Qd(9,l)}}catch(k){on(l,l.return,k)}if(l===a){We=null;break e}var b=l.sibling;if(b!==null){b.return=l.return,We=b;break e}We=l.return}}if(Et=s,yi(),ms&&typeof ms.onPostCommitFiberRoot=="function")try{ms.onPostCommitFiberRoot(Gd,t)}catch{}r=!0}return r}finally{At=n,Rr.transition=e}}return!1}function v0(t,e,n){e=sa(n,e),e=dw(t,e,1),t=ai(t,e,1),e=Un(),t!==null&&(Ll(t,1,e),tr(t,e))}function on(t,e,n){if(t.tag===3)v0(t,t,n);else for(;e!==null;){if(e.tag===3){v0(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(li===null||!li.has(r))){t=sa(n,t),t=uw(e,t,1),e=ai(e,t,1),t=Un(),e!==null&&(Ll(e,1,t),tr(e,t));break}}e=e.return}}function yj(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Un(),t.pingedLanes|=t.suspendedLanes&n,bn===t&&(Sn&n)===n&&(yn===4||yn===3&&(Sn&130023424)===Sn&&500>dn()-Mf?Li(t,0):Af|=n),tr(t,e)}function Rw(t,e){e===0&&(t.mode&1?(e=cc,cc<<=1,!(cc&130023424)&&(cc=4194304)):e=1);var n=Un();t=Ds(t,e),t!==null&&(Ll(t,e,n),tr(t,n))}function xj(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Rw(t,n)}function vj(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(Ae(314))}r!==null&&r.delete(e),Rw(t,n)}var Ow;Ow=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Qn.current)Jn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Jn=!1,oj(t,e,n);Jn=!!(t.flags&131072)}else Jn=!1,Zt&&e.flags&1048576&&Db(e,pd,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Zc(t,e),t=e.pendingProps;var s=ea(e,In.current);Xo(e,n),s=Ef(null,e,r,t,s,n);var i=Tf();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,er(r)?(i=!0,ud(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,_f(e),s.updater=Jd,e.stateNode=s,s._reactInternals=e,ip(e,r,t,n),e=lp(null,e,r,!0,i,n)):(e.tag=0,Zt&&i&&mf(e),Bn(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Zc(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=wj(r),t=Vr(r,t),s){case 0:e=ap(null,e,r,t,n);break e;case 1:e=c0(null,e,r,t,n);break e;case 11:e=a0(null,e,r,t,n);break e;case 14:e=l0(null,e,r,Vr(r.type,t),n);break e}throw Error(Ae(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Vr(r,s),ap(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Vr(r,s),c0(t,e,r,s,n);case 3:e:{if(mw(e),t===null)throw Error(Ae(387));r=e.pendingProps,i=e.memoizedState,s=i.element,Hb(t,e),gd(e,r,null,n);var a=e.memoizedState;if(r=a.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=sa(Error(Ae(423)),e),e=d0(t,e,r,n,s);break e}else if(r!==s){s=sa(Error(Ae(424)),e),e=d0(t,e,r,n,s);break e}else for(pr=oi(e.stateNode.containerInfo.firstChild),gr=e,Zt=!0,Zr=null,n=Fb(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(ta(),r===s){e=Ls(t,e,n);break e}Bn(t,e,r,n)}e=e.child}return e;case 5:return Ub(e),t===null&&np(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,a=s.children,Kh(r,s)?a=null:i!==null&&Kh(r,i)&&(e.flags|=32),fw(t,e),Bn(t,e,a,n),e.child;case 6:return t===null&&np(e),null;case 13:return gw(t,e,n);case 4:return kf(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=na(e,null,r,n):Bn(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Vr(r,s),a0(t,e,r,s,n);case 7:return Bn(t,e,e.pendingProps,n),e.child;case 8:return Bn(t,e,e.pendingProps.children,n),e.child;case 12:return Bn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,a=s.value,Ft(fd,r._currentValue),r._currentValue=a,i!==null)if(ts(i.value,a)){if(i.children===s.children&&!Qn.current){e=Ls(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var l=i.dependencies;if(l!==null){a=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=As(-1,n&-n),c.tag=2;var d=i.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),rp(i.return,n,e),l.lanes|=n;break}c=c.next}}else if(i.tag===10)a=i.type===e.type?null:i.child;else if(i.tag===18){if(a=i.return,a===null)throw Error(Ae(341));a.lanes|=n,l=a.alternate,l!==null&&(l.lanes|=n),rp(a,n,e),a=i.sibling}else a=i.child;if(a!==null)a.return=i;else for(a=i;a!==null;){if(a===e){a=null;break}if(i=a.sibling,i!==null){i.return=a.return,a=i;break}a=a.return}i=a}Bn(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Xo(e,n),s=Or(s),r=r(s),e.flags|=1,Bn(t,e,r,n),e.child;case 14:return r=e.type,s=Vr(r,e.pendingProps),s=Vr(r.type,s),l0(t,e,r,s,n);case 15:return hw(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Vr(r,s),Zc(t,e),e.tag=1,er(r)?(t=!0,ud(e)):t=!1,Xo(e,n),cw(e,r,s),ip(e,r,s,n),lp(null,e,r,!0,t,n);case 19:return yw(t,e,n);case 22:return pw(t,e,n)}throw Error(Ae(156,e.tag))};function Aw(t,e){return ob(t,e)}function bj(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Pr(t,e,n,r){return new bj(t,e,n,r)}function If(t){return t=t.prototype,!(!t||!t.isReactComponent)}function wj(t){if(typeof t=="function")return If(t)?1:0;if(t!=null){if(t=t.$$typeof,t===nf)return 11;if(t===rf)return 14}return 2}function di(t,e){var n=t.alternate;return n===null?(n=Pr(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Qc(t,e,n,r,s,i){var a=2;if(r=t,typeof t=="function")If(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case Ao:return Ii(n.children,s,i,e);case tf:a=8,s|=8;break;case Nh:return t=Pr(12,n,e,s|2),t.elementType=Nh,t.lanes=i,t;case Ph:return t=Pr(13,n,e,s),t.elementType=Ph,t.lanes=i,t;case Rh:return t=Pr(19,n,e,s),t.elementType=Rh,t.lanes=i,t;case Uv:return tu(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Bv:a=10;break e;case Hv:a=9;break e;case nf:a=11;break e;case rf:a=14;break e;case Ys:a=16,r=null;break e}throw Error(Ae(130,t==null?t:typeof t,""))}return e=Pr(a,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function Ii(t,e,n,r){return t=Pr(7,t,r,e),t.lanes=n,t}function tu(t,e,n,r){return t=Pr(22,t,r,e),t.elementType=Uv,t.lanes=n,t.stateNode={isHidden:!1},t}function Zu(t,e,n){return t=Pr(6,t,null,e),t.lanes=n,t}function Ku(t,e,n){return e=Pr(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function _j(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ru(0),this.expirationTimes=Ru(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ru(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function zf(t,e,n,r,s,i,a,l,c){return t=new _j(t,e,n,l,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Pr(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},_f(i),t}function kj(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Oo,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function Mw(t){if(!t)return hi;t=t._reactInternals;e:{if(Yi(t)!==t||t.tag!==1)throw Error(Ae(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(er(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ae(171))}if(t.tag===1){var n=t.type;if(er(n))return Mb(t,n,e)}return e}function $w(t,e,n,r,s,i,a,l,c){return t=zf(n,r,!0,t,s,i,a,l,c),t.context=Mw(null),n=t.current,r=Un(),s=ci(n),i=As(r,s),i.callback=e??null,ai(n,i,s),t.current.lanes=s,Ll(t,s,r),tr(t,r),t}function nu(t,e,n,r){var s=e.current,i=Un(),a=ci(s);return n=Mw(n),e.context===null?e.context=n:e.pendingContext=n,e=As(i,a),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=ai(s,e,a),t!==null&&(es(t,s,a,i),Yc(t,s,a)),a}function Sd(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function b0(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Ff(t,e){b0(t,e),(t=t.alternate)&&b0(t,e)}function Sj(){return null}var Dw=typeof reportError=="function"?reportError:function(t){console.error(t)};function Bf(t){this._internalRoot=t}ru.prototype.render=Bf.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Ae(409));nu(t,e,null,null)};ru.prototype.unmount=Bf.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Wi(function(){nu(null,t,null,null)}),e[$s]=null}};function ru(t){this._internalRoot=t}ru.prototype.unstable_scheduleHydration=function(t){if(t){var e=pb();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Zs.length&&e!==0&&e<Zs[n].priority;n++);Zs.splice(n,0,t),n===0&&mb(t)}};function Hf(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function su(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function w0(){}function jj(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var d=Sd(a);i.call(d)}}var a=$w(e,r,t,0,null,!1,!1,"",w0);return t._reactRootContainer=a,t[$s]=a.current,bl(t.nodeType===8?t.parentNode:t),Wi(),a}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var d=Sd(c);l.call(d)}}var c=zf(t,0,!1,null,null,!1,!1,"",w0);return t._reactRootContainer=c,t[$s]=c.current,bl(t.nodeType===8?t.parentNode:t),Wi(function(){nu(e,c,n,r)}),c}function iu(t,e,n,r,s){var i=n._reactRootContainer;if(i){var a=i;if(typeof s=="function"){var l=s;s=function(){var c=Sd(a);l.call(c)}}nu(e,a,t,s)}else a=jj(n,e,t,s,r);return Sd(a)}ub=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Ya(e.pendingLanes);n!==0&&(af(e,n|1),tr(e,dn()),!(Et&6)&&(ia=dn()+500,yi()))}break;case 13:Wi(function(){var r=Ds(t,1);if(r!==null){var s=Un();es(r,t,1,s)}}),Ff(t,1)}};lf=function(t){if(t.tag===13){var e=Ds(t,134217728);if(e!==null){var n=Un();es(e,t,134217728,n)}Ff(t,134217728)}};hb=function(t){if(t.tag===13){var e=ci(t),n=Ds(t,e);if(n!==null){var r=Un();es(n,t,e,r)}Ff(t,e)}};pb=function(){return At};fb=function(t,e){var n=At;try{return At=t,e()}finally{At=n}};Bh=function(t,e,n){switch(e){case"input":if(Mh(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=Xd(r);if(!s)throw Error(Ae(90));Gv(r),Mh(r,s)}}}break;case"textarea":Yv(t,n);break;case"select":e=n.value,e!=null&&Go(t,!!n.multiple,e,!1)}};eb=$f;tb=Wi;var Cj={usingClientEntryPoint:!1,Events:[zl,Lo,Xd,Jv,Qv,$f]},La={findFiberByHostInstance:Ai,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ej={bundleType:La.bundleType,version:La.version,rendererPackageName:La.rendererPackageName,rendererConfig:La.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Is.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=sb(t),t===null?null:t.stateNode},findFiberByHostInstance:La.findFiberByHostInstance||Sj,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bc.isDisabled&&bc.supportsFiber)try{Gd=bc.inject(Ej),ms=bc}catch{}}vr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Cj;vr.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Hf(e))throw Error(Ae(200));return kj(t,e,null,n)};vr.createRoot=function(t,e){if(!Hf(t))throw Error(Ae(299));var n=!1,r="",s=Dw;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=zf(t,1,!1,null,null,n,!1,r,s),t[$s]=e.current,bl(t.nodeType===8?t.parentNode:t),new Bf(e)};vr.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Ae(188)):(t=Object.keys(t).join(","),Error(Ae(268,t)));return t=sb(e),t=t===null?null:t.stateNode,t};vr.flushSync=function(t){return Wi(t)};vr.hydrate=function(t,e,n){if(!su(e))throw Error(Ae(200));return iu(null,t,e,!0,n)};vr.hydrateRoot=function(t,e,n){if(!Hf(t))throw Error(Ae(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",a=Dw;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),e=$w(e,null,t,1,n??null,s,!1,i,a),t[$s]=e.current,bl(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new ru(e)};vr.render=function(t,e,n){if(!su(e))throw Error(Ae(200));return iu(null,t,e,!1,n)};vr.unmountComponentAtNode=function(t){if(!su(t))throw Error(Ae(40));return t._reactRootContainer?(Wi(function(){iu(null,null,t,!1,function(){t._reactRootContainer=null,t[$s]=null})}),!0):!1};vr.unstable_batchedUpdates=$f;vr.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!su(n))throw Error(Ae(200));if(t==null||t._reactInternals===void 0)throw Error(Ae(38));return iu(t,e,n,!1,r)};vr.version="18.3.1-next-f1338f8080-20240426";function Lw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Lw)}catch(t){console.error(t)}}Lw(),Lv.exports=vr;var Tj=Lv.exports,_0=Tj;Eh.createRoot=_0.createRoot,Eh.hydrateRoot=_0.hydrateRoot;var bp=function(t,e){return bp=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(n[s]=r[s])},bp(t,e)};function Iw(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");bp(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}var jd=function(){return jd=Object.assign||function(e){for(var n,r=1,s=arguments.length;r<s;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},jd.apply(this,arguments)};function ua(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function zw(t,e,n,r){var s=arguments.length,i=s<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,n):r,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(t,e,n,r);else for(var l=t.length-1;l>=0;l--)(a=t[l])&&(i=(s<3?a(i):s>3?a(e,n,i):a(e,n))||i);return s>3&&i&&Object.defineProperty(e,n,i),i}function Fw(t,e){return function(n,r){e(n,r,t)}}function Bw(t,e,n,r,s,i){function a(x){if(x!==void 0&&typeof x!="function")throw new TypeError("Function expected");return x}for(var l=r.kind,c=l==="getter"?"get":l==="setter"?"set":"value",d=!e&&t?r.static?t:t.prototype:null,u=e||(d?Object.getOwnPropertyDescriptor(d,r.name):{}),h,p=!1,f=n.length-1;f>=0;f--){var m={};for(var y in r)m[y]=y==="access"?{}:r[y];for(var y in r.access)m.access[y]=r.access[y];m.addInitializer=function(x){if(p)throw new TypeError("Cannot add initializers after decoration has completed");i.push(a(x||null))};var v=(0,n[f])(l==="accessor"?{get:u.get,set:u.set}:u[c],m);if(l==="accessor"){if(v===void 0)continue;if(v===null||typeof v!="object")throw new TypeError("Object expected");(h=a(v.get))&&(u.get=h),(h=a(v.set))&&(u.set=h),(h=a(v.init))&&s.unshift(h)}else(h=a(v))&&(l==="field"?s.unshift(h):u[c]=h)}d&&Object.defineProperty(d,r.name,u),p=!0}function Hw(t,e,n){for(var r=arguments.length>2,s=0;s<e.length;s++)n=r?e[s].call(t,n):e[s].call(t);return r?n:void 0}function Uw(t){return typeof t=="symbol"?t:"".concat(t)}function Ww(t,e,n){return typeof e=="symbol"&&(e=e.description?"[".concat(e.description,"]"):""),Object.defineProperty(t,"name",{configurable:!0,value:n?"".concat(n," ",e):e})}function Gw(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Qe(t,e,n,r){function s(i){return i instanceof n?i:new n(function(a){a(i)})}return new(n||(n=Promise))(function(i,a){function l(u){try{d(r.next(u))}catch(h){a(h)}}function c(u){try{d(r.throw(u))}catch(h){a(h)}}function d(u){u.done?i(u.value):s(u.value).then(l,c)}d((r=r.apply(t,e||[])).next())})}function Vw(t,e){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,s,i,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=l(0),a.throw=l(1),a.return=l(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(d){return function(u){return c([d,u])}}function c(d){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,d[0]&&(n=0)),n;)try{if(r=1,s&&(i=d[0]&2?s.return:d[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,d[1])).done)return i;switch(s=0,i&&(d=[d[0]&2,i.value]),d[0]){case 0:case 1:i=d;break;case 4:return n.label++,{value:d[1],done:!1};case 5:n.label++,s=d[1],d=[0];continue;case 7:d=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(d[0]===6||d[0]===2)){n=0;continue}if(d[0]===3&&(!i||d[1]>i[0]&&d[1]<i[3])){n.label=d[1];break}if(d[0]===6&&n.label<i[1]){n.label=i[1],i=d;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(d);break}i[2]&&n.ops.pop(),n.trys.pop();continue}d=e.call(t,n)}catch(u){d=[6,u],s=0}finally{r=i=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}var ou=Object.create?function(t,e,n,r){r===void 0&&(r=n);var s=Object.getOwnPropertyDescriptor(e,n);(!s||("get"in s?!e.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,s)}:function(t,e,n,r){r===void 0&&(r=n),t[r]=e[n]};function Yw(t,e){for(var n in t)n!=="default"&&!Object.prototype.hasOwnProperty.call(e,n)&&ou(e,t,n)}function Cd(t){var e=typeof Symbol=="function"&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Uf(t,e){var n=typeof Symbol=="function"&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),s,i=[],a;try{for(;(e===void 0||e-- >0)&&!(s=r.next()).done;)i.push(s.value)}catch(l){a={error:l}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(a)throw a.error}}return i}function qw(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Uf(arguments[e]));return t}function Xw(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),s=0,e=0;e<n;e++)for(var i=arguments[e],a=0,l=i.length;a<l;a++,s++)r[s]=i[a];return r}function Zw(t,e,n){if(n||arguments.length===2)for(var r=0,s=e.length,i;r<s;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))}function oa(t){return this instanceof oa?(this.v=t,this):new oa(t)}function Kw(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(t,e||[]),s,i=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",a),s[Symbol.asyncIterator]=function(){return this},s;function a(f){return function(m){return Promise.resolve(m).then(f,h)}}function l(f,m){r[f]&&(s[f]=function(y){return new Promise(function(v,x){i.push([f,y,v,x])>1||c(f,y)})},m&&(s[f]=m(s[f])))}function c(f,m){try{d(r[f](m))}catch(y){p(i[0][3],y)}}function d(f){f.value instanceof oa?Promise.resolve(f.value.v).then(u,h):p(i[0][2],f)}function u(f){c("next",f)}function h(f){c("throw",f)}function p(f,m){f(m),i.shift(),i.length&&c(i[0][0],i[0][1])}}function Jw(t){var e,n;return e={},r("next"),r("throw",function(s){throw s}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(s,i){e[s]=t[s]?function(a){return(n=!n)?{value:oa(t[s](a)),done:!1}:i?i(a):a}:i}}function Qw(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof Cd=="function"?Cd(t):t[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(i){n[i]=t[i]&&function(a){return new Promise(function(l,c){a=t[i](a),s(l,c,a.done,a.value)})}}function s(i,a,l,c){Promise.resolve(c).then(function(d){i({value:d,done:l})},a)}}function e1(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}var Nj=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e},wp=function(t){return wp=Object.getOwnPropertyNames||function(e){var n=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[n.length]=r);return n},wp(t)};function t1(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n=wp(t),r=0;r<n.length;r++)n[r]!=="default"&&ou(e,t,n[r]);return Nj(e,t),e}function n1(t){return t&&t.__esModule?t:{default:t}}function r1(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)}function s1(t,e,n,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(t,n):s?s.value=n:e.set(t,n),n}function i1(t,e){if(e===null||typeof e!="object"&&typeof e!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof t=="function"?e===t:t.has(e)}function o1(t,e,n){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var r,s;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=e[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=e[Symbol.dispose],n&&(s=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");s&&(r=function(){try{s.call(this)}catch(i){return Promise.reject(i)}}),t.stack.push({value:e,dispose:r,async:n})}else n&&t.stack.push({async:!0});return e}var Pj=typeof SuppressedError=="function"?SuppressedError:function(t,e,n){var r=new Error(n);return r.name="SuppressedError",r.error=t,r.suppressed=e,r};function a1(t){function e(i){t.error=t.hasError?new Pj(i,t.error,"An error was suppressed during disposal."):i,t.hasError=!0}var n,r=0;function s(){for(;n=t.stack.pop();)try{if(!n.async&&r===1)return r=0,t.stack.push(n),Promise.resolve().then(s);if(n.dispose){var i=n.dispose.call(n.value);if(n.async)return r|=2,Promise.resolve(i).then(s,function(a){return e(a),s()})}else r|=1}catch(a){e(a)}if(r===1)return t.hasError?Promise.reject(t.error):Promise.resolve();if(t.hasError)throw t.error}return s()}function l1(t,e){return typeof t=="string"&&/^\.\.?\//.test(t)?t.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(n,r,s,i,a){return r?e?".jsx":".js":s&&(!i||!a)?n:s+i+"."+a.toLowerCase()+"js"}):t}const Rj={__extends:Iw,__assign:jd,__rest:ua,__decorate:zw,__param:Fw,__esDecorate:Bw,__runInitializers:Hw,__propKey:Uw,__setFunctionName:Ww,__metadata:Gw,__awaiter:Qe,__generator:Vw,__createBinding:ou,__exportStar:Yw,__values:Cd,__read:Uf,__spread:qw,__spreadArrays:Xw,__spreadArray:Zw,__await:oa,__asyncGenerator:Kw,__asyncDelegator:Jw,__asyncValues:Qw,__makeTemplateObject:e1,__importStar:t1,__importDefault:n1,__classPrivateFieldGet:r1,__classPrivateFieldSet:s1,__classPrivateFieldIn:i1,__addDisposableResource:o1,__disposeResources:a1,__rewriteRelativeImportExtension:l1},Oj=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:o1,get __assign(){return jd},__asyncDelegator:Jw,__asyncGenerator:Kw,__asyncValues:Qw,__await:oa,__awaiter:Qe,__classPrivateFieldGet:r1,__classPrivateFieldIn:i1,__classPrivateFieldSet:s1,__createBinding:ou,__decorate:zw,__disposeResources:a1,__esDecorate:Bw,__exportStar:Yw,__extends:Iw,__generator:Vw,__importDefault:n1,__importStar:t1,__makeTemplateObject:e1,__metadata:Gw,__param:Fw,__propKey:Uw,__read:Uf,__rest:ua,__rewriteRelativeImportExtension:l1,__runInitializers:Hw,__setFunctionName:Ww,__spread:qw,__spreadArray:Zw,__spreadArrays:Xw,__values:Cd,default:Rj},Symbol.toStringTag,{value:"Module"})),Aj=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class Wf extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}}class k0 extends Wf{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class S0 extends Wf{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class j0 extends Wf{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var _p;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(_p||(_p={}));class Mj{constructor(e,{headers:n={},customFetch:r,region:s=_p.Any}={}){this.url=e,this.headers=n,this.region=s,this.fetch=Aj(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return Qe(this,arguments,void 0,function*(n,r={}){var s;try{const{headers:i,method:a,body:l,signal:c}=r;let d={},{region:u}=r;u||(u=this.region);const h=new URL(`${this.url}/${n}`);u&&u!=="any"&&(d["x-region"]=u,h.searchParams.set("forceFunctionRegion",u));let p;l&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)?typeof Blob<"u"&&l instanceof Blob||l instanceof ArrayBuffer?(d["Content-Type"]="application/octet-stream",p=l):typeof l=="string"?(d["Content-Type"]="text/plain",p=l):typeof FormData<"u"&&l instanceof FormData?p=l:(d["Content-Type"]="application/json",p=JSON.stringify(l)):p=l;const f=yield this.fetch(h.toString(),{method:a||"POST",headers:Object.assign(Object.assign(Object.assign({},d),this.headers),i),body:p,signal:c}).catch(x=>{throw x.name==="AbortError"?x:new k0(x)}),m=f.headers.get("x-relay-error");if(m&&m==="true")throw new S0(f);if(!f.ok)throw new j0(f);let y=((s=f.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),v;return y==="application/json"?v=yield f.json():y==="application/octet-stream"||y==="application/pdf"?v=yield f.blob():y==="text/event-stream"?v=f:y==="multipart/form-data"?v=yield f.formData():v=yield f.text(),{data:v,error:null,response:f}}catch(i){return i instanceof Error&&i.name==="AbortError"?{data:null,error:new k0(i)}:{data:null,error:i,response:i instanceof j0||i instanceof S0?i.context:void 0}}})}}var Hn={};const ha=nk(Oj);var wc={},_c={},kc={},Sc={},jc={},Cc={},C0;function c1(){if(C0)return Cc;C0=1,Object.defineProperty(Cc,"__esModule",{value:!0});class t extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}}return Cc.default=t,Cc}var E0;function d1(){if(E0)return jc;E0=1,Object.defineProperty(jc,"__esModule",{value:!0});const e=ha.__importDefault(c1());class n{constructor(s){var i,a;this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=new Headers(s.headers),this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=(i=s.shouldThrowOnError)!==null&&i!==void 0?i:!1,this.signal=s.signal,this.isMaybeSingle=(a=s.isMaybeSingle)!==null&&a!==void 0?a:!1,s.fetch?this.fetch=s.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,i){return this.headers=new Headers(this.headers),this.headers.set(s,i),this}then(s,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const a=this.fetch;let l=a(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var d,u,h,p;let f=null,m=null,y=null,v=c.status,x=c.statusText;if(c.ok){if(this.method!=="HEAD"){const k=await c.text();k===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((d=this.headers.get("Accept"))===null||d===void 0)&&d.includes("application/vnd.pgrst.plan+text"))?m=k:m=JSON.parse(k))}const w=(u=this.headers.get("Prefer"))===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),b=(h=c.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");w&&b&&b.length>1&&(y=parseInt(b[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(m)&&(m.length>1?(f={code:"PGRST116",details:`Results contain ${m.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},m=null,y=null,v=406,x="Not Acceptable"):m.length===1?m=m[0]:m=null)}else{const w=await c.text();try{f=JSON.parse(w),Array.isArray(f)&&c.status===404&&(m=[],f=null,v=200,x="OK")}catch{c.status===404&&w===""?(v=204,x="No Content"):f={message:w}}if(f&&this.isMaybeSingle&&(!((p=f==null?void 0:f.details)===null||p===void 0)&&p.includes("0 rows"))&&(f=null,v=200,x="OK"),f&&this.shouldThrowOnError)throw new e.default(f)}return{error:f,data:m,count:y,status:v,statusText:x}});return this.shouldThrowOnError||(l=l.catch(c=>{var d,u,h;return{error:{message:`${(d=c==null?void 0:c.name)!==null&&d!==void 0?d:"FetchError"}: ${c==null?void 0:c.message}`,details:`${(u=c==null?void 0:c.stack)!==null&&u!==void 0?u:""}`,hint:"",code:`${(h=c==null?void 0:c.code)!==null&&h!==void 0?h:""}`},data:null,count:null,status:0,statusText:""}})),l.then(s,i)}returns(){return this}overrideTypes(){return this}}return jc.default=n,jc}var T0;function u1(){if(T0)return Sc;T0=1,Object.defineProperty(Sc,"__esModule",{value:!0});const e=ha.__importDefault(d1());class n extends e.default{select(s){let i=!1;const a=(s??"*").split("").map(l=>/\s/.test(l)&&!i?"":(l==='"'&&(i=!i),l)).join("");return this.url.searchParams.set("select",a),this.headers.append("Prefer","return=representation"),this}order(s,{ascending:i=!0,nullsFirst:a,foreignTable:l,referencedTable:c=l}={}){const d=c?`${c}.order`:"order",u=this.url.searchParams.get(d);return this.url.searchParams.set(d,`${u?`${u},`:""}${s}.${i?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(s,{foreignTable:i,referencedTable:a=i}={}){const l=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(l,`${s}`),this}range(s,i,{foreignTable:a,referencedTable:l=a}={}){const c=typeof l>"u"?"offset":`${l}.offset`,d=typeof l>"u"?"limit":`${l}.limit`;return this.url.searchParams.set(c,`${s}`),this.url.searchParams.set(d,`${i-s+1}`),this}abortSignal(s){return this.signal=s,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:s=!1,verbose:i=!1,settings:a=!1,buffers:l=!1,wal:c=!1,format:d="text"}={}){var u;const h=[s?"analyze":null,i?"verbose":null,a?"settings":null,l?"buffers":null,c?"wal":null].filter(Boolean).join("|"),p=(u=this.headers.get("Accept"))!==null&&u!==void 0?u:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${d}; for="${p}"; options=${h};`),d==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(s){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${s}`),this}}return Sc.default=n,Sc}var N0;function Gf(){if(N0)return kc;N0=1,Object.defineProperty(kc,"__esModule",{value:!0});const e=ha.__importDefault(u1()),n=new RegExp("[,()]");class r extends e.default{eq(i,a){return this.url.searchParams.append(i,`eq.${a}`),this}neq(i,a){return this.url.searchParams.append(i,`neq.${a}`),this}gt(i,a){return this.url.searchParams.append(i,`gt.${a}`),this}gte(i,a){return this.url.searchParams.append(i,`gte.${a}`),this}lt(i,a){return this.url.searchParams.append(i,`lt.${a}`),this}lte(i,a){return this.url.searchParams.append(i,`lte.${a}`),this}like(i,a){return this.url.searchParams.append(i,`like.${a}`),this}likeAllOf(i,a){return this.url.searchParams.append(i,`like(all).{${a.join(",")}}`),this}likeAnyOf(i,a){return this.url.searchParams.append(i,`like(any).{${a.join(",")}}`),this}ilike(i,a){return this.url.searchParams.append(i,`ilike.${a}`),this}ilikeAllOf(i,a){return this.url.searchParams.append(i,`ilike(all).{${a.join(",")}}`),this}ilikeAnyOf(i,a){return this.url.searchParams.append(i,`ilike(any).{${a.join(",")}}`),this}is(i,a){return this.url.searchParams.append(i,`is.${a}`),this}in(i,a){const l=Array.from(new Set(a)).map(c=>typeof c=="string"&&n.test(c)?`"${c}"`:`${c}`).join(",");return this.url.searchParams.append(i,`in.(${l})`),this}contains(i,a){return typeof a=="string"?this.url.searchParams.append(i,`cs.${a}`):Array.isArray(a)?this.url.searchParams.append(i,`cs.{${a.join(",")}}`):this.url.searchParams.append(i,`cs.${JSON.stringify(a)}`),this}containedBy(i,a){return typeof a=="string"?this.url.searchParams.append(i,`cd.${a}`):Array.isArray(a)?this.url.searchParams.append(i,`cd.{${a.join(",")}}`):this.url.searchParams.append(i,`cd.${JSON.stringify(a)}`),this}rangeGt(i,a){return this.url.searchParams.append(i,`sr.${a}`),this}rangeGte(i,a){return this.url.searchParams.append(i,`nxl.${a}`),this}rangeLt(i,a){return this.url.searchParams.append(i,`sl.${a}`),this}rangeLte(i,a){return this.url.searchParams.append(i,`nxr.${a}`),this}rangeAdjacent(i,a){return this.url.searchParams.append(i,`adj.${a}`),this}overlaps(i,a){return typeof a=="string"?this.url.searchParams.append(i,`ov.${a}`):this.url.searchParams.append(i,`ov.{${a.join(",")}}`),this}textSearch(i,a,{config:l,type:c}={}){let d="";c==="plain"?d="pl":c==="phrase"?d="ph":c==="websearch"&&(d="w");const u=l===void 0?"":`(${l})`;return this.url.searchParams.append(i,`${d}fts${u}.${a}`),this}match(i){return Object.entries(i).forEach(([a,l])=>{this.url.searchParams.append(a,`eq.${l}`)}),this}not(i,a,l){return this.url.searchParams.append(i,`not.${a}.${l}`),this}or(i,{foreignTable:a,referencedTable:l=a}={}){const c=l?`${l}.or`:"or";return this.url.searchParams.append(c,`(${i})`),this}filter(i,a,l){return this.url.searchParams.append(i,`${a}.${l}`),this}}return kc.default=r,kc}var P0;function h1(){if(P0)return _c;P0=1,Object.defineProperty(_c,"__esModule",{value:!0});const e=ha.__importDefault(Gf());class n{constructor(s,{headers:i={},schema:a,fetch:l}){this.url=s,this.headers=new Headers(i),this.schema=a,this.fetch=l}select(s,i){const{head:a=!1,count:l}=i??{},c=a?"HEAD":"GET";let d=!1;const u=(s??"*").split("").map(h=>/\s/.test(h)&&!d?"":(h==='"'&&(d=!d),h)).join("");return this.url.searchParams.set("select",u),l&&this.headers.append("Prefer",`count=${l}`),new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(s,{count:i,defaultToNull:a=!0}={}){var l;const c="POST";if(i&&this.headers.append("Prefer",`count=${i}`),a||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const d=s.reduce((u,h)=>u.concat(Object.keys(h)),[]);if(d.length>0){const u=[...new Set(d)].map(h=>`"${h}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}upsert(s,{onConflict:i,ignoreDuplicates:a=!1,count:l,defaultToNull:c=!0}={}){var d;const u="POST";if(this.headers.append("Prefer",`resolution=${a?"ignore":"merge"}-duplicates`),i!==void 0&&this.url.searchParams.set("on_conflict",i),l&&this.headers.append("Prefer",`count=${l}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(s)){const h=s.reduce((p,f)=>p.concat(Object.keys(f)),[]);if(h.length>0){const p=[...new Set(h)].map(f=>`"${f}"`);this.url.searchParams.set("columns",p.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}update(s,{count:i}={}){var a;const l="PATCH";return i&&this.headers.append("Prefer",`count=${i}`),new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:s,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}delete({count:s}={}){var i;const a="DELETE";return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}}return _c.default=n,_c}var R0;function $j(){if(R0)return wc;R0=1,Object.defineProperty(wc,"__esModule",{value:!0});const t=ha,e=t.__importDefault(h1()),n=t.__importDefault(Gf());class r{constructor(i,{headers:a={},schema:l,fetch:c}={}){this.url=i,this.headers=new Headers(a),this.schemaName=l,this.fetch=c}from(i){const a=new URL(`${this.url}/${i}`);return new e.default(a,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new r(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,a={},{head:l=!1,get:c=!1,count:d}={}){var u;let h;const p=new URL(`${this.url}/rpc/${i}`);let f;l||c?(h=l?"HEAD":"GET",Object.entries(a).filter(([y,v])=>v!==void 0).map(([y,v])=>[y,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([y,v])=>{p.searchParams.append(y,v)})):(h="POST",f=a);const m=new Headers(this.headers);return d&&m.set("Prefer",`count=${d}`),new n.default({method:h,url:p,headers:m,schema:this.schemaName,body:f,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}}return wc.default=r,wc}Object.defineProperty(Hn,"__esModule",{value:!0});var p1=Hn.PostgrestError=k1=Hn.PostgrestBuilder=w1=Hn.PostgrestTransformBuilder=v1=Hn.PostgrestFilterBuilder=y1=Hn.PostgrestQueryBuilder=m1=Hn.PostgrestClient=void 0;const pa=ha,f1=pa.__importDefault($j());var m1=Hn.PostgrestClient=f1.default;const g1=pa.__importDefault(h1());var y1=Hn.PostgrestQueryBuilder=g1.default;const x1=pa.__importDefault(Gf());var v1=Hn.PostgrestFilterBuilder=x1.default;const b1=pa.__importDefault(u1());var w1=Hn.PostgrestTransformBuilder=b1.default;const _1=pa.__importDefault(d1());var k1=Hn.PostgrestBuilder=_1.default;const S1=pa.__importDefault(c1());p1=Hn.PostgrestError=S1.default;var j1=Hn.default={PostgrestClient:f1.default,PostgrestQueryBuilder:g1.default,PostgrestFilterBuilder:x1.default,PostgrestTransformBuilder:b1.default,PostgrestBuilder:_1.default,PostgrestError:S1.default};const Dj=tk({__proto__:null,get PostgrestBuilder(){return k1},get PostgrestClient(){return m1},get PostgrestError(){return p1},get PostgrestFilterBuilder(){return v1},get PostgrestQueryBuilder(){return y1},get PostgrestTransformBuilder(){return w1},default:j1},[Hn]),{PostgrestClient:Lj,PostgrestQueryBuilder:SG,PostgrestFilterBuilder:jG,PostgrestTransformBuilder:CG,PostgrestBuilder:EG,PostgrestError:TG}=j1||Dj;class Ij{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const n=process.versions;if(n&&n.node){const r=n.node,s=parseInt(r.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const r=this.getWebSocketConstructor();return new r(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const zj="2.79.0",Fj=`realtime-js/${zj}`,Bj="1.0.0",kp=1e4,Hj=1e3,Uj=100;var ll;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(ll||(ll={}));var fn;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(fn||(fn={}));var Xr;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Xr||(Xr={}));var Sp;(function(t){t.websocket="websocket"})(Sp||(Sp={}));var Ni;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Ni||(Ni={}));class Wj{constructor(){this.HEADER_LENGTH=1}decode(e,n){return e.constructor===ArrayBuffer?n(this._binaryDecode(e)):n(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const n=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,n,r)}_decodeBroadcast(e,n,r){const s=n.getUint8(1),i=n.getUint8(2);let a=this.HEADER_LENGTH+2;const l=r.decode(e.slice(a,a+s));a=a+s;const c=r.decode(e.slice(a,a+i));a=a+i;const d=JSON.parse(r.decode(e.slice(a,e.byteLength)));return{ref:null,topic:l,event:c,payload:d}}}class C1{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var It;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(It||(It={}));const O0=(t,e,n={})=>{var r;const s=(r=n.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((i,a)=>(i[a]=Gj(a,t,e,s),i),{}):{}},Gj=(t,e,n,r)=>{const s=e.find(l=>l.name===t),i=s==null?void 0:s.type,a=n[t];return i&&!r.includes(i)?E1(i,a):jp(a)},E1=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return Xj(e,n)}switch(t){case It.bool:return Vj(e);case It.float4:case It.float8:case It.int2:case It.int4:case It.int8:case It.numeric:case It.oid:return Yj(e);case It.json:case It.jsonb:return qj(e);case It.timestamp:return Zj(e);case It.abstime:case It.date:case It.daterange:case It.int4range:case It.int8range:case It.money:case It.reltime:case It.text:case It.time:case It.timestamptz:case It.timetz:case It.tsrange:case It.tstzrange:return jp(e);default:return jp(e)}},jp=t=>t,Vj=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},Yj=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},qj=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},Xj=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let i;const a=t.slice(1,n);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(l=>E1(e,l))}return t},Zj=t=>typeof t=="string"?t.replace(" ","T"):t,T1=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Ju{constructor(e,n,r={},s=kp){this.channel=e,this.event=n,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var A0;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(A0||(A0={}));class cl{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:a,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=cl.syncState(this.state,s,i,a),this.pendingDiffs.forEach(c=>{this.state=cl.syncDiff(this.state,c,i,a)}),this.pendingDiffs=[],l()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:a,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=cl.syncDiff(this.state,s,i,a),l())}),this.onJoin((s,i,a)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:a})}),this.onLeave((s,i,a)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,s){const i=this.cloneDeep(e),a=this.transformState(n),l={},c={};return this.map(i,(d,u)=>{a[d]||(c[d]=u)}),this.map(a,(d,u)=>{const h=i[d];if(h){const p=u.map(v=>v.presence_ref),f=h.map(v=>v.presence_ref),m=u.filter(v=>f.indexOf(v.presence_ref)<0),y=h.filter(v=>p.indexOf(v.presence_ref)<0);m.length>0&&(l[d]=m),y.length>0&&(c[d]=y)}else l[d]=u}),this.syncDiff(i,{joins:l,leaves:c},r,s)}static syncDiff(e,n,r,s){const{joins:i,leaves:a}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(l,c)=>{var d;const u=(d=e[l])!==null&&d!==void 0?d:[];if(e[l]=this.cloneDeep(c),u.length>0){const h=e[l].map(f=>f.presence_ref),p=u.filter(f=>h.indexOf(f.presence_ref)<0);e[l].unshift(...p)}r(l,u,c)}),this.map(a,(l,c)=>{let d=e[l];if(!d)return;const u=c.map(h=>h.presence_ref);d=d.filter(h=>u.indexOf(h.presence_ref)<0),e[l]=d,s(l,d,c),d.length===0&&delete e[l]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{const s=e[r];return"metas"in s?n[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):n[r]=s,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var M0;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(M0||(M0={}));var dl;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(dl||(dl={}));var Ts;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(Ts||(Ts={}));class Vf{constructor(e,n={config:{}},r){var s,i;if(this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=fn.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new Ju(this,Xr.join,this.params,this.timeout),this.rejoinTimer=new C1(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=fn.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=fn.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=fn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=fn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=fn.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Xr.reply,{},(a,l)=>{this._trigger(this._replyEventName(l),a)}),this.presence=new cl(this),this.broadcastEndpointURL=T1(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,n=this.timeout){var r,s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==fn.closed){const{config:{broadcast:a,presence:l,private:c}}=this.params,d=(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(f=>f.filter))!==null&&s!==void 0?s:[],u=!!this.bindings[dl.PRESENCE]&&this.bindings[dl.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,h={},p={broadcast:a,presence:Object.assign(Object.assign({},l),{enabled:u}),postgres_changes:d,private:c};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(f=>e==null?void 0:e(Ts.CHANNEL_ERROR,f)),this._onClose(()=>e==null?void 0:e(Ts.CLOSED)),this.updateJoinPayload(Object.assign({config:p},h)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:f})=>{var m;if(this.socket.setAuth(),f===void 0){e==null||e(Ts.SUBSCRIBED);return}else{const y=this.bindings.postgres_changes,v=(m=y==null?void 0:y.length)!==null&&m!==void 0?m:0,x=[];for(let g=0;g<v;g++){const w=y[g],{filter:{event:b,schema:k,table:_,filter:S}}=w,E=f&&f[g];if(E&&E.event===b&&E.schema===k&&E.table===_&&E.filter===S)x.push(Object.assign(Object.assign({},w),{id:E.id}));else{this.unsubscribe(),this.state=fn.errored,e==null||e(Ts.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=x,e&&e(Ts.SUBSCRIBED);return}}).receive("error",f=>{this.state=fn.errored,e==null||e(Ts.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Ts.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this.state===fn.joined&&e===dl.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,n,r)}async httpSend(e,n,r={}){var s;const i=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(n==null)return Promise.reject("Payload is required for httpSend()");const a={method:"POST",headers:{Authorization:i,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:n,private:this.private}]})},l=await this._fetchWithTimeout(this.broadcastEndpointURL,a,(s=r.timeout)!==null&&s!==void 0?s:this.timeout);if(l.status===202)return{success:!0};let c=l.statusText;try{const d=await l.json();c=d.error||d.message||c}catch{}return Promise.reject(new Error(c))}async send(e,n={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:a}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=d.body)===null||s===void 0?void 0:s.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,l,c;const d=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(l=(a=this.params)===null||a===void 0?void 0:a.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),d.receive("ok",()=>i("ok")),d.receive("error",()=>i("error")),d.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=fn.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Xr.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new Ju(this,Xr.leave,{},e),r.receive("ok",()=>{n(),s("ok")}).receive("timeout",()=>{n(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=fn.closed,this.bindings={}}async _fetchWithTimeout(e,n,r){const s=new AbortController,i=setTimeout(()=>s.abort(),r),a=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:s.signal}));return clearTimeout(i),a}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Ju(this,e,n,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>Uj){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var s,i;const a=e.toLocaleLowerCase(),{close:l,error:c,leave:d,join:u}=Xr;if(r&&[l,c,d,u].indexOf(a)>=0&&r!==this._joinRef())return;let p=this._onMessage(a,n,r);if(n&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(f=>{var m,y,v;return((m=f.filter)===null||m===void 0?void 0:m.event)==="*"||((v=(y=f.filter)===null||y===void 0?void 0:y.event)===null||v===void 0?void 0:v.toLocaleLowerCase())===a}).map(f=>f.callback(p,r)):(i=this.bindings[a])===null||i===void 0||i.filter(f=>{var m,y,v,x,g,w;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in f){const b=f.id,k=(m=f.filter)===null||m===void 0?void 0:m.event;return b&&((y=n.ids)===null||y===void 0?void 0:y.includes(b))&&(k==="*"||(k==null?void 0:k.toLocaleLowerCase())===((v=n.data)===null||v===void 0?void 0:v.type.toLocaleLowerCase()))}else{const b=(g=(x=f==null?void 0:f.filter)===null||x===void 0?void 0:x.event)===null||g===void 0?void 0:g.toLocaleLowerCase();return b==="*"||b===((w=n==null?void 0:n.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===a}).map(f=>{if(typeof p=="object"&&"ids"in p){const m=p.data,{schema:y,table:v,commit_timestamp:x,type:g,errors:w}=m;p=Object.assign(Object.assign({},{schema:y,table:v,commit_timestamp:x,eventType:g,new:{},old:{},errors:w}),this._getPayloadRecords(m))}f.callback(p,r)})}_isClosed(){return this.state===fn.closed}_isJoined(){return this.state===fn.joined}_isJoining(){return this.state===fn.joining}_isLeaving(){return this.state===fn.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){const s=e.toLocaleLowerCase(),i={type:s,filter:n,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,n){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Vf.isEqual(s.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const r in e)if(e[r]!==n[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Xr.close,{},e)}_onError(e){this._on(Xr.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=fn.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=O0(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=O0(e.columns,e.old_record)),n}}const Qu=()=>{},Ec={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Kj=[1e3,2e3,5e3,1e4],Jj=1e4,Qj=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class eC{constructor(e,n){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=kp,this.transport=null,this.heartbeatIntervalMs=Ec.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Qu,this.ref=0,this.reconnectTimer=null,this.logger=Qu,this.conn=null,this.sendBuffer=[],this.serializer=new Wj,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>s?(...i)=>s(...i):(...i)=>fetch(...i),!(!((r=n==null?void 0:n.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${Sp.websocket}`,this.httpEndpoint=T1(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Ij.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Bj}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,n??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case ll.connecting:return Ni.Connecting;case ll.open:return Ni.Open;case ll.closing:return Ni.Closing;default:return Ni.Closed}}isConnected(){return this.connectionState()===Ni.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===r);if(s)return s;{const i=new Vf(`realtime:${e}`,n,this);return this.channels.push(i),i}}push(e){const{topic:n,event:r,payload:s,ref:i}=e,a=()=>{this.encode(e,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${n} ${r} (${i})`,s),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(Hj,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},Ec.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply")try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error")}catch(d){this.log("error","error in heartbeat callback",d)}n.ref&&n.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:s,payload:i,ref:a}=n,l=a?`(${a})`:"",c=i.status||"";this.log("receive",`${c} ${r} ${s} ${l}`.trim(),i),this.channels.filter(d=>d._isMember(r)).forEach(d=>d._trigger(s,i,a)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this.workerRef.terminate()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Xr.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(n);return`${e}${r}${s}`}_workerObjectUrl(e){let n;if(e)n=e;else{const r=new Blob([Qj],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n;e?n=e:this.accessToken?n=await this.accessToken():n=this.accessTokenValue,this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(r=>{const s={access_token:n,version:Fj};n&&r.updateJoinPayload(s),r.joinedOnce&&r._isJoined()&&r._push(Xr.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(n=>{this.log("error",`error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(n)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new C1(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Ec.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,r,s,i,a,l,c,d,u;if(this.transport=(n=e==null?void 0:e.transport)!==null&&n!==void 0?n:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:kp,this.heartbeatIntervalMs=(s=e==null?void 0:e.heartbeatIntervalMs)!==null&&s!==void 0?s:Ec.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(a=e==null?void 0:e.accessToken)!==null&&a!==void 0?a:null,this.heartbeatCallback=(l=e==null?void 0:e.heartbeatCallback)!==null&&l!==void 0?l:Qu,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e==null?void 0:e.reconnectAfterMs)!==null&&c!==void 0?c:h=>Kj[h-1]||Jj,this.encode=(d=e==null?void 0:e.encode)!==null&&d!==void 0?d:(h,p)=>p(JSON.stringify(h)),this.decode=(u=e==null?void 0:e.decode)!==null&&u!==void 0?u:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class Yf extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Qt(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class tC extends Yf{constructor(e,n,r){super(e),this.name="StorageApiError",this.status=n,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Cp extends Yf{constructor(e,n){super(e),this.name="StorageUnknownError",this.originalError=n}}const qf=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),nC=()=>Response,Ep=t=>{if(Array.isArray(t))return t.map(n=>Ep(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,r])=>{const s=n.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=Ep(r)}),e},rC=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},eh=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},sC=(t,e,n)=>Qe(void 0,void 0,void 0,function*(){const r=yield nC();t instanceof r&&!(n!=null&&n.noResolveJson)?t.json().then(s=>{const i=t.status||500,a=(s==null?void 0:s.statusCode)||i+"";e(new tC(eh(s),i,a))}).catch(s=>{e(new Cp(eh(s),s))}):e(new Cp(eh(t),t))}),iC=(t,e,n,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!r?s:(rC(r)?(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r)):s.body=r,e!=null&&e.duplex&&(s.duplex=e.duplex),Object.assign(Object.assign({},s),n))};function Bl(t,e,n,r,s,i){return Qe(this,void 0,void 0,function*(){return new Promise((a,l)=>{t(n,iC(e,r,s,i)).then(c=>{if(!c.ok)throw c;return r!=null&&r.noResolveJson?c:c.json()}).then(c=>a(c)).catch(c=>sC(c,l,r))})})}function Nl(t,e,n,r){return Qe(this,void 0,void 0,function*(){return Bl(t,"GET",e,n,r)})}function Yr(t,e,n,r,s){return Qe(this,void 0,void 0,function*(){return Bl(t,"POST",e,r,s,n)})}function Tp(t,e,n,r,s){return Qe(this,void 0,void 0,function*(){return Bl(t,"PUT",e,r,s,n)})}function oC(t,e,n,r){return Qe(this,void 0,void 0,function*(){return Bl(t,"HEAD",e,Object.assign(Object.assign({},n),{noResolveJson:!0}),r)})}function Xf(t,e,n,r,s){return Qe(this,void 0,void 0,function*(){return Bl(t,"DELETE",e,r,s,n)})}class aC{constructor(e,n){this.downloadFn=e,this.shouldThrowOnError=n}then(e,n){return this.execute().then(e,n)}execute(){return Qe(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Qt(e))return{data:null,error:e};throw e}})}}var N1;class lC{constructor(e,n){this.downloadFn=e,this.shouldThrowOnError=n,this[N1]="BlobDownloadBuilder",this.promise=null}asStream(){return new aC(this.downloadFn,this.shouldThrowOnError)}then(e,n){return this.getPromise().then(e,n)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return Qe(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Qt(e))return{data:null,error:e};throw e}})}}N1=Symbol.toStringTag;const cC={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},$0={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class dC{constructor(e,n={},r,s){this.shouldThrowOnError=!1,this.url=e,this.headers=n,this.bucketId=r,this.fetch=qf(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,n,r,s){return Qe(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},$0),s);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const c=a.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.has("cacheControl")||i.append("cacheControl",a.cacheControl),c&&!i.has("metadata")&&i.append("metadata",this.encodeMetadata(c))):(i=r,l["cache-control"]=`max-age=${a.cacheControl}`,l["content-type"]=a.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!a.duplex&&(a.duplex="half")),s!=null&&s.headers&&(l=Object.assign(Object.assign({},l),s.headers));const d=this._removeEmptyFolders(n),u=this._getFinalPath(d),h=yield(e=="PUT"?Tp:Yr)(this.fetch,`${this.url}/object/${u}`,i,Object.assign({headers:l},a!=null&&a.duplex?{duplex:a.duplex}:{}));return{data:{path:d,id:h.Id,fullPath:h.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(Qt(i))return{data:null,error:i};throw i}})}upload(e,n,r){return Qe(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,n,r)})}uploadToSignedUrl(e,n,r,s){return Qe(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),l=new URL(this.url+`/object/upload/sign/${a}`);l.searchParams.set("token",n);try{let c;const d=Object.assign({upsert:$0.upsert},s),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",d.cacheControl)):(c=r,u["cache-control"]=`max-age=${d.cacheControl}`,u["content-type"]=d.contentType);const h=yield Tp(this.fetch,l.toString(),c,{headers:u});return{data:{path:i,fullPath:h.Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(Qt(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,n){return Qe(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);n!=null&&n.upsert&&(s["x-upsert"]="true");const i=yield Yr(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),a=new URL(this.url+i.url),l=a.searchParams.get("token");if(!l)throw new Yf("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:l},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Qt(r))return{data:null,error:r};throw r}})}update(e,n,r){return Qe(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,n,r)})}move(e,n,r){return Qe(this,void 0,void 0,function*(){try{return{data:yield Yr(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Qt(s))return{data:null,error:s};throw s}})}copy(e,n,r){return Qe(this,void 0,void 0,function*(){try{return{data:{path:(yield Yr(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Qt(s))return{data:null,error:s};throw s}})}createSignedUrl(e,n,r){return Qe(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield Yr(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:n},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const a=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Qt(s))return{data:null,error:s};throw s}})}createSignedUrls(e,n,r){return Qe(this,void 0,void 0,function*(){try{const s=yield Yr(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:n,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Qt(s))return{data:null,error:s};throw s}})}download(e,n){const s=typeof(n==null?void 0:n.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((n==null?void 0:n.transform)||{}),a=i?`?${i}`:"",l=this._getFinalPath(e),c=()=>Nl(this.fetch,`${this.url}/${s}/${l}${a}`,{headers:this.headers,noResolveJson:!0});return new lC(c,this.shouldThrowOnError)}info(e){return Qe(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{const r=yield Nl(this.fetch,`${this.url}/object/info/${n}`,{headers:this.headers});return{data:Ep(r),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Qt(r))return{data:null,error:r};throw r}})}exists(e){return Qe(this,void 0,void 0,function*(){const n=this._getFinalPath(e);try{return yield oC(this.fetch,`${this.url}/object/${n}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Qt(r)&&r instanceof Cp){const s=r.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,n){const r=this._getFinalPath(e),s=[],i=n!=null&&n.download?`download=${n.download===!0?"":n.download}`:"";i!==""&&s.push(i);const l=typeof(n==null?void 0:n.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((n==null?void 0:n.transform)||{});c!==""&&s.push(c);let d=s.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${r}${d}`)}}}remove(e){return Qe(this,void 0,void 0,function*(){try{return{data:yield Xf(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Qt(n))return{data:null,error:n};throw n}})}list(e,n,r){return Qe(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},cC),n),{prefix:e||""});return{data:yield Yr(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Qt(s))return{data:null,error:s};throw s}})}listV2(e,n){return Qe(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield Yr(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},n),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Qt(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const n=[];return e.width&&n.push(`width=${e.width}`),e.height&&n.push(`height=${e.height}`),e.resize&&n.push(`resize=${e.resize}`),e.format&&n.push(`format=${e.format}`),e.quality&&n.push(`quality=${e.quality}`),n.join("&")}}const P1="2.79.0",R1={"X-Client-Info":`storage-js/${P1}`};class uC{constructor(e,n={},r,s){this.shouldThrowOnError=!1;const i=new URL(e);s!=null&&s.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},R1),n),this.fetch=qf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return Qe(this,void 0,void 0,function*(){try{const n=this.listBucketOptionsToQueryString(e);return{data:yield Nl(this.fetch,`${this.url}/bucket${n}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Qt(n))return{data:null,error:n};throw n}})}getBucket(e){return Qe(this,void 0,void 0,function*(){try{return{data:yield Nl(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Qt(n))return{data:null,error:n};throw n}})}createBucket(e){return Qe(this,arguments,void 0,function*(n,r={public:!1}){try{return{data:yield Yr(this.fetch,`${this.url}/bucket`,{id:n,name:n,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Qt(s))return{data:null,error:s};throw s}})}updateBucket(e,n){return Qe(this,void 0,void 0,function*(){try{return{data:yield Tp(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Qt(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Qe(this,void 0,void 0,function*(){try{return{data:yield Yr(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Qt(n))return{data:null,error:n};throw n}})}deleteBucket(e){return Qe(this,void 0,void 0,function*(){try{return{data:yield Xf(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Qt(n))return{data:null,error:n};throw n}})}listBucketOptionsToQueryString(e){const n={};return e&&("limit"in e&&(n.limit=String(e.limit)),"offset"in e&&(n.offset=String(e.offset)),e.search&&(n.search=e.search),e.sortColumn&&(n.sortColumn=e.sortColumn),e.sortOrder&&(n.sortOrder=e.sortOrder)),Object.keys(n).length>0?"?"+new URLSearchParams(n).toString():""}}class hC{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},R1),n),this.fetch=qf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return Qe(this,void 0,void 0,function*(){try{return{data:yield Yr(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Qt(n))return{data:null,error:n};throw n}})}listBuckets(e){return Qe(this,void 0,void 0,function*(){try{const n=new URLSearchParams;(e==null?void 0:e.limit)!==void 0&&n.set("limit",e.limit.toString()),(e==null?void 0:e.offset)!==void 0&&n.set("offset",e.offset.toString()),e!=null&&e.sortColumn&&n.set("sortColumn",e.sortColumn),e!=null&&e.sortOrder&&n.set("sortOrder",e.sortOrder),e!=null&&e.search&&n.set("search",e.search);const r=n.toString(),s=r?`${this.url}/bucket?${r}`:`${this.url}/bucket`;return{data:yield Nl(this.fetch,s,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Qt(n))return{data:null,error:n};throw n}})}deleteBucket(e){return Qe(this,void 0,void 0,function*(){try{return{data:yield Xf(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(Qt(n))return{data:null,error:n};throw n}})}}const Zf={"X-Client-Info":`storage-js/${P1}`,"Content-Type":"application/json"};class O1 extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function ur(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}class th extends O1{constructor(e,n,r){super(e),this.name="StorageVectorsApiError",this.status=n,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class pC extends O1{constructor(e,n){super(e),this.name="StorageVectorsUnknownError",this.originalError=n}}var D0;(function(t){t.InternalError="InternalError",t.S3VectorConflictException="S3VectorConflictException",t.S3VectorNotFoundException="S3VectorNotFoundException",t.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",t.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",t.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(D0||(D0={}));const Kf=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),fC=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},L0=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),mC=(t,e,n)=>Qe(void 0,void 0,void 0,function*(){if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(n!=null&&n.noResolveJson)){const s=t.status||500,i=t;if(typeof i.json=="function")i.json().then(a=>{const l=(a==null?void 0:a.statusCode)||(a==null?void 0:a.code)||s+"";e(new th(L0(a),s,l))}).catch(()=>{const a=s+"",l=i.statusText||`HTTP ${s} error`;e(new th(l,s,a))});else{const a=s+"",l=i.statusText||`HTTP ${s} error`;e(new th(l,s,a))}}else e(new pC(L0(t),t))}),gC=(t,e,n,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return r?(fC(r)?(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r)):s.body=r,Object.assign(Object.assign({},s),n)):s};function yC(t,e,n,r,s,i){return Qe(this,void 0,void 0,function*(){return new Promise((a,l)=>{t(n,gC(e,r,s,i)).then(c=>{if(!c.ok)throw c;if(r!=null&&r.noResolveJson)return c;const d=c.headers.get("content-type");return!d||!d.includes("application/json")?{}:c.json()}).then(c=>a(c)).catch(c=>mC(c,l,r))})})}function hr(t,e,n,r,s){return Qe(this,void 0,void 0,function*(){return yC(t,"POST",e,r,s,n)})}class xC{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Zf),n),this.fetch=Kf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return Qe(this,void 0,void 0,function*(){try{return{data:(yield hr(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ur(n))return{data:null,error:n};throw n}})}getIndex(e,n){return Qe(this,void 0,void 0,function*(){try{return{data:yield hr(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:n},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ur(r))return{data:null,error:r};throw r}})}listIndexes(e){return Qe(this,void 0,void 0,function*(){try{return{data:yield hr(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ur(n))return{data:null,error:n};throw n}})}deleteIndex(e,n){return Qe(this,void 0,void 0,function*(){try{return{data:(yield hr(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:n},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ur(r))return{data:null,error:r};throw r}})}}class vC{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Zf),n),this.fetch=Kf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return Qe(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield hr(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ur(n))return{data:null,error:n};throw n}})}getVectors(e){return Qe(this,void 0,void 0,function*(){try{return{data:yield hr(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ur(n))return{data:null,error:n};throw n}})}listVectors(e){return Qe(this,void 0,void 0,function*(){try{if(e.segmentCount!==void 0){if(e.segmentCount<1||e.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(e.segmentIndex!==void 0&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw new Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield hr(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ur(n))return{data:null,error:n};throw n}})}queryVectors(e){return Qe(this,void 0,void 0,function*(){try{return{data:yield hr(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ur(n))return{data:null,error:n};throw n}})}deleteVectors(e){return Qe(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield hr(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ur(n))return{data:null,error:n};throw n}})}}class bC{constructor(e,n={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Zf),n),this.fetch=Kf(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return Qe(this,void 0,void 0,function*(){try{return{data:(yield hr(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ur(n))return{data:null,error:n};throw n}})}getBucket(e){return Qe(this,void 0,void 0,function*(){try{return{data:yield hr(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ur(n))return{data:null,error:n};throw n}})}listBuckets(){return Qe(this,arguments,void 0,function*(e={}){try{return{data:yield hr(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ur(n))return{data:null,error:n};throw n}})}deleteBucket(e){return Qe(this,void 0,void 0,function*(){try{return{data:(yield hr(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ur(n))return{data:null,error:n};throw n}})}}class wC extends bC{constructor(e,n={}){super(e,n.headers||{},n.fetch)}from(e){return new _C(this.url,this.headers,e,this.fetch)}}class _C extends xC{constructor(e,n,r,s){super(e,n,s),this.vectorBucketName=r}createIndex(e){const n=Object.create(null,{createIndex:{get:()=>super.createIndex}});return Qe(this,void 0,void 0,function*(){return n.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return Qe(this,arguments,void 0,function*(n={}){return e.listIndexes.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){const n=Object.create(null,{getIndex:{get:()=>super.getIndex}});return Qe(this,void 0,void 0,function*(){return n.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){const n=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return Qe(this,void 0,void 0,function*(){return n.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new kC(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class kC extends vC{constructor(e,n,r,s,i){super(e,n,i),this.vectorBucketName=r,this.indexName=s}putVectors(e){const n=Object.create(null,{putVectors:{get:()=>super.putVectors}});return Qe(this,void 0,void 0,function*(){return n.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){const n=Object.create(null,{getVectors:{get:()=>super.getVectors}});return Qe(this,void 0,void 0,function*(){return n.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return Qe(this,arguments,void 0,function*(n={}){return e.listVectors.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){const n=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return Qe(this,void 0,void 0,function*(){return n.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){const n=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return Qe(this,void 0,void 0,function*(){return n.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class SC extends uC{constructor(e,n={},r,s){super(e,n,r,s)}from(e){return new dC(this.url,this.headers,e,this.fetch)}get vectors(){return new wC(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new hC(this.url+"/iceberg",this.headers,this.fetch)}}const jC="2.79.0";let Xa="";typeof Deno<"u"?Xa="deno":typeof document<"u"?Xa="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Xa="react-native":Xa="node";const CC={"X-Client-Info":`supabase-js-${Xa}/${jC}`},EC={headers:CC},TC={schema:"public"},NC={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},PC={},RC=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),OC=()=>Headers,AC=(t,e,n)=>{const r=RC(n),s=OC();return async(i,a)=>{var l;const c=(l=await e())!==null&&l!==void 0?l:t;let d=new s(a==null?void 0:a.headers);return d.has("apikey")||d.set("apikey",t),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},a),{headers:d}))}};function MC(t){return t.endsWith("/")?t:t+"/"}function $C(t,e){var n,r;const{db:s,auth:i,realtime:a,global:l}=t,{db:c,auth:d,realtime:u,global:h}=e,p={db:Object.assign(Object.assign({},c),s),auth:Object.assign(Object.assign({},d),i),realtime:Object.assign(Object.assign({},u),a),storage:{},global:Object.assign(Object.assign(Object.assign({},h),l),{headers:Object.assign(Object.assign({},(n=h==null?void 0:h.headers)!==null&&n!==void 0?n:{}),(r=l==null?void 0:l.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return t.accessToken?p.accessToken=t.accessToken:delete p.accessToken,p}function DC(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(MC(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const A1="2.79.0",po=30*1e3,Np=3,nh=Np*po,LC="http://localhost:9999",IC="supabase.auth.token",zC={"X-Client-Info":`gotrue-js/${A1}`},Pp="X-Supabase-Api-Version",M1={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},FC=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,BC=10*60*1e3;class Pl extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function it(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class HC extends Pl{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function UC(t){return it(t)&&t.name==="AuthApiError"}class Pi extends Pl{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class xi extends Pl{constructor(e,n,r,s){super(e,r,s),this.name=n,this.status=r}}class Ur extends xi{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function WC(t){return it(t)&&t.name==="AuthSessionMissingError"}class ao extends xi{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Tc extends xi{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Nc extends xi{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function GC(t){return it(t)&&t.name==="AuthImplicitGrantRedirectError"}class I0 extends xi{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Rp extends xi{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function rh(t){return it(t)&&t.name==="AuthRetryableFetchError"}class z0 extends xi{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class Op extends xi{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ed="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),F0=` 	
\r=`.split(""),VC=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<F0.length;e+=1)t[F0[e].charCodeAt(0)]=-2;for(let e=0;e<Ed.length;e+=1)t[Ed[e].charCodeAt(0)]=e;return t})();function B0(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(Ed[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(Ed[r]),e.queuedBits-=6}}function $1(t,e,n){const r=VC[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function H0(t){const e=[],n=a=>{e.push(String.fromCodePoint(a))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=a=>{XC(a,r,n)};for(let a=0;a<t.length;a+=1)$1(t.charCodeAt(a),s,i);return e.join("")}function YC(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function qC(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|s)+65536,n+=1}YC(r,e)}}function XC(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if(!(t>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function Ko(t){const e=[],n={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<t.length;s+=1)$1(t.charCodeAt(s),n,r);return new Uint8Array(e)}function ZC(t){const e=[];return qC(t,n=>e.push(n)),new Uint8Array(e)}function Di(t){const e=[],n={queue:0,queuedBits:0},r=s=>{e.push(s)};return t.forEach(s=>B0(s,n,r)),B0(null,n,r),e.join("")}function KC(t){return Math.round(Date.now()/1e3)+t}function JC(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const Dn=()=>typeof window<"u"&&typeof document<"u",wi={tested:!1,writable:!1},D1=()=>{if(!Dn())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(wi.tested)return wi.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),wi.tested=!0,wi.writable=!0}catch{wi.tested=!0,wi.writable=!1}return wi.writable};function QC(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return n.searchParams.forEach((r,s)=>{e[s]=r}),e}const L1=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),eE=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",fo=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},_i=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Vs=async(t,e)=>{await t.removeItem(e)};class au{constructor(){this.promise=new au.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}au.promiseConstructor=Promise;function sh(t){const e=t.split(".");if(e.length!==3)throw new Op("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!FC.test(e[r]))throw new Op("JWT not in base64url format");return{header:JSON.parse(H0(e[0])),payload:JSON.parse(H0(e[1])),signature:Ko(e[2]),raw:{header:e[0],payload:e[1]}}}async function tE(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function nE(t,e){return new Promise((r,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await t(i);if(!e(i,null,a)){r(a);return}}catch(a){if(!e(i,a)){s(a);return}}})()})}function rE(t){return("0"+t.toString(16)).substr(-2)}function sE(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let s="";for(let i=0;i<56;i++)s+=n.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,rE).join("")}async function iE(t){const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function oE(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await iE(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function lo(t,e,n=!1){const r=sE();let s=r;n&&(s+="/PASSWORD_RECOVERY"),await fo(t,`${e}-code-verifier`,s);const i=await oE(r);return[i,r===i?"plain":"s256"]}const aE=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function lE(t){const e=t.headers.get(Pp);if(!e||!e.match(aE))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function cE(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function dE(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const uE=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function co(t){if(!uE.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function ih(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function hE(t,e){return new Proxy(t,{get:(n,r,s)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const i=r.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,r,s)}return!e.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(n,r,s)}})}function U0(t){return JSON.parse(JSON.stringify(t))}const Ci=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),pE=[502,503,504];async function W0(t){var e;if(!eE(t))throw new Rp(Ci(t),0);if(pE.includes(t.status))throw new Rp(Ci(t),t.status);let n;try{n=await t.json()}catch(i){throw new Pi(Ci(i),i)}let r;const s=lE(t);if(s&&s.getTime()>=M1["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new z0(Ci(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Ur}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new z0(Ci(n),t.status,n.weak_password.reasons);throw new HC(Ci(n),t.status||500,r)}const fE=(t,e,n,r)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),n))};async function ut(t,e,n,r){var s;const i=Object.assign({},r==null?void 0:r.headers);i[Pp]||(i[Pp]=M1["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const a=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(a.redirect_to=r.redirectTo);const l=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",c=await mE(t,e,n+l,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(c):{data:Object.assign({},c),error:null}}async function mE(t,e,n,r,s,i){const a=fE(e,r,s,i);let l;try{l=await t(n,Object.assign({},a))}catch(c){throw console.error(c),new Rp(Ci(c),0)}if(l.ok||await W0(l),r!=null&&r.noResolveJson)return l;try{return await l.json()}catch(c){await W0(c)}}function Wr(t){var e;let n=null;xE(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=KC(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function G0(t){const e=Wr(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Js(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function gE(t){return{data:t,error:null}}function yE(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:s,verification_type:i}=t,a=ua(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:n,hashed_token:r,redirect_to:s,verification_type:i},c=Object.assign({},a);return{data:{properties:l,user:c},error:null}}function V0(t){return t}function xE(t){return t.access_token&&t.refresh_token&&t.expires_in}const oh=["global","local","others"];class vE{constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=L1(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,n=oh[0]){if(oh.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${oh.join(", ")}`);try{return await ut(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(it(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await ut(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:Js})}catch(r){if(it(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:n}=e,r=ua(e,["options"]),s=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),await ut(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:yE,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(it(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await ut(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Js})}catch(n){if(it(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,s,i,a,l,c;try{const d={nextPage:null,lastPage:0,total:0},u=await ut(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:V0});if(u.error)throw u.error;const h=await u.json(),p=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,f=(c=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return f.length>0&&(f.forEach(m=>{const y=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(m.split(";")[1].split("=")[1]);d[`${v}Page`]=y}),d.total=parseInt(p)),{data:Object.assign(Object.assign({},h),d),error:null}}catch(d){if(it(d))return{data:{users:[]},error:d};throw d}}async getUserById(e){co(e);try{return await ut(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Js})}catch(n){if(it(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){co(e);try{return await ut(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:Js})}catch(r){if(it(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){co(e);try{return await ut(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:Js})}catch(r){if(it(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){co(e.userId);try{const{data:n,error:r}=await ut(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:n,error:r}}catch(n){if(it(n))return{data:null,error:n};throw n}}async _deleteFactor(e){co(e.userId),co(e.id);try{return{data:await ut(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(it(n))return{data:null,error:n};throw n}}async _listOAuthClients(e){var n,r,s,i,a,l,c;try{const d={nextPage:null,lastPage:0,total:0},u=await ut(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e==null?void 0:e.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:V0});if(u.error)throw u.error;const h=await u.json(),p=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,f=(c=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return f.length>0&&(f.forEach(m=>{const y=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),v=JSON.parse(m.split(";")[1].split("=")[1]);d[`${v}Page`]=y}),d.total=parseInt(p)),{data:Object.assign(Object.assign({},h),d),error:null}}catch(d){if(it(d))return{data:{clients:[]},error:d};throw d}}async _createOAuthClient(e){try{return await ut(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(it(n))return{data:null,error:n};throw n}}async _getOAuthClient(e){try{return await ut(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(it(n))return{data:null,error:n};throw n}}async _updateOAuthClient(e,n){try{return await ut(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:n,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(it(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(e){try{return await ut(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(it(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(e){try{return await ut(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(it(n))return{data:null,error:n};throw n}}}function Y0(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const uo={debug:!!(globalThis&&D1()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class I1 extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class bE extends I1{}async function wE(t,e,n){uo.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),uo.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){uo.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,s.name);try{return await n()}finally{uo.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,s.name)}}else{if(e===0)throw uo.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new bE(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(uo.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function _E(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function z1(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function kE(t){return parseInt(t,16)}function SE(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function jE(t){var e;const{chainId:n,domain:r,expirationTime:s,issuedAt:i=new Date,nonce:a,notBefore:l,requestId:c,resources:d,scheme:u,uri:h,version:p}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${a}`);if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(p!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${p}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const f=z1(t.address),m=u?`${u}://${r}`:r,y=t.statement?`${t.statement}
`:"",v=`${m} wants you to sign in with your Ethereum account:
${f}

${y}`;let x=`URI: ${h}
Version: ${p}
Chain ID: ${n}${a?`
Nonce: ${a}`:""}
Issued At: ${i.toISOString()}`;if(s&&(x+=`
Expiration Time: ${s.toISOString()}`),l&&(x+=`
Not Before: ${l.toISOString()}`),c&&(x+=`
Request ID: ${c}`),d){let g=`
Resources:`;for(const w of d){if(!w||typeof w!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${w}`);g+=`
- ${w}`}x+=g}return`${v}
${x}`}class hn extends Error{constructor({message:e,code:n,cause:r,name:s}){var i;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(i=s??(r instanceof Error?r.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=n}}class Td extends hn{constructor(e,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}),this.name="WebAuthnUnknownError",this.originalError=n}}function CE({error:t,options:e}){var n,r,s;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new hn({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new hn({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((r=i.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new hn({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new hn({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new hn({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new hn({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return i.pubKeyCredParams.filter(l=>l.type==="public-key").length===0?new hn({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new hn({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const a=window.location.hostname;if(F1(a)){if(i.rp.id!==a)return new hn({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new hn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new hn({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new hn({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new hn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function EE({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new hn({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new hn({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const r=window.location.hostname;if(F1(r)){if(n.rpId!==r)return new hn({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new hn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new hn({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new hn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class TE{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const NE=new TE;function PE(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:n,excludeCredentials:r}=t,s=ua(t,["challenge","user","excludeCredentials"]),i=Ko(e).buffer,a=Object.assign(Object.assign({},n),{id:Ko(n.id).buffer}),l=Object.assign(Object.assign({},s),{challenge:i,user:a});if(r&&r.length>0){l.excludeCredentials=new Array(r.length);for(let c=0;c<r.length;c++){const d=r[c];l.excludeCredentials[c]=Object.assign(Object.assign({},d),{id:Ko(d.id).buffer,type:d.type||"public-key",transports:d.transports})}}return l}function RE(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:n}=t,r=ua(t,["challenge","allowCredentials"]),s=Ko(e).buffer,i=Object.assign(Object.assign({},r),{challenge:s});if(n&&n.length>0){i.allowCredentials=new Array(n.length);for(let a=0;a<n.length;a++){const l=n[a];i.allowCredentials[a]=Object.assign(Object.assign({},l),{id:Ko(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return i}function OE(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t;return{id:t.id,rawId:t.id,response:{attestationObject:Di(new Uint8Array(t.response.attestationObject)),clientDataJSON:Di(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function AE(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t,r=t.getClientExtensionResults(),s=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Di(new Uint8Array(s.authenticatorData)),clientDataJSON:Di(new Uint8Array(s.clientDataJSON)),signature:Di(new Uint8Array(s.signature)),userHandle:s.userHandle?Di(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function F1(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function q0(){var t,e;return!!(Dn()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function ME(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Td("Browser returned unexpected credential type",e)}:{data:null,error:new Td("Empty credential response",e)}}catch(e){return{data:null,error:CE({error:e,options:t})}}}async function $E(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Td("Browser returned unexpected credential type",e)}:{data:null,error:new Td("Empty credential response",e)}}catch(e){return{data:null,error:EE({error:e,options:t})}}}const DE={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},LE={userVerification:"preferred",hints:["security-key"]};function Nd(...t){const e=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),n=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),r={};for(const s of t)if(s)for(const i in s){const a=s[i];if(a!==void 0)if(Array.isArray(a))r[i]=a;else if(n(a))r[i]=a;else if(e(a)){const l=r[i];e(l)?r[i]=Nd(l,a):r[i]=Nd(a)}else r[i]=a}return r}function IE(t,e){return Nd(DE,t,e||{})}function zE(t,e){return Nd(LE,t,e||{})}class FE{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:n,friendlyName:r,signal:s},i){try{const{data:a,error:l}=await this.client.mfa.challenge({factorId:e,webauthn:n});if(!a)return{data:null,error:l};const c=s??NE.createNewAbortSignal();if(a.webauthn.type==="create"){const{user:d}=a.webauthn.credential_options.publicKey;d.name||(d.name=`${d.id}:${r}`),d.displayName||(d.displayName=d.name)}switch(a.webauthn.type){case"create":{const d=IE(a.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:u,error:h}=await ME({publicKey:d,signal:c});return u?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}case"request":{const d=zE(a.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:u,error:h}=await $E(Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:d,signal:c}));return u?{data:{factorId:e,challengeId:a.id,webauthn:{type:a.webauthn.type,credential_response:u}},error:null}:{data:null,error:h}}}}catch(a){return it(a)?{data:null,error:a}:{data:null,error:new Pi("Unexpected error in challenge",a)}}}async _verify({challengeId:e,factorId:n,webauthn:r}){return this.client.mfa.verify({factorId:n,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:s}},i){if(!n)return{data:null,error:new Pl("rpId is required for WebAuthn authentication")};try{if(!q0())return{data:null,error:new Pi("Browser does not support WebAuthn",null)};const{data:a,error:l}=await this.challenge({factorId:e,webauthn:{rpId:n,rpOrigins:r},signal:s},{request:i});if(!a)return{data:null,error:l};const{webauthn:c}=a;return this._verify({factorId:e,challengeId:a.challengeId,webauthn:{type:c.type,rpId:n,rpOrigins:r,credential_response:c.credential_response}})}catch(a){return it(a)?{data:null,error:a}:{data:null,error:new Pi("Unexpected error in authenticate",a)}}}async _register({friendlyName:e,rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:s},i){if(!n)return{data:null,error:new Pl("rpId is required for WebAuthn registration")};try{if(!q0())return{data:null,error:new Pi("Browser does not support WebAuthn",null)};const{data:a,error:l}=await this._enroll({friendlyName:e});if(!a)return await this.client.mfa.listFactors().then(u=>{var h;return(h=u.data)===null||h===void 0?void 0:h.all.find(p=>p.factor_type==="webauthn"&&p.friendly_name===e&&p.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u==null?void 0:u.id}):void 0),{data:null,error:l};const{data:c,error:d}=await this._challenge({factorId:a.id,friendlyName:a.friendly_name,webauthn:{rpId:n,rpOrigins:r},signal:s},{create:i});return c?this._verify({factorId:a.id,challengeId:c.challengeId,webauthn:{rpId:n,rpOrigins:r,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:d}}catch(a){return it(a)?{data:null,error:a}:{data:null,error:new Pi("Unexpected error in register",a)}}}}_E();const BE={url:LC,storageKey:IC,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:zC,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function X0(t,e,n){return await n()}const ho={};class Rl{get jwks(){var e,n;return(n=(e=ho[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){ho[this.storageKey]=Object.assign(Object.assign({},ho[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=ho[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){ho[this.storageKey]=Object.assign(Object.assign({},ho[this.storageKey]),{cachedAt:e})}constructor(e){var n,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Rl.nextInstanceID,Rl.nextInstanceID+=1,this.instanceID>0&&Dn()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},BE),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new vE({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=L1(s.fetch),this.lock=s.lock||X0,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,this.throwOnError=s.throwOnError,s.lock?this.lock=s.lock:Dn()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=wE:this.lock=X0,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new FE(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:D1()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Y0(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=Y0(this.memoryStorage)),Dn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${A1}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n={},r="none";if(Dn()&&(n=QC(window.location.href),this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce")),Dn()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:i}=await this._getSessionFromURL(n,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),GC(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:a,redirectType:l}=s;return this._debug("#_initialize()","detected session in URL",a,"redirect type",l),await this._saveSession(a),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return it(n)?this._returnResult({error:n}):this._returnResult({error:new Pi("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,s;try{const i=await ut(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:Wr}),{data:a,error:l}=i;if(l||!a)return this._returnResult({data:{user:null,session:null},error:l});const c=a.session,d=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(i){if(it(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var n,r,s;try{let i;if("email"in e){const{email:u,password:h,options:p}=e;let f=null,m=null;this.flowType==="pkce"&&([f,m]=await lo(this.storage,this.storageKey)),i=await ut(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:p==null?void 0:p.emailRedirectTo,body:{email:u,password:h,data:(n=p==null?void 0:p.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},code_challenge:f,code_challenge_method:m},xform:Wr})}else if("phone"in e){const{phone:u,password:h,options:p}=e;i=await ut(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(r=p==null?void 0:p.data)!==null&&r!==void 0?r:{},channel:(s=p==null?void 0:p.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken}},xform:Wr})}else throw new Tc("You must provide either an email or phone number and a password");const{data:a,error:l}=i;if(l||!a)return this._returnResult({data:{user:null,session:null},error:l});const c=a.session,d=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(i){if(it(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let n;if("email"in e){const{email:i,password:a,options:l}=e;n=await ut(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:G0})}else if("phone"in e){const{phone:i,password:a,options:l}=e;n=await ut(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:G0})}else throw new Tc("You must provide either an email or phone number and a password");const{data:r,error:s}=n;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!r||!r.session||!r.user){const i=new ao;return this._returnResult({data:{user:null,session:null},error:i})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(n){if(it(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(e){var n,r,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,r,s,i,a,l,c,d,u,h,p;let f,m;if("message"in e)f=e.message,m=e.signature;else{const{chain:y,wallet:v,statement:x,options:g}=e;let w;if(Dn())if(typeof v=="object")w=v;else{const T=window;if("ethereum"in T&&typeof T.ethereum=="object"&&"request"in T.ethereum&&typeof T.ethereum.request=="function")w=T.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!(g!=null&&g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=v}const b=new URL((n=g==null?void 0:g.url)!==null&&n!==void 0?n:window.location.href),k=await w.request({method:"eth_requestAccounts"}).then(T=>T).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!k||k.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const _=z1(k[0]);let S=(r=g==null?void 0:g.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!S){const T=await w.request({method:"eth_chainId"});S=kE(T)}const E={domain:b.host,address:_,statement:x,uri:b.href,version:"1",chainId:S,nonce:(s=g==null?void 0:g.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(a=(i=g==null?void 0:g.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&a!==void 0?a:new Date,expirationTime:(l=g==null?void 0:g.signInWithEthereum)===null||l===void 0?void 0:l.expirationTime,notBefore:(c=g==null?void 0:g.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(d=g==null?void 0:g.signInWithEthereum)===null||d===void 0?void 0:d.requestId,resources:(u=g==null?void 0:g.signInWithEthereum)===null||u===void 0?void 0:u.resources};f=jE(E),m=await w.request({method:"personal_sign",params:[SE(f),_]})}try{const{data:y,error:v}=await ut(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:m},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:Wr});if(v)throw v;if(!y||!y.session||!y.user){const x=new ao;return this._returnResult({data:{user:null,session:null},error:x})}return y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),this._returnResult({data:Object.assign({},y),error:v})}catch(y){if(it(y))return this._returnResult({data:{user:null,session:null},error:y});throw y}}async signInWithSolana(e){var n,r,s,i,a,l,c,d,u,h,p,f;let m,y;if("message"in e)m=e.message,y=e.signature;else{const{chain:v,wallet:x,statement:g,options:w}=e;let b;if(Dn())if(typeof x=="object")b=x;else{const _=window;if("solana"in _&&typeof _.solana=="object"&&("signIn"in _.solana&&typeof _.solana.signIn=="function"||"signMessage"in _.solana&&typeof _.solana.signMessage=="function"))b=_.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof x!="object"||!(w!=null&&w.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");b=x}const k=new URL((n=w==null?void 0:w.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in b&&b.signIn){const _=await b.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w==null?void 0:w.signInWithSolana),{version:"1",domain:k.host,uri:k.href}),g?{statement:g}:null));let S;if(Array.isArray(_)&&_[0]&&typeof _[0]=="object")S=_[0];else if(_&&typeof _=="object"&&"signedMessage"in _&&"signature"in _)S=_;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in S&&"signature"in S&&(typeof S.signedMessage=="string"||S.signedMessage instanceof Uint8Array)&&S.signature instanceof Uint8Array)m=typeof S.signedMessage=="string"?S.signedMessage:new TextDecoder().decode(S.signedMessage),y=S.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in b)||typeof b.signMessage!="function"||!("publicKey"in b)||typeof b!="object"||!b.publicKey||!("toBase58"in b.publicKey)||typeof b.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${k.host} wants you to sign in with your Solana account:`,b.publicKey.toBase58(),...g?["",g,""]:[""],"Version: 1",`URI: ${k.href}`,`Issued At: ${(s=(r=w==null?void 0:w.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=w==null?void 0:w.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((a=w==null?void 0:w.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((l=w==null?void 0:w.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((c=w==null?void 0:w.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((d=w==null?void 0:w.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((h=(u=w==null?void 0:w.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||h===void 0)&&h.length?["Resources",...w.signInWithSolana.resources.map(S=>`- ${S}`)]:[]].join(`
`);const _=await b.signMessage(new TextEncoder().encode(m),"utf8");if(!_||!(_ instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=_}}try{const{data:v,error:x}=await ut(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:Di(y)},!((p=e.options)===null||p===void 0)&&p.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:Wr});if(x)throw x;if(!v||!v.session||!v.user){const g=new ao;return this._returnResult({data:{user:null,session:null},error:g})}return v.session&&(await this._saveSession(v.session),await this._notifyAllSubscribers("SIGNED_IN",v.session)),this._returnResult({data:Object.assign({},v),error:x})}catch(v){if(it(v))return this._returnResult({data:{user:null,session:null},error:v});throw v}}async _exchangeCodeForSession(e){const n=await _i(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(n??"").split("/");try{const{data:i,error:a}=await ut(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Wr});if(await Vs(this.storage,`${this.storageKey}-code-verifier`),a)throw a;if(!i||!i.session||!i.user){const l=new ao;return this._returnResult({data:{user:null,session:null,redirectType:null},error:l})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:a})}catch(i){if(it(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:n,provider:r,token:s,access_token:i,nonce:a}=e,l=await ut(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:Wr}),{data:c,error:d}=l;if(d)return this._returnResult({data:{user:null,session:null},error:d});if(!c||!c.session||!c.user){const u=new ao;return this._returnResult({data:{user:null,session:null},error:u})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:c,error:d})}catch(n){if(it(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(e){var n,r,s,i,a;try{if("email"in e){const{email:l,options:c}=e;let d=null,u=null;this.flowType==="pkce"&&([d,u]=await lo(this.storage,this.storageKey));const{error:h}=await ut(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:d,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:h})}if("phone"in e){const{phone:l,options:c}=e,{data:d,error:u}=await ut(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(a=c==null?void 0:c.channel)!==null&&a!==void 0?a:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:d==null?void 0:d.message_id},error:u})}throw new Tc("You must provide either an email or phone number.")}catch(l){if(it(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async verifyOtp(e){var n,r;try{let s,i;"options"in e&&(s=(n=e.options)===null||n===void 0?void 0:n.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:a,error:l}=await ut(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:Wr});if(l)throw l;if(!a)throw new Error("An error occurred on token verification.");const c=a.session,d=a.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),this._returnResult({data:{user:d,session:c},error:null})}catch(s){if(it(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithSSO(e){var n,r,s;try{let i=null,a=null;this.flowType==="pkce"&&([i,a]=await lo(this.storage,this.storageKey));const l=await ut(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:a}),headers:this.headers,xform:gE});return this._returnResult(l)}catch(i){if(it(i))return this._returnResult({data:null,error:i});throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new Ur;const{error:s}=await ut(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(e){if(it(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:a}=await ut(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:a})}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:a,error:l}=await ut(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:l})}throw new Tc("You must provide either an email or phone number and a type")}catch(n){if(it(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await _i(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<nh:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const a=await _i(this.userStorage,this.storageKey+"-user");a!=null&&a.user?e.user=a.user:e.user=ih()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const a={value:this.suppressGetSessionWarning};e.user=hE(e.user,a),a.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await ut(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Js}):await this._useSession(async n=>{var r,s,i;const{data:a,error:l}=n;if(l)throw l;return!(!((r=a.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ur}:await ut(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=a.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:Js})})}catch(n){if(it(n))return WC(n)&&(await this._removeSession(),await Vs(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{const{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new Ur;const a=s.session;let l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await lo(this.storage,this.storageKey));const{data:d,error:u}=await ut(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:a.access_token,xform:Js});if(u)throw u;return a.user=d.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),this._returnResult({data:{user:a.user},error:null})})}catch(r){if(it(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ur;const n=Date.now()/1e3;let r=n,s=!0,i=null;const{payload:a}=sh(e.access_token);if(a.exp&&(r=a.exp,s=r<=n),s){const{data:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(n){if(it(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){const{data:a,error:l}=n;if(l)throw l;e=(r=a.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new Ur;const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(it(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(e,n){try{if(!Dn())throw new Nc("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Nc(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new I0("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Nc("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new I0("No code detected.");const{data:g,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const b=new URL(window.location.href);return b.searchParams.delete("code"),window.history.replaceState(window.history.state,"",b.toString()),{data:{session:g.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:a,expires_in:l,expires_at:c,token_type:d}=e;if(!i||!l||!a||!d)throw new Nc("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(l);let p=u+h;c&&(p=parseInt(c));const f=p-u;f*1e3<=po&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${h}s`);const m=p-h;u-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,p,u):u-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,p,u);const{data:y,error:v}=await this._getUser(i);if(v)throw v;const x={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:h,expires_at:p,refresh_token:a,token_type:d,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:x,redirectType:e.type},error:null})}catch(r){if(it(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await _i(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:s,error:i}=n;if(i)return this._returnResult({error:i});const a=(r=s.session)===null||r===void 0?void 0:r.access_token;if(a){const{error:l}=await this.admin.signOut(a,e);if(l&&!(UC(l)&&(l.status===404||l.status===401||l.status===403)))return this._returnResult({error:l})}return e!=="others"&&(await this._removeSession(),await Vs(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const n=JC(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,s;try{const{data:{session:i},error:a}=n;if(a)throw a;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,n={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await lo(this.storage,this.storageKey,!0));try{return await ut(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(i){if(it(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(n){if(it(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var n;try{const{data:r,error:s}=await this._useSession(async i=>{var a,l,c,d,u;const{data:h,error:p}=i;if(p)throw p;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await ut(this.fetch,"GET",f,{headers:this.headers,jwt:(u=(d=h.session)===null||d===void 0?void 0:d.access_token)!==null&&u!==void 0?u:void 0})});if(s)throw s;return Dn()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),this._returnResult({data:{provider:e.provider,url:r==null?void 0:r.url},error:null})}catch(r){if(it(r))return this._returnResult({data:{provider:e.provider,url:null},error:r});throw r}}async linkIdentityIdToken(e){return await this._useSession(async n=>{var r;try{const{error:s,data:{session:i}}=n;if(s)throw s;const{options:a,provider:l,token:c,access_token:d,nonce:u}=e,h=await ut(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=i==null?void 0:i.access_token)!==null&&r!==void 0?r:void 0,body:{provider:l,id_token:c,access_token:d,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Wr}),{data:p,error:f}=h;return f?this._returnResult({data:{user:null,session:null},error:f}):!p||!p.session||!p.user?this._returnResult({data:{user:null,session:null},error:new ao}):(p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("USER_UPDATED",p.session)),this._returnResult({data:p,error:f}))}catch(s){if(it(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}})}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,s;const{data:i,error:a}=n;if(a)throw a;return await ut(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(n){if(it(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await nE(async s=>(s>0&&await tE(200*Math.pow(2,s-1)),this._debug(n,"refreshing attempt",s),await ut(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Wr})),(s,i)=>{const a=200*Math.pow(2,s);return i&&rh(i)&&Date.now()+a-r<po})}catch(r){if(this._debug(n,"error",r),it(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),Dn()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const s=await _i(this.storage,this.storageKey);if(s&&this.userStorage){let a=await _i(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:s.user},await fo(this.userStorage,this.storageKey+"-user",a)),s.user=(e=a==null?void 0:a.user)!==null&&e!==void 0?e:ih()}else if(s&&!s.user&&!s.user){const a=await _i(this.storage,this.storageKey+"-user");a&&(a!=null&&a.user)?(s.user=a.user,await Vs(this.storage,this.storageKey+"-user"),await fo(this.storage,this.storageKey,s)):s.user=ih()}if(this._debug(r,"session from storage",s),!this._isValidSession(s)){this._debug(r,"session is not valid"),s!==null&&await this._removeSession();return}const i=((n=s.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<nh;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${nh}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:a}=await this._callRefreshToken(s.refresh_token);a&&(console.error(a),rh(a)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:a,error:l}=await this._getUser(s.access_token);!l&&(a!=null&&a.user)?(s.user=a.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(r,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(r,"error",s),console.error(s);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new Ur;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new au;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new Ur;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={data:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(s,"error",i),it(i)){const a={data:null,error:i};return rh(i)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(a),a}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,n,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,n)}catch(c){i.push(c)}});if(await Promise.all(a),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await fo(this.userStorage,this.storageKey+"-user",{user:n.user});const s=Object.assign({},n);delete s.user;const i=U0(s);await fo(this.storage,this.storageKey,i)}else{const s=U0(n);await fo(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await Vs(this.storage,this.storageKey),await Vs(this.storage,this.storageKey+"-code-verifier"),await Vs(this.storage,this.storageKey+"-user"),this.userStorage&&await Vs(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Dn()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),po);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/po);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${po}ms, refresh threshold is ${Np} ticks`),s<=Np&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof I1)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Dn()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){const s=[`provider=${encodeURIComponent(n)}`];if(r!=null&&r.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,a]=await lo(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});s.push(l.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);s.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;const{data:s,error:i}=n;return i?this._returnResult({data:null,error:i}):await ut(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(it(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,s;const{data:i,error:a}=n;if(a)return this._returnResult({data:null,error:a});const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:c,error:d}=await ut(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return d?this._returnResult({data:null,error:d}):(e.factorType==="totp"&&c.type==="totp"&&(!((s=c==null?void 0:c.totp)===null||s===void 0)&&s.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),this._returnResult({data:c,error:null}))})}catch(n){if(it(n))return this._returnResult({data:null,error:n});throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:s,error:i}=n;if(i)return this._returnResult({data:null,error:i});const a=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?OE(e.webauthn.credential_response):AE(e.webauthn.credential_response)})}:{code:e.code}),{data:l,error:c}=await ut(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:a,headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return c?this._returnResult({data:null,error:c}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),this._returnResult({data:l,error:c}))})}catch(n){if(it(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:s,error:i}=n;if(i)return this._returnResult({data:null,error:i});const a=await ut(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});if(a.error)return a;const{data:l}=a;if(l.type!=="webauthn")return{data:l,error:null};switch(l.webauthn.type){case"create":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:PE(l.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:RE(l.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(it(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(e){const{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){var e;const{data:{user:n},error:r}=await this.getUser();if(r)return{data:null,error:r};const s={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=n==null?void 0:n.factors)!==null&&e!==void 0?e:[])s.all.push(i),i.status==="verified"&&s[i.factor_type].push(i);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var e,n;const{data:{session:r},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=sh(r.access_token);let a=null;i.aal&&(a=i.aal);let l=a;((n=(e=r.user.factors)===null||e===void 0?void 0:e.filter(u=>u.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(l="aal2");const d=i.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:d},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async n=>{const{data:{session:r},error:s}=n;return s?this._returnResult({data:null,error:s}):r?await ut(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new Ur})})}catch(n){if(it(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:s},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new Ur});const a=await ut(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:l=>({data:l,error:null})});return a.data&&a.data.redirect_url&&Dn()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(r){if(it(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:s},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new Ur});const a=await ut(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:l=>({data:l,error:null})});return a.data&&a.data.redirect_url&&Dn()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(a.data.redirect_url),a})}catch(r){if(it(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(l=>l.kid===e);if(r)return r;const s=Date.now();if(r=this.jwks.keys.find(l=>l.kid===e),r&&this.jwks_cached_at+BC>s)return r;const{data:i,error:a}=await ut(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=s,r=i.keys.find(l=>l.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){const{data:f,error:m}=await this.getSession();if(m||!f.session)return this._returnResult({data:null,error:m});r=f.session.access_token}const{header:s,payload:i,signature:a,raw:{header:l,payload:c}}=sh(r);n!=null&&n.allowExpired||cE(i.exp);const d=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!d){const{error:f}=await this.getUser(r);if(f)throw f;return{data:{claims:i,header:s,signature:a},error:null}}const u=dE(s.alg),h=await crypto.subtle.importKey("jwk",d,u,!0,["verify"]);if(!await crypto.subtle.verify(u,h,a,ZC(`${l}.${c}`)))throw new Op("Invalid JWT signature");return{data:{claims:i,header:s,signature:a},error:null}}catch(r){if(it(r))return this._returnResult({data:null,error:r});throw r}}}Rl.nextInstanceID=0;const HE=Rl;class UE extends HE{constructor(e){super(e)}}class WE{constructor(e,n,r){var s,i,a;this.supabaseUrl=e,this.supabaseKey=n;const l=DC(e);if(!n)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,d={db:TC,realtime:PC,auth:Object.assign(Object.assign({},NC),{storageKey:c}),global:EC},u=$C(r??{},d);this.storageKey=(s=u.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(h,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=u.auth)!==null&&a!==void 0?a:{},this.headers,u.global.fetch),this.fetch=AC(n,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new Lj(new URL("rest/v1",l).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),this.storage=new SC(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),u.accessToken||this._listenForAuthEvents()}get functions(){return new Mj(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,n={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,n,r)}channel(e,n={config:{}}){return this.realtime.channel(e,n)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,n;if(this.accessToken)return await this.accessToken();const{data:r}=await this.auth.getSession();return(n=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&n!==void 0?n:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:s,userStorage:i,storageKey:a,flowType:l,lock:c,debug:d,throwOnError:u},h,p){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new UE({url:this.authUrl.href,headers:Object.assign(Object.assign({},f),h),storageKey:a,autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:s,userStorage:i,flowType:l,lock:c,debug:d,throwOnError:u,fetch:p,hasCustomAuthorizationHeader:Object.keys(this.headers).some(m=>m.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new eC(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,r)=>{this._handleTokenChanged(n,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,n,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),n=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const GE=(t,e,n)=>new WE(t,e,n);function VE(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}VE()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Z0={DRAFTIFY:"/api/studio-draftify",GEOMETRIC_GENERATE:"/api/studio-generate-geometric"},K0={URL:"https://okakomwfikxmwllvliva.supabase.co",ANON_KEY:""},J0={AUTH_SESSION:"studio_auth_session"},Ri={BLEND_MODE_ENABLED:!1},gn=GE(K0.URL,K0.ANON_KEY),Kr={async signIn(t,e){const{data:n,error:r}=await gn.auth.signInWithPassword({email:t,password:e});if(r)throw r;return localStorage.setItem(J0.AUTH_SESSION,JSON.stringify(n.session)),n},async signOut(){await gn.auth.signOut(),localStorage.removeItem(J0.AUTH_SESSION)},async getSession(){const{data:t}=await gn.auth.getSession();return t.session},async updatePassword(t){const{data:e,error:n}=await gn.auth.updateUser({password:t});if(n)throw n;return await gn.auth.updateUser({data:{password_setup_complete:!0}}),e},onAuthStateChange(t){return gn.auth.onAuthStateChange(t)}};async function lu(){var n,r;const t=await gn.auth.getSession(),e=(r=(n=t==null?void 0:t.data)==null?void 0:n.session)==null?void 0:r.access_token;if(!e)throw new Error("Not authenticated");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function Jf(t){const e=await lu(),n=await fetch("/api/designs/save",{method:"POST",headers:e,body:JSON.stringify(t)});if(!n.ok){const r=await n.json();throw new Error(r.error||"Unable to save your design. Please check your connection and try again.")}return n.json()}async function Pd({project_id:t,limit:e=50,offset:n=0,search:r}={}){const s=await lu(),i=new URLSearchParams;t&&i.append("project_id",t),i.append("limit",e),i.append("offset",n),r&&i.append("search",r);const a=await fetch(`/api/designs/list?${i}`,{method:"GET",headers:s});if(!a.ok){const l=await a.json();throw new Error(l.error||"Unable to load your designs. Please refresh the page and try again.")}return a.json()}async function Hl(t){const e=await lu(),n=await fetch(`/api/designs/by-id?id=${t}`,{method:"GET",headers:e});if(!n.ok){const r=await n.json();throw new Error(r.error||"Unable to open this design. It may have been deleted or you may not have permission to view it.")}return n.json()}async function YE(t){const e=await lu(),n=await fetch(`/api/designs/by-id?id=${t}`,{method:"DELETE",headers:e});if(!n.ok){const r=await n.json();throw new Error(r.error||"Unable to delete this design. Please check your connection and try again.")}return n.json()}class qE extends D.Component{constructor(n){super(n);rc(this,"handleReset",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(n){return{hasError:!0}}componentDidCatch(n,r){console.error("[ErrorBoundary] Caught error:",n,r),this.setState({error:n,errorInfo:r})}render(){return this.state.hasError?o.jsxs("div",{className:"error-boundary",children:[o.jsxs("div",{className:"error-content",children:[o.jsx("h1",{children:"Something went wrong"}),o.jsx("p",{children:"We're sorry, but something unexpected happened. Please try refreshing the page."}),o.jsxs("div",{className:"error-actions",children:[o.jsx("button",{onClick:this.handleReset,className:"btn-primary",children:"Try Again"}),o.jsx("button",{onClick:()=>window.location.reload(),className:"btn-secondary",children:"Refresh Page"})]}),!1]}),o.jsx("style",{jsx:!0,children:`
            .error-boundary {
              min-height: 100vh;
              display: flex;
              align-items: center;
              justify-content: center;
              padding: 2rem;
              background: #f9fafb;
            }

            .error-content {
              max-width: 500px;
              text-align: center;
              background: white;
              padding: 3rem;
              border-radius: 12px;
              box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            }

            h1 {
              color: #1e4a7a;
              margin: 0 0 1rem 0;
              font-size: 1.75rem;
            }

            p {
              color: #6b7280;
              margin: 0 0 2rem 0;
              line-height: 1.6;
            }

            .error-actions {
              display: flex;
              gap: 1rem;
              justify-content: center;
            }

            .btn-primary,
            .btn-secondary {
              padding: 0.75rem 1.5rem;
              border-radius: 6px;
              font-weight: 500;
              cursor: pointer;
              transition: all 0.2s;
              border: none;
            }

            .btn-primary {
              background: #ff6b35;
              color: white;
            }

            .btn-primary:hover {
              background: #e55a2b;
              transform: translateY(-1px);
            }

            .btn-secondary {
              background: white;
              color: #374151;
              border: 1px solid #d1d5db;
            }

            .btn-secondary:hover {
              background: #f9fafb;
            }

            .error-details {
              margin-top: 2rem;
              text-align: left;
              font-size: 0.875rem;
            }

            .error-details summary {
              cursor: pointer;
              color: #6b7280;
              margin-bottom: 0.5rem;
            }

            .error-details pre {
              background: #f3f4f6;
              padding: 1rem;
              border-radius: 4px;
              overflow-x: auto;
              font-size: 0.75rem;
              color: #dc2626;
            }
          `})]}):this.props.children}}const XE="modulepreload",ZE=function(t){return"/"+t},Q0={},KE=function(e,n,r){let s=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.allSettled(n.map(c=>{if(c=ZE(c),c in Q0)return;Q0[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":XE,d||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),d)return new Promise((p,f)=>{h.addEventListener("load",p),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return s.then(a=>{for(const l of a||[])l.status==="rejected"&&i(l.reason);return e().catch(i)})},ey=t=>{let e;const n=new Set,r=(d,u)=>{const h=typeof d=="function"?d(e):d;if(!Object.is(h,e)){const p=e;e=u??(typeof h!="object"||h===null)?h:Object.assign({},e,h),n.forEach(f=>f(e,p))}},s=()=>e,l={setState:r,getState:s,getInitialState:()=>c,subscribe:d=>(n.add(d),()=>n.delete(d))},c=e=t(r,s,l);return l},JE=t=>t?ey(t):ey,QE=t=>t;function e5(t,e=QE){const n=D.useSyncExternalStore(t.subscribe,D.useCallback(()=>e(t.getState()),[t,e]),D.useCallback(()=>e(t.getInitialState()),[t,e]));return D.useDebugValue(n),n}const ty=t=>{const e=JE(t),n=r=>e5(e,r);return Object.assign(n,e),n},B1=t=>t?ty(t):ty,ny={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},Ol=new Map,Pc=t=>{const e=Ol.get(t);return e?Object.fromEntries(Object.entries(e.stores).map(([n,r])=>[n,r.getState()])):{}},t5=(t,e,n)=>{if(t===void 0)return{type:"untracked",connection:e.connect(n)};const r=Ol.get(n.name);if(r)return{type:"tracked",store:t,...r};const s={connection:e.connect(n),stores:{}};return Ol.set(n.name,s),{type:"tracked",store:t,...s}},n5=(t,e)=>{if(e===void 0)return;const n=Ol.get(t);n&&(delete n.stores[e],Object.keys(n.stores).length===0&&Ol.delete(t))},r5=t=>{var e,n;if(!t)return;const r=t.split(`
`),s=r.findIndex(a=>a.includes("api.setState"));if(s<0)return;const i=((e=r[s+1])==null?void 0:e.trim())||"";return(n=/.+ (.+) .+/.exec(i))==null?void 0:n[1]},s5=(t,e={})=>(n,r,s)=>{const{enabled:i,anonymousActionType:a,store:l,...c}=e;let d;try{d=(i??(ny?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!d)return t(n,r,s);const{connection:u,...h}=t5(l,d,c);let p=!0;s.setState=(y,v,x)=>{const g=n(y,v);if(!p)return g;const w=x===void 0?{type:a||r5(new Error().stack)||"anonymous"}:typeof x=="string"?{type:x}:x;return l===void 0?(u==null||u.send(w,r()),g):(u==null||u.send({...w,type:`${l}/${w.type}`},{...Pc(c.name),[l]:s.getState()}),g)},s.devtools={cleanup:()=>{u&&typeof u.unsubscribe=="function"&&u.unsubscribe(),n5(c.name,l)}};const f=(...y)=>{const v=p;p=!1,n(...y),p=v},m=t(s.setState,r,s);if(h.type==="untracked"?u==null||u.init(m):(h.stores[h.store]=s,u==null||u.init(Object.fromEntries(Object.entries(h.stores).map(([y,v])=>[y,y===h.store?m:v.getState()])))),s.dispatchFromDevtools&&typeof s.dispatch=="function"){let y=!1;const v=s.dispatch;s.dispatch=(...x)=>{(ny?"production":void 0)!=="production"&&x[0].type==="__setState"&&!y&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),y=!0),v(...x)}}return u.subscribe(y=>{var v;switch(y.type){case"ACTION":if(typeof y.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return ah(y.payload,x=>{if(x.type==="__setState"){if(l===void 0){f(x.state);return}Object.keys(x.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const g=x.state[l];if(g==null)return;JSON.stringify(s.getState())!==JSON.stringify(g)&&f(g);return}s.dispatchFromDevtools&&typeof s.dispatch=="function"&&s.dispatch(x)});case"DISPATCH":switch(y.payload.type){case"RESET":return f(m),l===void 0?u==null?void 0:u.init(s.getState()):u==null?void 0:u.init(Pc(c.name));case"COMMIT":if(l===void 0){u==null||u.init(s.getState());return}return u==null?void 0:u.init(Pc(c.name));case"ROLLBACK":return ah(y.state,x=>{if(l===void 0){f(x),u==null||u.init(s.getState());return}f(x[l]),u==null||u.init(Pc(c.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return ah(y.state,x=>{if(l===void 0){f(x);return}JSON.stringify(s.getState())!==JSON.stringify(x[l])&&f(x[l])});case"IMPORT_STATE":{const{nextLiftedState:x}=y.payload,g=(v=x.computedStates.slice(-1)[0])==null?void 0:v.state;if(!g)return;f(l===void 0?g:g[l]),u==null||u.send(null,x);return}case"PAUSE_RECORDING":return p=!p}return}}),m},H1=s5,ah=(t,e)=>{let n;try{n=JSON.parse(t)}catch(r){console.error("[zustand devtools middleware] Could not parse the received json",r)}n!==void 0&&e(n)};function U1(t){let e=t%2147483647;return e<=0&&(e+=2147483646),function(){return e=e*16807%2147483647,(e-1)/2147483646}}function ry(t,e,n){const r=U1(n),s=[],i=.4,a=.5,l=.5;for(let c=0;c<t;c++){const d=c/t*Math.PI*2-Math.PI/2,u=(r()-.5)*.4*e,h=d+u,p=1+(r()-.5)*e*.8,f=i*p,m=a+f*Math.cos(h),y=l+f*Math.sin(h),v=.35/t*(1+e*(r()-.5)),x=h+Math.PI/2,g=(r()-.5)*.3*e,w=x+Math.PI+g,b=x+g;s.push({x:m,y,handleIn:{x:Math.cos(w)*v,y:Math.sin(w)*v},handleOut:{x:Math.cos(b)*v,y:Math.sin(b)*v}})}return s}function i5(t,e,n){if(!t||t.length<3)return o5(e,n);const r=[],s=t.length;for(let i=0;i<s;i++){const a=t[i],l=t[(i+1)%s],c=a.x*e,d=a.y*n,u=l.x*e,h=l.y*n,p=c+a.handleOut.x*e,f=d+a.handleOut.y*n,m=u+l.handleIn.x*e,y=h+l.handleIn.y*n;i===0&&r.push(`M ${c.toFixed(2)},${d.toFixed(2)}`),r.push(`C ${p.toFixed(2)},${f.toFixed(2)} ${m.toFixed(2)},${y.toFixed(2)} ${u.toFixed(2)},${h.toFixed(2)}`)}return r.push("Z"),r.join(" ")}function o5(t,e){const n=t/2,r=e/2,s=n,i=r;return`M ${s-n},${i} A ${n},${r} 0 1,1 ${s+n},${i} A ${n},${r} 0 1,1 ${s-n},${i} Z`}function a5(){const n=[];for(let a=0;a<8;a++){const l=a/8*Math.PI*2-Math.PI/2,c=.5+.4*Math.cos(l),d=.5+.4*Math.sin(l),u=l+Math.PI/2;n.push({x:c,y:d,handleIn:{x:Math.cos(u+Math.PI)*.2,y:Math.sin(u+Math.PI)*.2},handleOut:{x:Math.cos(u)*.2,y:Math.sin(u)*.2}})}return n}const Rd={organic:{name:"Organic",description:"Smooth, gentle curves like a pebble",minPoints:6,maxPoints:8,blobinessMin:.15,blobinessMax:.25,handleLengthFactor:.4,radiusVariation:.15},splashy:{name:"Splashy",description:"Irregular edges, some spikes like paint splatter",minPoints:10,maxPoints:12,blobinessMin:.3,blobinessMax:.5,handleLengthFactor:.25,radiusVariation:.35},cloudy:{name:"Cloudy",description:"Soft bumps, fluffy cloud-like appearance",minPoints:8,maxPoints:10,blobinessMin:.2,blobinessMax:.3,handleLengthFactor:.5,radiusVariation:.2},rocky:{name:"Rocky",description:"Angular variations, irregular stone-like edges",minPoints:8,maxPoints:12,blobinessMin:.25,blobinessMax:.4,handleLengthFactor:.2,radiusVariation:.3}};function lh(t,e){const n=Rd[t]||Rd.organic,r=U1(e),s=Math.floor(r()*(n.maxPoints-n.minPoints+1))+n.minPoints,i=n.blobinessMin+r()*(n.blobinessMax-n.blobinessMin),a=[],l=.4,c=.5,d=.5;for(let u=0;u<s;u++){const h=u/s*Math.PI*2-Math.PI/2,p=(r()-.5)*.4*i,f=h+p,m=1+(r()-.5)*n.radiusVariation*2,y=l*m,v=c+y*Math.cos(f),x=d+y*Math.sin(f),w=n.handleLengthFactor/s*(.8+r()*.4),b=f+Math.PI/2,k=(r()-.5)*.3*i,_=b+Math.PI+k,S=b+k;a.push({x:v,y:x,handleIn:{x:Math.cos(_)*w,y:Math.sin(_)*w},handleOut:{x:Math.cos(S)*w,y:Math.sin(S)*w}})}return a}function l5(t,e,n,r){return{x:n?.5-(t-.5):t,y:r?.5-(e-.5):e}}function c5(t,e,n,r){return{x:n?-t:t,y:r?-e:e}}function W1(t,e,n,r=4){const s=[{index:t,mirrorX:!1,mirrorY:!1,rotationAngle:0}];if(n==="none"||!n)return s;if(n==="horizontal"){const i=(e-t)%e;return i!==t&&s.push({index:i,mirrorX:!0,mirrorY:!1,rotationAngle:0}),s}if(n==="vertical"){const i=(Math.floor(e/2)-t+e)%e;return i!==t&&s.push({index:i,mirrorX:!1,mirrorY:!0,rotationAngle:0}),s}if(n==="radial"){for(let i=1;i<r;i++){const a=Math.round(t+i*e/r)%e;if(a!==t){const l=i*2*Math.PI/r;s.push({index:a,mirrorX:!1,mirrorY:!1,rotationAngle:l})}}return s}return s}function d5(t,e,n,r,s,i=4){if(s==="none"||!s)return t.map((l,c)=>c!==e?l:{...l,x:n,y:r});const a=W1(e,t.length,s,i);return t.map((l,c)=>{const d=a.find(h=>h.index===c);if(!d)return l;if(d.rotationAngle!==0){const f=n-.5,m=r-.5,y=Math.cos(d.rotationAngle),v=Math.sin(d.rotationAngle);return{...l,x:.5+f*y-m*v,y:.5+f*v+m*y}}const u=l5(n,r,d.mirrorX,d.mirrorY);return{...l,x:u.x,y:u.y}})}function u5(t,e,n,r,s,i,a=4){if(i==="none"||!i)return t.map((c,d)=>d!==e?c:{...c,[n]:{x:r,y:s}});const l=W1(e,t.length,i,a);return t.map((c,d)=>{const u=l.find(m=>m.index===d);if(!u)return c;let h=n,p=r,f=s;if(u.rotationAngle!==0){const m=Math.cos(u.rotationAngle),y=Math.sin(u.rotationAngle);p=r*m-s*y,f=r*y+s*m}else{const m=c5(r,s,u.mirrorX,u.mirrorY);p=m.x,f=m.y}return{...c,[h]:{x:p,y:f}}})}function G1(t,e,n,r=!0,s=!1){if(!t||t.length<2)return"";const i=[],a=t.length;for(let l=0;l<a;l++){const c=t[l],d=l===a-1,u=r?t[(l+1)%a]:d?null:t[l+1],h=c.x*e,p=c.y*n;if(l===0&&i.push(`M ${h.toFixed(2)},${p.toFixed(2)}`),!u)continue;const f=u.x*e,m=u.y*n;if(s&&c.handleOut&&u.handleIn){const y=h+c.handleOut.x*e,v=p+c.handleOut.y*n,x=f+u.handleIn.x*e,g=m+u.handleIn.y*n;i.push(`C ${y.toFixed(2)},${v.toFixed(2)} ${x.toFixed(2)},${g.toFixed(2)} ${f.toFixed(2)},${m.toFixed(2)}`)}else i.push(`L ${f.toFixed(2)},${m.toFixed(2)}`)}return r&&i.push("Z"),i.join(" ")}function ch(t,e=!0,n=.3){if(!t||t.length<2)return t;const r=t.length,s=t.map(i=>({...i,handleIn:{x:0,y:0},handleOut:{x:0,y:0}}));for(let i=0;i<r;i++){const a=e?t[(i-1+r)%r]:i>0?t[i-1]:t[i];t[i];const l=e?t[(i+1)%r]:i<r-1?t[i+1]:t[i],c=l.x-a.x,d=l.y-a.y,u=n*.5;!e&&i===0?(s[i].handleIn={x:0,y:0},s[i].handleOut={x:c*u,y:d*u}):!e&&i===r-1?(s[i].handleIn={x:-c*u,y:-d*u},s[i].handleOut={x:0,y:0}):(s[i].handleIn={x:-c*u,y:-d*u},s[i].handleOut={x:c*u,y:d*u})}return s}function h5(t,e,n,r){const s={x:n,y:r,handleIn:{x:0,y:0},handleOut:{x:0,y:0}},i=[...t];return i.splice(e,0,s),i}function p5(t,e,n=3){if(t.length<=n)return null;const r=[...t];return r.splice(e,1),r}function f5(t){switch(t){case"l-shape":return[{x:0,y:0,handleIn:{x:0,y:0},handleOut:{x:0,y:0}},{x:.5,y:0,handleIn:{x:0,y:0},handleOut:{x:0,y:0}},{x:.5,y:.5,handleIn:{x:0,y:0},handleOut:{x:0,y:0}},{x:1,y:.5,handleIn:{x:0,y:0},handleOut:{x:0,y:0}},{x:1,y:1,handleIn:{x:0,y:0},handleOut:{x:0,y:0}},{x:0,y:1,handleIn:{x:0,y:0},handleOut:{x:0,y:0}}];case"custom":default:return[{x:0,y:0,handleIn:{x:0,y:0},handleOut:{x:0,y:0}},{x:1,y:0,handleIn:{x:0,y:0},handleOut:{x:0,y:0}},{x:1,y:1,handleIn:{x:0,y:0},handleOut:{x:0,y:0}},{x:0,y:1,handleIn:{x:0,y:0},handleOut:{x:0,y:0}}]}}function sy(t,e={}){switch(t){case"l-shape":{const n=e.cutWidth??.6,r=e.cutHeight??.4;return[{x:0,y:0},{x:n,y:0},{x:n,y:r},{x:1,y:r},{x:1,y:1},{x:0,y:1}]}case"u-shape":{const n=e.cutStart??.35,r=e.cutEnd??.65,s=e.cutHeight??.4;return[{x:0,y:0},{x:n,y:0},{x:n,y:s},{x:r,y:s},{x:r,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}]}case"t-shape":{const n=e.stemStart??.3,r=e.stemEnd??.7,s=e.stemHeight??.4;return[{x:0,y:0},{x:1,y:0},{x:1,y:s},{x:r,y:s},{x:r,y:1},{x:n,y:1},{x:n,y:s},{x:0,y:s}]}case"rectangle":default:return null}}function m5(t){switch(t){case"l-shape":return{cutWidth:.6,cutHeight:.4};case"u-shape":return{cutStart:.35,cutEnd:.65,cutHeight:.4};case"t-shape":return{stemStart:.3,stemEnd:.7,stemHeight:.4};default:return{}}}const dh={surface:{width_mm:5e4,length_mm:5e4,color:{tpv_code:"RH12",hex:"#006C55",name:"Dark Green"},boundary:{type:"rectangle",controlPoints:null}},courts:{},selectedCourtId:null,tracks:{},selectedTrackId:null,motifs:{},selectedMotifId:null,shapes:{},selectedShapeId:null,texts:{},selectedTextId:null,exclusionZones:{},selectedExclusionZoneId:null,groups:{},selectedGroupId:null,selectedElementIds:[],clipboard:null,editingGroupId:null,elementOrder:[],customMarkings:[],backgroundZones:[],designName:"Untitled Design",designDescription:"",designTags:[],history:[],historyIndex:-1,maxHistory:50,showCourtLibrary:!0,showPropertiesPanel:!0,propertiesPanelUserClosed:!1,showColorEditor:!1,snapToGrid:!0,gridSize_mm:100,zoom:1,mobileLibraryOpen:!1,mobilePropertiesOpen:!1,mobileColoursOpen:!1,mobileActiveTab:"courts",standaloneMode:!1,standaloneDesignId:null,pathDrawingMode:!1,activePathId:null,isSaving:!1,lastSaved:null,isDirty:!1,isInteracting:!1,lastSavedHash:null,autosaveTimer:null},at=B1(H1((t,e)=>({...dh,setSurfaceDimensions:(n,r)=>{t(s=>({surface:{...s.surface,width_mm:n,length_mm:r}})),e().addToHistory()},setSurfaceColor:n=>{t(r=>({surface:{...r.surface,color:n}})),e().addToHistory()},setSurfaceBoundaryPreset:n=>{const r=m5(n),s=sy(n,r);t(i=>({surface:{...i.surface,boundary:{type:n,controlPoints:s,params:r}}})),e().addToHistory()},updateBoundaryParams:n=>{var l;const r=e(),s=(l=r.surface.boundary)==null?void 0:l.type;if(!s||s==="rectangle"||s==="custom")return;const i={...r.surface.boundary.params,...n},a=sy(s,i);t(c=>({surface:{...c.surface,boundary:{...c.surface.boundary,controlPoints:a,params:i}}})),e().addToHistory()},setSurfaceBoundaryPoints:n=>{t(r=>({surface:{...r.surface,boundary:{type:"custom",controlPoints:n}}})),e().addToHistory()},resetSurfaceBoundary:()=>{t(n=>({surface:{...n.surface,boundary:{type:"rectangle",controlPoints:null}}})),e().addToHistory()},addCourt:(n,r)=>{const s=`court-${Date.now()}`,i=u=>({RH01:{tpv_code:"RH01",hex:"#A5362F",name:"Standard Red"},RH02:{tpv_code:"RH02",hex:"#E21F2F",name:"Bright Red"},RH10:{tpv_code:"RH10",hex:"#609B63",name:"Standard Green"},RH11:{tpv_code:"RH11",hex:"#3BB44A",name:"Bright Green"},RH12:{tpv_code:"RH12",hex:"#006C55",name:"Dark Green"},RH20:{tpv_code:"RH20",hex:"#0075BC",name:"Standard Blue"},RH21:{tpv_code:"RH21",hex:"#493D8C",name:"Purple"},RH22:{tpv_code:"RH22",hex:"#47AFE3",name:"Light Blue"},RH23:{tpv_code:"RH23",hex:"#039DC4",name:"Azure"},RH26:{tpv_code:"RH26",hex:"#00A6A3",name:"Turquoise"},RH30:{tpv_code:"RH30",hex:"#E4C4AA",name:"Standard Beige"},RH31:{tpv_code:"RH31",hex:"#E8E3D8",name:"Cream"},RH32:{tpv_code:"RH32",hex:"#8B5F3C",name:"Brown"},RH40:{tpv_code:"RH40",hex:"#E5A144",name:"Mustard Yellow"},RH41:{tpv_code:"RH41",hex:"#FFD833",name:"Bright Yellow"},RH50:{tpv_code:"RH50",hex:"#F15B32",name:"Orange"},RH60:{tpv_code:"RH60",hex:"#59595B",name:"Dark Grey"},RH61:{tpv_code:"RH61",hex:"#939598",name:"Light Grey"},RH65:{tpv_code:"RH65",hex:"#D9D9D6",name:"Pale Grey"},RH70:{tpv_code:"RH70",hex:"#231F20",name:"Black"},RH90:{tpv_code:"RH90",hex:"#E8457E",name:"Funky Pink"}})[u]||{tpv_code:"RH31",hex:"#E8E3D8",name:"Cream"},a={};if(r.defaultLineColor){const u=i(r.defaultLineColor);r.markings.forEach(h=>{a[h.id]=u})}const l={};if(r.defaultLineColor&&r.zones){const u=i(r.defaultLineColor);r.zones.forEach(h=>{l[h.id]=u})}const c=r.defaultSurfaceColor?i(r.defaultSurfaceColor):null,d={id:s,templateId:n,template:r,position:{x:e().surface.width_mm/2-r.dimensions.width_mm/2,y:e().surface.length_mm/2-r.dimensions.length_mm/2},rotation:0,scale:1,lineColorOverrides:a,zoneColorOverrides:l,courtSurfaceColor:c};t(u=>({courts:{...u.courts,[s]:d},elementOrder:[...u.elementOrder,s],selectedCourtId:s,selectedTrackId:null})),e().addToHistory()},removeCourt:n=>{const{[n]:r,...s}=e().courts;t(i=>({courts:s,elementOrder:i.elementOrder.filter(a=>a!==n),selectedCourtId:i.selectedCourtId===n?null:i.selectedCourtId})),e().addToHistory()},updateCourtPosition:(n,r)=>{t(s=>({courts:{...s.courts,[n]:{...s.courts[n],position:r}}}))},updateCourtRotation:(n,r)=>{t(s=>({courts:{...s.courts,[n]:{...s.courts[n],rotation:r}}}))},updateCourtScale:(n,r)=>{t(s=>({courts:{...s.courts,[n]:{...s.courts[n],scale:r}}}))},duplicateCourt:n=>{const r=e().courts[n];if(!r)return;const s=`court-${Date.now()}`,i={...r,id:s,position:{x:r.position.x+500,y:r.position.y+500}};t(a=>({courts:{...a.courts,[s]:i},elementOrder:[...a.elementOrder,s],selectedCourtId:s,selectedTrackId:null})),e().addToHistory()},duplicateTrack:n=>{const r=e().tracks[n];if(!r)return;const s=`track-${Date.now()}`,i={...r,id:s,position:{x:r.position.x+500,y:r.position.y+500}};t(a=>({tracks:{...a.tracks,[s]:i},elementOrder:[...a.elementOrder,s],selectedTrackId:s,selectedCourtId:null})),e().addToHistory()},renameElement:(n,r)=>{n.startsWith("court-")?t(s=>({courts:{...s.courts,[n]:{...s.courts[n],customName:r}}})):n.startsWith("track-")?t(s=>({tracks:{...s.tracks,[n]:{...s.tracks[n],customName:r}}})):n.startsWith("motif-")?t(s=>({motifs:{...s.motifs,[n]:{...s.motifs[n],customName:r}}})):n.startsWith("shape-")?t(s=>({shapes:{...s.shapes,[n]:{...s.shapes[n],customName:r}}})):n.startsWith("text-")?t(s=>({texts:{...s.texts,[n]:{...s.texts[n],customName:r}}})):n.startsWith("exclusion-")&&t(s=>({exclusionZones:{...s.exclusionZones,[n]:{...s.exclusionZones[n],customName:r}}})),e().addToHistory()},toggleElementLock:n=>{n.startsWith("court-")?t(r=>{var s;return{courts:{...r.courts,[n]:{...r.courts[n],locked:!((s=r.courts[n])!=null&&s.locked)}}}}):n.startsWith("track-")?t(r=>{var s;return{tracks:{...r.tracks,[n]:{...r.tracks[n],locked:!((s=r.tracks[n])!=null&&s.locked)}}}}):n.startsWith("motif-")?t(r=>{var s;return{motifs:{...r.motifs,[n]:{...r.motifs[n],locked:!((s=r.motifs[n])!=null&&s.locked)}}}}):n.startsWith("shape-")?t(r=>{var s;return{shapes:{...r.shapes,[n]:{...r.shapes[n],locked:!((s=r.shapes[n])!=null&&s.locked)}}}}):n.startsWith("text-")?t(r=>{var s;return{texts:{...r.texts,[n]:{...r.texts[n],locked:!((s=r.texts[n])!=null&&s.locked)}}}}):n.startsWith("exclusion-")?t(r=>{var s;return{exclusionZones:{...r.exclusionZones,[n]:{...r.exclusionZones[n],locked:!((s=r.exclusionZones[n])!=null&&s.locked)}}}}):n.startsWith("group-")&&t(r=>{var s;return{groups:{...r.groups,[n]:{...r.groups[n],locked:!((s=r.groups[n])!=null&&s.locked)}}}}),e().addToHistory()},toggleElementVisibility:n=>{n.startsWith("court-")?t(r=>{var s;return{courts:{...r.courts,[n]:{...r.courts[n],visible:((s=r.courts[n])==null?void 0:s.visible)===!1}}}}):n.startsWith("track-")?t(r=>{var s;return{tracks:{...r.tracks,[n]:{...r.tracks[n],visible:((s=r.tracks[n])==null?void 0:s.visible)===!1}}}}):n.startsWith("motif-")?t(r=>{var s;return{motifs:{...r.motifs,[n]:{...r.motifs[n],visible:((s=r.motifs[n])==null?void 0:s.visible)===!1}}}}):n.startsWith("shape-")?t(r=>{var s;return{shapes:{...r.shapes,[n]:{...r.shapes[n],visible:((s=r.shapes[n])==null?void 0:s.visible)===!1}}}}):n.startsWith("text-")?t(r=>{var s;return{texts:{...r.texts,[n]:{...r.texts[n],visible:((s=r.texts[n])==null?void 0:s.visible)===!1}}}}):n.startsWith("exclusion-")&&t(r=>{var s;return{exclusionZones:{...r.exclusionZones,[n]:{...r.exclusionZones[n],visible:((s=r.exclusionZones[n])==null?void 0:s.visible)===!1}}}}),e().addToHistory()},setLineColor:(n,r,s)=>{t(i=>({courts:{...i.courts,[n]:{...i.courts[n],lineColorOverrides:{...i.courts[n].lineColorOverrides,[r]:s}}}})),e().addToHistory()},setZoneColor:(n,r,s)=>{t(i=>({courts:{...i.courts,[n]:{...i.courts[n],zoneColorOverrides:{...i.courts[n].zoneColorOverrides,[r]:s}}}})),e().addToHistory()},resetCourtColors:n=>{t(r=>({courts:{...r.courts,[n]:{...r.courts[n],lineColorOverrides:{},zoneColorOverrides:{}}}})),e().addToHistory()},setCourtSurfaceColor:(n,r)=>{t(s=>({courts:{...s.courts,[n]:{...s.courts[n],courtSurfaceColor:r}}})),e().addToHistory()},selectCourt:n=>{const{propertiesPanelUserClosed:r}=e();t(r?{selectedCourtId:n,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null,selectedTextId:null,selectedExclusionZoneId:null}:{selectedCourtId:n,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null,selectedTextId:null,selectedExclusionZoneId:null,showPropertiesPanel:!0})},deselectCourt:()=>{t({selectedCourtId:null,showPropertiesPanel:!1,propertiesPanelUserClosed:!0})},setElementOrder:n=>{t({elementOrder:n})},moveElementUp:n=>{const{elementOrder:r}=e(),s=r.indexOf(n);if(s<r.length-1){const i=[...r];[i[s],i[s+1]]=[i[s+1],i[s]],t({elementOrder:i}),e().addToHistory()}},moveElementDown:n=>{const{elementOrder:r}=e(),s=r.indexOf(n);if(s>0){const i=[...r];[i[s],i[s-1]]=[i[s-1],i[s]],t({elementOrder:i}),e().addToHistory()}},bringToFront:n=>{const{elementOrder:r}=e(),s=r.filter(i=>i!==n);s.push(n),t({elementOrder:s}),e().addToHistory()},sendToBack:n=>{const{elementOrder:r}=e(),s=r.filter(i=>i!==n);s.unshift(n),t({elementOrder:s}),e().addToHistory()},addTrack:(n,r)=>{const s=`track-${Date.now()}`,i=e().surface,a=i.width_mm,l=i.length_mm,c=x=>({RH01:{tpv_code:"RH01",hex:"#A5362F",name:"Standard Red"},RH31:{tpv_code:"RH31",hex:"#E8E3D8",name:"Cream"},RH30:{tpv_code:"RH30",hex:"#E4C4AA",name:"Standard Beige"},RH20:{tpv_code:"RH20",hex:"#0075BC",name:"Standard Blue"},RH12:{tpv_code:"RH12",hex:"#006C55",name:"Dark Green"}})[x]||{tpv_code:x,hex:"#A5362F",name:"Standard Red"},d=r.defaultTrackSurfaceColor?c(r.defaultTrackSurfaceColor):c("RH01"),u=c("RH31"),h=r.trackType==="straight";let p,f,m;const y={enabled:!1,depth_mm:800,lineWidth_mm:50,style:"staggered",direction:"counterclockwise",startPosition:0};if(h){const x=r.parameters.numLanes,g=r.parameters.laneWidth_mm,w=x*g,b=Math.max(a,l)*.9,k=r.parameters.height_mm||1e5,_=Math.min(k,b);p={...r.parameters,width_mm:w,height_mm:_,cornerRadius:{topLeft:0,topRight:0,bottomLeft:0,bottomRight:0},laneWidth_mm:g,startingBoxes:{...y,...r.parameters.startingBoxes}},m=90,f={x:a/2-w/2,y:l/2-_/2}}else{const x=a*.9,g=l*.9,w=r.parameters.width_mm||25e3,b=r.parameters.height_mm||15e3,k=x/w,_=g/b,S=Math.min(k,_),E=r.parameters.cornerRadius||{topLeft:3e3,topRight:3e3,bottomLeft:3e3,bottomRight:3e3},T={topLeft:E.topLeft*S,topRight:E.topRight*S,bottomLeft:E.bottomLeft*S,bottomRight:E.bottomRight*S};p={...r.parameters,width_mm:x,height_mm:g,cornerRadius:T,laneWidth_mm:r.parameters.laneWidth_mm,startingBoxes:{...y,...r.parameters.startingBoxes}},m=0,f={x:a/2-x/2,y:l/2-g/2}}const v={id:s,templateId:n,template:r,position:f,rotation:m,parameters:p,trackSurfaceColor:d,laneSurfaceColors:[],trackLineColor:u};t(x=>({tracks:{...x.tracks,[s]:v},elementOrder:[...x.elementOrder,s],selectedTrackId:s,selectedCourtId:null})),e().addToHistory()},removeTrack:n=>{const{[n]:r,...s}=e().tracks;t(i=>({tracks:s,elementOrder:i.elementOrder.filter(a=>a!==n),selectedTrackId:i.selectedTrackId===n?null:i.selectedTrackId})),e().addToHistory()},updateTrackParameters:(n,r)=>{t(s=>{var h;const i=s.tracks[n];if(!i)return s;const a=i.parameters,l={...a,...r},c=((h=i.template)==null?void 0:h.trackType)==="straight";let d=i.position,u=i.laneSurfaceColors||[];if(r.numLanes!==void 0&&r.numLanes!==a.numLanes&&r.numLanes<a.numLanes&&(u=u.slice(0,r.numLanes)),c&&r.numLanes!==void 0&&r.numLanes!==a.numLanes){const p=a.laneWidth_mm,f=a.numLanes*p,m=r.numLanes*p;l.width_mm=m;const y=i.position.x+f/2,v=i.position.y+a.height_mm/2;d={x:y-m/2,y:v-l.height_mm/2}}return{tracks:{...s.tracks,[n]:{...i,parameters:l,position:d,laneSurfaceColors:u}}}}),e().addToHistory()},updateTrackPosition:(n,r)=>{t(s=>({tracks:{...s.tracks,[n]:{...s.tracks[n],position:r}}}))},updateTrackRotation:(n,r)=>{t(s=>({tracks:{...s.tracks,[n]:{...s.tracks[n],rotation:r}}}))},setTrackSurfaceColor:(n,r)=>{t(s=>({tracks:{...s.tracks,[n]:{...s.tracks[n],trackSurfaceColor:r}}})),e().addToHistory()},setTrackLineColor:(n,r)=>{t(s=>({tracks:{...s.tracks,[n]:{...s.tracks[n],trackLineColor:r}}})),e().addToHistory()},setLaneSurfaceColor:(n,r,s)=>{t(i=>{const a=i.tracks[n];if(!a)return i;const l=[...a.laneSurfaceColors||[]];for(;l.length<r;)l.push(null);return l[r-1]=s,{tracks:{...i.tracks,[n]:{...a,laneSurfaceColors:l}}}}),e().addToHistory()},resetLaneSurfaceColors:n=>{t(r=>({tracks:{...r.tracks,[n]:{...r.tracks[n],laneSurfaceColors:[]}}})),e().addToHistory()},selectTrack:n=>{const{propertiesPanelUserClosed:r}=e();t(r?{selectedTrackId:n,selectedCourtId:null,selectedMotifId:null,selectedShapeId:null,selectedTextId:null,selectedExclusionZoneId:null}:{selectedTrackId:n,selectedCourtId:null,selectedMotifId:null,selectedShapeId:null,selectedTextId:null,selectedExclusionZoneId:null,showPropertiesPanel:!0})},deselectTrack:()=>{t({selectedTrackId:null,showPropertiesPanel:!1,propertiesPanelUserClosed:!0})},addMotif:(n,r,s,i,a,l=null,c={})=>{const d=`motif-${Date.now()}`,u=e().surface,h={id:d,type:"motif",sourceDesignId:n,sourceDesignName:r,sourceThumbnailUrl:l,solidSvgContent:c.solidSvgContent||s,blendSvgContent:c.blendSvgContent||null,hasBothVersions:c.hasBothVersions||!1,viewMode:"solid",svgContent:c.solidSvgContent||s,originalWidth_mm:i,originalHeight_mm:a,position:{x:u.width_mm/2-i/2,y:u.length_mm/2-a/2},rotation:0,scale:1};t(p=>({motifs:{...p.motifs,[d]:h},elementOrder:[...p.elementOrder,d],selectedMotifId:d,selectedCourtId:null,selectedTrackId:null})),e().addToHistory()},removeMotif:n=>{const{[n]:r,...s}=e().motifs;t(i=>({motifs:s,elementOrder:i.elementOrder.filter(a=>a!==n),selectedMotifId:i.selectedMotifId===n?null:i.selectedMotifId})),e().addToHistory()},updateMotifPosition:(n,r)=>{t(s=>({motifs:{...s.motifs,[n]:{...s.motifs[n],position:r}}}))},updateMotifRotation:(n,r)=>{t(s=>({motifs:{...s.motifs,[n]:{...s.motifs[n],rotation:r}}}))},updateMotifScale:(n,r)=>{t(s=>({motifs:{...s.motifs,[n]:{...s.motifs[n],scale:r}}}))},setMotifViewMode:(n,r)=>{const s=e().motifs[n];if(!s)return;const i=r==="blend"?s.blendSvgContent||s.solidSvgContent:s.solidSvgContent||s.blendSvgContent;t(a=>({motifs:{...a.motifs,[n]:{...a.motifs[n],viewMode:r,svgContent:i}}})),e().addToHistory()},duplicateMotif:n=>{const r=e().motifs[n];if(!r)return;const s=`motif-${Date.now()}`,i={...r,id:s,position:{x:r.position.x+500,y:r.position.y+500}};t(a=>({motifs:{...a.motifs,[s]:i},elementOrder:[...a.elementOrder,s],selectedMotifId:s,selectedCourtId:null,selectedTrackId:null})),e().addToHistory()},refreshMotif:async n=>{const r=e().motifs[n];if(!r)return{success:!1,error:"Motif not found"};try{const{fetchMotifFromDesign:s}=await KE(async()=>{const{fetchMotifFromDesign:c}=await Promise.resolve().then(()=>vT);return{fetchMotifFromDesign:c}},void 0),i=await s(r.sourceDesignId),l=(r.viewMode||"solid")==="blend"?i.blendSvgContent||i.solidSvgContent:i.solidSvgContent||i.blendSvgContent;return t(c=>({motifs:{...c.motifs,[n]:{...c.motifs[n],solidSvgContent:i.solidSvgContent,blendSvgContent:i.blendSvgContent,hasBothVersions:i.hasBothVersions,svgContent:l,sourceThumbnailUrl:i.sourceThumbnailUrl,sourceDesignName:i.sourceDesignName,originalWidth_mm:i.originalWidth_mm,originalHeight_mm:i.originalHeight_mm}},lastModified:Date.now()})),e().addToHistory(),{success:!0}}catch(s){return console.error("[MOTIF] Failed to refresh:",s),{success:!1,error:s.message}}},selectMotif:n=>{const{propertiesPanelUserClosed:r}=e();t(r?{selectedMotifId:n,selectedCourtId:null,selectedTrackId:null,selectedShapeId:null,selectedTextId:null,selectedExclusionZoneId:null}:{selectedMotifId:n,selectedCourtId:null,selectedTrackId:null,selectedShapeId:null,selectedTextId:null,selectedExclusionZoneId:null,showPropertiesPanel:!0})},deselectMotif:()=>{t({selectedMotifId:null,showPropertiesPanel:!1,propertiesPanelUserClosed:!0})},addShape:(n="rectangle")=>{const r=`shape-${Date.now()}`,s=e().surface,i=e().shapes,a={rectangle:{sides:4,aspectLocked:!1,width:3e3,height:2e3},square:{sides:4,aspectLocked:!0,width:2e3,height:2e3},circle:{sides:32,aspectLocked:!0,width:2e3,height:2e3},triangle:{sides:3,aspectLocked:!0,width:2e3,height:2e3},pentagon:{sides:5,aspectLocked:!0,width:2e3,height:2e3},hexagon:{sides:6,aspectLocked:!0,width:2e3,height:2e3},polygon:{sides:6,aspectLocked:!0,width:2e3,height:2e3},star:{sides:5,aspectLocked:!0,width:2e3,height:2e3,starMode:!0,innerRadius:.5}},l=[{tpv_code:"RH20",hex:"#0075BC",name:"Standard Blue"},{tpv_code:"RH50",hex:"#F15B32",name:"Orange"},{tpv_code:"RH10",hex:"#609B63",name:"Standard Green"},{tpv_code:"RH21",hex:"#493D8C",name:"Purple"},{tpv_code:"RH41",hex:"#FFD833",name:"Bright Yellow"},{tpv_code:"RH26",hex:"#00A6A3",name:"Turquoise"},{tpv_code:"RH02",hex:"#E21F2F",name:"Bright Red"},{tpv_code:"RH90",hex:"#E8457E",name:"Funky Pink"}],c=Object.keys(i).length,d=l[c%l.length];if(n==="blob"){const p=Math.floor(Math.random()*1e5),f="organic",m=lh(f,p),y={id:r,type:"shape",shapeType:"blob",blobStyle:f,seed:p,controlPoints:m,editPointsVisible:!1,numPoints:m.length,blobiness:.2,symmetryMode:"none",radialSymmetryCount:4,width_mm:2e3,height_mm:2e3,position:{x:s.width_mm/2-1e3,y:s.length_mm/2-1e3},rotation:0,fillColor:d,strokeEnabled:!1,strokeColor:null,strokeWidth_mm:50,aspectLocked:!1,locked:!1,visible:!0};t(v=>({shapes:{...v.shapes,[r]:y},elementOrder:[...v.elementOrder,r],selectedShapeId:r,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null})),e().addToHistory();return}const u=a[n]||a.rectangle,h={id:r,type:"shape",shapeType:"polygon",sides:u.sides,width_mm:u.width,height_mm:u.height,cornerRadius:0,starMode:u.starMode||!1,innerRadius:u.innerRadius||.5,position:{x:s.width_mm/2-u.width/2,y:s.length_mm/2-u.height/2},rotation:0,fillColor:d,strokeEnabled:!1,strokeColor:null,strokeWidth_mm:50,aspectLocked:u.aspectLocked,locked:!1,visible:!0};t(p=>({shapes:{...p.shapes,[r]:h},elementOrder:[...p.elementOrder,r],selectedShapeId:r,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null})),e().addToHistory()},removeShape:n=>{const{[n]:r,...s}=e().shapes;t(i=>({shapes:s,elementOrder:i.elementOrder.filter(a=>a!==n),selectedShapeId:i.selectedShapeId===n?null:i.selectedShapeId})),e().addToHistory()},updateShapePosition:(n,r)=>{t(s=>({shapes:{...s.shapes,[n]:{...s.shapes[n],position:r}}}))},updateShapeDimensions:(n,r,s)=>{t(i=>({shapes:{...i.shapes,[n]:{...i.shapes[n],width_mm:r,height_mm:s}}}))},updateShapeSides:(n,r)=>{t(s=>{const i=s.shapes[n];if(!i)return s;const a=Math.max(3,Math.min(32,r));let l=i.width_mm,c=i.height_mm;if(a!==4){const d=Math.min(i.width_mm,i.height_mm);l=d,c=d}return{shapes:{...s.shapes,[n]:{...i,sides:a,width_mm:l,height_mm:c,aspectLocked:a!==4}}}}),e().addToHistory()},updateShapeCornerRadius:(n,r)=>{t(s=>({shapes:{...s.shapes,[n]:{...s.shapes[n],cornerRadius:Math.max(0,Math.min(100,r))}}})),e().addToHistory()},setShapeStarMode:(n,r)=>{t(s=>{const i=s.shapes[n];return{shapes:{...s.shapes,[n]:{...i,starMode:r,sides:r&&i.sides<3?3:i.sides,innerRadius:i.innerRadius??.5}}}}),e().addToHistory()},setShapeInnerRadius:(n,r)=>{t(s=>({shapes:{...s.shapes,[n]:{...s.shapes[n],innerRadius:Math.max(.1,Math.min(.9,r))}}})),e().addToHistory()},updateShapeRotation:(n,r)=>{t(s=>({shapes:{...s.shapes,[n]:{...s.shapes[n],rotation:r}}}))},setShapeFillColor:(n,r)=>{t(s=>({shapes:{...s.shapes,[n]:{...s.shapes[n],fillColor:r}}})),e().addToHistory()},setShapeStroke:(n,r,s=null,i=50)=>{t(a=>({shapes:{...a.shapes,[n]:{...a.shapes[n],strokeEnabled:r,strokeColor:s,strokeWidth_mm:i}}})),e().addToHistory()},setShapeAspectLock:(n,r)=>{t(s=>{const i=s.shapes[n];return{shapes:{...s.shapes,[n]:{...i,aspectLocked:r}}}}),e().addToHistory()},updateBlobPoints:(n,r)=>{t(s=>{const i=s.shapes[n];if(!i||i.shapeType!=="blob")return s;const a=ry(r,i.blobiness,i.seed);return{shapes:{...s.shapes,[n]:{...i,numPoints:r,controlPoints:a}}}}),e().addToHistory()},updateBlobiness:(n,r)=>{t(s=>{const i=s.shapes[n];if(!i||i.shapeType!=="blob")return s;const a=ry(i.numPoints,r,i.seed);return{shapes:{...s.shapes,[n]:{...i,blobiness:r,controlPoints:a}}}}),e().addToHistory()},randomizeBlob:n=>{t(r=>{const s=r.shapes[n];if(!s||s.shapeType!=="blob")return r;const i=Math.floor(Math.random()*1e5),a=s.blobStyle||"organic",l=lh(a,i);return{shapes:{...r.shapes,[n]:{...s,seed:i,controlPoints:l,numPoints:l.length}}}}),e().addToHistory()},setBlobStyle:(n,r)=>{t(s=>{const i=s.shapes[n];if(!i||i.shapeType!=="blob")return s;const a=lh(r,i.seed);return{shapes:{...s.shapes,[n]:{...i,blobStyle:r,controlPoints:a,numPoints:a.length}}}}),e().addToHistory()},setEditPointsVisible:(n,r)=>{t(s=>{const i=s.shapes[n];return!i||i.shapeType!=="blob"&&i.shapeType!=="path"?s:{shapes:{...s.shapes,[n]:{...i,editPointsVisible:r}}}})},resetBlob:n=>{t(r=>{const s=r.shapes[n];if(!s||s.shapeType!=="blob")return r;const i=a5();return{shapes:{...r.shapes,[n]:{...s,blobiness:0,controlPoints:i}}}}),e().addToHistory()},updateBlobControlPoint:(n,r,s,i)=>{t(a=>{const l=a.shapes[n];if(!l||l.shapeType!=="blob"||!l.controlPoints)return a;const c=Math.max(0,Math.min(1,s)),d=Math.max(0,Math.min(1,i)),u=d5(l.controlPoints,r,c,d,l.symmetryMode||"none",l.radialSymmetryCount||4);return{shapes:{...a.shapes,[n]:{...l,controlPoints:u}}}})},updateBlobHandle:(n,r,s,i,a)=>{t(l=>{const c=l.shapes[n];if(!c||c.shapeType!=="blob"||!c.controlPoints)return l;const d=u5(c.controlPoints,r,s,i,a,c.symmetryMode||"none",c.radialSymmetryCount||4);return{shapes:{...l.shapes,[n]:{...c,controlPoints:d}}}})},commitBlobEdit:()=>{e().addToHistory()},setBlobSymmetry:(n,r,s=4)=>{t(i=>{const a=i.shapes[n];return!a||a.shapeType!=="blob"?i:{shapes:{...i.shapes,[n]:{...a,symmetryMode:r,radialSymmetryCount:s}}}}),e().addToHistory()},applyBlobPreset:(n,r)=>{const s=BLOB_PRESETS[r];!s||!s.controlPoints||(t(i=>{const a=i.shapes[n];return!a||a.shapeType!=="blob"?i:{shapes:{...i.shapes,[n]:{...a,numPoints:s.controlPoints.length,blobiness:0,controlPoints:JSON.parse(JSON.stringify(s.controlPoints))}}}}),e().addToHistory())},duplicateShape:n=>{const r=e().shapes[n];if(!r)return;const s=`shape-${Date.now()}`,i={...r,id:s,position:{x:r.position.x+500,y:r.position.y+500}};t(a=>({shapes:{...a.shapes,[s]:i},elementOrder:[...a.elementOrder,s],selectedShapeId:s,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null})),e().addToHistory()},selectShape:n=>{const{propertiesPanelUserClosed:r}=e();t(r?{selectedShapeId:n,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedTextId:null,selectedExclusionZoneId:null}:{selectedShapeId:n,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedTextId:null,selectedExclusionZoneId:null,showPropertiesPanel:!0})},deselectShape:()=>{t({selectedShapeId:null,showPropertiesPanel:!1,propertiesPanelUserClosed:!0})},startPathDrawing:()=>{const n=`shape-path-${Date.now()}`,r=e().surface,s=e().shapes,i=[{tpv_code:"RH20",hex:"#0075BC",name:"Standard Blue"},{tpv_code:"RH50",hex:"#F15B32",name:"Orange"},{tpv_code:"RH10",hex:"#609B63",name:"Standard Green"},{tpv_code:"RH21",hex:"#493D8C",name:"Purple"}],a=Object.keys(s).length,l=i[a%i.length],c={id:n,type:"shape",shapeType:"path",controlPoints:[],closed:!0,smooth:!1,editPointsVisible:!1,width_mm:r.width_mm,height_mm:r.length_mm,position:{x:0,y:0},rotation:0,fillColor:l,strokeEnabled:!0,strokeColor:{tpv_code:"RH70",hex:"#A8A9AD",name:"Light Grey"},strokeWidth_mm:20,aspectLocked:!1,locked:!1,visible:!0};t({pathDrawingMode:!0,activePathId:n,shapes:{...e().shapes,[n]:c},elementOrder:[...e().elementOrder,n],selectedShapeId:n,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedTextId:null})},addPointToPath:(n,r)=>{const{activePathId:s,shapes:i,pathDrawingMode:a}=e();if(!a||!s)return;const l=i[s];if(!l||l.shapeType!=="path")return;const c={x:n,y:r,handleIn:{x:0,y:0},handleOut:{x:0,y:0}};t({shapes:{...i,[s]:{...l,controlPoints:[...l.controlPoints,c]}}})},finishPath:()=>{const{activePathId:n,shapes:r,pathDrawingMode:s}=e();if(!s||!n)return;const i=r[n];if(!i)return;if(i.controlPoints.length<3){e().cancelPath();return}const a=i.controlPoints;let l=1/0,c=1/0,d=-1/0,u=-1/0;for(const b of a)l=Math.min(l,b.x),c=Math.min(c,b.y),d=Math.max(d,b.x),u=Math.max(u,b.y);const h=d-l||1,p=u-c||1,f=.05,m=a.map(b=>({...b,x:f+(b.x-l)/h*(1-2*f),y:f+(b.y-c)/p*(1-2*f)})),y=e().surface,v=h*y.width_mm,x=p*y.length_mm,g=l*y.width_mm,w=c*y.length_mm;t({pathDrawingMode:!1,activePathId:null,shapes:{...r,[n]:{...i,controlPoints:m,width_mm:Math.max(500,v),height_mm:Math.max(500,x),position:{x:g,y:w},strokeEnabled:!1}}}),e().addToHistory()},cancelPath:()=>{const{activePathId:n,shapes:r,elementOrder:s}=e();if(!n){t({pathDrawingMode:!1});return}const i={...r};delete i[n],t({pathDrawingMode:!1,activePathId:null,shapes:i,elementOrder:s.filter(a=>a!==n),selectedShapeId:null})},setPathClosed:(n,r)=>{const s=e().shapes[n];!s||s.shapeType!=="path"||(t({shapes:{...e().shapes,[n]:{...s,closed:r}}}),e().addToHistory())},setPathSmooth:(n,r)=>{const s=e().shapes[n];if(!s||s.shapeType!=="path")return;let i=s.controlPoints;r&&s.controlPoints.length>=2?i=ch(s.controlPoints,s.closed,.3):i=s.controlPoints.map(a=>({...a,handleIn:{x:0,y:0},handleOut:{x:0,y:0}})),t({shapes:{...e().shapes,[n]:{...s,smooth:r,controlPoints:i}}}),e().addToHistory()},updatePathControlPoint:(n,r,s,i)=>{const a=e().shapes[n];if(!a||a.shapeType!=="path")return;const l=[...a.controlPoints];l[r]={...l[r],x:s,y:i},t({shapes:{...e().shapes,[n]:{...a,controlPoints:l}}})},updatePathHandle:(n,r,s,i,a)=>{const l=e().shapes[n];if(!l||l.shapeType!=="path")return;const c=[...l.controlPoints];c[r]={...c[r],[s]:{x:i,y:a}},t({shapes:{...e().shapes,[n]:{...l,controlPoints:c}}})},addPointToExistingPath:(n,r,s,i)=>{const a=e().shapes[n];if(!a||a.shapeType!=="path")return;const l=h5(a.controlPoints,r,s,i),c=a.smooth?ch(l,a.closed,.3):l;t({shapes:{...e().shapes,[n]:{...a,controlPoints:c}}}),e().addToHistory()},removePointFromPath:(n,r)=>{const s=e().shapes[n];if(!s||s.shapeType!=="path")return;const i=s.closed?3:2,a=p5(s.controlPoints,r,i);if(!a){console.log("[STORE] Cannot remove point - minimum reached");return}const l=s.smooth?ch(a,s.closed,.3):a;t({shapes:{...e().shapes,[n]:{...s,controlPoints:l}}}),e().addToHistory()},commitPathEdit:()=>{e().addToHistory()},addText:()=>{const{surface:n}=e(),r=`text-${Date.now()}`,s={id:r,type:"text",content:"Text",fontFamily:"Open Sans, sans-serif",fontSize_mm:500,scale_x:1,scale_y:1,fontWeight:"normal",fontStyle:"normal",textAlign:"left",position:{x:n.width_mm/2,y:n.length_mm/2},rotation:0,fillColor:{tpv_code:"RH70",hex:"#1C1C1C",name:"Black"},strokeColor:null,strokeWidth_mm:0,locked:!1,visible:!0,customName:null};t(i=>({texts:{...i.texts,[r]:s},elementOrder:[...i.elementOrder,r],selectedTextId:r,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null,showPropertiesPanel:!0})),e().addToHistory()},removeText:n=>{t(r=>{const{[n]:s,...i}=r.texts;return{texts:i,elementOrder:r.elementOrder.filter(a=>a!==n),selectedTextId:r.selectedTextId===n?null:r.selectedTextId}}),e().addToHistory()},selectText:n=>{const{propertiesPanelUserClosed:r}=e();t(r?{selectedTextId:n,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null,selectedExclusionZoneId:null}:{selectedTextId:n,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null,selectedExclusionZoneId:null,showPropertiesPanel:!0})},deselectText:()=>{t({selectedTextId:null,showPropertiesPanel:!1,propertiesPanelUserClosed:!0})},updateTextContent:(n,r)=>{t(s=>({texts:{...s.texts,[n]:{...s.texts[n],content:r}}}))},updateTextPosition:(n,r)=>{t(s=>({texts:{...s.texts,[n]:{...s.texts[n],position:r}}}))},updateTextScale:(n,r,s)=>{t(i=>({texts:{...i.texts,[n]:{...i.texts[n],scale_x:Math.max(.01,r),scale_y:Math.max(.01,s)}}}))},updateTextFontSize:(n,r)=>{if(!e().texts[n])return;const a=r/500;t(l=>({texts:{...l.texts,[n]:{...l.texts[n],scale_x:Math.max(.01,a),scale_y:Math.max(.01,a)}}})),e().addToHistory()},updateTextFont:(n,r,s,i)=>{t(a=>({texts:{...a.texts,[n]:{...a.texts[n],fontFamily:r,fontWeight:s,fontStyle:i}}})),e().addToHistory()},updateTextAlign:(n,r)=>{t(s=>({texts:{...s.texts,[n]:{...s.texts[n],textAlign:r}}})),e().addToHistory()},updateTextRotation:(n,r)=>{t(s=>({texts:{...s.texts,[n]:{...s.texts[n],rotation:r}}}))},setTextFillColor:(n,r)=>{t(s=>({texts:{...s.texts,[n]:{...s.texts[n],fillColor:r}}})),e().addToHistory()},setTextStrokeColor:(n,r)=>{t(s=>({texts:{...s.texts,[n]:{...s.texts[n],strokeColor:r}}})),e().addToHistory()},updateTextStrokeWidth:(n,r)=>{t(s=>({texts:{...s.texts,[n]:{...s.texts[n],strokeWidth_mm:r}}}))},duplicateText:n=>{const{texts:r}=e(),s=r[n];if(!s)return;const i=`text-${Date.now()}`,a={...s,id:i,position:{x:s.position.x+500,y:s.position.y+500},customName:s.customName?`${s.customName} (copy)`:null};t(l=>({texts:{...l.texts,[i]:a},elementOrder:[...l.elementOrder,i],selectedTextId:i,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null})),e().addToHistory()},addExclusionZone:(n="rectangle")=>{const r=`exclusion-${Date.now()}`,s=e().surface,i={rectangle:{shapeType:"polygon",sides:4,width:3e3,height:2e3},square:{shapeType:"polygon",sides:4,width:2e3,height:2e3},circle:{shapeType:"polygon",sides:32,width:2e3,height:2e3},"l-shape":{shapeType:"path",width:4e3,height:3e3},custom:{shapeType:"path",width:3e3,height:3e3}},a=i[n]||i.rectangle,l={id:r,type:"exclusion",shapeType:a.shapeType,sides:a.sides||4,width_mm:a.width,height_mm:a.height,position:{x:s.width_mm/2-a.width/2,y:s.length_mm/2-a.height/2},rotation:0,cornerRadius:0,locked:!1,visible:!0,customName:null,controlPoints:a.shapeType==="path"?f5(n):null};t(c=>({exclusionZones:{...c.exclusionZones,[r]:l},selectedExclusionZoneId:r,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null,selectedTextId:null})),e().addToHistory()},removeExclusionZone:n=>{const{[n]:r,...s}=e().exclusionZones;t(i=>({exclusionZones:s,selectedExclusionZoneId:i.selectedExclusionZoneId===n?null:i.selectedExclusionZoneId})),e().addToHistory()},updateExclusionZonePosition:(n,r)=>{t(s=>({exclusionZones:{...s.exclusionZones,[n]:{...s.exclusionZones[n],position:r}}}))},updateExclusionZoneDimensions:(n,r,s)=>{t(i=>({exclusionZones:{...i.exclusionZones,[n]:{...i.exclusionZones[n],width_mm:r,height_mm:s}}}))},updateExclusionZoneRotation:(n,r)=>{t(s=>({exclusionZones:{...s.exclusionZones,[n]:{...s.exclusionZones[n],rotation:r}}}))},updateExclusionZoneCornerRadius:(n,r)=>{t(s=>({exclusionZones:{...s.exclusionZones,[n]:{...s.exclusionZones[n],cornerRadius:Math.max(0,Math.min(100,r))}}})),e().addToHistory()},selectExclusionZone:n=>{const{propertiesPanelUserClosed:r}=e();t(r?{selectedExclusionZoneId:n,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null,selectedTextId:null}:{selectedExclusionZoneId:n,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null,selectedTextId:null,showPropertiesPanel:!0})},deselectExclusionZone:()=>{t({selectedExclusionZoneId:null,showPropertiesPanel:!1,propertiesPanelUserClosed:!0})},duplicateExclusionZone:n=>{const r=e().exclusionZones[n];if(!r)return;const s=`exclusion-${Date.now()}`,i={...r,id:s,position:{x:r.position.x+500,y:r.position.y+500},customName:r.customName?`${r.customName} (copy)`:null};t(a=>({exclusionZones:{...a.exclusionZones,[s]:i},selectedExclusionZoneId:s,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null,selectedTextId:null})),e().addToHistory()},calculateGroupBounds:n=>{var c,d,u,h,p,f;const r=e();let s=1/0,i=1/0,a=-1/0,l=-1/0;for(const m of n)if(m.startsWith("shape-")){const y=r.shapes[m];if(y){const v=y.position.x,x=y.position.y;s=Math.min(s,v),i=Math.min(i,x),a=Math.max(a,v+y.width_mm),l=Math.max(l,x+y.height_mm)}}else if(m.startsWith("text-")){const y=r.texts[m];if(y){const v=y.fontSize_mm||500,x=y.scale_x||1,g=y.scale_y||1,w=y.content||"Text",b=v*.5,_=w.length*b*x,S=v*g;let E,T;const R=y.textAlign||"left";R==="center"?(E=y.position.x-_/2,T=y.position.x+_/2):R==="right"?(E=y.position.x-_,T=y.position.x):(E=y.position.x,T=y.position.x+_);const W=y.position.y-S,P=y.position.y+v*.2*g;s=Math.min(s,E),i=Math.min(i,W),a=Math.max(a,T),l=Math.max(l,P)}}else if(m.startsWith("court-")){const y=r.courts[m];if(y){const v=y.position.x,x=y.position.y,g=y.scale||1,w=(((d=(c=y.template)==null?void 0:c.dimensions)==null?void 0:d.width_mm)||0)*g,b=(((h=(u=y.template)==null?void 0:u.dimensions)==null?void 0:h.length_mm)||0)*g;s=Math.min(s,v),i=Math.min(i,x),a=Math.max(a,v+w),l=Math.max(l,x+b)}}else if(m.startsWith("track-")){const y=r.tracks[m];if(y){const v=y.position.x,x=y.position.y,g=y.scale||1,w=(((p=y.parameters)==null?void 0:p.width_mm)||5e3)*g,b=(((f=y.parameters)==null?void 0:f.height_mm)||1e4)*g;s=Math.min(s,v),i=Math.min(i,x),a=Math.max(a,v+w),l=Math.max(l,x+b)}}else if(m.startsWith("motif-")){const y=r.motifs[m];if(y){const v=y.position.x,x=y.position.y,g=(y.originalWidth_mm||1e3)*(y.scale||1),w=(y.originalHeight_mm||1e3)*(y.scale||1);s=Math.min(s,v),i=Math.min(i,x),a=Math.max(a,v+g),l=Math.max(l,x+w)}}return s===1/0?{x:0,y:0,width:0,height:0}:{x:s,y:i,width:a-s,height:l-i}},createGroup:(n,r={})=>{if(!n||n.length<2)return null;const s=`group-${Date.now()}`,i=e().calculateGroupBounds(n),a={id:s,type:"group",childIds:[...n],compoundType:r.compoundType||null,generatorSeed:r.generatorSeed||null,customName:r.customName||null,locked:!1,visible:!0,bounds:i};return t(l=>{const c=Math.min(...n.map(u=>l.elementOrder.indexOf(u)).filter(u=>u>=0)),d=l.elementOrder.filter(u=>!n.includes(u));return d.splice(c,0,s),{groups:{...l.groups,[s]:a},elementOrder:d,selectedGroupId:s,selectedShapeId:null,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedTextId:null,selectedExclusionZoneId:null,selectedElementIds:[]}}),e().addToHistory(),s},ungroup:n=>{const r=e().groups[n];r&&(t(s=>{const i=s.elementOrder.indexOf(n),a=s.elementOrder.filter(d=>d!==n);a.splice(i,0,...r.childIds);const{[n]:l,...c}=s.groups;return{groups:c,elementOrder:a,selectedGroupId:null,selectedElementIds:[...r.childIds]}}),e().addToHistory())},selectGroup:n=>{const{propertiesPanelUserClosed:r}=e();t({selectedGroupId:n,selectedShapeId:null,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedTextId:null,selectedExclusionZoneId:null,editingGroupId:null,selectedElementIds:[],showPropertiesPanel:!r})},deselectGroup:()=>{const n=e().editingGroupId;n&&e().refreshGroupBounds(n),t({selectedGroupId:null,editingGroupId:null,showPropertiesPanel:!1,propertiesPanelUserClosed:!0})},enterGroup:n=>{t({editingGroupId:n,selectedGroupId:null})},exitGroup:()=>{const n=e().editingGroupId;n&&(e().refreshGroupBounds(n),t({editingGroupId:null,selectedGroupId:n,selectedShapeId:null}))},updateGroupPosition:(n,r,s)=>{const i=e().groups[n];i&&t(a=>{const l={...a.shapes},c={...a.texts},d={...a.courts},u={...a.tracks},h={...a.motifs};for(const f of i.childIds)f.startsWith("shape-")&&l[f]?l[f]={...l[f],position:{x:l[f].position.x+r,y:l[f].position.y+s}}:f.startsWith("text-")&&c[f]?c[f]={...c[f],position:{x:c[f].position.x+r,y:c[f].position.y+s}}:f.startsWith("court-")&&d[f]?d[f]={...d[f],position:{x:d[f].position.x+r,y:d[f].position.y+s}}:f.startsWith("track-")&&u[f]?u[f]={...u[f],position:{x:u[f].position.x+r,y:u[f].position.y+s}}:f.startsWith("motif-")&&h[f]&&(h[f]={...h[f],position:{x:h[f].position.x+r,y:h[f].position.y+s}});const p={...i.bounds,x:i.bounds.x+r,y:i.bounds.y+s};return{shapes:l,texts:c,courts:d,tracks:u,motifs:h,groups:{...a.groups,[n]:{...i,bounds:p}}}})},commitGroupMove:()=>{e().addToHistory()},updateGroupScale:(n,r,s,i,a=null)=>{const l=e().groups[n];l&&t(c=>{const d={...c.shapes},u={...c.texts},h={...c.courts},p={...c.tracks},f={...c.motifs};for(const y of l.childIds){const v=a==null?void 0:a[y];if(y.startsWith("shape-")){const x=d[y];if(x){const g=(v==null?void 0:v.position)||x.position,w=(v==null?void 0:v.width_mm)||x.width_mm,b=(v==null?void 0:v.height_mm)||x.height_mm,k=g.x-i.x,_=g.y-i.y;d[y]={...x,position:{x:i.x+k*r,y:i.y+_*s},width_mm:w*r,height_mm:b*s}}}else if(y.startsWith("text-")){const x=u[y];if(x){const g=(v==null?void 0:v.position)||x.position,w=(v==null?void 0:v.width_mm)||x.width_mm||1e3,b=(v==null?void 0:v.height_mm)||x.height_mm||500,k=(v==null?void 0:v.fontSize)||x.fontSize||200,_=g.x-i.x,S=g.y-i.y;u[y]={...x,position:{x:i.x+_*r,y:i.y+S*s},width_mm:w*r,height_mm:b*s,fontSize:k*Math.min(r,s)}}}else if(y.startsWith("court-")){const x=h[y];if(x){const g=(v==null?void 0:v.position)||x.position,w=(v==null?void 0:v.scale)||x.scale||1,b=g.x-i.x,k=g.y-i.y,_=r===1?s:s===1?r:Math.min(r,s);h[y]={...x,position:{x:i.x+b*r,y:i.y+k*s},scale:w*_}}}else if(y.startsWith("track-")){const x=p[y];if(x){const g=(v==null?void 0:v.position)||x.position,w=(v==null?void 0:v.scale)||x.scale||1,b=g.x-i.x,k=g.y-i.y,_=r===1?s:s===1?r:Math.min(r,s);p[y]={...x,position:{x:i.x+b*r,y:i.y+k*s},scale:w*_}}}else if(y.startsWith("motif-")){const x=f[y];if(x){const g=(v==null?void 0:v.position)||x.position,w=(v==null?void 0:v.scale)||x.scale||1,b=g.x-i.x,k=g.y-i.y,_=r===1?s:s===1?r:Math.min(r,s);f[y]={...x,position:{x:i.x+b*r,y:i.y+k*s},scale:w*_}}}}const m=e().calculateGroupBounds(l.childIds);return{shapes:d,texts:u,courts:h,tracks:p,motifs:f,groups:{...c.groups,[n]:{...l,bounds:m}}}})},updateGroupRotation:(n,r,s,i=null)=>{const a=e().groups[n];if(!a)return;const l=(c,d,u,h,p)=>{const f=p*Math.PI/180,m=Math.cos(f),y=Math.sin(f),v=c-u,x=d-h;return{x:u+v*m-x*y,y:h+v*y+x*m}};t(c=>{var m,y,v,x,g,w;const d={...c.shapes},u={...c.texts},h={...c.courts},p={...c.tracks},f={...c.motifs};for(const b of a.childIds){const k=i==null?void 0:i[b];if(b.startsWith("shape-")){const _=d[b];if(_){const S=(k==null?void 0:k.position)||_.position,E=(k==null?void 0:k.rotation)||_.rotation||0,T=S.x+(_.width_mm||0)/2,R=S.y+(_.height_mm||0)/2,W=l(T,R,s.x,s.y,r);d[b]={..._,position:{x:W.x-(_.width_mm||0)/2,y:W.y-(_.height_mm||0)/2},rotation:(E+r)%360}}}else if(b.startsWith("text-")){const _=u[b];if(_){const S=(k==null?void 0:k.position)||_.position,E=(k==null?void 0:k.rotation)||_.rotation||0,T=S.x+(_.width_mm||0)/2,R=S.y+(_.height_mm||0)/2,W=l(T,R,s.x,s.y,r);u[b]={..._,position:{x:W.x-(_.width_mm||0)/2,y:W.y-(_.height_mm||0)/2},rotation:(E+r)%360}}}else if(b.startsWith("court-")){const _=h[b];if(_){const S=(k==null?void 0:k.position)||_.position,E=(k==null?void 0:k.rotation)||_.rotation||0,T=_.scale||1,R=(((y=(m=_.template)==null?void 0:m.dimensions)==null?void 0:y.width_mm)||0)*T,W=(((x=(v=_.template)==null?void 0:v.dimensions)==null?void 0:x.length_mm)||0)*T,P=S.x+R/2,I=S.y+W/2,C=l(P,I,s.x,s.y,r);h[b]={..._,position:{x:C.x-R/2,y:C.y-W/2},rotation:(E+r)%360}}}else if(b.startsWith("track-")){const _=p[b];if(_){const S=(k==null?void 0:k.position)||_.position,E=(k==null?void 0:k.rotation)||_.rotation||0,T=_.scale||1,R=(((g=_.parameters)==null?void 0:g.width_mm)||5e3)*T,W=(((w=_.parameters)==null?void 0:w.height_mm)||1e4)*T,P=S.x+R/2,I=S.y+W/2,C=l(P,I,s.x,s.y,r);p[b]={..._,position:{x:C.x-R/2,y:C.y-W/2},rotation:(E+r)%360}}}else if(b.startsWith("motif-")){const _=f[b];if(_){const S=(k==null?void 0:k.position)||_.position,E=(k==null?void 0:k.rotation)||_.rotation||0,T=_.scale||1,R=(_.originalWidth_mm||0)*T,W=(_.originalHeight_mm||0)*T,P=S.x+R/2,I=S.y+W/2,C=l(P,I,s.x,s.y,r);f[b]={..._,position:{x:C.x-R/2,y:C.y-W/2},rotation:(E+r)%360}}}}return{shapes:d,texts:u,courts:h,tracks:p,motifs:f}})},addToSelection:n=>{t(r=>{if(r.selectedElementIds.includes(n))return{selectedElementIds:r.selectedElementIds.filter(a=>a!==n)};let s=[...r.selectedElementIds];const i=r.selectedShapeId||r.selectedTextId||r.selectedCourtId||r.selectedTrackId||r.selectedMotifId||r.selectedExclusionZoneId;return i&&!s.includes(i)&&s.push(i),s.push(n),{selectedElementIds:s,selectedShapeId:null,selectedGroupId:null,selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedTextId:null,selectedExclusionZoneId:null}})},clearMultiSelection:()=>{t({selectedElementIds:[]})},groupSelected:()=>{const{selectedElementIds:n}=e();n.length<2||e().createGroup(n)},alignElements:n=>{const{selectedElementIds:r,shapes:s,texts:i,courts:a,tracks:l,motifs:c}=e();if(r.length<2)return;const d=g=>{const w=g.fontSize_mm||500,b=g.scale_x||1,k=g.scale_y||1,_=g.content||"Text",S=w*.5,E=_.length*S*b,T=w*k,R=w*1.2*k;let W=g.position.x;const P=g.textAlign||"left";return P==="center"?W=g.position.x-E/2:P==="right"&&(W=g.position.x-E),{x:W,y:g.position.y-T,width:E,height:R,baselineOffset:T,alignOffset:g.position.x-W}},u=r.map(g=>{var w,b,k,_,S,E;if(g.startsWith("shape-")){const T=s[g];if(T)return{id:g,type:"shape",x:T.position.x,y:T.position.y,width:T.width_mm||0,height:T.height_mm||0}}if(g.startsWith("text-")){const T=i[g];if(T){const R=d(T);return{id:g,type:"text",...R}}}if(g.startsWith("court-")){const T=a[g];if(T){const R=T.scale||1;return{id:g,type:"court",x:T.position.x,y:T.position.y,width:(((b=(w=T.template)==null?void 0:w.dimensions)==null?void 0:b.width_mm)||0)*R,height:(((_=(k=T.template)==null?void 0:k.dimensions)==null?void 0:_.length_mm)||0)*R}}}if(g.startsWith("track-")){const T=l[g];if(T){const R=T.scale||1;return{id:g,type:"track",x:T.position.x,y:T.position.y,width:(((S=T.parameters)==null?void 0:S.width_mm)||5e3)*R,height:(((E=T.parameters)==null?void 0:E.height_mm)||1e4)*R}}}if(g.startsWith("motif-")){const T=c[g];if(T)return{id:g,type:"motif",x:T.position.x,y:T.position.y,width:(T.originalWidth_mm||1e3)*(T.scale||1),height:(T.originalHeight_mm||1e3)*(T.scale||1)}}return null}).filter(Boolean);if(u.length<2)return;const h=Math.min(...u.map(g=>g.x)),p=Math.max(...u.map(g=>g.x+g.width)),f=Math.min(...u.map(g=>g.y)),m=Math.max(...u.map(g=>g.y+g.height)),y=(h+p)/2,v=(f+m)/2,x={};for(const g of u){let w=g.x,b=g.y;switch(n){case"left":w=h;break;case"center":w=y-g.width/2;break;case"right":w=p-g.width;break;case"top":b=f;break;case"middle":b=v-g.height/2;break;case"bottom":b=m-g.height;break}(w!==g.x||b!==g.y)&&(x[g.id]={x:w,y:b,type:g.type,baselineOffset:g.baselineOffset,alignOffset:g.alignOffset})}t(g=>{const w={...g.shapes},b={...g.texts},k={...g.courts},_={...g.tracks},S={...g.motifs};for(const[E,T]of Object.entries(x))T.type==="shape"&&w[E]?w[E]={...w[E],position:{x:T.x,y:T.y}}:T.type==="text"&&b[E]?b[E]={...b[E],position:{x:T.x+(T.alignOffset||0),y:T.y+(T.baselineOffset||0)}}:T.type==="court"&&k[E]?k[E]={...k[E],position:{x:T.x,y:T.y}}:T.type==="track"&&_[E]?_[E]={..._[E],position:{x:T.x,y:T.y}}:T.type==="motif"&&S[E]&&(S[E]={...S[E],position:{x:T.x,y:T.y}});return{shapes:w,texts:b,courts:k,tracks:_,motifs:S}}),e().addToHistory()},distributeElements:n=>{const{selectedElementIds:r,shapes:s,texts:i,courts:a,tracks:l,motifs:c}=e();if(r.length<3)return;const d=r.map(x=>{var g,w,b,k,_,S;if(x.startsWith("shape-")){const E=s[x];if(E)return{id:x,type:"shape",x:E.position.x,y:E.position.y,width:E.width_mm||0,height:E.height_mm||0}}if(x.startsWith("text-")){const E=i[x];if(E){const T=E.fontSize_mm||500,R=E.scale_x||1,W=E.scale_y||1,P=E.content||"Text",I=E.textAlign||"left",C=T*.5,fe=P.length*C*R,V=T*W,K=T*1.2*W;let F,Z=0;I==="center"?(F=E.position.x-fe/2,Z=fe/2):I==="right"?(F=E.position.x-fe,Z=fe):(F=E.position.x,Z=0);const U=E.position.y-V;return{id:x,type:"text",x:F,y:U,width:fe,height:K,alignOffset:Z,baselineOffset:V}}}if(x.startsWith("court-")){const E=a[x];if(E){const T=E.scale||1;return{id:x,type:"court",x:E.position.x,y:E.position.y,width:(((w=(g=E.template)==null?void 0:g.dimensions)==null?void 0:w.width_mm)||0)*T,height:(((k=(b=E.template)==null?void 0:b.dimensions)==null?void 0:k.length_mm)||0)*T}}}if(x.startsWith("track-")){const E=l[x];if(E){const T=E.scale||1;return{id:x,type:"track",x:E.position.x,y:E.position.y,width:(((_=E.parameters)==null?void 0:_.width_mm)||5e3)*T,height:(((S=E.parameters)==null?void 0:S.height_mm)||1e4)*T}}}if(x.startsWith("motif-")){const E=c[x];if(E)return{id:x,type:"motif",x:E.position.x,y:E.position.y,width:(E.originalWidth_mm||1e3)*(E.scale||1),height:(E.originalHeight_mm||1e3)*(E.scale||1)}}return null}).filter(Boolean);if(d.length<3)return;const u={},h=n==="horizontal"||n==="center-horizontal",p=n==="center-horizontal"||n==="center-vertical",f=[...d].sort((x,g)=>h?p?x.x+x.width/2-(g.x+g.width/2):x.x-g.x:p?x.y+x.height/2-(g.y+g.height/2):x.y-g.y),m=f[0],y=f[f.length-1],v=f.length;if(p){let x,g;h?(x=m.x+m.width/2,g=y.x+y.width/2):(x=m.y+m.height/2,g=y.y+y.height/2);const w=(g-x)/(v-1);for(let b=0;b<f.length;b++){const k=f[b];let _=k.x,S=k.y;h?_=x+b*w-k.width/2:S=x+b*w-k.height/2,(_!==k.x||S!==k.y)&&(u[k.id]={x:_,y:S,type:k.type,alignOffset:k.alignOffset,baselineOffset:k.baselineOffset})}}else{let x,g;h?(x=y.x+y.width-m.x,g=f.reduce((k,_)=>k+_.width,0)):(x=y.y+y.height-m.y,g=f.reduce((k,_)=>k+_.height,0));const w=(x-g)/(v-1);let b=h?m.x:m.y;for(const k of f){let _=k.x,S=k.y;h?(_=b,b+=k.width+w):(S=b,b+=k.height+w),(_!==k.x||S!==k.y)&&(u[k.id]={x:_,y:S,type:k.type,alignOffset:k.alignOffset,baselineOffset:k.baselineOffset})}}t(x=>{const g={...x.shapes},w={...x.texts},b={...x.courts},k={...x.tracks},_={...x.motifs};for(const[S,E]of Object.entries(u))E.type==="shape"&&g[S]?g[S]={...g[S],position:{x:E.x,y:E.y}}:E.type==="text"&&w[S]?w[S]={...w[S],position:{x:E.x+(E.alignOffset||0),y:E.y+(E.baselineOffset||0)}}:E.type==="court"&&b[S]?b[S]={...b[S],position:{x:E.x,y:E.y}}:E.type==="track"&&k[S]?k[S]={...k[S],position:{x:E.x,y:E.y}}:E.type==="motif"&&_[S]&&(_[S]={..._[S],position:{x:E.x,y:E.y}});return{shapes:g,texts:w,courts:b,tracks:k,motifs:_}}),e().addToHistory()},copySelection:()=>{const{selectedElementIds:n,selectedGroupId:r,groups:s,shapes:i,texts:a}=e();if(r){const d=s[r];if(!d)return;const u=d.childIds.map(h=>i[h]?{type:"shape",data:JSON.parse(JSON.stringify(i[h]))}:a[h]?{type:"text",data:JSON.parse(JSON.stringify(a[h]))}:null).filter(Boolean);t({clipboard:{type:"group",groupData:JSON.parse(JSON.stringify(d)),children:u}});return}if(n.length>0){const d=n.map(u=>i[u]?{type:"shape",data:JSON.parse(JSON.stringify(i[u]))}:a[u]?{type:"text",data:JSON.parse(JSON.stringify(a[u]))}:null).filter(Boolean);t({clipboard:{type:"elements",data:d}});return}const{selectedShapeId:l,selectedTextId:c}=e();l&&i[l]?t({clipboard:{type:"elements",data:[{type:"shape",data:JSON.parse(JSON.stringify(i[l]))}]}}):c&&a[c]&&t({clipboard:{type:"elements",data:[{type:"text",data:JSON.parse(JSON.stringify(a[c]))}]}})},pasteClipboard:()=>{const{clipboard:n}=e();if(!n)return;const r=500;if(n.type==="group"){const s=`group-${Date.now()}`,i=[],a=Date.now();t(l=>{const c={...l.shapes},d={...l.texts};let u=[...l.elementOrder];n.children.forEach((p,f)=>{const m=`${p.type}-${a}-${f}`;i.push(m),p.type==="shape"?c[m]={...p.data,id:m,position:{x:p.data.position.x+r,y:p.data.position.y+r}}:p.type==="text"&&(d[m]={...p.data,id:m,position:{x:p.data.position.x+r,y:p.data.position.y+r}})});const h={...n.groupData,id:s,childIds:i,customName:n.groupData.customName?`${n.groupData.customName} (copy)`:"Group (copy)",bounds:{...n.groupData.bounds,x:n.groupData.bounds.x+r,y:n.groupData.bounds.y+r}};return u.push(s),{shapes:c,texts:d,groups:{...l.groups,[s]:h},elementOrder:u,selectedGroupId:s,selectedShapeId:null,selectedTextId:null,selectedElementIds:[]}})}else{const s=Date.now(),i=[];t(a=>{const l={...a.shapes},c={...a.texts};let d=[...a.elementOrder];return n.data.forEach((u,h)=>{const p=`${u.type}-${s}-${h}`;i.push(p),u.type==="shape"?(l[p]={...u.data,id:p,position:{x:u.data.position.x+r,y:u.data.position.y+r}},d.push(p)):u.type==="text"&&(c[p]={...u.data,id:p,position:{x:u.data.position.x+r,y:u.data.position.y+r}},d.push(p))}),{shapes:l,texts:c,elementOrder:d,selectedElementIds:i.length>1?i:[],selectedShapeId:i.length===1&&n.data[0].type==="shape"?i[0]:null,selectedTextId:i.length===1&&n.data[0].type==="text"?i[0]:null,selectedGroupId:null}})}e().addToHistory()},removeGroup:n=>{e().ungroup(n)},deleteGroupWithChildren:n=>{const r=e().groups[n];r&&(t(s=>{const i={...s.shapes},a={...s.texts},l={...s.courts},c={...s.tracks},d={...s.motifs},u={...s.exclusionZones};for(const m of r.childIds)m.startsWith("shape-")?delete i[m]:m.startsWith("text-")?delete a[m]:m.startsWith("court-")?delete l[m]:m.startsWith("track-")?delete c[m]:m.startsWith("motif-")?delete d[m]:m.startsWith("exclusion-")&&delete u[m];const{[n]:h,...p}=s.groups,f=s.elementOrder.filter(m=>m!==n&&!r.childIds.includes(m));return{shapes:i,texts:a,courts:l,tracks:c,motifs:d,exclusionZones:u,groups:p,elementOrder:f,selectedGroupId:null,selectedShapeId:null}}),e().addToHistory())},refreshGroupBounds:n=>{const r=e().groups[n];if(!r)return;const s=e().calculateGroupBounds(r.childIds);t(i=>({groups:{...i.groups,[n]:{...r,bounds:s}}}))},addCustomMarking:n=>{t(r=>({customMarkings:[...r.customMarkings,{...n,id:`custom-${Date.now()}`}]})),e().addToHistory()},removeCustomMarking:n=>{t(r=>({customMarkings:r.customMarkings.filter(s=>s.id!==n)})),e().addToHistory()},addBackgroundZone:n=>{t(r=>({backgroundZones:[...r.backgroundZones,{...n,id:`zone-${Date.now()}`}]})),e().addToHistory()},removeBackgroundZone:n=>{t(r=>({backgroundZones:r.backgroundZones.filter(s=>s.id!==n)})),e().addToHistory()},setDesignName:n=>{t({designName:n})},setDesignDescription:n=>{t({designDescription:n})},setDesignTags:n=>{t({designTags:n})},addToHistory:()=>{const n=e(),r=JSON.parse(JSON.stringify({surface:n.surface,courts:n.courts,tracks:n.tracks,motifs:n.motifs,shapes:n.shapes,texts:n.texts,exclusionZones:n.exclusionZones,groups:n.groups,elementOrder:n.elementOrder,customMarkings:n.customMarkings,backgroundZones:n.backgroundZones}));t(s=>{const i=s.history.slice(0,s.historyIndex+1);return i.push(r),i.length>s.maxHistory&&i.shift(),{history:i,historyIndex:i.length-1}}),e().markDirty()},undo:()=>{const{history:n,historyIndex:r}=e();if(r>0){const s=n[r-1];t({surface:s.surface,courts:s.courts,tracks:s.tracks,motifs:s.motifs,shapes:s.shapes,texts:s.texts,exclusionZones:s.exclusionZones,groups:s.groups,elementOrder:s.elementOrder,customMarkings:s.customMarkings,backgroundZones:s.backgroundZones,historyIndex:r-1})}},redo:()=>{const{history:n,historyIndex:r}=e();if(r<n.length-1){const s=n[r+1];t({surface:s.surface,courts:s.courts,tracks:s.tracks,motifs:s.motifs,shapes:s.shapes,texts:s.texts,exclusionZones:s.exclusionZones,groups:s.groups,elementOrder:s.elementOrder,customMarkings:s.customMarkings,backgroundZones:s.backgroundZones,historyIndex:r+1})}},canUndo:()=>e().historyIndex>0,canRedo:()=>e().historyIndex<e().history.length-1,selectDesignForSave:()=>{const n=e();return{surface:n.surface,courts:n.courts,tracks:n.tracks,motifs:n.motifs,shapes:n.shapes,texts:n.texts,exclusionZones:n.exclusionZones,groups:n.groups,elementOrder:n.elementOrder,customMarkings:n.customMarkings,backgroundZones:n.backgroundZones,designName:n.designName,designDescription:n.designDescription,designTags:n.designTags}},hashDesignState:n=>{const r=JSON.stringify(n);let s=5381;for(let i=0;i<r.length;i++)s=(s<<5)+s+r.charCodeAt(i);return(s>>>0).toString(36)},markDirty:()=>{t({isDirty:!0}),e().scheduleAutosave()},setInteracting:n=>{t({isInteracting:n})},scheduleAutosave:()=>{const n=e();n.autosaveTimer&&clearTimeout(n.autosaveTimer);const r=setTimeout(()=>{const s=e();if(s.isInteracting){e().scheduleAutosave();return}if(s.isDirty){const i=e().selectDesignForSave(),a=e().hashDesignState(i);a!==s.lastSavedHash?(console.log("[AUTOSAVE] Design changed, would save here"),t({isDirty:!1,lastSavedHash:a,lastSaved:new Date().toISOString()})):t({isDirty:!1})}},15e3);t({autosaveTimer:r})},clearAutosaveTimer:()=>{const n=e().autosaveTimer;n&&(clearTimeout(n),t({autosaveTimer:null}))},getComplexityScore:()=>{const n=e(),r=Object.keys(n.courts).length,s=Object.keys(n.tracks).length,i=Object.keys(n.motifs).length,a=Object.keys(n.shapes).length,l=Object.keys(n.texts).length,c=Object.keys(n.exclusionZones).length,d=r+s+i+a+l+c,u=Object.values(n.shapes).filter(f=>f.type==="path"||f.type==="blob").length,h=n.surface.width_mm*n.surface.length_mm/1e6,p=d+i*3+u*2+Math.floor(h/100);return{score:p,elementCount:d,courtCount:r,trackCount:s,motifCount:i,shapeCount:a,textCount:l,pathCount:u,areaSqM:h,isLarge:p>50,isHuge:p>100}},toggleCourtLibrary:()=>{t(n=>({showCourtLibrary:!n.showCourtLibrary}))},togglePropertiesPanel:()=>{t(n=>({showPropertiesPanel:!n.showPropertiesPanel,propertiesPanelUserClosed:!!n.showPropertiesPanel}))},setShowPropertiesPanel:n=>{t({showPropertiesPanel:n,propertiesPanelUserClosed:!n})},setMobileLibraryOpen:n=>t({mobileLibraryOpen:n}),setMobilePropertiesOpen:n=>t({mobilePropertiesOpen:n}),setMobileColoursOpen:n=>t({mobileColoursOpen:n}),setMobileActiveTab:n=>t({mobileActiveTab:n}),closeMobileSheets:()=>t({mobileLibraryOpen:!1,mobilePropertiesOpen:!1,mobileColoursOpen:!1}),toggleColorEditor:()=>{t(n=>({showColorEditor:!n.showColorEditor}))},toggleSnapToGrid:()=>{t(n=>({snapToGrid:!n.snapToGrid}))},setGridSize:n=>{t({gridSize_mm:n})},setZoom:n=>{t({zoom:Math.max(.25,Math.min(5,n))})},toggleStandaloneMode:()=>{t(n=>({standaloneMode:!n.standaloneMode}))},setStandaloneMode:(n,r=null)=>{t({standaloneMode:n,standaloneDesignId:r})},setSaving:n=>{t({isSaving:n})},setLastSaved:n=>{t({lastSaved:n})},loadDesign:n=>{let r=n.elementOrder;!r&&(n.courtOrder||n.trackOrder)&&(r=[...n.trackOrder||[],...n.courtOrder||[]]),t({surface:n.surface||dh.surface,courts:n.courts||{},tracks:n.tracks||{},motifs:n.motifs||{},shapes:n.shapes||{},texts:n.texts||{},exclusionZones:n.exclusionZones||{},groups:n.groups||{},elementOrder:r||[],customMarkings:n.customMarkings||[],backgroundZones:n.backgroundZones||[],designName:n.name||"Untitled Design",designDescription:n.description||"",designTags:n.tags||[],selectedCourtId:null,selectedTrackId:null,selectedMotifId:null,selectedShapeId:null,selectedTextId:null,selectedExclusionZoneId:null,selectedGroupId:null,editingGroupId:null,history:[],historyIndex:-1}),e().addToHistory()},exportDesignData:()=>{const n=e();return{surface:n.surface,courts:n.courts,tracks:n.tracks,motifs:n.motifs,shapes:n.shapes,texts:n.texts,exclusionZones:n.exclusionZones,groups:n.groups,elementOrder:n.elementOrder,customMarkings:n.customMarkings,backgroundZones:n.backgroundZones,name:n.designName,description:n.designDescription,tags:n.designTags}},resetDesign:()=>{t(dh)},hasUnsavedChanges:()=>{const n=e();return Object.keys(n.courts).length>0||Object.keys(n.tracks).length>0||Object.keys(n.motifs).length>0||Object.keys(n.shapes).length>0||Object.keys(n.texts).length>0||Object.keys(n.exclusionZones).length>0}}),{name:"SportsDesignStore"})),iy={inputMode:"prompt",prompt:"",lengthMM:5e3,widthMM:5e3,selectedFileName:null,uploadedFileUrl:null,arMapping:null,result:null,jobId:null,blendRecipes:null,blendSvgUrl:null,colorMapping:null,blendEditedColors:new Map,solidRecipes:null,solidSvgUrl:null,solidColorMapping:null,solidEditedColors:new Map,viewMode:"solid",showFinalRecipes:!1,showSolidSummary:!1,regionOverrides:new Map,originalTaggedSvg:null,regionOverridesHistory:[new Map],historyIndex:0,designName:"",currentDesignId:null,hasGeneratedContent:!1,lastModified:null},Od=B1(H1((t,e)=>({...iy,setInputMode:n=>t({inputMode:n}),setPrompt:n=>t({prompt:n,lastModified:Date.now()}),setDimensions:(n,r)=>t({widthMM:n,lengthMM:r,lastModified:Date.now()}),setArMapping:n=>t({arMapping:n}),setSelectedFile:(n,r)=>t({selectedFileName:n,uploadedFileUrl:r,lastModified:Date.now()}),clearSelectedFile:()=>t({selectedFileName:null,uploadedFileUrl:null}),setGenerationResult:(n,r)=>t({result:n,jobId:r,hasGeneratedContent:!0,lastModified:Date.now()}),setResult:n=>t({result:n,hasGeneratedContent:!!n,lastModified:Date.now()}),setJobId:n=>t({jobId:n}),setBlendState:(n,r,s)=>t({blendRecipes:n,colorMapping:r,blendSvgUrl:s,lastModified:Date.now()}),setBlendRecipes:n=>t({blendRecipes:n,lastModified:Date.now()}),setColorMapping:n=>t({colorMapping:n,lastModified:Date.now()}),setBlendSvgUrl:n=>t({blendSvgUrl:n}),setBlendEditedColors:n=>t({blendEditedColors:n,lastModified:Date.now()}),updateBlendSvgUrl:n=>t({blendSvgUrl:n}),setSolidState:(n,r,s)=>t({solidRecipes:n,solidColorMapping:r,solidSvgUrl:s,lastModified:Date.now()}),setSolidRecipes:n=>t({solidRecipes:n,lastModified:Date.now()}),setSolidColorMapping:n=>t({solidColorMapping:n,lastModified:Date.now()}),setSolidSvgUrl:n=>t({solidSvgUrl:n}),setSolidEditedColors:n=>t({solidEditedColors:n,lastModified:Date.now()}),updateSolidSvgUrl:n=>t({solidSvgUrl:n}),setViewMode:n=>{if(n==="blend"){console.log("[STORE] Blend mode disabled - forcing solid mode");return}t({viewMode:n})},setShowFinalRecipes:n=>t({showFinalRecipes:n}),setShowSolidSummary:n=>t({showSolidSummary:n}),setOriginalTaggedSvg:n=>t({originalTaggedSvg:n}),setRegionOverrides:n=>t({regionOverrides:n,lastModified:Date.now()}),addRegionOverride:(n,r)=>{const s=new Map(e().regionOverrides),i=typeof r=="string"?{hex:r}:r;s.set(n,i);const a=e().regionOverridesHistory,l=e().historyIndex,c=a.slice(0,l+1);c.push(new Map(s)),c.length>50&&c.shift(),t({regionOverrides:s,regionOverridesHistory:c,historyIndex:c.length-1,lastModified:Date.now()})},setRegionOverridesHistory:n=>{t(typeof n=="function"?{regionOverridesHistory:n(e().regionOverridesHistory)}:{regionOverridesHistory:n})},setHistoryIndex:n=>{t(typeof n=="function"?{historyIndex:n(e().historyIndex)}:{historyIndex:n})},canUndo:()=>e().historyIndex>0,canRedo:()=>e().historyIndex<e().regionOverridesHistory.length-1,undo:()=>{const{historyIndex:n,regionOverridesHistory:r}=e();if(n>0){const s=n-1;t({historyIndex:s,regionOverrides:new Map(r[s])})}},redo:()=>{const{historyIndex:n,regionOverridesHistory:r}=e();if(n<r.length-1){const s=n+1;t({historyIndex:s,regionOverrides:new Map(r[s])})}},setRegionOverridesHistory:(n,r)=>t({regionOverridesHistory:n,historyIndex:r}),setDesignName:n=>t({designName:n}),setCurrentDesignId:n=>t({currentDesignId:n}),loadDesign:n=>{const r=n.regionOverrides||new Map,s=r.size>0?[new Map,new Map(r)]:[new Map],i=r.size>0?1:0;t({inputMode:n.inputMode||"prompt",prompt:n.prompt||"",lengthMM:n.lengthMM||5e3,widthMM:n.widthMM||5e3,uploadedFileUrl:n.selectedFile||null,result:n.result||null,blendRecipes:n.blendRecipes||null,solidRecipes:n.solidRecipes||null,colorMapping:n.colorMapping||null,solidColorMapping:n.solidColorMapping||null,solidEditedColors:n.solidEditedColors||new Map,blendEditedColors:n.blendEditedColors||new Map,blendSvgUrl:n.blendSvgUrl||null,solidSvgUrl:n.solidSvgUrl||null,viewMode:"solid",arMapping:n.arMapping||null,jobId:n.jobId||null,showFinalRecipes:n.showFinalRecipes||!1,showSolidSummary:n.showSolidSummary||!1,hasGeneratedContent:!!n.result,regionOverrides:r,originalTaggedSvg:n.originalTaggedSvg||null,regionOverridesHistory:s,historyIndex:i,lastModified:Date.now()})},exportDesignData:()=>{const n=e();return{inputMode:n.inputMode,prompt:n.prompt,lengthMM:n.lengthMM,widthMM:n.widthMM,uploadedFileUrl:n.uploadedFileUrl,result:n.result,blendRecipes:n.blendRecipes,solidRecipes:n.solidRecipes,colorMapping:n.colorMapping,solidColorMapping:n.solidColorMapping,solidEditedColors:n.solidEditedColors,blendEditedColors:n.blendEditedColors,viewMode:n.viewMode,arMapping:n.arMapping,jobId:n.jobId,showFinalRecipes:n.showFinalRecipes,showSolidSummary:n.showSolidSummary,regionOverrides:n.regionOverrides,designName:n.designName,currentDesignId:n.currentDesignId}},resetDesign:()=>{const{blendSvgUrl:n,solidSvgUrl:r}=e();n&&n.startsWith("blob:")&&URL.revokeObjectURL(n),r&&r.startsWith("blob:")&&URL.revokeObjectURL(r),t({...iy,blendEditedColors:new Map,solidEditedColors:new Map,regionOverrides:new Map,regionOverridesHistory:[new Map]})},hasUnsavedChanges:()=>{const n=e();return n.hasGeneratedContent||n.prompt.trim()!==""||n.selectedFileName!==null}}),{name:"PlaygroundDesignStore"})),V1={"basketball-full":{id:"basketball-full",name:"Basketball (Full Court)",sport:"basketball",standard:"FIBA 2020",category:"court",description:"Official FIBA standard full basketball court with all markings",dimensions:{length_mm:28e3,width_mm:15e3,min_surround_mm:2e3},defaultSurfaceColor:"RH20",defaultLineColor:"RH31",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:15e3,height:28e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"center-line",name:"Center Line",type:"line",params:{x1:0,y1:14e3,x2:15e3,y2:14e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-circle",name:"Center Circle",type:"circle",params:{cx:7500,cy:14e3,radius:1800},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"three-point-arc-top",name:"Three-Point Arc (Top)",type:"arc",params:{cx:7500,cy:26425,radius:6750,startAngle:192,endAngle:348},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"three-point-arc-bottom",name:"Three-Point Arc (Bottom)",type:"arc",params:{cx:7500,cy:1575,radius:6750,startAngle:12,endAngle:168},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"three-point-line-bottom-left",name:"Three-Point Line Bottom Left",type:"line",params:{x1:900,y1:0,x2:900,y2:2990},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"three-point-line-bottom-right",name:"Three-Point Line Bottom Right",type:"line",params:{x1:14100,y1:0,x2:14100,y2:2990},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"three-point-line-top-left",name:"Three-Point Line Top Left",type:"line",params:{x1:900,y1:25010,x2:900,y2:28e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"three-point-line-top-right",name:"Three-Point Line Top Right",type:"line",params:{x1:14100,y1:25010,x2:14100,y2:28e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"free-throw-line-top",name:"Free Throw Line (Top)",type:"line",params:{x1:5050,y1:22200,x2:9950,y2:22200},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"free-throw-line-bottom",name:"Free Throw Line (Bottom)",type:"line",params:{x1:5050,y1:5800,x2:9950,y2:5800},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"free-throw-circle-top",name:"Free Throw Circle (Top)",type:"circle",params:{cx:7500,cy:22200,radius:1800},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"free-throw-circle-bottom",name:"Free Throw Circle (Bottom)",type:"circle",params:{cx:7500,cy:5800,radius:1800},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"key-lane-top",name:"Key Lane (Top)",type:"rectangle",params:{x:5050,y:22200,width:4900,height:5800},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"key-lane-bottom",name:"Key Lane (Bottom)",type:"rectangle",params:{x:5050,y:0,width:4900,height:5800},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"restricted-area-top",name:"Restricted Area (Top)",type:"arc",params:{cx:7500,cy:28e3,radius:1250,startAngle:180,endAngle:360},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"restricted-area-bottom",name:"Restricted Area (Bottom)",type:"arc",params:{cx:7500,cy:0,radius:1250,startAngle:0,endAngle:180},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[{id:"key-area-top",name:"Key Area (Top)",type:"rectangle",params:{x:5050,y:22200,width:4900,height:5800},defaultColor:"RH20",paintable:!0,area_m2:28.42},{id:"key-area-bottom",name:"Key Area (Bottom)",type:"rectangle",params:{x:5050,y:0,width:4900,height:5800},defaultColor:"RH20",paintable:!0,area_m2:28.42}]},"netball-full":{id:"netball-full",name:"Netball (Full Court)",sport:"netball",standard:"World Netball 2020",category:"court",description:"Official World Netball standard court with goal circles and thirds",dimensions:{length_mm:30500,width_mm:15250,min_surround_mm:3050},defaultSurfaceColor:"RH01",defaultLineColor:"RH31",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:15250,height:30500},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"transverse-line-1",name:"Transverse Line 1",type:"line",params:{x1:0,y1:10167,x2:15250,y2:10167},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"transverse-line-2",name:"Transverse Line 2",type:"line",params:{x1:0,y1:20333,x2:15250,y2:20333},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-circle",name:"Center Circle",type:"circle",params:{cx:7625,cy:15250,radius:450},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"goal-circle-bottom",name:"Goal Circle (Bottom)",type:"arc",params:{cx:7625,cy:0,radius:4900,startAngle:0,endAngle:180},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"goal-circle-top",name:"Goal Circle (Top)",type:"arc",params:{cx:7625,cy:30500,radius:4900,startAngle:180,endAngle:360},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[]},"tennis-doubles":{id:"tennis-doubles",name:"Tennis (Doubles)",sport:"tennis",standard:"ITF 2020",category:"court",description:"Official ITF standard doubles tennis court with all service boxes",dimensions:{length_mm:23770,width_mm:10970,min_surround_mm:3660},defaultSurfaceColor:"RH22",defaultLineColor:"RH29",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:10970,height:23770},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"singles-sideline-left",name:"Singles Sideline (Left)",type:"line",params:{x1:1370,y1:0,x2:1370,y2:23770},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"singles-sideline-right",name:"Singles Sideline (Right)",type:"line",params:{x1:9600,y1:0,x2:9600,y2:23770},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"service-line-bottom",name:"Service Line (Bottom)",type:"line",params:{x1:0,y1:6400,x2:10970,y2:6400},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"service-line-top",name:"Service Line (Top)",type:"line",params:{x1:0,y1:17370,x2:10970,y2:17370},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-service-line",name:"Center Service Line",type:"line",params:{x1:5485,y1:6400,x2:5485,y2:17370},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-mark-bottom",name:"Center Mark (Bottom)",type:"line",params:{x1:5485,y1:0,x2:5485,y2:100},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-mark-top",name:"Center Mark (Top)",type:"line",params:{x1:5485,y1:23670,x2:5485,y2:23770},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[]},"futsal-standard":{id:"futsal-standard",name:"Futsal (5-a-side)",sport:"futsal",standard:"FIFA 2020",category:"court",description:"Official FIFA standard futsal court for international matches",dimensions:{length_mm:4e4,width_mm:2e4,min_surround_mm:1e3},defaultSurfaceColor:"RH50",defaultLineColor:"RH30",defaultLineWidth_mm:80,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:2e4,height:4e4},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"boundary"},{id:"center-line",name:"Center Line",type:"line",params:{x1:0,y1:2e4,x2:2e4,y2:2e4},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"center-circle",name:"Center Circle",type:"circle",params:{cx:1e4,cy:2e4,radius:3e3},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"center-spot",name:"Center Spot",type:"circle",params:{cx:1e4,cy:2e4,radius:100},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"penalty-area-bottom",name:"Penalty Area (Bottom)",type:"arc",params:{cx:1e4,cy:0,radius:6e3,startAngle:0,endAngle:180},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"penalty-area-top",name:"Penalty Area (Top)",type:"arc",params:{cx:1e4,cy:4e4,radius:6e3,startAngle:180,endAngle:360},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"penalty-mark-bottom",name:"Penalty Mark (Bottom)",type:"circle",params:{cx:1e4,cy:6e3,radius:100},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"penalty-mark-top",name:"Penalty Mark (Top)",type:"circle",params:{cx:1e4,cy:34e3,radius:100},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"second-penalty-mark-bottom",name:"Second Penalty Mark (Bottom)",type:"circle",params:{cx:1e4,cy:1e4,radius:100},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"second-penalty-mark-top",name:"Second Penalty Mark (Top)",type:"circle",params:{cx:1e4,cy:3e4,radius:100},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"corner-arc-bl",name:"Corner Arc (Bottom Left)",type:"arc",params:{cx:0,cy:0,radius:250,startAngle:0,endAngle:90},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"corner-arc-br",name:"Corner Arc (Bottom Right)",type:"arc",params:{cx:2e4,cy:0,radius:250,startAngle:90,endAngle:180},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"corner-arc-tl",name:"Corner Arc (Top Left)",type:"arc",params:{cx:0,cy:4e4,radius:250,startAngle:270,endAngle:360},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"},{id:"corner-arc-tr",name:"Corner Arc (Top Right)",type:"arc",params:{cx:2e4,cy:4e4,radius:250,startAngle:180,endAngle:270},defaultColor:"RH31",lineWidth_mm:80,required:!0,category:"court-marking"}],zones:[]},"volleyball-indoor":{id:"volleyball-indoor",name:"Volleyball (Indoor)",sport:"volleyball",standard:"FIVB",category:"court",description:"Official FIVB standard indoor volleyball court with attack lines",dimensions:{length_mm:18e3,width_mm:9e3,min_surround_mm:3e3},defaultSurfaceColor:"RH40",defaultLineColor:"RH29",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:9e3,height:18e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"center-line",name:"Center Line",type:"line",params:{x1:0,y1:9e3,x2:9e3,y2:9e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"attack-line-bottom",name:"Attack Line (Bottom)",type:"line",params:{x1:0,y1:6e3,x2:9e3,y2:6e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"attack-line-top",name:"Attack Line (Top)",type:"line",params:{x1:0,y1:12e3,x2:9e3,y2:12e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[]},"badminton-full":{id:"badminton-full",name:"Badminton (Full Court)",sport:"badminton",standard:"BWF",category:"court",description:"Official BWF standard full badminton court with singles and doubles lines",dimensions:{length_mm:13400,width_mm:6100,min_surround_mm:1e3},defaultSurfaceColor:"RH26",defaultLineColor:"RH12",defaultLineWidth_mm:40,markings:[{id:"boundary",name:"Boundary Lines (Doubles)",type:"rectangle",params:{x:0,y:0,width:6100,height:13400},defaultColor:"RH31",lineWidth_mm:40,required:!0,category:"boundary"},{id:"singles-sideline-left",name:"Singles Sideline (Left)",type:"line",params:{x1:460,y1:0,x2:460,y2:13400},defaultColor:"RH31",lineWidth_mm:40,required:!0,category:"court-marking"},{id:"singles-sideline-right",name:"Singles Sideline (Right)",type:"line",params:{x1:5640,y1:0,x2:5640,y2:13400},defaultColor:"RH31",lineWidth_mm:40,required:!0,category:"court-marking"},{id:"short-service-line-bottom",name:"Short Service Line (Bottom)",type:"line",params:{x1:0,y1:1980,x2:6100,y2:1980},defaultColor:"RH31",lineWidth_mm:40,required:!0,category:"court-marking"},{id:"short-service-line-top",name:"Short Service Line (Top)",type:"line",params:{x1:0,y1:11420,x2:6100,y2:11420},defaultColor:"RH31",lineWidth_mm:40,required:!0,category:"court-marking"},{id:"doubles-long-service-line-bottom",name:"Doubles Long Service Line (Bottom)",type:"line",params:{x1:0,y1:760,x2:6100,y2:760},defaultColor:"RH31",lineWidth_mm:40,required:!0,category:"court-marking"},{id:"doubles-long-service-line-top",name:"Doubles Long Service Line (Top)",type:"line",params:{x1:0,y1:12640,x2:6100,y2:12640},defaultColor:"RH31",lineWidth_mm:40,required:!0,category:"court-marking"},{id:"center-service-line",name:"Center Service Line",type:"line",params:{x1:3050,y1:1980,x2:3050,y2:11420},defaultColor:"RH31",lineWidth_mm:40,required:!0,category:"court-marking"}],zones:[]},"pickleball-standard":{id:"pickleball-standard",name:"Pickleball",sport:"pickleball",standard:"USA Pickleball",category:"court",description:"Official USA Pickleball standard court with non-volley zone (kitchen)",dimensions:{length_mm:13410,width_mm:6100,min_surround_mm:1e3},defaultSurfaceColor:"RH11",defaultLineColor:"RH31",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:6100,height:13410},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"non-volley-zone-line-bottom",name:"Non-Volley Zone Line (Bottom)",type:"line",params:{x1:0,y1:2130,x2:6100,y2:2130},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"non-volley-zone-line-top",name:"Non-Volley Zone Line (Top)",type:"line",params:{x1:0,y1:11280,x2:6100,y2:11280},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-line",name:"Center Line (Net)",type:"line",params:{x1:0,y1:6705,x2:6100,y2:6705},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-service-line",name:"Center Service Line",type:"line",params:{x1:3050,y1:0,x2:3050,y2:13410},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[]},"basketball-half":{id:"basketball-half",name:"Basketball (Half Court / 3x3)",sport:"basketball",standard:"FIBA 3x3",category:"court",description:"Half-court basketball for 3x3 games, practice, or space-constrained areas",dimensions:{length_mm:11e3,width_mm:15e3,min_surround_mm:2e3},defaultSurfaceColor:"RH20",defaultLineColor:"RH31",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:15e3,height:11e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"three-point-arc",name:"Three-Point Arc",type:"arc",params:{cx:7500,cy:1575,radius:6750,startAngle:12,endAngle:168},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"three-point-line-left",name:"Three-Point Line (Left)",type:"line",params:{x1:900,y1:0,x2:900,y2:2990},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"three-point-line-right",name:"Three-Point Line (Right)",type:"line",params:{x1:14100,y1:0,x2:14100,y2:2990},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"free-throw-line",name:"Free Throw Line",type:"line",params:{x1:5050,y1:5800,x2:9950,y2:5800},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"free-throw-circle",name:"Free Throw Circle",type:"circle",params:{cx:7500,cy:5800,radius:1800},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"key-lane",name:"Key Lane",type:"rectangle",params:{x:5050,y:0,width:4900,height:5800},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"restricted-area",name:"Restricted Area",type:"arc",params:{cx:7500,cy:0,radius:1250,startAngle:0,endAngle:180},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[{id:"key-area",name:"Key Area",type:"rectangle",params:{x:5050,y:0,width:4900,height:5800},defaultColor:"RH20",paintable:!0,area_m2:28.42}]},"tennis-singles":{id:"tennis-singles",name:"Tennis (Singles)",sport:"tennis",standard:"ITF",category:"court",description:"Singles-only tennis court without doubles alleys",dimensions:{length_mm:23770,width_mm:8230,min_surround_mm:3660},defaultSurfaceColor:"RH22",defaultLineColor:"RH29",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:8230,height:23770},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"service-line-bottom",name:"Service Line (Bottom)",type:"line",params:{x1:0,y1:6400,x2:8230,y2:6400},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"service-line-top",name:"Service Line (Top)",type:"line",params:{x1:0,y1:17370,x2:8230,y2:17370},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-service-line",name:"Center Service Line",type:"line",params:{x1:4115,y1:6400,x2:4115,y2:17370},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-mark-bottom",name:"Center Mark (Bottom)",type:"line",params:{x1:4115,y1:0,x2:4115,y2:100},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-mark-top",name:"Center Mark (Top)",type:"line",params:{x1:4115,y1:23670,x2:4115,y2:23770},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[]},"mini-tennis-red":{id:"mini-tennis-red",name:"Mini Tennis (Red Court)",sport:"tennis",standard:"ITF Play+Stay",category:"court",description:"Beginner/youth court for red stage tennis coaching (36ft)",dimensions:{length_mm:10970,width_mm:5490,min_surround_mm:2e3},defaultSurfaceColor:"RH02",defaultLineColor:"RH29",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:5490,height:10970},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"net-line",name:"Net Line",type:"line",params:{x1:0,y1:5485,x2:5490,y2:5485},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"service-line-bottom",name:"Service Line (Bottom)",type:"line",params:{x1:0,y1:2745,x2:5490,y2:2745},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"service-line-top",name:"Service Line (Top)",type:"line",params:{x1:0,y1:8225,x2:5490,y2:8225},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-service-line",name:"Center Service Line",type:"line",params:{x1:2745,y1:2745,x2:2745,y2:8225},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[]},"padel-standard":{id:"padel-standard",name:"Padel",sport:"padel",standard:"FIP",category:"court",description:"Official FIP padel court with service boxes",dimensions:{length_mm:2e4,width_mm:1e4,min_surround_mm:0},defaultSurfaceColor:"RH60",defaultLineColor:"RH29",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:1e4,height:2e4},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"net-line",name:"Net Line",type:"line",params:{x1:0,y1:1e4,x2:1e4,y2:1e4},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"service-line-bottom",name:"Service Line (Bottom)",type:"line",params:{x1:0,y1:3e3,x2:1e4,y2:3e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"service-line-top",name:"Service Line (Top)",type:"line",params:{x1:0,y1:17e3,x2:1e4,y2:17e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-service-line-bottom",name:"Center Service Line (Bottom)",type:"line",params:{x1:5e3,y1:0,x2:5e3,y2:3e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-service-line-top",name:"Center Service Line (Top)",type:"line",params:{x1:5e3,y1:17e3,x2:5e3,y2:2e4},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-line",name:"Center Line",type:"line",params:{x1:5e3,y1:3e3,x2:5e3,y2:17e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[]},"handball-standard":{id:"handball-standard",name:"Handball",sport:"handball",standard:"IHF",category:"court",description:"Official IHF handball court with goal areas and penalty lines",dimensions:{length_mm:4e4,width_mm:2e4,min_surround_mm:1e3},defaultSurfaceColor:"RH10",defaultLineColor:"RH31",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:2e4,height:4e4},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"center-line",name:"Center Line",type:"line",params:{x1:0,y1:2e4,x2:2e4,y2:2e4},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"goal-area-bottom",name:"Goal Area (Bottom)",type:"arc",params:{cx:1e4,cy:0,radius:6e3,startAngle:0,endAngle:180},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"goal-area-top",name:"Goal Area (Top)",type:"arc",params:{cx:1e4,cy:4e4,radius:6e3,startAngle:180,endAngle:360},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"free-throw-line-bottom",name:"Free-Throw Line (Bottom)",type:"arc",params:{cx:1e4,cy:0,radius:9e3,startAngle:0,endAngle:180,dashed:!0,dashPattern:"300 150"},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"free-throw-line-top",name:"Free-Throw Line (Top)",type:"arc",params:{cx:1e4,cy:4e4,radius:9e3,startAngle:180,endAngle:360,dashed:!0,dashPattern:"300 150"},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"7m-line-bottom",name:"7m Penalty Line (Bottom)",type:"line",params:{x1:9e3,y1:7e3,x2:11e3,y2:7e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"7m-line-top",name:"7m Penalty Line (Top)",type:"line",params:{x1:9e3,y1:33e3,x2:11e3,y2:33e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"goalkeeper-line-bottom",name:"Goalkeeper Restriction Line (Bottom)",type:"line",params:{x1:9500,y1:4e3,x2:10500,y2:4e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"goalkeeper-line-top",name:"Goalkeeper Restriction Line (Top)",type:"line",params:{x1:9500,y1:36e3,x2:10500,y2:36e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[]},"hockey-d":{id:"hockey-d",name:"Field Hockey D",sport:"hockey",standard:"FIH",category:"overlay",description:"Hockey shooting circle (D) for overlay on sports surfaces",dimensions:{length_mm:14630,width_mm:29260,min_surround_mm:0},defaultSurfaceColor:"RH23",defaultLineColor:"RH29",defaultLineWidth_mm:50,markings:[{id:"shooting-circle",name:"Shooting Circle (D)",type:"arc",params:{cx:14630,cy:0,radius:14630,startAngle:0,endAngle:180},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"goal-line",name:"Goal Line",type:"line",params:{x1:0,y1:0,x2:29260,y2:0},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"penalty-spot",name:"Penalty Spot",type:"circle",params:{cx:14630,cy:6400,radius:150},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[]},"hockey-5s":{id:"hockey-5s",name:"Hockey 5s",sport:"hockey",standard:"England Hockey",category:"court",description:"Scaled-down hockey pitch for 5-a-side games",dimensions:{length_mm:55e3,width_mm:41100,min_surround_mm:2e3},defaultSurfaceColor:"RH23",defaultLineColor:"RH29",defaultLineWidth_mm:50,markings:[{id:"boundary",name:"Boundary Lines",type:"rectangle",params:{x:0,y:0,width:41100,height:55e3},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"boundary"},{id:"center-line",name:"Center Line",type:"line",params:{x1:0,y1:27500,x2:41100,y2:27500},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"center-spot",name:"Center Spot",type:"circle",params:{cx:20550,cy:27500,radius:150},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"shooting-circle-bottom",name:"Shooting Circle (Bottom)",type:"arc",params:{cx:20550,cy:0,radius:9e3,startAngle:0,endAngle:180},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"shooting-circle-top",name:"Shooting Circle (Top)",type:"arc",params:{cx:20550,cy:55e3,radius:9e3,startAngle:180,endAngle:360},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"penalty-spot-bottom",name:"Penalty Spot (Bottom)",type:"circle",params:{cx:20550,cy:6400,radius:150},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"},{id:"penalty-spot-top",name:"Penalty Spot (Top)",type:"circle",params:{cx:20550,cy:48600,radius:150},defaultColor:"RH31",lineWidth_mm:50,required:!0,category:"court-marking"}],zones:[]}},wn=[{code:"RH01",name:"Standard Red",hex:"#A5362F",R:165,G:54,B:47,L:39.4,a:58.5,b:29},{code:"RH02",name:"Bright Red",hex:"#E21F2F",R:226,G:31,B:47,L:47.4,a:70.1,b:44},{code:"RH10",name:"Standard Green",hex:"#609B63",R:96,G:155,B:99,L:40.5,a:-42.2,b:17.9},{code:"RH11",name:"Bright Green",hex:"#3BB44A",R:59,G:180,B:74,L:62.1,a:-47.7,b:47.2},{code:"RH12",name:"Dark Green",hex:"#006C55",R:0,G:108,B:85,L:39.6,a:-38.3,b:13.1},{code:"RH20",name:"Standard Blue",hex:"#0075BC",R:0,G:117,B:188,L:36.4,a:14.2,b:-46.7},{code:"RH21",name:"Purple",hex:"#493D8C",R:73,G:61,B:140,L:31.5,a:41.9,b:-40.9},{code:"RH22",name:"Light Blue",hex:"#47AFE3",R:71,G:175,B:227,L:55.3,a:-19.1,b:-37.3},{code:"RH23",name:"Azure",hex:"#039DC4",R:3,G:157,B:196,L:47.7,a:-4.8,b:-34.8},{code:"RH26",name:"Turquoise",hex:"#00A6A3",R:0,G:166,B:163,L:58.8,a:-38.4,b:-3},{code:"RH30",name:"Standard Beige",hex:"#E4C4AA",R:228,G:196,B:170,L:75.2,a:3.8,b:24.8},{code:"RH31",name:"Cream",hex:"#E8E3D8",R:232,G:227,B:216,L:91.8,a:-.5,b:12.5},{code:"RH32",name:"Brown",hex:"#8B5F3C",R:139,G:95,B:60,L:40,a:15.9,b:27.1},{code:"RH90",name:"Funky Pink",hex:"#E8457E",R:232,G:69,B:126,L:55,a:66.1,b:4.9},{code:"RH40",name:"Mustard Yellow",hex:"#E5A144",R:229,G:161,B:68,L:66,a:8.4,b:56.3},{code:"RH41",name:"Bright Yellow",hex:"#FFD833",R:255,G:216,B:51,L:86.9,a:-1,b:90.6},{code:"RH50",name:"Orange",hex:"#F15B32",R:241,G:91,B:50,L:63.2,a:49.8,b:60.2},{code:"RH60",name:"Dark Grey",hex:"#59595B",R:89,G:89,B:91,L:34.1,a:-.4,b:-2.4},{code:"RH61",name:"Light Grey",hex:"#939598",R:147,G:149,B:152,L:69,a:-.5,b:-1},{code:"RH65",name:"Pale Grey",hex:"#D9D9D6",R:217,G:217,B:214,L:87.6,a:-.2,b:-.7},{code:"RH70",name:"Black",hex:"#231F20",R:35,G:31,B:32,L:9.1,a:-.3,b:-6.3}];function g5(){return Object.values(V1)}function y5(t){return V1[t]||null}function x5(t,e,n){const{type:r,params:s}=t;switch(r){case"line":return b5(s,e,n);case"rectangle":return w5(s,e,n);case"circle":return _5(s,e,n);case"arc":return k5(s,e,n);case"polyline":return S5(s,e,n);default:return console.warn(`Unknown marking type: ${r}`),null}}function v5(t,e){const{type:n,params:r}=t;switch(n){case"rectangle":return{type:"rect",x:r.x,y:r.y,width:r.width,height:r.height,fill:e};case"circle":return{type:"circle",cx:r.cx,cy:r.cy,r:r.radius,fill:e};case"polygon":return{type:"polygon",points:r.points,fill:e};default:return console.warn(`Unknown zone type: ${n}`),null}}function b5(t,e,n){const r={type:"line",x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,stroke:e,strokeWidth:n};return t.dashed&&(r.strokeDasharray=t.dashPattern||"200 100"),r}function w5(t,e,n){return{type:"rect",x:t.x,y:t.y,width:t.width,height:t.height,stroke:e,strokeWidth:n,fill:"none"}}function _5(t,e,n){return{type:"circle",cx:t.cx,cy:t.cy,r:t.radius,stroke:e,strokeWidth:n,fill:"none"}}function k5(t,e,n){const{cx:r,cy:s,radius:i,startAngle:a,endAngle:l}=t,c=a*Math.PI/180,d=l*Math.PI/180,u=r+i*Math.cos(c),h=s+i*Math.sin(c),p=r+i*Math.cos(d),f=s+i*Math.sin(d),m=l-a>180?1:0,v={type:"path",d:`M ${u} ${h} A ${i} ${i} 0 ${m} 1 ${p} ${f}`,stroke:e,strokeWidth:n,fill:"none"};return t.dashed&&(v.strokeDasharray=t.dashPattern||"200 100"),v}function S5(t,e,n){return{type:"polyline",points:t.points.map(s=>`${s[0]},${s[1]}`).join(" "),stroke:e,strokeWidth:n,fill:"none"}}function oy(t){if(t&&t.startsWith("#"))return t;const e=wn.find(n=>n.code===t);return e?e.hex:"#000000"}function j5(t){var a;const{template:e,lineColorOverrides:n,zoneColorOverrides:r}=t;if(!e)return console.error("No template provided for court"),{markings:[],zones:[]};const s=e.markings.map(l=>{var h;const c=((h=n[l.id])==null?void 0:h.hex)||e.defaultLineColor,d=oy(c),u=l.lineWidth_mm||e.defaultLineWidth_mm;return{id:l.id,name:l.name,...x5(l,d,u)}}).filter(Boolean),i=((a=e.zones)==null?void 0:a.map(l=>{var u;const c=((u=r[l.id])==null?void 0:u.hex)||l.defaultColor,d=oy(c);return{id:l.id,name:l.name,...v5(l,d)}}).filter(Boolean))||[];return{markings:s,zones:i}}function ay(t,e){return Math.round(t/e)*e}function C5(t,e){return{x:ay(t.x,e),y:ay(t.y,e)}}function Y1(t){let e=t%360;return e<0&&(e+=360),e}function Rc(t,e,n){const{width_mm:r,length_mm:s}=e,{width_mm:i,length_mm:a}=n,l=500,c=-(r-l),d=i-l,u=-(s-l),h=a-l;return{x:Math.max(c,Math.min(t.x,d)),y:Math.max(u,Math.min(t.y,h))}}function E5(t){const{position:e,rotation:n,scale:r,template:s}=t,i=s.dimensions.width_mm/2,a=s.dimensions.length_mm/2;return`translate(${e.x}, ${e.y}) scale(${r}) rotate(${n}, ${i}, ${a})`}function T5({court:t,svgRef:e}){const{updateCourtRotation:n,updateCourtScale:r,updateCourtPosition:s,addToHistory:i}=at(),[a,l]=O.useState(!1),[c,d]=O.useState(!1),[u,h]=O.useState(null),[p,f]=O.useState(null),{template:m,position:y,rotation:v,scale:x}=t,g=m.dimensions.width_mm*x,w=m.dimensions.length_mm*x,b=y.x+m.dimensions.width_mm*x/2,k=y.y+m.dimensions.length_mm*x/2,_=m.dimensions.width_mm/2,S=-1e3,E=(C,$)=>{if(!e.current)return{x:0,y:0};const fe=e.current.createSVGPoint();fe.x=C,fe.y=$;const V=fe.matrixTransform(e.current.getScreenCTM().inverse());return{x:V.x,y:V.y}},T=C=>{C.stopPropagation(),l(!0),f({x:C.clientX,y:C.clientY})},R=(C,$)=>{C.stopPropagation(),d(!0),h($),f({x:C.clientX,y:C.clientY,initialScale:x,initialWidth:g,initialHeight:w,initialPosition:{...y}})};O.useEffect(()=>{if(!a&&!c)return;const C=fe=>{if(a){const V=E(fe.clientX,fe.clientY),K=V.x-b,F=V.y-k;let Z=Math.atan2(F,K)*(180/Math.PI)+90;Z=Y1(Z),fe.shiftKey&&(Z=Math.round(Z/15)*15),n(t.id,Z)}else if(c&&p){const V=E(fe.clientX,fe.clientY),K=E(p.x,p.y),F=V.x-K.x,Z=V.y-K.y;let U=p.initialScale,X={...y};switch(u){case"se":U=Math.max(.3,p.initialScale+F/m.dimensions.width_mm);break;case"nw":U=Math.max(.3,p.initialScale-F/m.dimensions.width_mm),X.x=p.initialPosition.x+(p.initialWidth-m.dimensions.width_mm*U),X.y=p.initialPosition.y+(p.initialHeight-m.dimensions.length_mm*U);break;case"ne":U=Math.max(.3,p.initialScale+F/m.dimensions.width_mm),X.y=p.initialPosition.y+(p.initialHeight-m.dimensions.length_mm*U);break;case"sw":U=Math.max(.3,p.initialScale-F/m.dimensions.width_mm),X.x=p.initialPosition.x+(p.initialWidth-m.dimensions.width_mm*U);break;case"e":U=Math.max(.3,p.initialScale+F/m.dimensions.width_mm);break;case"w":U=Math.max(.3,p.initialScale-F/m.dimensions.width_mm),X.x=p.initialPosition.x+(p.initialWidth-m.dimensions.width_mm*U);break;case"n":U=Math.max(.3,p.initialScale-Z/m.dimensions.length_mm),X.y=p.initialPosition.y+(p.initialHeight-m.dimensions.length_mm*U);break;case"s":U=Math.max(.3,p.initialScale+Z/m.dimensions.length_mm);break}U=Math.min(3,Math.max(.3,U)),r(t.id,U),(X.x!==y.x||X.y!==y.y)&&s(t.id,X)}},$=()=>{(a||c)&&i(),l(!1),d(!1),h(null),f(null)};return window.addEventListener("mousemove",C),window.addEventListener("mouseup",$),()=>{window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",$)}},[a,c,p,b,k,t.id,y,x,u]);const W=[{type:"nw",x:0,y:0,cursor:"nwse-resize"},{type:"n",x:m.dimensions.width_mm/2,y:0,cursor:"ns-resize"},{type:"ne",x:m.dimensions.width_mm,y:0,cursor:"nesw-resize"},{type:"e",x:m.dimensions.width_mm,y:m.dimensions.length_mm/2,cursor:"ew-resize"},{type:"se",x:m.dimensions.width_mm,y:m.dimensions.length_mm,cursor:"nwse-resize"},{type:"s",x:m.dimensions.width_mm/2,y:m.dimensions.length_mm,cursor:"ns-resize"},{type:"sw",x:0,y:m.dimensions.length_mm,cursor:"nesw-resize"},{type:"w",x:0,y:m.dimensions.length_mm/2,cursor:"ew-resize"}],P=300,I=250;return o.jsxs("g",{className:"transform-handles",children:[o.jsxs("g",{className:"rotation-handle",onMouseDown:T,style:{cursor:a?"grabbing":"grab"},children:[o.jsx("line",{x1:_,y1:0,x2:_,y2:S+I,stroke:"#007bff",strokeWidth:30,strokeDasharray:"100 50"}),o.jsx("circle",{cx:_,cy:S,r:I,fill:"white",stroke:"#007bff",strokeWidth:40}),o.jsx("path",{d:`M ${_-I*.4} ${S}
              A ${I*.5} ${I*.5} 0 1 1 ${_+I*.4} ${S}`,fill:"none",stroke:"#007bff",strokeWidth:30,strokeLinecap:"round"}),o.jsx("path",{d:`M ${_+I*.4} ${S}
              L ${_+I*.6} ${S-I*.2}
              M ${_+I*.4} ${S}
              L ${_+I*.6} ${S+I*.2}`,fill:"none",stroke:"#007bff",strokeWidth:30,strokeLinecap:"round"})]}),W.map(C=>o.jsx("rect",{className:`scale-handle scale-handle--${C.type}`,x:C.x-P/2,y:C.y-P/2,width:P,height:P,fill:"white",stroke:"#007bff",strokeWidth:40,rx:30,ry:30,style:{cursor:c&&u===C.type?"grabbing":C.cursor,pointerEvents:"all"},onMouseDown:$=>R($,C.type)},C.type)),a&&o.jsxs("text",{x:m.dimensions.width_mm/2,y:-1e3-I-200,textAnchor:"middle",fontSize:400,fill:"#007bff",fontWeight:"bold",style:{pointerEvents:"none"},children:[Math.round(v),""]}),c&&o.jsxs("text",{x:m.dimensions.width_mm/2,y:m.dimensions.length_mm+600,textAnchor:"middle",fontSize:400,fill:"#007bff",fontWeight:"bold",style:{pointerEvents:"none"},children:[(x*100).toFixed(0),"%"]})]})}function q1(t){const{width_mm:e,height_mm:n,numLanes:r,laneWidth_mm:s,cornerRadius:i={topLeft:3e3,topRight:3e3,bottomLeft:3e3,bottomRight:3e3},lineWidth_mm:a=50}=t,l=[];if(i.topLeft===0&&i.topRight===0&&i.bottomLeft===0&&i.bottomRight===0){const d=r*s;for(let u=0;u<r;u++){const h=u*s;l.push({laneNumber:u+1,innerPath:null,outerPath:N5(s,n,u),perimeter:2*(s+n)/1e3,isParallel:!0,laneX:h,laneWidth:s})}return{lanes:l,totalWidth:d,totalLength:n,usableWidth:d,usableHeight:n,isStraightTrack:!0}}else for(let d=0;d<r;d++){const u=d*s,h=(d+1)*s,p=Math.max(0,e-h*2),f=Math.max(0,n-h*2),m=Math.max(0,e-u*2),y=Math.max(0,n-u*2),v={topLeft:Math.max(0,i.topLeft-h),topRight:Math.max(0,i.topRight-h),bottomLeft:Math.max(0,i.bottomLeft-h),bottomRight:Math.max(0,i.bottomRight-h)},x={topLeft:Math.max(0,i.topLeft-u),topRight:Math.max(0,i.topRight-u),bottomLeft:Math.max(0,i.bottomLeft-u),bottomRight:Math.max(0,i.bottomRight-u)};l.push({laneNumber:d+1,innerPath:ly(p,f,v,h),outerPath:ly(m,y,x,u),perimeter:P5(m,y,x),isParallel:!1})}return{lanes:l,totalWidth:e,totalLength:n,usableWidth:e-r*s*2,usableHeight:n-r*s*2}}function ly(t,e,n,r=0){if(t<=0||e<=0)return`M ${r} ${r} L ${r} ${r}`;const s=Math.min(t/2,e/2),i=Math.min(n.topLeft,s),a=Math.min(n.topRight,s),l=Math.min(n.bottomRight,s),c=Math.min(n.bottomLeft,s),d=r,u=r+t,h=r,p=r+e;return`
    M ${d+i} ${h}
    L ${u-a} ${h}
    ${a>0?`A ${a} ${a} 0 0 1 ${u} ${h+a}`:""}
    L ${u} ${p-l}
    ${l>0?`A ${l} ${l} 0 0 1 ${u-l} ${p}`:""}
    L ${d+c} ${p}
    ${c>0?`A ${c} ${c} 0 0 1 ${d} ${p-c}`:""}
    L ${d} ${h+i}
    ${i>0?`A ${i} ${i} 0 0 1 ${d+i} ${h}`:""}
    Z
  `.trim().replace(/\s+/g," ")}function N5(t,e,n){const r=n*t;return`M ${r} 0 L ${r+t} 0 L ${r+t} ${e} L ${r} ${e} Z`}function P5(t,e,n){if(t<=0||e<=0)return 0;const r=Math.min(t/2,e/2),s=Math.min(n.topLeft,r),i=Math.min(n.topRight,r),a=Math.min(n.bottomRight,r),l=Math.min(n.bottomLeft,r),c=t-s-i,d=e-i-a,u=t-a-l,h=e-l-s,p=Math.PI*s/2,f=Math.PI*i/2,m=Math.PI*a/2,y=Math.PI*l/2;return(c+d+u+h+p+f+m+y)/1e3}function X1(t){if(!t||!t.lanes||t.lanes.length===0)return[];const e=t.lanes.length-1,n=t.lanes[e].perimeter;return t.lanes.map((r,s)=>r.perimeter-n)}function cy(t,e,n){const{width_mm:r,height_mm:s,laneWidth_mm:i,cornerRadius:a={topLeft:3e3,topRight:3e3,bottomLeft:3e3,bottomRight:3e3}}=n,l=t*i,c=Math.max(0,r-l*2),d=Math.max(0,s-l*2),u=Math.min(c/2,d/2),h=Math.min(Math.max(0,a.topLeft-l),u),p=Math.min(Math.max(0,a.topRight-l),u),f=Math.min(Math.max(0,a.bottomRight-l),u),m=Math.min(Math.max(0,a.bottomLeft-l),u),y=l,v=l+c,x=l,g=l+d,w=[{type:"arc",length:Math.PI*m/2,radius:m,corner:"bottomLeft"},{type:"straight",length:d-m-h,dir:"up"},{type:"arc",length:Math.PI*h/2,radius:h,corner:"topLeft"},{type:"straight",length:c-h-p,dir:"right"},{type:"arc",length:Math.PI*p/2,radius:p,corner:"topRight"},{type:"straight",length:d-p-f,dir:"down"},{type:"arc",length:Math.PI*f/2,radius:f,corner:"bottomRight"},{type:"straight",length:c-f-m,dir:"left"}];let b=e;const k=w.reduce((S,E)=>S+E.length,0);for(;b<0;)b+=k;for(;b>=k;)b-=k;let _=0;for(const S of w){if(b<=_+S.length){const E=b-_,T=S.length>0?E/S.length:0;return S.type==="arc"?R5(S,T,{left:y,right:v,top:x,bottom:g,tl:h,tr:p,br:f,bl:m}):O5(S,T,{left:y,right:v,top:x,bottom:g,tl:h,tr:p,br:f,bl:m})}_+=S.length}return{x:y,y:g-m,angle:-Math.PI/2}}function R5(t,e,n){const{left:r,right:s,top:i,bottom:a,tl:l,tr:c,br:d,bl:u}=n,h=e*(Math.PI/2);switch(t.corner){case"bottomLeft":{const p=r+u,f=a-u,y=Math.PI/2+h;return{x:p+u*Math.cos(y),y:f+u*Math.sin(y),angle:y+Math.PI/2}}case"topLeft":{const p=r+l,f=i+l,y=Math.PI+h;return{x:p+l*Math.cos(y),y:f+l*Math.sin(y),angle:y+Math.PI/2}}case"topRight":{const p=s-c,f=i+c,y=-Math.PI/2+h;return{x:p+c*Math.cos(y),y:f+c*Math.sin(y),angle:y+Math.PI/2}}case"bottomRight":{const p=s-d,f=a-d,y=0+h;return{x:p+d*Math.cos(y),y:f+d*Math.sin(y),angle:y+Math.PI/2}}default:return{x:r,y:i,angle:0}}}function O5(t,e,n){const{left:r,right:s,top:i,bottom:a,tl:l,tr:c,br:d,bl:u}=n;switch(t.dir){case"up":{const h=a-u,p=i+l;return{x:r,y:h+e*(p-h),angle:-Math.PI/2}}case"right":{const h=r+l,p=s-c;return{x:h+e*(p-h),y:i,angle:0}}case"down":{const h=i+c,p=a-d;return{x:s,y:h+e*(p-h),angle:Math.PI/2}}case"left":{const h=s-d,p=r+u;return{x:h+e*(p-h),y:a,angle:Math.PI}}default:return{x:r,y:i,angle:0}}}function dy(t,e,n){const r=cy(t,e,n),s=cy(t+1,e,n);return{x:(r.x+s.x)/2,y:(r.y+s.y)/2,angle:r.angle,innerX:s.x,innerY:s.y,outerX:r.x,outerY:r.y}}function uy(t,e,n){const{width_mm:r,height_mm:s,laneWidth_mm:i,cornerRadius:a={topLeft:3e3,topRight:3e3,bottomLeft:3e3,bottomRight:3e3}}=n,l=t*i,c=Math.max(0,r-l*2),d=Math.max(0,s-l*2),u=Math.min(c/2,d/2),h=Math.min(Math.max(0,a.topLeft-l),u),p=Math.min(Math.max(0,a.topRight-l),u),f=Math.min(Math.max(0,a.bottomRight-l),u),m=Math.min(Math.max(0,a.bottomLeft-l),u),y=[{type:"arc",length:Math.PI*m/2,corner:"bottomLeft"},{type:"straight",length:d-m-h,dir:"up"},{type:"arc",length:Math.PI*h/2,corner:"topLeft"},{type:"straight",length:c-h-p,dir:"right"},{type:"arc",length:Math.PI*p/2,corner:"topRight"},{type:"straight",length:d-p-f,dir:"down"},{type:"arc",length:Math.PI*f/2,corner:"bottomRight"},{type:"straight",length:c-f-m,dir:"left"}],v=y.reduce((w,b)=>w+b.length,0);let x=e;for(;x<0;)x+=v;for(;x>=v;)x-=v;let g=0;for(let w=0;w<y.length;w++){if(x<=g+y[w].length){const b=x-g,k=y[w].length>0?b/y[w].length:0;return{segmentIndex:w,t:k,segments:y,totalPerimeter:v}}g+=y[w].length}return{segmentIndex:0,t:0,segments:y,totalPerimeter:v}}function hy(t,e,n,r){const s=uy(n,e,r),i=uy(t,0,r);let a=0;for(let d=0;d<s.segmentIndex;d++)a+=i.segments[d].length;const l=i.segments[s.segmentIndex].length;return a+s.t*l}function A5({track:t,svgRef:e}){var C;const{updateTrackParameters:n,updateTrackPosition:r,updateTrackRotation:s,addToHistory:i}=at(),[a,l]=O.useState(!1),[c,d]=O.useState(!1),[u,h]=O.useState(null),[p,f]=O.useState(null),{parameters:m,position:y,rotation:v}=t,x=m.width_mm,g=m.height_mm,w=y.x+x/2,b=y.y+g/2,k=x/2,_=-1e3,S=($,fe)=>{if(!e.current)return{x:0,y:0};const V=e.current.createSVGPoint();V.x=$,V.y=fe;const K=V.matrixTransform(e.current.getScreenCTM().inverse());return{x:K.x,y:K.y}},E=$=>{$.stopPropagation();const fe=$.touches?$.touches[0].clientX:$.clientX,V=$.touches?$.touches[0].clientY:$.clientY;d(!0),f({x:fe,y:V})},T=($,fe)=>{var X;$.stopPropagation(),l(!0),h(fe);const V=$.touches?$.touches[0].clientX:$.clientX,K=$.touches?$.touches[0].clientY:$.clientY,F=S(V,K),Z=((X=t.template)==null?void 0:X.trackType)==="straight";let U={};if(Z){const ge=v*Math.PI/180,de=Math.sin(ge),Q=Math.cos(ge),ke=y.x+x/2,Oe=y.y+g/2,De=fe==="n"||fe==="nw"||fe==="ne";U={fixedEdgeCenter:De?{x:ke-g/2*de,y:Oe+g/2*Q}:{x:ke+g/2*de,y:Oe-g/2*Q},fixedEdgeIsSouth:De,sinR:de,cosR:Q}}f({screenX:V,screenY:K,svgX:F.x,svgY:F.y,initialWidth:x,initialHeight:g,initialPosition:{...y},initialCornerRadius:{...m.cornerRadius},...U})};O.useEffect(()=>{if(!a&&!c)return;const $=V=>{var Ge;const K=V.touches?V.touches[0].clientX:V.clientX,F=V.touches?V.touches[0].clientY:V.clientY;if(c){const He=S(K,F),Xe=He.x-w,nt=He.y-b;let j=Math.atan2(nt,Xe)*(180/Math.PI)+90;j=Y1(j),V.shiftKey&&(j=Math.round(j/15)*15),s(t.id,j);return}if(!p)return;const Z=S(K,F),U=Z.x-p.svgX,X=Z.y-p.svgY;let ge=p.initialWidth,de=p.initialHeight,Q={...y},ke={...p.initialCornerRadius};const Oe=3e3,De=((Ge=t.template)==null?void 0:Ge.trackType)==="straight";if(De&&(u==="e"||u==="w"))return;if(De&&p.fixedEdgeCenter){const{fixedEdgeCenter:He,fixedEdgeIsSouth:Xe,sinR:nt,cosR:j}=p,ne=Z.x-He.x,oe=Z.y-He.y,z=Xe?nt:-nt,A=Xe?-j:j,M=ne*z+oe*A;de=Math.max(Oe,M);const G=He.x+de/2*z,ie=He.y+de/2*A;Q={x:G-ge/2,y:ie-de/2}}else switch(u){case"se":ge=Math.max(Oe,p.initialWidth+U),de=Math.max(Oe,p.initialHeight+X);const He=Math.min(ge/p.initialWidth,de/p.initialHeight);ke={topLeft:p.initialCornerRadius.topLeft*He,topRight:p.initialCornerRadius.topRight*He,bottomLeft:p.initialCornerRadius.bottomLeft*He,bottomRight:p.initialCornerRadius.bottomRight*He};break;case"nw":ge=Math.max(Oe,p.initialWidth-U),de=Math.max(Oe,p.initialHeight-X),Q.x=p.initialPosition.x+(p.initialWidth-ge),Q.y=p.initialPosition.y+(p.initialHeight-de);const Xe=Math.min(ge/p.initialWidth,de/p.initialHeight);ke={topLeft:p.initialCornerRadius.topLeft*Xe,topRight:p.initialCornerRadius.topRight*Xe,bottomLeft:p.initialCornerRadius.bottomLeft*Xe,bottomRight:p.initialCornerRadius.bottomRight*Xe};break;case"ne":ge=Math.max(Oe,p.initialWidth+U),de=Math.max(Oe,p.initialHeight-X),Q.y=p.initialPosition.y+(p.initialHeight-de);const nt=Math.min(ge/p.initialWidth,de/p.initialHeight);ke={topLeft:p.initialCornerRadius.topLeft*nt,topRight:p.initialCornerRadius.topRight*nt,bottomLeft:p.initialCornerRadius.bottomLeft*nt,bottomRight:p.initialCornerRadius.bottomRight*nt};break;case"sw":ge=Math.max(Oe,p.initialWidth-U),de=Math.max(Oe,p.initialHeight+X),Q.x=p.initialPosition.x+(p.initialWidth-ge);const j=Math.min(ge/p.initialWidth,de/p.initialHeight);ke={topLeft:p.initialCornerRadius.topLeft*j,topRight:p.initialCornerRadius.topRight*j,bottomLeft:p.initialCornerRadius.bottomLeft*j,bottomRight:p.initialCornerRadius.bottomRight*j};break;case"e":ge=Math.max(Oe,p.initialWidth+U);const ne=ge/p.initialWidth;ke={topLeft:p.initialCornerRadius.topLeft*ne,topRight:p.initialCornerRadius.topRight*ne,bottomLeft:p.initialCornerRadius.bottomLeft*ne,bottomRight:p.initialCornerRadius.bottomRight*ne};break;case"w":ge=Math.max(Oe,p.initialWidth-U),Q.x=p.initialPosition.x+(p.initialWidth-ge);const oe=ge/p.initialWidth;ke={topLeft:p.initialCornerRadius.topLeft*oe,topRight:p.initialCornerRadius.topRight*oe,bottomLeft:p.initialCornerRadius.bottomLeft*oe,bottomRight:p.initialCornerRadius.bottomRight*oe};break;case"n":de=Math.max(Oe,p.initialHeight-X),Q.y=p.initialPosition.y+(p.initialHeight-de);const z=de/p.initialHeight;ke={topLeft:p.initialCornerRadius.topLeft*z,topRight:p.initialCornerRadius.topRight*z,bottomLeft:p.initialCornerRadius.bottomLeft*z,bottomRight:p.initialCornerRadius.bottomRight*z};break;case"s":de=Math.max(Oe,p.initialHeight+X);const A=de/p.initialHeight;ke={topLeft:p.initialCornerRadius.topLeft*A,topRight:p.initialCornerRadius.topRight*A,bottomLeft:p.initialCornerRadius.bottomLeft*A,bottomRight:p.initialCornerRadius.bottomRight*A};break}const Be=Math.min(ge,de)/2;ke={topLeft:Math.min(ke.topLeft,Be),topRight:Math.min(ke.topRight,Be),bottomLeft:Math.min(ke.bottomLeft,Be),bottomRight:Math.min(ke.bottomRight,Be)},n(t.id,{width_mm:ge,height_mm:de,cornerRadius:ke}),(Q.x!==y.x||Q.y!==y.y)&&r(t.id,Q)},fe=()=>{(a||c)&&i(),l(!1),d(!1),h(null),f(null)};return window.addEventListener("mousemove",$),window.addEventListener("mouseup",fe),window.addEventListener("touchmove",$,{passive:!1}),window.addEventListener("touchend",fe),window.addEventListener("touchcancel",fe),()=>{window.removeEventListener("mousemove",$),window.removeEventListener("mouseup",fe),window.removeEventListener("touchmove",$),window.removeEventListener("touchend",fe),window.removeEventListener("touchcancel",fe)}},[a,p,u,t.id,y,m,n,r,i]);const R=((C=t.template)==null?void 0:C.trackType)==="straight",W=[{type:"nw",x:0,y:0,cursor:"nwse-resize"},{type:"n",x:x/2,y:0,cursor:"ns-resize"},{type:"ne",x,y:0,cursor:"nesw-resize"},{type:"e",x,y:g/2,cursor:"ew-resize"},{type:"se",x,y:g,cursor:"nwse-resize"},{type:"s",x:x/2,y:g,cursor:"ns-resize"},{type:"sw",x:0,y:g,cursor:"nesw-resize"},{type:"w",x:0,y:g/2,cursor:"ew-resize"}],P=R?W.filter($=>$.type==="n"||$.type==="s"):W,I=400;return o.jsxs("g",{className:"track-resize-handles",children:[o.jsxs("g",{className:"rotation-handle-group",children:[o.jsx("line",{x1:k,y1:0,x2:k,y2:_,stroke:"#0066CC",strokeWidth:30,strokeDasharray:"100 100",opacity:.5,style:{pointerEvents:"none"}}),o.jsx("circle",{className:"rotation-handle",cx:k,cy:_,r:I/2,fill:"white",stroke:"#0066CC",strokeWidth:50,style:{cursor:c?"grabbing":"grab",pointerEvents:"all"},onMouseDown:E,onTouchStart:E}),o.jsx("path",{d:`M ${k-100} ${_-50}
              A 100 100 0 1 1 ${k+100} ${_-50}`,fill:"none",stroke:"#0066CC",strokeWidth:40,strokeLinecap:"round",style:{pointerEvents:"none"}}),o.jsx("path",{d:`M ${k+100} ${_-50}
              L ${k+80} ${_-120}
              L ${k+150} ${_-80}
              Z`,fill:"#0066CC",style:{pointerEvents:"none"}})]}),P.map($=>o.jsx("rect",{className:`resize-handle resize-handle--${$.type}`,x:$.x-I/2,y:$.y-I/2,width:I,height:I,fill:"white",stroke:"#0066CC",strokeWidth:50,rx:40,ry:40,style:{cursor:a&&u===$.type?"grabbing":$.cursor,pointerEvents:"all"},onMouseDown:fe=>T(fe,$.type),onTouchStart:fe=>T(fe,$.type)},$.type)),a&&o.jsxs("text",{x:x/2,y:g+800,textAnchor:"middle",fontSize:400,fill:"#0066CC",fontWeight:"bold",style:{pointerEvents:"none"},children:[(x/1e3).toFixed(1),"m  ",(g/1e3).toFixed(1),"m"]}),c&&o.jsxs("text",{x:x/2,y:-1500,textAnchor:"middle",fontSize:400,fill:"#0066CC",fontWeight:"bold",style:{pointerEvents:"none"},children:[v.toFixed(0),""]})]})}function M5({geometry:t,parameters:e,boxConfig:n,surfaceColor:r,lineColor:s,isStraightTrack:i}){if(!n||!n.enabled)return null;const{depth_mm:a=800,lineWidth_mm:l=50,perLaneOffsets:c=[],style:d="staggered",direction:u="counterclockwise",startPosition:h=0}=n,p="'Black Ops One', 'Impact', sans-serif",f=r||"#A5362F",m=s||"#E8E3D8",y=d==="staggered"||d==="both",v=d==="straight"||d==="both";return o.jsx("g",{className:"starting-boxes",children:t.lanes.map((x,g)=>{const w=g+1;return i?$5(g,w,e,t,a,l,f,m,p,y,v,c,u):D5(g,w,e,t,a,l,f,m,p,y,v,c,u,h)})})}function $5(t,e,n,r,s,i,a,l,c,d,u,h,p){const f=t*n.laneWidth_mm,m=n.laneWidth_mm,y=p==="clockwise",v=y?r.totalLength-s:0,x=y?0:r.totalLength-s,g=(h[t]||0)*1e3,w=[];if(d&&!u){const b=y?v-g:v+g;w.push(o.jsx(Oc,{x:f,y:b,width:m,height:s,laneNumber:e,boxFillColor:a,lineColor:l,lineWidth:i,fontFamily:c,flipLine:!y},`stagger-${e}`))}else if(u&&!d)w.push(o.jsx(Oc,{x:f,y:v,width:m,height:s,laneNumber:e,boxFillColor:a,lineColor:l,lineWidth:i,fontFamily:c,flipLine:!y},`straight-${e}`));else if(d&&u){const b=y?v-g:v+g;w.push(o.jsx(Oc,{x:f,y:b,width:m,height:s,laneNumber:e,boxFillColor:a,lineColor:l,lineWidth:i,fontFamily:c,flipLine:!y},`stagger-${e}`)),w.push(o.jsx(Oc,{x:f,y:x,width:m,height:s,laneNumber:e,boxFillColor:a,lineColor:l,lineWidth:i,fontFamily:c,flipLine:y},`straight-${e}`))}return o.jsx("g",{children:w},`lane-boxes-${e}`)}function Oc({x:t,y:e,width:n,height:r,laneNumber:s,boxFillColor:i,lineColor:a,lineWidth:l,fontFamily:c,flipLine:d}){const u=d?e+r:e;return o.jsxs("g",{children:[o.jsx("line",{x1:t,y1:u,x2:t+n,y2:u,stroke:a,strokeWidth:l,strokeLinecap:"butt",pointerEvents:"none"}),o.jsx("text",{x:t+n/2,y:e+r/2,fontSize:Math.min(r*.6,n*.5),fill:a,textAnchor:"middle",dominantBaseline:"middle",fontFamily:c,fontWeight:"bold",pointerEvents:"none",opacity:"0.9",children:s})]})}function D5(t,e,n,r,s,i,a,l,c,d,u,h,p,f=0){var E,T;const m=p==="clockwise",y=r.lanes.length-1,v=(((E=r.lanes[y])==null?void 0:E.perimeter)||0)*1e3,x=v/2,g=f/100*v,w=hy(t,g,y,n),k=(((T=r.lanes[t])==null?void 0:T.perimeter)||0)*1e3/2,_=(h[t]||0)*1e3,S=[];if(d&&!u){const R=m?w+k+_:w+_;S.push(o.jsx(Ac,{index:t,laneNumber:e,distance:R,depth_mm:s,parameters:n,boxFillColor:a,lineColor:l,lineWidth:i,fontFamily:c},`stagger-${e}`))}else if(u&&!d){const R=m?w+k:w;S.push(o.jsx(Ac,{index:t,laneNumber:e,distance:R,depth_mm:s,parameters:n,boxFillColor:a,lineColor:l,lineWidth:i,fontFamily:c},`straight-${e}`))}else if(d&&u){const R=m?w+k+_:w+_,W=m?g:g+x,P=hy(t,W,y,n),I=P;S.push(o.jsx(Ac,{index:t,laneNumber:e,distance:R,depth_mm:s,parameters:n,boxFillColor:a,lineColor:l,lineWidth:i,fontFamily:c},`stagger-${e}`)),S.push(o.jsx(Ac,{index:t,laneNumber:e,distance:I,depth_mm:s,parameters:n,boxFillColor:a,lineColor:l,lineWidth:i,fontFamily:c},`straight-${e}`))}return o.jsx("g",{children:S},`lane-boxes-${e}`)}function Ac({index:t,laneNumber:e,distance:n,depth_mm:r,parameters:s,boxFillColor:i,lineColor:a,lineWidth:l,fontFamily:c}){const d=dy(t,n,s),u=d.angle+Math.PI/2,h=s.laneWidth_mm/2,p=d.x+Math.cos(u)*h,f=d.y+Math.sin(u)*h,m=d.x-Math.cos(u)*h,y=d.y-Math.sin(u)*h,v=dy(t,n+r/2,s);return o.jsxs("g",{children:[o.jsx("line",{x1:p,y1:f,x2:m,y2:y,stroke:a,strokeWidth:l,strokeLinecap:"butt",pointerEvents:"none"}),o.jsx("text",{x:v.x,y:v.y,fontSize:Math.min(r*.6,s.laneWidth_mm*.5),fill:a,textAnchor:"middle",dominantBaseline:"middle",fontFamily:c,fontWeight:"bold",pointerEvents:"none",opacity:"0.9",transform:`rotate(${v.angle*180/Math.PI+90}, ${v.x}, ${v.y})`,children:e})]})}function py({track:t,isSelected:e,onMouseDown:n,onTouchStart:r,onDoubleClick:s,svgRef:i}){var E,T,R;const{parameters:a,position:l,rotation:c,scale:d=1,trackSurfaceColor:u,trackLineColor:h,laneSurfaceColors:p}=t,f=q1(a),m=f.lanes.length>0&&f.lanes[0].isParallel===!0,y=f.totalWidth,v=f.totalLength,x=y/2,g=v/2,w=`translate(${l.x}, ${l.y}) scale(${d}) rotate(${c}, ${x}, ${g})`,b=(u==null?void 0:u.hex)||"#A5362F",k=(h==null?void 0:h.hex)||"#E8E3D8",_=a.lineWidth_mm||50,S=W=>{const P=p==null?void 0:p[W-1];return(P==null?void 0:P.hex)||b};return console.log("TrackRenderer - trackSurfaceColor:",u),console.log("TrackRenderer - defaultSurfaceColor:",b),console.log("TrackRenderer - geometry.lanes.length:",f.lanes.length),o.jsxs("g",{className:`track-element ${e?"track-element--selected":""}`,transform:w,style:{cursor:"move"},children:[m?o.jsxs(o.Fragment,{children:[o.jsx("rect",{x:"0",y:"0",width:y,height:v,fill:"transparent",pointerEvents:"all",onMouseDown:n,onTouchStart:r,onDoubleClick:s,style:{cursor:"move"}}),f.lanes.map(W=>o.jsx("path",{d:W.outerPath,fill:S(W.laneNumber),stroke:"none",pointerEvents:"none"},`lane-fill-${W.laneNumber}`))]}):o.jsx(o.Fragment,{children:f.lanes.map((W,P)=>{const I=f.lanes[P+1],C=I?I.outerPath:W.innerPath,$=P===0;return o.jsx("path",{d:`${W.outerPath} ${C}`,fill:S(W.laneNumber),fillRule:"evenodd",stroke:"none",pointerEvents:$?"all":"none",onMouseDown:$?n:void 0,onTouchStart:$?r:void 0,onDoubleClick:$?s:void 0,style:$?{cursor:"move"}:void 0},`lane-fill-${W.laneNumber}`)})}),f.lanes.map((W,P)=>o.jsx(L5,{lane:W,lineColor:k,lineWidth:_,isLastLane:P===f.lanes.length-1,isStraightTrack:m,geometry:f},`stroke-${W.laneNumber}`)),((E=a.startingBoxes)==null?void 0:E.enabled)&&o.jsx(M5,{geometry:f,parameters:a,boxConfig:{...a.startingBoxes,perLaneOffsets:((T=t.template)==null?void 0:T.trackType)==="curved"?X1(f):[]},surfaceColor:b,lineColor:k,isStraightTrack:((R=t.template)==null?void 0:R.trackType)==="straight"}),e&&o.jsxs(o.Fragment,{children:[o.jsx("rect",{x:"-10",y:"-10",width:y+20,height:v+20,fill:"none",stroke:"#0066CC",strokeWidth:"80",strokeDasharray:"400 400",opacity:"0.5",pointerEvents:"none"}),o.jsx(A5,{track:t,svgRef:i})]})]})}function L5({lane:t,lineColor:e,lineWidth:n,isLastLane:r,isStraightTrack:s,geometry:i}){const{innerPath:a,outerPath:l}=t,c=50;return s?o.jsxs("g",{className:"track-lane-stroke",children:[t.laneNumber===1&&o.jsx("line",{x1:t.laneX,y1:0,x2:t.laneX,y2:i.totalLength,stroke:e,strokeWidth:c,pointerEvents:"none"}),o.jsx("line",{x1:t.laneX+t.laneWidth,y1:0,x2:t.laneX+t.laneWidth,y2:i.totalLength,stroke:e,strokeWidth:c,pointerEvents:"none"})]}):o.jsxs("g",{className:"track-lane-stroke",children:[o.jsx("path",{d:l,fill:"none",stroke:e,strokeWidth:c,pointerEvents:"none"}),r&&o.jsx("path",{d:a,fill:"none",stroke:e,strokeWidth:c,pointerEvents:"none"})]})}const I5=200,Z1=30,z5=120;function fa(t=1,e=1){const n=1/t,r=I5*n,s=Z1*n,i=r*.25;return{size:r,strokeWidth:s,cornerRadius:i}}function F5(t=1){const e=1/t,n=z5*e,r=n*.7,s=Z1*.5*e;return{pointSize:n,handleSize:r,strokeWidth:s}}function ma(t){return{distance:t*2.5,size:t*.8,stemWidth:t*.15}}function ga(t=1,e=1){const n=1/t;return{strokeWidth:60*n,dashArray:`${300*n} ${300*n}`,padding:40}}function fy({motif:t,isSelected:e,zoom:n=1,onMouseDown:r,onTouchStart:s,onDoubleClick:i,onScaleStart:a,onRotateStart:l}){const{svgContent:c,originalWidth_mm:d,originalHeight_mm:u,position:h,rotation:p,scale:f}=t,m=O.useMemo(()=>{if(!c)return null;const S=c.match(/viewBox=["']([^"']+)["']/i);if(S){const R=S[1].split(/\s+/).map(Number);if(R.length>=4)return{width:R[2],height:R[3]}}const E=c.match(/\bwidth=["']?(\d+(?:\.\d+)?)/i),T=c.match(/\bheight=["']?(\d+(?:\.\d+)?)/i);return E&&T?{width:parseFloat(E[1]),height:parseFloat(T[1])}:null},[c]),y=O.useMemo(()=>{if(!m)return{width:d,height:u};const S=m.width/m.height,E=d/u,T=S>=1,R=E>=1;if(T!==R){console.warn("[MOTIF] Orientation mismatch detected - using SVG viewBox aspect ratio"),console.log("[MOTIF] SVG viewBox:",m,"AR:",S.toFixed(2)),console.log("[MOTIF] Physical dims:",d,"",u,"AR:",E.toFixed(2));const W=d*u,P=Math.sqrt(W*S),I=P/S;return{width:P,height:I}}return{width:d,height:u}},[m,d,u]),v=y.width*(f||1),x=y.height*(f||1),g=v/2,w=x/2,b=`translate(${h.x}, ${h.y}) rotate(${p||0}, ${g}, ${w})`,k=O.useMemo(()=>{if(!c)return null;try{let S=c;return S=S.replace(/\s+(width|height)=["'][^"']*["']/gi,""),S.includes("viewBox")||(S=S.replace("<svg",`<svg viewBox="0 0 ${y.width} ${y.height}"`)),S}catch(S){return console.error("[MOTIF] Error processing SVG:",S),c}},[c,y]),_=O.useMemo(()=>{if(!k)return null;try{return`data:image/svg+xml,${encodeURIComponent(k).replace(/'/g,"%27").replace(/"/g,"%22")}`}catch(S){return console.error("[MOTIF] Error creating data URL:",S),null}},[k]);return _?o.jsxs("g",{className:`motif-element ${e?"motif-element--selected":""}`,transform:b,style:{cursor:"move"},children:[o.jsx("image",{href:_,x:"0",y:"0",width:v,height:x,preserveAspectRatio:"xMidYMid meet",pointerEvents:"none"}),o.jsx("rect",{x:"0",y:"0",width:v,height:x,fill:"transparent",pointerEvents:"all",onMouseDown:r,onTouchStart:s,onDoubleClick:i,style:{cursor:"move"}}),e&&(()=>{const S=ga(n,f||1);return o.jsx("rect",{x:"-10",y:"-10",width:v+20,height:x+20,fill:"none",stroke:"#9333EA",strokeWidth:S.strokeWidth,strokeDasharray:S.dashArray,opacity:"0.7",pointerEvents:"none"})})(),e&&o.jsx(B5,{width:v,height:x,zoom:n,scale:f||1,onScaleStart:a,onRotateStart:l})]}):o.jsxs("g",{transform:b,children:[o.jsx("rect",{x:"0",y:"0",width:v,height:x,fill:"#f0f0f0",stroke:"#ccc",strokeWidth:"50",strokeDasharray:"200 200"}),o.jsx("text",{x:v/2,y:x/2,textAnchor:"middle",dominantBaseline:"middle",fontSize:Math.min(v,x)/10,fill:"#999",children:"Motif Error"})]})}function B5({width:t,height:e,zoom:n,scale:r,onScaleStart:s,onRotateStart:i}){const{size:a,strokeWidth:l,cornerRadius:c}=fa(n,r),d=ma(a),u=[{x:-a/2,y:-a/2,corner:"nw",cursor:"nwse-resize"},{x:t-a/2,y:-a/2,corner:"ne",cursor:"nesw-resize"},{x:-a/2,y:e-a/2,corner:"sw",cursor:"nesw-resize"},{x:t-a/2,y:e-a/2,corner:"se",cursor:"nwse-resize"}];return o.jsxs("g",{className:"motif-handles",children:[u.map(h=>o.jsx("rect",{x:h.x,y:h.y,width:a,height:a,fill:"#9333EA",stroke:"#fff",strokeWidth:l,rx:c,style:{cursor:h.cursor},pointerEvents:"all",onMouseDown:p=>{p.stopPropagation(),s==null||s(p,h.corner)},onTouchStart:p=>{p.stopPropagation(),s==null||s(p,h.corner)}},h.corner)),o.jsx("line",{x1:t/2,y1:0,x2:t/2,y2:-d.distance+d.size/2,stroke:"#9333EA",strokeWidth:d.stemWidth,pointerEvents:"none"}),o.jsx("circle",{cx:t/2,cy:-d.distance,r:d.size,fill:"#9333EA",stroke:"#fff",strokeWidth:l,style:{cursor:"grab"},pointerEvents:"all",onMouseDown:h=>{h.stopPropagation(),i==null||i(h)},onTouchStart:h=>{h.stopPropagation(),i==null||i(h)}}),o.jsx("path",{d:`M ${t/2-d.size*.4} ${-d.distance}
            A ${d.size*.4} ${d.size*.4} 0 1 1
            ${t/2+d.size*.4} ${-d.distance}`,fill:"none",stroke:"#fff",strokeWidth:l*.7,strokeLinecap:"round",pointerEvents:"none"}),o.jsx("polygon",{points:`${t/2+d.size*.4},${-d.distance-d.size*.25}
                 ${t/2+d.size*.4},${-d.distance+d.size*.25}
                 ${t/2+d.size*.65},${-d.distance}`,fill:"#fff",pointerEvents:"none"})]})}function K1(t,e,n,r=0,s=!1,i=.5){if(s&&t>=3)return U5(t,e,n,i,r);if(t>=32)return G5(e,n);const a=H5(t,e,n);return r>0?J1(a,r):`M ${a.map(l=>`${l.x},${l.y}`).join(" L ")} Z`}function H5(t,e,n){if(t===4)return[{x:0,y:0},{x:e,y:0},{x:e,y:n},{x:0,y:n}];const r=[],s=2*Math.PI/t,i=-Math.PI/2;for(let m=0;m<t;m++){const y=i+s*m;r.push({x:Math.cos(y),y:Math.sin(y)})}let a=1/0,l=-1/0,c=1/0,d=-1/0;for(const m of r)a=Math.min(a,m.x),l=Math.max(l,m.x),c=Math.min(c,m.y),d=Math.max(d,m.y);const u=l-a,h=d-c,p=e/u,f=n/h;return r.map(m=>({x:(m.x-a)*p,y:(m.y-c)*f}))}function U5(t,e,n,r=.5,s=0){const i=W5(t,e,n,r);return s>0?J1(i,s):`M ${i.map(a=>`${a.x},${a.y}`).join(" L ")} Z`}function W5(t,e,n,r=.5){const s=[],i=t*2,a=2*Math.PI/i,l=-Math.PI/2,c=Math.max(.1,Math.min(.9,r));for(let x=0;x<i;x++){const g=l+a*x,w=x%2===0?1:c;s.push({x:Math.cos(g)*w,y:Math.sin(g)*w})}let d=1/0,u=-1/0,h=1/0,p=-1/0;for(const x of s)d=Math.min(d,x.x),u=Math.max(u,x.x),h=Math.min(h,x.y),p=Math.max(p,x.y);const f=u-d,m=p-h,y=e/f,v=n/m;return s.map(x=>({x:(x.x-d)*y,y:(x.y-h)*v}))}function G5(t,e){const n=t/2,r=e/2,s=n,i=r;return`M ${s-n},${i} A ${n},${r} 0 1,1 ${s+n},${i} A ${n},${r} 0 1,1 ${s-n},${i} Z`}function J1(t,e,n,r){if(t.length<3)return"";let s=1/0;for(let p=0;p<t.length;p++){const f=t[p],m=t[(p+1)%t.length],y=Math.sqrt(Math.pow(m.x-f.x,2)+Math.pow(m.y-f.y,2));s=Math.min(s,y)}const i=s/2,a=e/100*i;if(a<1)return`M ${t.map(p=>`${p.x},${p.y}`).join(" L ")} Z`;const l=[];for(let p=0;p<t.length;p++){const f=t[(p-1+t.length)%t.length],m=t[p],y=t[(p+1)%t.length],v=uh({x:f.x-m.x,y:f.y-m.y}),x=uh({x:y.x-m.x,y:y.y-m.y}),g={x:m.x+v.x*a,y:m.y+v.y*a},w={x:m.x+x.x*a,y:m.y+x.y*a};p===0?l.push(`M ${g.x},${g.y}`):l.push(`L ${g.x},${g.y}`),l.push(`Q ${m.x},${m.y} ${w.x},${w.y}`)}const c=t[t.length-1],d=t[0],u=uh({x:c.x-d.x,y:c.y-d.y}),h={x:d.x+u.x*a,y:d.y+u.y*a};return l.push(`L ${h.x},${h.y}`),l.push("Z"),l.join(" ")}function uh(t){const e=Math.sqrt(t.x*t.x+t.y*t.y);return e===0?{x:0,y:0}:{x:t.x/e,y:t.y/e}}function V5(t,e=!1){if(e)return t===5?"Star":`${t}-Point Star`;const n={3:"Triangle",4:"Rectangle",5:"Pentagon",6:"Hexagon",7:"Heptagon",8:"Octagon",9:"Nonagon",10:"Decagon",12:"Dodecagon"};return t>=32?"Circle":n[t]?n[t]:`${t}-gon`}function Y5(t,e=!1){return e?"":t>=32?"":t===3?"":t===4?"":t===5?"":t===6?"":`${t}`}function my({shape:t,isSelected:e,zoom:n=1,onMouseDown:r,onTouchStart:s,onDoubleClick:i,onScaleStart:a,onRotateStart:l}){const{sides:c,width_mm:d,height_mm:u,cornerRadius:h,starMode:p,innerRadius:f,position:m,rotation:y,fillColor:v,strokeEnabled:x,strokeColor:g,strokeWidth_mm:w}=t,b=O.useMemo(()=>K1(c,d,u,h,p,f),[c,d,u,h,p,f]),k=d/2,_=u/2,S=`translate(${m.x}, ${m.y}) rotate(${y||0}, ${k}, ${_})`;return o.jsxs("g",{className:`shape-element ${e?"shape-element--selected":""}`,transform:S,style:{cursor:"move"},children:[o.jsx("path",{d:b,fill:(v==null?void 0:v.hex)||"#609B63",stroke:x&&g?g.hex:"none",strokeWidth:x?w:0,pointerEvents:"none"}),o.jsx("path",{d:b,fill:"transparent",stroke:"transparent",strokeWidth:Math.max(w,100),pointerEvents:"all",onMouseDown:r,onTouchStart:s,onDoubleClick:i,style:{cursor:"move"}}),e&&(()=>{const E=ga(n);return o.jsx("rect",{x:"-10",y:"-10",width:d+20,height:u+20,fill:"none",stroke:"#3b82f6",strokeWidth:E.strokeWidth,strokeDasharray:E.dashArray,opacity:"0.7",pointerEvents:"none"})})(),e&&o.jsx(q5,{width:d,height:u,zoom:n,onScaleStart:a,onRotateStart:l})]})}function q5({width:t,height:e,zoom:n,onScaleStart:r,onRotateStart:s}){const{size:i,strokeWidth:a,cornerRadius:l}=fa(n),c=ma(i),d=[{x:t/2-i/2,y:-i/2,corner:"n",cursor:"ns-resize"},{x:t/2-i/2,y:e-i/2,corner:"s",cursor:"ns-resize"},{x:t-i/2,y:e/2-i/2,corner:"e",cursor:"ew-resize"},{x:-i/2,y:e/2-i/2,corner:"w",cursor:"ew-resize"}];return o.jsxs("g",{className:"shape-handles",children:[d.map(u=>o.jsx("rect",{x:u.x,y:u.y,width:i,height:i,fill:"#3b82f6",stroke:"#fff",strokeWidth:a,rx:l,style:{cursor:u.cursor},pointerEvents:"all",onMouseDown:h=>{h.stopPropagation(),r==null||r(h,u.corner)},onTouchStart:h=>{h.stopPropagation(),r==null||r(h,u.corner)}},u.corner)),o.jsx("line",{x1:t/2,y1:0,x2:t/2,y2:-c.distance+c.size/2,stroke:"#3b82f6",strokeWidth:c.stemWidth,pointerEvents:"none"}),o.jsx("circle",{cx:t/2,cy:-c.distance,r:c.size,fill:"#3b82f6",stroke:"#fff",strokeWidth:a,style:{cursor:"grab"},pointerEvents:"all",onMouseDown:u=>{u.stopPropagation(),s==null||s(u)},onTouchStart:u=>{u.stopPropagation(),s==null||s(u)}}),o.jsx("path",{d:`M ${t/2-c.size*.4} ${-c.distance}
            A ${c.size*.4} ${c.size*.4} 0 1 1
            ${t/2+c.size*.4} ${-c.distance}`,fill:"none",stroke:"#fff",strokeWidth:a*.7,strokeLinecap:"round",pointerEvents:"none"}),o.jsx("polygon",{points:`${t/2+c.size*.4},${-c.distance-c.size*.25}
                 ${t/2+c.size*.4},${-c.distance+c.size*.25}
                 ${t/2+c.size*.65},${-c.distance}`,fill:"#fff",pointerEvents:"none"})]})}function Q1({controlPoints:t,width:e,height:n,zoom:r=1,onPointDrag:s,onHandleDrag:i,onDragEnd:a,showHandles:l=!0,selectedPointIndex:c,onPointSelect:d,onPointDelete:u}){const[h,p]=O.useState(null),[f,m]=O.useState(null),{pointSize:y,handleSize:v,strokeWidth:x}=F5(r),g=O.useCallback((k,_)=>{k.stopPropagation(),k.preventDefault(),d==null||d(_),p({type:"point",index:_}),m({x:k.clientX,y:k.clientY})},[d]),w=O.useCallback((k,_)=>{k.preventDefault(),k.stopPropagation(),u==null||u(_)},[u]),b=O.useCallback((k,_,S)=>{k.stopPropagation(),k.preventDefault(),p({type:"handle",index:_,handleType:S}),m({x:k.clientX,y:k.clientY})},[]);return O.useEffect(()=>{if(!h)return;const k=S=>{if(!f)return;const E=document.querySelector(".court-canvas__svg");if(!E)return;const T=E.getBoundingClientRect(),R=E.viewBox.baseVal,W=R.width/T.width,P=R.height/T.height,I=(S.clientX-f.x)*W,C=(S.clientY-f.y)*P;if(h.type==="point"){const $=t[h.index],fe=$.x+I/e,V=$.y+C/n;s==null||s(h.index,fe,V)}else if(h.type==="handle"){const fe=t[h.index][h.handleType],V=fe.x+I/e,K=fe.y+C/n;i==null||i(h.index,h.handleType,V,K)}m({x:S.clientX,y:S.clientY})},_=()=>{p(null),m(null),a==null||a()};return window.addEventListener("mousemove",k),window.addEventListener("mouseup",_),()=>{window.removeEventListener("mousemove",k),window.removeEventListener("mouseup",_)}},[h,f,t,e,n,s,i,a]),!t||t.length===0?null:o.jsx("g",{className:"blob-edit-handles",children:t.map((k,_)=>{const S=k.x*e,E=k.y*n,T=S+k.handleIn.x*e,R=E+k.handleIn.y*n,W=S+k.handleOut.x*e,P=E+k.handleOut.y*n,I=(h==null?void 0:h.type)==="point"&&(h==null?void 0:h.index)===_,C=(h==null?void 0:h.type)==="handle"&&(h==null?void 0:h.index)===_&&(h==null?void 0:h.handleType)==="handleIn",$=(h==null?void 0:h.type)==="handle"&&(h==null?void 0:h.index)===_&&(h==null?void 0:h.handleType)==="handleOut",fe=c===_;return o.jsxs("g",{className:"blob-control-point-group",children:[l&&o.jsxs(o.Fragment,{children:[o.jsx("line",{x1:S,y1:E,x2:T,y2:R,stroke:"#94a3b8",strokeWidth:x,strokeDasharray:`${x*3} ${x*2}`,pointerEvents:"none",opacity:"0.8"}),o.jsx("line",{x1:S,y1:E,x2:W,y2:P,stroke:"#94a3b8",strokeWidth:x,strokeDasharray:`${x*3} ${x*2}`,pointerEvents:"none",opacity:"0.8"}),o.jsx("circle",{cx:T,cy:R,r:v,fill:C?"#f97316":"#ffffff",stroke:"#64748b",strokeWidth:x,style:{cursor:"crosshair"},pointerEvents:"all",onMouseDown:V=>b(V,_,"handleIn")}),o.jsx("circle",{cx:W,cy:P,r:v,fill:$?"#f97316":"#ffffff",stroke:"#64748b",strokeWidth:x,style:{cursor:"crosshair"},pointerEvents:"all",onMouseDown:V=>b(V,_,"handleOut")})]}),o.jsx("circle",{cx:S,cy:E,r:y,fill:fe?"#ef4444":I?"#f97316":"#3b82f6",stroke:"#ffffff",strokeWidth:x*1.3,style:{cursor:"move"},pointerEvents:"all",onMouseDown:V=>g(V,_),onContextMenu:V=>w(V,_)}),o.jsx("text",{x:S,y:E+y*.35,textAnchor:"middle",fontSize:y*.8,fill:"#ffffff",fontWeight:"bold",pointerEvents:"none",children:_+1})]},_)})})}function gy({shape:t,isSelected:e,zoom:n=1,onMouseDown:r,onTouchStart:s,onDoubleClick:i,onScaleStart:a,onRotateStart:l,onPointDrag:c,onHandleDrag:d,onDragEnd:u,selectedPointIndex:h,onPointSelect:p,onPointDelete:f}){const{controlPoints:m,width_mm:y,height_mm:v,position:x,rotation:g,fillColor:w,strokeEnabled:b,strokeColor:k,strokeWidth_mm:_,editPointsVisible:S}=t,E=O.useMemo(()=>i5(m,y,v),[m,y,v]),T=y/2,R=v/2,W=`translate(${x.x}, ${x.y}) rotate(${g||0}, ${T}, ${R})`;return o.jsxs("g",{className:`blob-element ${e?"blob-element--selected":""}`,transform:W,style:{cursor:"move"},children:[o.jsx("path",{d:E,fill:(w==null?void 0:w.hex)||"#609B63",stroke:b&&k?k.hex:"none",strokeWidth:b?_:0,pointerEvents:"none"}),o.jsx("path",{d:E,fill:"transparent",stroke:"transparent",strokeWidth:Math.max(_||0,100),pointerEvents:"all",onTouchStart:s,onMouseDown:r,onDoubleClick:i,style:{cursor:"move"}}),e&&(()=>{const P=ga(n);return o.jsx("rect",{x:"-10",y:"-10",width:y+20,height:v+20,fill:"none",stroke:"#3b82f6",strokeWidth:P.strokeWidth,strokeDasharray:P.dashArray,opacity:"0.7",pointerEvents:"none"})})(),e&&o.jsx(X5,{width:y,height:v,zoom:n,onScaleStart:a,onRotateStart:l}),e&&m&&S&&o.jsx(Q1,{controlPoints:m,width:y,height:v,zoom:n,onPointDrag:c,onHandleDrag:d,onDragEnd:u,showHandles:!0,selectedPointIndex:h,onPointSelect:p,onPointDelete:f})]})}function X5({width:t,height:e,zoom:n,onScaleStart:r,onRotateStart:s}){const{size:i,strokeWidth:a,cornerRadius:l}=fa(n),c=ma(i),d=[{x:-i/2,y:-i/2,corner:"nw",cursor:"nwse-resize"},{x:t-i/2,y:-i/2,corner:"ne",cursor:"nesw-resize"},{x:-i/2,y:e-i/2,corner:"sw",cursor:"nesw-resize"},{x:t-i/2,y:e-i/2,corner:"se",cursor:"nwse-resize"}];return o.jsxs("g",{className:"blob-resize-handles",children:[d.map(u=>o.jsx("rect",{x:u.x,y:u.y,width:i,height:i,fill:"#3b82f6",stroke:"#fff",strokeWidth:a,rx:l,style:{cursor:u.cursor},pointerEvents:"all",onMouseDown:h=>{h.stopPropagation(),r==null||r(h,u.corner)},onTouchStart:h=>{h.stopPropagation(),r==null||r(h,u.corner)}},u.corner)),o.jsx("line",{x1:t/2,y1:0,x2:t/2,y2:-c.distance+c.size/2,stroke:"#3b82f6",strokeWidth:c.stemWidth,pointerEvents:"none"}),o.jsx("circle",{cx:t/2,cy:-c.distance,r:c.size,fill:"#3b82f6",stroke:"#fff",strokeWidth:a,style:{cursor:"grab"},pointerEvents:"all",onMouseDown:u=>{u.stopPropagation(),s==null||s(u)},onTouchStart:u=>{u.stopPropagation(),s==null||s(u)}}),o.jsx("path",{d:`M ${t/2-c.size*.4} ${-c.distance}
            A ${c.size*.4} ${c.size*.4} 0 1 1
            ${t/2+c.size*.4} ${-c.distance}`,fill:"none",stroke:"#fff",strokeWidth:a*.7,strokeLinecap:"round",pointerEvents:"none"}),o.jsx("polygon",{points:`${t/2+c.size*.4},${-c.distance-c.size*.25}
                 ${t/2+c.size*.4},${-c.distance+c.size*.25}
                 ${t/2+c.size*.65},${-c.distance}`,fill:"#fff",pointerEvents:"none"})]})}function yy({shape:t,isSelected:e,onMouseDown:n,onTouchStart:r,onDoubleClick:s,onScaleStart:i,onRotateStart:a,onPointDrag:l,onHandleDrag:c,onDragEnd:d,selectedPointIndex:u,onPointSelect:h,onPointDelete:p}){const{controlPoints:f,width_mm:m,height_mm:y,position:v,rotation:x,fillColor:g,strokeEnabled:w,strokeColor:b,strokeWidth_mm:k,editPointsVisible:_,closed:S,smooth:E}=t,T=O.useMemo(()=>!f||f.length<2?"":G1(f,m,y,S,E),[f,m,y,S,E]),R=m/2,W=y/2,P=`translate(${v.x}, ${v.y}) rotate(${x||0}, ${R}, ${W})`;return T?o.jsxs("g",{className:`path-element ${e?"path-element--selected":""}`,transform:P,style:{cursor:"move"},children:[o.jsx("path",{d:T,fill:S?(g==null?void 0:g.hex)||"#609B63":"none",stroke:w&&b?b.hex:S?"none":(g==null?void 0:g.hex)||"#609B63",strokeWidth:w?k:S?0:50,strokeLinecap:"round",strokeLinejoin:"round",pointerEvents:"none"}),o.jsx("path",{d:T,fill:"transparent",stroke:"transparent",strokeWidth:Math.max(k||0,200),pointerEvents:"all",onTouchStart:r,onMouseDown:n,onDoubleClick:s,style:{cursor:"move"}}),e&&o.jsx("rect",{x:"-10",y:"-10",width:m+20,height:y+20,fill:"none",stroke:"#3b82f6",strokeWidth:"80",strokeDasharray:"400 400",opacity:"0.7",pointerEvents:"none"}),e&&o.jsx(Z5,{width:m,height:y,onScaleStart:i,onRotateStart:a}),e&&f&&_&&o.jsx(Q1,{controlPoints:f,width:m,height:y,onPointDrag:l,onHandleDrag:c,onDragEnd:d,showHandles:E,selectedPointIndex:u,onPointSelect:h,onPointDelete:p})]}):null}function Z5({width:t,height:e,onScaleStart:n,onRotateStart:r}){const s=Math.min(t,e)*.08,l=Math.max(150,Math.min(400,s)),c=[{x:-l/2,y:-l/2,corner:"nw",cursor:"nwse-resize"},{x:t-l/2,y:-l/2,corner:"ne",cursor:"nesw-resize"},{x:-l/2,y:e-l/2,corner:"sw",cursor:"nesw-resize"},{x:t-l/2,y:e-l/2,corner:"se",cursor:"nwse-resize"}],d=l*2.5,u=l*.8;return o.jsxs("g",{className:"path-resize-handles",children:[c.map(h=>o.jsx("rect",{x:h.x,y:h.y,width:l,height:l,fill:"#3b82f6",stroke:"#fff",strokeWidth:"20",rx:l/4,style:{cursor:h.cursor},pointerEvents:"all",onMouseDown:p=>{p.stopPropagation(),n==null||n(p,h.corner)},onTouchStart:p=>{p.stopPropagation(),n==null||n(p,h.corner)}},h.corner)),o.jsx("line",{x1:t/2,y1:0,x2:t/2,y2:-d+u/2,stroke:"#3b82f6",strokeWidth:"30",pointerEvents:"none"}),o.jsx("circle",{cx:t/2,cy:-d,r:u,fill:"#3b82f6",stroke:"#fff",strokeWidth:"20",style:{cursor:"grab"},pointerEvents:"all",onMouseDown:h=>{h.stopPropagation(),r==null||r(h)},onTouchStart:h=>{h.stopPropagation(),r==null||r(h)}}),o.jsx("path",{d:`M ${t/2-u*.4} ${-d}
            A ${u*.4} ${u*.4} 0 1 1
            ${t/2+u*.4} ${-d}`,fill:"none",stroke:"#fff",strokeWidth:"25",strokeLinecap:"round",pointerEvents:"none"}),o.jsx("polygon",{points:`${t/2+u*.4},${-d-u*.25}
                 ${t/2+u*.4},${-d+u*.25}
                 ${t/2+u*.65},${-d}`,fill:"#fff",pointerEvents:"none"})]})}function Ps(t,e,n,r="normal",s="normal"){Ps._canvas||(Ps._canvas=document.createElement("canvas"),Ps._ctx=Ps._canvas.getContext("2d"));const i=Ps._ctx,a=s==="italic"?"italic ":"",l=r==="bold"?"bold ":"";i.font=`${a}${l}${n}px ${e}`;const c=i.measureText(t||"Double-click to edit");return{width:Math.max(c.width,100),height:n*1.2}}function K5(){return[{name:"Open Sans",family:"Open Sans, sans-serif"},{name:"Roboto",family:"Roboto, sans-serif"},{name:"Montserrat",family:"Montserrat, sans-serif"},{name:"Oswald",family:"Oswald, sans-serif"},{name:"Black Ops One",family:"Black Ops One, sans-serif"},{name:"Playfair Display",family:"Playfair Display, serif"},{name:"Arial",family:"Arial, sans-serif"},{name:"Georgia",family:"Georgia, serif"},{name:"Impact",family:"Impact, sans-serif"}]}const J5=500,hs=40;function xy({text:t,isSelected:e,zoom:n=1,onMouseDown:r,onTouchStart:s,onDoubleClick:i,onScaleStart:a,onRotateStart:l}){const{content:c,fontFamily:d,fontSize_mm:u,scale_x:h=1,scale_y:p=1,fontWeight:f,fontStyle:m,textAlign:y,position:v,rotation:x,fillColor:g,strokeColor:w,strokeWidth_mm:b}=t,k=u||J5,_=O.useMemo(()=>Ps(c||"Text",d,k,f,m),[c,d,k,f,m]);O.useMemo(()=>({width:_.width*h,height:k*1.2*p}),[_.width,k,h,p]);const S=O.useMemo(()=>{switch(y){case"center":return-_.width/2;case"right":return-_.width;default:return 0}},[y,_.width]),E=`translate(${v.x}, ${v.y}) rotate(${x||0}) scale(${h}, ${p})`,T=c||"Text",R=ga(n,Math.max(h,p));return o.jsxs("g",{className:`text-element ${e?"text-element--selected":""}`,transform:E,children:[o.jsx("text",{x:"0",y:"0",fontFamily:d,fontSize:k,fontWeight:f,fontStyle:m,textAnchor:y==="center"?"middle":y==="right"?"end":"start",fill:(g==null?void 0:g.hex)||"#1C1C1C",stroke:(w==null?void 0:w.hex)||"none",strokeWidth:b||0,strokeLinejoin:"round",strokeLinecap:"round",paintOrder:"stroke fill",style:{cursor:"move",userSelect:"none"},pointerEvents:"none",children:T}),o.jsx("rect",{x:S-hs/2,y:-k*.85,width:_.width+hs,height:k*1.2,fill:"transparent",pointerEvents:"all",onMouseDown:r,onTouchStart:s,onDoubleClick:i,style:{cursor:"move"}}),e&&o.jsx("rect",{x:S-hs,y:-k-hs,width:_.width+hs*2,height:k*1.2+hs*2,fill:"none",stroke:"#3b82f6",strokeWidth:R.strokeWidth,strokeDasharray:R.dashArray,opacity:"0.7",pointerEvents:"none"}),e&&o.jsx(Q5,{bounds:_,fontSize:k,alignOffset:S,scale_x:h,scale_y:p,zoom:n,onScaleStart:a,onRotateStart:l})]})}function Q5({bounds:t,fontSize:e,alignOffset:n,scale_x:r,scale_y:s,zoom:i,onScaleStart:a,onRotateStart:l}){const c=Math.max(r,s),{size:d,strokeWidth:u,cornerRadius:h}=fa(i,c),p=ma(d),f=n-hs,m=-e-hs,y=t.width+hs*2,v=e*1.2+hs*2,x=[{x:f-d/2,y:m-d/2,corner:"nw",cursor:"nwse-resize"},{x:f+y-d/2,y:m-d/2,corner:"ne",cursor:"nesw-resize"},{x:f-d/2,y:m+v-d/2,corner:"sw",cursor:"nesw-resize"},{x:f+y-d/2,y:m+v-d/2,corner:"se",cursor:"nwse-resize"}],g=f+y/2;return o.jsxs("g",{className:"text-handles",children:[x.map(w=>o.jsx("rect",{x:w.x,y:w.y,width:d,height:d,fill:"#3b82f6",stroke:"#fff",strokeWidth:u,rx:h,style:{cursor:w.cursor},pointerEvents:"all",onMouseDown:b=>{b.stopPropagation(),a==null||a(b,w.corner)},onTouchStart:b=>{b.stopPropagation(),a==null||a(b,w.corner)}},w.corner)),o.jsx("line",{x1:g,y1:m,x2:g,y2:m-p.distance+p.size/2,stroke:"#3b82f6",strokeWidth:p.stemWidth,pointerEvents:"none"}),o.jsx("circle",{cx:g,cy:m-p.distance,r:p.size,fill:"#3b82f6",stroke:"#fff",strokeWidth:u,style:{cursor:"grab"},pointerEvents:"all",onMouseDown:w=>{w.stopPropagation(),l==null||l(w)},onTouchStart:w=>{w.stopPropagation(),l==null||l(w)}}),o.jsx("path",{d:`M ${g-p.size*.4} ${m-p.distance}
            A ${p.size*.4} ${p.size*.4} 0 1 1
            ${g+p.size*.4} ${m-p.distance}`,fill:"none",stroke:"#fff",strokeWidth:u*.7,strokeLinecap:"round",pointerEvents:"none"}),o.jsx("polygon",{points:`${g+p.size*.4},${m-p.distance-p.size*.25}
                 ${g+p.size*.4},${m-p.distance+p.size*.25}
                 ${g+p.size*.65},${m-p.distance}`,fill:"#fff",pointerEvents:"none"})]})}function eT({zone:t,isSelected:e,zoom:n=1,onMouseDown:r,onTouchStart:s,onDoubleClick:i,onScaleStart:a,onRotateStart:l}){const{id:c,shapeType:d,sides:u,width_mm:h,height_mm:p,cornerRadius:f,position:m,rotation:y,controlPoints:v}=t,x=`exclusion-crosshatch-${c}`,g=O.useMemo(()=>d==="path"&&v?G1(v,h,p,!0):K1(u||4,h,p,f||0),[d,u,h,p,f,v]),w=h/2,b=p/2,k=`translate(${m.x}, ${m.y}) rotate(${y||0}, ${w}, ${b})`,_=Math.min(h,p)*.02,T=Math.max(100,Math.min(500,_)),R=T*.15;return o.jsxs("g",{className:`exclusion-zone-element ${e?"exclusion-zone-element--selected":""}`,transform:k,style:{cursor:"move"},children:[o.jsx("defs",{children:o.jsxs("pattern",{id:x,patternUnits:"userSpaceOnUse",width:T,height:T,patternTransform:"rotate(45)",children:[o.jsx("rect",{width:T,height:T,fill:"#e5e5e5"}),o.jsx("line",{x1:"0",y1:"0",x2:"0",y2:T,stroke:"#999",strokeWidth:R}),o.jsx("line",{x1:T/2,y1:"0",x2:T/2,y2:T,stroke:"#999",strokeWidth:R})]})}),o.jsx("path",{d:g,fill:`url(#${x})`,stroke:"#666",strokeWidth:"60",strokeDasharray:"200 100",pointerEvents:"none"}),o.jsx("path",{d:g,fill:"transparent",stroke:"transparent",strokeWidth:"200",pointerEvents:"all",onMouseDown:r,onTouchStart:s,onDoubleClick:i,style:{cursor:"move"}}),e&&(()=>{const W=ga(n);return o.jsx("rect",{x:"-10",y:"-10",width:h+20,height:p+20,fill:"none",stroke:"#ef4444",strokeWidth:W.strokeWidth,strokeDasharray:W.dashArray,opacity:"0.7",pointerEvents:"none"})})(),e&&o.jsx(tT,{width:h,height:p,zoom:n,onScaleStart:a,onRotateStart:l})]})}function tT({width:t,height:e,zoom:n,onScaleStart:r,onRotateStart:s}){const{size:i,strokeWidth:a,cornerRadius:l}=fa(n),c=ma(i),d=[{x:t/2-i/2,y:-i/2,corner:"n",cursor:"ns-resize"},{x:t/2-i/2,y:e-i/2,corner:"s",cursor:"ns-resize"},{x:t-i/2,y:e/2-i/2,corner:"e",cursor:"ew-resize"},{x:-i/2,y:e/2-i/2,corner:"w",cursor:"ew-resize"}];return o.jsxs("g",{className:"exclusion-zone-handles",children:[d.map(u=>o.jsx("rect",{x:u.x,y:u.y,width:i,height:i,fill:"#ef4444",stroke:"#fff",strokeWidth:a,rx:l,style:{cursor:u.cursor},pointerEvents:"all",onMouseDown:h=>{h.stopPropagation(),r==null||r(h,u.corner)},onTouchStart:h=>{h.stopPropagation(),r==null||r(h,u.corner)}},u.corner)),o.jsx("line",{x1:t/2,y1:0,x2:t/2,y2:-c.distance+c.size/2,stroke:"#ef4444",strokeWidth:c.stemWidth,pointerEvents:"none"}),o.jsx("circle",{cx:t/2,cy:-c.distance,r:c.size,fill:"#ef4444",stroke:"#fff",strokeWidth:a,style:{cursor:"grab"},pointerEvents:"all",onMouseDown:u=>{u.stopPropagation(),s==null||s(u)},onTouchStart:u=>{u.stopPropagation(),s==null||s(u)}}),o.jsx("path",{d:`M ${t/2-c.size*.4} ${-c.distance}
            A ${c.size*.4} ${c.size*.4} 0 1 1
            ${t/2+c.size*.4} ${-c.distance}`,fill:"none",stroke:"#fff",strokeWidth:a*.7,strokeLinecap:"round",pointerEvents:"none"}),o.jsx("polygon",{points:`${t/2+c.size*.4},${-c.distance-c.size*.25}
                 ${t/2+c.size*.4},${-c.distance+c.size*.25}
                 ${t/2+c.size*.65},${-c.distance}`,fill:"#fff",pointerEvents:"none"})]})}function nT({groupId:t,zoom:e=1,onDragStart:n,onScaleStart:r,onRotateStart:s,screenToSVG:i}){const{groups:a,selectedGroupId:l,editingGroupId:c,shapes:d,selectGroup:u,enterGroup:h,updateGroupPosition:p,commitGroupMove:f}=at(),m=a[t];if(!m||!m.bounds||c===t)return null;const y=l===t,{x:v,y:x,width:g,height:w}=m.bounds,{size:b,strokeWidth:k,cornerRadius:_}=fa(e),S=ma(b),E=b/2,T=ga(e),R=b*.8,W=$=>{if($.stopPropagation(),u(t),!m.locked&&n&&i){const fe=$.touches?$.touches[0].clientX:$.clientX,V=$.touches?$.touches[0].clientY:$.clientY,K=i(fe,V);n(t,{x:K.x-m.bounds.x,y:K.y-m.bounds.y})}},P=$=>{$.stopPropagation(),h(t)},I=($,fe)=>{$.stopPropagation(),r&&r($,t,fe)},C=$=>{$.stopPropagation(),s&&s($,t)};return m.childIds.map($=>d[$]).filter(Boolean),o.jsxs("g",{className:"group-element",children:[o.jsx("rect",{x:v,y:x,width:g,height:w,fill:"transparent",stroke:y?"#9333ea":"#a855f7",strokeWidth:y?T.strokeWidth:T.strokeWidth*.5,strokeDasharray:y?"none":T.dashArray,rx:_,ry:_,style:{cursor:"move"},onMouseDown:W,onTouchStart:W,onDoubleClick:P}),!y&&o.jsx("text",{x:v+k,y:x-k,fontSize:R,fill:"#9333ea",fontFamily:"system-ui, -apple-system, sans-serif",fontWeight:"500",children:m.compoundType?`${m.compoundType.charAt(0).toUpperCase()+m.compoundType.slice(1)} Group`:m.customName||"Group"}),y&&o.jsxs(o.Fragment,{children:[o.jsx("rect",{x:v-E,y:x-E,width:b,height:b,fill:"white",stroke:"#9333ea",strokeWidth:k,rx:_,style:{cursor:"nwse-resize"},onMouseDown:$=>I($,"nw"),onTouchStart:$=>I($,"nw")}),o.jsx("rect",{x:v+g-E,y:x-E,width:b,height:b,fill:"white",stroke:"#9333ea",strokeWidth:k,rx:_,style:{cursor:"nesw-resize"},onMouseDown:$=>I($,"ne"),onTouchStart:$=>I($,"ne")}),o.jsx("rect",{x:v-E,y:x+w-E,width:b,height:b,fill:"white",stroke:"#9333ea",strokeWidth:k,rx:_,style:{cursor:"nesw-resize"},onMouseDown:$=>I($,"sw"),onTouchStart:$=>I($,"sw")}),o.jsx("rect",{x:v+g-E,y:x+w-E,width:b,height:b,fill:"white",stroke:"#9333ea",strokeWidth:k,rx:_,style:{cursor:"nwse-resize"},onMouseDown:$=>I($,"se"),onTouchStart:$=>I($,"se")}),o.jsx("rect",{x:v+g/2-E,y:x-E,width:b,height:b,fill:"white",stroke:"#9333ea",strokeWidth:k,rx:_,style:{cursor:"ns-resize"},onMouseDown:$=>I($,"n"),onTouchStart:$=>I($,"n")}),o.jsx("rect",{x:v+g/2-E,y:x+w-E,width:b,height:b,fill:"white",stroke:"#9333ea",strokeWidth:k,rx:_,style:{cursor:"ns-resize"},onMouseDown:$=>I($,"s"),onTouchStart:$=>I($,"s")}),o.jsx("rect",{x:v-E,y:x+w/2-E,width:b,height:b,fill:"white",stroke:"#9333ea",strokeWidth:k,rx:_,style:{cursor:"ew-resize"},onMouseDown:$=>I($,"w"),onTouchStart:$=>I($,"w")}),o.jsx("rect",{x:v+g-E,y:x+w/2-E,width:b,height:b,fill:"white",stroke:"#9333ea",strokeWidth:k,rx:_,style:{cursor:"ew-resize"},onMouseDown:$=>I($,"e"),onTouchStart:$=>I($,"e")}),o.jsx("line",{x1:v+g/2,y1:x,x2:v+g/2,y2:x-S.distance+S.size/2,stroke:"#9333ea",strokeWidth:S.stemWidth}),o.jsx("circle",{cx:v+g/2,cy:x-S.distance,r:S.size,fill:"white",stroke:"#9333ea",strokeWidth:k,style:{cursor:"grab"},onMouseDown:C,onTouchStart:C}),o.jsx("text",{x:v+g/2,y:x-S.distance-b-R*.5,fontSize:R,fill:"#9333ea",fontFamily:"system-ui, -apple-system, sans-serif",fontWeight:"600",textAnchor:"middle",children:m.compoundType?`${m.compoundType.charAt(0).toUpperCase()+m.compoundType.slice(1)}`:m.customName||"Group"}),o.jsxs("g",{transform:`translate(${v+g+E}, ${x-E})`,children:[o.jsx("circle",{cx:0,cy:0,r:E,fill:"#9333ea"}),o.jsx("text",{x:0,y:0,fontSize:R*.7,fill:"white",fontFamily:"system-ui, -apple-system, sans-serif",fontWeight:"600",textAnchor:"middle",dominantBaseline:"central",children:m.childIds.length})]})]})]})}function vy(t,e,n){if(!t||t.type==="rectangle"||!t.controlPoints)return null;const r=t.controlPoints;if(!r||r.length<3)return null;const s=r.map(a=>({x:a.x*e,y:a.y*n}));let i=`M ${s[0].x} ${s[0].y}`;for(let a=1;a<s.length;a++)i+=` L ${s[a].x} ${s[a].y}`;return i+=" Z",i}const rT=O.forwardRef(function(e,n){var hg,pg;const r=O.useRef(null),s=O.useRef(null);O.useImperativeHandle(n,()=>r.current);const[i,a]=O.useState(1),[l,c]=O.useState({x:0,y:0}),[d,u]=O.useState(!1),[h,p]=O.useState({x:0,y:0}),[f,m]=O.useState(!1),[y,v]=O.useState({active:!1,initialDistance:0,initialZoom:1,initialPan:{x:0,y:0},initialCenter:{x:0,y:0}}),[x,g]=O.useState(!1),[w,b]=O.useState(null),[k,_]=O.useState(null),[S,E]=O.useState(null),[T,R]=O.useState(null),[W,P]=O.useState(null),[I,C]=O.useState(null),[$,fe]=O.useState(null),[V,K]=O.useState(null),F=O.useRef(null),[Z,U]=O.useState(null),X=O.useRef(null),ge=O.useRef(0),[de,Q]=O.useState(!1),[ke,Oe]=O.useState(null),[De,Be]=O.useState(null),[Ge,He]=O.useState(!1),[Xe,nt]=O.useState(null),[j,ne]=O.useState(null),[oe,z]=O.useState(!1),[A,M]=O.useState(null),[G,ie]=O.useState(null),[Y,se]=O.useState(!1),[we,ue]=O.useState(null),[q,le]=O.useState(null),[be,Ne]=O.useState(!1),[ze,Pe]=O.useState(null),[te,pe]=O.useState(null),[qe,st]=O.useState(!1),[rt,wt]=O.useState(null),[ct,Ze]=O.useState(null),[ce,ee]=O.useState(!1),[ve,Ve]=O.useState(null),[ot,Ee]=O.useState(null),[St,ht]=O.useState(!1),[Pt,Ke]=O.useState(null),[Kt,zn]=O.useState(null),[$r,wr]=O.useState(!1),[Dr,ss]=O.useState(null),[Lr,_r]=O.useState(null),[is,$t]=O.useState(!1),[kr,jt]=O.useState(null),[Ir,_t]=O.useState(null),[he,Ie]=O.useState(null),[Ct,Cn]=O.useState(0),[Bt,En]=O.useState(null),{surface:vt,courts:Dt,tracks:an,motifs:Rt,shapes:Ot,texts:Mt,exclusionZones:sn,elementOrder:Vn,selectedCourtId:sr,selectedTrackId:vs,selectedMotifId:bs,selectedShapeId:Tn,selectedTextId:os,selectedExclusionZoneId:zr,snapToGrid:Yn,gridSize_mm:qn,selectCourt:Sr,deselectCourt:Hs,selectTrack:ws,deselectTrack:_s,selectMotif:ks,deselectMotif:as,selectShape:Fr,deselectShape:Nn,selectText:ir,deselectText:ls,selectExclusionZone:xn,deselectExclusionZone:Pn,updateCourtPosition:ln,updateTrackPosition:or,updateMotifPosition:jr,updateMotifScale:Xn,updateMotifRotation:Us,updateShapePosition:Ss,updateShapeDimensions:Nt,updateShapeRotation:cn,updateTextPosition:Ht,updateTextScale:Lt,updateTextRotation:Rn,showPropertiesPanel:Ut,setShowPropertiesPanel:to,updateExclusionZonePosition:Ws,updateExclusionZoneDimensions:Fn,updateExclusionZoneRotation:_n,updateBlobControlPoint:Br,updateBlobHandle:bi,commitBlobEdit:js,pathDrawingMode:On,activePathId:re,addPointToPath:Te,finishPath:je,cancelPath:Me,updatePathControlPoint:ft,updatePathHandle:Ye,commitPathEdit:Se,removePointFromPath:H,groups:xe,selectedGroupId:$e,selectedElementIds:Ue,editingGroupId:yt,selectGroup:lt,deselectGroup:mt,enterGroup:gt,exitGroup:Zn,addToSelection:ar,clearMultiSelection:qt,updateGroupPosition:Ea,updateGroupScale:Ta,updateGroupRotation:Km,commitGroupMove:Jm,setZoom:Qm,setInteracting:Jl}=at();O.useEffect(()=>{Qm(i)},[i,Qm]);const no=O.useCallback((N,J)=>!Z||Z.id!==J||!N?N:{...N,position:{x:N.position.x+Z.offset.x,y:N.position.y+Z.offset.y}},[Z]),Tt=O.useCallback((N,J)=>{const L=r.current;if(!L||!L.getScreenCTM())return{x:0,y:0};const B=L.createSVGPoint();B.x=N,B.y=J;const me=L.getScreenCTM();if(!me)return{x:0,y:0};const ye=B.matrixTransform(me.inverse());return{x:ye.x,y:ye.y}},[]),Ql=(N,J)=>{if(N.stopPropagation(),N.shiftKey){ar(J);return}Ue.length>0&&qt(),Sr(J);const B=Dt[J];if(B!=null&&B.locked)return;const me=N.touches?N.touches[0].clientX:N.clientX,ye=N.touches?N.touches[0].clientY:N.clientY,ae=Tt(me,ye);b({x:ae.x-B.position.x,y:ae.y-B.position.y}),_(J),g(!0)},eg=(N,J)=>{N.stopPropagation(),Sr(J),at.setState({showPropertiesPanel:!0,propertiesPanelUserClosed:!1})},ec=(N,J)=>{if(N.stopPropagation(),N.shiftKey){ar(J);return}Ue.length>0&&qt(),ws(J);const B=an[J];if(B!=null&&B.locked)return;const me=N.touches?N.touches[0].clientX:N.clientX,ye=N.touches?N.touches[0].clientY:N.clientY,ae=Tt(me,ye);b({x:ae.x-B.position.x,y:ae.y-B.position.y}),E(J),g(!0)},tg=(N,J)=>{N.stopPropagation(),ws(J),at.setState({showPropertiesPanel:!0,propertiesPanelUserClosed:!1})},tc=(N,J)=>{if(N.stopPropagation(),N.shiftKey){ar(J);return}Ue.length>0&&qt(),ks(J);const B=Rt[J];if(B!=null&&B.locked)return;const me=N.touches?N.touches[0].clientX:N.clientX,ye=N.touches?N.touches[0].clientY:N.clientY,ae=Tt(me,ye);b({x:ae.x-B.position.x,y:ae.y-B.position.y}),R(J),g(!0)},ng=(N,J)=>{N.stopPropagation(),ks(J),at.setState({showPropertiesPanel:!0,propertiesPanelUserClosed:!1})},rg=(N,J,L)=>{N.stopPropagation();const B=Rt[J];if(!B||B.locked)return;const me=N.touches?N.touches[0].clientX:N.clientX,ye=N.touches?N.touches[0].clientY:N.clientY,ae=Tt(me,ye),Ce=B.originalWidth_mm*(B.scale||1),_e=B.originalHeight_mm*(B.scale||1);let Re;switch(L){case"nw":Re={x:B.position.x+Ce,y:B.position.y+_e};break;case"ne":Re={x:B.position.x,y:B.position.y+_e};break;case"sw":Re={x:B.position.x+Ce,y:B.position.y};break;case"se":default:Re={x:B.position.x,y:B.position.y};break}const Fe=Math.sqrt(Math.pow(ae.x-Re.x,2)+Math.pow(ae.y-Re.y,2));Be({initialDistance:Fe,originalScale:B.scale||1,originalWidth:Ce,originalHeight:_e,corner:L,anchorPoint:Re}),Oe(J),Q(!0)},sg=(N,J)=>{N.stopPropagation();const L=Rt[J];if(!L||L.locked)return;const B=N.touches?N.touches[0].clientX:N.clientX,me=N.touches?N.touches[0].clientY:N.clientY,ye=Tt(B,me),ae=L.originalWidth_mm*(L.scale||1),Ce=L.originalHeight_mm*(L.scale||1),_e={x:L.position.x+ae/2,y:L.position.y+Ce/2},Re=Math.atan2(ye.y-_e.y,ye.x-_e.x)*(180/Math.PI);ne({initialAngle:Re,originalRotation:L.rotation||0,motifCenter:_e}),nt(J),He(!0)},ig=N=>{for(const[J,L]of Object.entries(xe))if(L.childIds.includes(N))return J;return null},D2=ig,Cr=(N,J)=>{N.stopPropagation();const L=D2(J);if(L&&yt!==L){lt(L);const _e=xe[L];if(_e!=null&&_e.locked)return;const Re=N.touches?N.touches[0].clientX:N.clientX,Fe=N.touches?N.touches[0].clientY:N.clientY,dt=Tt(Re,Fe);b({x:dt.x-_e.bounds.x,y:dt.y-_e.bounds.y}),K(L),g(!0);return}if(N.shiftKey){ar(J);return}Ue.length>0&&qt(),Fr(J);const me=Ot[J];if(me!=null&&me.locked)return;const ye=N.touches?N.touches[0].clientX:N.clientX,ae=N.touches?N.touches[0].clientY:N.clientY,Ce=Tt(ye,ae);b({x:Ce.x-me.position.x,y:Ce.y-me.position.y}),P(J),g(!0)},ro=(N,J)=>{N.stopPropagation(),Fr(J),at.setState({showPropertiesPanel:!0,propertiesPanelUserClosed:!1})},so=(N,J,L)=>{N.stopPropagation();const B=Ot[J];if(!B||B.locked)return;const me=N.touches?N.touches[0].clientX:N.clientX,ye=N.touches?N.touches[0].clientY:N.clientY,ae=Tt(me,ye),{width_mm:Ce,height_mm:_e}=B;let Re;switch(L){case"n":Re={x:B.position.x+Ce/2,y:B.position.y+_e};break;case"s":Re={x:B.position.x+Ce/2,y:B.position.y};break;case"e":Re={x:B.position.x,y:B.position.y+_e/2};break;case"w":Re={x:B.position.x+Ce,y:B.position.y+_e/2};break;case"nw":Re={x:B.position.x+Ce,y:B.position.y+_e};break;case"ne":Re={x:B.position.x,y:B.position.y+_e};break;case"sw":Re={x:B.position.x+Ce,y:B.position.y};break;case"se":default:Re={x:B.position.x,y:B.position.y};break}const Fe=Math.sqrt(Math.pow(ae.x-Re.x,2)+Math.pow(ae.y-Re.y,2));ie({initialDistance:Fe,originalWidth:Ce,originalHeight:_e,aspectLocked:B.aspectLocked,corner:L,anchorPoint:Re}),M(J),z(!0)},io=(N,J)=>{N.stopPropagation();const L=Ot[J];if(!L||L.locked)return;const B=N.touches?N.touches[0].clientX:N.clientX,me=N.touches?N.touches[0].clientY:N.clientY,ye=Tt(B,me),{width_mm:ae,height_mm:Ce}=L,_e={x:L.position.x+ae/2,y:L.position.y+Ce/2},Re=Math.atan2(ye.y-_e.y,ye.x-_e.x)*(180/Math.PI);le({initialAngle:Re,originalRotation:L.rotation||0,shapeCenter:_e}),ue(J),se(!0)},nc=(N,J)=>{N.stopPropagation();const L=ig(J);if(L&&yt!==L){lt(L);const _e=xe[L];if(_e!=null&&_e.locked)return;const Re=N.touches?N.touches[0].clientX:N.clientX,Fe=N.touches?N.touches[0].clientY:N.clientY,dt=Tt(Re,Fe);b({x:dt.x-_e.bounds.x,y:dt.y-_e.bounds.y}),K(L),g(!0);return}if(N.shiftKey){ar(J);return}Ue.length>0&&qt(),ir(J);const me=Mt[J];if(me!=null&&me.locked)return;const ye=N.touches?N.touches[0].clientX:N.clientX,ae=N.touches?N.touches[0].clientY:N.clientY,Ce=Tt(ye,ae);b({x:Ce.x-me.position.x,y:Ce.y-me.position.y}),C(J),g(!0)},og=(N,J)=>{N.stopPropagation(),ir(J),to(!0)},ag=(N,J,L)=>{N.stopPropagation();const B=Mt[J];if(!B||B.locked)return;const me=N.touches?N.touches[0].clientX:N.clientX,ye=N.touches?N.touches[0].clientY:N.clientY,ae=Tt(me,ye),Ce=B.fontSize_mm||500,_e=Ps(B.content||"Text",B.fontFamily,Ce,B.fontWeight,B.fontStyle),Re=B.scale_x||1,Fe=B.scale_y||1,dt=_e.width*Re,xt=Ce*1.2*Fe;let tt=B.position.x;B.textAlign==="center"?tt-=dt/2:B.textAlign==="right"&&(tt-=dt);const Je=B.position.y-Ce*Fe;let Jt;switch(L){case"nw":Jt={x:tt+dt,y:Je+xt};break;case"ne":Jt={x:tt,y:Je+xt};break;case"sw":Jt={x:tt+dt,y:Je};break;case"se":default:Jt={x:tt,y:Je};break}const lr=Math.sqrt(Math.pow(ae.x-Jt.x,2)+Math.pow(ae.y-Jt.y,2));pe({initialDistance:lr,originalScale:{x:Re,y:Fe},originalPosition:{...B.position},baseBounds:_e,baseFontSize:Ce,textAlign:B.textAlign,corner:L,anchorPoint:Jt}),Pe(J),Ne(!0)},lg=(N,J)=>{N.stopPropagation();const L=Mt[J];if(!L||L.locked)return;const B=N.touches?N.touches[0].clientX:N.clientX,me=N.touches?N.touches[0].clientY:N.clientY,ye=Tt(B,me),ae=Ps(L.content,L.fontFamily,L.fontSize_mm,L.fontWeight,L.fontStyle);let Ce=L.position.x;L.textAlign==="center"?Ce=L.position.x:L.textAlign==="right"?Ce=L.position.x-ae.width/2:Ce=L.position.x+ae.width/2;const _e={x:Ce,y:L.position.y-L.fontSize_mm*.4},Re=Math.atan2(ye.y-_e.y,ye.x-_e.x)*(180/Math.PI);Ze({initialAngle:Re,originalRotation:L.rotation||0,textCenter:_e}),wt(J),st(!0)},cg=(N,J)=>{N.stopPropagation(),xn(J);const L=sn[J];if(L!=null&&L.locked)return;const B=N.touches?N.touches[0].clientX:N.clientX,me=N.touches?N.touches[0].clientY:N.clientY,ye=Tt(B,me);b({x:ye.x-L.position.x,y:ye.y-L.position.y}),fe(J),g(!0)},L2=(N,J)=>{N.stopPropagation(),xn(J),at.setState({showPropertiesPanel:!0,propertiesPanelUserClosed:!1})},I2=(N,J,L)=>{N.stopPropagation();const B=sn[J];if(!B||B.locked)return;const me=N.touches?N.touches[0].clientX:N.clientX,ye=N.touches?N.touches[0].clientY:N.clientY,ae=Tt(me,ye),{width_mm:Ce,height_mm:_e}=B;let Re;switch(L){case"n":Re={x:B.position.x+Ce/2,y:B.position.y+_e};break;case"s":Re={x:B.position.x+Ce/2,y:B.position.y};break;case"e":Re={x:B.position.x,y:B.position.y+_e/2};break;case"w":Re={x:B.position.x+Ce,y:B.position.y+_e/2};break;default:Re={x:B.position.x,y:B.position.y};break}const Fe=Math.sqrt(Math.pow(ae.x-Re.x,2)+Math.pow(ae.y-Re.y,2));Ee({initialDistance:Fe,originalWidth:Ce,originalHeight:_e,corner:L,anchorPoint:Re}),Ve(J),ee(!0)},z2=(N,J)=>{N.stopPropagation();const L=sn[J];if(!L||L.locked)return;const B=N.touches?N.touches[0].clientX:N.clientX,me=N.touches?N.touches[0].clientY:N.clientY,ye=Tt(B,me),{width_mm:ae,height_mm:Ce}=L,_e={x:L.position.x+ae/2,y:L.position.y+Ce/2},Re=Math.atan2(ye.y-_e.y,ye.x-_e.x)*(180/Math.PI);zn({initialAngle:Re,originalRotation:L.rotation||0,zoneCenter:_e}),Ke(J),ht(!0)},F2=(N,J,L)=>{N.stopPropagation();const B=xe[J];if(!B||B.locked)return;const me=N.touches?N.touches[0].clientX:N.clientX,ye=N.touches?N.touches[0].clientY:N.clientY,ae=Tt(me,ye),{x:Ce,y:_e,width:Re,height:Fe}=B.bounds;let dt;switch(L){case"n":dt={x:Ce+Re/2,y:_e+Fe};break;case"s":dt={x:Ce+Re/2,y:_e};break;case"e":dt={x:Ce,y:_e+Fe/2};break;case"w":dt={x:Ce+Re,y:_e+Fe/2};break;case"nw":dt={x:Ce+Re,y:_e+Fe};break;case"ne":dt={x:Ce,y:_e+Fe};break;case"sw":dt={x:Ce+Re,y:_e};break;case"se":default:dt={x:Ce,y:_e};break}const xt=Math.sqrt(Math.pow(ae.x-dt.x,2)+Math.pow(ae.y-dt.y,2)),tt={};for(const Je of B.childIds)Je.startsWith("shape-")&&Ot[Je]?tt[Je]={position:{...Ot[Je].position},width_mm:Ot[Je].width_mm,height_mm:Ot[Je].height_mm}:Je.startsWith("text-")&&Mt[Je]?tt[Je]={position:{...Mt[Je].position},width_mm:Mt[Je].width_mm||1e3,height_mm:Mt[Je].height_mm||500,fontSize:Mt[Je].fontSize||200}:Je.startsWith("court-")&&Dt[Je]?tt[Je]={position:{...Dt[Je].position},scale:Dt[Je].scale||1}:Je.startsWith("track-")&&an[Je]?tt[Je]={position:{...an[Je].position},scale:an[Je].scale||1}:Je.startsWith("motif-")&&Rt[Je]&&(tt[Je]={position:{...Rt[Je].position},scale:Rt[Je].scale||1});_r({initialDistance:xt,originalBounds:{...B.bounds},corner:L,anchorPoint:dt,originalChildren:tt}),ss(J),wr(!0)},B2=(N,J)=>{N.stopPropagation();const L=xe[J];if(!L||L.locked)return;const B=N.touches?N.touches[0].clientX:N.clientX,me=N.touches?N.touches[0].clientY:N.clientY,ye=Tt(B,me),{x:ae,y:Ce,width:_e,height:Re}=L.bounds,Fe={x:ae+_e/2,y:Ce+Re/2},dt=Math.atan2(ye.y-Fe.y,ye.x-Fe.x)*(180/Math.PI),xt={};for(const tt of L.childIds)tt.startsWith("shape-")&&Ot[tt]?xt[tt]={position:{...Ot[tt].position},rotation:Ot[tt].rotation||0}:tt.startsWith("text-")&&Mt[tt]?xt[tt]={position:{...Mt[tt].position},rotation:Mt[tt].rotation||0}:tt.startsWith("court-")&&Dt[tt]?xt[tt]={position:{...Dt[tt].position},rotation:Dt[tt].rotation||0}:tt.startsWith("track-")&&an[tt]?xt[tt]={position:{...an[tt].position},rotation:an[tt].rotation||0}:tt.startsWith("motif-")&&Rt[tt]&&(xt[tt]={position:{...Rt[tt].position},rotation:Rt[tt].rotation||0});_t({initialAngle:dt,center:Fe,originalBounds:{...L.bounds},originalChildren:xt}),jt(J),$t(!0)};O.useEffect(()=>{g(!1),_(null),E(null),R(null),P(null),C(null),fe(null),b(null)},[vt.width_mm,vt.length_mm]),O.useEffect(()=>{if(!x||!k&&!S&&!T&&!W&&!I&&!$&&!V)return;Jl(!0);const L={id:k||S||T||W||I||$||V,type:k?"court":S?"track":T?"motif":W?"shape":I?"text":$?"exclusionZone":V?"group":null,offset:{x:0,y:0}};U(L),X.current=L;const B=ye=>{F.current||(F.current=requestAnimationFrame(()=>{var tt,Je,Jt,lr,Na,un;F.current=null;const ae=ye.touches?ye.touches[0].clientX:ye.clientX,Ce=ye.touches?ye.touches[0].clientY:ye.clientY,_e=Tt(ae,Ce);let Re={x:_e.x-w.x,y:_e.y-w.y};Yn&&(Re=C5(Re,qn));let Fe=null;if(k?Fe=(tt=Dt[k])==null?void 0:tt.position:S?Fe=(Je=an[S])==null?void 0:Je.position:T?Fe=(Jt=Rt[T])==null?void 0:Jt.position:W?Fe=(lr=Ot[W])==null?void 0:lr.position:I?Fe=(Na=Mt[I])==null?void 0:Na.position:$?Fe=(un=sn[$])==null?void 0:un.position:V&&(Fe={x:0,y:0}),!Fe)return;const dt={x:Re.x-Fe.x,y:Re.y-Fe.y},xt=X.current?{...X.current,offset:dt}:null;X.current=xt,U(xt)}))},me=()=>{F.current&&(cancelAnimationFrame(F.current),F.current=null);const ye=X.current;if(ye&&(ye.offset.x!==0||ye.offset.y!==0)){if(k){const ae=Dt[k];let Ce={x:ae.position.x+ye.offset.x,y:ae.position.y+ye.offset.y};const _e={width_mm:ae.template.dimensions.width_mm*ae.scale,length_mm:ae.template.dimensions.length_mm*ae.scale};Ce=Rc(Ce,_e,vt),ln(k,Ce)}else if(S){const ae=an[S],Ce={x:ae.position.x+ye.offset.x,y:ae.position.y+ye.offset.y};or(S,Ce)}else if(T){const ae=Rt[T];let Ce={x:ae.position.x+ye.offset.x,y:ae.position.y+ye.offset.y};const _e={width_mm:ae.originalWidth_mm*(ae.scale||1),length_mm:ae.originalHeight_mm*(ae.scale||1)};Ce=Rc(Ce,_e,vt),jr(T,Ce)}else if(W){const ae=Ot[W];let Ce={x:ae.position.x+ye.offset.x,y:ae.position.y+ye.offset.y};const _e={width_mm:ae.width_mm,length_mm:ae.height_mm};Ce=Rc(Ce,_e,vt),Ss(W,Ce)}else if(I){const ae=Mt[I],Ce={x:ae.position.x+ye.offset.x,y:ae.position.y+ye.offset.y};Ht(I,Ce)}else if($){const ae=sn[$];let Ce={x:ae.position.x+ye.offset.x,y:ae.position.y+ye.offset.y};const _e={width_mm:ae.width_mm,length_mm:ae.height_mm};Ce=Rc(Ce,_e,vt),Ws($,Ce)}else V&&xe[V]&&(Ea(V,ye.offset.x,ye.offset.y),Jm(V));at.getState().addToHistory()}U(null),X.current=null,Jl(!1),g(!1),_(null),E(null),R(null),P(null),C(null),fe(null),K(null),b(null)};return window.addEventListener("mousemove",B),window.addEventListener("mouseup",me),window.addEventListener("touchmove",B,{passive:!1}),window.addEventListener("touchend",me),window.addEventListener("touchcancel",me),()=>{window.removeEventListener("mousemove",B),window.removeEventListener("mouseup",me),window.removeEventListener("touchmove",B),window.removeEventListener("touchend",me),window.removeEventListener("touchcancel",me),F.current&&(cancelAnimationFrame(F.current),F.current=null),X.current=null,Jl(!1)}},[x,k,S,T,W,I,$,V,w,Dt,an,Rt,Ot,Mt,sn,xe,Yn,qn,vt,ln,or,jr,Ss,Ht,Ws,Ea,Jm,Jl]),O.useEffect(()=>{if(!de||!ke||!De)return;const N=L=>{const B=L.touches?L.touches[0].clientX:L.clientX,me=L.touches?L.touches[0].clientY:L.clientY,ye=Tt(B,me),ae=Rt[ke];if(!ae)return;const _e=Math.sqrt(Math.pow(ye.x-De.anchorPoint.x,2)+Math.pow(ye.y-De.anchorPoint.y,2))/De.initialDistance;let Re=De.originalScale*_e;Re=Math.max(.1,Re),Re=Math.round(Re*100)/100;const Fe=ae.originalWidth_mm*Re,dt=ae.originalHeight_mm*Re;let xt;switch(De.corner){case"nw":xt={x:De.anchorPoint.x-Fe,y:De.anchorPoint.y-dt};break;case"ne":xt={x:De.anchorPoint.x,y:De.anchorPoint.y-dt};break;case"sw":xt={x:De.anchorPoint.x-Fe,y:De.anchorPoint.y};break;case"se":default:xt={x:De.anchorPoint.x,y:De.anchorPoint.y};break}Xn(ke,Re),jr(ke,xt)},J=()=>{const{addToHistory:L}=at.getState();L(),ge.current=Date.now(),Q(!1),Oe(null),Be(null)};return window.addEventListener("mousemove",N),window.addEventListener("mouseup",J),window.addEventListener("touchmove",N,{passive:!1}),window.addEventListener("touchend",J),window.addEventListener("touchcancel",J),()=>{window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",J),window.removeEventListener("touchmove",N),window.removeEventListener("touchend",J),window.removeEventListener("touchcancel",J)}},[de,ke,De,Rt,Xn,jr]),O.useEffect(()=>{if(!Ge||!Xe||!j)return;const N=L=>{const B=L.touches?L.touches[0].clientX:L.clientX,me=L.touches?L.touches[0].clientY:L.clientY,ye=Tt(B,me),Ce=Math.atan2(ye.y-j.motifCenter.y,ye.x-j.motifCenter.x)*(180/Math.PI)-j.initialAngle;let _e=j.originalRotation+Ce;_e=(_e%360+360)%360,L.shiftKey&&(_e=Math.round(_e/15)*15),_e=Math.round(_e*10)/10,Us(Xe,_e)},J=()=>{const{addToHistory:L}=at.getState();L(),ge.current=Date.now(),He(!1),nt(null),ne(null)};return window.addEventListener("mousemove",N),window.addEventListener("mouseup",J),window.addEventListener("touchmove",N,{passive:!1}),window.addEventListener("touchend",J),window.addEventListener("touchcancel",J),()=>{window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",J),window.removeEventListener("touchmove",N),window.removeEventListener("touchend",J),window.removeEventListener("touchcancel",J)}},[Ge,Xe,j,Us]),O.useEffect(()=>{if(!oe||!A||!G)return;const N=L=>{const B=L.touches?L.touches[0].clientX:L.clientX,me=L.touches?L.touches[0].clientY:L.clientY,ye=Tt(B,me);if(!Ot[A])return;const _e=Math.sqrt(Math.pow(ye.x-G.anchorPoint.x,2)+Math.pow(ye.y-G.anchorPoint.y,2))/G.initialDistance;let Re,Fe;const dt=G.corner,xt=["n","s","e","w"].includes(dt);if(G.aspectLocked)Re=G.originalWidth*_e,Fe=G.originalHeight*_e;else if(xt){const Je=Math.abs(ye.y-G.anchorPoint.y),Jt=Math.abs(ye.x-G.anchorPoint.x);dt==="n"||dt==="s"?(Re=G.originalWidth,Fe=Math.max(100,Je)):(Re=Math.max(100,Jt),Fe=G.originalHeight)}else{const Je=Math.abs(ye.x-G.anchorPoint.x),Jt=Math.abs(ye.y-G.anchorPoint.y);Re=Math.max(100,Je),Fe=Math.max(100,Jt)}Re=Math.round(Re),Fe=Math.round(Fe);let tt;switch(dt){case"n":tt={x:G.anchorPoint.x-Re/2,y:G.anchorPoint.y-Fe};break;case"s":tt={x:G.anchorPoint.x-Re/2,y:G.anchorPoint.y};break;case"e":tt={x:G.anchorPoint.x,y:G.anchorPoint.y-Fe/2};break;case"w":tt={x:G.anchorPoint.x-Re,y:G.anchorPoint.y-Fe/2};break;case"nw":tt={x:G.anchorPoint.x-Re,y:G.anchorPoint.y-Fe};break;case"ne":tt={x:G.anchorPoint.x,y:G.anchorPoint.y-Fe};break;case"sw":tt={x:G.anchorPoint.x-Re,y:G.anchorPoint.y};break;case"se":default:tt={x:G.anchorPoint.x,y:G.anchorPoint.y};break}Nt(A,Re,Fe),Ss(A,tt)},J=()=>{const{addToHistory:L}=at.getState();L(),ge.current=Date.now(),z(!1),M(null),ie(null)};return window.addEventListener("mousemove",N),window.addEventListener("mouseup",J),window.addEventListener("touchmove",N,{passive:!1}),window.addEventListener("touchend",J),window.addEventListener("touchcancel",J),()=>{window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",J),window.removeEventListener("touchmove",N),window.removeEventListener("touchend",J),window.removeEventListener("touchcancel",J)}},[oe,A,G,Ot,Nt,Ss]),O.useEffect(()=>{if(!Y||!we||!q)return;const N=L=>{const B=L.touches?L.touches[0].clientX:L.clientX,me=L.touches?L.touches[0].clientY:L.clientY,ye=Tt(B,me),Ce=Math.atan2(ye.y-q.shapeCenter.y,ye.x-q.shapeCenter.x)*(180/Math.PI)-q.initialAngle;let _e=q.originalRotation+Ce;_e=(_e%360+360)%360,L.shiftKey&&(_e=Math.round(_e/15)*15),_e=Math.round(_e*10)/10,cn(we,_e)},J=()=>{const{addToHistory:L}=at.getState();L(),ge.current=Date.now(),se(!1),ue(null),le(null)};return window.addEventListener("mousemove",N),window.addEventListener("mouseup",J),window.addEventListener("touchmove",N,{passive:!1}),window.addEventListener("touchend",J),window.addEventListener("touchcancel",J),()=>{window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",J),window.removeEventListener("touchmove",N),window.removeEventListener("touchend",J),window.removeEventListener("touchcancel",J)}},[Y,we,q,cn]),O.useEffect(()=>{if(!be||!ze||!te)return;const N=L=>{const B=L.touches?L.touches[0].clientX:L.clientX,me=L.touches?L.touches[0].clientY:L.clientY,ye=Tt(B,me);if(!Mt[ze])return;const _e=Math.sqrt(Math.pow(ye.x-te.anchorPoint.x,2)+Math.pow(ye.y-te.anchorPoint.y,2))/te.initialDistance,Re=Math.max(.01,te.originalScale.x*_e),Fe=Math.max(.01,te.originalScale.y*_e),{baseBounds:dt,baseFontSize:xt,corner:tt,anchorPoint:Je,textAlign:Jt}=te,lr=dt.width*Re,Na=xt*1.2*Fe;let un={...te.originalPosition};switch(tt){case"nw":Jt==="left"?un.x=Je.x-lr:Jt==="center"?un.x=Je.x-lr/2:un.x=Je.x,un.y=Je.y-Na*.17;break;case"ne":Jt==="left"?un.x=Je.x:Jt==="center"?un.x=Je.x+lr/2:un.x=Je.x+lr,un.y=Je.y-Na*.17;break;case"sw":Jt==="left"?un.x=Je.x-lr:Jt==="center"?un.x=Je.x-lr/2:un.x=Je.x,un.y=Je.y+xt*Fe;break;case"se":default:Jt==="left"?un.x=Je.x:Jt==="center"?un.x=Je.x+lr/2:un.x=Je.x+lr,un.y=Je.y+xt*Fe;break}Lt(ze,Re,Fe),Ht(ze,un)},J=()=>{const{addToHistory:L}=at.getState();L(),ge.current=Date.now(),Ne(!1),Pe(null),pe(null)};return window.addEventListener("mousemove",N),window.addEventListener("mouseup",J),window.addEventListener("touchmove",N,{passive:!1}),window.addEventListener("touchend",J),window.addEventListener("touchcancel",J),()=>{window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",J),window.removeEventListener("touchmove",N),window.removeEventListener("touchend",J),window.removeEventListener("touchcancel",J)}},[be,ze,te,Mt,Lt,Ht]),O.useEffect(()=>{if(!qe||!rt||!ct)return;const N=L=>{const B=L.touches?L.touches[0].clientX:L.clientX,me=L.touches?L.touches[0].clientY:L.clientY,ye=Tt(B,me),Ce=Math.atan2(ye.y-ct.textCenter.y,ye.x-ct.textCenter.x)*(180/Math.PI)-ct.initialAngle;let _e=ct.originalRotation+Ce;_e=(_e%360+360)%360,L.shiftKey&&(_e=Math.round(_e/15)*15),_e=Math.round(_e*10)/10,Rn(rt,_e)},J=()=>{const{addToHistory:L}=at.getState();L(),ge.current=Date.now(),st(!1),wt(null),Ze(null)};return window.addEventListener("mousemove",N),window.addEventListener("mouseup",J),window.addEventListener("touchmove",N,{passive:!1}),window.addEventListener("touchend",J),window.addEventListener("touchcancel",J),()=>{window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",J),window.removeEventListener("touchmove",N),window.removeEventListener("touchend",J),window.removeEventListener("touchcancel",J)}},[qe,rt,ct,Rn]),O.useEffect(()=>{if(!ce||!ve||!ot)return;const N=L=>{const B=L.touches?L.touches[0].clientX:L.clientX,me=L.touches?L.touches[0].clientY:L.clientY,ye=Tt(B,me);if(!sn[ve])return;const Ce=ot.corner,_e=Math.abs(ye.y-ot.anchorPoint.y),Re=Math.abs(ye.x-ot.anchorPoint.x);let Fe,dt;Ce==="n"||Ce==="s"?(Fe=ot.originalWidth,dt=Math.max(500,_e)):Ce==="e"||Ce==="w"?(Fe=Math.max(500,Re),dt=ot.originalHeight):(Fe=Math.max(500,Re),dt=Math.max(500,_e)),Fe=Math.round(Fe),dt=Math.round(dt);let xt;switch(Ce){case"n":xt={x:ot.anchorPoint.x-Fe/2,y:ot.anchorPoint.y-dt};break;case"s":xt={x:ot.anchorPoint.x-Fe/2,y:ot.anchorPoint.y};break;case"e":xt={x:ot.anchorPoint.x,y:ot.anchorPoint.y-dt/2};break;case"w":xt={x:ot.anchorPoint.x-Fe,y:ot.anchorPoint.y-dt/2};break;default:xt={x:ot.anchorPoint.x,y:ot.anchorPoint.y};break}Fn(ve,Fe,dt),Ws(ve,xt)},J=()=>{const{addToHistory:L}=at.getState();L(),ge.current=Date.now(),ee(!1),Ve(null),Ee(null)};return window.addEventListener("mousemove",N),window.addEventListener("mouseup",J),window.addEventListener("touchmove",N,{passive:!1}),window.addEventListener("touchend",J),window.addEventListener("touchcancel",J),()=>{window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",J),window.removeEventListener("touchmove",N),window.removeEventListener("touchend",J),window.removeEventListener("touchcancel",J)}},[ce,ve,ot,sn,Fn,Ws]),O.useEffect(()=>{if(!St||!Pt||!Kt)return;const N=L=>{const B=L.touches?L.touches[0].clientX:L.clientX,me=L.touches?L.touches[0].clientY:L.clientY,ye=Tt(B,me),Ce=Math.atan2(ye.y-Kt.zoneCenter.y,ye.x-Kt.zoneCenter.x)*(180/Math.PI)-Kt.initialAngle;let _e=Kt.originalRotation+Ce;_e=(_e%360+360)%360,L.shiftKey&&(_e=Math.round(_e/15)*15),_e=Math.round(_e*10)/10,_n(Pt,_e)},J=()=>{const{addToHistory:L}=at.getState();L(),ge.current=Date.now(),ht(!1),Ke(null),zn(null)};return window.addEventListener("mousemove",N),window.addEventListener("mouseup",J),window.addEventListener("touchmove",N,{passive:!1}),window.addEventListener("touchend",J),window.addEventListener("touchcancel",J),()=>{window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",J),window.removeEventListener("touchmove",N),window.removeEventListener("touchend",J),window.removeEventListener("touchcancel",J)}},[St,Pt,Kt,_n]),O.useEffect(()=>{if(!$r||!Dr||!Lr)return;const N=L=>{const B=L.touches?L.touches[0].clientX:L.clientX,me=L.touches?L.touches[0].clientY:L.clientY,ye=Tt(B,me),{initialDistance:ae,originalBounds:Ce,corner:_e,anchorPoint:Re,originalChildren:Fe}=Lr;let xt=Math.sqrt(Math.pow(ye.x-Re.x,2)+Math.pow(ye.y-Re.y,2))/ae;xt<.1&&(xt=.1),xt>10&&(xt=10);let tt=xt,Je=xt;_e==="n"||_e==="s"?tt=1:(_e==="e"||_e==="w")&&(Je=1),Ta(Dr,tt,Je,Re,Fe)},J=()=>{const{addToHistory:L,refreshGroupBounds:B}=at.getState();B(Dr),L(),ge.current=Date.now(),wr(!1),ss(null),_r(null)};return window.addEventListener("mousemove",N),window.addEventListener("mouseup",J),window.addEventListener("touchmove",N,{passive:!1}),window.addEventListener("touchend",J),window.addEventListener("touchcancel",J),()=>{window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",J),window.removeEventListener("touchmove",N),window.removeEventListener("touchend",J),window.removeEventListener("touchcancel",J)}},[$r,Dr,Lr,xe,Ta]),O.useEffect(()=>{if(!is||!kr||!Ir)return;const N=L=>{L.preventDefault();const B=L.touches?L.touches[0].clientX:L.clientX,me=L.touches?L.touches[0].clientY:L.clientY,ye=Tt(B,me),{initialAngle:ae,center:Ce,originalChildren:_e}=Ir;let Fe=Math.atan2(ye.y-Ce.y,ye.x-Ce.x)*(180/Math.PI)-ae;L.shiftKey&&(Fe=Math.round(Fe/15)*15),Km(kr,Fe,Ce,_e)},J=()=>{const{addToHistory:L,refreshGroupBounds:B}=at.getState();B(kr),L(),ge.current=Date.now(),$t(!1),jt(null),_t(null)};return window.addEventListener("mousemove",N),window.addEventListener("mouseup",J),window.addEventListener("touchmove",N,{passive:!1}),window.addEventListener("touchend",J),window.addEventListener("touchcancel",J),()=>{window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",J),window.removeEventListener("touchmove",N),window.removeEventListener("touchend",J),window.removeEventListener("touchcancel",J)}},[is,kr,Ir,xe,Km]);const H2=N=>{var B;if(On&&re&&(N.target===N.currentTarget||N.target.tagName==="svg"||N.target.closest("svg"))){N.preventDefault(),N.stopPropagation();const me=Date.now(),ye=me-Ct;if(Cn(me),ye<300&&ye>0){je();return}const ae=N.clientX,Ce=N.clientY,_e=Tt(ae,Ce),Re=Ot[re];if(Re){const Fe=(_e.x-Re.position.x)/Re.width_mm,dt=(_e.y-Re.position.y)/Re.height_mm,xt=Math.max(-.5,Math.min(1.5,Fe)),tt=Math.max(-.5,Math.min(1.5,dt));Te(xt,tt)}return}if(Date.now()-ge.current<100)return;(N.target===N.currentTarget||N.target.tagName==="svg"||((B=N.target.classList)==null?void 0:B.contains("court-canvas__surface"))||N.target.closest(".court-canvas__scroll-container")===N.target)&&(Hs(),_s(),as(),Nn(),ls(),Pn(),mt(),qt(),En(null))},U2=()=>{a(N=>Math.min(N*1.25,5))},W2=()=>{a(N=>Math.max(N/1.25,.25))},G2=()=>{a(1),c({x:0,y:0})},V2=N=>{if(N.ctrlKey||N.metaKey){N.preventDefault();const J=N.deltaY*-.002;a(L=>Math.min(Math.max(L+L*J,.25),5))}else{N.preventDefault();const J=1;c(L=>({x:L.x-N.deltaX*J,y:L.y-N.deltaY*J}))}},Y2=N=>{(N.button===1||N.button===0&&f)&&(N.preventDefault(),N.stopPropagation(),u(!0),p({x:N.clientX-l.x,y:N.clientY-l.y}))},dg=N=>{const J=N[0].clientX-N[1].clientX,L=N[0].clientY-N[1].clientY;return Math.sqrt(J*J+L*L)},ug=N=>({x:(N[0].clientX+N[1].clientX)/2,y:(N[0].clientY+N[1].clientY)/2}),q2=N=>{if(N.touches.length===2){N.preventDefault();const J=dg(N.touches),L=ug(N.touches);v({active:!0,initialDistance:J,initialZoom:i,initialPan:{...l},initialCenter:L})}},X2=N=>{if(N.touches.length===2&&y.active){N.preventDefault();const L=dg(N.touches)/y.initialDistance;let B=y.initialZoom*L;B=Math.min(Math.max(B,.25),5);const me=ug(N.touches),ye=me.x-y.initialCenter.x,ae=me.y-y.initialCenter.y;a(B),c({x:y.initialPan.x+ye,y:y.initialPan.y+ae})}},Z2=N=>{N.touches.length<2&&v({active:!1,initialDistance:0,initialZoom:1,initialPan:{x:0,y:0},initialCenter:{x:0,y:0}})};O.useEffect(()=>{if(!d)return;const N=L=>{c({x:L.clientX-h.x,y:L.clientY-h.y})},J=()=>{u(!1)};return window.addEventListener("mousemove",N),window.addEventListener("mouseup",J),()=>{window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",J)}},[d,h]),O.useEffect(()=>{const N=L=>{if(L.code==="Space"&&!L.repeat){if(L.target.tagName==="INPUT"||L.target.tagName==="TEXTAREA")return;L.preventDefault(),m(!0)}if(L.code==="Escape"&&On&&re&&(L.preventDefault(),Me()),L.code==="Enter"&&On&&re&&(L.preventDefault(),je()),L.code==="Escape"&&yt&&(L.preventDefault(),Zn()),(L.code==="Delete"||L.code==="Backspace")&&Tn&&Bt!==null){if(L.target.tagName==="INPUT"||L.target.tagName==="TEXTAREA")return;const B=Ot[Tn];B&&(B.shapeType==="path"||B.shapeType==="blob")&&B.editPointsVisible&&(L.preventDefault(),H(Tn,Bt),En(null))}if((L.metaKey||L.ctrlKey)&&L.key.toLowerCase()==="g"&&!L.shiftKey){if(L.target.tagName==="INPUT"||L.target.tagName==="TEXTAREA")return;Ue.length>=2&&(L.preventDefault(),at.getState().groupSelected())}if((L.metaKey||L.ctrlKey)&&L.shiftKey&&L.key.toLowerCase()==="g"){if(L.target.tagName==="INPUT"||L.target.tagName==="TEXTAREA")return;$e&&(L.preventDefault(),at.getState().ungroup($e))}if((L.metaKey||L.ctrlKey)&&L.key.toLowerCase()==="c"&&!L.shiftKey){if(L.target.tagName==="INPUT"||L.target.tagName==="TEXTAREA")return;const B=at.getState();(B.selectedGroupId||B.selectedElementIds.length>0||B.selectedShapeId||B.selectedTextId)&&(L.preventDefault(),B.copySelection())}if((L.metaKey||L.ctrlKey)&&L.key.toLowerCase()==="v"&&!L.shiftKey){if(L.target.tagName==="INPUT"||L.target.tagName==="TEXTAREA")return;const B=at.getState();B.clipboard&&(L.preventDefault(),B.pasteClipboard())}},J=L=>{L.code==="Space"&&(m(!1),u(!1))};return window.addEventListener("keydown",N),window.addEventListener("keyup",J),()=>{window.removeEventListener("keydown",N),window.removeEventListener("keyup",J)}},[On,re,Me,je,Tn,Bt,Ot,H,Ue,$e,yt,Zn]);const K2=N=>{if(On&&re){const J=Tt(N.clientX,N.clientY);Ie(J)}},An=On&&re?Ot[re]:null,ju=((hg=An==null?void 0:An.controlPoints)==null?void 0:hg.length)>0?An.controlPoints[An.controlPoints.length-1]:null;return o.jsxs("div",{className:`court-canvas ${On?"court-canvas--drawing":""}`,onClick:H2,onMouseMove:K2,children:[On&&o.jsx("div",{className:"court-canvas__drawing-indicator",children:"Click to add points  Double-click or Enter to finish  Escape to cancel"}),o.jsxs("div",{className:"court-canvas__zoom-controls",children:[o.jsx("button",{onClick:U2,className:"court-canvas__zoom-btn",title:"Zoom In (Ctrl + Scroll)",children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"11",cy:"11",r:"8"}),o.jsx("line",{x1:"11",y1:"8",x2:"11",y2:"14"}),o.jsx("line",{x1:"8",y1:"11",x2:"14",y2:"11"}),o.jsx("path",{d:"m21 21-4.35-4.35"})]})}),o.jsx("button",{onClick:W2,className:"court-canvas__zoom-btn",title:"Zoom Out (Ctrl + Scroll)",children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"11",cy:"11",r:"8"}),o.jsx("line",{x1:"8",y1:"11",x2:"14",y2:"11"}),o.jsx("path",{d:"m21 21-4.35-4.35"})]})}),o.jsx("button",{onClick:G2,className:"court-canvas__zoom-btn",title:"Reset View",children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M1 4v6h6"}),o.jsx("path",{d:"M23 20v-6h-6"}),o.jsx("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"})]})}),o.jsxs("span",{className:"court-canvas__zoom-level",title:"Scroll to pan, Ctrl+Scroll to zoom, Space+Drag to pan",children:[Math.round(i*100),"%"]})]}),o.jsx("div",{ref:s,className:"court-canvas__viewport",onWheel:V2,onMouseDown:Y2,onTouchStart:q2,onTouchMove:X2,onTouchEnd:Z2,style:{cursor:d?"grabbing":f?"grab":void 0,touchAction:"none"},children:o.jsx("div",{className:"court-canvas__transform-wrapper",style:{transform:`translate(${l.x}px, ${l.y}px) scale(${i})`,transformOrigin:"center center"},children:o.jsxs("svg",{ref:r,className:"court-canvas__svg",viewBox:`0 0 ${vt.width_mm} ${vt.length_mm}`,preserveAspectRatio:"xMidYMid meet",children:[o.jsx("defs",{children:vt.boundary&&vt.boundary.type!=="rectangle"&&vt.boundary.controlPoints&&o.jsx("clipPath",{id:"surface-boundary-clip",children:o.jsx("path",{d:vy(vt.boundary,vt.width_mm,vt.length_mm)})})}),o.jsx("g",{clipPath:vt.boundary&&vt.boundary.type!=="rectangle"&&vt.boundary.controlPoints?"url(#surface-boundary-clip)":void 0,children:o.jsx("rect",{x:"0",y:"0",width:vt.width_mm,height:vt.length_mm,fill:vt.color.hex,className:"court-canvas__surface"})}),vt.boundary&&vt.boundary.type!=="rectangle"&&vt.boundary.controlPoints&&o.jsx("path",{d:vy(vt.boundary,vt.width_mm,vt.length_mm),fill:"none",stroke:"#94a3b8",strokeWidth:"60",strokeDasharray:"300 200",pointerEvents:"none"}),Object.values(sn).map(N=>{if(N.visible===!1)return null;const J=no(N,N.id);return o.jsx(eT,{zone:J,isSelected:N.id===zr,zoom:i,onMouseDown:L=>cg(L,J.id),onTouchStart:L=>cg(L,J.id),onDoubleClick:L=>L2(L,J.id),onScaleStart:(L,B)=>I2(L,J.id,B),onRotateStart:L=>z2(L,J.id)},N.id)}),Vn.map(N=>{if(N.startsWith("court-")){const J=Dt[N];if(!J||J.visible===!1)return null;const L=N===sr||Ue.includes(N);return o.jsx(by,{court:no(J,N),isSelected:L,onMouseDown:B=>Ql(B,N),onTouchStart:B=>Ql(B,N),onDoubleClick:B=>eg(B,N),svgRef:r},N)}if(N.startsWith("track-")){const J=an[N];if(!J||J.visible===!1)return null;const L=N===vs||Ue.includes(N);return o.jsx(py,{track:no(J,N),isSelected:L,onMouseDown:B=>ec(B,N),onTouchStart:B=>ec(B,N),onDoubleClick:B=>tg(B,N),svgRef:r},N)}if(N.startsWith("motif-")){const J=Rt[N];if(!J||J.visible===!1)return null;const L=N===bs||Ue.includes(N);return o.jsx(fy,{motif:no(J,N),isSelected:L,zoom:i,onMouseDown:B=>tc(B,N),onTouchStart:B=>tc(B,N),onDoubleClick:B=>ng(B,N),onScaleStart:(B,me)=>rg(B,N,me),onRotateStart:B=>sg(B,N)},N)}if(N.startsWith("shape-")){const J=Ot[N];if(!J||J.visible===!1)return null;const L=no(J,N),B=N===Tn||Ue.includes(N);return L.shapeType==="blob"?o.jsx(gy,{shape:L,isSelected:B,zoom:i,onMouseDown:me=>Cr(me,N),onTouchStart:me=>Cr(me,N),onDoubleClick:me=>ro(me,N),onScaleStart:(me,ye)=>so(me,N,ye),onRotateStart:me=>io(me,N),onPointDrag:(me,ye,ae)=>Br(N,me,ye,ae),onHandleDrag:(me,ye,ae,Ce)=>bi(N,me,ye,ae,Ce),onDragEnd:()=>js(),selectedPointIndex:N===Tn?Bt:null,onPointSelect:me=>En(me),onPointDelete:me=>H(N,me)},N):L.shapeType==="path"?o.jsx(yy,{shape:L,isSelected:B,zoom:i,onMouseDown:me=>Cr(me,N),onTouchStart:me=>Cr(me,N),onDoubleClick:me=>ro(me,N),onScaleStart:(me,ye)=>so(me,N,ye),onRotateStart:me=>io(me,N),onPointDrag:(me,ye,ae)=>ft(N,me,ye,ae),onHandleDrag:(me,ye,ae,Ce)=>Ye(N,me,ye,ae,Ce),onDragEnd:()=>Se(),selectedPointIndex:N===Tn?Bt:null,onPointSelect:me=>En(me),onPointDelete:me=>H(N,me)},N):o.jsx(my,{shape:L,isSelected:B,zoom:i,onMouseDown:me=>Cr(me,N),onTouchStart:me=>Cr(me,N),onDoubleClick:me=>ro(me,N),onScaleStart:(me,ye)=>so(me,N,ye),onRotateStart:me=>io(me,N)},N)}if(N.startsWith("text-")){const J=Mt[N];if(!J||J.visible===!1)return null;const L=no(J,N);return o.jsx(xy,{text:L,isSelected:N===os||Ue.includes(N),zoom:i,onMouseDown:B=>nc(B,N),onTouchStart:B=>nc(B,N),onDoubleClick:B=>og(B,N),onScaleStart:(B,me)=>ag(B,N,me),onRotateStart:B=>lg(B,N)},N)}if(N.startsWith("group-")){const J=xe[N];if(!J||J.visible===!1)return null;const L=(Z==null?void 0:Z.id)===N?`translate(${Z.offset.x}, ${Z.offset.y})`:void 0;return o.jsx("g",{transform:L,children:J.childIds.map(B=>{if(B.startsWith("shape-")){const me=Ot[B];if(!me||me.visible===!1)return null;const ye=B===Tn||Ue.includes(B);return me.shapeType==="blob"?o.jsx(gy,{shape:me,isSelected:ye,zoom:i,onMouseDown:ae=>Cr(ae,B),onTouchStart:ae=>Cr(ae,B),onDoubleClick:ae=>ro(ae,B),onScaleStart:(ae,Ce)=>so(ae,B,Ce),onRotateStart:ae=>io(ae,B),onPointDrag:(ae,Ce,_e)=>Br(B,ae,Ce,_e),onHandleDrag:(ae,Ce,_e,Re)=>bi(B,ae,Ce,_e,Re),onDragEnd:()=>js(),selectedPointIndex:B===Tn?Bt:null,onPointSelect:ae=>En(ae),onPointDelete:ae=>H(B,ae)},B):me.shapeType==="path"?o.jsx(yy,{shape:me,isSelected:ye,zoom:i,onMouseDown:ae=>Cr(ae,B),onTouchStart:ae=>Cr(ae,B),onDoubleClick:ae=>ro(ae,B),onScaleStart:(ae,Ce)=>so(ae,B,Ce),onRotateStart:ae=>io(ae,B),onPointDrag:(ae,Ce,_e)=>ft(B,ae,Ce,_e),onHandleDrag:(ae,Ce,_e,Re)=>Ye(B,ae,Ce,_e,Re),onDragEnd:()=>Se(),selectedPointIndex:B===Tn?Bt:null,onPointSelect:ae=>En(ae),onPointDelete:ae=>H(B,ae)},B):o.jsx(my,{shape:me,isSelected:ye,zoom:i,onMouseDown:ae=>Cr(ae,B),onTouchStart:ae=>Cr(ae,B),onDoubleClick:ae=>ro(ae,B),onScaleStart:(ae,Ce)=>so(ae,B,Ce),onRotateStart:ae=>io(ae,B)},B)}if(B.startsWith("text-")){const me=Mt[B];return!me||me.visible===!1?null:o.jsx(xy,{text:me,isSelected:B===os||Ue.includes(B),zoom:i,onMouseDown:ye=>nc(ye,B),onTouchStart:ye=>nc(ye,B),onDoubleClick:ye=>og(ye,B),onScaleStart:(ye,ae)=>ag(ye,B,ae),onRotateStart:ye=>lg(ye,B)},B)}if(B.startsWith("court-")){const me=Dt[B];if(!me||me.visible===!1)return null;const ye=B===sr||Ue.includes(B);return o.jsx(by,{court:me,isSelected:ye,onMouseDown:ae=>Ql(ae,B),onTouchStart:ae=>Ql(ae,B),onDoubleClick:ae=>eg(ae,B),svgRef:r},B)}if(B.startsWith("track-")){const me=an[B];if(!me||me.visible===!1)return null;const ye=B===vs||Ue.includes(B);return o.jsx(py,{track:me,isSelected:ye,onMouseDown:ae=>ec(ae,B),onTouchStart:ae=>ec(ae,B),onDoubleClick:ae=>tg(ae,B),svgRef:r},B)}if(B.startsWith("motif-")){const me=Rt[B];if(!me||me.visible===!1)return null;const ye=B===bs||Ue.includes(B);return o.jsx(fy,{motif:me,isSelected:ye,zoom:i,onMouseDown:ae=>tc(ae,B),onTouchStart:ae=>tc(ae,B),onDoubleClick:ae=>ng(ae,B),onScaleStart:(ae,Ce)=>rg(ae,B,Ce),onRotateStart:ae=>sg(ae,B)},B)}return null})},N)}return null}),Object.keys(xe).map(N=>o.jsx(nT,{groupId:N,zoom:i,screenToSVG:Tt,onDragStart:(J,L)=>{b(L),K(J),g(!0)},onScaleStart:(J,L,B)=>F2(J,L,B),onRotateStart:(J,L)=>B2(J,L)},N)),On&&An&&ju&&he&&o.jsx("line",{x1:An.position.x+ju.x*An.width_mm,y1:An.position.y+ju.y*An.height_mm,x2:he.x,y2:he.y,stroke:"#3b82f6",strokeWidth:"50",strokeDasharray:"100 100",opacity:"0.6",pointerEvents:"none"}),On&&An&&((pg=An.controlPoints)==null?void 0:pg.map((N,J)=>o.jsx("circle",{cx:An.position.x+N.x*An.width_mm,cy:An.position.y+N.y*An.height_mm,r:"80",fill:"#3b82f6",stroke:"#fff",strokeWidth:"20",pointerEvents:"none"},`preview-point-${J}`)))]})})}),o.jsxs("div",{className:"court-canvas__info",children:[o.jsxs("span",{children:[(vt.width_mm/1e3).toFixed(1),"m  ",(vt.length_mm/1e3).toFixed(1),"m"]}),Yn&&o.jsxs("span",{className:"court-canvas__grid-indicator",children:["Grid: ",qn,"mm"]})]}),Vn.length===0&&o.jsxs("div",{className:"court-canvas__empty-state",children:[o.jsx("div",{className:"court-canvas__empty-icon",children:o.jsxs("svg",{width:"72",height:"72",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("path",{d:"M12 2L14.4 8.4L21 9.6L16.2 14.4L17.6 21L12 17.6L6.4 21L7.8 14.4L3 9.6L9.6 8.4L12 2Z",fill:"rgba(255,255,255,0.15)",stroke:"currentColor",strokeWidth:"1.5",strokeLinejoin:"round"}),o.jsx("circle",{cx:"19",cy:"5",r:"1.5",fill:"currentColor",opacity:"0.6"}),o.jsx("circle",{cx:"5",cy:"18",r:"1",fill:"currentColor",opacity:"0.4"}),o.jsx("circle",{cx:"20",cy:"16",r:"0.8",fill:"currentColor",opacity:"0.5"})]})}),o.jsx("h3",{className:"court-canvas__empty-title",children:"Your canvas is ready"}),o.jsx("p",{className:"court-canvas__empty-text",children:"Design your perfect TPV surface in minutes"}),o.jsxs("div",{className:"court-canvas__empty-hints",children:[o.jsxs("div",{className:"court-canvas__hint",children:[o.jsx("span",{className:"court-canvas__hint-icon",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),o.jsx("line",{x1:"9",y1:"3",x2:"9",y2:"21"})]})}),o.jsxs("span",{children:["Add ",o.jsx("strong",{children:"Courts"}),", ",o.jsx("strong",{children:"Tracks"}),", ",o.jsx("strong",{children:"Shapes"})," or ",o.jsx("strong",{children:"Designs"})]})]}),o.jsxs("div",{className:"court-canvas__hint",children:[o.jsx("span",{className:"court-canvas__hint-icon",children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M12 5v14M5 12h14"})})}),o.jsx("span",{children:"Click elements in the library to place them"})]}),o.jsxs("div",{className:"court-canvas__hint",children:[o.jsx("span",{className:"court-canvas__hint-icon",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M5 9l4 4-4 4"}),o.jsx("path",{d:"M12 4h7a2 2 0 012 2v12a2 2 0 01-2 2h-7"})]})}),o.jsx("span",{children:"Arrange, customise colours and export"})]})]})]})]})});function by({court:t,isSelected:e,onMouseDown:n,onTouchStart:r,onDoubleClick:s,svgRef:i}){var d;const{markings:a,zones:l}=j5(t),c=((d=t.courtSurfaceColor)==null?void 0:d.hex)||null;return o.jsxs("g",{className:`court-canvas__court ${e?"court-canvas__court--selected":""}`,transform:E5(t),style:{cursor:"move"},children:[c&&o.jsx("rect",{x:"0",y:"0",width:t.template.dimensions.width_mm,height:t.template.dimensions.length_mm,fill:c,className:"court-canvas__court-surface"}),o.jsx("rect",{x:"0",y:"0",width:t.template.dimensions.width_mm,height:t.template.dimensions.length_mm,fill:"none",pointerEvents:"all",onMouseDown:n,onTouchStart:r,onDoubleClick:s,style:{cursor:"move"}}),l.map(u=>o.jsx(sT,{zone:u},u.id)),a.map(u=>o.jsx(iT,{marking:u},u.id)),e&&o.jsxs(o.Fragment,{children:[o.jsx("rect",{x:"0",y:"0",width:t.template.dimensions.width_mm,height:t.template.dimensions.length_mm,fill:"none",stroke:"#007bff",strokeWidth:"100",strokeDasharray:"400 400",className:"court-canvas__selection-outline"}),o.jsx(T5,{court:t,svgRef:i})]})]})}function sT({zone:t}){switch(t.type){case"rect":return o.jsx("rect",{x:t.x,y:t.y,width:t.width,height:t.height,fill:t.fill});case"circle":return o.jsx("circle",{cx:t.cx,cy:t.cy,r:t.r,fill:t.fill});case"polygon":return o.jsx("polygon",{points:t.points,fill:t.fill});default:return null}}function iT({marking:t}){switch(t.type){case"line":return o.jsx("line",{x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,stroke:t.stroke,strokeWidth:t.strokeWidth});case"rect":return o.jsx("rect",{x:t.x,y:t.y,width:t.width,height:t.height,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill});case"circle":return o.jsx("circle",{cx:t.cx,cy:t.cy,r:t.r,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill});case"path":return o.jsx("path",{d:t.d,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill});case"polyline":return o.jsx("polyline",{points:t.points,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill});default:return null}}const e_={"track-flexible":{id:"track-flexible",name:"Running Track",type:"running-track",trackType:"curved",standard:"Flexible Design",category:"track",description:"Flexible running track - adjust size, lanes, and corner radius to fit your surface",parameters:{numLanes:4,laneWidth_mm:1220,width_mm:25e3,height_mm:15e3,cornerRadius:{topLeft:3e3,topRight:3e3,bottomLeft:3e3,bottomRight:3e3},lineWidth_mm:50,startingBoxes:{enabled:!1,depth_mm:400,lineWidth_mm:50}},defaultLineColor:"RH31",defaultTrackSurfaceColor:"RH01",calculatedDimensions:{totalWidth_mm:25e3,totalLength_mm:15e3}},"track-straight":{id:"track-straight",name:"Straight Track",type:"running-track",trackType:"straight",standard:"Sprint Track",category:"track",description:"Straight sprint track - perfect for 60m, 100m, or custom length sprints",parameters:{numLanes:6,laneWidth_mm:1220,width_mm:7320,height_mm:1e5,cornerRadius:{topLeft:0,topRight:0,bottomLeft:0,bottomRight:0},lineWidth_mm:50,startingBoxes:{enabled:!1,depth_mm:400,lineWidth_mm:50}},defaultLineColor:"RH31",defaultTrackSurfaceColor:"RH01",calculatedDimensions:{totalWidth_mm:7320,totalLength_mm:1e5}}};function oT(){return Object.values(e_)}function aT(t){return e_[t]||null}/*! @license DOMPurify 3.3.0 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.0/LICENSE */var hh,wy;function _y(){if(wy)return hh;wy=1;const{entries:t,setPrototypeOf:e,isFrozen:n,getPrototypeOf:r,getOwnPropertyDescriptor:s}=Object;let{freeze:i,seal:a,create:l}=Object,{apply:c,construct:d}=typeof Reflect<"u"&&Reflect;i||(i=function(se){return se}),a||(a=function(se){return se}),c||(c=function(se,we){for(var ue=arguments.length,q=new Array(ue>2?ue-2:0),le=2;le<ue;le++)q[le-2]=arguments[le];return se.apply(we,q)}),d||(d=function(se){for(var we=arguments.length,ue=new Array(we>1?we-1:0),q=1;q<we;q++)ue[q-1]=arguments[q];return new se(...ue)});const u=E(Array.prototype.forEach),h=E(Array.prototype.lastIndexOf),p=E(Array.prototype.pop),f=E(Array.prototype.push),m=E(Array.prototype.splice),y=E(String.prototype.toLowerCase),v=E(String.prototype.toString),x=E(String.prototype.match),g=E(String.prototype.replace),w=E(String.prototype.indexOf),b=E(String.prototype.trim),k=E(Object.prototype.hasOwnProperty),_=E(RegExp.prototype.test),S=T(TypeError);function E(Y){return function(se){se instanceof RegExp&&(se.lastIndex=0);for(var we=arguments.length,ue=new Array(we>1?we-1:0),q=1;q<we;q++)ue[q-1]=arguments[q];return c(Y,se,ue)}}function T(Y){return function(){for(var se=arguments.length,we=new Array(se),ue=0;ue<se;ue++)we[ue]=arguments[ue];return d(Y,we)}}function R(Y,se){let we=arguments.length>2&&arguments[2]!==void 0?arguments[2]:y;e&&e(Y,null);let ue=se.length;for(;ue--;){let q=se[ue];if(typeof q=="string"){const le=we(q);le!==q&&(n(se)||(se[ue]=le),q=le)}Y[q]=!0}return Y}function W(Y){for(let se=0;se<Y.length;se++)k(Y,se)||(Y[se]=null);return Y}function P(Y){const se=l(null);for(const[we,ue]of t(Y))k(Y,we)&&(Array.isArray(ue)?se[we]=W(ue):ue&&typeof ue=="object"&&ue.constructor===Object?se[we]=P(ue):se[we]=ue);return se}function I(Y,se){for(;Y!==null;){const ue=s(Y,se);if(ue){if(ue.get)return E(ue.get);if(typeof ue.value=="function")return E(ue.value)}Y=r(Y)}function we(){return null}return we}const C=i(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),$=i(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),fe=i(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),V=i(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),K=i(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),F=i(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Z=i(["#text"]),U=i(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),X=i(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),ge=i(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),de=i(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),Q=a(/\{\{[\w\W]*|[\w\W]*\}\}/gm),ke=a(/<%[\w\W]*|[\w\W]*%>/gm),Oe=a(/\$\{[\w\W]*/gm),De=a(/^data-[\-\w.\u00B7-\uFFFF]+$/),Be=a(/^aria-[\-\w]+$/),Ge=a(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),He=a(/^(?:\w+script|data):/i),Xe=a(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),nt=a(/^html$/i),j=a(/^[a-z][.\w]*(-[.\w]+)+$/i);var ne=Object.freeze({__proto__:null,ARIA_ATTR:Be,ATTR_WHITESPACE:Xe,CUSTOM_ELEMENT:j,DATA_ATTR:De,DOCTYPE_NAME:nt,ERB_EXPR:ke,IS_ALLOWED_URI:Ge,IS_SCRIPT_OR_DATA:He,MUSTACHE_EXPR:Q,TMPLIT_EXPR:Oe});const oe={element:1,text:3,progressingInstruction:7,comment:8,document:9},z=function(){return typeof window>"u"?null:window},A=function(se,we){if(typeof se!="object"||typeof se.createPolicy!="function")return null;let ue=null;const q="data-tt-policy-suffix";we&&we.hasAttribute(q)&&(ue=we.getAttribute(q));const le="dompurify"+(ue?"#"+ue:"");try{return se.createPolicy(le,{createHTML(be){return be},createScriptURL(be){return be}})}catch{return console.warn("TrustedTypes policy "+le+" could not be created."),null}},M=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function G(){let Y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:z();const se=Se=>G(Se);if(se.version="3.3.0",se.removed=[],!Y||!Y.document||Y.document.nodeType!==oe.document||!Y.Element)return se.isSupported=!1,se;let{document:we}=Y;const ue=we,q=ue.currentScript,{DocumentFragment:le,HTMLTemplateElement:be,Node:Ne,Element:ze,NodeFilter:Pe,NamedNodeMap:te=Y.NamedNodeMap||Y.MozNamedAttrMap,HTMLFormElement:pe,DOMParser:qe,trustedTypes:st}=Y,rt=ze.prototype,wt=I(rt,"cloneNode"),ct=I(rt,"remove"),Ze=I(rt,"nextSibling"),ce=I(rt,"childNodes"),ee=I(rt,"parentNode");if(typeof be=="function"){const Se=we.createElement("template");Se.content&&Se.content.ownerDocument&&(we=Se.content.ownerDocument)}let ve,Ve="";const{implementation:ot,createNodeIterator:Ee,createDocumentFragment:St,getElementsByTagName:ht}=we,{importNode:Pt}=ue;let Ke=M();se.isSupported=typeof t=="function"&&typeof ee=="function"&&ot&&ot.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Kt,ERB_EXPR:zn,TMPLIT_EXPR:$r,DATA_ATTR:wr,ARIA_ATTR:Dr,IS_SCRIPT_OR_DATA:ss,ATTR_WHITESPACE:Lr,CUSTOM_ELEMENT:_r}=ne;let{IS_ALLOWED_URI:is}=ne,$t=null;const kr=R({},[...C,...$,...fe,...K,...Z]);let jt=null;const Ir=R({},[...U,...X,...ge,...de]);let _t=Object.seal(l(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),he=null,Ie=null;const Ct=Object.seal(l(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Cn=!0,Bt=!0,En=!1,vt=!0,Dt=!1,an=!0,Rt=!1,Ot=!1,Mt=!1,sn=!1,Vn=!1,sr=!1,vs=!0,bs=!1;const Tn="user-content-";let os=!0,zr=!1,Yn={},qn=null;const Sr=R({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Hs=null;const ws=R({},["audio","video","img","source","image","track"]);let _s=null;const ks=R({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),as="http://www.w3.org/1998/Math/MathML",Fr="http://www.w3.org/2000/svg",Nn="http://www.w3.org/1999/xhtml";let ir=Nn,ls=!1,xn=null;const Pn=R({},[as,Fr,Nn],v);let ln=R({},["mi","mo","mn","ms","mtext"]),or=R({},["annotation-xml"]);const jr=R({},["title","style","font","a","script"]);let Xn=null;const Us=["application/xhtml+xml","text/html"],Ss="text/html";let Nt=null,cn=null;const Ht=we.createElement("form"),Lt=function(H){return H instanceof RegExp||H instanceof Function},Rn=function(){let H=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(cn&&cn===H)){if((!H||typeof H!="object")&&(H={}),H=P(H),Xn=Us.indexOf(H.PARSER_MEDIA_TYPE)===-1?Ss:H.PARSER_MEDIA_TYPE,Nt=Xn==="application/xhtml+xml"?v:y,$t=k(H,"ALLOWED_TAGS")?R({},H.ALLOWED_TAGS,Nt):kr,jt=k(H,"ALLOWED_ATTR")?R({},H.ALLOWED_ATTR,Nt):Ir,xn=k(H,"ALLOWED_NAMESPACES")?R({},H.ALLOWED_NAMESPACES,v):Pn,_s=k(H,"ADD_URI_SAFE_ATTR")?R(P(ks),H.ADD_URI_SAFE_ATTR,Nt):ks,Hs=k(H,"ADD_DATA_URI_TAGS")?R(P(ws),H.ADD_DATA_URI_TAGS,Nt):ws,qn=k(H,"FORBID_CONTENTS")?R({},H.FORBID_CONTENTS,Nt):Sr,he=k(H,"FORBID_TAGS")?R({},H.FORBID_TAGS,Nt):P({}),Ie=k(H,"FORBID_ATTR")?R({},H.FORBID_ATTR,Nt):P({}),Yn=k(H,"USE_PROFILES")?H.USE_PROFILES:!1,Cn=H.ALLOW_ARIA_ATTR!==!1,Bt=H.ALLOW_DATA_ATTR!==!1,En=H.ALLOW_UNKNOWN_PROTOCOLS||!1,vt=H.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Dt=H.SAFE_FOR_TEMPLATES||!1,an=H.SAFE_FOR_XML!==!1,Rt=H.WHOLE_DOCUMENT||!1,sn=H.RETURN_DOM||!1,Vn=H.RETURN_DOM_FRAGMENT||!1,sr=H.RETURN_TRUSTED_TYPE||!1,Mt=H.FORCE_BODY||!1,vs=H.SANITIZE_DOM!==!1,bs=H.SANITIZE_NAMED_PROPS||!1,os=H.KEEP_CONTENT!==!1,zr=H.IN_PLACE||!1,is=H.ALLOWED_URI_REGEXP||Ge,ir=H.NAMESPACE||Nn,ln=H.MATHML_TEXT_INTEGRATION_POINTS||ln,or=H.HTML_INTEGRATION_POINTS||or,_t=H.CUSTOM_ELEMENT_HANDLING||{},H.CUSTOM_ELEMENT_HANDLING&&Lt(H.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(_t.tagNameCheck=H.CUSTOM_ELEMENT_HANDLING.tagNameCheck),H.CUSTOM_ELEMENT_HANDLING&&Lt(H.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(_t.attributeNameCheck=H.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),H.CUSTOM_ELEMENT_HANDLING&&typeof H.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(_t.allowCustomizedBuiltInElements=H.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Dt&&(Bt=!1),Vn&&(sn=!0),Yn&&($t=R({},Z),jt=[],Yn.html===!0&&(R($t,C),R(jt,U)),Yn.svg===!0&&(R($t,$),R(jt,X),R(jt,de)),Yn.svgFilters===!0&&(R($t,fe),R(jt,X),R(jt,de)),Yn.mathMl===!0&&(R($t,K),R(jt,ge),R(jt,de))),H.ADD_TAGS&&(typeof H.ADD_TAGS=="function"?Ct.tagCheck=H.ADD_TAGS:($t===kr&&($t=P($t)),R($t,H.ADD_TAGS,Nt))),H.ADD_ATTR&&(typeof H.ADD_ATTR=="function"?Ct.attributeCheck=H.ADD_ATTR:(jt===Ir&&(jt=P(jt)),R(jt,H.ADD_ATTR,Nt))),H.ADD_URI_SAFE_ATTR&&R(_s,H.ADD_URI_SAFE_ATTR,Nt),H.FORBID_CONTENTS&&(qn===Sr&&(qn=P(qn)),R(qn,H.FORBID_CONTENTS,Nt)),os&&($t["#text"]=!0),Rt&&R($t,["html","head","body"]),$t.table&&(R($t,["tbody"]),delete he.tbody),H.TRUSTED_TYPES_POLICY){if(typeof H.TRUSTED_TYPES_POLICY.createHTML!="function")throw S('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof H.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw S('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');ve=H.TRUSTED_TYPES_POLICY,Ve=ve.createHTML("")}else ve===void 0&&(ve=A(st,q)),ve!==null&&typeof Ve=="string"&&(Ve=ve.createHTML(""));i&&i(H),cn=H}},Ut=R({},[...$,...fe,...V]),to=R({},[...K,...F]),Ws=function(H){let xe=ee(H);(!xe||!xe.tagName)&&(xe={namespaceURI:ir,tagName:"template"});const $e=y(H.tagName),Ue=y(xe.tagName);return xn[H.namespaceURI]?H.namespaceURI===Fr?xe.namespaceURI===Nn?$e==="svg":xe.namespaceURI===as?$e==="svg"&&(Ue==="annotation-xml"||ln[Ue]):!!Ut[$e]:H.namespaceURI===as?xe.namespaceURI===Nn?$e==="math":xe.namespaceURI===Fr?$e==="math"&&or[Ue]:!!to[$e]:H.namespaceURI===Nn?xe.namespaceURI===Fr&&!or[Ue]||xe.namespaceURI===as&&!ln[Ue]?!1:!to[$e]&&(jr[$e]||!Ut[$e]):!!(Xn==="application/xhtml+xml"&&xn[H.namespaceURI]):!1},Fn=function(H){f(se.removed,{element:H});try{ee(H).removeChild(H)}catch{ct(H)}},_n=function(H,xe){try{f(se.removed,{attribute:xe.getAttributeNode(H),from:xe})}catch{f(se.removed,{attribute:null,from:xe})}if(xe.removeAttribute(H),H==="is")if(sn||Vn)try{Fn(xe)}catch{}else try{xe.setAttribute(H,"")}catch{}},Br=function(H){let xe=null,$e=null;if(Mt)H="<remove></remove>"+H;else{const lt=x(H,/^[\r\n\t ]+/);$e=lt&&lt[0]}Xn==="application/xhtml+xml"&&ir===Nn&&(H='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+H+"</body></html>");const Ue=ve?ve.createHTML(H):H;if(ir===Nn)try{xe=new qe().parseFromString(Ue,Xn)}catch{}if(!xe||!xe.documentElement){xe=ot.createDocument(ir,"template",null);try{xe.documentElement.innerHTML=ls?Ve:Ue}catch{}}const yt=xe.body||xe.documentElement;return H&&$e&&yt.insertBefore(we.createTextNode($e),yt.childNodes[0]||null),ir===Nn?ht.call(xe,Rt?"html":"body")[0]:Rt?xe.documentElement:yt},bi=function(H){return Ee.call(H.ownerDocument||H,H,Pe.SHOW_ELEMENT|Pe.SHOW_COMMENT|Pe.SHOW_TEXT|Pe.SHOW_PROCESSING_INSTRUCTION|Pe.SHOW_CDATA_SECTION,null)},js=function(H){return H instanceof pe&&(typeof H.nodeName!="string"||typeof H.textContent!="string"||typeof H.removeChild!="function"||!(H.attributes instanceof te)||typeof H.removeAttribute!="function"||typeof H.setAttribute!="function"||typeof H.namespaceURI!="string"||typeof H.insertBefore!="function"||typeof H.hasChildNodes!="function")},On=function(H){return typeof Ne=="function"&&H instanceof Ne};function re(Se,H,xe){u(Se,$e=>{$e.call(se,H,xe,cn)})}const Te=function(H){let xe=null;if(re(Ke.beforeSanitizeElements,H,null),js(H))return Fn(H),!0;const $e=Nt(H.nodeName);if(re(Ke.uponSanitizeElement,H,{tagName:$e,allowedTags:$t}),an&&H.hasChildNodes()&&!On(H.firstElementChild)&&_(/<[/\w!]/g,H.innerHTML)&&_(/<[/\w!]/g,H.textContent)||H.nodeType===oe.progressingInstruction||an&&H.nodeType===oe.comment&&_(/<[/\w]/g,H.data))return Fn(H),!0;if(!(Ct.tagCheck instanceof Function&&Ct.tagCheck($e))&&(!$t[$e]||he[$e])){if(!he[$e]&&Me($e)&&(_t.tagNameCheck instanceof RegExp&&_(_t.tagNameCheck,$e)||_t.tagNameCheck instanceof Function&&_t.tagNameCheck($e)))return!1;if(os&&!qn[$e]){const Ue=ee(H)||H.parentNode,yt=ce(H)||H.childNodes;if(yt&&Ue){const lt=yt.length;for(let mt=lt-1;mt>=0;--mt){const gt=wt(yt[mt],!0);gt.__removalCount=(H.__removalCount||0)+1,Ue.insertBefore(gt,Ze(H))}}}return Fn(H),!0}return H instanceof ze&&!Ws(H)||($e==="noscript"||$e==="noembed"||$e==="noframes")&&_(/<\/no(script|embed|frames)/i,H.innerHTML)?(Fn(H),!0):(Dt&&H.nodeType===oe.text&&(xe=H.textContent,u([Kt,zn,$r],Ue=>{xe=g(xe,Ue," ")}),H.textContent!==xe&&(f(se.removed,{element:H.cloneNode()}),H.textContent=xe)),re(Ke.afterSanitizeElements,H,null),!1)},je=function(H,xe,$e){if(vs&&(xe==="id"||xe==="name")&&($e in we||$e in Ht))return!1;if(!(Bt&&!Ie[xe]&&_(wr,xe))){if(!(Cn&&_(Dr,xe))){if(!(Ct.attributeCheck instanceof Function&&Ct.attributeCheck(xe,H))){if(!jt[xe]||Ie[xe]){if(!(Me(H)&&(_t.tagNameCheck instanceof RegExp&&_(_t.tagNameCheck,H)||_t.tagNameCheck instanceof Function&&_t.tagNameCheck(H))&&(_t.attributeNameCheck instanceof RegExp&&_(_t.attributeNameCheck,xe)||_t.attributeNameCheck instanceof Function&&_t.attributeNameCheck(xe,H))||xe==="is"&&_t.allowCustomizedBuiltInElements&&(_t.tagNameCheck instanceof RegExp&&_(_t.tagNameCheck,$e)||_t.tagNameCheck instanceof Function&&_t.tagNameCheck($e))))return!1}else if(!_s[xe]){if(!_(is,g($e,Lr,""))){if(!((xe==="src"||xe==="xlink:href"||xe==="href")&&H!=="script"&&w($e,"data:")===0&&Hs[H])){if(!(En&&!_(ss,g($e,Lr,"")))){if($e)return!1}}}}}}}return!0},Me=function(H){return H!=="annotation-xml"&&x(H,_r)},ft=function(H){re(Ke.beforeSanitizeAttributes,H,null);const{attributes:xe}=H;if(!xe||js(H))return;const $e={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:jt,forceKeepAttr:void 0};let Ue=xe.length;for(;Ue--;){const yt=xe[Ue],{name:lt,namespaceURI:mt,value:gt}=yt,Zn=Nt(lt),ar=gt;let qt=lt==="value"?ar:b(ar);if($e.attrName=Zn,$e.attrValue=qt,$e.keepAttr=!0,$e.forceKeepAttr=void 0,re(Ke.uponSanitizeAttribute,H,$e),qt=$e.attrValue,bs&&(Zn==="id"||Zn==="name")&&(_n(lt,H),qt=Tn+qt),an&&_(/((--!?|])>)|<\/(style|title|textarea)/i,qt)){_n(lt,H);continue}if(Zn==="attributename"&&x(qt,"href")){_n(lt,H);continue}if($e.forceKeepAttr)continue;if(!$e.keepAttr){_n(lt,H);continue}if(!vt&&_(/\/>/i,qt)){_n(lt,H);continue}Dt&&u([Kt,zn,$r],Ta=>{qt=g(qt,Ta," ")});const Ea=Nt(H.nodeName);if(!je(Ea,Zn,qt)){_n(lt,H);continue}if(ve&&typeof st=="object"&&typeof st.getAttributeType=="function"&&!mt)switch(st.getAttributeType(Ea,Zn)){case"TrustedHTML":{qt=ve.createHTML(qt);break}case"TrustedScriptURL":{qt=ve.createScriptURL(qt);break}}if(qt!==ar)try{mt?H.setAttributeNS(mt,lt,qt):H.setAttribute(lt,qt),js(H)?Fn(H):p(se.removed)}catch{_n(lt,H)}}re(Ke.afterSanitizeAttributes,H,null)},Ye=function Se(H){let xe=null;const $e=bi(H);for(re(Ke.beforeSanitizeShadowDOM,H,null);xe=$e.nextNode();)re(Ke.uponSanitizeShadowNode,xe,null),Te(xe),ft(xe),xe.content instanceof le&&Se(xe.content);re(Ke.afterSanitizeShadowDOM,H,null)};return se.sanitize=function(Se){let H=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},xe=null,$e=null,Ue=null,yt=null;if(ls=!Se,ls&&(Se="<!-->"),typeof Se!="string"&&!On(Se))if(typeof Se.toString=="function"){if(Se=Se.toString(),typeof Se!="string")throw S("dirty is not a string, aborting")}else throw S("toString is not a function");if(!se.isSupported)return Se;if(Ot||Rn(H),se.removed=[],typeof Se=="string"&&(zr=!1),zr){if(Se.nodeName){const gt=Nt(Se.nodeName);if(!$t[gt]||he[gt])throw S("root node is forbidden and cannot be sanitized in-place")}}else if(Se instanceof Ne)xe=Br("<!---->"),$e=xe.ownerDocument.importNode(Se,!0),$e.nodeType===oe.element&&$e.nodeName==="BODY"||$e.nodeName==="HTML"?xe=$e:xe.appendChild($e);else{if(!sn&&!Dt&&!Rt&&Se.indexOf("<")===-1)return ve&&sr?ve.createHTML(Se):Se;if(xe=Br(Se),!xe)return sn?null:sr?Ve:""}xe&&Mt&&Fn(xe.firstChild);const lt=bi(zr?Se:xe);for(;Ue=lt.nextNode();)Te(Ue),ft(Ue),Ue.content instanceof le&&Ye(Ue.content);if(zr)return Se;if(sn){if(Vn)for(yt=St.call(xe.ownerDocument);xe.firstChild;)yt.appendChild(xe.firstChild);else yt=xe;return(jt.shadowroot||jt.shadowrootmode)&&(yt=Pt.call(ue,yt,!0)),yt}let mt=Rt?xe.outerHTML:xe.innerHTML;return Rt&&$t["!doctype"]&&xe.ownerDocument&&xe.ownerDocument.doctype&&xe.ownerDocument.doctype.name&&_(nt,xe.ownerDocument.doctype.name)&&(mt="<!DOCTYPE "+xe.ownerDocument.doctype.name+`>
`+mt),Dt&&u([Kt,zn,$r],gt=>{mt=g(mt,gt," ")}),ve&&sr?ve.createHTML(mt):mt},se.setConfig=function(){let Se=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Rn(Se),Ot=!0},se.clearConfig=function(){cn=null,Ot=!1},se.isValidAttribute=function(Se,H,xe){cn||Rn({});const $e=Nt(Se),Ue=Nt(H);return je($e,Ue,xe)},se.addHook=function(Se,H){typeof H=="function"&&f(Ke[Se],H)},se.removeHook=function(Se,H){if(H!==void 0){const xe=h(Ke[Se],H);return xe===-1?void 0:m(Ke[Se],xe,1)[0]}return p(Ke[Se])},se.removeHooks=function(Se){Ke[Se]=[]},se.removeAllHooks=function(){Ke=M()},se}var ie=G();return hh=ie,hh}var lT=self.DOMPurify||(self.DOMPurify=_y().default||_y());const cT=$l(lT);function Qf(t,e={}){if(!t||typeof t!="string")return console.warn("[SVG-SANITIZE] Invalid input:",typeof t),"";const n={USE_PROFILES:{svg:!0,svgFilters:!0},FORBID_TAGS:["script","foreignObject","iframe","embed"],FORBID_ATTR:["onload","onerror","onclick","onmouseover","onmouseout","onmouseenter","onmouseleave","onmousemove","onmousedown","onmouseup","onfocus","onblur","onkeydown","onkeyup","onkeypress","onsubmit","onreset","onselect","onchange","oninput","onanimationstart","onanimationend","onanimationiteration","ontransitionend","ontransitionrun","ontransitionstart","ontransitioncancel","xlink:href",...e.additionalForbiddenAttrs||[]],ALLOW_DATA_ATTR:!0,ALLOW_COMMENTS:!1,RETURN_DOM:!1,RETURN_DOM_FRAGMENT:!1,ALLOWED_URI_REGEXP:/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,HOOKS:{afterSanitizeAttributes:r=>{if(r.hasAttribute("href")){const s=r.getAttribute("href");s&&s.toLowerCase().trim().startsWith("javascript:")&&(r.removeAttribute("href"),console.warn("[SVG-SANITIZE] Removed javascript: href"))}if(r.hasAttribute("xlink:href")){const s=r.getAttribute("xlink:href");s&&(s.toLowerCase().trim().startsWith("javascript:")||s.toLowerCase().trim().startsWith("data:text/html"))&&(r.removeAttribute("xlink:href"),console.warn("[SVG-SANITIZE] Removed dangerous xlink:href"))}}},...e};try{const r=cT.sanitize(t,n);if(!r||!r.includes("<svg"))return console.error("[SVG-SANITIZE] Sanitization removed SVG content - input may be malicious"),"";const s=t.length,i=r.length,a=(s-i)/s*100;return a>10&&console.warn(`[SVG-SANITIZE] Removed ${a.toFixed(1)}% of content (${s-i} chars) - possible malicious SVG detected`),r}catch(r){return console.error("[SVG-SANITIZE] Sanitization failed:",r),""}}function dT(t){if(!t||typeof t!="string")return!1;const e=t.toLowerCase(),n=["<script","javascript:","onload=","onerror=","onclick=","onmouseover=","<foreignobject","<iframe","<embed","data:text/html"];for(const r of n)if(e.includes(r))return console.warn(`[SVG-VALIDATE] Dangerous pattern detected: ${r}`),!1;return e.includes("<svg")?!0:(console.warn("[SVG-VALIDATE] Content does not appear to be valid SVG (no <svg> tag found)"),!1)}function uT(t){return t.replace("#","").toLowerCase()}async function Oi(t,e,n=null){try{let r;if(n)r=n;else{const m=await fetch(t);if(!m.ok)throw new Error(`Failed to fetch SVG: ${m.status} ${m.statusText}`);r=await m.text()}const s=Qf(r);if(!s)throw new Error("SVG sanitization failed - content rejected");const a=new DOMParser().parseFromString(s,"image/svg+xml"),l=a.querySelector("parsererror");if(l)throw new Error(`SVG parse error: ${l.textContent}`);const c=a.documentElement;if(c.tagName!=="svg")throw new Error("Invalid SVG: root element is not <svg>");const d=hT(c,e),h=new XMLSerializer().serializeToString(a),p=new Blob([h],{type:"image/svg+xml"});return{dataUrl:URL.createObjectURL(p),svgText:h,stats:d}}catch(r){throw console.error("[SVG-RECOLOR] Error:",r),r}}function hT(t,e){const n={totalElements:0,fillsReplaced:0,strokesReplaced:0,stopColorsReplaced:0,stylesProcessed:0,colorsNotMapped:new Set},r=t.querySelectorAll("*");n.totalElements=r.length;for(const a of r){const l=a.getAttribute("fill");if(l&&l!=="none"){const h=fs(l,e,n.colorsNotMapped);h!==l&&(h==="transparent"||h==="none"?(a.setAttribute("fill","none"),a.setAttribute("fill-opacity","0")):a.setAttribute("fill",h),n.fillsReplaced++)}const c=a.getAttribute("stroke");if(c&&c!=="none"){const h=fs(c,e,n.colorsNotMapped);h!==c&&(h==="transparent"||h==="none"?(a.setAttribute("stroke","none"),a.setAttribute("stroke-opacity","0")):a.setAttribute("stroke",h),n.strokesReplaced++)}const d=a.getAttribute("stop-color");if(d&&d!=="none"){const h=fs(d,e,n.colorsNotMapped);h!==d&&(a.setAttribute("stop-color",h),n.stopColorsReplaced++)}const u=a.getAttribute("style");if(u){const h=jy(u,e,n);h!==u&&(a.setAttribute("style",h),n.stylesProcessed++)}}const s=t.querySelectorAll("style");for(const a of s){const l=a.textContent,c=fT(l,e,n);c!==l&&(a.textContent=c,n.stylesProcessed++)}const i=t.querySelectorAll("stop");for(const a of i){const l=a.getAttribute("stop-color");if(l&&l!=="none"){const d=fs(l,e,n.colorsNotMapped);d!==l&&(a.setAttribute("stop-color",d),n.stopColorsReplaced++)}const c=a.getAttribute("style");if(c&&c.includes("stop-color")){const d=jy(c,e,n);d!==c&&(a.setAttribute("style",d),n.stylesProcessed++)}}return n}function fs(t,e,n){const r=mT(t);if(!r)return t;const s=`#${r}`,i=e.get(s);if(i)return i.blendHex;const a=ky(r);if(!a)return t;const l=Sy(a);let c=null,d=1/0;for(const[u,h]of e.entries()){const p=ky(u.replace("#",""));if(!p)continue;const f=Sy(p),m=pT(l,f);if(m<d&&(d=m,c=h),m<=9)return h.blendHex}return c?(n&&n.add(t),c.blendHex):(console.warn(`[SVG-RECOLOR] No mapping found: ${s}`),t)}function ky(t){if(t.length!==6)return null;const e=parseInt(t.substring(0,2),16),n=parseInt(t.substring(2,4),16),r=parseInt(t.substring(4,6),16);return isNaN(e)||isNaN(n)||isNaN(r)?null:{r:e,g:n,b:r}}function Sy(t){let e=t.r/255,n=t.g/255,r=t.b/255;e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;const s=(e*.4124+n*.3576+r*.1805)*100,i=(e*.2126+n*.7152+r*.0722)*100,a=(e*.0193+n*.1192+r*.9505)*100,l=95.047,c=100,d=108.883;let u=s/l,h=i/c,p=a/d;return u=u>.008856?Math.pow(u,1/3):7.787*u+16/116,h=h>.008856?Math.pow(h,1/3):7.787*h+16/116,p=p>.008856?Math.pow(p,1/3):7.787*p+16/116,{L:116*h-16,a:500*(u-h),b:200*(h-p)}}function pT(t,e){const i=Math.PI*2,a=Math.PI,l=(t.L+e.L)/2,c=Math.sqrt(t.a*t.a+t.b*t.b),d=Math.sqrt(e.a*e.a+e.b*e.b),u=(c+d)/2,h=.5*(1-Math.sqrt(Math.pow(u,7)/(Math.pow(u,7)+Math.pow(25,7)))),p=t.a*(1+h),f=e.a*(1+h),m=Math.sqrt(p*p+t.b*t.b),y=Math.sqrt(f*f+e.b*e.b),v=(m+y)/2;let x=Math.atan2(t.b,p);x<0&&(x+=i);let g=Math.atan2(e.b,f);g<0&&(g+=i);const w=Math.abs(x-g)>a?(x+g+i)/2:(x+g)/2,b=1-.17*Math.cos(w-Math.PI/6)+.24*Math.cos(2*w)+.32*Math.cos(3*w+Math.PI/30)-.2*Math.cos(4*w-63*Math.PI/180);let k=g-x;Math.abs(k)>a&&(k=k>0?k-i:k+i);const _=e.L-t.L,S=y-m,E=2*Math.sqrt(m*y)*Math.sin(k/2),T=1+.015*Math.pow(l-50,2)/Math.sqrt(20+Math.pow(l-50,2)),R=1+.045*v,W=1+.015*v*b,P=30*Math.PI/180*Math.exp(-Math.pow((w-275*Math.PI/180)/(25*Math.PI/180),2)),C=-(2*Math.sqrt(Math.pow(v,7)/(Math.pow(v,7)+Math.pow(25,7))))*Math.sin(2*P);return Math.sqrt(Math.pow(_/(1*T),2)+Math.pow(S/(1*R),2)+Math.pow(E/(1*W),2)+C*(S/(1*R))*(E/(1*W)))}function jy(t,e,n){let r=t;return r=r.replace(/fill:\s*([^;]+)/gi,(s,i)=>`fill: ${fs(i.trim(),e,n.colorsNotMapped)}`),r=r.replace(/stroke:\s*([^;]+)/gi,(s,i)=>`stroke: ${fs(i.trim(),e,n.colorsNotMapped)}`),r=r.replace(/stop-color:\s*([^;]+)/gi,(s,i)=>`stop-color: ${fs(i.trim(),e,n.colorsNotMapped)}`),r}function fT(t,e,n){let r=t;return r=r.replace(/fill:\s*([^;}\s]+)/gi,(s,i)=>{const a=i.trim();return`fill: ${fs(a,e,n.colorsNotMapped)}`}),r=r.replace(/stroke:\s*([^;}\s]+)/gi,(s,i)=>{const a=i.trim();return`stroke: ${fs(a,e,n.colorsNotMapped)}`}),r=r.replace(/stop-color:\s*([^;}\s]+)/gi,(s,i)=>{const a=i.trim();return`stop-color: ${fs(a,e,n.colorsNotMapped)}`}),r}function mT(t){const e=t.trim().toLowerCase();if(e.match(/^#?[0-9a-f]{6}$/))return uT(e);const n=e.match(/^#?([0-9a-f]{3})$/);if(n)return n[1].split("").map(a=>a+a).join("");const r=e.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(r){const i=parseInt(r[1],10),a=parseInt(r[2],10),l=parseInt(r[3],10);return gT(i,a,l)}const s={white:"ffffff",black:"000000",red:"ff0000",green:"008000",blue:"0000ff",yellow:"ffff00",cyan:"00ffff",magenta:"ff00ff",gray:"808080",grey:"808080",orange:"ffa500",purple:"800080"};return s[e]?s[e]:null}function gT(t,e,n){const r=s=>Math.max(0,Math.min(255,s)).toString(16).padStart(2,"0");return`${r(t)}${r(e)}${r(n)}`}function Jo(t){const n=new DOMParser().parseFromString(t,"image/svg+xml"),r=n.querySelector("parsererror");if(r)return console.error("[SVG-REGION-TAGGER] Parse error:",r.textContent),t;const s=n.documentElement;if(!s.hasAttribute("viewBox")){const l=s.getAttribute("width"),c=s.getAttribute("height");if(l&&c){const d=parseFloat(l),u=parseFloat(c);!isNaN(d)&&!isNaN(u)&&(s.setAttribute("viewBox",`0 0 ${d} ${u}`),console.log(`[SVG-REGION-TAGGER] Added viewBox from dimensions: 0 0 ${d} ${u}`))}else{const d=yT(n);d&&(s.setAttribute("viewBox",`${d.x} ${d.y} ${d.width} ${d.height}`),console.log(`[SVG-REGION-TAGGER] Added viewBox from content bounds: ${d.x} ${d.y} ${d.width} ${d.height}`))}}let i=0;return n.querySelectorAll("path, rect, circle, ellipse, polygon, polyline, line").forEach(l=>{l.hasAttribute("data-region-id")||l.setAttribute("data-region-id",`region-${i++}`)}),console.log(`[SVG-REGION-TAGGER] Tagged ${i} regions`),new XMLSerializer().serializeToString(n)}function yT(t){try{const e=t.documentElement.cloneNode(!0),n=document.createElement("div");n.style.position="absolute",n.style.visibility="hidden",document.body.appendChild(n),n.appendChild(e);const r=e.getBBox();if(document.body.removeChild(n),r.width>0&&r.height>0)return{x:Math.floor(r.x),y:Math.floor(r.y),width:Math.ceil(r.width),height:Math.ceil(r.height)}}catch(e){console.warn("[SVG-REGION-TAGGER] Could not calculate content bounds:",e)}return null}function Wo(t,e){if(!e||e.size===0)return t;const r=new DOMParser().parseFromString(t,"image/svg+xml"),s=r.querySelector("parsererror");if(s)return console.error("[SVG-REGION-OVERRIDES] Parse error:",s.textContent),t;let i=0;return e.forEach((a,l)=>{const c=typeof a=="string"?a:a.hex,d=r.querySelector(`[data-region-id="${l}"]`);if(d){const u=c==="transparent"||c==="none";if((d.hasAttribute("fill")||u)&&(u?(d.setAttribute("fill","none"),d.setAttribute("fill-opacity","0")):(d.setAttribute("fill",c),d.removeAttribute("fill-opacity")),i++),d.hasAttribute("stroke")&&d.getAttribute("stroke")!=="none"){const p=d.getAttribute("stroke");p&&p!=="#000"&&p!=="#000000"&&p!=="#fff"&&p!=="#ffffff"&&(u?(d.setAttribute("stroke","none"),d.setAttribute("stroke-opacity","0")):d.setAttribute("stroke",c))}const h=d.getAttribute("style");if(h&&h.includes("fill:"))if(u){const p=h.replace(/fill:\s*[^;]+/,"fill: none");d.setAttribute("style",p)}else{const p=h.replace(/fill:\s*[^;]+/,`fill: ${c}`);d.setAttribute("style",p)}}else console.warn(`[SVG-REGION-OVERRIDES] Region not found: ${l}`)}),console.log(`[SVG-REGION-OVERRIDES] Applied ${i} region overrides`),new XMLSerializer().serializeToString(r)}async function t_(t){var x,g;const e=await Hl(t),n=(e==null?void 0:e.design)||e;if(!n)throw new Error("Design not found");if(n.input_mode==="sports_surface")throw new Error("Cannot use a sports surface design as a motif");const r=n.original_svg_url;if(!r||r.startsWith("blob:"))throw new Error("Design does not have a valid original SVG. Please ensure the design was saved after generation.");if(!n.solid_color_mapping&&!n.color_mapping)throw new Error("Design does not have color mappings. Please ensure the design was saved after color mapping.");console.log("[MOTIF] Fetching original SVG from:",r);const s=((x=n.design_data)==null?void 0:x.region_overrides)||n.region_overrides||null,i=((g=n.design_data)==null?void 0:g.original_tagged_svg)||n.original_tagged_svg||null;console.log("[MOTIF] Region overrides:",s?Object.keys(s).length:0,"regions"),console.log("[MOTIF] Original tagged SVG:",i?"present":"not present");const a=s?new Map(Object.entries(s)):null,l=await xT(r);if(!l)throw new Error("Failed to load or sanitize the original SVG.");console.log("[MOTIF] Original SVG loaded, regenerating recolored versions...");let c=null,d=null;if(n.solid_color_mapping&&Object.keys(n.solid_color_mapping).length>0)try{const w=Cy(n.solid_color_mapping);console.log("[MOTIF] Solid mapping has",w.size,"colors");const{svgText:b}=await Oi(null,w,l);if(c=b,console.log("[MOTIF] Generated solid SVG:",c.length,"chars"),a&&a.size>0&&c){console.log("[MOTIF] Applying",a.size,"region overrides to solid SVG");let k=c;k=Jo(c),c=Wo(k,a),console.log("[MOTIF] Applied region overrides to solid SVG")}}catch(w){console.error("[MOTIF] Failed to generate solid SVG:",w)}if(n.color_mapping&&Object.keys(n.color_mapping).length>0)try{const w=Cy(n.color_mapping);console.log("[MOTIF] Blend mapping has",w.size,"colors");const{svgText:b}=await Oi(null,w,l);if(d=b,console.log("[MOTIF] Generated blend SVG:",d.length,"chars"),a&&a.size>0&&d){console.log("[MOTIF] Applying",a.size,"region overrides to blend SVG");let k=Jo(d);d=Wo(k,a),console.log("[MOTIF] Applied region overrides to blend SVG")}}catch(w){console.error("[MOTIF] Failed to generate blend SVG:",w)}if(!c&&!d)throw new Error("Failed to regenerate TPV-recolored SVG versions.");const u=n.dimensions||{};let h=u.widthMM||u.width_mm||5e3,p=u.lengthMM||u.length_mm||5e3;const f=h===5e3&&p===5e3,m=c||d;if(m){const w=em(m);if(w&&w.width&&w.height){const b=w.width/w.height;(f||Math.abs(b-1)>.01)&&(b>1?(h=5e3,p=Math.round(5e3/b)):b<1&&(p=5e3,h=Math.round(5e3*b)),console.log("[MOTIF] Corrected dimensions from SVG viewBox:",h,"x",p,"mm (aspect ratio:",b.toFixed(3),")"))}}const y=n.thumbnail_url||n.original_png_url||null,v=c&&d;return{sourceDesignId:t,sourceDesignName:n.name||"Unnamed Design",sourceThumbnailUrl:y,solidSvgContent:c,blendSvgContent:d,svgContent:c||d,hasBothVersions:v,originalWidth_mm:h,originalHeight_mm:p}}function Cy(t){const e=new Map;if(!t||typeof t!="object")return e;for(const[n,r]of Object.entries(t)){const s=n.startsWith("#")?n:`#${n}`;e.set(s,r)}return e}async function xT(t){try{console.log("[MOTIF] Fetching SVG from:",t);const e=await fetch(t);if(!e.ok)return console.error("[MOTIF] Failed to fetch SVG:",e.status,e.statusText),null;const n=await e.text();if(console.log("[MOTIF] Fetched content length:",n.length,"chars"),console.log("[MOTIF] Content starts with:",n.substring(0,100)),!dT(n))return console.error("[MOTIF] SVG failed quick validation"),null;const r=Qf(n);return r?(console.log("[MOTIF] Sanitized SVG length:",r.length,"chars"),r):(console.error("[MOTIF] SVG sanitization failed"),null)}catch(e){return console.error("[MOTIF] Error fetching SVG:",e),null}}async function n_(t={}){const e=await Pd(t);return{designs:(e.designs||[]).filter(r=>r.input_mode==="sports_surface"?!1:r.thumbnail_url||r.original_svg_url||r.original_png_url),pagination:e.pagination}}function em(t){if(!t)return null;const e=t.match(/viewBox=["']([^"']+)["']/i);if(e){const s=e[1].split(/\s+/).map(Number);if(s.length>=4)return{width:s[2],height:s[3]}}const n=t.match(/\bwidth=["']?(\d+(?:\.\d+)?)/i),r=t.match(/\bheight=["']?(\d+(?:\.\d+)?)/i);return n&&r?{width:parseFloat(n[1]),height:parseFloat(r[1])}:null}const vT=Object.freeze(Object.defineProperty({__proto__:null,extractSVGDimensions:em,fetchMotifFromDesign:t_,listPlaygroundDesigns:n_},Symbol.toStringTag,{value:"Module"}));function r_({onOpenGenerator:t,mobileMode:e=!1,modalMode:n=!1,activeTab:r,onItemAdded:s}){const[i,a]=O.useState(null),[l,c]=O.useState("courts"),d=e?r:l,u=e?()=>{}:c,[h,p]=O.useState([]),[f,m]=O.useState(!1),[y,v]=O.useState(null),[x,g]=O.useState(null),{addCourt:w,addTrack:b,addMotif:k,addShape:_,courts:S,tracks:E,motifs:T,shapes:R}=at(),W=Object.keys(S).length,P=Object.keys(E).length,I=Object.keys(T).length,C=g5(),$=oT();O.useEffect(()=>{d==="designs"&&h.length===0&&!f&&fe()},[d]);const fe=async()=>{m(!0),v(null);try{const Q=await n_({limit:50});p(Q.designs||[])}catch(Q){console.error("[MOTIFS] Failed to load designs:",Q),v(Q.message||"Failed to load designs")}finally{m(!1)}},V=e||n,K=Q=>{const ke=y5(Q);ke&&(w(Q,ke),V&&s&&s())},F=Q=>{const ke=aT(Q);ke&&(b(Q,ke),V&&s&&s())},Z=async Q=>{if(!x){g(Q);try{const ke=await t_(Q);k(ke.sourceDesignId,ke.sourceDesignName,ke.svgContent,ke.originalWidth_mm,ke.originalHeight_mm,ke.sourceThumbnailUrl,{solidSvgContent:ke.solidSvgContent,blendSvgContent:ke.blendSvgContent,hasBothVersions:ke.hasBothVersions}),V&&s&&s()}catch(ke){console.error("[MOTIFS] Failed to add motif:",ke),alert(`Failed to add motif: ${ke.message}`)}finally{g(null)}}},U=[{id:"rectangle",name:"Rectangle",icon:""},{id:"square",name:"Square",icon:""},{id:"circle",name:"Circle",icon:""},{id:"triangle",name:"Triangle",icon:""},{id:"pentagon",name:"Pentagon",icon:""},{id:"hexagon",name:"Hexagon",icon:""},{id:"blob",name:"Blob",icon:""}],X=Object.keys(R||{}).length,de=(()=>{switch(d){case"courts":return{title:"Courts",count:W,hint:"Select a court to add"};case"tracks":return{title:"Tracks",count:P,hint:"Select a track to add"};case"shapes":return{title:"Shapes",count:X,hint:"Tap a shape to add it"};case"designs":return{title:"Designs",count:I,hint:"Add your saved designs as motifs"};default:return{title:"Library",count:0,hint:""}}})();return o.jsxs("div",{className:`court-library ${e?"court-library--mobile":""}`,children:[!e&&o.jsxs("div",{className:"court-library__header",children:[o.jsxs("div",{className:"court-library__header-row",children:[o.jsx("h2",{children:de.title}),o.jsxs("span",{className:"court-library__count",children:[de.count," on canvas"]})]}),o.jsx("p",{children:de.hint})]}),!e&&o.jsxs("div",{className:"court-library__tabs",children:[o.jsx("button",{className:`court-library__tab ${d==="courts"?"court-library__tab--active":""}`,onClick:()=>{u("courts"),a(null)},children:"Courts"}),o.jsx("button",{className:`court-library__tab ${d==="tracks"?"court-library__tab--active":""}`,onClick:()=>{u("tracks"),a(null)},children:"Tracks"}),o.jsx("button",{className:`court-library__tab ${d==="designs"?"court-library__tab--active":""}`,onClick:()=>{u("designs"),a(null)},children:"Designs"})]}),o.jsxs("div",{className:`court-library__list ${e?"court-library__list--mobile":""}`,children:[d==="courts"&&C.map(Q=>o.jsxs("div",{className:`court-library__item ${i===Q.id?"court-library__item--selected":""}`,onClick:()=>V?K(Q.id):a(Q.id),onDoubleClick:()=>!V&&K(Q.id),children:[o.jsx("div",{className:"court-library__preview",children:o.jsx(bT,{template:Q})}),o.jsxs("div",{className:"court-library__info",children:[o.jsx("div",{className:"court-library__name",children:Q.name}),o.jsxs("div",{className:"court-library__dimensions",children:[(Q.dimensions.width_mm/1e3).toFixed(1),"m  ",(Q.dimensions.length_mm/1e3).toFixed(1),"m"]}),o.jsx("div",{className:"court-library__standard",children:Q.standard})]}),i===Q.id&&o.jsx("button",{className:"court-library__add-btn",onClick:ke=>{ke.stopPropagation(),K(Q.id)},children:"+ ADD"})]},Q.id)),d==="tracks"&&$.map(Q=>o.jsxs("div",{className:`court-library__item ${i===Q.id?"court-library__item--selected":""}`,onClick:()=>V?F(Q.id):a(Q.id),onDoubleClick:()=>!V&&F(Q.id),children:[o.jsx("div",{className:"court-library__preview",children:o.jsx(_T,{template:Q})}),o.jsxs("div",{className:"court-library__info",children:[o.jsx("div",{className:"court-library__name",children:Q.name}),o.jsxs("div",{className:"court-library__standard",children:[Q.parameters.numLanes," Lanes  ",Q.standard]}),o.jsx("div",{className:"court-library__note",children:"Scales to fit canvas"})]}),i===Q.id&&o.jsx("button",{className:"court-library__add-btn",onClick:ke=>{ke.stopPropagation(),F(Q.id)},children:"+ ADD"})]},Q.id)),d==="shapes"&&o.jsx("div",{className:`court-library__shapes-grid ${e?"court-library__shapes-grid--mobile":""}`,children:U.map(Q=>o.jsxs("button",{className:"court-library__shape-btn",onClick:()=>{_(Q.id),e&&s&&s()},children:[o.jsx("span",{className:"court-library__shape-icon",children:Q.icon}),o.jsx("span",{className:"court-library__shape-name",children:Q.name})]},Q.id))}),d==="designs"&&o.jsxs(o.Fragment,{children:[f&&o.jsxs("div",{className:"court-library__loading",children:[o.jsx("div",{className:"court-library__spinner"}),o.jsx("p",{children:"Loading your designs..."})]}),y&&o.jsxs("div",{className:"court-library__error",children:[o.jsx("p",{children:y}),o.jsx("button",{onClick:fe,children:"Try Again"})]}),!f&&!y&&h.length===0&&o.jsxs("div",{className:"court-library__empty",children:[o.jsx("p",{children:"No designs found."}),o.jsx("p",{className:"court-library__empty-hint",children:"Generate new designs or save them to use as motifs."})]}),!f&&h.map(Q=>{var ke,Oe;return o.jsxs("div",{className:`court-library__item ${i===Q.id?"court-library__item--selected":""} ${x===Q.id?"court-library__item--loading":""}`,onClick:()=>V?Z(Q.id):a(Q.id),onDoubleClick:()=>!V&&Z(Q.id),children:[o.jsx("div",{className:"court-library__preview",children:o.jsx(kT,{design:Q})}),o.jsxs("div",{className:"court-library__info",children:[o.jsx("div",{className:"court-library__name",children:Q.name||"Unnamed Design"}),o.jsxs("div",{className:"court-library__dimensions",children:[((((ke=Q.design_data)==null?void 0:ke.widthMM)||5e3)/1e3).toFixed(1),"m  ",((((Oe=Q.design_data)==null?void 0:Oe.lengthMM)||5e3)/1e3).toFixed(1),"m"]}),o.jsx("div",{className:"court-library__note",children:"Playground Design"})]}),i===Q.id&&o.jsx("button",{className:"court-library__add-btn",onClick:De=>{De.stopPropagation(),Z(Q.id)},disabled:x===Q.id,children:x===Q.id?"Adding...":"+ ADD"})]},Q.id)})]})]}),!e&&o.jsx("div",{className:"court-library__generate",children:o.jsxs("button",{className:"court-library__generate-btn",onClick:t,children:[o.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M12 5v14M5 12h14"})}),"Generate New Design"]})}),!e&&!n&&o.jsx("div",{className:"court-library__footer",children:o.jsxs("p",{className:"court-library__hint",children:[d==="courts"&&"Double-click a court to add it instantly",d==="tracks"&&"Double-click a track to add it instantly",d==="designs"&&"Double-click a design to add it as a motif"]})})]})}function bT({template:t}){const e=t.dimensions.width_mm,n=t.dimensions.length_mm,r=Math.min(62/e,62/n),s=e*r,i=n*r;return o.jsxs("svg",{width:"62",height:"62",viewBox:"0 0 62 62",className:"court-library__svg-preview",children:[o.jsx("rect",{x:(62-s)/2,y:(62-i)/2,width:s,height:i,fill:"#e5e7eb",stroke:"#9ca3af",strokeWidth:"1.5"}),t.markings.map((a,l)=>o.jsx(wT,{marking:a,scale:r,offsetX:(62-s)/2,offsetY:(62-i)/2},l))]})}function wT({marking:t,scale:e,offsetX:n,offsetY:r}){const{type:s,params:i}=t;switch(s){case"line":return o.jsx("line",{x1:i.x1*e+n,y1:i.y1*e+r,x2:i.x2*e+n,y2:i.y2*e+r,stroke:"#1e293b",strokeWidth:"1.5"});case"rectangle":return o.jsx("rect",{x:i.x*e+n,y:i.y*e+r,width:i.width*e,height:i.height*e,stroke:"#1e293b",strokeWidth:"1.5",fill:"none"});case"circle":return o.jsx("circle",{cx:i.cx*e+n,cy:i.cy*e+r,r:i.radius*e,stroke:"#1e293b",strokeWidth:"1.5",fill:"none"});case"arc":{const{cx:a,cy:l,radius:c,startAngle:d,endAngle:u}=i,h=d*Math.PI/180,p=u*Math.PI/180,f=(a+c*Math.cos(h))*e+n,m=(l+c*Math.sin(h))*e+r,y=(a+c*Math.cos(p))*e+n,v=(l+c*Math.sin(p))*e+r,x=u-d>180?1:0,g=`M ${f} ${m} A ${c*e} ${c*e} 0 ${x} 1 ${y} ${v}`;return o.jsx("path",{d:g,stroke:"#1e293b",strokeWidth:"1.5",fill:"none"})}default:return null}}function _T({template:t}){const{parameters:e}=t,n=e.width_mm,r=e.height_mm,s=Math.min(58/n,58/r),i=n*s,a=r*s,l=e.numLanes,c=e.laneWidth_mm*s,d=e.cornerRadius,h=(d.topLeft+d.topRight+d.bottomLeft+d.bottomRight)/4*s,p=(62-i)/2,f=(62-a)/2;return o.jsxs("svg",{width:"62",height:"62",viewBox:"0 0 62 62",className:"court-library__svg-preview",children:[o.jsx("rect",{x:p,y:f,width:i,height:a,rx:h,fill:"#e5e7eb"}),Array.from({length:l}).map((m,y)=>{const v=y*c,x=Math.max(0,h-v);return o.jsx("rect",{x:p+v,y:f+v,width:Math.max(0,i-v*2),height:Math.max(0,a-v*2),rx:x,stroke:"#1e293b",strokeWidth:"1",fill:"none"},y)})]})}function kT({design:t}){const e=t.thumbnail_url||t.original_png_url;return e?o.jsx("img",{src:e,alt:t.name||"Design preview",className:"court-library__motif-img",style:{width:"62px",height:"62px",objectFit:"contain",borderRadius:"4px",backgroundColor:"#f3f4f6"},onError:n=>{n.target.style.display="none",n.target.nextSibling&&(n.target.nextSibling.style.display="flex")}}):o.jsx("div",{className:"court-library__motif-placeholder",style:{width:"62px",height:"62px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#e5e7eb",borderRadius:"4px",color:"#9ca3af",fontSize:"10px",textAlign:"center"},children:"No Preview"})}function ST({isOpen:t,onClose:e,onOpenGenerator:n}){return O.useEffect(()=>{if(!t)return;const r=s=>{s.key==="Escape"&&e()};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[t,e]),O.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[t]),t?o.jsx("div",{className:"court-library-modal__overlay",onClick:e,children:o.jsxs("div",{className:"court-library-modal__container",onClick:r=>r.stopPropagation(),children:[o.jsxs("div",{className:"court-library-modal__header",children:[o.jsx("h2",{children:"Element Library"}),o.jsx("p",{children:"Select courts, tracks, or designs to add to your canvas"}),o.jsx("button",{className:"court-library-modal__close",onClick:e,"aria-label":"Close",children:o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),o.jsx("div",{className:"court-library-modal__content",children:o.jsx(r_,{modalMode:!0,onItemAdded:e,onOpenGenerator:()=>{e(),n()}})})]})}):null}function Ey({onEditSourceDesign:t}){var z,A;const{courts:e,tracks:n,motifs:r,shapes:s,texts:i,exclusionZones:a,groups:l,selectedCourtId:c,selectedTrackId:d,selectedMotifId:u,selectedShapeId:h,selectedTextId:p,selectedExclusionZoneId:f,selectedGroupId:m,editingGroupId:y,updateCourtPosition:v,updateCourtRotation:x,updateCourtScale:g,setLineColor:w,setZoneColor:b,setCourtSurfaceColor:k,resetCourtColors:_,removeCourt:S,removeTrack:E,removeMotif:T,updateMotifPosition:R,updateMotifRotation:W,updateMotifScale:P,updateTrackParameters:I,enterGroup:C,exitGroup:$,ungroup:fe,deleteGroupWithChildren:V,addToHistory:K}=at(),[F,Z]=O.useState("transform"),[U,X]=O.useState(null);if(m){const M=l[m];return M?o.jsx(PT,{group:M,groupId:m,shapes:s,isEditing:y===m,onEnterGroup:()=>C(m),onExitGroup:()=>$(),onUngroup:()=>fe(m),onDelete:()=>V(m)}):null}if(f){const M=a[f];return M?o.jsx(NT,{zone:M,zoneId:f}):null}if(p){const M=i[p];return M?o.jsx(TT,{text:M,textId:p}):null}if(h){const M=s[h];return M?o.jsx(ET,{shape:M,shapeId:h}):null}if(u){const M=r[u];return M?o.jsx(CT,{motif:M,motifId:u,onEditSourceDesign:t}):null}if(d){const M=n[d];return M?o.jsx(jT,{track:M,trackId:d}):null}if(!c)return o.jsx("div",{className:"properties-panel properties-panel--empty",children:o.jsxs("div",{className:"properties-panel__empty-state",children:[o.jsx("p",{children:"No element selected"}),o.jsx("span",{className:"properties-panel__hint",children:"Click on a court, track, or motif to view and edit its properties"})]})});const ge=e[c];if(!ge)return null;const{position:de,rotation:Q,scale:ke,template:Oe,lineColorOverrides:De,zoneColorOverrides:Be}=ge,Ge=(M,G)=>{const ie=parseFloat(G);isNaN(ie)||v(c,{...de,[M]:ie})},He=M=>{const G=parseFloat(M);isNaN(G)||x(c,G)},Xe=M=>{const G=parseFloat(M);isNaN(G)||G<=0||g(c,G)},nt=()=>{window.confirm(`Delete ${Oe.name}? This action cannot be undone.`)&&S(c)},j=M=>{if(!U)return;if(U.type==="courtSurface"&&M===null){k(c,null),X(null);return}if(!M)return;const G={tpv_code:M.code,hex:M.hex,name:M.name};U.type==="line"?w(c,U.id,G):U.type==="zone"?b(c,U.id,G):U.type==="courtSurface"?k(c,G):U.type==="allLines"&&Oe.markings.forEach(ie=>{w(c,ie.id,G)}),X(null)},ne=M=>{const G=De[M.id];if(G)return{code:G.tpv_code,hex:G.hex,name:G.name};const ie=wn.find(Y=>Y.code===Oe.defaultLineColor);return ie?{code:ie.code,hex:ie.hex,name:ie.name}:null},oe=M=>{const G=Be[M.id];if(G)return{code:G.tpv_code,hex:G.hex,name:G.name};const ie=wn.find(Y=>Y.code===M.defaultColor);return ie?{code:ie.code,hex:ie.hex,name:ie.name}:null};return o.jsxs("div",{className:"properties-panel",children:[o.jsxs("div",{className:"properties-panel__header",children:[o.jsx("h3",{children:"Properties"}),o.jsxs("div",{className:"properties-panel__court-info",children:[o.jsx("span",{className:"court-name",children:Oe.name}),o.jsx("span",{className:"court-standard",children:Oe.standard})]})]}),o.jsxs("div",{className:"properties-panel__tabs",children:[o.jsx("button",{className:`tab ${F==="transform"?"tab--active":""}`,onClick:()=>Z("transform"),children:"Transform"}),o.jsx("button",{className:`tab ${F==="lines"?"tab--active":""}`,onClick:()=>Z("lines"),children:"Lines"}),o.jsx("button",{className:`tab ${F==="zones"?"tab--active":""}`,onClick:()=>Z("zones"),children:"Zones"})]}),o.jsxs("div",{className:"properties-panel__content",children:[F==="transform"&&o.jsxs("div",{className:"properties-section",children:[o.jsx("div",{className:"properties-section__header",children:o.jsx("h4",{children:"Transform"})}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Position"}),o.jsxs("div",{className:"property-input-row",children:[o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"X"}),o.jsx("input",{type:"number",value:Math.round(de.x),onChange:M=>Ge("x",M.target.value),step:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"Y"}),o.jsx("input",{type:"number",value:Math.round(de.y),onChange:M=>Ge("y",M.target.value),step:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Rotation"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"0",max:"360",value:Q,onChange:M=>He(M.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:Math.round(Q),onChange:M=>He(M.target.value),min:"0",max:"360"}),o.jsx("span",{className:"property-unit",children:""})]})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Scale"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"0.5",max:"2.0",step:"0.1",value:ke,onChange:M=>Xe(M.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:ke.toFixed(2),onChange:M=>Xe(M.target.value),min:"0.5",max:"2.0",step:"0.1"}),o.jsx("span",{className:"property-unit",children:""})]})]})]}),o.jsxs("div",{className:"property-group property-group--info",children:[o.jsx("label",{children:"Dimensions"}),o.jsx("div",{className:"property-info",children:o.jsxs("span",{children:[(Oe.dimensions.width_mm*ke/1e3).toFixed(1),"m  ",(Oe.dimensions.length_mm*ke/1e3).toFixed(1),"m"]})})]}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-delete",onClick:nt,title:"Delete court (Delete key)",children:" Delete Court"})})]}),F==="lines"&&o.jsxs("div",{className:"properties-section",children:[o.jsxs("div",{className:"properties-section__header",children:[o.jsx("h4",{children:"Line Markings"}),o.jsx("button",{className:"btn-reset",onClick:()=>_(c),title:"Reset all colours to defaults",children:"Reset"})]}),o.jsxs("div",{className:"color-item color-item--all-lines",children:[o.jsxs("div",{className:"color-item__info",children:[o.jsx("span",{className:"color-item__name",children:"Change All Lines"}),o.jsx("span",{className:"color-item__hint",children:"Set all lines to same colour"})]}),o.jsx("button",{className:"color-item__swatch color-item__swatch--all",onClick:()=>X({type:"allLines"}),title:"Change all line colours at once",children:o.jsx("span",{style:{fontSize:"1rem"},children:""})})]}),o.jsx("div",{className:"color-list",children:Oe.markings.map(M=>{const G=ne(M);return o.jsxs("div",{className:"color-item",children:[o.jsxs("div",{className:"color-item__info",children:[o.jsx("span",{className:"color-item__name",children:M.name}),G&&o.jsx("span",{className:"color-item__code",children:G.code})]}),o.jsx("button",{className:"color-item__swatch",style:{backgroundColor:(G==null?void 0:G.hex)||"#000"},onClick:()=>X({type:"line",id:M.id}),title:(G==null?void 0:G.name)||"Select colour"})]},M.id)})})]}),F==="zones"&&o.jsxs("div",{className:"properties-section",children:[o.jsx("div",{className:"properties-section__header",children:o.jsx("h4",{children:"Fill Colours"})}),o.jsxs("div",{className:"color-item color-item--surface-fill",children:[o.jsxs("div",{className:"color-item__info",children:[o.jsx("span",{className:"color-item__name",children:"Court Surface"}),o.jsx("span",{className:"color-item__hint",children:ge.courtSurfaceColor?ge.courtSurfaceColor.name:"No Fill (transparent)"}),ge.courtSurfaceColor&&o.jsx("span",{className:"color-item__code",children:ge.courtSurfaceColor.tpv_code})]}),o.jsx("button",{className:`color-item__swatch ${ge.courtSurfaceColor?"":"color-item__swatch--no-fill"}`,style:{backgroundColor:((z=ge.courtSurfaceColor)==null?void 0:z.hex)||"transparent"},onClick:()=>X({type:"courtSurface"}),title:((A=ge.courtSurfaceColor)==null?void 0:A.name)||"No Fill - Click to select colour"})]}),Oe.zones&&Oe.zones.length>0&&o.jsx("div",{className:"properties-section__divider",children:o.jsx("span",{children:"Paint Zones"})}),Oe.zones&&Oe.zones.length>0&&o.jsx("div",{className:"color-list",children:Oe.zones.map(M=>{var ie;const G=oe(M);return o.jsxs("div",{className:"color-item",children:[o.jsxs("div",{className:"color-item__info",children:[o.jsx("span",{className:"color-item__name",children:M.name}),o.jsxs("span",{className:"color-item__area",children:[((ie=M.area_m2)==null?void 0:ie.toFixed(1))||0," m"]}),G&&o.jsx("span",{className:"color-item__code",children:G.code})]}),o.jsx("button",{className:"color-item__swatch",style:{backgroundColor:(G==null?void 0:G.hex)||"#000"},onClick:()=>X({type:"zone",id:M.id}),title:(G==null?void 0:G.name)||"Select colour"})]},M.id)})})]})]}),U&&o.jsx("div",{className:"color-picker-modal",onClick:()=>X(null),children:o.jsxs("div",{className:"color-picker-modal__content",onClick:M=>M.stopPropagation(),children:[o.jsxs("div",{className:"color-picker-modal__header",children:[o.jsx("h4",{children:U.type==="allLines"?"Change All Line Colours":U.type==="courtSurface"?"Select Court Fill Colour":"Select TPV Colour"}),o.jsx("button",{onClick:()=>X(null),children:""})]}),o.jsxs("div",{className:"color-picker-grid",children:[U.type==="courtSurface"&&o.jsx("button",{className:"color-picker-swatch color-picker-swatch--no-fill",onClick:()=>j(null),title:"No Fill (transparent)",children:o.jsx("span",{className:"color-picker-swatch__code",children:"None"})}),wn.map(M=>o.jsx("button",{className:"color-picker-swatch",style:{backgroundColor:M.hex},onClick:()=>j(M),title:`${M.code} - ${M.name}`,children:o.jsx("span",{className:"color-picker-swatch__code",children:M.code})},M.code))]})]})})]})}function jT({track:t,trackId:e}){var Ne,ze,Pe;const{updateTrackParameters:n,updateTrackRotation:r,removeTrack:s,setTrackSurfaceColor:i,setTrackLineColor:a,setLaneSurfaceColor:l,resetLaneSurfaceColors:c,addToHistory:d}=at(),{parameters:u,template:h,trackSurfaceColor:p,trackLineColor:f,laneSurfaceColors:m,rotation:y}=t,[v,x]=D.useState(!0),[g,w]=D.useState(!1),[b,k]=D.useState(!1),[_,S]=D.useState(null),[E,T]=D.useState(""),[R,W]=D.useState(""),[P,I]=D.useState(""),[C,$]=D.useState(!1),[fe,V]=D.useState(!1),[K,F]=D.useState(!1),Z=h.trackType==="straight",U=q1(u),X=((Ne=U.lanes[0])==null?void 0:Ne.perimeter)||0,ge=U.lanes[U.lanes.length-1],de=(ge==null?void 0:ge.perimeter)||0,Q=Z?[]:X1(U),ke=te=>{const pe=parseInt(te);if(!(isNaN(pe)||pe<1||pe>8))if(Z){const qe=pe*u.laneWidth_mm;n(e,{numLanes:pe,width_mm:qe})}else n(e,{numLanes:pe})},Oe=te=>{const pe=parseFloat(te)*1e3;return isNaN(pe)||pe<3e3?!1:(n(e,{width_mm:pe}),!0)},De=te=>{const pe=parseFloat(te)*1e3;return isNaN(pe)||pe<3e3?!1:(n(e,{height_mm:pe}),!0)},Be=()=>{$(!0),T((u.width_mm/1e3).toFixed(1))},Ge=()=>{$(!1),Oe(E)},He=te=>{te.key==="Enter"?te.target.blur():te.key==="Escape"&&($(!1),T((u.width_mm/1e3).toFixed(1)))},Xe=()=>{V(!0),W((u.height_mm/1e3).toFixed(1))},nt=()=>{V(!1),De(R)},j=te=>{te.key==="Enter"?te.target.blur():te.key==="Escape"&&(V(!1),W((u.height_mm/1e3).toFixed(1)))},ne=te=>{let pe=parseFloat(te);return isNaN(pe)?!1:(pe=(pe%360+360)%360,r(e,pe),d(),!0)},oe=()=>{F(!0),I(y.toFixed(0))},z=()=>{F(!1),ne(P)},A=te=>{te.key==="Enter"?te.target.blur():te.key==="Escape"&&(F(!1),I(y.toFixed(0)))},M=(te,pe)=>{const qe=parseFloat(pe)*1e3;if(isNaN(qe)||qe<0)return;const st=Math.min(u.width_mm,u.height_mm)/2,rt=Math.min(qe,st);v?n(e,{cornerRadius:{topLeft:rt,topRight:rt,bottomLeft:rt,bottomRight:rt}}):n(e,{cornerRadius:{...u.cornerRadius,[te]:rt}})},G=()=>{window.confirm(`Delete ${h.name}? This action cannot be undone.`)&&s(e)},ie=te=>{i(e,{tpv_code:te.code,hex:te.hex,name:te.name}),w(!1)},Y=te=>{a(e,{tpv_code:te.code,hex:te.hex,name:te.name}),k(!1)},se=te=>{n(e,{startingBoxes:{...u.startingBoxes,enabled:te}})},we=te=>{const pe=parseFloat(te)*1e3;isNaN(pe)||pe<100||n(e,{startingBoxes:{...u.startingBoxes,depth_mm:pe}})},ue=te=>{n(e,{startingBoxes:{...u.startingBoxes,style:te}})},q=te=>{n(e,{startingBoxes:{...u.startingBoxes,direction:te}})},le=te=>{const pe=parseFloat(te);isNaN(pe)||pe<0||pe>100||n(e,{startingBoxes:{...u.startingBoxes,startPosition:pe}})},be=(u.cornerRadius.topLeft+u.cornerRadius.topRight+u.cornerRadius.bottomLeft+u.cornerRadius.bottomRight)/4;return o.jsxs("div",{className:"properties-panel",children:[o.jsxs("div",{className:"properties-panel__header",children:[o.jsx("h3",{children:"Track Properties"}),o.jsxs("div",{className:"properties-panel__court-info",children:[o.jsx("span",{className:"court-name",children:h.name}),o.jsx("span",{className:"court-standard",children:h.standard})]})]}),o.jsx("div",{className:"properties-panel__content",children:o.jsxs("div",{className:"properties-section",children:[o.jsx("div",{className:"properties-section__header",children:o.jsx("h4",{children:"Track Parameters"})}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Number of Lanes"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"1",max:"8",value:u.numLanes,onChange:te=>ke(te.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:u.numLanes,onChange:te=>ke(te.target.value),min:"1",max:"8"}),o.jsx("span",{className:"property-unit",children:"lanes"})]})]})]}),Z?o.jsxs("div",{className:"property-group property-group--info",children:[o.jsx("label",{children:"Track Width"}),o.jsx("div",{className:"property-info",children:o.jsxs("span",{children:[(u.width_mm/1e3).toFixed(1),"m (Auto-calculated from lanes)"]})})]}):o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Track Width"}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("input",{type:"number",value:C?E:(u.width_mm/1e3).toFixed(1),onChange:te=>T(te.target.value),onFocus:Be,onBlur:Ge,onKeyDown:He,min:"3",max:"100",step:"0.5"}),o.jsx("span",{className:"property-unit",children:"m"})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:Z?"Track Length":"Track Height"}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("input",{type:"number",value:fe?R:(u.height_mm/1e3).toFixed(1),onChange:te=>W(te.target.value),onFocus:Xe,onBlur:nt,onKeyDown:j,min:"3",max:"100",step:"0.5"}),o.jsx("span",{className:"property-unit",children:"m"})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Rotation"}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("input",{type:"number",value:K?P:y.toFixed(0),onChange:te=>I(te.target.value),onFocus:oe,onBlur:z,onKeyDown:A,min:"0",max:"360",step:"15"}),o.jsx("span",{className:"property-unit",children:""})]})]}),!Z&&o.jsxs("div",{className:"property-group",children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[o.jsx("label",{children:"Corner Radius"}),o.jsx("button",{className:"btn-toggle",onClick:()=>x(!v),style:{padding:"0.25rem 0.5rem",fontSize:"0.75rem",background:v?"#0066CC":"#6b7280",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},title:v?"Click to edit corners independently":"Click to lock all corners together",children:v?" Locked":" Independent"})]}),v?o.jsxs("div",{className:"property-input-group",children:[o.jsx("input",{type:"number",value:(be/1e3).toFixed(2),onChange:te=>M("topLeft",te.target.value),min:"0",max:(Math.min(u.width_mm,u.height_mm)/2e3).toFixed(0),step:"0.5"}),o.jsx("span",{className:"property-unit",children:"m"})]}):o.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.5rem"},children:[o.jsxs("div",{children:[o.jsx("label",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Top Left"}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("input",{type:"number",value:(u.cornerRadius.topLeft/1e3).toFixed(2),onChange:te=>M("topLeft",te.target.value),min:"0",max:(Math.min(u.width_mm,u.height_mm)/2e3).toFixed(0),step:"0.5"}),o.jsx("span",{className:"property-unit",children:"m"})]})]}),o.jsxs("div",{children:[o.jsx("label",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Top Right"}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("input",{type:"number",value:(u.cornerRadius.topRight/1e3).toFixed(2),onChange:te=>M("topRight",te.target.value),min:"0",max:(Math.min(u.width_mm,u.height_mm)/2e3).toFixed(0),step:"0.5"}),o.jsx("span",{className:"property-unit",children:"m"})]})]}),o.jsxs("div",{children:[o.jsx("label",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Bottom Left"}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("input",{type:"number",value:(u.cornerRadius.bottomLeft/1e3).toFixed(2),onChange:te=>M("bottomLeft",te.target.value),min:"0",max:(Math.min(u.width_mm,u.height_mm)/2e3).toFixed(0),step:"0.5"}),o.jsx("span",{className:"property-unit",children:"m"})]})]}),o.jsxs("div",{children:[o.jsx("label",{style:{fontSize:"0.75rem",color:"#64748b"},children:"Bottom Right"}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("input",{type:"number",value:(u.cornerRadius.bottomRight/1e3).toFixed(2),onChange:te=>M("bottomRight",te.target.value),min:"0",max:(Math.min(u.width_mm,u.height_mm)/2e3).toFixed(0),step:"0.5"}),o.jsx("span",{className:"property-unit",children:"m"})]})]})]})]}),o.jsxs("div",{className:"property-group property-group--info",children:[o.jsx("label",{children:"Lane Width"}),o.jsx("div",{className:"property-info",children:o.jsxs("span",{children:[(u.laneWidth_mm/1e3).toFixed(2),"m (Fixed)"]})})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Track Surface Colour"}),o.jsxs("div",{className:"color-item",children:[o.jsxs("div",{className:"color-item__info",children:[o.jsx("span",{className:"color-item__name",children:(p==null?void 0:p.name)||"Select Colour"}),p&&o.jsx("span",{className:"color-item__code",children:p.tpv_code})]}),o.jsx("button",{className:"color-item__swatch",style:{backgroundColor:(p==null?void 0:p.hex)||"#A5362F"},onClick:()=>w(!0),title:(p==null?void 0:p.name)||"Select colour"})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[o.jsx("label",{style:{margin:0},children:"Lane Colours"}),(m==null?void 0:m.some(te=>te!=null))&&o.jsx("button",{onClick:()=>c(e),title:"Reset all lanes to track surface colour",style:{padding:"0.25rem 0.5rem",fontSize:"0.7rem",background:"#f1f5f9",border:"1px solid #e2e8f0",borderRadius:"4px",cursor:"pointer",color:"#64748b"},children:"Reset All"})]}),o.jsx("div",{className:"lane-color-grid",children:U.lanes.map(te=>{const pe=(m==null?void 0:m[te.laneNumber-1])||p,qe=(m==null?void 0:m[te.laneNumber-1])!=null;return o.jsxs("div",{className:"lane-color-item",children:[o.jsxs("span",{className:"lane-number",children:["Lane ",te.laneNumber]}),o.jsx("button",{className:`color-item__swatch lane-swatch ${qe?"lane-swatch--override":""}`,style:{backgroundColor:(pe==null?void 0:pe.hex)||"#A5362F"},onClick:()=>S({laneNumber:te.laneNumber}),title:`${(pe==null?void 0:pe.name)||"Standard Red"}${qe?" (custom)":" (default)"}`}),qe&&o.jsx("button",{className:"lane-reset-btn",onClick:()=>l(e,te.laneNumber,null),title:"Reset to track default",children:""})]},te.laneNumber)})}),o.jsx("div",{style:{fontSize:"0.7rem",color:"#94a3b8",marginTop:"0.5rem"},children:"Click a swatch to change lane colour"})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Line Colour"}),o.jsxs("div",{className:"color-item",children:[o.jsxs("div",{className:"color-item__info",children:[o.jsx("span",{className:"color-item__name",children:(f==null?void 0:f.name)||"Cream"}),f&&o.jsx("span",{className:"color-item__code",children:f.tpv_code})]}),o.jsx("button",{className:"color-item__swatch",style:{backgroundColor:(f==null?void 0:f.hex)||"#E8E3D8"},onClick:()=>k(!0),title:(f==null?void 0:f.name)||"Select colour"})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[o.jsx("input",{type:"checkbox",checked:((ze=u.startingBoxes)==null?void 0:ze.enabled)||!1,onChange:te=>se(te.target.checked)}),"Show Starting Boxes"]}),((Pe=u.startingBoxes)==null?void 0:Pe.enabled)&&o.jsxs("div",{style:{marginTop:"0.75rem"},children:[o.jsxs("div",{className:"property-input-group",style:{marginBottom:"0.75rem"},children:[o.jsx("span",{className:"property-label",style:{fontSize:"0.875rem"},children:"Depth"}),o.jsx("input",{type:"number",value:(u.startingBoxes.depth_mm/1e3).toFixed(2),onChange:te=>we(te.target.value),min:"0.1",max:"1.0",step:"0.05"}),o.jsx("span",{className:"property-unit",children:"m"})]}),!Z&&o.jsxs("div",{style:{marginBottom:"0.75rem"},children:[o.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#64748b",marginBottom:"0.375rem"},children:"Start Style"}),o.jsxs("select",{value:u.startingBoxes.style||"staggered",onChange:te=>ue(te.target.value),style:{width:"100%",padding:"0.5rem",border:"1px solid #e4e9f0",borderRadius:"6px",fontSize:"0.875rem",fontFamily:"inherit",background:"white"},children:[o.jsx("option",{value:"straight",children:"Straight Start"}),o.jsx("option",{value:"staggered",children:"Staggered Start"}),o.jsx("option",{value:"both",children:"Both (opposite ends)"})]})]}),o.jsxs("div",{style:{marginBottom:"0.75rem"},children:[o.jsx("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#64748b",marginBottom:"0.375rem"},children:"Direction of Travel"}),o.jsxs("select",{value:u.startingBoxes.direction||"counterclockwise",onChange:te=>q(te.target.value),style:{width:"100%",padding:"0.5rem",border:"1px solid #e4e9f0",borderRadius:"6px",fontSize:"0.875rem",fontFamily:"inherit",background:"white"},children:[o.jsx("option",{value:"counterclockwise",children:"Counterclockwise (Standard)"}),o.jsx("option",{value:"clockwise",children:"Clockwise"})]})]}),!Z&&o.jsxs("div",{style:{marginBottom:"0.75rem"},children:[o.jsxs("label",{style:{display:"block",fontSize:"0.875rem",fontWeight:"500",color:"#64748b",marginBottom:"0.375rem"},children:["Start Position (",u.startingBoxes.startPosition||0,"%)"]}),o.jsx("input",{type:"range",min:"0",max:"100",step:"1",value:u.startingBoxes.startPosition||0,onChange:te=>le(te.target.value),className:"property-slider",style:{width:"100%"}}),o.jsx("div",{style:{fontSize:"0.7rem",color:"#94a3b8",marginTop:"0.25rem"},children:"Slide to adjust where the start line appears around the track"})]}),o.jsx("div",{className:"property-info",style:{fontSize:"0.75rem",color:"#64748b",marginTop:"0.5rem"},children:"Boxes use track surface colour with white starting line and lane numbers"}),!Z&&Q.length>0&&(u.startingBoxes.style==="staggered"||u.startingBoxes.style==="both")&&o.jsxs("div",{style:{marginTop:"0.75rem",padding:"0.5rem",background:"#f8fafc",borderRadius:"4px"},children:[o.jsx("div",{style:{fontSize:"0.75rem",fontWeight:"600",color:"#1e293b",marginBottom:"0.25rem"},children:"Auto-Calculated Staggers:"}),o.jsx("div",{style:{fontSize:"0.7rem",color:"#64748b",lineHeight:"1.4"},children:Q.map((te,pe)=>o.jsxs("div",{children:["Lane ",pe+1,": ",(te/1e3).toFixed(2),"m"]},pe))}),o.jsx("div",{style:{fontSize:"0.65rem",color:"#64748b",marginTop:"0.25rem",fontStyle:"italic"},children:"Outer lanes start ahead to equalize distance"})]})]})]}),o.jsx("div",{className:"property-divider"}),o.jsx("div",{className:"properties-section__header",children:o.jsx("h4",{children:"Calculated Dimensions"})}),o.jsxs("div",{className:"property-group property-group--info",children:[o.jsx("label",{children:"Usable Infield"}),o.jsx("div",{className:"property-info",children:o.jsxs("span",{children:[(U.usableWidth/1e3).toFixed(1),"m  ",(U.usableHeight/1e3).toFixed(1),"m"]})})]}),o.jsxs("div",{className:"property-group property-group--info",children:[o.jsx("label",{children:"Lane 1 Perimeter"}),o.jsx("div",{className:"property-info",children:o.jsxs("span",{children:[X.toFixed(2),"m"]})})]}),u.numLanes>1&&!Z&&o.jsxs("div",{className:"property-group property-group--info",children:[o.jsxs("label",{children:["Lane ",u.numLanes," Perimeter"]}),o.jsx("div",{className:"property-info",children:o.jsxs("span",{children:[de.toFixed(2),"m"]})})]}),o.jsx("div",{className:"property-group",children:o.jsx("div",{className:"property-hint",style:{fontStyle:"normal",color:"#64748b",fontSize:"0.75rem",marginTop:"1rem"},children:" Tip: Use drag handles on the canvas or edit values here. Corner radius auto-adjusts when locked."})}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-delete",onClick:G,title:"Delete track (Delete key)",children:" Delete Track"})})]})}),g&&o.jsx("div",{className:"color-picker-modal",onClick:()=>w(!1),children:o.jsxs("div",{className:"color-picker-modal__content",onClick:te=>te.stopPropagation(),children:[o.jsxs("div",{className:"color-picker-modal__header",children:[o.jsx("h4",{children:"Select Track Surface Colour"}),o.jsx("button",{onClick:()=>w(!1),children:""})]}),o.jsx("div",{className:"color-picker-grid",children:wn.map(te=>o.jsx("button",{className:"color-picker-swatch",style:{backgroundColor:te.hex},onClick:()=>ie(te),title:`${te.code} - ${te.name}`,children:o.jsx("span",{className:"color-picker-swatch__code",children:te.code})},te.code))})]})}),b&&o.jsx("div",{className:"color-picker-modal",onClick:()=>k(!1),children:o.jsxs("div",{className:"color-picker-modal__content",onClick:te=>te.stopPropagation(),children:[o.jsxs("div",{className:"color-picker-modal__header",children:[o.jsx("h4",{children:"Select Line Colour"}),o.jsx("button",{onClick:()=>k(!1),children:""})]}),o.jsx("div",{className:"color-picker-grid",children:wn.map(te=>o.jsx("button",{className:"color-picker-swatch",style:{backgroundColor:te.hex},onClick:()=>Y(te),title:`${te.code} - ${te.name}`,children:o.jsx("span",{className:"color-picker-swatch__code",children:te.code})},te.code))})]})}),_&&o.jsx("div",{className:"color-picker-modal",onClick:()=>S(null),children:o.jsxs("div",{className:"color-picker-modal__content",onClick:te=>te.stopPropagation(),children:[o.jsxs("div",{className:"color-picker-modal__header",children:[o.jsxs("h4",{children:["Lane ",_.laneNumber," Surface Colour"]}),o.jsx("button",{onClick:()=>S(null),children:""})]}),o.jsxs("div",{className:"color-picker-grid",children:[o.jsx("button",{className:"color-picker-swatch color-picker-swatch--default",onClick:()=>{l(e,_.laneNumber,null),S(null)},title:"Use track default colour",style:{backgroundColor:(p==null?void 0:p.hex)||"#A5362F"},children:o.jsx("span",{className:"color-picker-swatch__code",children:"Default"})}),wn.map(te=>o.jsx("button",{className:"color-picker-swatch",style:{backgroundColor:te.hex},onClick:()=>{l(e,_.laneNumber,{tpv_code:te.code,hex:te.hex,name:te.name}),S(null)},title:`${te.code} - ${te.name}`,children:o.jsx("span",{className:"color-picker-swatch__code",children:te.code})},te.code))]})]})})]})}function CT({motif:t,motifId:e,onEditSourceDesign:n}){const{updateMotifPosition:r,updateMotifRotation:s,updateMotifScale:i,removeMotif:a,duplicateMotif:l,refreshMotif:c,setMotifViewMode:d}=at(),{position:u,rotation:h,scale:p,sourceDesignName:f,sourceDesignId:m,originalWidth_mm:y,originalHeight_mm:v,sourceThumbnailUrl:x,viewMode:g,hasBothVersions:w}=t,[b,k]=D.useState(!1),[_,S]=D.useState(null),E=(V,K)=>{const F=parseFloat(K);isNaN(F)||r(e,{...u,[V]:F})},T=V=>{const K=parseFloat(V);isNaN(K)||s(e,K)},R=V=>{const K=parseFloat(V);isNaN(K)||K<=0||i(e,K)},W=()=>{window.confirm("Delete this motif? This action cannot be undone.")&&a(e)},P=()=>{l(e)},I=()=>{if(n)n(m);else{if(!m){alert("Source design ID not found");return}window.open(`/studio/?design=${m}`,"_blank")}},C=async()=>{if(!b){k(!0),S(null);try{const V=await c(e);V.success||S(V.error||"Failed to refresh")}catch(V){S(V.message||"Failed to refresh")}finally{k(!1)}}},$=y*(p||1)/1e3,fe=v*(p||1)/1e3;return o.jsxs("div",{className:"properties-panel",children:[o.jsxs("div",{className:"properties-panel__header",children:[o.jsx("h3",{children:"Motif Properties"}),o.jsxs("div",{className:"properties-panel__court-info",children:[o.jsx("span",{className:"court-name",children:f||"Unnamed Motif"}),o.jsx("span",{className:"court-standard",children:"Playground Design"})]})]}),o.jsx("div",{className:"properties-panel__content",children:o.jsxs("div",{className:"properties-section",children:[x&&o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Preview"}),o.jsx("div",{style:{width:"100%",height:"80px",background:"#f3f4f6",borderRadius:"6px",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:o.jsx("img",{src:x,alt:f,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}})})]}),Ri.BLEND_MODE_ENABLED,o.jsx("div",{className:"properties-section__header",children:o.jsx("h4",{children:"Transform"})}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Position"}),o.jsxs("div",{className:"property-input-row",children:[o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"X"}),o.jsx("input",{type:"number",value:Math.round(u.x),onChange:V=>E("x",V.target.value),step:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"Y"}),o.jsx("input",{type:"number",value:Math.round(u.y),onChange:V=>E("y",V.target.value),step:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Rotation"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"0",max:"360",value:h||0,onChange:V=>T(V.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:Math.round(h||0),onChange:V=>T(V.target.value),min:"0",max:"360"}),o.jsx("span",{className:"property-unit",children:""})]})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsxs("label",{children:["Scale",o.jsx("span",{style:{fontSize:"0.7rem",color:"#64748b",marginLeft:"0.5rem"},children:"(aspect locked)"})]}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"0.1",max:"10",step:"0.1",value:Math.min(p||1,10),onChange:V=>R(V.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:(p||1).toFixed(2),onChange:V=>R(V.target.value),min:"0.1",step:"0.1"}),o.jsx("span",{className:"property-unit",children:""})]})]})]}),o.jsxs("div",{className:"property-group property-group--info",children:[o.jsx("label",{children:"Current Size"}),o.jsx("div",{className:"property-info",children:o.jsxs("span",{children:[$.toFixed(2),"m  ",fe.toFixed(2),"m"]})})]}),o.jsxs("div",{className:"property-group property-group--info",children:[o.jsx("label",{children:"Original Size"}),o.jsx("div",{className:"property-info",children:o.jsxs("span",{children:[(y/1e3).toFixed(2),"m  ",(v/1e3).toFixed(2),"m"]})})]}),o.jsx("div",{className:"properties-section__divider",style:{margin:"1rem 0"},children:o.jsx("span",{children:"Source Design"})}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-primary",onClick:I,title:"Edit the source playground design in a new tab",style:{width:"100%",padding:"0.5rem",background:"var(--color-primary, #1e4a7a)",color:"white",border:"none",borderRadius:"6px",fontSize:"0.875rem",fontFamily:"inherit",cursor:"pointer",marginBottom:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:" Edit Source Design"})}),o.jsxs("div",{className:"property-group property-group--actions",children:[o.jsx("button",{className:"btn-secondary",onClick:C,disabled:b,title:"Refresh this motif with the latest version from the source design",style:{width:"100%",padding:"0.5rem",background:b?"#e5e7eb":"#f3f4f6",border:"1px solid #e4e9f0",borderRadius:"6px",fontSize:"0.875rem",fontFamily:"inherit",cursor:b?"not-allowed":"pointer",marginBottom:"0.5rem",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:b?" Refreshing...":" Refresh from Source"}),_&&o.jsx("div",{style:{fontSize:"0.75rem",color:"#dc2626",marginTop:"0.25rem"},children:_}),o.jsx("div",{style:{fontSize:"0.7rem",color:"#64748b",marginTop:"0.25rem"},children:"Click after editing the source design to update this motif"})]}),o.jsx("div",{className:"properties-section__divider",style:{margin:"1rem 0"},children:o.jsx("span",{children:"Actions"})}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-secondary",onClick:P,title:"Duplicate motif (Ctrl+D)",style:{width:"100%",padding:"0.5rem",background:"#f3f4f6",border:"1px solid #e4e9f0",borderRadius:"6px",fontSize:"0.875rem",fontFamily:"inherit",cursor:"pointer",marginBottom:"0.5rem"},children:" Duplicate Motif"})}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-delete",onClick:W,title:"Delete motif (Delete key)",children:" Delete Motif"})}),o.jsx("div",{className:"property-group",children:o.jsx("div",{className:"property-hint",style:{fontStyle:"normal",color:"#64748b",fontSize:"0.75rem",marginTop:"1rem"},children:' Tip: Drag the motif on the canvas to reposition. Edit the source design and click "Refresh" to update.'})})]})})]})}function ET({shape:t,shapeId:e}){var Ze;const{updateShapePosition:n,updateShapeDimensions:r,updateShapeSides:s,updateShapeCornerRadius:i,setShapeStarMode:a,setShapeInnerRadius:l,updateShapeRotation:c,setShapeFillColor:d,setShapeStroke:u,setShapeAspectLock:h,removeShape:p,duplicateShape:f,randomizeBlob:m,setBlobStyle:y,setEditPointsVisible:v,setPathClosed:x,setPathSmooth:g}=at(),[w,b]=D.useState(!1),[k,_]=D.useState(!1),[S,E]=D.useState(""),[T,R]=D.useState(""),[W,P]=D.useState(!1),[I,C]=D.useState(!1),{shapeType:$,sides:fe,width_mm:V,height_mm:K,cornerRadius:F,starMode:Z,innerRadius:U,position:X,rotation:ge,fillColor:de,strokeEnabled:Q,strokeColor:ke,strokeWidth_mm:Oe,aspectLocked:De,blobStyle:Be,editPointsVisible:Ge,closed:He,smooth:Xe,controlPoints:nt}=t,j=$==="blob",ne=$==="path",oe=(ce,ee)=>{const ve=parseFloat(ee);isNaN(ve)||n(e,{...X,[ce]:ve})},z=ce=>{const ee=parseFloat(ce);if(isNaN(ee)||ee<100)return!1;if(De){const ve=K/V;r(e,ee,ee*ve)}else r(e,ee,K);return!0},A=ce=>{const ee=parseFloat(ce);if(isNaN(ee)||ee<100)return!1;if(De){const ve=V/K;r(e,ee*ve,ee)}else r(e,V,ee);return!0},M=()=>{P(!0),E(V.toFixed(0))},G=()=>{P(!1),z(S)},ie=ce=>{ce.key==="Enter"?ce.target.blur():ce.key==="Escape"&&(P(!1),E(V.toFixed(0)))},Y=()=>{C(!0),R(K.toFixed(0))},se=()=>{C(!1),A(T)},we=ce=>{ce.key==="Enter"?ce.target.blur():ce.key==="Escape"&&(C(!1),R(K.toFixed(0)))},ue=ce=>{const ee=parseInt(ce);isNaN(ee)||ee<3||s(e,ee)},q=ce=>{const ee=parseFloat(ce);isNaN(ee)||ee<0||ee>100||i(e,ee)},le=ce=>{const ee=parseFloat(ce);isNaN(ee)||c(e,ee)},be=ce=>{d(e,{tpv_code:ce.code,hex:ce.hex,name:ce.name}),b(!1)},Ne=ce=>{u(e,!0,{tpv_code:ce.code,hex:ce.hex,name:ce.name},Oe),_(!1)},ze=ce=>{ce&&!ke?u(e,!0,{tpv_code:"RH31",hex:"#E8E3D8",name:"Cream"},Oe):u(e,ce,ke,Oe)},Pe=ce=>{const ee=parseFloat(ce);isNaN(ee)||ee<10||u(e,Q,ke,ee)},te=()=>{h(e,!De)},pe=()=>{window.confirm("Delete this shape? This action cannot be undone.")&&p(e)},qe=()=>{f(e)},st=[{sides:3,name:"Triangle",icon:""},{sides:4,name:"Rectangle",icon:""},{sides:5,name:"Pentagon",icon:""},{sides:6,name:"Hexagon",icon:""},{sides:8,name:"Octagon",icon:""},{sides:32,name:"Circle",icon:""},{sides:5,name:"Star",icon:"",starMode:!0}],rt=ce=>{ce.starMode?(a(e,!0),fe!==ce.sides&&ue(ce.sides)):(Z&&a(e,!1),ue(ce.sides))},wt=ce=>{const ee=parseFloat(ce)/100;l(e,ee)},ct=ce=>ce.starMode?Z&&fe===ce.sides:!Z&&fe===ce.sides;return o.jsxs("div",{className:"properties-panel",children:[o.jsxs("div",{className:"properties-panel__header",children:[o.jsx("h3",{children:j?"Blob Shape":ne?"Pen Path":"Shape Properties"}),o.jsxs("div",{className:"properties-panel__court-info",children:[o.jsx("span",{className:"court-name",children:j?((Ze=Rd[Be||"organic"])==null?void 0:Ze.name)||"Organic":ne?He?"Closed Path":"Open Path":V5(fe,Z)}),o.jsx("span",{className:"court-standard",children:j?" Blob":ne?` ${(nt==null?void 0:nt.length)||0} points`:`${Y5(fe,Z)} ${fe} ${Z?"points":"sides"}`})]})]}),o.jsx("div",{className:"properties-panel__content",children:o.jsxs("div",{className:"properties-section",children:[j?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Style"}),o.jsx("select",{value:Be||"organic",onChange:ce=>y(e,ce.target.value),style:{width:"100%",padding:"0.5rem 0.75rem",border:"1px solid #e4e9f0",borderRadius:"6px",fontSize:"0.875rem",cursor:"pointer",background:"#fff"},children:Object.entries(Rd).map(([ce,ee])=>o.jsxs("option",{value:ce,children:[ee.name," - ",ee.description]},ce))})]}),o.jsxs("div",{className:"property-group",children:[o.jsxs("button",{onClick:()=>m(e),style:{width:"100%",padding:"0.75rem 1rem",background:"#3b82f6",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"0.875rem",fontWeight:"600",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[o.jsx("span",{style:{fontSize:"1.1rem"},children:""})," New Shape"]}),o.jsx("div",{style:{fontSize:"0.7rem",color:"#64748b",marginTop:"0.5rem",textAlign:"center"},children:"Generate a new random shape in the selected style"})]}),o.jsxs("div",{className:"property-group",children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer",padding:"0.5rem",border:"1px solid #e4e9f0",borderRadius:"6px",background:Ge?"#eff6ff":"#fff"},children:[o.jsx("input",{type:"checkbox",checked:Ge||!1,onChange:ce=>v(e,ce.target.checked),style:{width:"16px",height:"16px",cursor:"pointer"}}),o.jsx("span",{style:{fontSize:"0.875rem"},children:"Edit Points"})]}),Ge&&o.jsx("div",{style:{fontSize:"0.7rem",color:"#64748b",marginTop:"0.5rem"},children:"Drag points and handles on canvas for precise control"})]})]}):ne?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"property-group",children:[o.jsx("label",{style:{marginBottom:"0.5rem",display:"block"},children:"Path Options"}),o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer",padding:"0.5rem",border:"1px solid #e4e9f0",borderRadius:"6px",background:He?"#eff6ff":"#fff",marginBottom:"0.5rem"},children:[o.jsx("input",{type:"checkbox",checked:He||!1,onChange:ce=>x(e,ce.target.checked),style:{width:"16px",height:"16px",cursor:"pointer"}}),o.jsx("span",{style:{fontSize:"0.875rem"},children:"Closed Path"})]}),o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer",padding:"0.5rem",border:"1px solid #e4e9f0",borderRadius:"6px",background:Xe?"#eff6ff":"#fff"},children:[o.jsx("input",{type:"checkbox",checked:Xe||!1,onChange:ce=>g(e,ce.target.checked),style:{width:"16px",height:"16px",cursor:"pointer"}}),o.jsx("span",{style:{fontSize:"0.875rem"},children:"Smooth Curves"})]}),Xe&&o.jsx("div",{style:{fontSize:"0.7rem",color:"#64748b",marginTop:"0.5rem"},children:"Uses bezier curves for smooth transitions"})]}),o.jsxs("div",{className:"property-group",children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer",padding:"0.5rem",border:"1px solid #e4e9f0",borderRadius:"6px",background:Ge?"#eff6ff":"#fff"},children:[o.jsx("input",{type:"checkbox",checked:Ge||!1,onChange:ce=>v(e,ce.target.checked),style:{width:"16px",height:"16px",cursor:"pointer"}}),o.jsx("span",{style:{fontSize:"0.875rem"},children:"Edit Points"})]}),Ge&&o.jsxs("div",{style:{fontSize:"0.7rem",color:"#64748b",marginTop:"0.5rem"},children:["Drag points to reshape. ",Xe?"Drag handles for curve control.":"Enable smooth curves for bezier handles."]})]}),o.jsx("div",{className:"property-group",style:{background:"#f8fafc",padding:"0.75rem",borderRadius:"6px"},children:o.jsxs("div",{style:{fontSize:"0.8125rem",color:"#475569"},children:[o.jsx("strong",{children:(nt==null?void 0:nt.length)||0})," control points"]})})]}):o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Shape Type"}),o.jsx("div",{className:"shape-presets",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"0.5rem",marginTop:"0.5rem"},children:st.map(ce=>{const ee=ct(ce);return o.jsxs("button",{onClick:()=>rt(ce),title:ce.name,style:{padding:"0.5rem",border:ee?"2px solid #3b82f6":"1px solid #e4e9f0",borderRadius:"6px",background:ee?"#eff6ff":"#fff",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",fontSize:"1.25rem"},children:[o.jsx("span",{children:ce.icon}),o.jsx("span",{style:{fontSize:"0.65rem",color:"#64748b"},children:ce.name})]},`${ce.name}-${ce.sides}`)})})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:Z?"Number of Points":"Number of Sides"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"3",max:Z?12:32,value:fe,onChange:ce=>ue(ce.target.value),className:"property-slider"}),o.jsx("div",{className:"property-input-group property-input-group--compact",children:o.jsx("input",{type:"number",value:fe,onChange:ce=>ue(ce.target.value),min:"3",max:Z?12:32})})]})]}),Z&&o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Star Depth"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"10",max:"90",value:Math.round((U||.5)*100),onChange:ce=>wt(ce.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:Math.round((U||.5)*100),onChange:ce=>wt(ce.target.value),min:"10",max:"90"}),o.jsx("span",{className:"property-unit",children:"%"})]})]}),o.jsx("div",{style:{fontSize:"0.7rem",color:"#64748b",marginTop:"0.25rem"},children:"Lower values = deeper points, higher = shallower"})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Corner Smoothing"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"0",max:"100",value:F,onChange:ce=>q(ce.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:F,onChange:ce=>q(ce.target.value),min:"0",max:"100"}),o.jsx("span",{className:"property-unit",children:"%"})]})]})]})]}),o.jsx("div",{className:"properties-section__divider",style:{margin:"1rem 0"},children:o.jsx("span",{children:"Dimensions"})}),o.jsxs("div",{className:"property-group",children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[o.jsx("label",{style:{margin:0},children:"Size"}),o.jsx("button",{onClick:te,style:{padding:"0.25rem 0.5rem",fontSize:"0.75rem",background:De?"#3b82f6":"#6b7280",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},title:De?"Aspect ratio locked":"Aspect ratio unlocked",children:De?" Locked":" Free"})]}),o.jsxs("div",{className:"property-input-row",children:[o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"W"}),o.jsx("input",{type:"number",value:W?S:V.toFixed(0),onChange:ce=>E(ce.target.value),onFocus:M,onBlur:G,onKeyDown:ie,step:"100",min:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"H"}),o.jsx("input",{type:"number",value:I?T:K.toFixed(0),onChange:ce=>R(ce.target.value),onFocus:Y,onBlur:se,onKeyDown:we,step:"100",min:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]})]}),o.jsxs("div",{style:{fontSize:"0.7rem",color:"#64748b",marginTop:"0.25rem"},children:[(V/1e3).toFixed(2),"m  ",(K/1e3).toFixed(2),"m"]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Position"}),o.jsxs("div",{className:"property-input-row",children:[o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"X"}),o.jsx("input",{type:"number",value:Math.round(X.x),onChange:ce=>oe("x",ce.target.value),step:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"Y"}),o.jsx("input",{type:"number",value:Math.round(X.y),onChange:ce=>oe("y",ce.target.value),step:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Rotation"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"0",max:"360",value:ge||0,onChange:ce=>le(ce.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:Math.round(ge||0),onChange:ce=>le(ce.target.value),min:"0",max:"360"}),o.jsx("span",{className:"property-unit",children:""})]})]})]}),o.jsx("div",{className:"properties-section__divider",style:{margin:"1rem 0"},children:o.jsx("span",{children:"Appearance"})}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Fill Colour"}),o.jsxs("div",{className:"color-item",children:[o.jsxs("div",{className:"color-item__info",children:[o.jsx("span",{className:"color-item__name",children:(de==null?void 0:de.name)||"Select Colour"}),de&&o.jsx("span",{className:"color-item__code",children:de.tpv_code})]}),o.jsx("button",{className:"color-item__swatch",style:{backgroundColor:(de==null?void 0:de.hex)||"#609B63"},onClick:()=>b(!0),title:(de==null?void 0:de.name)||"Select colour"})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[o.jsx("input",{type:"checkbox",checked:Q||!1,onChange:ce=>ze(ce.target.checked)}),"Border"]}),Q&&o.jsxs("div",{style:{marginTop:"0.5rem"},children:[o.jsxs("div",{className:"color-item",style:{marginBottom:"0.5rem"},children:[o.jsxs("div",{className:"color-item__info",children:[o.jsx("span",{className:"color-item__name",children:(ke==null?void 0:ke.name)||"Select Colour"}),ke&&o.jsx("span",{className:"color-item__code",children:ke.tpv_code})]}),o.jsx("button",{className:"color-item__swatch",style:{backgroundColor:(ke==null?void 0:ke.hex)||"#FFFFFF"},onClick:()=>_(!0),title:(ke==null?void 0:ke.name)||"Select colour"})]}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",style:{fontSize:"0.8rem"},children:"Width"}),o.jsx("input",{type:"number",value:Oe,onChange:ce=>Pe(ce.target.value),step:"10",min:"10"}),o.jsx("span",{className:"property-unit",children:"mm"})]})]})]}),o.jsx("div",{className:"properties-section__divider",style:{margin:"1rem 0"},children:o.jsx("span",{children:"Actions"})}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-secondary",onClick:qe,title:"Duplicate shape (Ctrl+D)",style:{width:"100%",padding:"0.5rem",background:"#f3f4f6",border:"1px solid #e4e9f0",borderRadius:"6px",fontSize:"0.875rem",fontFamily:"inherit",cursor:"pointer",marginBottom:"0.5rem"},children:" Duplicate Shape"})}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-delete",onClick:pe,title:"Delete shape (Delete key)",children:" Delete Shape"})}),o.jsx("div",{className:"property-group",children:o.jsx("div",{className:"property-hint",style:{fontStyle:"normal",color:"#64748b",fontSize:"0.75rem",marginTop:"1rem"},children:" Tip: Drag corners to resize, drag the rotation handle above the shape to rotate. Hold Shift to snap rotation to 15 increments."})})]})}),w&&o.jsx("div",{className:"color-picker-modal",onClick:()=>b(!1),children:o.jsxs("div",{className:"color-picker-modal__content",onClick:ce=>ce.stopPropagation(),children:[o.jsxs("div",{className:"color-picker-modal__header",children:[o.jsx("h4",{children:"Select Fill Colour"}),o.jsx("button",{onClick:()=>b(!1),children:""})]}),o.jsx("div",{className:"color-picker-grid",children:wn.map(ce=>o.jsx("button",{className:"color-picker-swatch",style:{backgroundColor:ce.hex},onClick:()=>be(ce),title:`${ce.code} - ${ce.name}`,children:o.jsx("span",{className:"color-picker-swatch__code",children:ce.code})},ce.code))})]})}),k&&o.jsx("div",{className:"color-picker-modal",onClick:()=>_(!1),children:o.jsxs("div",{className:"color-picker-modal__content",onClick:ce=>ce.stopPropagation(),children:[o.jsxs("div",{className:"color-picker-modal__header",children:[o.jsx("h4",{children:"Select Border Colour"}),o.jsx("button",{onClick:()=>_(!1),children:""})]}),o.jsx("div",{className:"color-picker-grid",children:wn.map(ce=>o.jsx("button",{className:"color-picker-swatch",style:{backgroundColor:ce.hex},onClick:()=>Ne(ce),title:`${ce.code} - ${ce.name}`,children:o.jsx("span",{className:"color-picker-swatch__code",children:ce.code})},ce.code))})]})})]})}function TT({text:t,textId:e}){const{updateTextContent:n,updateTextPosition:r,updateTextScale:s,updateTextFont:i,updateTextAlign:a,updateTextRotation:l,setTextFillColor:c,setTextStrokeColor:d,updateTextStrokeWidth:u,removeText:h,duplicateText:p}=at(),[f,m]=D.useState(!1),[y,v]=D.useState(!1),{content:x,fontFamily:g,fontSize_mm:w,scale_x:b=1,scale_y:k=1,fontWeight:_,fontStyle:S,textAlign:E,position:T,rotation:R,fillColor:W,strokeColor:P,strokeWidth_mm:I}=t,C=w||500,$=Ps(x||"Text",g,C,_,S),fe=Math.round($.width*b),V=Math.round(C*1.2*k),K=K5(),F=j=>{n(e,j)},Z=(j,ne)=>{const oe=parseFloat(ne);isNaN(oe)||r(e,{...T,[j]:oe})},U=j=>{const ne=parseFloat(j);if(isNaN(ne)||ne<10)return;const oe=ne/$.width;s(e,oe,oe)},X=j=>{const ne=parseFloat(j);if(isNaN(ne)||ne<10)return;const oe=C*1.2,z=ne/oe;s(e,z,z)},ge=j=>{i(e,j,_,S)},de=()=>{i(e,g,_==="bold"?"normal":"bold",S)},Q=()=>{i(e,g,_,S==="italic"?"normal":"italic")},ke=j=>{a(e,j)},Oe=j=>{const ne=parseFloat(j);isNaN(ne)||l(e,ne)},De=j=>{c(e,{tpv_code:j.code,hex:j.hex,name:j.name}),m(!1)},Be=j=>{d(e,{tpv_code:j.code,hex:j.hex,name:j.name}),(!I||I===0)&&u(e,Math.round(C*k*.05)),v(!1)},Ge=j=>{const ne=parseFloat(j);isNaN(ne)||ne<0||u(e,ne)},He=()=>{d(e,null),u(e,0)},Xe=()=>{window.confirm("Delete this text? This action cannot be undone.")&&h(e)},nt=()=>{p(e)};return o.jsxs("div",{className:"properties-panel",children:[o.jsxs("div",{className:"properties-panel__header",children:[o.jsx("h3",{children:"Text Properties"}),o.jsxs("div",{className:"properties-panel__court-info",children:[o.jsx("span",{className:"court-name",style:{fontFamily:g},children:x||"Text Label"}),o.jsx("span",{className:"court-standard",children:"T Text Element"})]})]}),o.jsx("div",{className:"properties-panel__content",children:o.jsxs("div",{className:"properties-section",children:[o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Text Content"}),o.jsx("input",{type:"text",value:x,onChange:j=>F(j.target.value),placeholder:"Enter text...",style:{width:"100%",padding:"0.5rem",border:"1px solid #e4e9f0",borderRadius:"6px",fontFamily:g,fontSize:"1rem"}})]}),o.jsx("div",{className:"properties-section__divider",style:{margin:"1rem 0"},children:o.jsx("span",{children:"Typography"})}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Font Family"}),o.jsx("select",{value:g,onChange:j=>ge(j.target.value),style:{width:"100%",padding:"0.5rem",border:"1px solid #e4e9f0",borderRadius:"6px",fontFamily:"inherit",fontSize:"0.875rem"},children:K.map(j=>o.jsx("option",{value:j.family,style:{fontFamily:j.family},children:j.name},j.name))})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Size"}),o.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[o.jsxs("div",{className:"property-input-group property-input-group--compact",style:{flex:1},children:[o.jsx("span",{className:"property-unit",style:{marginRight:"0.25rem"},children:"W"}),o.jsx("input",{type:"number",value:fe,onChange:j=>U(j.target.value),min:"10",step:"10",style:{width:"70px"}}),o.jsx("span",{className:"property-unit",children:"mm"})]}),o.jsxs("div",{className:"property-input-group property-input-group--compact",style:{flex:1},children:[o.jsx("span",{className:"property-unit",style:{marginRight:"0.25rem"},children:"H"}),o.jsx("input",{type:"number",value:V,onChange:j=>X(j.target.value),min:"10",step:"10",style:{width:"70px"}}),o.jsx("span",{className:"property-unit",children:"mm"})]})]}),o.jsxs("div",{style:{fontSize:"0.7rem",color:"#64748b",marginTop:"0.25rem"},children:[" ",(fe/1e3).toFixed(2),"m  ",(V/1e3).toFixed(2),"m"]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Style"}),o.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[o.jsx("button",{onClick:de,style:{flex:1,padding:"0.5rem",border:_==="bold"?"2px solid #3b82f6":"1px solid #e4e9f0",borderRadius:"6px",background:_==="bold"?"#eff6ff":"#fff",fontWeight:"bold",fontSize:"1rem",cursor:"pointer"},title:"Bold",children:"B"}),o.jsx("button",{onClick:Q,style:{flex:1,padding:"0.5rem",border:S==="italic"?"2px solid #3b82f6":"1px solid #e4e9f0",borderRadius:"6px",background:S==="italic"?"#eff6ff":"#fff",fontStyle:"italic",fontSize:"1rem",cursor:"pointer"},title:"Italic",children:"I"})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Alignment"}),o.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[o.jsx("button",{onClick:()=>ke("left"),style:{flex:1,padding:"0.5rem",border:E==="left"?"2px solid #3b82f6":"1px solid #e4e9f0",borderRadius:"6px",background:E==="left"?"#eff6ff":"#fff",cursor:"pointer"},title:"Align Left",children:""}),o.jsx("button",{onClick:()=>ke("center"),style:{flex:1,padding:"0.5rem",border:E==="center"?"2px solid #3b82f6":"1px solid #e4e9f0",borderRadius:"6px",background:E==="center"?"#eff6ff":"#fff",cursor:"pointer"},title:"Align Center",children:""}),o.jsx("button",{onClick:()=>ke("right"),style:{flex:1,padding:"0.5rem",border:E==="right"?"2px solid #3b82f6":"1px solid #e4e9f0",borderRadius:"6px",background:E==="right"?"#eff6ff":"#fff",cursor:"pointer"},title:"Align Right",children:""})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Text Colour"}),o.jsxs("div",{className:"color-item",children:[o.jsxs("div",{className:"color-item__info",children:[o.jsx("span",{className:"color-item__name",children:(W==null?void 0:W.name)||"Select Colour"}),W&&o.jsx("span",{className:"color-item__code",children:W.tpv_code})]}),o.jsx("button",{className:"color-item__swatch",style:{backgroundColor:(W==null?void 0:W.hex)||"#1C1C1C"},onClick:()=>m(!0),title:(W==null?void 0:W.name)||"Select colour"})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Outline"}),P?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"color-item",children:[o.jsxs("div",{className:"color-item__info",children:[o.jsx("span",{className:"color-item__name",children:P.name}),o.jsx("span",{className:"color-item__code",children:P.tpv_code})]}),o.jsx("button",{className:"color-item__swatch",style:{backgroundColor:P.hex},onClick:()=>v(!0),title:P.name})]}),o.jsxs("div",{className:"property-input-row",style:{marginTop:"0.5rem"},children:[o.jsx("input",{type:"range",min:"1",max:Math.round(w*.2),step:"1",value:I||0,onChange:j=>Ge(j.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:Math.round(I||0),onChange:j=>Ge(j.target.value),min:"0",step:"1"}),o.jsx("span",{className:"property-unit",children:"mm"})]})]}),o.jsx("button",{onClick:He,style:{marginTop:"0.5rem",padding:"0.25rem 0.5rem",fontSize:"0.75rem",background:"#fee2e2",border:"1px solid #fecaca",borderRadius:"4px",color:"#dc2626",cursor:"pointer"},children:"Remove Outline"})]}):o.jsx("button",{onClick:()=>v(!0),style:{width:"100%",padding:"0.5rem",background:"#f3f4f6",border:"1px dashed #d1d5db",borderRadius:"6px",fontSize:"0.875rem",color:"#6b7280",cursor:"pointer"},children:"+ Add Outline"})]}),o.jsx("div",{className:"properties-section__divider",style:{margin:"1rem 0"},children:o.jsx("span",{children:"Transform"})}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Position"}),o.jsxs("div",{className:"property-input-row",children:[o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"X"}),o.jsx("input",{type:"number",value:Math.round(T.x),onChange:j=>Z("x",j.target.value),step:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"Y"}),o.jsx("input",{type:"number",value:Math.round(T.y),onChange:j=>Z("y",j.target.value),step:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Rotation"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"0",max:"360",value:R||0,onChange:j=>Oe(j.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:Math.round(R||0),onChange:j=>Oe(j.target.value),min:"0",max:"360"}),o.jsx("span",{className:"property-unit",children:""})]})]})]}),o.jsx("div",{className:"properties-section__divider",style:{margin:"1rem 0"},children:o.jsx("span",{children:"Actions"})}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-secondary",onClick:nt,title:"Duplicate text (Ctrl+D)",style:{width:"100%",padding:"0.5rem",background:"#f3f4f6",border:"1px solid #e4e9f0",borderRadius:"6px",fontSize:"0.875rem",fontFamily:"inherit",cursor:"pointer",marginBottom:"0.5rem"},children:" Duplicate Text"})}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-delete",onClick:Xe,title:"Delete text (Delete key)",children:" Delete Text"})}),o.jsx("div",{className:"property-group",children:o.jsx("div",{className:"property-hint",style:{fontStyle:"normal",color:"#64748b",fontSize:"0.75rem",marginTop:"1rem"},children:" Tip: Drag corners to resize text. Hold Shift while rotating to snap to 15 increments."})})]})}),f&&o.jsx("div",{className:"color-picker-modal",onClick:()=>m(!1),children:o.jsxs("div",{className:"color-picker-modal__content",onClick:j=>j.stopPropagation(),children:[o.jsxs("div",{className:"color-picker-modal__header",children:[o.jsx("h4",{children:"Select Text Colour"}),o.jsx("button",{onClick:()=>m(!1),children:""})]}),o.jsx("div",{className:"color-picker-grid",children:wn.map(j=>o.jsx("button",{className:"color-picker-swatch",style:{backgroundColor:j.hex},onClick:()=>De(j),title:`${j.code} - ${j.name}`,children:o.jsx("span",{className:"color-picker-swatch__code",children:j.code})},j.code))})]})}),y&&o.jsx("div",{className:"color-picker-modal",onClick:()=>v(!1),children:o.jsxs("div",{className:"color-picker-modal__content",onClick:j=>j.stopPropagation(),children:[o.jsxs("div",{className:"color-picker-modal__header",children:[o.jsx("h4",{children:"Select Outline Colour"}),o.jsx("button",{onClick:()=>v(!1),children:""})]}),o.jsx("div",{className:"color-picker-grid",children:wn.map(j=>o.jsx("button",{className:"color-picker-swatch",style:{backgroundColor:j.hex},onClick:()=>Be(j),title:`${j.code} - ${j.name}`,children:o.jsx("span",{className:"color-picker-swatch__code",children:j.code})},j.code))})]})})]})}function NT({zone:t,zoneId:e}){const{updateExclusionZonePosition:n,updateExclusionZoneDimensions:r,updateExclusionZoneRotation:s,updateExclusionZoneCornerRadius:i,removeExclusionZone:a,duplicateExclusionZone:l,addToHistory:c}=at(),{position:d,rotation:u,width_mm:h,height_mm:p,sides:f,cornerRadius:m,customName:y}=t,v=(T,R)=>{const W=parseFloat(R);isNaN(W)||n(e,{...d,[T]:W})},x=(T,R)=>{const W=parseFloat(R);isNaN(W)||W<500||(T==="width"?r(e,W,p):r(e,h,W),c())},g=T=>{const R=parseFloat(T);isNaN(R)||(s(e,R),c())},w=T=>{const R=parseFloat(T);isNaN(R)||i(e,R)},b=()=>{window.confirm("Delete this exclusion zone? This action cannot be undone.")&&a(e)},k=()=>{l(e)},_=h*p/1e6,S=y||"Exclusion Zone",E=f===4?"Rectangle":f>=32?"Circle":`${f}-sided`;return o.jsxs("div",{className:"properties-panel",children:[o.jsxs("div",{className:"properties-panel__header",children:[o.jsx("h3",{children:"Exclusion Zone"}),o.jsxs("div",{className:"properties-panel__court-info",children:[o.jsx("span",{className:"court-name",children:S}),o.jsx("span",{className:"court-standard",style:{background:"#f87171",color:"white"},children:"Excluded Area"})]})]}),o.jsx("div",{className:"properties-panel__content",children:o.jsxs("div",{className:"properties-section",children:[o.jsx("div",{className:"property-group",style:{background:"#fef2f2",padding:"0.75rem",borderRadius:"6px",marginBottom:"1rem",border:"1px solid #fecaca"},children:o.jsx("p",{style:{fontSize:"0.75rem",color:"#991b1b",margin:0},children:"This area represents a building, planter, or other obstacle. It is excluded from material calculations."})}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Dimensions"}),o.jsxs("div",{className:"property-input-row",children:[o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"W"}),o.jsx("input",{type:"number",value:Math.round(h),onChange:T=>x("width",T.target.value),step:"100",min:"500"}),o.jsx("span",{className:"property-unit",children:"mm"})]}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"H"}),o.jsx("input",{type:"number",value:Math.round(p),onChange:T=>x("height",T.target.value),step:"100",min:"500"}),o.jsx("span",{className:"property-unit",children:"mm"})]})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Position"}),o.jsxs("div",{className:"property-input-row",children:[o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"X"}),o.jsx("input",{type:"number",value:Math.round(d.x),onChange:T=>v("x",T.target.value),step:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]}),o.jsxs("div",{className:"property-input-group",children:[o.jsx("span",{className:"property-label",children:"Y"}),o.jsx("input",{type:"number",value:Math.round(d.y),onChange:T=>v("y",T.target.value),step:"100"}),o.jsx("span",{className:"property-unit",children:"mm"})]})]})]}),o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Rotation"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"0",max:"360",value:u||0,onChange:T=>g(T.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:Math.round(u||0),onChange:T=>g(T.target.value),min:"0",max:"360"}),o.jsx("span",{className:"property-unit",children:""})]})]})]}),f===4&&o.jsxs("div",{className:"property-group",children:[o.jsx("label",{children:"Corner Radius"}),o.jsxs("div",{className:"property-input-row",children:[o.jsx("input",{type:"range",min:"0",max:"100",value:m||0,onChange:T=>w(T.target.value),className:"property-slider"}),o.jsxs("div",{className:"property-input-group property-input-group--compact",children:[o.jsx("input",{type:"number",value:Math.round(m||0),onChange:T=>w(T.target.value),min:"0",max:"100"}),o.jsx("span",{className:"property-unit",children:"%"})]})]})]}),o.jsx("div",{className:"properties-section__divider",style:{margin:"1rem 0"},children:o.jsx("span",{children:"Exclusion Info"})}),o.jsxs("div",{className:"property-group property-group--info",children:[o.jsx("label",{children:"Shape"}),o.jsx("div",{className:"property-info",children:o.jsx("span",{children:E})})]}),o.jsxs("div",{className:"property-group property-group--info",children:[o.jsx("label",{children:"Excluded Area"}),o.jsx("div",{className:"property-info",style:{color:"#dc2626"},children:o.jsxs("span",{children:[_.toFixed(2)," m"]})})]}),o.jsx("div",{className:"properties-section__divider",style:{margin:"1rem 0"},children:o.jsx("span",{children:"Actions"})}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-secondary",onClick:k,title:"Duplicate exclusion zone",style:{width:"100%",padding:"0.5rem",background:"#f3f4f6",border:"1px solid #e4e9f0",borderRadius:"6px",fontSize:"0.875rem",fontFamily:"inherit",cursor:"pointer",marginBottom:"0.5rem"},children:"Duplicate Zone"})}),o.jsx("div",{className:"property-group property-group--actions",children:o.jsx("button",{className:"btn-delete",onClick:b,title:"Delete exclusion zone",children:"Delete Zone"})}),o.jsx("div",{className:"property-group",children:o.jsx("div",{className:"property-hint",style:{fontStyle:"normal",color:"#64748b",fontSize:"0.75rem",marginTop:"1rem"},children:"Drag the zone on the canvas to reposition. Use handles to resize."})})]})})]})}function PT({group:t,groupId:e,shapes:n,isEditing:r,onEnterGroup:s,onExitGroup:i,onUngroup:a,onDelete:l}){const c=t.customName||"Group",d=t.childIds.map(h=>n[h]).filter(Boolean),u=t.bounds||{width:0,height:0};return o.jsx("div",{className:"properties-panel properties-panel--group",children:o.jsxs("div",{className:"properties-panel__scroll-container",children:[o.jsxs("div",{className:"properties-panel__header",children:[o.jsxs("div",{className:"properties-panel__title-row",children:[o.jsx("span",{className:"properties-panel__icon",style:{color:"#9333ea"},children:""}),o.jsx("h3",{className:"properties-panel__title",children:c})]}),o.jsxs("span",{className:"properties-panel__subtitle",children:[t.childIds.length," element",t.childIds.length!==1?"s":""]})]}),o.jsxs("div",{className:"properties-panel__content",children:[o.jsxs("div",{className:"property-section",children:[o.jsx("div",{className:"property-group",style:{marginBottom:"1rem"},children:r?o.jsx("button",{className:"property-btn property-btn--secondary property-btn--full",onClick:i,style:{borderColor:"#9333ea",color:"#9333ea"},children:" Exit Group Editing"}):o.jsx("button",{className:"property-btn property-btn--primary property-btn--full",onClick:s,style:{background:"#9333ea"},children:"Edit Group Elements"})}),r&&o.jsx("div",{className:"property-hint",style:{fontSize:"0.75rem",color:"#9333ea",marginBottom:"1rem"},children:"Click on individual elements to select and edit them"})]}),o.jsxs("div",{className:"property-section",children:[o.jsx("h4",{className:"property-section__title",children:"Dimensions"}),o.jsxs("div",{className:"property-group",children:[o.jsxs("div",{className:"property-row",children:[o.jsx("label",{className:"property-label",children:"Width"}),o.jsxs("span",{className:"property-value",children:[(u.width/1e3).toFixed(2),"m"]})]}),o.jsxs("div",{className:"property-row",children:[o.jsx("label",{className:"property-label",children:"Height"}),o.jsxs("span",{className:"property-value",children:[(u.height/1e3).toFixed(2),"m"]})]})]})]}),o.jsxs("div",{className:"property-section",children:[o.jsxs("h4",{className:"property-section__title",children:["Elements (",d.length,")"]}),o.jsx("div",{className:"property-group",children:o.jsx("div",{style:{maxHeight:"150px",overflowY:"auto",borderRadius:"6px",border:"1px solid #e5e7eb"},children:d.map((h,p)=>o.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",borderBottom:p<d.length-1?"1px solid #f1f5f9":"none",fontSize:"0.8rem"},children:[o.jsx("span",{style:{color:"#9333ea"},children:h.shapeType==="blob"?"":""}),o.jsx("span",{style:{color:"#475569"},children:h.customName||`${h.blobStyle||h.shapeType} ${p+1}`}),o.jsxs("span",{style:{marginLeft:"auto",fontSize:"0.7rem",color:"#9ca3af"},children:[(h.width_mm/1e3).toFixed(1),"m"]})]},h.id))})})]}),o.jsxs("div",{className:"property-section",children:[o.jsx("h4",{className:"property-section__title",children:"Actions"}),o.jsxs("div",{className:"property-group",style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[o.jsx("button",{className:"property-btn property-btn--secondary property-btn--full",onClick:a,title:"Dissolve the group and make elements independent",children:" Ungroup Elements"}),o.jsx("button",{className:"property-btn property-btn--danger property-btn--full",onClick:()=>{confirm(`Delete "${c}" and all its elements?`)&&l()},title:"Delete group and all its elements",children:" Delete Group"})]})]}),o.jsx("div",{className:"property-group",children:o.jsxs("div",{className:"property-hint",style:{fontStyle:"normal",color:"#64748b",fontSize:"0.75rem",marginTop:"1rem"},children:[o.jsx("strong",{children:"Tip:"})," Double-click a group to edit its contents. Press Escape to exit.",o.jsx("br",{}),o.jsx("strong",{children:"Shortcuts:"})," G to group, G to ungroup."]})})]})]})})}function RT(){const{courts:t,tracks:e,motifs:n,shapes:r,texts:s,exclusionZones:i,groups:a,elementOrder:l,selectedCourtId:c,selectedTrackId:d,selectedMotifId:u,selectedShapeId:h,selectedTextId:p,selectedExclusionZoneId:f,selectedGroupId:m,editingGroupId:y,setElementOrder:v,selectCourt:x,selectTrack:g,selectMotif:w,selectShape:b,selectText:k,selectExclusionZone:_,selectGroup:S,deselectGroup:E,enterGroup:T,exitGroup:R,ungroup:W,deleteGroupWithChildren:P,bringToFront:I,sendToBack:C,duplicateCourt:$,duplicateTrack:fe,duplicateMotif:V,duplicateShape:K,duplicateText:F,removeCourt:Z,removeTrack:U,removeMotif:X,removeShape:ge,removeText:de,removeExclusionZone:Q,renameElement:ke,toggleElementLock:Oe,toggleElementVisibility:De,addToHistory:Be}=at(),[Ge,He]=O.useState(null),[Xe,nt]=O.useState(null),[j,ne]=O.useState(null),[oe,z]=O.useState(null),[A,M]=O.useState(""),[G,ie]=O.useState(new Set);O.useEffect(()=>{const ee=()=>ne(null);if(j)return document.addEventListener("click",ee),()=>document.removeEventListener("click",ee)},[j]);const Y=[...l].filter(ee=>!ee.startsWith("group-")).reverse(),se=ee=>{var ve,Ve,ot;if(ee.startsWith("court-")){const Ee=t[ee];return{type:"court",name:(Ee==null?void 0:Ee.customName)||((ve=Ee==null?void 0:Ee.template)==null?void 0:ve.name)||"Unknown Court",icon:"",sport:((Ve=Ee==null?void 0:Ee.template)==null?void 0:Ve.sport)||"",locked:(Ee==null?void 0:Ee.locked)||!1,visible:(Ee==null?void 0:Ee.visible)!==!1}}else if(ee.startsWith("track-")){const Ee=e[ee];return{type:"track",name:(Ee==null?void 0:Ee.customName)||((ot=Ee==null?void 0:Ee.template)==null?void 0:ot.name)||"Unknown Track",icon:"",sport:"athletics",locked:(Ee==null?void 0:Ee.locked)||!1,visible:(Ee==null?void 0:Ee.visible)!==!1}}else if(ee.startsWith("motif-")){const Ee=n[ee];return{type:"motif",name:(Ee==null?void 0:Ee.customName)||(Ee==null?void 0:Ee.sourceDesignName)||"Unknown Motif",icon:"",sport:"playground",locked:(Ee==null?void 0:Ee.locked)||!1,visible:(Ee==null?void 0:Ee.visible)!==!1}}else if(ee.startsWith("shape-")){const Ee=r[ee];let St="Shape",ht="";if((Ee==null?void 0:Ee.shapeType)==="blob")St={organic:"Organic Blob",splashy:"Splashy Blob",cloudy:"Cloudy Blob",rocky:"Rocky Blob"}[Ee.blobStyle]||"Blob",ht="";else if((Ee==null?void 0:Ee.shapeType)==="path")St=Ee.closed?"Custom Shape":"Path",ht="";else if(Ee!=null&&Ee.starMode)St=`${Ee.sides||5}-Point Star`,ht="";else if(Ee!=null&&Ee.sides){const Pt=Ee.sides;Pt>=32?(St="Circle",ht=""):Pt===3?(St="Triangle",ht=""):Pt===4?(St="Rectangle",ht=""):Pt===5?(St="Pentagon",ht=""):Pt===6?(St="Hexagon",ht=""):Pt===8?(St="Octagon",ht=""):(St=`${Pt}-gon`,ht="")}return{type:"shape",name:(Ee==null?void 0:Ee.customName)||St,icon:ht,sport:"shape",locked:(Ee==null?void 0:Ee.locked)||!1,visible:(Ee==null?void 0:Ee.visible)!==!1}}else if(ee.startsWith("text-")){const Ee=s[ee],St=(Ee==null?void 0:Ee.content)||"Text Label",ht=St.length>20?St.substring(0,20)+"...":St;return{type:"text",name:(Ee==null?void 0:Ee.customName)||ht,icon:"T",sport:"text",locked:(Ee==null?void 0:Ee.locked)||!1,visible:(Ee==null?void 0:Ee.visible)!==!1}}else if(ee.startsWith("exclusion-")){const Ee=i[ee];return{type:"exclusion",name:(Ee==null?void 0:Ee.customName)||"Exclusion Zone",icon:"",sport:"exclusion",locked:(Ee==null?void 0:Ee.locked)||!1,visible:(Ee==null?void 0:Ee.visible)!==!1}}return{type:"unknown",name:"Unknown",icon:"",sport:"",locked:!1,visible:!0}},we=ee=>ee===c||ee===d||ee===u||ee===h||ee===p||ee===f,ue=ee=>{ee.startsWith("court-")?x(ee):ee.startsWith("track-")?g(ee):ee.startsWith("motif-")?w(ee):ee.startsWith("shape-")?b(ee):ee.startsWith("text-")?k(ee):ee.startsWith("exclusion-")&&_(ee)},q=(ee,ve)=>{He(ve),ee.dataTransfer.effectAllowed="move",ee.dataTransfer.setData("text/plain",ve),setTimeout(()=>{ee.target.classList.add("layer-item--dragging")},0)},le=ee=>{ee.target.classList.remove("layer-item--dragging"),He(null),nt(null)},be=(ee,ve)=>{ee.preventDefault(),ee.dataTransfer.dropEffect="move",ve!==Ge&&nt(ve)},Ne=()=>{nt(null)},ze=(ee,ve)=>{if(ee.preventDefault(),!Ge||Ge===ve){He(null),nt(null);return}const Ve=[...l],ot=Ve.indexOf(Ge),Ee=Ve.indexOf(ve);if(ot===-1||Ee===-1)return;Ve.splice(ot,1);const St=Y.indexOf(Ge),ht=Y.indexOf(ve);St<ht,Ve.splice(Ee,0,Ge),v(Ve),Be(),He(null),nt(null)},Pe=(ee,ve)=>{ee.stopPropagation(),I(ve),ne(null)},te=(ee,ve)=>{ee.stopPropagation(),C(ve),ne(null)},pe=(ee,ve)=>{ee.stopPropagation(),ve.startsWith("court-")?$(ve):ve.startsWith("track-")?fe(ve):ve.startsWith("motif-")?V(ve):ve.startsWith("shape-")?K(ve):ve.startsWith("text-")&&F(ve),ne(null)},qe=(ee,ve)=>{ee.stopPropagation();const Ve=se(ve);confirm(`Delete "${Ve.name}"?`)&&(ve.startsWith("court-")?Z(ve):ve.startsWith("track-")?U(ve):ve.startsWith("motif-")?X(ve):ve.startsWith("shape-")?ge(ve):ve.startsWith("text-")?de(ve):ve.startsWith("exclusion-")&&Q(ve)),ne(null)},st=(ee,ve)=>{ee.stopPropagation();const Ve=se(ve);z(ve),M(Ve.name),ne(null)},rt=ee=>{A.trim()&&ke(ee,A.trim()),z(null),M("")},wt=(ee,ve)=>{ee.key==="Enter"?rt(ve):ee.key==="Escape"&&(z(null),M(""))},ct=(ee,ve)=>{ee.stopPropagation(),Oe(ve),ne(null)},Ze=(ee,ve)=>{ee.stopPropagation(),De(ve),ne(null)},ce=(ee,ve)=>{ee.stopPropagation(),ne(j===ve?null:ve)};return Y.length===0&&Object.keys(a).length===0?o.jsx("div",{className:"layers-panel layers-panel--empty",children:o.jsxs("div",{className:"layers-panel__empty-state",children:[o.jsx("span",{className:"layers-panel__empty-icon",children:""}),o.jsx("p",{children:"No elements yet"}),o.jsx("span",{className:"layers-panel__empty-hint",children:"Add courts, tracks, motifs, shapes, or text"})]})}):o.jsxs("div",{className:"layers-panel",children:[o.jsxs("div",{className:"layers-panel__header",children:[o.jsx("h4",{children:"Layers"}),o.jsx("span",{className:"layers-panel__count",children:Y.length})]}),o.jsx("div",{className:"layers-panel__hint",children:"Drag to reorder layers. Top = front, bottom = back."}),o.jsx("div",{className:"layers-panel__list",children:Y.map((ee,ve)=>{const Ve=se(ee),ot=we(ee),Ee=ee===Xe,St=ve===0,ht=ve===Y.length-1,Pt=oe===ee;return o.jsxs("div",{className:`layer-item ${ot?"layer-item--selected":""} ${Ee?"layer-item--drag-over":""} ${Ve.locked?"layer-item--locked":""} ${Ve.visible?"":"layer-item--hidden"}`,draggable:!Ve.locked&&!Pt,onDragStart:Ke=>q(Ke,ee),onDragEnd:le,onDragOver:Ke=>be(Ke,ee),onDragLeave:Ne,onDrop:Ke=>ze(Ke,ee),onClick:()=>!Pt&&ue(ee),children:[o.jsx("span",{className:`layer-item__handle ${Ve.locked?"layer-item__handle--disabled":""}`,title:Ve.locked?"Locked":"Drag to reorder",children:Ve.locked?"":""}),Pt?o.jsx("input",{type:"text",className:"layer-item__rename-input",value:A,onChange:Ke=>M(Ke.target.value),onBlur:()=>rt(ee),onKeyDown:Ke=>wt(Ke,ee),autoFocus:!0,onClick:Ke=>Ke.stopPropagation()}):o.jsx("span",{className:`layer-item__name ${Ve.visible?"":"layer-item__name--hidden"}`,children:Ve.name}),o.jsx("div",{className:"layer-item__indicators",children:!Ve.visible&&o.jsx("span",{className:"layer-item__indicator",title:"Hidden",children:""})}),o.jsxs("div",{className:"layer-item__actions",children:[o.jsx("button",{className:"layer-item__menu-btn",onClick:Ke=>ce(Ke,ee),title:"More actions",children:""}),j===ee&&o.jsxs("div",{className:"layer-item__menu",children:[o.jsx("button",{onClick:Ke=>Pe(Ke,ee),disabled:St,children:" Bring to Front"}),o.jsx("button",{onClick:Ke=>te(Ke,ee),disabled:ht,children:" Send to Back"}),o.jsx("div",{className:"layer-item__menu-divider"}),o.jsx("button",{onClick:Ke=>pe(Ke,ee),children:" Duplicate"}),o.jsx("button",{onClick:Ke=>st(Ke,ee),children:" Rename"}),o.jsx("div",{className:"layer-item__menu-divider"}),o.jsx("button",{onClick:Ke=>ct(Ke,ee),children:Ve.locked?" Unlock":" Lock"}),o.jsx("button",{onClick:Ke=>Ze(Ke,ee),children:Ve.visible?" Hide":" Show"}),o.jsx("div",{className:"layer-item__menu-divider"}),o.jsx("button",{onClick:Ke=>qe(Ke,ee),className:"layer-item__menu-delete",children:" Delete"})]})]})]},ee)})}),Object.keys(a).length>0&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"layers-panel__section-divider",children:o.jsx("span",{children:"Groups"})}),o.jsx("div",{className:"layers-panel__list layers-panel__list--groups",children:Object.entries(a).map(([ee,ve])=>{const Ve=G.has(ee),ot=m===ee,Ee=y===ee,St=ve.customName||"Group";return o.jsxs("div",{className:"layer-group",children:[o.jsxs("div",{className:`layer-item layer-item--group ${ot?"layer-item--selected":""} ${Ee?"layer-item--editing":""} ${ve.locked?"layer-item--locked":""}`,onClick:()=>!ve.locked&&S(ee),onDoubleClick:()=>!ve.locked&&T(ee),children:[o.jsx("button",{className:"layer-item__expand-btn",onClick:ht=>{ht.stopPropagation(),ie(Pt=>{const Ke=new Set(Pt);return Ke.has(ee)?Ke.delete(ee):Ke.add(ee),Ke})},title:Ve?"Collapse":"Expand",children:Ve?"":""}),o.jsx("span",{className:"layer-item__handle layer-item__handle--group",children:ve.locked?"":""}),o.jsxs("span",{className:"layer-item__name",children:[St,o.jsxs("span",{className:"layer-item__child-count",children:["(",ve.childIds.length,")"]})]}),Ee&&o.jsx("span",{className:"layer-item__edit-indicator",title:"Editing group",children:""}),o.jsxs("div",{className:"layer-item__actions",children:[o.jsx("button",{className:"layer-item__menu-btn",onClick:ht=>ce(ht,ee),title:"More actions",children:""}),j===ee&&o.jsxs("div",{className:"layer-item__menu",children:[o.jsx("button",{onClick:ht=>{ht.stopPropagation(),T(ee),ne(null)},children:" Edit Group"}),o.jsx("button",{onClick:ht=>{ht.stopPropagation(),W(ee),ne(null)},children:" Ungroup"}),o.jsx("div",{className:"layer-item__menu-divider"}),o.jsx("button",{onClick:ht=>{ht.stopPropagation(),Oe(ee),ne(null)},children:ve.locked?" Unlock":" Lock"}),o.jsx("div",{className:"layer-item__menu-divider"}),o.jsx("button",{onClick:ht=>{ht.stopPropagation(),confirm(`Delete group "${St}" and all its contents?`)&&P(ee),ne(null)},className:"layer-item__menu-delete",children:" Delete Group"})]})]})]}),Ve&&o.jsx("div",{className:"layer-group__children",children:ve.childIds.map(ht=>{const Pt=se(ht),Ke=ht===h||ht===u;return o.jsxs("div",{className:`layer-item layer-item--child ${Ke?"layer-item--selected":""}`,onClick:Kt=>{Kt.stopPropagation(),Ee&&ue(ht)},children:[o.jsx("span",{className:"layer-item__indent"}),o.jsx("span",{className:"layer-item__handle layer-item__handle--disabled",children:Pt.icon}),o.jsx("span",{className:`layer-item__name ${Pt.visible?"":"layer-item__name--hidden"}`,children:Pt.name})]},ht)})})]},ee)})}),y&&o.jsx("div",{className:"layers-panel__exit-group",children:o.jsx("button",{className:"layers-panel__exit-group-btn",onClick:()=>R(),children:" Exit Group Editing"})})]}),Object.keys(i).length>0&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"layers-panel__section-divider",children:o.jsx("span",{children:"Exclusion Zones"})}),o.jsx("div",{className:"layers-panel__list layers-panel__list--exclusions",children:Object.keys(i).map(ee=>{const ve=se(ee),Ve=we(ee);return o.jsxs("div",{className:`layer-item layer-item--exclusion ${Ve?"layer-item--selected":""} ${ve.locked?"layer-item--locked":""} ${ve.visible?"":"layer-item--hidden"}`,onClick:()=>ue(ee),children:[o.jsx("span",{className:"layer-item__handle layer-item__handle--disabled",children:ve.icon}),o.jsx("span",{className:`layer-item__name ${ve.visible?"":"layer-item__name--hidden"}`,children:ve.name}),o.jsx("div",{className:"layer-item__indicators",children:!ve.visible&&o.jsx("span",{className:"layer-item__indicator",title:"Hidden",children:""})}),o.jsxs("div",{className:"layer-item__actions",children:[o.jsx("button",{className:"layer-item__menu-btn",onClick:ot=>ce(ot,ee),title:"More actions",children:""}),j===ee&&o.jsxs("div",{className:"layer-item__menu",children:[o.jsx("button",{onClick:ot=>st(ot,ee),children:" Rename"}),o.jsx("div",{className:"layer-item__menu-divider"}),o.jsx("button",{onClick:ot=>ct(ot,ee),children:ve.locked?" Unlock":" Lock"}),o.jsx("button",{onClick:ot=>Ze(ot,ee),children:ve.visible?" Hide":" Show"}),o.jsx("div",{className:"layer-item__menu-divider"}),o.jsx("button",{onClick:ot=>qe(ot,ee),className:"layer-item__menu-delete",children:" Delete"})]})]})]},ee)})})]}),o.jsx("div",{className:"layers-panel__footer",children:o.jsx("span",{className:"layers-panel__shortcut-hint",children:"[ ] to reorder  G to group  G to ungroup"})})]})}async function s_(){var n,r;const t=await gn.auth.getSession(),e=(r=(n=t==null?void 0:t.data)==null?void 0:n.session)==null?void 0:r.access_token;if(!e)throw new Error("Not authenticated");return{"Content-Type":"application/json",Authorization:`Bearer ${e}`}}async function i_(t){const e=await s_(),n=await fetch("/api/projects/create",{method:"POST",headers:e,body:JSON.stringify(t)});if(!n.ok){const r=await n.json();throw new Error(r.error||"Unable to create project. Please check your connection and try again.")}return n.json()}async function tm(){const t=await s_(),e=await fetch("/api/projects/list",{method:"GET",headers:t});if(!e.ok){const n=await e.json();throw new Error(n.error||"Unable to load your projects. Please refresh the page and try again.")}return e.json()}function OT(t,e={}){var n,r;return{type:"sports_surface",version:"1.0",name:e.name||t.name||"Untitled Design",description:e.description||t.description||"",tags:e.tags||t.tags||[],surface:t.surface,courts:AT(t.courts),tracks:MT(t.tracks),motifs:$T(t.motifs),exclusionZones:DT(t.exclusionZones),shapes:LT(t.shapes),texts:IT(t.texts),elementOrder:t.elementOrder||[],customMarkings:t.customMarkings||[],backgroundZones:t.backgroundZones||[],dimensions:{width_mm:((n=t.surface)==null?void 0:n.width_mm)||5e4,length_mm:((r=t.surface)==null?void 0:r.length_mm)||5e4}}}function AT(t){return t?Object.fromEntries(Object.entries(t).map(([e,n])=>[e,{id:n.id,templateId:n.templateId,template:n.template,position:n.position,rotation:n.rotation,scale:n.scale,lineColorOverrides:n.lineColorOverrides||{},zoneColorOverrides:n.zoneColorOverrides||{},courtSurfaceColor:n.courtSurfaceColor}])):{}}function MT(t){return t?Object.fromEntries(Object.entries(t).map(([e,n])=>[e,{id:n.id,templateId:n.templateId,template:n.template,position:n.position,rotation:n.rotation,parameters:n.parameters,trackSurfaceColor:n.trackSurfaceColor,laneSurfaceColors:n.laneSurfaceColors||[],trackLineColor:n.trackLineColor}])):{}}function $T(t){return t?Object.fromEntries(Object.entries(t).map(([e,n])=>[e,{id:n.id,type:"motif",sourceDesignId:n.sourceDesignId,sourceDesignName:n.sourceDesignName,sourceThumbnailUrl:n.sourceThumbnailUrl,svgContent:n.svgContent,originalWidth_mm:n.originalWidth_mm,originalHeight_mm:n.originalHeight_mm,position:n.position,rotation:n.rotation,scale:n.scale}])):{}}function DT(t){return t?Object.fromEntries(Object.entries(t).map(([e,n])=>[e,{id:n.id,type:"exclusion",shapeType:n.shapeType,sides:n.sides,width_mm:n.width_mm,height_mm:n.height_mm,position:n.position,rotation:n.rotation,cornerRadius:n.cornerRadius,locked:n.locked,visible:n.visible,customName:n.customName,controlPoints:n.controlPoints}])):{}}function LT(t){return t?Object.fromEntries(Object.entries(t).map(([e,n])=>[e,{id:n.id,shapeType:n.shapeType,controlPoints:n.controlPoints,width_mm:n.width_mm,height_mm:n.height_mm,position:n.position,rotation:n.rotation,fillColor:n.fillColor,strokeEnabled:n.strokeEnabled,strokeColor:n.strokeColor,strokeWidth_mm:n.strokeWidth_mm,sides:n.sides,cornerRadius:n.cornerRadius,closed:n.closed,smooth:n.smooth,editPointsVisible:n.editPointsVisible}])):{}}function IT(t){return t?Object.fromEntries(Object.entries(t).map(([e,n])=>[e,{id:n.id,content:n.content,fontFamily:n.fontFamily,fontSize_mm:n.fontSize_mm,scale_x:n.scale_x??1,scale_y:n.scale_y??1,fontWeight:n.fontWeight,fontStyle:n.fontStyle,textAlign:n.textAlign,position:n.position,rotation:n.rotation,fillColor:n.fillColor,strokeColor:n.strokeColor,strokeWidth_mm:n.strokeWidth_mm}])):{}}function zT(t){var r,s;const e=[];return t.surface||e.push("Surface configuration is required"),(!((r=t.surface)!=null&&r.width_mm)||!((s=t.surface)!=null&&s.length_mm))&&e.push("Surface dimensions are required"),t.courts&&Object.keys(t.courts).length>0||t.tracks&&Object.keys(t.tracks).length>0||t.motifs&&Object.keys(t.motifs).length>0||e.push("Add at least one court, track, or motif to save"),{valid:e.length===0,errors:e}}async function FT(t,e=400){return new Promise((n,r)=>{try{const s=t.cloneNode(!0);s.querySelectorAll(".court-canvas__court--selected, .transform-handles").forEach(m=>{m.classList.remove("court-canvas__court--selected")}),s.querySelectorAll(".transform-handles").forEach(m=>m.remove());const i=t.getAttribute("viewBox").split(" ").map(Number),a=i[2],l=i[3];let c,d;a>l?(c=e,d=Math.round(l/a*e)):(d=e,c=Math.round(a/l*e)),s.setAttribute("width",c),s.setAttribute("height",d);const u=new XMLSerializer().serializeToString(s),h=new Blob([u],{type:"image/svg+xml;charset=utf-8"}),p=URL.createObjectURL(h),f=new Image;f.onload=()=>{const m=document.createElement("canvas");m.width=c,m.height=d;const y=m.getContext("2d");y.fillStyle="#ffffff",y.fillRect(0,0,c,d),y.drawImage(f,0,0,c,d),m.toBlob(v=>{URL.revokeObjectURL(p),n(v)},"image/png",.9)},f.onerror=m=>{URL.revokeObjectURL(p),r(new Error("Failed to load SVG for thumbnail"))},f.src=p}catch(s){r(s)}})}async function BT(t){const n=`thumbnails/sports/${`sports-${Date.now()}-${Math.random().toString(36).substr(2,9)}.png`}`,{data:r,error:s}=await gn.storage.from("tpv-studio-uploads").upload(n,t,{cacheControl:"3600",contentType:"image/png",upsert:!1});if(s)throw s;const{data:{publicUrl:i}}=gn.storage.from("tpv-studio-uploads").getPublicUrl(n);return i}function HT({existingDesignId:t=null,initialName:e="",svgRef:n=null,onClose:r,onSaved:s}){const i=at(Z=>Z.exportDesignData),[a,l]=O.useState(e),[c,d]=O.useState(""),[u,h]=O.useState(""),[p,f]=O.useState(""),[m,y]=O.useState(!1),[v,x]=O.useState([]),[g,w]=O.useState(!1),[b,k]=O.useState(""),[_,S]=O.useState("#1a365d"),[E,T]=O.useState(!1),[R,W]=O.useState(!1),[P,I]=O.useState(!1),[C,$]=O.useState(null);O.useEffect(()=>{fe()},[]);const fe=async()=>{try{const{projects:Z}=await tm();x(Z)}catch(Z){console.error("Failed to load projects:",Z),$("Failed to load projects")}},V=async()=>{if(!b.trim()){$("Project name is required");return}I(!0),$(null);try{const{project:Z}=await i_({name:b.trim(),color:_});x([Z,...v]),h(Z.id),w(!1),k(""),S("#1a365d")}catch(Z){console.error("Failed to create project:",Z),$(Z.message)}finally{I(!1)}},K=async(Z=!1)=>{if(!a.trim()){$("Design name is required");return}const U=i(),X=zT(U);if(!X.valid){$(X.errors.join(", "));return}Z?W(!0):T(!0),$(null);try{let ge=null;if(n!=null&&n.current)try{console.log("[SPORTS-SAVE] Generating thumbnail...");const Oe=await FT(n.current);console.log("[SPORTS-SAVE] Uploading thumbnail..."),ge=await BT(Oe),console.log("[SPORTS-SAVE] Thumbnail uploaded:",ge)}catch(Oe){console.warn("[SPORTS-SAVE] Thumbnail generation failed, continuing without:",Oe)}const de=OT(U,{name:a.trim(),description:c.trim()||"",tags:p.split(",").map(Oe=>Oe.trim()).filter(Oe=>Oe)});console.log("[SPORTS-SAVE] Serialized design data:",de);const Q={name:a.trim(),description:c.trim()||null,project_id:u||null,tags:p.split(",").map(Oe=>Oe.trim()).filter(Oe=>Oe),is_public:m,design_data:de,thumbnail_url:ge};t&&!Z&&(Q.id=t);const ke=await Jf(Q);s&&s(ke,a.trim()),r()}catch(ge){console.error("Failed to save design:",ge),$(ge.message)}finally{T(!1),W(!1)}},F=["#1a365d","#ff6b35","#4a90e2","#50c878","#9b59b6","#e74c3c"];return o.jsx("div",{className:"modal-overlay",onClick:r,children:o.jsxs("div",{className:"modal-content save-design-modal",onClick:Z=>Z.stopPropagation(),children:[o.jsxs("div",{className:"modal-header",children:[o.jsx("h2",{children:t?"Update Design":"Save Design"}),o.jsx("button",{onClick:r,className:"close-button",children:""})]}),o.jsxs("div",{className:"modal-body",children:[C&&o.jsx("div",{className:"error-message",children:C}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"design-name",children:"Design Name *"}),o.jsx("input",{id:"design-name",type:"text",value:a,onChange:Z=>l(Z.target.value),placeholder:"e.g., Multi-Sport Court Design",autoFocus:!0,disabled:E||R})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"design-description",children:"Description"}),o.jsx("textarea",{id:"design-description",value:c,onChange:Z=>d(Z.target.value),placeholder:"Optional notes about this sports surface design...",rows:3,disabled:E||R})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"design-project",children:"Project"}),g?o.jsxs("div",{className:"new-project-form",children:[o.jsxs("div",{className:"input-row",children:[o.jsx("input",{type:"text",value:b,onChange:Z=>k(Z.target.value),placeholder:"Project name...",disabled:P}),o.jsx("div",{className:"color-picker-inline",children:F.map(Z=>o.jsx("button",{type:"button",className:`color-swatch ${_===Z?"active":""}`,style:{backgroundColor:Z},onClick:()=>S(Z),disabled:P},Z))})]}),o.jsxs("div",{className:"button-row",children:[o.jsx("button",{type:"button",onClick:V,className:"btn-primary btn-small",disabled:P,children:P?"Creating...":"Create"}),o.jsx("button",{type:"button",onClick:()=>w(!1),className:"btn-secondary btn-small",disabled:P,children:"Cancel"})]})]}):o.jsxs("div",{className:"project-selector",children:[o.jsxs("select",{id:"design-project",value:u,onChange:Z=>h(Z.target.value),disabled:E||R,children:[o.jsx("option",{value:"",children:"No Project"}),v.map(Z=>o.jsxs("option",{value:Z.id,children:[Z.name," (",Z.design_count," designs)"]},Z.id))]}),o.jsx("button",{type:"button",onClick:()=>w(!0),className:"btn-secondary btn-small",disabled:E||R,children:"+ New Project"})]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"design-tags",children:"Tags"}),o.jsx("input",{id:"design-tags",type:"text",value:p,onChange:Z=>f(Z.target.value),placeholder:"e.g., tennis, multi-sport, school (comma-separated)",disabled:E||R}),o.jsx("small",{className:"help-text",children:"Separate tags with commas"})]}),o.jsx("div",{className:"form-group checkbox-group",children:o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:m,onChange:Z=>y(Z.target.checked),disabled:E||R}),o.jsx("span",{children:"Make this design public (shareable link)"})]})})]}),o.jsxs("div",{className:"modal-footer",children:[o.jsx("button",{onClick:r,className:"btn-secondary",disabled:E||R,children:"Cancel"}),t&&o.jsx("button",{onClick:()=>K(!0),className:"btn-secondary",disabled:E||R,children:R?"Saving...":"Save as New"}),o.jsx("button",{onClick:()=>K(!1),className:"btn-primary",disabled:E||R,children:E?"Saving...":t?"Update":"Save Design"})]})]})})}function nm(t,e){var u,h,p,f;if(!t)throw new Error("SVG element not found");const n=t.cloneNode(!0);n.querySelectorAll('.court-canvas__selection-outline, .transform-handles, .track-resize-handles, [class*="selection"], [class*="handle"]').forEach(m=>m.remove());const s=document.createElementNS("http://www.w3.org/2000/svg","title");s.textContent=(e==null?void 0:e.name)||"Sports Surface Design",n.insertBefore(s,n.firstChild);const i=document.createElementNS("http://www.w3.org/2000/svg","desc");i.textContent=`Generated by TPV Designer. Dimensions: ${(((u=e==null?void 0:e.surface)==null?void 0:u.width_mm)/1e3).toFixed(1)}m  ${(((h=e==null?void 0:e.surface)==null?void 0:h.length_mm)/1e3).toFixed(1)}m`,n.insertBefore(i,n.firstChild.nextSibling),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");const a=((p=e==null?void 0:e.surface)==null?void 0:p.width_mm)||5e4,l=((f=e==null?void 0:e.surface)==null?void 0:f.length_mm)||5e4;n.setAttribute("width",`${a}mm`),n.setAttribute("height",`${l}mm`),n.setAttribute("data-tpv-studio","1.0"),n.setAttribute("data-design-type","sports_surface");let d=new XMLSerializer().serializeToString(n);return d=`<?xml version="1.0" encoding="UTF-8"?>
`+d,d}function UT(t,e="sports-surface.svg"){const n=new Blob([t],{type:"image/svg+xml"}),r=URL.createObjectURL(n),s=document.createElement("a");s.href=r,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)}async function WT(t,e,n="sports-surface.png",r=2){return new Promise((s,i)=>{try{const a=nm(t,e),l=document.createElement("canvas"),c=l.getContext("2d"),d=t.getAttribute("viewBox");let u=1200,h=1200;if(d){const[,,y,v]=d.split(" ").map(Number),x=2400,g=v/y;u=Math.min(y/10,x),h=u*g}l.width=u*r,l.height=h*r;const p=new Image,f=new Blob([a],{type:"image/svg+xml;charset=utf-8"}),m=URL.createObjectURL(f);p.onload=()=>{c.fillStyle="#ffffff",c.fillRect(0,0,l.width,l.height),c.drawImage(p,0,0,l.width,l.height),l.toBlob(y=>{if(!y){i(new Error("Failed to create PNG blob"));return}const v=URL.createObjectURL(y),x=document.createElement("a");x.href=v,x.download=n,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(m),URL.revokeObjectURL(v),s()},"image/png",.95)},p.onerror=y=>{URL.revokeObjectURL(m),i(new Error("Failed to load SVG for PNG conversion"))},p.src=m}catch(a){i(a)}})}function Ia(t,e){const n=(t||"sports-surface").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").substring(0,50),r=new Date().toISOString().split("T")[0];return`${n}_${r}.${e}`}function Ty(t){const e=t.querySelectorAll('image[href^="data:image/svg+xml"]');console.log(`[EXPORT] Found ${e.length} motif images to inline`),e.forEach((n,r)=>{try{const s=n.getAttribute("href");if(!s)return;let i;if(s.includes(",")){const b=s.split(",")[1];s.includes("base64")?i=atob(b):i=decodeURIComponent(b)}else{console.warn(`[EXPORT] Motif ${r}: Invalid data URL format`);return}const c=new DOMParser().parseFromString(i,"image/svg+xml").documentElement;if(c.querySelector("parsererror")){console.warn(`[EXPORT] Motif ${r}: SVG parse error`);return}const d=parseFloat(n.getAttribute("x"))||0,u=parseFloat(n.getAttribute("y"))||0,h=parseFloat(n.getAttribute("width")),p=parseFloat(n.getAttribute("height"));if(!h||!p){console.warn(`[EXPORT] Motif ${r}: Missing dimensions`);return}const f=c.getAttribute("viewBox");let m=1,y=1;if(f){const b=f.split(/\s+/).map(Number);if(b.length===4){const[,,k,_]=b;k>0&&_>0&&(m=h/k,y=p/_)}}const v=n.closest("g"),x=(v==null?void 0:v.getAttribute("transform"))||"",g=document.createElementNS("http://www.w3.org/2000/svg","g");g.setAttribute("class","motif-inline"),g.setAttribute("transform",`translate(${d}, ${u}) scale(${m}, ${y})`);const w=c.querySelector("defs");if(w){const b=t.querySelector("defs")||(()=>{const k=document.createElementNS("http://www.w3.org/2000/svg","defs");return t.insertBefore(k,t.firstChild),k})();for(;w.firstChild;)b.appendChild(w.firstChild)}for(;c.firstChild;)c.firstChild.nodeName!=="defs"?g.appendChild(c.firstChild):c.removeChild(c.firstChild);n.parentNode.replaceChild(g,n),console.log(`[EXPORT] Motif ${r}: Inlined successfully (scale: ${m.toFixed(3)}, ${y.toFixed(3)})`)}catch(s){console.warn(`[EXPORT] Failed to inline motif ${r}:`,s.message)}})}function Mc(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var o_={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,s,i){function a(d,u){if(!s[d]){if(!r[d]){var h=typeof Mc=="function"&&Mc;if(!u&&h)return h(d,!0);if(l)return l(d,!0);var p=new Error("Cannot find module '"+d+"'");throw p.code="MODULE_NOT_FOUND",p}var f=s[d]={exports:{}};r[d][0].call(f.exports,function(m){var y=r[d][1][m];return a(y||m)},f,f.exports,n,r,s,i)}return s[d].exports}for(var l=typeof Mc=="function"&&Mc,c=0;c<i.length;c++)a(i[c]);return a}({1:[function(n,r,s){var i=n("./utils"),a=n("./support"),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";s.encode=function(c){for(var d,u,h,p,f,m,y,v=[],x=0,g=c.length,w=g,b=i.getTypeOf(c)!=="string";x<c.length;)w=g-x,h=b?(d=c[x++],u=x<g?c[x++]:0,x<g?c[x++]:0):(d=c.charCodeAt(x++),u=x<g?c.charCodeAt(x++):0,x<g?c.charCodeAt(x++):0),p=d>>2,f=(3&d)<<4|u>>4,m=1<w?(15&u)<<2|h>>6:64,y=2<w?63&h:64,v.push(l.charAt(p)+l.charAt(f)+l.charAt(m)+l.charAt(y));return v.join("")},s.decode=function(c){var d,u,h,p,f,m,y=0,v=0,x="data:";if(c.substr(0,x.length)===x)throw new Error("Invalid base64 input, it looks like a data url.");var g,w=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===l.charAt(64)&&w--,c.charAt(c.length-2)===l.charAt(64)&&w--,w%1!=0)throw new Error("Invalid base64 input, bad content length.");for(g=a.uint8array?new Uint8Array(0|w):new Array(0|w);y<c.length;)d=l.indexOf(c.charAt(y++))<<2|(p=l.indexOf(c.charAt(y++)))>>4,u=(15&p)<<4|(f=l.indexOf(c.charAt(y++)))>>2,h=(3&f)<<6|(m=l.indexOf(c.charAt(y++))),g[v++]=d,f!==64&&(g[v++]=u),m!==64&&(g[v++]=h);return g}},{"./support":30,"./utils":32}],2:[function(n,r,s){var i=n("./external"),a=n("./stream/DataWorker"),l=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function d(u,h,p,f,m){this.compressedSize=u,this.uncompressedSize=h,this.crc32=p,this.compression=f,this.compressedContent=m}d.prototype={getContentWorker:function(){var u=new a(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),h=this;return u.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),u},getCompressedWorker:function(){return new a(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},d.createWorkerFrom=function(u,h,p){return u.pipe(new l).pipe(new c("uncompressedSize")).pipe(h.compressWorker(p)).pipe(new c("compressedSize")).withStreamInfo("compression",h)},r.exports=d},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,r,s){var i=n("./stream/GenericWorker");s.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},s.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,r,s){var i=n("./utils"),a=function(){for(var l,c=[],d=0;d<256;d++){l=d;for(var u=0;u<8;u++)l=1&l?3988292384^l>>>1:l>>>1;c[d]=l}return c}();r.exports=function(l,c){return l!==void 0&&l.length?i.getTypeOf(l)!=="string"?function(d,u,h,p){var f=a,m=p+h;d^=-1;for(var y=p;y<m;y++)d=d>>>8^f[255&(d^u[y])];return-1^d}(0|c,l,l.length,0):function(d,u,h,p){var f=a,m=p+h;d^=-1;for(var y=p;y<m;y++)d=d>>>8^f[255&(d^u.charCodeAt(y))];return-1^d}(0|c,l,l.length,0):0}},{"./utils":32}],5:[function(n,r,s){s.base64=!1,s.binary=!1,s.dir=!1,s.createFolders=!0,s.date=null,s.compression=null,s.compressionOptions=null,s.comment=null,s.unixPermissions=null,s.dosPermissions=null},{}],6:[function(n,r,s){var i=null;i=typeof Promise<"u"?Promise:n("lie"),r.exports={Promise:i}},{lie:37}],7:[function(n,r,s){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",a=n("pako"),l=n("./utils"),c=n("./stream/GenericWorker"),d=i?"uint8array":"array";function u(h,p){c.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=p,this.meta={}}s.magic="\b\0",l.inherits(u,c),u.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(l.transformTo(d,h.data),!1)},u.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},u.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},u.prototype._createPako=function(){this._pako=new a[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(p){h.push({data:p,meta:h.meta})}},s.compressWorker=function(h){return new u("Deflate",h)},s.uncompressWorker=function(){return new u("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,r,s){function i(f,m){var y,v="";for(y=0;y<m;y++)v+=String.fromCharCode(255&f),f>>>=8;return v}function a(f,m,y,v,x,g){var w,b,k=f.file,_=f.compression,S=g!==d.utf8encode,E=l.transformTo("string",g(k.name)),T=l.transformTo("string",d.utf8encode(k.name)),R=k.comment,W=l.transformTo("string",g(R)),P=l.transformTo("string",d.utf8encode(R)),I=T.length!==k.name.length,C=P.length!==R.length,$="",fe="",V="",K=k.dir,F=k.date,Z={crc32:0,compressedSize:0,uncompressedSize:0};m&&!y||(Z.crc32=f.crc32,Z.compressedSize=f.compressedSize,Z.uncompressedSize=f.uncompressedSize);var U=0;m&&(U|=8),S||!I&&!C||(U|=2048);var X=0,ge=0;K&&(X|=16),x==="UNIX"?(ge=798,X|=function(Q,ke){var Oe=Q;return Q||(Oe=ke?16893:33204),(65535&Oe)<<16}(k.unixPermissions,K)):(ge=20,X|=function(Q){return 63&(Q||0)}(k.dosPermissions)),w=F.getUTCHours(),w<<=6,w|=F.getUTCMinutes(),w<<=5,w|=F.getUTCSeconds()/2,b=F.getUTCFullYear()-1980,b<<=4,b|=F.getUTCMonth()+1,b<<=5,b|=F.getUTCDate(),I&&(fe=i(1,1)+i(u(E),4)+T,$+="up"+i(fe.length,2)+fe),C&&(V=i(1,1)+i(u(W),4)+P,$+="uc"+i(V.length,2)+V);var de="";return de+=`
\0`,de+=i(U,2),de+=_.magic,de+=i(w,2),de+=i(b,2),de+=i(Z.crc32,4),de+=i(Z.compressedSize,4),de+=i(Z.uncompressedSize,4),de+=i(E.length,2),de+=i($.length,2),{fileRecord:h.LOCAL_FILE_HEADER+de+E+$,dirRecord:h.CENTRAL_FILE_HEADER+i(ge,2)+de+i(W.length,2)+"\0\0\0\0"+i(X,4)+i(v,4)+E+$+W}}var l=n("../utils"),c=n("../stream/GenericWorker"),d=n("../utf8"),u=n("../crc32"),h=n("../signature");function p(f,m,y,v){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=y,this.encodeFileName=v,this.streamFiles=f,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}l.inherits(p,c),p.prototype.push=function(f){var m=f.meta.percent||0,y=this.entriesCount,v=this._sources.length;this.accumulate?this.contentBuffer.push(f):(this.bytesWritten+=f.data.length,c.prototype.push.call(this,{data:f.data,meta:{currentFile:this.currentFile,percent:y?(m+100*(y-v-1))/y:100}}))},p.prototype.openedSource=function(f){this.currentSourceOffset=this.bytesWritten,this.currentFile=f.file.name;var m=this.streamFiles&&!f.file.dir;if(m){var y=a(f,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:y.fileRecord,meta:{percent:0}})}else this.accumulate=!0},p.prototype.closedSource=function(f){this.accumulate=!1;var m=this.streamFiles&&!f.file.dir,y=a(f,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(y.dirRecord),m)this.push({data:function(v){return h.DATA_DESCRIPTOR+i(v.crc32,4)+i(v.compressedSize,4)+i(v.uncompressedSize,4)}(f),meta:{percent:100}});else for(this.push({data:y.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},p.prototype.flush=function(){for(var f=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var y=this.bytesWritten-f,v=function(x,g,w,b,k){var _=l.transformTo("string",k(b));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(x,2)+i(x,2)+i(g,4)+i(w,4)+i(_.length,2)+_}(this.dirRecords.length,y,f,this.zipComment,this.encodeFileName);this.push({data:v,meta:{percent:100}})},p.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},p.prototype.registerPrevious=function(f){this._sources.push(f);var m=this;return f.on("data",function(y){m.processChunk(y)}),f.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),f.on("error",function(y){m.error(y)}),this},p.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},p.prototype.error=function(f){var m=this._sources;if(!c.prototype.error.call(this,f))return!1;for(var y=0;y<m.length;y++)try{m[y].error(f)}catch{}return!0},p.prototype.lock=function(){c.prototype.lock.call(this);for(var f=this._sources,m=0;m<f.length;m++)f[m].lock()},r.exports=p},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,r,s){var i=n("../compressions"),a=n("./ZipFileWorker");s.generateWorker=function(l,c,d){var u=new a(c.streamFiles,d,c.platform,c.encodeFileName),h=0;try{l.forEach(function(p,f){h++;var m=function(g,w){var b=g||w,k=i[b];if(!k)throw new Error(b+" is not a valid compression method !");return k}(f.options.compression,c.compression),y=f.options.compressionOptions||c.compressionOptions||{},v=f.dir,x=f.date;f._compressWorker(m,y).withStreamInfo("file",{name:p,dir:v,date:x,comment:f.comment||"",unixPermissions:f.unixPermissions,dosPermissions:f.dosPermissions}).pipe(u)}),u.entriesCount=h}catch(p){u.error(p)}return u}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,r,s){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var a=new i;for(var l in this)typeof this[l]!="function"&&(a[l]=this[l]);return a}}(i.prototype=n("./object")).loadAsync=n("./load"),i.support=n("./support"),i.defaults=n("./defaults"),i.version="3.10.1",i.loadAsync=function(a,l){return new i().loadAsync(a,l)},i.external=n("./external"),r.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,r,s){var i=n("./utils"),a=n("./external"),l=n("./utf8"),c=n("./zipEntries"),d=n("./stream/Crc32Probe"),u=n("./nodejsUtils");function h(p){return new a.Promise(function(f,m){var y=p.decompressed.getContentWorker().pipe(new d);y.on("error",function(v){m(v)}).on("end",function(){y.streamInfo.crc32!==p.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):f()}).resume()})}r.exports=function(p,f){var m=this;return f=i.extend(f||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:l.utf8decode}),u.isNode&&u.isStream(p)?a.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",p,!0,f.optimizedBinaryString,f.base64).then(function(y){var v=new c(f);return v.load(y),v}).then(function(y){var v=[a.Promise.resolve(y)],x=y.files;if(f.checkCRC32)for(var g=0;g<x.length;g++)v.push(h(x[g]));return a.Promise.all(v)}).then(function(y){for(var v=y.shift(),x=v.files,g=0;g<x.length;g++){var w=x[g],b=w.fileNameStr,k=i.resolve(w.fileNameStr);m.file(k,w.decompressed,{binary:!0,optimizedBinaryString:!0,date:w.date,dir:w.dir,comment:w.fileCommentStr.length?w.fileCommentStr:null,unixPermissions:w.unixPermissions,dosPermissions:w.dosPermissions,createFolders:f.createFolders}),w.dir||(m.file(k).unsafeOriginalName=b)}return v.zipComment.length&&(m.comment=v.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,r,s){var i=n("../utils"),a=n("../stream/GenericWorker");function l(c,d){a.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(d)}i.inherits(l,a),l.prototype._bindStream=function(c){var d=this;(this._stream=c).pause(),c.on("data",function(u){d.push({data:u,meta:{percent:0}})}).on("error",function(u){d.isPaused?this.generatedError=u:d.error(u)}).on("end",function(){d.isPaused?d._upstreamEnded=!0:d.end()})},l.prototype.pause=function(){return!!a.prototype.pause.call(this)&&(this._stream.pause(),!0)},l.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},r.exports=l},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,r,s){var i=n("readable-stream").Readable;function a(l,c,d){i.call(this,c),this._helper=l;var u=this;l.on("data",function(h,p){u.push(h)||u._helper.pause(),d&&d(p)}).on("error",function(h){u.emit("error",h)}).on("end",function(){u.push(null)})}n("../utils").inherits(a,i),a.prototype._read=function(){this._helper.resume()},r.exports=a},{"../utils":32,"readable-stream":16}],14:[function(n,r,s){r.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,a){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,a);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,a)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var a=new Buffer(i);return a.fill(0),a},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(n,r,s){function i(k,_,S){var E,T=l.getTypeOf(_),R=l.extend(S||{},u);R.date=R.date||new Date,R.compression!==null&&(R.compression=R.compression.toUpperCase()),typeof R.unixPermissions=="string"&&(R.unixPermissions=parseInt(R.unixPermissions,8)),R.unixPermissions&&16384&R.unixPermissions&&(R.dir=!0),R.dosPermissions&&16&R.dosPermissions&&(R.dir=!0),R.dir&&(k=x(k)),R.createFolders&&(E=v(k))&&g.call(this,E,!0);var W=T==="string"&&R.binary===!1&&R.base64===!1;S&&S.binary!==void 0||(R.binary=!W),(_ instanceof h&&_.uncompressedSize===0||R.dir||!_||_.length===0)&&(R.base64=!1,R.binary=!0,_="",R.compression="STORE",T="string");var P=null;P=_ instanceof h||_ instanceof c?_:m.isNode&&m.isStream(_)?new y(k,_):l.prepareContent(k,_,R.binary,R.optimizedBinaryString,R.base64);var I=new p(k,P,R);this.files[k]=I}var a=n("./utf8"),l=n("./utils"),c=n("./stream/GenericWorker"),d=n("./stream/StreamHelper"),u=n("./defaults"),h=n("./compressedObject"),p=n("./zipObject"),f=n("./generate"),m=n("./nodejsUtils"),y=n("./nodejs/NodejsStreamInputAdapter"),v=function(k){k.slice(-1)==="/"&&(k=k.substring(0,k.length-1));var _=k.lastIndexOf("/");return 0<_?k.substring(0,_):""},x=function(k){return k.slice(-1)!=="/"&&(k+="/"),k},g=function(k,_){return _=_!==void 0?_:u.createFolders,k=x(k),this.files[k]||i.call(this,k,null,{dir:!0,createFolders:_}),this.files[k]};function w(k){return Object.prototype.toString.call(k)==="[object RegExp]"}var b={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(k){var _,S,E;for(_ in this.files)E=this.files[_],(S=_.slice(this.root.length,_.length))&&_.slice(0,this.root.length)===this.root&&k(S,E)},filter:function(k){var _=[];return this.forEach(function(S,E){k(S,E)&&_.push(E)}),_},file:function(k,_,S){if(arguments.length!==1)return k=this.root+k,i.call(this,k,_,S),this;if(w(k)){var E=k;return this.filter(function(R,W){return!W.dir&&E.test(R)})}var T=this.files[this.root+k];return T&&!T.dir?T:null},folder:function(k){if(!k)return this;if(w(k))return this.filter(function(T,R){return R.dir&&k.test(T)});var _=this.root+k,S=g.call(this,_),E=this.clone();return E.root=S.name,E},remove:function(k){k=this.root+k;var _=this.files[k];if(_||(k.slice(-1)!=="/"&&(k+="/"),_=this.files[k]),_&&!_.dir)delete this.files[k];else for(var S=this.filter(function(T,R){return R.name.slice(0,k.length)===k}),E=0;E<S.length;E++)delete this.files[S[E].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(k){var _,S={};try{if((S=l.extend(k||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:a.utf8encode})).type=S.type.toLowerCase(),S.compression=S.compression.toUpperCase(),S.type==="binarystring"&&(S.type="string"),!S.type)throw new Error("No output type specified.");l.checkSupport(S.type),S.platform!=="darwin"&&S.platform!=="freebsd"&&S.platform!=="linux"&&S.platform!=="sunos"||(S.platform="UNIX"),S.platform==="win32"&&(S.platform="DOS");var E=S.comment||this.comment||"";_=f.generateWorker(this,S,E)}catch(T){(_=new c("error")).error(T)}return new d(_,S.type||"string",S.mimeType)},generateAsync:function(k,_){return this.generateInternalStream(k).accumulate(_)},generateNodeStream:function(k,_){return(k=k||{}).type||(k.type="nodebuffer"),this.generateInternalStream(k).toNodejsStream(_)}};r.exports=b},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,r,s){r.exports=n("stream")},{stream:void 0}],17:[function(n,r,s){var i=n("./DataReader");function a(l){i.call(this,l);for(var c=0;c<this.data.length;c++)l[c]=255&l[c]}n("../utils").inherits(a,i),a.prototype.byteAt=function(l){return this.data[this.zero+l]},a.prototype.lastIndexOfSignature=function(l){for(var c=l.charCodeAt(0),d=l.charCodeAt(1),u=l.charCodeAt(2),h=l.charCodeAt(3),p=this.length-4;0<=p;--p)if(this.data[p]===c&&this.data[p+1]===d&&this.data[p+2]===u&&this.data[p+3]===h)return p-this.zero;return-1},a.prototype.readAndCheckSignature=function(l){var c=l.charCodeAt(0),d=l.charCodeAt(1),u=l.charCodeAt(2),h=l.charCodeAt(3),p=this.readData(4);return c===p[0]&&d===p[1]&&u===p[2]&&h===p[3]},a.prototype.readData=function(l){if(this.checkOffset(l),l===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},r.exports=a},{"../utils":32,"./DataReader":18}],18:[function(n,r,s){var i=n("../utils");function a(l){this.data=l,this.length=l.length,this.index=0,this.zero=0}a.prototype={checkOffset:function(l){this.checkIndex(this.index+l)},checkIndex:function(l){if(this.length<this.zero+l||l<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+l+"). Corrupted zip ?")},setIndex:function(l){this.checkIndex(l),this.index=l},skip:function(l){this.setIndex(this.index+l)},byteAt:function(){},readInt:function(l){var c,d=0;for(this.checkOffset(l),c=this.index+l-1;c>=this.index;c--)d=(d<<8)+this.byteAt(c);return this.index+=l,d},readString:function(l){return i.transformTo("string",this.readData(l))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var l=this.readInt(4);return new Date(Date.UTC(1980+(l>>25&127),(l>>21&15)-1,l>>16&31,l>>11&31,l>>5&63,(31&l)<<1))}},r.exports=a},{"../utils":32}],19:[function(n,r,s){var i=n("./Uint8ArrayReader");function a(l){i.call(this,l)}n("../utils").inherits(a,i),a.prototype.readData=function(l){this.checkOffset(l);var c=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},r.exports=a},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,r,s){var i=n("./DataReader");function a(l){i.call(this,l)}n("../utils").inherits(a,i),a.prototype.byteAt=function(l){return this.data.charCodeAt(this.zero+l)},a.prototype.lastIndexOfSignature=function(l){return this.data.lastIndexOf(l)-this.zero},a.prototype.readAndCheckSignature=function(l){return l===this.readData(4)},a.prototype.readData=function(l){this.checkOffset(l);var c=this.data.slice(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},r.exports=a},{"../utils":32,"./DataReader":18}],21:[function(n,r,s){var i=n("./ArrayReader");function a(l){i.call(this,l)}n("../utils").inherits(a,i),a.prototype.readData=function(l){if(this.checkOffset(l),l===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+l);return this.index+=l,c},r.exports=a},{"../utils":32,"./ArrayReader":17}],22:[function(n,r,s){var i=n("../utils"),a=n("../support"),l=n("./ArrayReader"),c=n("./StringReader"),d=n("./NodeBufferReader"),u=n("./Uint8ArrayReader");r.exports=function(h){var p=i.getTypeOf(h);return i.checkSupport(p),p!=="string"||a.uint8array?p==="nodebuffer"?new d(h):a.uint8array?new u(i.transformTo("uint8array",h)):new l(i.transformTo("array",h)):new c(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,r,s){s.LOCAL_FILE_HEADER="PK",s.CENTRAL_FILE_HEADER="PK",s.CENTRAL_DIRECTORY_END="PK",s.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",s.ZIP64_CENTRAL_DIRECTORY_END="PK",s.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,r,s){var i=n("./GenericWorker"),a=n("../utils");function l(c){i.call(this,"ConvertWorker to "+c),this.destType=c}a.inherits(l,i),l.prototype.processChunk=function(c){this.push({data:a.transformTo(this.destType,c.data),meta:c.meta})},r.exports=l},{"../utils":32,"./GenericWorker":28}],25:[function(n,r,s){var i=n("./GenericWorker"),a=n("../crc32");function l(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(l,i),l.prototype.processChunk=function(c){this.streamInfo.crc32=a(c.data,this.streamInfo.crc32||0),this.push(c)},r.exports=l},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,r,s){var i=n("../utils"),a=n("./GenericWorker");function l(c){a.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}i.inherits(l,a),l.prototype.processChunk=function(c){if(c){var d=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=d+c.data.length}a.prototype.processChunk.call(this,c)},r.exports=l},{"../utils":32,"./GenericWorker":28}],27:[function(n,r,s){var i=n("../utils"),a=n("./GenericWorker");function l(c){a.call(this,"DataWorker");var d=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(u){d.dataIsReady=!0,d.data=u,d.max=u&&u.length||0,d.type=i.getTypeOf(u),d.isPaused||d._tickAndRepeat()},function(u){d.error(u)})}i.inherits(l,a),l.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this.data=null},l.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},l.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},l.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,d=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,d);break;case"uint8array":c=this.data.subarray(this.index,d);break;case"array":case"nodebuffer":c=this.data.slice(this.index,d)}return this.index=d,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},r.exports=l},{"../utils":32,"./GenericWorker":28}],28:[function(n,r,s){function i(a){this.name=a||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(a){this.emit("data",a)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(a){this.emit("error",a)}return!0},error:function(a){return!this.isFinished&&(this.isPaused?this.generatedError=a:(this.isFinished=!0,this.emit("error",a),this.previous&&this.previous.error(a),this.cleanUp()),!0)},on:function(a,l){return this._listeners[a].push(l),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(a,l){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].call(this,l)},pipe:function(a){return a.registerPrevious(this)},registerPrevious:function(a){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=a.streamInfo,this.mergeStreamInfo(),this.previous=a;var l=this;return a.on("data",function(c){l.processChunk(c)}),a.on("end",function(){l.end()}),a.on("error",function(c){l.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var a=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),a=!0),this.previous&&this.previous.resume(),!a},flush:function(){},processChunk:function(a){this.push(a)},withStreamInfo:function(a,l){return this.extraStreamInfo[a]=l,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var a in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,a)&&(this.streamInfo[a]=this.extraStreamInfo[a])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var a="Worker "+this.name;return this.previous?this.previous+" -> "+a:a}},r.exports=i},{}],29:[function(n,r,s){var i=n("../utils"),a=n("./ConvertWorker"),l=n("./GenericWorker"),c=n("../base64"),d=n("../support"),u=n("../external"),h=null;if(d.nodestream)try{h=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function p(m,y){return new u.Promise(function(v,x){var g=[],w=m._internalType,b=m._outputType,k=m._mimeType;m.on("data",function(_,S){g.push(_),y&&y(S)}).on("error",function(_){g=[],x(_)}).on("end",function(){try{var _=function(S,E,T){switch(S){case"blob":return i.newBlob(i.transformTo("arraybuffer",E),T);case"base64":return c.encode(E);default:return i.transformTo(S,E)}}(b,function(S,E){var T,R=0,W=null,P=0;for(T=0;T<E.length;T++)P+=E[T].length;switch(S){case"string":return E.join("");case"array":return Array.prototype.concat.apply([],E);case"uint8array":for(W=new Uint8Array(P),T=0;T<E.length;T++)W.set(E[T],R),R+=E[T].length;return W;case"nodebuffer":return Buffer.concat(E);default:throw new Error("concat : unsupported type '"+S+"'")}}(w,g),k);v(_)}catch(S){x(S)}g=[]}).resume()})}function f(m,y,v){var x=y;switch(y){case"blob":case"arraybuffer":x="uint8array";break;case"base64":x="string"}try{this._internalType=x,this._outputType=y,this._mimeType=v,i.checkSupport(x),this._worker=m.pipe(new a(x)),m.lock()}catch(g){this._worker=new l("error"),this._worker.error(g)}}f.prototype={accumulate:function(m){return p(this,m)},on:function(m,y){var v=this;return m==="data"?this._worker.on(m,function(x){y.call(v,x.data,x.meta)}):this._worker.on(m,function(){i.delay(y,arguments,v)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},m)}},r.exports=f},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,r,s){if(s.base64=!0,s.array=!0,s.string=!0,s.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",s.nodebuffer=typeof Buffer<"u",s.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")s.blob=!1;else{var i=new ArrayBuffer(0);try{s.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var a=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);a.append(i),s.blob=a.getBlob("application/zip").size===0}catch{s.blob=!1}}}try{s.nodestream=!!n("readable-stream").Readable}catch{s.nodestream=!1}},{"readable-stream":16}],31:[function(n,r,s){for(var i=n("./utils"),a=n("./support"),l=n("./nodejsUtils"),c=n("./stream/GenericWorker"),d=new Array(256),u=0;u<256;u++)d[u]=252<=u?6:248<=u?5:240<=u?4:224<=u?3:192<=u?2:1;d[254]=d[254]=1;function h(){c.call(this,"utf-8 decode"),this.leftOver=null}function p(){c.call(this,"utf-8 encode")}s.utf8encode=function(f){return a.nodebuffer?l.newBufferFrom(f,"utf-8"):function(m){var y,v,x,g,w,b=m.length,k=0;for(g=0;g<b;g++)(64512&(v=m.charCodeAt(g)))==55296&&g+1<b&&(64512&(x=m.charCodeAt(g+1)))==56320&&(v=65536+(v-55296<<10)+(x-56320),g++),k+=v<128?1:v<2048?2:v<65536?3:4;for(y=a.uint8array?new Uint8Array(k):new Array(k),g=w=0;w<k;g++)(64512&(v=m.charCodeAt(g)))==55296&&g+1<b&&(64512&(x=m.charCodeAt(g+1)))==56320&&(v=65536+(v-55296<<10)+(x-56320),g++),v<128?y[w++]=v:(v<2048?y[w++]=192|v>>>6:(v<65536?y[w++]=224|v>>>12:(y[w++]=240|v>>>18,y[w++]=128|v>>>12&63),y[w++]=128|v>>>6&63),y[w++]=128|63&v);return y}(f)},s.utf8decode=function(f){return a.nodebuffer?i.transformTo("nodebuffer",f).toString("utf-8"):function(m){var y,v,x,g,w=m.length,b=new Array(2*w);for(y=v=0;y<w;)if((x=m[y++])<128)b[v++]=x;else if(4<(g=d[x]))b[v++]=65533,y+=g-1;else{for(x&=g===2?31:g===3?15:7;1<g&&y<w;)x=x<<6|63&m[y++],g--;1<g?b[v++]=65533:x<65536?b[v++]=x:(x-=65536,b[v++]=55296|x>>10&1023,b[v++]=56320|1023&x)}return b.length!==v&&(b.subarray?b=b.subarray(0,v):b.length=v),i.applyFromCharCode(b)}(f=i.transformTo(a.uint8array?"uint8array":"array",f))},i.inherits(h,c),h.prototype.processChunk=function(f){var m=i.transformTo(a.uint8array?"uint8array":"array",f.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var y=m;(m=new Uint8Array(y.length+this.leftOver.length)).set(this.leftOver,0),m.set(y,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var v=function(g,w){var b;for((w=w||g.length)>g.length&&(w=g.length),b=w-1;0<=b&&(192&g[b])==128;)b--;return b<0||b===0?w:b+d[g[b]]>w?b:w}(m),x=m;v!==m.length&&(a.uint8array?(x=m.subarray(0,v),this.leftOver=m.subarray(v,m.length)):(x=m.slice(0,v),this.leftOver=m.slice(v,m.length))),this.push({data:s.utf8decode(x),meta:f.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:s.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},s.Utf8DecodeWorker=h,i.inherits(p,c),p.prototype.processChunk=function(f){this.push({data:s.utf8encode(f.data),meta:f.meta})},s.Utf8EncodeWorker=p},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,r,s){var i=n("./support"),a=n("./base64"),l=n("./nodejsUtils"),c=n("./external");function d(y){return y}function u(y,v){for(var x=0;x<y.length;++x)v[x]=255&y.charCodeAt(x);return v}n("setimmediate"),s.newBlob=function(y,v){s.checkSupport("blob");try{return new Blob([y],{type:v})}catch{try{var x=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return x.append(y),x.getBlob(v)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(y,v,x){var g=[],w=0,b=y.length;if(b<=x)return String.fromCharCode.apply(null,y);for(;w<b;)v==="array"||v==="nodebuffer"?g.push(String.fromCharCode.apply(null,y.slice(w,Math.min(w+x,b)))):g.push(String.fromCharCode.apply(null,y.subarray(w,Math.min(w+x,b)))),w+=x;return g.join("")},stringifyByChar:function(y){for(var v="",x=0;x<y.length;x++)v+=String.fromCharCode(y[x]);return v},applyCanBeUsed:{uint8array:function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,l.allocBuffer(1)).length===1}catch{return!1}}()}};function p(y){var v=65536,x=s.getTypeOf(y),g=!0;if(x==="uint8array"?g=h.applyCanBeUsed.uint8array:x==="nodebuffer"&&(g=h.applyCanBeUsed.nodebuffer),g)for(;1<v;)try{return h.stringifyByChunk(y,x,v)}catch{v=Math.floor(v/2)}return h.stringifyByChar(y)}function f(y,v){for(var x=0;x<y.length;x++)v[x]=y[x];return v}s.applyFromCharCode=p;var m={};m.string={string:d,array:function(y){return u(y,new Array(y.length))},arraybuffer:function(y){return m.string.uint8array(y).buffer},uint8array:function(y){return u(y,new Uint8Array(y.length))},nodebuffer:function(y){return u(y,l.allocBuffer(y.length))}},m.array={string:p,array:d,arraybuffer:function(y){return new Uint8Array(y).buffer},uint8array:function(y){return new Uint8Array(y)},nodebuffer:function(y){return l.newBufferFrom(y)}},m.arraybuffer={string:function(y){return p(new Uint8Array(y))},array:function(y){return f(new Uint8Array(y),new Array(y.byteLength))},arraybuffer:d,uint8array:function(y){return new Uint8Array(y)},nodebuffer:function(y){return l.newBufferFrom(new Uint8Array(y))}},m.uint8array={string:p,array:function(y){return f(y,new Array(y.length))},arraybuffer:function(y){return y.buffer},uint8array:d,nodebuffer:function(y){return l.newBufferFrom(y)}},m.nodebuffer={string:p,array:function(y){return f(y,new Array(y.length))},arraybuffer:function(y){return m.nodebuffer.uint8array(y).buffer},uint8array:function(y){return f(y,new Uint8Array(y.length))},nodebuffer:d},s.transformTo=function(y,v){if(v=v||"",!y)return v;s.checkSupport(y);var x=s.getTypeOf(v);return m[x][y](v)},s.resolve=function(y){for(var v=y.split("/"),x=[],g=0;g<v.length;g++){var w=v[g];w==="."||w===""&&g!==0&&g!==v.length-1||(w===".."?x.pop():x.push(w))}return x.join("/")},s.getTypeOf=function(y){return typeof y=="string"?"string":Object.prototype.toString.call(y)==="[object Array]"?"array":i.nodebuffer&&l.isBuffer(y)?"nodebuffer":i.uint8array&&y instanceof Uint8Array?"uint8array":i.arraybuffer&&y instanceof ArrayBuffer?"arraybuffer":void 0},s.checkSupport=function(y){if(!i[y.toLowerCase()])throw new Error(y+" is not supported by this platform")},s.MAX_VALUE_16BITS=65535,s.MAX_VALUE_32BITS=-1,s.pretty=function(y){var v,x,g="";for(x=0;x<(y||"").length;x++)g+="\\x"+((v=y.charCodeAt(x))<16?"0":"")+v.toString(16).toUpperCase();return g},s.delay=function(y,v,x){setImmediate(function(){y.apply(x||null,v||[])})},s.inherits=function(y,v){function x(){}x.prototype=v.prototype,y.prototype=new x},s.extend=function(){var y,v,x={};for(y=0;y<arguments.length;y++)for(v in arguments[y])Object.prototype.hasOwnProperty.call(arguments[y],v)&&x[v]===void 0&&(x[v]=arguments[y][v]);return x},s.prepareContent=function(y,v,x,g,w){return c.Promise.resolve(v).then(function(b){return i.blob&&(b instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(b))!==-1)&&typeof FileReader<"u"?new c.Promise(function(k,_){var S=new FileReader;S.onload=function(E){k(E.target.result)},S.onerror=function(E){_(E.target.error)},S.readAsArrayBuffer(b)}):b}).then(function(b){var k=s.getTypeOf(b);return k?(k==="arraybuffer"?b=s.transformTo("uint8array",b):k==="string"&&(w?b=a.decode(b):x&&g!==!0&&(b=function(_){return u(_,i.uint8array?new Uint8Array(_.length):new Array(_.length))}(b))),b):c.Promise.reject(new Error("Can't read the data of '"+y+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,r,s){var i=n("./reader/readerFor"),a=n("./utils"),l=n("./signature"),c=n("./zipEntry"),d=n("./support");function u(h){this.files=[],this.loadOptions=h}u.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var p=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+a.pretty(p)+", expected "+a.pretty(h)+")")}},isSignature:function(h,p){var f=this.reader.index;this.reader.setIndex(h);var m=this.reader.readString(4)===p;return this.reader.setIndex(f),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),p=d.uint8array?"uint8array":"array",f=a.transformTo(p,h);this.zipComment=this.loadOptions.decodeFileName(f)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,p,f,m=this.zip64EndOfCentralSize-44;0<m;)h=this.reader.readInt(2),p=this.reader.readInt(4),f=this.reader.readData(p),this.zip64ExtensibleData[h]={id:h,length:p,value:f}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,p;for(h=0;h<this.files.length;h++)p=this.files[h],this.reader.setIndex(p.localHeaderOffset),this.checkSignature(l.LOCAL_FILE_HEADER),p.readLocalPart(this.reader),p.handleUTF8(),p.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(l.CENTRAL_FILE_HEADER);)(h=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(l.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,l.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var p=h;if(this.checkSignature(l.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(l.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(l.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,l.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(l.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(l.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var f=this.centralDirOffset+this.centralDirSize;this.zip64&&(f+=20,f+=12+this.zip64EndOfCentralSize);var m=p-f;if(0<m)this.isSignature(p,l.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(h){this.reader=i(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},r.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,r,s){var i=n("./reader/readerFor"),a=n("./utils"),l=n("./compressedObject"),c=n("./crc32"),d=n("./utf8"),u=n("./compressions"),h=n("./support");function p(f,m){this.options=f,this.loadOptions=m}p.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(f){var m,y;if(f.skip(22),this.fileNameLength=f.readInt(2),y=f.readInt(2),this.fileName=f.readData(this.fileNameLength),f.skip(y),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=function(v){for(var x in u)if(Object.prototype.hasOwnProperty.call(u,x)&&u[x].magic===v)return u[x];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+a.pretty(this.compressionMethod)+" unknown (inner file : "+a.transformTo("string",this.fileName)+")");this.decompressed=new l(this.compressedSize,this.uncompressedSize,this.crc32,m,f.readData(this.compressedSize))},readCentralPart:function(f){this.versionMadeBy=f.readInt(2),f.skip(2),this.bitFlag=f.readInt(2),this.compressionMethod=f.readString(2),this.date=f.readDate(),this.crc32=f.readInt(4),this.compressedSize=f.readInt(4),this.uncompressedSize=f.readInt(4);var m=f.readInt(2);if(this.extraFieldsLength=f.readInt(2),this.fileCommentLength=f.readInt(2),this.diskNumberStart=f.readInt(2),this.internalFileAttributes=f.readInt(2),this.externalFileAttributes=f.readInt(4),this.localHeaderOffset=f.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");f.skip(m),this.readExtraFields(f),this.parseZIP64ExtraField(f),this.fileComment=f.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var f=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),f==0&&(this.dosPermissions=63&this.externalFileAttributes),f==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var f=i(this.extraFields[1].value);this.uncompressedSize===a.MAX_VALUE_32BITS&&(this.uncompressedSize=f.readInt(8)),this.compressedSize===a.MAX_VALUE_32BITS&&(this.compressedSize=f.readInt(8)),this.localHeaderOffset===a.MAX_VALUE_32BITS&&(this.localHeaderOffset=f.readInt(8)),this.diskNumberStart===a.MAX_VALUE_32BITS&&(this.diskNumberStart=f.readInt(4))}},readExtraFields:function(f){var m,y,v,x=f.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});f.index+4<x;)m=f.readInt(2),y=f.readInt(2),v=f.readData(y),this.extraFields[m]={id:m,length:y,value:v};f.setIndex(x)},handleUTF8:function(){var f=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=d.utf8decode(this.fileName),this.fileCommentStr=d.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var y=a.transformTo(f,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(y)}var v=this.findExtraFieldUnicodeComment();if(v!==null)this.fileCommentStr=v;else{var x=a.transformTo(f,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(x)}}},findExtraFieldUnicodePath:function(){var f=this.extraFields[28789];if(f){var m=i(f.value);return m.readInt(1)!==1||c(this.fileName)!==m.readInt(4)?null:d.utf8decode(m.readData(f.length-5))}return null},findExtraFieldUnicodeComment:function(){var f=this.extraFields[25461];if(f){var m=i(f.value);return m.readInt(1)!==1||c(this.fileComment)!==m.readInt(4)?null:d.utf8decode(m.readData(f.length-5))}return null}},r.exports=p},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,r,s){function i(m,y,v){this.name=m,this.dir=v.dir,this.date=v.date,this.comment=v.comment,this.unixPermissions=v.unixPermissions,this.dosPermissions=v.dosPermissions,this._data=y,this._dataBinary=v.binary,this.options={compression:v.compression,compressionOptions:v.compressionOptions}}var a=n("./stream/StreamHelper"),l=n("./stream/DataWorker"),c=n("./utf8"),d=n("./compressedObject"),u=n("./stream/GenericWorker");i.prototype={internalStream:function(m){var y=null,v="string";try{if(!m)throw new Error("No output type specified.");var x=(v=m.toLowerCase())==="string"||v==="text";v!=="binarystring"&&v!=="text"||(v="string"),y=this._decompressWorker();var g=!this._dataBinary;g&&!x&&(y=y.pipe(new c.Utf8EncodeWorker)),!g&&x&&(y=y.pipe(new c.Utf8DecodeWorker))}catch(w){(y=new u("error")).error(w)}return new a(y,v,"")},async:function(m,y){return this.internalStream(m).accumulate(y)},nodeStream:function(m,y){return this.internalStream(m||"nodebuffer").toNodejsStream(y)},_compressWorker:function(m,y){if(this._data instanceof d&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var v=this._decompressWorker();return this._dataBinary||(v=v.pipe(new c.Utf8EncodeWorker)),d.createWorkerFrom(v,m,y)},_decompressWorker:function(){return this._data instanceof d?this._data.getContentWorker():this._data instanceof u?this._data:new l(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],p=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<h.length;f++)i.prototype[h[f]]=p;r.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,r,s){(function(i){var a,l,c=i.MutationObserver||i.WebKitMutationObserver;if(c){var d=0,u=new c(m),h=i.document.createTextNode("");u.observe(h,{characterData:!0}),a=function(){h.data=d=++d%2}}else if(i.setImmediate||i.MessageChannel===void 0)a="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var y=i.document.createElement("script");y.onreadystatechange=function(){m(),y.onreadystatechange=null,y.parentNode.removeChild(y),y=null},i.document.documentElement.appendChild(y)}:function(){setTimeout(m,0)};else{var p=new i.MessageChannel;p.port1.onmessage=m,a=function(){p.port2.postMessage(0)}}var f=[];function m(){var y,v;l=!0;for(var x=f.length;x;){for(v=f,f=[],y=-1;++y<x;)v[y]();x=f.length}l=!1}r.exports=function(y){f.push(y)!==1||l||a()}}).call(this,typeof Qs<"u"?Qs:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,r,s){var i=n("immediate");function a(){}var l={},c=["REJECTED"],d=["FULFILLED"],u=["PENDING"];function h(x){if(typeof x!="function")throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,x!==a&&y(this,x)}function p(x,g,w){this.promise=x,typeof g=="function"&&(this.onFulfilled=g,this.callFulfilled=this.otherCallFulfilled),typeof w=="function"&&(this.onRejected=w,this.callRejected=this.otherCallRejected)}function f(x,g,w){i(function(){var b;try{b=g(w)}catch(k){return l.reject(x,k)}b===x?l.reject(x,new TypeError("Cannot resolve promise with itself")):l.resolve(x,b)})}function m(x){var g=x&&x.then;if(x&&(typeof x=="object"||typeof x=="function")&&typeof g=="function")return function(){g.apply(x,arguments)}}function y(x,g){var w=!1;function b(S){w||(w=!0,l.reject(x,S))}function k(S){w||(w=!0,l.resolve(x,S))}var _=v(function(){g(k,b)});_.status==="error"&&b(_.value)}function v(x,g){var w={};try{w.value=x(g),w.status="success"}catch(b){w.status="error",w.value=b}return w}(r.exports=h).prototype.finally=function(x){if(typeof x!="function")return this;var g=this.constructor;return this.then(function(w){return g.resolve(x()).then(function(){return w})},function(w){return g.resolve(x()).then(function(){throw w})})},h.prototype.catch=function(x){return this.then(null,x)},h.prototype.then=function(x,g){if(typeof x!="function"&&this.state===d||typeof g!="function"&&this.state===c)return this;var w=new this.constructor(a);return this.state!==u?f(w,this.state===d?x:g,this.outcome):this.queue.push(new p(w,x,g)),w},p.prototype.callFulfilled=function(x){l.resolve(this.promise,x)},p.prototype.otherCallFulfilled=function(x){f(this.promise,this.onFulfilled,x)},p.prototype.callRejected=function(x){l.reject(this.promise,x)},p.prototype.otherCallRejected=function(x){f(this.promise,this.onRejected,x)},l.resolve=function(x,g){var w=v(m,g);if(w.status==="error")return l.reject(x,w.value);var b=w.value;if(b)y(x,b);else{x.state=d,x.outcome=g;for(var k=-1,_=x.queue.length;++k<_;)x.queue[k].callFulfilled(g)}return x},l.reject=function(x,g){x.state=c,x.outcome=g;for(var w=-1,b=x.queue.length;++w<b;)x.queue[w].callRejected(g);return x},h.resolve=function(x){return x instanceof this?x:l.resolve(new this(a),x)},h.reject=function(x){var g=new this(a);return l.reject(g,x)},h.all=function(x){var g=this;if(Object.prototype.toString.call(x)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=x.length,b=!1;if(!w)return this.resolve([]);for(var k=new Array(w),_=0,S=-1,E=new this(a);++S<w;)T(x[S],S);return E;function T(R,W){g.resolve(R).then(function(P){k[W]=P,++_!==w||b||(b=!0,l.resolve(E,k))},function(P){b||(b=!0,l.reject(E,P))})}},h.race=function(x){var g=this;if(Object.prototype.toString.call(x)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=x.length,b=!1;if(!w)return this.resolve([]);for(var k=-1,_=new this(a);++k<w;)S=x[k],g.resolve(S).then(function(E){b||(b=!0,l.resolve(_,E))},function(E){b||(b=!0,l.reject(_,E))});var S;return _}},{immediate:36}],38:[function(n,r,s){var i={};(0,n("./lib/utils/common").assign)(i,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),r.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,r,s){var i=n("./zlib/deflate"),a=n("./utils/common"),l=n("./utils/strings"),c=n("./zlib/messages"),d=n("./zlib/zstream"),u=Object.prototype.toString,h=0,p=-1,f=0,m=8;function y(x){if(!(this instanceof y))return new y(x);this.options=a.assign({level:p,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},x||{});var g=this.options;g.raw&&0<g.windowBits?g.windowBits=-g.windowBits:g.gzip&&0<g.windowBits&&g.windowBits<16&&(g.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var w=i.deflateInit2(this.strm,g.level,g.method,g.windowBits,g.memLevel,g.strategy);if(w!==h)throw new Error(c[w]);if(g.header&&i.deflateSetHeader(this.strm,g.header),g.dictionary){var b;if(b=typeof g.dictionary=="string"?l.string2buf(g.dictionary):u.call(g.dictionary)==="[object ArrayBuffer]"?new Uint8Array(g.dictionary):g.dictionary,(w=i.deflateSetDictionary(this.strm,b))!==h)throw new Error(c[w]);this._dict_set=!0}}function v(x,g){var w=new y(g);if(w.push(x,!0),w.err)throw w.msg||c[w.err];return w.result}y.prototype.push=function(x,g){var w,b,k=this.strm,_=this.options.chunkSize;if(this.ended)return!1;b=g===~~g?g:g===!0?4:0,typeof x=="string"?k.input=l.string2buf(x):u.call(x)==="[object ArrayBuffer]"?k.input=new Uint8Array(x):k.input=x,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new a.Buf8(_),k.next_out=0,k.avail_out=_),(w=i.deflate(k,b))!==1&&w!==h)return this.onEnd(w),!(this.ended=!0);k.avail_out!==0&&(k.avail_in!==0||b!==4&&b!==2)||(this.options.to==="string"?this.onData(l.buf2binstring(a.shrinkBuf(k.output,k.next_out))):this.onData(a.shrinkBuf(k.output,k.next_out)))}while((0<k.avail_in||k.avail_out===0)&&w!==1);return b===4?(w=i.deflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===h):b!==2||(this.onEnd(h),!(k.avail_out=0))},y.prototype.onData=function(x){this.chunks.push(x)},y.prototype.onEnd=function(x){x===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=x,this.msg=this.strm.msg},s.Deflate=y,s.deflate=v,s.deflateRaw=function(x,g){return(g=g||{}).raw=!0,v(x,g)},s.gzip=function(x,g){return(g=g||{}).gzip=!0,v(x,g)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,r,s){var i=n("./zlib/inflate"),a=n("./utils/common"),l=n("./utils/strings"),c=n("./zlib/constants"),d=n("./zlib/messages"),u=n("./zlib/zstream"),h=n("./zlib/gzheader"),p=Object.prototype.toString;function f(y){if(!(this instanceof f))return new f(y);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},y||{});var v=this.options;v.raw&&0<=v.windowBits&&v.windowBits<16&&(v.windowBits=-v.windowBits,v.windowBits===0&&(v.windowBits=-15)),!(0<=v.windowBits&&v.windowBits<16)||y&&y.windowBits||(v.windowBits+=32),15<v.windowBits&&v.windowBits<48&&!(15&v.windowBits)&&(v.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var x=i.inflateInit2(this.strm,v.windowBits);if(x!==c.Z_OK)throw new Error(d[x]);this.header=new h,i.inflateGetHeader(this.strm,this.header)}function m(y,v){var x=new f(v);if(x.push(y,!0),x.err)throw x.msg||d[x.err];return x.result}f.prototype.push=function(y,v){var x,g,w,b,k,_,S=this.strm,E=this.options.chunkSize,T=this.options.dictionary,R=!1;if(this.ended)return!1;g=v===~~v?v:v===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof y=="string"?S.input=l.binstring2buf(y):p.call(y)==="[object ArrayBuffer]"?S.input=new Uint8Array(y):S.input=y,S.next_in=0,S.avail_in=S.input.length;do{if(S.avail_out===0&&(S.output=new a.Buf8(E),S.next_out=0,S.avail_out=E),(x=i.inflate(S,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&T&&(_=typeof T=="string"?l.string2buf(T):p.call(T)==="[object ArrayBuffer]"?new Uint8Array(T):T,x=i.inflateSetDictionary(this.strm,_)),x===c.Z_BUF_ERROR&&R===!0&&(x=c.Z_OK,R=!1),x!==c.Z_STREAM_END&&x!==c.Z_OK)return this.onEnd(x),!(this.ended=!0);S.next_out&&(S.avail_out!==0&&x!==c.Z_STREAM_END&&(S.avail_in!==0||g!==c.Z_FINISH&&g!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(w=l.utf8border(S.output,S.next_out),b=S.next_out-w,k=l.buf2string(S.output,w),S.next_out=b,S.avail_out=E-b,b&&a.arraySet(S.output,S.output,w,b,0),this.onData(k)):this.onData(a.shrinkBuf(S.output,S.next_out)))),S.avail_in===0&&S.avail_out===0&&(R=!0)}while((0<S.avail_in||S.avail_out===0)&&x!==c.Z_STREAM_END);return x===c.Z_STREAM_END&&(g=c.Z_FINISH),g===c.Z_FINISH?(x=i.inflateEnd(this.strm),this.onEnd(x),this.ended=!0,x===c.Z_OK):g!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(S.avail_out=0))},f.prototype.onData=function(y){this.chunks.push(y)},f.prototype.onEnd=function(y){y===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},s.Inflate=f,s.inflate=m,s.inflateRaw=function(y,v){return(v=v||{}).raw=!0,m(y,v)},s.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,r,s){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";s.assign=function(c){for(var d=Array.prototype.slice.call(arguments,1);d.length;){var u=d.shift();if(u){if(typeof u!="object")throw new TypeError(u+"must be non-object");for(var h in u)u.hasOwnProperty(h)&&(c[h]=u[h])}}return c},s.shrinkBuf=function(c,d){return c.length===d?c:c.subarray?c.subarray(0,d):(c.length=d,c)};var a={arraySet:function(c,d,u,h,p){if(d.subarray&&c.subarray)c.set(d.subarray(u,u+h),p);else for(var f=0;f<h;f++)c[p+f]=d[u+f]},flattenChunks:function(c){var d,u,h,p,f,m;for(d=h=0,u=c.length;d<u;d++)h+=c[d].length;for(m=new Uint8Array(h),d=p=0,u=c.length;d<u;d++)f=c[d],m.set(f,p),p+=f.length;return m}},l={arraySet:function(c,d,u,h,p){for(var f=0;f<h;f++)c[p+f]=d[u+f]},flattenChunks:function(c){return[].concat.apply([],c)}};s.setTyped=function(c){c?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,a)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,l))},s.setTyped(i)},{}],42:[function(n,r,s){var i=n("./common"),a=!0,l=!0;try{String.fromCharCode.apply(null,[0])}catch{a=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{l=!1}for(var c=new i.Buf8(256),d=0;d<256;d++)c[d]=252<=d?6:248<=d?5:240<=d?4:224<=d?3:192<=d?2:1;function u(h,p){if(p<65537&&(h.subarray&&l||!h.subarray&&a))return String.fromCharCode.apply(null,i.shrinkBuf(h,p));for(var f="",m=0;m<p;m++)f+=String.fromCharCode(h[m]);return f}c[254]=c[254]=1,s.string2buf=function(h){var p,f,m,y,v,x=h.length,g=0;for(y=0;y<x;y++)(64512&(f=h.charCodeAt(y)))==55296&&y+1<x&&(64512&(m=h.charCodeAt(y+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),y++),g+=f<128?1:f<2048?2:f<65536?3:4;for(p=new i.Buf8(g),y=v=0;v<g;y++)(64512&(f=h.charCodeAt(y)))==55296&&y+1<x&&(64512&(m=h.charCodeAt(y+1)))==56320&&(f=65536+(f-55296<<10)+(m-56320),y++),f<128?p[v++]=f:(f<2048?p[v++]=192|f>>>6:(f<65536?p[v++]=224|f>>>12:(p[v++]=240|f>>>18,p[v++]=128|f>>>12&63),p[v++]=128|f>>>6&63),p[v++]=128|63&f);return p},s.buf2binstring=function(h){return u(h,h.length)},s.binstring2buf=function(h){for(var p=new i.Buf8(h.length),f=0,m=p.length;f<m;f++)p[f]=h.charCodeAt(f);return p},s.buf2string=function(h,p){var f,m,y,v,x=p||h.length,g=new Array(2*x);for(f=m=0;f<x;)if((y=h[f++])<128)g[m++]=y;else if(4<(v=c[y]))g[m++]=65533,f+=v-1;else{for(y&=v===2?31:v===3?15:7;1<v&&f<x;)y=y<<6|63&h[f++],v--;1<v?g[m++]=65533:y<65536?g[m++]=y:(y-=65536,g[m++]=55296|y>>10&1023,g[m++]=56320|1023&y)}return u(g,m)},s.utf8border=function(h,p){var f;for((p=p||h.length)>h.length&&(p=h.length),f=p-1;0<=f&&(192&h[f])==128;)f--;return f<0||f===0?p:f+c[h[f]]>p?f:p}},{"./common":41}],43:[function(n,r,s){r.exports=function(i,a,l,c){for(var d=65535&i|0,u=i>>>16&65535|0,h=0;l!==0;){for(l-=h=2e3<l?2e3:l;u=u+(d=d+a[c++]|0)|0,--h;);d%=65521,u%=65521}return d|u<<16|0}},{}],44:[function(n,r,s){r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,r,s){var i=function(){for(var a,l=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;l[c]=a}return l}();r.exports=function(a,l,c,d){var u=i,h=d+c;a^=-1;for(var p=d;p<h;p++)a=a>>>8^u[255&(a^l[p])];return-1^a}},{}],46:[function(n,r,s){var i,a=n("../utils/common"),l=n("./trees"),c=n("./adler32"),d=n("./crc32"),u=n("./messages"),h=0,p=4,f=0,m=-2,y=-1,v=4,x=2,g=8,w=9,b=286,k=30,_=19,S=2*b+1,E=15,T=3,R=258,W=R+T+1,P=42,I=113,C=1,$=2,fe=3,V=4;function K(j,ne){return j.msg=u[ne],ne}function F(j){return(j<<1)-(4<j?9:0)}function Z(j){for(var ne=j.length;0<=--ne;)j[ne]=0}function U(j){var ne=j.state,oe=ne.pending;oe>j.avail_out&&(oe=j.avail_out),oe!==0&&(a.arraySet(j.output,ne.pending_buf,ne.pending_out,oe,j.next_out),j.next_out+=oe,ne.pending_out+=oe,j.total_out+=oe,j.avail_out-=oe,ne.pending-=oe,ne.pending===0&&(ne.pending_out=0))}function X(j,ne){l._tr_flush_block(j,0<=j.block_start?j.block_start:-1,j.strstart-j.block_start,ne),j.block_start=j.strstart,U(j.strm)}function ge(j,ne){j.pending_buf[j.pending++]=ne}function de(j,ne){j.pending_buf[j.pending++]=ne>>>8&255,j.pending_buf[j.pending++]=255&ne}function Q(j,ne){var oe,z,A=j.max_chain_length,M=j.strstart,G=j.prev_length,ie=j.nice_match,Y=j.strstart>j.w_size-W?j.strstart-(j.w_size-W):0,se=j.window,we=j.w_mask,ue=j.prev,q=j.strstart+R,le=se[M+G-1],be=se[M+G];j.prev_length>=j.good_match&&(A>>=2),ie>j.lookahead&&(ie=j.lookahead);do if(se[(oe=ne)+G]===be&&se[oe+G-1]===le&&se[oe]===se[M]&&se[++oe]===se[M+1]){M+=2,oe++;do;while(se[++M]===se[++oe]&&se[++M]===se[++oe]&&se[++M]===se[++oe]&&se[++M]===se[++oe]&&se[++M]===se[++oe]&&se[++M]===se[++oe]&&se[++M]===se[++oe]&&se[++M]===se[++oe]&&M<q);if(z=R-(q-M),M=q-R,G<z){if(j.match_start=ne,ie<=(G=z))break;le=se[M+G-1],be=se[M+G]}}while((ne=ue[ne&we])>Y&&--A!=0);return G<=j.lookahead?G:j.lookahead}function ke(j){var ne,oe,z,A,M,G,ie,Y,se,we,ue=j.w_size;do{if(A=j.window_size-j.lookahead-j.strstart,j.strstart>=ue+(ue-W)){for(a.arraySet(j.window,j.window,ue,ue,0),j.match_start-=ue,j.strstart-=ue,j.block_start-=ue,ne=oe=j.hash_size;z=j.head[--ne],j.head[ne]=ue<=z?z-ue:0,--oe;);for(ne=oe=ue;z=j.prev[--ne],j.prev[ne]=ue<=z?z-ue:0,--oe;);A+=ue}if(j.strm.avail_in===0)break;if(G=j.strm,ie=j.window,Y=j.strstart+j.lookahead,se=A,we=void 0,we=G.avail_in,se<we&&(we=se),oe=we===0?0:(G.avail_in-=we,a.arraySet(ie,G.input,G.next_in,we,Y),G.state.wrap===1?G.adler=c(G.adler,ie,we,Y):G.state.wrap===2&&(G.adler=d(G.adler,ie,we,Y)),G.next_in+=we,G.total_in+=we,we),j.lookahead+=oe,j.lookahead+j.insert>=T)for(M=j.strstart-j.insert,j.ins_h=j.window[M],j.ins_h=(j.ins_h<<j.hash_shift^j.window[M+1])&j.hash_mask;j.insert&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[M+T-1])&j.hash_mask,j.prev[M&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=M,M++,j.insert--,!(j.lookahead+j.insert<T)););}while(j.lookahead<W&&j.strm.avail_in!==0)}function Oe(j,ne){for(var oe,z;;){if(j.lookahead<W){if(ke(j),j.lookahead<W&&ne===h)return C;if(j.lookahead===0)break}if(oe=0,j.lookahead>=T&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+T-1])&j.hash_mask,oe=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart),oe!==0&&j.strstart-oe<=j.w_size-W&&(j.match_length=Q(j,oe)),j.match_length>=T)if(z=l._tr_tally(j,j.strstart-j.match_start,j.match_length-T),j.lookahead-=j.match_length,j.match_length<=j.max_lazy_match&&j.lookahead>=T){for(j.match_length--;j.strstart++,j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+T-1])&j.hash_mask,oe=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart,--j.match_length!=0;);j.strstart++}else j.strstart+=j.match_length,j.match_length=0,j.ins_h=j.window[j.strstart],j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+1])&j.hash_mask;else z=l._tr_tally(j,0,j.window[j.strstart]),j.lookahead--,j.strstart++;if(z&&(X(j,!1),j.strm.avail_out===0))return C}return j.insert=j.strstart<T-1?j.strstart:T-1,ne===p?(X(j,!0),j.strm.avail_out===0?fe:V):j.last_lit&&(X(j,!1),j.strm.avail_out===0)?C:$}function De(j,ne){for(var oe,z,A;;){if(j.lookahead<W){if(ke(j),j.lookahead<W&&ne===h)return C;if(j.lookahead===0)break}if(oe=0,j.lookahead>=T&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+T-1])&j.hash_mask,oe=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart),j.prev_length=j.match_length,j.prev_match=j.match_start,j.match_length=T-1,oe!==0&&j.prev_length<j.max_lazy_match&&j.strstart-oe<=j.w_size-W&&(j.match_length=Q(j,oe),j.match_length<=5&&(j.strategy===1||j.match_length===T&&4096<j.strstart-j.match_start)&&(j.match_length=T-1)),j.prev_length>=T&&j.match_length<=j.prev_length){for(A=j.strstart+j.lookahead-T,z=l._tr_tally(j,j.strstart-1-j.prev_match,j.prev_length-T),j.lookahead-=j.prev_length-1,j.prev_length-=2;++j.strstart<=A&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+T-1])&j.hash_mask,oe=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart),--j.prev_length!=0;);if(j.match_available=0,j.match_length=T-1,j.strstart++,z&&(X(j,!1),j.strm.avail_out===0))return C}else if(j.match_available){if((z=l._tr_tally(j,0,j.window[j.strstart-1]))&&X(j,!1),j.strstart++,j.lookahead--,j.strm.avail_out===0)return C}else j.match_available=1,j.strstart++,j.lookahead--}return j.match_available&&(z=l._tr_tally(j,0,j.window[j.strstart-1]),j.match_available=0),j.insert=j.strstart<T-1?j.strstart:T-1,ne===p?(X(j,!0),j.strm.avail_out===0?fe:V):j.last_lit&&(X(j,!1),j.strm.avail_out===0)?C:$}function Be(j,ne,oe,z,A){this.good_length=j,this.max_lazy=ne,this.nice_length=oe,this.max_chain=z,this.func=A}function Ge(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new a.Buf16(2*S),this.dyn_dtree=new a.Buf16(2*(2*k+1)),this.bl_tree=new a.Buf16(2*(2*_+1)),Z(this.dyn_ltree),Z(this.dyn_dtree),Z(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new a.Buf16(E+1),this.heap=new a.Buf16(2*b+1),Z(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new a.Buf16(2*b+1),Z(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function He(j){var ne;return j&&j.state?(j.total_in=j.total_out=0,j.data_type=x,(ne=j.state).pending=0,ne.pending_out=0,ne.wrap<0&&(ne.wrap=-ne.wrap),ne.status=ne.wrap?P:I,j.adler=ne.wrap===2?0:1,ne.last_flush=h,l._tr_init(ne),f):K(j,m)}function Xe(j){var ne=He(j);return ne===f&&function(oe){oe.window_size=2*oe.w_size,Z(oe.head),oe.max_lazy_match=i[oe.level].max_lazy,oe.good_match=i[oe.level].good_length,oe.nice_match=i[oe.level].nice_length,oe.max_chain_length=i[oe.level].max_chain,oe.strstart=0,oe.block_start=0,oe.lookahead=0,oe.insert=0,oe.match_length=oe.prev_length=T-1,oe.match_available=0,oe.ins_h=0}(j.state),ne}function nt(j,ne,oe,z,A,M){if(!j)return m;var G=1;if(ne===y&&(ne=6),z<0?(G=0,z=-z):15<z&&(G=2,z-=16),A<1||w<A||oe!==g||z<8||15<z||ne<0||9<ne||M<0||v<M)return K(j,m);z===8&&(z=9);var ie=new Ge;return(j.state=ie).strm=j,ie.wrap=G,ie.gzhead=null,ie.w_bits=z,ie.w_size=1<<ie.w_bits,ie.w_mask=ie.w_size-1,ie.hash_bits=A+7,ie.hash_size=1<<ie.hash_bits,ie.hash_mask=ie.hash_size-1,ie.hash_shift=~~((ie.hash_bits+T-1)/T),ie.window=new a.Buf8(2*ie.w_size),ie.head=new a.Buf16(ie.hash_size),ie.prev=new a.Buf16(ie.w_size),ie.lit_bufsize=1<<A+6,ie.pending_buf_size=4*ie.lit_bufsize,ie.pending_buf=new a.Buf8(ie.pending_buf_size),ie.d_buf=1*ie.lit_bufsize,ie.l_buf=3*ie.lit_bufsize,ie.level=ne,ie.strategy=M,ie.method=oe,Xe(j)}i=[new Be(0,0,0,0,function(j,ne){var oe=65535;for(oe>j.pending_buf_size-5&&(oe=j.pending_buf_size-5);;){if(j.lookahead<=1){if(ke(j),j.lookahead===0&&ne===h)return C;if(j.lookahead===0)break}j.strstart+=j.lookahead,j.lookahead=0;var z=j.block_start+oe;if((j.strstart===0||j.strstart>=z)&&(j.lookahead=j.strstart-z,j.strstart=z,X(j,!1),j.strm.avail_out===0)||j.strstart-j.block_start>=j.w_size-W&&(X(j,!1),j.strm.avail_out===0))return C}return j.insert=0,ne===p?(X(j,!0),j.strm.avail_out===0?fe:V):(j.strstart>j.block_start&&(X(j,!1),j.strm.avail_out),C)}),new Be(4,4,8,4,Oe),new Be(4,5,16,8,Oe),new Be(4,6,32,32,Oe),new Be(4,4,16,16,De),new Be(8,16,32,32,De),new Be(8,16,128,128,De),new Be(8,32,128,256,De),new Be(32,128,258,1024,De),new Be(32,258,258,4096,De)],s.deflateInit=function(j,ne){return nt(j,ne,g,15,8,0)},s.deflateInit2=nt,s.deflateReset=Xe,s.deflateResetKeep=He,s.deflateSetHeader=function(j,ne){return j&&j.state?j.state.wrap!==2?m:(j.state.gzhead=ne,f):m},s.deflate=function(j,ne){var oe,z,A,M;if(!j||!j.state||5<ne||ne<0)return j?K(j,m):m;if(z=j.state,!j.output||!j.input&&j.avail_in!==0||z.status===666&&ne!==p)return K(j,j.avail_out===0?-5:m);if(z.strm=j,oe=z.last_flush,z.last_flush=ne,z.status===P)if(z.wrap===2)j.adler=0,ge(z,31),ge(z,139),ge(z,8),z.gzhead?(ge(z,(z.gzhead.text?1:0)+(z.gzhead.hcrc?2:0)+(z.gzhead.extra?4:0)+(z.gzhead.name?8:0)+(z.gzhead.comment?16:0)),ge(z,255&z.gzhead.time),ge(z,z.gzhead.time>>8&255),ge(z,z.gzhead.time>>16&255),ge(z,z.gzhead.time>>24&255),ge(z,z.level===9?2:2<=z.strategy||z.level<2?4:0),ge(z,255&z.gzhead.os),z.gzhead.extra&&z.gzhead.extra.length&&(ge(z,255&z.gzhead.extra.length),ge(z,z.gzhead.extra.length>>8&255)),z.gzhead.hcrc&&(j.adler=d(j.adler,z.pending_buf,z.pending,0)),z.gzindex=0,z.status=69):(ge(z,0),ge(z,0),ge(z,0),ge(z,0),ge(z,0),ge(z,z.level===9?2:2<=z.strategy||z.level<2?4:0),ge(z,3),z.status=I);else{var G=g+(z.w_bits-8<<4)<<8;G|=(2<=z.strategy||z.level<2?0:z.level<6?1:z.level===6?2:3)<<6,z.strstart!==0&&(G|=32),G+=31-G%31,z.status=I,de(z,G),z.strstart!==0&&(de(z,j.adler>>>16),de(z,65535&j.adler)),j.adler=1}if(z.status===69)if(z.gzhead.extra){for(A=z.pending;z.gzindex<(65535&z.gzhead.extra.length)&&(z.pending!==z.pending_buf_size||(z.gzhead.hcrc&&z.pending>A&&(j.adler=d(j.adler,z.pending_buf,z.pending-A,A)),U(j),A=z.pending,z.pending!==z.pending_buf_size));)ge(z,255&z.gzhead.extra[z.gzindex]),z.gzindex++;z.gzhead.hcrc&&z.pending>A&&(j.adler=d(j.adler,z.pending_buf,z.pending-A,A)),z.gzindex===z.gzhead.extra.length&&(z.gzindex=0,z.status=73)}else z.status=73;if(z.status===73)if(z.gzhead.name){A=z.pending;do{if(z.pending===z.pending_buf_size&&(z.gzhead.hcrc&&z.pending>A&&(j.adler=d(j.adler,z.pending_buf,z.pending-A,A)),U(j),A=z.pending,z.pending===z.pending_buf_size)){M=1;break}M=z.gzindex<z.gzhead.name.length?255&z.gzhead.name.charCodeAt(z.gzindex++):0,ge(z,M)}while(M!==0);z.gzhead.hcrc&&z.pending>A&&(j.adler=d(j.adler,z.pending_buf,z.pending-A,A)),M===0&&(z.gzindex=0,z.status=91)}else z.status=91;if(z.status===91)if(z.gzhead.comment){A=z.pending;do{if(z.pending===z.pending_buf_size&&(z.gzhead.hcrc&&z.pending>A&&(j.adler=d(j.adler,z.pending_buf,z.pending-A,A)),U(j),A=z.pending,z.pending===z.pending_buf_size)){M=1;break}M=z.gzindex<z.gzhead.comment.length?255&z.gzhead.comment.charCodeAt(z.gzindex++):0,ge(z,M)}while(M!==0);z.gzhead.hcrc&&z.pending>A&&(j.adler=d(j.adler,z.pending_buf,z.pending-A,A)),M===0&&(z.status=103)}else z.status=103;if(z.status===103&&(z.gzhead.hcrc?(z.pending+2>z.pending_buf_size&&U(j),z.pending+2<=z.pending_buf_size&&(ge(z,255&j.adler),ge(z,j.adler>>8&255),j.adler=0,z.status=I)):z.status=I),z.pending!==0){if(U(j),j.avail_out===0)return z.last_flush=-1,f}else if(j.avail_in===0&&F(ne)<=F(oe)&&ne!==p)return K(j,-5);if(z.status===666&&j.avail_in!==0)return K(j,-5);if(j.avail_in!==0||z.lookahead!==0||ne!==h&&z.status!==666){var ie=z.strategy===2?function(Y,se){for(var we;;){if(Y.lookahead===0&&(ke(Y),Y.lookahead===0)){if(se===h)return C;break}if(Y.match_length=0,we=l._tr_tally(Y,0,Y.window[Y.strstart]),Y.lookahead--,Y.strstart++,we&&(X(Y,!1),Y.strm.avail_out===0))return C}return Y.insert=0,se===p?(X(Y,!0),Y.strm.avail_out===0?fe:V):Y.last_lit&&(X(Y,!1),Y.strm.avail_out===0)?C:$}(z,ne):z.strategy===3?function(Y,se){for(var we,ue,q,le,be=Y.window;;){if(Y.lookahead<=R){if(ke(Y),Y.lookahead<=R&&se===h)return C;if(Y.lookahead===0)break}if(Y.match_length=0,Y.lookahead>=T&&0<Y.strstart&&(ue=be[q=Y.strstart-1])===be[++q]&&ue===be[++q]&&ue===be[++q]){le=Y.strstart+R;do;while(ue===be[++q]&&ue===be[++q]&&ue===be[++q]&&ue===be[++q]&&ue===be[++q]&&ue===be[++q]&&ue===be[++q]&&ue===be[++q]&&q<le);Y.match_length=R-(le-q),Y.match_length>Y.lookahead&&(Y.match_length=Y.lookahead)}if(Y.match_length>=T?(we=l._tr_tally(Y,1,Y.match_length-T),Y.lookahead-=Y.match_length,Y.strstart+=Y.match_length,Y.match_length=0):(we=l._tr_tally(Y,0,Y.window[Y.strstart]),Y.lookahead--,Y.strstart++),we&&(X(Y,!1),Y.strm.avail_out===0))return C}return Y.insert=0,se===p?(X(Y,!0),Y.strm.avail_out===0?fe:V):Y.last_lit&&(X(Y,!1),Y.strm.avail_out===0)?C:$}(z,ne):i[z.level].func(z,ne);if(ie!==fe&&ie!==V||(z.status=666),ie===C||ie===fe)return j.avail_out===0&&(z.last_flush=-1),f;if(ie===$&&(ne===1?l._tr_align(z):ne!==5&&(l._tr_stored_block(z,0,0,!1),ne===3&&(Z(z.head),z.lookahead===0&&(z.strstart=0,z.block_start=0,z.insert=0))),U(j),j.avail_out===0))return z.last_flush=-1,f}return ne!==p?f:z.wrap<=0?1:(z.wrap===2?(ge(z,255&j.adler),ge(z,j.adler>>8&255),ge(z,j.adler>>16&255),ge(z,j.adler>>24&255),ge(z,255&j.total_in),ge(z,j.total_in>>8&255),ge(z,j.total_in>>16&255),ge(z,j.total_in>>24&255)):(de(z,j.adler>>>16),de(z,65535&j.adler)),U(j),0<z.wrap&&(z.wrap=-z.wrap),z.pending!==0?f:1)},s.deflateEnd=function(j){var ne;return j&&j.state?(ne=j.state.status)!==P&&ne!==69&&ne!==73&&ne!==91&&ne!==103&&ne!==I&&ne!==666?K(j,m):(j.state=null,ne===I?K(j,-3):f):m},s.deflateSetDictionary=function(j,ne){var oe,z,A,M,G,ie,Y,se,we=ne.length;if(!j||!j.state||(M=(oe=j.state).wrap)===2||M===1&&oe.status!==P||oe.lookahead)return m;for(M===1&&(j.adler=c(j.adler,ne,we,0)),oe.wrap=0,we>=oe.w_size&&(M===0&&(Z(oe.head),oe.strstart=0,oe.block_start=0,oe.insert=0),se=new a.Buf8(oe.w_size),a.arraySet(se,ne,we-oe.w_size,oe.w_size,0),ne=se,we=oe.w_size),G=j.avail_in,ie=j.next_in,Y=j.input,j.avail_in=we,j.next_in=0,j.input=ne,ke(oe);oe.lookahead>=T;){for(z=oe.strstart,A=oe.lookahead-(T-1);oe.ins_h=(oe.ins_h<<oe.hash_shift^oe.window[z+T-1])&oe.hash_mask,oe.prev[z&oe.w_mask]=oe.head[oe.ins_h],oe.head[oe.ins_h]=z,z++,--A;);oe.strstart=z,oe.lookahead=T-1,ke(oe)}return oe.strstart+=oe.lookahead,oe.block_start=oe.strstart,oe.insert=oe.lookahead,oe.lookahead=0,oe.match_length=oe.prev_length=T-1,oe.match_available=0,j.next_in=ie,j.input=Y,j.avail_in=G,oe.wrap=M,f},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,r,s){r.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,r,s){r.exports=function(i,a){var l,c,d,u,h,p,f,m,y,v,x,g,w,b,k,_,S,E,T,R,W,P,I,C,$;l=i.state,c=i.next_in,C=i.input,d=c+(i.avail_in-5),u=i.next_out,$=i.output,h=u-(a-i.avail_out),p=u+(i.avail_out-257),f=l.dmax,m=l.wsize,y=l.whave,v=l.wnext,x=l.window,g=l.hold,w=l.bits,b=l.lencode,k=l.distcode,_=(1<<l.lenbits)-1,S=(1<<l.distbits)-1;e:do{w<15&&(g+=C[c++]<<w,w+=8,g+=C[c++]<<w,w+=8),E=b[g&_];t:for(;;){if(g>>>=T=E>>>24,w-=T,(T=E>>>16&255)===0)$[u++]=65535&E;else{if(!(16&T)){if(!(64&T)){E=b[(65535&E)+(g&(1<<T)-1)];continue t}if(32&T){l.mode=12;break e}i.msg="invalid literal/length code",l.mode=30;break e}R=65535&E,(T&=15)&&(w<T&&(g+=C[c++]<<w,w+=8),R+=g&(1<<T)-1,g>>>=T,w-=T),w<15&&(g+=C[c++]<<w,w+=8,g+=C[c++]<<w,w+=8),E=k[g&S];n:for(;;){if(g>>>=T=E>>>24,w-=T,!(16&(T=E>>>16&255))){if(!(64&T)){E=k[(65535&E)+(g&(1<<T)-1)];continue n}i.msg="invalid distance code",l.mode=30;break e}if(W=65535&E,w<(T&=15)&&(g+=C[c++]<<w,(w+=8)<T&&(g+=C[c++]<<w,w+=8)),f<(W+=g&(1<<T)-1)){i.msg="invalid distance too far back",l.mode=30;break e}if(g>>>=T,w-=T,(T=u-h)<W){if(y<(T=W-T)&&l.sane){i.msg="invalid distance too far back",l.mode=30;break e}if(I=x,(P=0)===v){if(P+=m-T,T<R){for(R-=T;$[u++]=x[P++],--T;);P=u-W,I=$}}else if(v<T){if(P+=m+v-T,(T-=v)<R){for(R-=T;$[u++]=x[P++],--T;);if(P=0,v<R){for(R-=T=v;$[u++]=x[P++],--T;);P=u-W,I=$}}}else if(P+=v-T,T<R){for(R-=T;$[u++]=x[P++],--T;);P=u-W,I=$}for(;2<R;)$[u++]=I[P++],$[u++]=I[P++],$[u++]=I[P++],R-=3;R&&($[u++]=I[P++],1<R&&($[u++]=I[P++]))}else{for(P=u-W;$[u++]=$[P++],$[u++]=$[P++],$[u++]=$[P++],2<(R-=3););R&&($[u++]=$[P++],1<R&&($[u++]=$[P++]))}break}}break}}while(c<d&&u<p);c-=R=w>>3,g&=(1<<(w-=R<<3))-1,i.next_in=c,i.next_out=u,i.avail_in=c<d?d-c+5:5-(c-d),i.avail_out=u<p?p-u+257:257-(u-p),l.hold=g,l.bits=w}},{}],49:[function(n,r,s){var i=n("../utils/common"),a=n("./adler32"),l=n("./crc32"),c=n("./inffast"),d=n("./inftrees"),u=1,h=2,p=0,f=-2,m=1,y=852,v=592;function x(P){return(P>>>24&255)+(P>>>8&65280)+((65280&P)<<8)+((255&P)<<24)}function g(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function w(P){var I;return P&&P.state?(I=P.state,P.total_in=P.total_out=I.total=0,P.msg="",I.wrap&&(P.adler=1&I.wrap),I.mode=m,I.last=0,I.havedict=0,I.dmax=32768,I.head=null,I.hold=0,I.bits=0,I.lencode=I.lendyn=new i.Buf32(y),I.distcode=I.distdyn=new i.Buf32(v),I.sane=1,I.back=-1,p):f}function b(P){var I;return P&&P.state?((I=P.state).wsize=0,I.whave=0,I.wnext=0,w(P)):f}function k(P,I){var C,$;return P&&P.state?($=P.state,I<0?(C=0,I=-I):(C=1+(I>>4),I<48&&(I&=15)),I&&(I<8||15<I)?f:($.window!==null&&$.wbits!==I&&($.window=null),$.wrap=C,$.wbits=I,b(P))):f}function _(P,I){var C,$;return P?($=new g,(P.state=$).window=null,(C=k(P,I))!==p&&(P.state=null),C):f}var S,E,T=!0;function R(P){if(T){var I;for(S=new i.Buf32(512),E=new i.Buf32(32),I=0;I<144;)P.lens[I++]=8;for(;I<256;)P.lens[I++]=9;for(;I<280;)P.lens[I++]=7;for(;I<288;)P.lens[I++]=8;for(d(u,P.lens,0,288,S,0,P.work,{bits:9}),I=0;I<32;)P.lens[I++]=5;d(h,P.lens,0,32,E,0,P.work,{bits:5}),T=!1}P.lencode=S,P.lenbits=9,P.distcode=E,P.distbits=5}function W(P,I,C,$){var fe,V=P.state;return V.window===null&&(V.wsize=1<<V.wbits,V.wnext=0,V.whave=0,V.window=new i.Buf8(V.wsize)),$>=V.wsize?(i.arraySet(V.window,I,C-V.wsize,V.wsize,0),V.wnext=0,V.whave=V.wsize):($<(fe=V.wsize-V.wnext)&&(fe=$),i.arraySet(V.window,I,C-$,fe,V.wnext),($-=fe)?(i.arraySet(V.window,I,C-$,$,0),V.wnext=$,V.whave=V.wsize):(V.wnext+=fe,V.wnext===V.wsize&&(V.wnext=0),V.whave<V.wsize&&(V.whave+=fe))),0}s.inflateReset=b,s.inflateReset2=k,s.inflateResetKeep=w,s.inflateInit=function(P){return _(P,15)},s.inflateInit2=_,s.inflate=function(P,I){var C,$,fe,V,K,F,Z,U,X,ge,de,Q,ke,Oe,De,Be,Ge,He,Xe,nt,j,ne,oe,z,A=0,M=new i.Buf8(4),G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!P||!P.state||!P.output||!P.input&&P.avail_in!==0)return f;(C=P.state).mode===12&&(C.mode=13),K=P.next_out,fe=P.output,Z=P.avail_out,V=P.next_in,$=P.input,F=P.avail_in,U=C.hold,X=C.bits,ge=F,de=Z,ne=p;e:for(;;)switch(C.mode){case m:if(C.wrap===0){C.mode=13;break}for(;X<16;){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}if(2&C.wrap&&U===35615){M[C.check=0]=255&U,M[1]=U>>>8&255,C.check=l(C.check,M,2,0),X=U=0,C.mode=2;break}if(C.flags=0,C.head&&(C.head.done=!1),!(1&C.wrap)||(((255&U)<<8)+(U>>8))%31){P.msg="incorrect header check",C.mode=30;break}if((15&U)!=8){P.msg="unknown compression method",C.mode=30;break}if(X-=4,j=8+(15&(U>>>=4)),C.wbits===0)C.wbits=j;else if(j>C.wbits){P.msg="invalid window size",C.mode=30;break}C.dmax=1<<j,P.adler=C.check=1,C.mode=512&U?10:12,X=U=0;break;case 2:for(;X<16;){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}if(C.flags=U,(255&C.flags)!=8){P.msg="unknown compression method",C.mode=30;break}if(57344&C.flags){P.msg="unknown header flags set",C.mode=30;break}C.head&&(C.head.text=U>>8&1),512&C.flags&&(M[0]=255&U,M[1]=U>>>8&255,C.check=l(C.check,M,2,0)),X=U=0,C.mode=3;case 3:for(;X<32;){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}C.head&&(C.head.time=U),512&C.flags&&(M[0]=255&U,M[1]=U>>>8&255,M[2]=U>>>16&255,M[3]=U>>>24&255,C.check=l(C.check,M,4,0)),X=U=0,C.mode=4;case 4:for(;X<16;){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}C.head&&(C.head.xflags=255&U,C.head.os=U>>8),512&C.flags&&(M[0]=255&U,M[1]=U>>>8&255,C.check=l(C.check,M,2,0)),X=U=0,C.mode=5;case 5:if(1024&C.flags){for(;X<16;){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}C.length=U,C.head&&(C.head.extra_len=U),512&C.flags&&(M[0]=255&U,M[1]=U>>>8&255,C.check=l(C.check,M,2,0)),X=U=0}else C.head&&(C.head.extra=null);C.mode=6;case 6:if(1024&C.flags&&(F<(Q=C.length)&&(Q=F),Q&&(C.head&&(j=C.head.extra_len-C.length,C.head.extra||(C.head.extra=new Array(C.head.extra_len)),i.arraySet(C.head.extra,$,V,Q,j)),512&C.flags&&(C.check=l(C.check,$,Q,V)),F-=Q,V+=Q,C.length-=Q),C.length))break e;C.length=0,C.mode=7;case 7:if(2048&C.flags){if(F===0)break e;for(Q=0;j=$[V+Q++],C.head&&j&&C.length<65536&&(C.head.name+=String.fromCharCode(j)),j&&Q<F;);if(512&C.flags&&(C.check=l(C.check,$,Q,V)),F-=Q,V+=Q,j)break e}else C.head&&(C.head.name=null);C.length=0,C.mode=8;case 8:if(4096&C.flags){if(F===0)break e;for(Q=0;j=$[V+Q++],C.head&&j&&C.length<65536&&(C.head.comment+=String.fromCharCode(j)),j&&Q<F;);if(512&C.flags&&(C.check=l(C.check,$,Q,V)),F-=Q,V+=Q,j)break e}else C.head&&(C.head.comment=null);C.mode=9;case 9:if(512&C.flags){for(;X<16;){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}if(U!==(65535&C.check)){P.msg="header crc mismatch",C.mode=30;break}X=U=0}C.head&&(C.head.hcrc=C.flags>>9&1,C.head.done=!0),P.adler=C.check=0,C.mode=12;break;case 10:for(;X<32;){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}P.adler=C.check=x(U),X=U=0,C.mode=11;case 11:if(C.havedict===0)return P.next_out=K,P.avail_out=Z,P.next_in=V,P.avail_in=F,C.hold=U,C.bits=X,2;P.adler=C.check=1,C.mode=12;case 12:if(I===5||I===6)break e;case 13:if(C.last){U>>>=7&X,X-=7&X,C.mode=27;break}for(;X<3;){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}switch(C.last=1&U,X-=1,3&(U>>>=1)){case 0:C.mode=14;break;case 1:if(R(C),C.mode=20,I!==6)break;U>>>=2,X-=2;break e;case 2:C.mode=17;break;case 3:P.msg="invalid block type",C.mode=30}U>>>=2,X-=2;break;case 14:for(U>>>=7&X,X-=7&X;X<32;){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}if((65535&U)!=(U>>>16^65535)){P.msg="invalid stored block lengths",C.mode=30;break}if(C.length=65535&U,X=U=0,C.mode=15,I===6)break e;case 15:C.mode=16;case 16:if(Q=C.length){if(F<Q&&(Q=F),Z<Q&&(Q=Z),Q===0)break e;i.arraySet(fe,$,V,Q,K),F-=Q,V+=Q,Z-=Q,K+=Q,C.length-=Q;break}C.mode=12;break;case 17:for(;X<14;){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}if(C.nlen=257+(31&U),U>>>=5,X-=5,C.ndist=1+(31&U),U>>>=5,X-=5,C.ncode=4+(15&U),U>>>=4,X-=4,286<C.nlen||30<C.ndist){P.msg="too many length or distance symbols",C.mode=30;break}C.have=0,C.mode=18;case 18:for(;C.have<C.ncode;){for(;X<3;){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}C.lens[G[C.have++]]=7&U,U>>>=3,X-=3}for(;C.have<19;)C.lens[G[C.have++]]=0;if(C.lencode=C.lendyn,C.lenbits=7,oe={bits:C.lenbits},ne=d(0,C.lens,0,19,C.lencode,0,C.work,oe),C.lenbits=oe.bits,ne){P.msg="invalid code lengths set",C.mode=30;break}C.have=0,C.mode=19;case 19:for(;C.have<C.nlen+C.ndist;){for(;Be=(A=C.lencode[U&(1<<C.lenbits)-1])>>>16&255,Ge=65535&A,!((De=A>>>24)<=X);){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}if(Ge<16)U>>>=De,X-=De,C.lens[C.have++]=Ge;else{if(Ge===16){for(z=De+2;X<z;){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}if(U>>>=De,X-=De,C.have===0){P.msg="invalid bit length repeat",C.mode=30;break}j=C.lens[C.have-1],Q=3+(3&U),U>>>=2,X-=2}else if(Ge===17){for(z=De+3;X<z;){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}X-=De,j=0,Q=3+(7&(U>>>=De)),U>>>=3,X-=3}else{for(z=De+7;X<z;){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}X-=De,j=0,Q=11+(127&(U>>>=De)),U>>>=7,X-=7}if(C.have+Q>C.nlen+C.ndist){P.msg="invalid bit length repeat",C.mode=30;break}for(;Q--;)C.lens[C.have++]=j}}if(C.mode===30)break;if(C.lens[256]===0){P.msg="invalid code -- missing end-of-block",C.mode=30;break}if(C.lenbits=9,oe={bits:C.lenbits},ne=d(u,C.lens,0,C.nlen,C.lencode,0,C.work,oe),C.lenbits=oe.bits,ne){P.msg="invalid literal/lengths set",C.mode=30;break}if(C.distbits=6,C.distcode=C.distdyn,oe={bits:C.distbits},ne=d(h,C.lens,C.nlen,C.ndist,C.distcode,0,C.work,oe),C.distbits=oe.bits,ne){P.msg="invalid distances set",C.mode=30;break}if(C.mode=20,I===6)break e;case 20:C.mode=21;case 21:if(6<=F&&258<=Z){P.next_out=K,P.avail_out=Z,P.next_in=V,P.avail_in=F,C.hold=U,C.bits=X,c(P,de),K=P.next_out,fe=P.output,Z=P.avail_out,V=P.next_in,$=P.input,F=P.avail_in,U=C.hold,X=C.bits,C.mode===12&&(C.back=-1);break}for(C.back=0;Be=(A=C.lencode[U&(1<<C.lenbits)-1])>>>16&255,Ge=65535&A,!((De=A>>>24)<=X);){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}if(Be&&!(240&Be)){for(He=De,Xe=Be,nt=Ge;Be=(A=C.lencode[nt+((U&(1<<He+Xe)-1)>>He)])>>>16&255,Ge=65535&A,!(He+(De=A>>>24)<=X);){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}U>>>=He,X-=He,C.back+=He}if(U>>>=De,X-=De,C.back+=De,C.length=Ge,Be===0){C.mode=26;break}if(32&Be){C.back=-1,C.mode=12;break}if(64&Be){P.msg="invalid literal/length code",C.mode=30;break}C.extra=15&Be,C.mode=22;case 22:if(C.extra){for(z=C.extra;X<z;){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}C.length+=U&(1<<C.extra)-1,U>>>=C.extra,X-=C.extra,C.back+=C.extra}C.was=C.length,C.mode=23;case 23:for(;Be=(A=C.distcode[U&(1<<C.distbits)-1])>>>16&255,Ge=65535&A,!((De=A>>>24)<=X);){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}if(!(240&Be)){for(He=De,Xe=Be,nt=Ge;Be=(A=C.distcode[nt+((U&(1<<He+Xe)-1)>>He)])>>>16&255,Ge=65535&A,!(He+(De=A>>>24)<=X);){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}U>>>=He,X-=He,C.back+=He}if(U>>>=De,X-=De,C.back+=De,64&Be){P.msg="invalid distance code",C.mode=30;break}C.offset=Ge,C.extra=15&Be,C.mode=24;case 24:if(C.extra){for(z=C.extra;X<z;){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}C.offset+=U&(1<<C.extra)-1,U>>>=C.extra,X-=C.extra,C.back+=C.extra}if(C.offset>C.dmax){P.msg="invalid distance too far back",C.mode=30;break}C.mode=25;case 25:if(Z===0)break e;if(Q=de-Z,C.offset>Q){if((Q=C.offset-Q)>C.whave&&C.sane){P.msg="invalid distance too far back",C.mode=30;break}ke=Q>C.wnext?(Q-=C.wnext,C.wsize-Q):C.wnext-Q,Q>C.length&&(Q=C.length),Oe=C.window}else Oe=fe,ke=K-C.offset,Q=C.length;for(Z<Q&&(Q=Z),Z-=Q,C.length-=Q;fe[K++]=Oe[ke++],--Q;);C.length===0&&(C.mode=21);break;case 26:if(Z===0)break e;fe[K++]=C.length,Z--,C.mode=21;break;case 27:if(C.wrap){for(;X<32;){if(F===0)break e;F--,U|=$[V++]<<X,X+=8}if(de-=Z,P.total_out+=de,C.total+=de,de&&(P.adler=C.check=C.flags?l(C.check,fe,de,K-de):a(C.check,fe,de,K-de)),de=Z,(C.flags?U:x(U))!==C.check){P.msg="incorrect data check",C.mode=30;break}X=U=0}C.mode=28;case 28:if(C.wrap&&C.flags){for(;X<32;){if(F===0)break e;F--,U+=$[V++]<<X,X+=8}if(U!==(4294967295&C.total)){P.msg="incorrect length check",C.mode=30;break}X=U=0}C.mode=29;case 29:ne=1;break e;case 30:ne=-3;break e;case 31:return-4;case 32:default:return f}return P.next_out=K,P.avail_out=Z,P.next_in=V,P.avail_in=F,C.hold=U,C.bits=X,(C.wsize||de!==P.avail_out&&C.mode<30&&(C.mode<27||I!==4))&&W(P,P.output,P.next_out,de-P.avail_out)?(C.mode=31,-4):(ge-=P.avail_in,de-=P.avail_out,P.total_in+=ge,P.total_out+=de,C.total+=de,C.wrap&&de&&(P.adler=C.check=C.flags?l(C.check,fe,de,P.next_out-de):a(C.check,fe,de,P.next_out-de)),P.data_type=C.bits+(C.last?64:0)+(C.mode===12?128:0)+(C.mode===20||C.mode===15?256:0),(ge==0&&de===0||I===4)&&ne===p&&(ne=-5),ne)},s.inflateEnd=function(P){if(!P||!P.state)return f;var I=P.state;return I.window&&(I.window=null),P.state=null,p},s.inflateGetHeader=function(P,I){var C;return P&&P.state&&2&(C=P.state).wrap?((C.head=I).done=!1,p):f},s.inflateSetDictionary=function(P,I){var C,$=I.length;return P&&P.state?(C=P.state).wrap!==0&&C.mode!==11?f:C.mode===11&&a(1,I,$,0)!==C.check?-3:W(P,I,$,$)?(C.mode=31,-4):(C.havedict=1,p):f},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,r,s){var i=n("../utils/common"),a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],l=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],d=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(u,h,p,f,m,y,v,x){var g,w,b,k,_,S,E,T,R,W=x.bits,P=0,I=0,C=0,$=0,fe=0,V=0,K=0,F=0,Z=0,U=0,X=null,ge=0,de=new i.Buf16(16),Q=new i.Buf16(16),ke=null,Oe=0;for(P=0;P<=15;P++)de[P]=0;for(I=0;I<f;I++)de[h[p+I]]++;for(fe=W,$=15;1<=$&&de[$]===0;$--);if($<fe&&(fe=$),$===0)return m[y++]=20971520,m[y++]=20971520,x.bits=1,0;for(C=1;C<$&&de[C]===0;C++);for(fe<C&&(fe=C),P=F=1;P<=15;P++)if(F<<=1,(F-=de[P])<0)return-1;if(0<F&&(u===0||$!==1))return-1;for(Q[1]=0,P=1;P<15;P++)Q[P+1]=Q[P]+de[P];for(I=0;I<f;I++)h[p+I]!==0&&(v[Q[h[p+I]]++]=I);if(S=u===0?(X=ke=v,19):u===1?(X=a,ge-=257,ke=l,Oe-=257,256):(X=c,ke=d,-1),P=C,_=y,K=I=U=0,b=-1,k=(Z=1<<(V=fe))-1,u===1&&852<Z||u===2&&592<Z)return 1;for(;;){for(E=P-K,R=v[I]<S?(T=0,v[I]):v[I]>S?(T=ke[Oe+v[I]],X[ge+v[I]]):(T=96,0),g=1<<P-K,C=w=1<<V;m[_+(U>>K)+(w-=g)]=E<<24|T<<16|R|0,w!==0;);for(g=1<<P-1;U&g;)g>>=1;if(g!==0?(U&=g-1,U+=g):U=0,I++,--de[P]==0){if(P===$)break;P=h[p+v[I]]}if(fe<P&&(U&k)!==b){for(K===0&&(K=fe),_+=C,F=1<<(V=P-K);V+K<$&&!((F-=de[V+K])<=0);)V++,F<<=1;if(Z+=1<<V,u===1&&852<Z||u===2&&592<Z)return 1;m[b=U&k]=fe<<24|V<<16|_-y|0}}return U!==0&&(m[_+U]=P-K<<24|64<<16|0),x.bits=fe,0}},{"../utils/common":41}],51:[function(n,r,s){r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,r,s){var i=n("../utils/common"),a=0,l=1;function c(A){for(var M=A.length;0<=--M;)A[M]=0}var d=0,u=29,h=256,p=h+1+u,f=30,m=19,y=2*p+1,v=15,x=16,g=7,w=256,b=16,k=17,_=18,S=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],E=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],W=new Array(2*(p+2));c(W);var P=new Array(2*f);c(P);var I=new Array(512);c(I);var C=new Array(256);c(C);var $=new Array(u);c($);var fe,V,K,F=new Array(f);function Z(A,M,G,ie,Y){this.static_tree=A,this.extra_bits=M,this.extra_base=G,this.elems=ie,this.max_length=Y,this.has_stree=A&&A.length}function U(A,M){this.dyn_tree=A,this.max_code=0,this.stat_desc=M}function X(A){return A<256?I[A]:I[256+(A>>>7)]}function ge(A,M){A.pending_buf[A.pending++]=255&M,A.pending_buf[A.pending++]=M>>>8&255}function de(A,M,G){A.bi_valid>x-G?(A.bi_buf|=M<<A.bi_valid&65535,ge(A,A.bi_buf),A.bi_buf=M>>x-A.bi_valid,A.bi_valid+=G-x):(A.bi_buf|=M<<A.bi_valid&65535,A.bi_valid+=G)}function Q(A,M,G){de(A,G[2*M],G[2*M+1])}function ke(A,M){for(var G=0;G|=1&A,A>>>=1,G<<=1,0<--M;);return G>>>1}function Oe(A,M,G){var ie,Y,se=new Array(v+1),we=0;for(ie=1;ie<=v;ie++)se[ie]=we=we+G[ie-1]<<1;for(Y=0;Y<=M;Y++){var ue=A[2*Y+1];ue!==0&&(A[2*Y]=ke(se[ue]++,ue))}}function De(A){var M;for(M=0;M<p;M++)A.dyn_ltree[2*M]=0;for(M=0;M<f;M++)A.dyn_dtree[2*M]=0;for(M=0;M<m;M++)A.bl_tree[2*M]=0;A.dyn_ltree[2*w]=1,A.opt_len=A.static_len=0,A.last_lit=A.matches=0}function Be(A){8<A.bi_valid?ge(A,A.bi_buf):0<A.bi_valid&&(A.pending_buf[A.pending++]=A.bi_buf),A.bi_buf=0,A.bi_valid=0}function Ge(A,M,G,ie){var Y=2*M,se=2*G;return A[Y]<A[se]||A[Y]===A[se]&&ie[M]<=ie[G]}function He(A,M,G){for(var ie=A.heap[G],Y=G<<1;Y<=A.heap_len&&(Y<A.heap_len&&Ge(M,A.heap[Y+1],A.heap[Y],A.depth)&&Y++,!Ge(M,ie,A.heap[Y],A.depth));)A.heap[G]=A.heap[Y],G=Y,Y<<=1;A.heap[G]=ie}function Xe(A,M,G){var ie,Y,se,we,ue=0;if(A.last_lit!==0)for(;ie=A.pending_buf[A.d_buf+2*ue]<<8|A.pending_buf[A.d_buf+2*ue+1],Y=A.pending_buf[A.l_buf+ue],ue++,ie===0?Q(A,Y,M):(Q(A,(se=C[Y])+h+1,M),(we=S[se])!==0&&de(A,Y-=$[se],we),Q(A,se=X(--ie),G),(we=E[se])!==0&&de(A,ie-=F[se],we)),ue<A.last_lit;);Q(A,w,M)}function nt(A,M){var G,ie,Y,se=M.dyn_tree,we=M.stat_desc.static_tree,ue=M.stat_desc.has_stree,q=M.stat_desc.elems,le=-1;for(A.heap_len=0,A.heap_max=y,G=0;G<q;G++)se[2*G]!==0?(A.heap[++A.heap_len]=le=G,A.depth[G]=0):se[2*G+1]=0;for(;A.heap_len<2;)se[2*(Y=A.heap[++A.heap_len]=le<2?++le:0)]=1,A.depth[Y]=0,A.opt_len--,ue&&(A.static_len-=we[2*Y+1]);for(M.max_code=le,G=A.heap_len>>1;1<=G;G--)He(A,se,G);for(Y=q;G=A.heap[1],A.heap[1]=A.heap[A.heap_len--],He(A,se,1),ie=A.heap[1],A.heap[--A.heap_max]=G,A.heap[--A.heap_max]=ie,se[2*Y]=se[2*G]+se[2*ie],A.depth[Y]=(A.depth[G]>=A.depth[ie]?A.depth[G]:A.depth[ie])+1,se[2*G+1]=se[2*ie+1]=Y,A.heap[1]=Y++,He(A,se,1),2<=A.heap_len;);A.heap[--A.heap_max]=A.heap[1],function(be,Ne){var ze,Pe,te,pe,qe,st,rt=Ne.dyn_tree,wt=Ne.max_code,ct=Ne.stat_desc.static_tree,Ze=Ne.stat_desc.has_stree,ce=Ne.stat_desc.extra_bits,ee=Ne.stat_desc.extra_base,ve=Ne.stat_desc.max_length,Ve=0;for(pe=0;pe<=v;pe++)be.bl_count[pe]=0;for(rt[2*be.heap[be.heap_max]+1]=0,ze=be.heap_max+1;ze<y;ze++)ve<(pe=rt[2*rt[2*(Pe=be.heap[ze])+1]+1]+1)&&(pe=ve,Ve++),rt[2*Pe+1]=pe,wt<Pe||(be.bl_count[pe]++,qe=0,ee<=Pe&&(qe=ce[Pe-ee]),st=rt[2*Pe],be.opt_len+=st*(pe+qe),Ze&&(be.static_len+=st*(ct[2*Pe+1]+qe)));if(Ve!==0){do{for(pe=ve-1;be.bl_count[pe]===0;)pe--;be.bl_count[pe]--,be.bl_count[pe+1]+=2,be.bl_count[ve]--,Ve-=2}while(0<Ve);for(pe=ve;pe!==0;pe--)for(Pe=be.bl_count[pe];Pe!==0;)wt<(te=be.heap[--ze])||(rt[2*te+1]!==pe&&(be.opt_len+=(pe-rt[2*te+1])*rt[2*te],rt[2*te+1]=pe),Pe--)}}(A,M),Oe(se,le,A.bl_count)}function j(A,M,G){var ie,Y,se=-1,we=M[1],ue=0,q=7,le=4;for(we===0&&(q=138,le=3),M[2*(G+1)+1]=65535,ie=0;ie<=G;ie++)Y=we,we=M[2*(ie+1)+1],++ue<q&&Y===we||(ue<le?A.bl_tree[2*Y]+=ue:Y!==0?(Y!==se&&A.bl_tree[2*Y]++,A.bl_tree[2*b]++):ue<=10?A.bl_tree[2*k]++:A.bl_tree[2*_]++,se=Y,le=(ue=0)===we?(q=138,3):Y===we?(q=6,3):(q=7,4))}function ne(A,M,G){var ie,Y,se=-1,we=M[1],ue=0,q=7,le=4;for(we===0&&(q=138,le=3),ie=0;ie<=G;ie++)if(Y=we,we=M[2*(ie+1)+1],!(++ue<q&&Y===we)){if(ue<le)for(;Q(A,Y,A.bl_tree),--ue!=0;);else Y!==0?(Y!==se&&(Q(A,Y,A.bl_tree),ue--),Q(A,b,A.bl_tree),de(A,ue-3,2)):ue<=10?(Q(A,k,A.bl_tree),de(A,ue-3,3)):(Q(A,_,A.bl_tree),de(A,ue-11,7));se=Y,le=(ue=0)===we?(q=138,3):Y===we?(q=6,3):(q=7,4)}}c(F);var oe=!1;function z(A,M,G,ie){de(A,(d<<1)+(ie?1:0),3),function(Y,se,we,ue){Be(Y),ge(Y,we),ge(Y,~we),i.arraySet(Y.pending_buf,Y.window,se,we,Y.pending),Y.pending+=we}(A,M,G)}s._tr_init=function(A){oe||(function(){var M,G,ie,Y,se,we=new Array(v+1);for(Y=ie=0;Y<u-1;Y++)for($[Y]=ie,M=0;M<1<<S[Y];M++)C[ie++]=Y;for(C[ie-1]=Y,Y=se=0;Y<16;Y++)for(F[Y]=se,M=0;M<1<<E[Y];M++)I[se++]=Y;for(se>>=7;Y<f;Y++)for(F[Y]=se<<7,M=0;M<1<<E[Y]-7;M++)I[256+se++]=Y;for(G=0;G<=v;G++)we[G]=0;for(M=0;M<=143;)W[2*M+1]=8,M++,we[8]++;for(;M<=255;)W[2*M+1]=9,M++,we[9]++;for(;M<=279;)W[2*M+1]=7,M++,we[7]++;for(;M<=287;)W[2*M+1]=8,M++,we[8]++;for(Oe(W,p+1,we),M=0;M<f;M++)P[2*M+1]=5,P[2*M]=ke(M,5);fe=new Z(W,S,h+1,p,v),V=new Z(P,E,0,f,v),K=new Z(new Array(0),T,0,m,g)}(),oe=!0),A.l_desc=new U(A.dyn_ltree,fe),A.d_desc=new U(A.dyn_dtree,V),A.bl_desc=new U(A.bl_tree,K),A.bi_buf=0,A.bi_valid=0,De(A)},s._tr_stored_block=z,s._tr_flush_block=function(A,M,G,ie){var Y,se,we=0;0<A.level?(A.strm.data_type===2&&(A.strm.data_type=function(ue){var q,le=4093624447;for(q=0;q<=31;q++,le>>>=1)if(1&le&&ue.dyn_ltree[2*q]!==0)return a;if(ue.dyn_ltree[18]!==0||ue.dyn_ltree[20]!==0||ue.dyn_ltree[26]!==0)return l;for(q=32;q<h;q++)if(ue.dyn_ltree[2*q]!==0)return l;return a}(A)),nt(A,A.l_desc),nt(A,A.d_desc),we=function(ue){var q;for(j(ue,ue.dyn_ltree,ue.l_desc.max_code),j(ue,ue.dyn_dtree,ue.d_desc.max_code),nt(ue,ue.bl_desc),q=m-1;3<=q&&ue.bl_tree[2*R[q]+1]===0;q--);return ue.opt_len+=3*(q+1)+5+5+4,q}(A),Y=A.opt_len+3+7>>>3,(se=A.static_len+3+7>>>3)<=Y&&(Y=se)):Y=se=G+5,G+4<=Y&&M!==-1?z(A,M,G,ie):A.strategy===4||se===Y?(de(A,2+(ie?1:0),3),Xe(A,W,P)):(de(A,4+(ie?1:0),3),function(ue,q,le,be){var Ne;for(de(ue,q-257,5),de(ue,le-1,5),de(ue,be-4,4),Ne=0;Ne<be;Ne++)de(ue,ue.bl_tree[2*R[Ne]+1],3);ne(ue,ue.dyn_ltree,q-1),ne(ue,ue.dyn_dtree,le-1)}(A,A.l_desc.max_code+1,A.d_desc.max_code+1,we+1),Xe(A,A.dyn_ltree,A.dyn_dtree)),De(A),ie&&Be(A)},s._tr_tally=function(A,M,G){return A.pending_buf[A.d_buf+2*A.last_lit]=M>>>8&255,A.pending_buf[A.d_buf+2*A.last_lit+1]=255&M,A.pending_buf[A.l_buf+A.last_lit]=255&G,A.last_lit++,M===0?A.dyn_ltree[2*G]++:(A.matches++,M--,A.dyn_ltree[2*(C[G]+h+1)]++,A.dyn_dtree[2*X(M)]++),A.last_lit===A.lit_bufsize-1},s._tr_align=function(A){de(A,2,3),Q(A,w,W),function(M){M.bi_valid===16?(ge(M,M.bi_buf),M.bi_buf=0,M.bi_valid=0):8<=M.bi_valid&&(M.pending_buf[M.pending++]=255&M.bi_buf,M.bi_buf>>=8,M.bi_valid-=8)}(A)}},{"../utils/common":41}],53:[function(n,r,s){r.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,r,s){(function(i){(function(a,l){if(!a.setImmediate){var c,d,u,h,p=1,f={},m=!1,y=a.document,v=Object.getPrototypeOf&&Object.getPrototypeOf(a);v=v&&v.setTimeout?v:a,c={}.toString.call(a.process)==="[object process]"?function(b){process.nextTick(function(){g(b)})}:function(){if(a.postMessage&&!a.importScripts){var b=!0,k=a.onmessage;return a.onmessage=function(){b=!1},a.postMessage("","*"),a.onmessage=k,b}}()?(h="setImmediate$"+Math.random()+"$",a.addEventListener?a.addEventListener("message",w,!1):a.attachEvent("onmessage",w),function(b){a.postMessage(h+b,"*")}):a.MessageChannel?((u=new MessageChannel).port1.onmessage=function(b){g(b.data)},function(b){u.port2.postMessage(b)}):y&&"onreadystatechange"in y.createElement("script")?(d=y.documentElement,function(b){var k=y.createElement("script");k.onreadystatechange=function(){g(b),k.onreadystatechange=null,d.removeChild(k),k=null},d.appendChild(k)}):function(b){setTimeout(g,0,b)},v.setImmediate=function(b){typeof b!="function"&&(b=new Function(""+b));for(var k=new Array(arguments.length-1),_=0;_<k.length;_++)k[_]=arguments[_+1];var S={callback:b,args:k};return f[p]=S,c(p),p++},v.clearImmediate=x}function x(b){delete f[b]}function g(b){if(m)setTimeout(g,0,b);else{var k=f[b];if(k){m=!0;try{(function(_){var S=_.callback,E=_.args;switch(E.length){case 0:S();break;case 1:S(E[0]);break;case 2:S(E[0],E[1]);break;case 3:S(E[0],E[1],E[2]);break;default:S.apply(l,E)}})(k)}finally{x(b),m=!1}}}}function w(b){b.source===a&&typeof b.data=="string"&&b.data.indexOf(h)===0&&g(+b.data.slice(h.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof Qs<"u"?Qs:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(o_);var GT=o_.exports;const VT=$l(GT);function YT(t){let e="",n=t;for(;n>=0;)e=String.fromCharCode(n%26+65)+e,n=Math.floor(n/26)-1;return e}function qT(t,e){return`${YT(t)}${e+1}`}async function a_(t,e,n="design"){const s=Math.ceil(e.width/1e3),i=Math.ceil(e.length/1e3);console.log(`[SLICER] Creating ${s}${i} grid (${s*i} tiles) for ${e.width}mm  ${e.length}mm design`);const c=new DOMParser().parseFromString(t,"image/svg+xml").querySelector("svg");if(!c)throw new Error("Invalid SVG content");const d=c.getAttribute("viewBox");let u,h;if(d){const S=d.split(/\s+/).map(Number);u=S[2],h=S[3]}else u=parseFloat(c.getAttribute("width"))||1024,h=parseFloat(c.getAttribute("height"))||1024;console.log(`[SLICER] SVG internal dimensions: ${u}  ${h}`);const p=u/e.width,f=h/e.length,m=1e3*p,y=1e3*f;console.log(`[SLICER] Tile size in SVG units: ${m}  ${y}`);const v=c.innerHTML,x=c.getAttribute("xmlns")||"http://www.w3.org/2000/svg",g=new VT,w=g.folder("tiles"),b=[];for(let S=0;S<i;S++){const E=[];for(let T=0;T<s;T++){const R=qT(T,S);E.push(R);const W=T*m,P=S*y,I=`${W} ${P} ${m} ${y}`,C=`<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="${x}" viewBox="${I}" width="1000mm" height="1000mm">
  <defs>
    <clipPath id="tile-clip">
      <rect x="${W}" y="${P}" width="${m}" height="${y}"/>
    </clipPath>
  </defs>
  <g clip-path="url(#tile-clip)">
${v}
  </g>
</svg>`,$=`${l_(n)}_${R}.svg`;w.file($,C)}b.push(E)}const k=XT(b,e,n);g.file("layout-guide.txt",k);const _=await g.generateAsync({type:"blob"});return console.log(`[SLICER] Created ZIP with ${s*i} tiles`),_}function XT(t,e,n){const r=t.length,s=t[0].length;let i=`TPV Studio - Tile Layout Guide
================================

Design: ${n}
Total Size: ${e.width}mm  ${e.length}mm (${e.width/1e3}m  ${e.length/1e3}m)
Tile Size: 1000mm  1000mm (1m  1m)
Grid: ${s} columns  ${r} rows (${s*r} tiles)

Layout (view from above):
-------------------------

`;const a=6;i+=""+("".repeat(a)+"").repeat(s-1)+"".repeat(a)+`
`;for(let l=0;l<r;l++){i+="";for(let c=0;c<s;c++){const d=t[l][c],u=a-d.length,h=Math.floor(u/2),p=u-h;i+=" ".repeat(h)+d+" ".repeat(p)+""}i+=`
`,l<r-1?i+=""+("".repeat(a)+"").repeat(s-1)+"".repeat(a)+`
`:i+=""+("".repeat(a)+"").repeat(s-1)+"".repeat(a)+`
`}return i+=`
Installation Notes:
-------------------
- Each tile is exactly 1m  1m
- Tiles are named by column (A-Z) and row (1-${r})
- Start from top-left corner (A1) when laying out
- Tiles align perfectly when placed edge-to-edge
- Edge tiles may contain partial content if design isn't exactly divisible by 1m

Generated by TPV Studio
`,i}function l_(t){return t.replace(/[<>:"/\\|?*]/g,"_").replace(/\s+/g,"-").substring(0,50)}function c_(t,e){const n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}async function ZT(t,e,n="design"){try{const r=await fetch(t);if(!r.ok)throw new Error(`Failed to fetch SVG: ${r.statusText}`);const s=await r.text(),i=await a_(s,e,n),a=`${l_(n)}-tiles-1mx1m.zip`;return c_(i,a),console.log(`[SLICER] Downloaded ${a}`),!0}catch(r){throw console.error("[SLICER] Failed to download tiles:",r),r}}var ni;let KT=(ni=class{static next(){return(++ni.seed).toString(16).toUpperCase()}static peek(){return(ni.seed+1).toString(16).toUpperCase()}},rc(ni,"seed",0),ni);var rm=KT;const JT=rm;let QT=class{constructor(e=null){this.handle=JT.next(),this.ownerObjectHandle="0",this.subclassMarkers=[],e&&(Array.isArray(e)?this.subclassMarkers.push(...e):this.subclassMarkers.push(e))}tags(e){e.push(5,this.handle),e.push(330,this.ownerObjectHandle);for(const n of this.subclassMarkers)e.push(100,n)}};var rn=QT;const eN=rn;let tN=class extends eN{constructor(e,n,r){super(["AcDbSymbolTableRecord","AcDbLinetypeTableRecord"]),this.name=e,this.description=n,this.elements=r}tags(e){e.push(0,"LTYPE"),super.tags(e),e.push(2,this.name),e.push(3,this.description),e.push(70,0),e.push(72,65),e.push(73,this.elements.length),e.push(40,this.getElementsSum()),this.elements.forEach(n=>{e.push(49,n),e.push(74,0)})}getElementsSum(){return this.elements.reduce((e,n)=>e+Math.abs(n),0)}};var nN=tN;const rN=rn;let sN=class extends rN{constructor(e,n,r=null){super(["AcDbSymbolTableRecord","AcDbLayerTableRecord"]),this.name=e,this.colorNumber=n,this.lineTypeName=r,this.shapes=[],this.trueColor=-1}tags(e){e.push(0,"LAYER"),super.tags(e),e.push(2,this.name),this.trueColor!==-1?e.push(420,this.trueColor):e.push(62,this.colorNumber),e.push(70,0),this.lineTypeName&&e.push(6,this.lineTypeName),e.push(390,1)}setTrueColor(e){this.trueColor=e}addShape(e){this.shapes.push(e),e.layer=this}getShapes(){return this.shapes}shapesTags(e,n){for(const r of this.shapes)r.ownerObjectHandle=e.handle,r.tags(n)}};var iN=sN;const oN=rn;let aN=class extends oN{constructor(e){super("AcDbSymbolTable"),this.name=e,this.elements=[]}add(e){e.ownerObjectHandle=this.handle,this.elements.push(e)}tags(e){e.push(0,"TABLE"),e.push(2,this.name),super.tags(e),e.push(70,this.elements.length),this.elements.forEach(n=>{n.tags(e)}),e.push(0,"ENDTAB")}};var d_=aN;const lN=rn,cN=d_;let dN=class extends cN{constructor(e){super(e),this.subclassMarkers.push("AcDbDimStyleTable")}tags(e){e.push(0,"TABLE"),e.push(2,this.name),lN.prototype.tags.call(this,e),e.push(70,this.elements.length),e.push(71,1);for(const n of this.elements)n.tags(e);e.push(0,"ENDTAB")}};var uN=dN;const hN=rn;let pN=class extends hN{constructor(n){super(["AcDbSymbolTableRecord","AcDbTextStyleTableRecord"]);rc(this,"fontFileName","txt");this.name=n}tags(n){n.push(0,"STYLE"),super.tags(n),n.push(2,this.name),n.push(70,0),n.push(40,0),n.push(41,1),n.push(50,0),n.push(71,0),n.push(42,1),n.push(3,this.fontFileName),n.push(4,"")}};var fN=pN;const mN=rn;let gN=class extends mN{constructor(e,n){super(["AcDbSymbolTableRecord","AcDbViewportTableRecord"]),this.name=e,this.height=n}tags(e){e.push(0,"VPORT"),super.tags(e),e.push(2,this.name),e.push(40,this.height),e.push(70,0)}};var yN=gN;const xN=rn;let vN=class extends xN{constructor(e){super(["AcDbSymbolTableRecord","AcDbRegAppTableRecord"]),this.name=e}tags(e){e.push(0,"APPID"),super.tags(e),e.push(2,this.name),e.push(70,0)}};var bN=vN;const Ny=rn;let wN=class extends Ny{constructor(e){super(["AcDbEntity","AcDbBlockBegin"]),this.name=e,this.end=new Ny(["AcDbEntity","AcDbBlockEnd"]),this.recordHandle=null}tags(e){e.push(0,"BLOCK"),super.tags(e),e.push(2,this.name),e.push(70,0),e.point(0,0),e.push(3,this.name),e.push(1,""),e.push(0,"ENDBLK"),this.end.tags(e)}};var _N=wN;const kN=rn;let SN=class extends kN{constructor(e){super(["AcDbSymbolTableRecord","AcDbBlockTableRecord"]),this.name=e}tags(e){e.push(0,"BLOCK_RECORD"),super.tags(e),e.push(2,this.name),e.push(70,0),e.push(280,0),e.push(281,1)}};var jN=SN;const CN=rn;let EN=class extends CN{constructor(){super("AcDbDictionary"),this.children={}}addChildDictionary(e,n){n.ownerObjectHandle=this.handle,this.children[e]=n}tags(e){e.push(0,"DICTIONARY"),super.tags(e),e.push(281,1);const n=Object.entries(this.children);for(const s of n){const[i,a]=s;e.push(3,i),e.push(350,a.handle)}const r=Object.values(this.children);for(const s of r)s.tags(e)}};var TN=EN;const NN=rn;let PN=class extends NN{constructor(e,n,r,s){super(["AcDbEntity","AcDbLine"]),this.x1=e,this.y1=n,this.x2=r,this.y2=s}tags(e){e.push(0,"LINE"),super.tags(e),e.push(8,this.layer.name),e.point(this.x1,this.y1),e.push(11,this.x2),e.push(21,this.y2),e.push(31,0)}};var RN=PN;const ON=rn;let AN=class extends ON{constructor(e,n,r,s,i,a){super(["AcDbEntity","AcDbLine"]),this.x1=e,this.y1=n,this.z1=r,this.x2=s,this.y2=i,this.z2=a}tags(e){e.push(0,"LINE"),super.tags(e),e.push(8,this.layer.name),e.point(this.x1,this.y1,this.z1),e.push(11,this.x2),e.push(21,this.y2),e.push(31,this.z2)}};var MN=AN;const $N=rn;let DN=class extends $N{constructor(e,n,r,s,i){super(["AcDbEntity","AcDbCircle"]),this.x=e,this.y=n,this.r=r,this.startAngle=s,this.endAngle=i}tags(e){e.push(0,"ARC"),super.tags(e),e.push(8,this.layer.name),e.point(this.x,this.y),e.push(40,this.r),e.push(100,"AcDbArc"),e.push(50,this.startAngle),e.push(51,this.endAngle)}};var LN=DN;const IN=rn;let zN=class extends IN{constructor(e,n,r){super(["AcDbEntity","AcDbCircle"]),this.x=e,this.y=n,this.r=r}tags(e){e.push(0,"CIRCLE"),super.tags(e),e.push(8,this.layer.name),e.point(this.x,this.y),e.push(40,this.r)}};var FN=zN;const BN=rn;let HN=class extends BN{constructor(e,n,r,s,i,a,l,c){super(["AcDbEntity","AcDbCircle"]),this.x=e,this.y=n,this.z=r,this.r=s,this.thickness=i,this.extrusionDirectionX=a,this.extrusionDirectionY=l,this.extrusionDirectionZ=c}tags(e){e.push(0,"CIRCLE"),super.tags(e),e.push(8,this.layer.name),e.point(this.x,this.y,this.z),e.push(40,this.r),e.push(39,this.thickness),e.push(210,this.extrusionDirectionX),e.push(220,this.extrusionDirectionY),e.push(230,this.extrusionDirectionZ)}};var UN=HN;const WN=rn,Py=["left","center","right"],Ry=["baseline","bottom","middle","top"];let GN=class extends WN{constructor(e,n,r,s,i,a="left",l="baseline"){super(["AcDbEntity","AcDbText"]),this.x=e,this.y=n,this.height=r,this.rotation=s,this.value=i,this.hAlign=a,this.vAlign=l}tags(e){e.push(0,"TEXT"),super.tags(e),e.push(8,this.layer.name),e.point(this.x,this.y),e.push(40,this.height),e.push(1,this.value),e.push(50,this.rotation),Py.includes(this.hAlign,1)||Ry.includes(this.vAlign,1)?(e.push(72,Math.max(Py.indexOf(this.hAlign),0)),e.push(11,this.x),e.push(21,this.y),e.push(31,0),e.push(100,"AcDbText"),e.push(73,Math.max(Ry.indexOf(this.vAlign),0))):e.push(100,"AcDbText")}};var VN=GN;const YN=rn;let qN=class extends YN{constructor(e,n=!1,r=0,s=0){super(["AcDbEntity","AcDbPolyline"]),this.points=e,this.closed=n,this.startWidth=r,this.endWidth=s}tags(e){e.push(0,"LWPOLYLINE"),super.tags(e),e.push(8,this.layer.name),e.push(6,"ByLayer"),e.push(62,256),e.push(370,-1),e.push(90,this.points.length),e.push(70,this.closed?1:0),this.points.forEach(n=>{const[r,s,i]=n;e.push(10,r),e.push(20,s),(this.startWidth!==0||this.endWidth!==0)&&(e.push(40,this.startWidth),e.push(41,this.endWidth)),i!==void 0&&e.push(42,i)})}};var XN=qN;const ZN=rn;let KN=class extends ZN{constructor(e,n,r){super(["AcDbEntity","AcDbVertex","AcDb3dPolylineVertex"]),this.x=e,this.y=n,this.z=r}tags(e){e.push(0,"VERTEX"),super.tags(e),e.push(8,this.layer.name),e.point(this.x,this.y,this.z),e.push(70,32)}};var JN=KN;const QN=rn,eP=rm,tP=JN;let nP=class extends QN{constructor(e){super(["AcDbEntity","AcDb3dPolyline"]),this.verticies=e.map(n=>{const[r,s,i]=n,a=new tP(r,s,i);return a.ownerObjectHandle=this.handle,a}),this.seqendHandle=eP.next()}tags(e){e.push(0,"POLYLINE"),super.tags(e),e.push(8,this.layer.name),e.push(66,1),e.push(70,0),e.point(0,0),this.verticies.forEach(n=>{n.layer=this.layer,n.tags(e)}),e.push(0,"SEQEND"),e.push(5,this.seqendHandle),e.push(100,"AcDbEntity"),e.push(8,this.layer.name)}};var rP=nP;const sP=rn;let iP=class extends sP{constructor(e,n,r,s,i,a,l,c,d,u,h,p){super(["AcDbEntity","AcDbFace"]),this.x1=e,this.y1=n,this.z1=r,this.x2=s,this.y2=i,this.z2=a,this.x3=l,this.y3=c,this.z3=d,this.x4=u,this.y4=h,this.z4=p}tags(e){e.push(0,"3DFACE"),super.tags(e),e.push(8,this.layer.name),e.point(this.x1,this.y1,this.z1),e.push(11,this.x2),e.push(21,this.y2),e.push(31,this.z2),e.push(12,this.x3),e.push(22,this.y3),e.push(32,this.z3),e.push(13,this.x4),e.push(23,this.y4),e.push(33,this.z4)}};var oP=iP;const aP=rn;let lP=class extends aP{constructor(e,n){super(["AcDbEntity","AcDbPoint"]),this.x=e,this.y=n}tags(e){e.push(0,"POINT"),super.tags(e),e.push(8,this.layer.name),e.point(this.x,this.y)}};var cP=lP;const dP=rn;let uP=class extends dP{constructor(e,n=3,r=null,s=null,i=[]){if(super(["AcDbEntity","AcDbSpline"]),e.length<n+1)throw new Error(`For degree ${n} spline, expected at least ${n+1} control points, but received only ${e.length}`);if(r==null){r=[];for(let h=0;h<n+1;h++)r.push(0);for(let h=1;h<e.length-n;h++)r.push(h);for(let h=0;h<n+1;h++)r.push(e.length-n)}if(r.length!==e.length+n+1)throw new Error(`Invalid knot vector length. Expected ${e.length+n+1} but received ${r.length}.`);this.controlPoints=e,this.knots=r,this.fitPoints=i,this.degree=n,this.weights=s;const a=0,l=0,c=this.weights?1:0,d=1,u=0;this.type=a*1+l*2+c*4+d*8+u*16}tags(e){e.push(0,"SPLINE"),super.tags(e),e.push(8,this.layer.name),e.push(210,0),e.push(220,0),e.push(230,1),e.push(70,this.type),e.push(71,this.degree),e.push(72,this.knots.length),e.push(73,this.controlPoints.length),e.push(74,this.fitPoints.length),e.push(42,1e-7),e.push(43,1e-7),e.push(44,1e-10),this.knots.forEach(n=>{e.push(40,n)}),this.weights&&this.weights.forEach(n=>{e.push(41,n)}),this.controlPoints.forEach(n=>{e.point(n[0],n[1])})}};var hP=uP;const pP=rn;let fP=class extends pP{constructor(e,n,r,s,i,a,l){super(["AcDbEntity","AcDbEllipse"]),this.x=e,this.y=n,this.majorAxisX=r,this.majorAxisY=s,this.axisRatio=i,this.startAngle=a,this.endAngle=l}tags(e){e.push(0,"ELLIPSE"),super.tags(e),e.push(8,this.layer.name),e.point(this.x,this.y),e.push(11,this.majorAxisX),e.push(21,this.majorAxisY),e.push(31,0),e.push(40,this.axisRatio),e.push(41,this.startAngle),e.push(42,this.endAngle)}};var mP=fP;let gP=class{constructor(){this.lines=[]}point(e,n,r=0){this.push(10,e),this.push(20,n),this.push(30,r)}start(e){this.push(0,"SECTION"),this.push(2,e)}end(){this.push(0,"ENDSEC")}addHeaderVariable(e,n){this.push(9,`$${e}`),n.forEach(r=>{this.push(r[0],r[1])})}push(e,n){this.lines.push(e,n)}toDxfString(){return this.lines.join(`
`)}};var yP=gP;const xP=nN,vP=iN,$c=d_,bP=uN,wP=fN,_P=yN,kP=bN,SP=_N,jP=jN,Oy=TN,CP=RN,EP=MN,TP=LN,NP=FN,PP=UN,RP=VN,Dc=XN,OP=rP,AP=oP,MP=cP,$P=hP,DP=mP,LP=yP,IP=rm;let aa=class Ei{constructor(){this.layers={},this.activeLayer=null,this.lineTypes={},this.headers={},this.tables={},this.blocks={},this.dictionary=new Oy,this.setUnits("Unitless");for(const e of Ei.LINE_TYPES)this.addLineType(e.name,e.description,e.elements);for(const e of Ei.LAYERS)this.addLayer(e.name,e.colorNumber,e.lineTypeName);this.setActiveLayer("0"),this.generateAutocadExtras()}addLineType(e,n,r){return this.lineTypes[e]=new xP(e,n,r),this}addLayer(e,n,r){return this.layers[e]=new vP(e,n,r),this}setActiveLayer(e){return this.activeLayer=this.layers[e],this}addTable(e){const n=new $c(e);return this.tables[e]=n,n}addBlock(e){const n=new SP(e);return this.blocks[e]=n,n}drawLine(e,n,r,s){return this.activeLayer.addShape(new CP(e,n,r,s)),this}drawLine3d(e,n,r,s,i,a){return this.activeLayer.addShape(new EP(e,n,r,s,i,a)),this}drawPoint(e,n){return this.activeLayer.addShape(new MP(e,n)),this}drawRect(e,n,r,s,i,a){const l=r-e,c=s-n;a=a||0;let d=null;return i?d=new Dc([[e+l-i,n,a],[e+l,n+i],[e+l,n+c-i,a],[e+l-i,n+c],[e+i,n+c,a],[e,n+c-i],[e,n+i,a],[e+i,n]],!0):d=new Dc([[e,n],[e,n+c],[e+l,n+c],[e+l,n]],!0),this.activeLayer.addShape(d),this}drawPolygon(e,n,r,s,i=0,a=!1){const l=2*Math.PI/r,c=[];let d=s;const u=i*Math.PI/180;a&&(d=s/Math.cos(Math.PI/r));for(let h=0;h<r;h++)c.push([e+d*Math.sin(u+h*l),n+d*Math.cos(u+h*l)]);return this.activeLayer.addShape(new Dc(c,!0)),this}drawArc(e,n,r,s,i){return this.activeLayer.addShape(new TP(e,n,r,s,i)),this}drawCircle(e,n,r){return this.activeLayer.addShape(new NP(e,n,r)),this}drawCylinder(e,n,r,s,i,a,l,c){return this.activeLayer.addShape(new PP(e,n,r,s,i,a,l,c)),this}drawText(e,n,r,s,i,a="left",l="baseline"){return this.activeLayer.addShape(new RP(e,n,r,s,i,a,l)),this}drawPolyline(e,n=!1,r=0,s=0){return this.activeLayer.addShape(new Dc(e,n,r,s)),this}drawPolyline3d(e){return e.forEach(n=>{if(n.length!==3)throw"Require 3D coordinates"}),this.activeLayer.addShape(new OP(e)),this}setTrueColor(e){return this.activeLayer.setTrueColor(e),this}drawSpline(e,n=3,r=null,s=null,i=[]){return this.activeLayer.addShape(new $P(e,n,r,s,i)),this}drawEllipse(e,n,r,s,i,a=0,l=2*Math.PI){return this.activeLayer.addShape(new DP(e,n,r,s,i,a,l)),this}drawFace(e,n,r,s,i,a,l,c,d,u,h,p){return this.activeLayer.addShape(new AP(e,n,r,s,i,a,l,c,d,u,h,p)),this}_ltypeTable(){const e=new $c("LTYPE"),n=Object.values(this.lineTypes);for(const r of n)e.add(r);return e}_layerTable(e){const n=new $c("LAYER"),r=Object.values(this.layers);for(const s of r)n.add(s);return n}header(e,n){return this.headers[e]=n,this}setUnits(e){return typeof Ei.UNITS[e]<"u"?Ei.UNITS[e]:Ei.UNITS.Unitless,this.header("INSUNITS",[[70,Ei.UNITS[e]]]),this}generateAutocadExtras(){this.headers.ACADVER||this.header("ACADVER",[[1,"AC1021"]]),this.lineTypes.ByBlock||this.addLineType("ByBlock","",[]),this.lineTypes.ByLayer||this.addLineType("ByLayer","",[]);let e=this.tables.VPORT;e||(e=this.addTable("VPORT"));let n=this.tables.STYLE;n||(n=this.addTable("STYLE")),this.tables.VIEW||this.addTable("VIEW"),this.tables.UCS||this.addTable("UCS");let r=this.tables.APPID;if(r||(r=this.addTable("APPID")),!this.tables.DIMSTYLE){const i=new bP("DIMSTYLE");this.tables.DIMSTYLE=i}e.add(new _P("*ACTIVE",1e3)),n.add(new wP("standard")),r.add(new kP("ACAD")),this.modelSpace=this.addBlock("*Model_Space"),this.addBlock("*Paper_Space");const s=new Oy;this.dictionary.addChildDictionary("ACAD_GROUP",s)}_tagsManager(){const e=new LP,n=new $c("BLOCK_RECORD"),r=Object.values(this.blocks);for(const d of r){const u=new jP(d.name);n.add(u)}const s=this._ltypeTable(),i=this._layerTable();e.start("HEADER"),e.addHeaderVariable("HANDSEED",[[5,IP.peek()]]);const a=Object.entries(this.headers);for(const d of a){const[u,h]=d;e.addHeaderVariable(u,h)}e.end(),e.start("CLASSES"),e.end(),e.start("TABLES"),s.tags(e),i.tags(e);const l=Object.values(this.tables);for(const d of l)d.tags(e);n.tags(e),e.end(),e.start("BLOCKS");for(const d of r)d.tags(e);e.end(),e.start("ENTITIES");const c=Object.values(this.layers);for(const d of c)d.shapesTags(this.modelSpace,e);return e.end(),e.start("OBJECTS"),this.dictionary.tags(e),e.end(),e.push(0,"EOF"),e}toDxfString(){return this._tagsManager().toDxfString()}};aa.ACI={LAYER:0,RED:1,YELLOW:2,GREEN:3,CYAN:4,BLUE:5,MAGENTA:6,WHITE:7};aa.LINE_TYPES=[{name:"CONTINUOUS",description:"______",elements:[]},{name:"DASHED",description:"_ _ _ ",elements:[5,-5]},{name:"DOTTED",description:". . . ",elements:[0,-5]}];aa.LAYERS=[{name:"0",colorNumber:aa.ACI.WHITE,lineTypeName:"CONTINUOUS"}];aa.UNITS={Unitless:0,Inches:1,Feet:2,Miles:3,Millimeters:4,Centimeters:5,Meters:6,Kilometers:7,Microinches:8,Mils:9,Yards:10,Angstroms:11,Nanometers:12,Microns:13,Decimeters:14,Decameters:15,Hectometers:16,Gigameters:17,"Astronomical units":18,"Light years":19,Parsecs:20};var zP=aa,FP=zP;const BP=$l(FP);function HP(t,e=2){if(!t)return[];const n=[];let r=[],s=0,i=0,a=0,l=0;const c=UP(t);for(const d of c){const u=d.type,h=d.args;switch(u){case"M":r.length>0&&n.push(r),s=h[0],i=h[1],a=s,l=i,r=[{x:s,y:i}];break;case"m":r.length>0&&n.push(r),s+=h[0],i+=h[1],a=s,l=i,r=[{x:s,y:i}];break;case"L":s=h[0],i=h[1],r.push({x:s,y:i});break;case"l":s+=h[0],i+=h[1],r.push({x:s,y:i});break;case"H":s=h[0],r.push({x:s,y:i});break;case"h":s+=h[0],r.push({x:s,y:i});break;case"V":i=h[0],r.push({x:s,y:i});break;case"v":i+=h[0],r.push({x:s,y:i});break;case"C":{const p=Ap(s,i,h[0],h[1],h[2],h[3],h[4],h[5],e);r.push(...p.slice(1)),s=h[4],i=h[5]}break;case"c":{const p=Ap(s,i,s+h[0],i+h[1],s+h[2],i+h[3],s+h[4],i+h[5],e);r.push(...p.slice(1)),s+=h[4],i+=h[5]}break;case"Q":{const p=Ay(s,i,h[0],h[1],h[2],h[3],e);r.push(...p.slice(1)),s=h[2],i=h[3]}break;case"q":{const p=Ay(s,i,s+h[0],i+h[1],s+h[2],i+h[3],e);r.push(...p.slice(1)),s+=h[2],i+=h[3]}break;case"A":{const p=My(s,i,h[0],h[1],h[2],h[3],h[4],h[5],h[6],e);r.push(...p.slice(1)),s=h[5],i=h[6]}break;case"a":{const p=s+h[5],f=i+h[6],m=My(s,i,h[0],h[1],h[2],h[3],h[4],p,f,e);r.push(...m.slice(1)),s=p,i=f}break;case"Z":case"z":r.length>0&&(r.push({x:a,y:l}),s=a,i=l);break}}return r.length>0&&n.push(r),n}function UP(t){const e=[],n=/([MmLlHhVvCcSsQqTtAaZz])([^MmLlHhVvCcSsQqTtAaZz]*)/g,r=[...t.matchAll(n)];for(const s of r){const i=s[1],l=s[2].trim().split(/[\s,]+/).filter(c=>c.length>0).map(Number);e.push({type:i,args:l})}return e}function Ap(t,e,n,r,s,i,a,l,c){const d=[{x:t,y:e}];return Mp(t,e,n,r,s,i,a,l,c,d),d.push({x:a,y:l}),d}function Mp(t,e,n,r,s,i,a,l,c,d){const u=a-t,h=l-e;if(Math.sqrt(u*u+h*h)<.001)return;const f=$y(n,r,t,e,a,l),m=$y(s,i,t,e,a,l);if(f<c&&m<c)return;const y=(t+n)/2,v=(e+r)/2,x=(n+s)/2,g=(r+i)/2,w=(s+a)/2,b=(i+l)/2,k=(y+x)/2,_=(v+g)/2,S=(x+w)/2,E=(g+b)/2,T=(k+S)/2,R=(_+E)/2;Mp(t,e,y,v,k,_,T,R,c,d),d.push({x:T,y:R}),Mp(T,R,S,E,w,b,a,l,c,d)}function Ay(t,e,n,r,s,i,a){const l=t+.6666666666666666*(n-t),c=e+2/3*(r-e),d=s+2/3*(n-s),u=i+2/3*(r-i);return Ap(t,e,l,c,d,u,s,i,a)}function My(t,e,n,r,s,i,a,l,c,d){if(n===0||r===0)return[{x:t,y:e},{x:l,y:c}];const u=WP(t,e,n,r,s,i,a,l,c);if(!u)return[{x:t,y:e},{x:l,y:c}];const{cx:h,cy:p,theta1:f,dtheta:m,rx:y,ry:v}=u,x=s*Math.PI/180,g=(y+v)/2,w=Math.abs(m)*g,b=Math.max(4,Math.ceil(w/(2*Math.sqrt(2*d*g)))),k=[];for(let _=0;_<=b;_++){const S=f+m*_/b,E=Math.cos(S),T=Math.sin(S),R=Math.cos(x),W=Math.sin(x),P=h+y*E*R-v*T*W,I=p+y*E*W+v*T*R;k.push({x:P,y:I})}return k}function WP(t,e,n,r,s,i,a,l,c){const d=s*Math.PI/180,u=Math.cos(d),h=Math.sin(d),p=(t-l)/2,f=(e-c)/2,m=u*p+h*f,y=-h*p+u*f;n=Math.abs(n),r=Math.abs(r);const v=m*m/(n*n)+y*y/(r*r);if(v>1){const Z=Math.sqrt(v);n*=Z,r*=Z}const x=n*n,g=r*r,w=m*m,b=y*y;let k=(x*g-x*b-g*w)/(x*b+g*w);k<0&&(k=0);const _=(i!==a?1:-1)*Math.sqrt(k),S=_*(n*y)/r,E=_*-(r*m)/n,T=u*S-h*E+(t+l)/2,R=h*S+u*E+(e+c)/2,W=(m-S)/n,P=(y-E)/r,I=(-m-S)/n,C=(-y-E)/r,$=Math.sqrt(W*W+P*P),fe=(P>=0?1:-1)*Math.acos(W/$),V=W*I+P*C,K=W*C-P*I;let F=Math.acos(Math.max(-1,Math.min(1,V/($*Math.sqrt(I*I+C*C)))));return K<0&&(F=-F),!a&&F>0&&(F-=2*Math.PI),a&&F<0&&(F+=2*Math.PI),{cx:T,cy:R,theta1:fe,dtheta:F,rx:n,ry:r}}function $y(t,e,n,r,s,i){const a=s-n,l=i-r,c=Math.sqrt(a*a+l*l);return c===0?Math.sqrt((t-n)**2+(e-r)**2):Math.abs((l*t-a*e+s*r-i*n)/c)}function GP(t,e,n,r,s=0,i=0){if(t=parseFloat(t)||0,e=parseFloat(e)||0,n=parseFloat(n)||0,r=parseFloat(r)||0,s=parseFloat(s)||0,i=parseFloat(i)||s,s===0&&i===0)return[{x:t,y:e},{x:t+n,y:e},{x:t+n,y:e+r},{x:t,y:e+r},{x:t,y:e}];s=Math.min(s,n/2),i=Math.min(i,r/2);const a=[],l=8;for(let c=0;c<=l;c++){const d=-Math.PI/2+Math.PI/2*(c/l);a.push({x:t+n-s+s*Math.cos(d),y:e+i+i*Math.sin(d)})}for(let c=0;c<=l;c++){const d=0+Math.PI/2*(c/l);a.push({x:t+n-s+s*Math.cos(d),y:e+r-i+i*Math.sin(d)})}for(let c=0;c<=l;c++){const d=Math.PI/2+Math.PI/2*(c/l);a.push({x:t+s+s*Math.cos(d),y:e+r-i+i*Math.sin(d)})}for(let c=0;c<=l;c++){const d=Math.PI+Math.PI/2*(c/l);a.push({x:t+s+s*Math.cos(d),y:e+i+i*Math.sin(d)})}return a.push(a[0]),a}function VP(t,e,n,r=32){t=parseFloat(t)||0,e=parseFloat(e)||0,n=parseFloat(n)||0;const s=[];for(let i=0;i<=r;i++){const a=2*Math.PI*i/r;s.push({x:t+n*Math.cos(a),y:e+n*Math.sin(a)})}return s}function YP(t,e,n,r,s=32){t=parseFloat(t)||0,e=parseFloat(e)||0,n=parseFloat(n)||0,r=parseFloat(r)||0;const i=[];for(let a=0;a<=s;a++){const l=2*Math.PI*a/s;i.push({x:t+n*Math.cos(l),y:e+r*Math.sin(l)})}return i}function qP(t){if(!t)return[];const e=t.trim().split(/[\s,]+/).map(Number),n=[];for(let r=0;r<e.length;r+=2)r+1<e.length&&n.push({x:e[r],y:e[r+1]});return n.length>0&&n.push({x:n[0].x,y:n[0].y}),n}function XP(t){if(!t)return[];const e=t.trim().split(/[\s,]+/).map(Number),n=[];for(let r=0;r<e.length;r+=2)r+1<e.length&&n.push({x:e[r],y:e[r+1]});return n}function ZP(t,e,n,r){return[{x:parseFloat(t)||0,y:parseFloat(e)||0},{x:parseFloat(n)||0,y:parseFloat(r)||0}]}function Ad(t,e){if(!e||!t.length)return t;const n=KP(e);return t.map(r=>QP(r,n))}function KP(t){let e=[1,0,0,1,0,0];const n=t.match(/\w+\([^)]+\)/g)||[];for(const r of n){const s=r.match(/(\w+)\(([^)]+)\)/);if(!s)continue;const i=s[1],a=s[2].split(/[\s,]+/).map(Number);let l;switch(i){case"translate":l=[1,0,0,1,a[0]||0,a[1]||0];break;case"scale":l=[a[0]||1,0,0,a[1]??a[0]??1,0,0];break;case"rotate":const c=(a[0]||0)*Math.PI/180,d=Math.cos(c),u=Math.sin(c);if(a.length===3){const h=a[1],p=a[2];l=[d,u,-u,d,h-d*h+u*p,p-u*h-d*p]}else l=[d,u,-u,d,0,0];break;case"matrix":for(l=a.slice(0,6);l.length<6;)l.push(0);break;default:continue}e=JP(e,l)}return e}function JP(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}function QP(t,e){return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}}let Lc=[];const ph={"#A5362F":"RH01","#E21F2F":"RH02","#609B63":"RH10","#3BB44A":"RH11","#006C55":"RH12","#0075BC":"RH20","#493D8C":"RH21","#47AFE3":"RH22","#039DC4":"RH23","#00A6A3":"RH26","#E4C4AA":"RH30","#E8E3D8":"RH31","#8B5F3C":"RH32","#E5A144":"RH40","#FFD833":"RH41","#F15B32":"RH50","#59595B":"RH60","#939598":"RH61","#D9D9D6":"RH65","#231F20":"RH70","#E8457E":"RH90"},fh={RH01:1,RH02:1,RH10:3,RH11:3,RH12:3,RH20:5,RH21:6,RH22:4,RH23:4,RH26:4,RH30:52,RH31:7,RH32:38,RH40:2,RH41:2,RH50:30,RH60:8,RH61:8,RH65:9,RH70:250,RH90:6,OUTER_BORDER:2,NOTES:4,TEXT_OUTLINES:7,OTHER_COLORS:7};function e3(t,e){const{widthMm:n,lengthMm:r,designName:s="TPV Design",seed:i,motifs:a}=e;Lc=[];const l=new BP,c=r3(t),d=n/c.width,u=r/c.height,h=new Map,p=t.querySelectorAll("path, rect, circle, ellipse, polygon, polyline, line");let f=0,m=0,y=0;for(const x of p){const g=x.getAttribute("display"),w=x.getAttribute("visibility");if(g==="none"||w==="hidden")continue;const b=x.getAttribute("class")||"";if(b.includes("handle")||b.includes("selection"))continue;const k=h_(x);if(!k||k==="none"||k==="transparent"){m++;continue}const S=p_(k)||"OTHER_COLORS";h.has(S)||h.set(S,[]);let E;try{E=f_(x)}catch(I){console.warn("[DXF] Error converting element:",I),y++;continue}if(!E||E.length===0){y++;continue}const T=u_(x),W=(T?Ad(E,T):E).filter(I=>isFinite(I.x)&&isFinite(I.y)&&!isNaN(I.x)&&!isNaN(I.y));if(W.length<2){y++;continue}const P=W.map(I=>({x:I.x*d,y:r-I.y*u}));h.get(S).push(P),f++}const v=t.querySelectorAll("text");if(v.length>0){Lc.push(`${v.length} text element(s) were converted to outlines. Edit text in CAD if needed.`);for(const x of v)try{const g=t3(x,d,u,r);g&&(h.has("TEXT_OUTLINES")||h.set("TEXT_OUTLINES",[]),h.get("TEXT_OUTLINES").push(g),f++)}catch(g){console.warn("[DXF] Error converting text:",g)}}if(a&&Object.keys(a).length>0){let x=0,g=0;for(const[w,b]of Object.entries(a)){if(!b.svgContent){g++;continue}try{const k=n3(b,d,u,r);for(const{layerName:_,vertices:S}of k)h.has(_)||h.set(_,[]),h.get(_).push(S),f++;x++}catch(k){console.warn(`[DXF] Error processing motif ${w}:`,k),g++}}x>0&&console.log(`[DXF] Processed ${x} motif(s)`),g>0&&Lc.push(`${g} motif(s) could not be fully exported due to missing or invalid SVG content.`)}for(const[x,g]of h){const w=fh[x]||7;try{l.addLayer(x,w,"CONTINUOUS"),l.setActiveLayer(x)}catch(b){console.warn(`[DXF] Error creating layer ${x}:`,b);continue}for(const b of g)if(b.length>=2)try{const k=b.length>2&&Math.abs(b[0].x-b[b.length-1].x)<.01&&Math.abs(b[0].y-b[b.length-1].y)<.01,_=b.map(E=>[E.x,E.y]);k&&_.length>1&&_.pop();const S=_.filter(E=>isFinite(E[0])&&isFinite(E[1])&&!isNaN(E[0])&&!isNaN(E[1]));S.length>=2&&l.drawPolyline(S,k)}catch(k){console.warn("[DXF] Error drawing polyline:",k)}}try{l.addLayer("OUTER_BORDER",fh.OUTER_BORDER,"CONTINUOUS"),l.setActiveLayer("OUTER_BORDER"),l.drawPolyline([[0,0],[n,0],[n,r],[0,r]],!0)}catch(x){console.warn("[DXF] Error adding border:",x)}try{l.addLayer("NOTES",fh.NOTES,"CONTINUOUS"),l.setActiveLayer("NOTES");const x=[`Project: ${s}`,`Size: ${(n/1e3).toFixed(2)}m x ${(r/1e3).toFixed(2)}m`,`Generated: ${new Date().toISOString().split("T")[0]}`,i?`Seed: ${i}`:null,"TPV Studio | rosehilltpv.com"].filter(Boolean).join("\\P");l.drawText(10,-50,100,0,x)}catch(x){console.warn("[DXF] Error adding notes:",x)}return console.log(`[DXF] Export complete: ${f} elements processed, ${m} transparent skipped, ${y} invalid skipped`),{dxfContent:l.toDxfString(),warnings:Lc}}function u_(t){const e=[];let n=t;for(;n&&n.getAttribute;){const r=n.getAttribute("transform");r&&e.unshift(r),n=n.parentElement}return e.length>0?e.join(" "):null}function t3(t,e,n,r){try{const s=t.getBBox?t.getBBox():null;if(s&&s.width>0&&s.height>0){const i=u_(t);let a=[{x:s.x,y:s.y},{x:s.x+s.width,y:s.y},{x:s.x+s.width,y:s.y+s.height},{x:s.x,y:s.y+s.height},{x:s.x,y:s.y}];return i&&(a=Ad(a,i)),a.map(l=>({x:l.x*e,y:r-l.y*n}))}}catch(s){console.warn("[DXF] Could not get text bounds:",s)}return null}function n3(t,e,n,r){const s=[],{svgContent:i,position:a,rotation:l,scale:c,originalWidth_mm:d,originalHeight_mm:u}=t,f=new DOMParser().parseFromString(i,"image/svg+xml").querySelector("svg");if(!f)return console.warn("[DXF] Could not parse motif SVG"),s;const m=f.getAttribute("viewBox");let y={width:100,height:100};if(m){const E=m.split(/\s+/).map(Number);E.length>=4&&(y={width:E[2],height:E[3]})}const v=(d||1e3)*(c||1),x=(u||1e3)*(c||1),g=v/y.width,w=x/y.height,b=v/2,k=x/2,_=`translate(${a.x}, ${a.y}) rotate(${l||0}, ${b}, ${k})`,S=f.querySelectorAll("path, rect, circle, ellipse, polygon, polyline");for(const E of S){const T=E.getAttribute("display"),R=E.getAttribute("visibility");if(T==="none"||R==="hidden")continue;const W=h_(E);if(!W||W==="none"||W==="transparent")continue;const I=p_(W)||"OTHER_COLORS";let C;try{C=f_(E)}catch{continue}if(!C||C.length===0)continue;const $=E.getAttribute("transform");$&&(C=Ad(C,$)),C=C.map(K=>({x:K.x*g,y:K.y*w})),C=Ad(C,_);const fe=C.filter(K=>isFinite(K.x)&&isFinite(K.y)&&!isNaN(K.x)&&!isNaN(K.y));if(fe.length<2)continue;const V=fe.map(K=>({x:K.x*e,y:r-K.y*n}));s.push({layerName:I,vertices:V})}return s}function r3(t){const e=t.getAttribute("viewBox");if(e){const[s,i,a,l]=e.split(/\s+/).map(Number);return{minX:s,minY:i,width:a,height:l}}const n=parseFloat(t.getAttribute("width"))||1e3,r=parseFloat(t.getAttribute("height"))||1e3;return{minX:0,minY:0,width:n,height:r}}function h_(t){const e=t.getAttribute("style");if(e){const r=e.match(/fill:\s*([^;]+)/i);if(r)return Dy(r[1].trim())}const n=t.getAttribute("fill");return n?Dy(n):"#000000"}function Dy(t){if(!t)return null;if(t.startsWith("#"))return t.length===4?"#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]:t.toUpperCase();const e=t.match(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/i);if(e){const n=parseInt(e[1]).toString(16).padStart(2,"0"),r=parseInt(e[2]).toString(16).padStart(2,"0"),s=parseInt(e[3]).toString(16).padStart(2,"0");return`#${n}${r}${s}`.toUpperCase()}return t}function p_(t){if(!t)return null;const e=t.toUpperCase();if(ph[e])return ph[e];let n=null,r=1/0;const s=Ly(e);if(!s)return null;for(const[i,a]of Object.entries(ph)){const l=Ly(i);if(!l)continue;const c=Math.sqrt(Math.pow(s.r-l.r,2)+Math.pow(s.g-l.g,2)+Math.pow(s.b-l.b,2));c<r&&(r=c,n=a)}return r<=50?n:null}function Ly(t){if(!t||!t.startsWith("#"))return null;const e=t.match(/^#([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}function f_(t){switch(t.tagName.toLowerCase()){case"path":const n=t.getAttribute("d"),r=HP(n,2);return r.length>0?r[0]:[];case"rect":return GP(t.getAttribute("x"),t.getAttribute("y"),t.getAttribute("width"),t.getAttribute("height"),t.getAttribute("rx"),t.getAttribute("ry"));case"circle":return VP(t.getAttribute("cx"),t.getAttribute("cy"),t.getAttribute("r"),32);case"ellipse":return YP(t.getAttribute("cx"),t.getAttribute("cy"),t.getAttribute("rx"),t.getAttribute("ry"),32);case"polygon":return qP(t.getAttribute("points"));case"polyline":return XP(t.getAttribute("points"));case"line":return ZP(t.getAttribute("x1"),t.getAttribute("y1"),t.getAttribute("x2"),t.getAttribute("y2"));default:return[]}}function s3(t,e="design.dxf"){const n=new Blob([t],{type:"application/dxf"}),r=URL.createObjectURL(n),s=document.createElement("a");s.href=r,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)}function i3(t){const e=t.cloneNode(!0),n=[".court-canvas__selection-outline",".transform-handles",".track-resize-handles",'[class*="selection"]','[class*="handle"]',"[stroke-dasharray]"];for(const r of n)e.querySelectorAll(r).forEach(s=>s.remove());return e}async function o3(t){const e=Object.values(t||{});return e.length===0?[]:(await Promise.all(e.map(async r=>{try{const s=await Hl(r.sourceDesignId),i=(s==null?void 0:s.design)||s;if(!i)return console.warn(`[EXPORT] Could not fetch design for motif ${r.id}`),null;console.log("[EXPORT] Loaded design for motif:",i.name),console.log("[EXPORT] Design has solid_recipes:",!!i.solid_recipes),console.log("[EXPORT] Design has blend_recipes:",!!i.blend_recipes);const a=r.scale||1,l=r.originalWidth_mm*a/1e3,c=r.originalHeight_mm*a/1e3,d=l*c,u=r.viewMode||"solid",h=u==="blend"?i.blend_recipes:i.solid_recipes;return console.log(`[EXPORT] Using ${u} recipes:`,(h==null?void 0:h.length)||0,"recipes"),{id:r.id,name:r.customName||r.sourceDesignName||i.name||"Motif",areaM2:d,viewMode:u,widthM:l,heightM:c,recipes:h||[]}}catch(s){return console.error(`[EXPORT] Error processing motif ${r.id}:`,s),null}}))).filter(Boolean)}function Iy({svgRef:t}){const[e,n]=O.useState(!1),[r,s]=O.useState(null),i=O.useRef(null),a=at(b=>b.exportDesignData),l=at(b=>b.surface),c=at(b=>b.designName),d=at(b=>b.motifs),u=at(b=>b.shapes),h=at(b=>b.texts),p=at(b=>b.exclusionZones);O.useEffect(()=>{const b=k=>{i.current&&!i.current.contains(k.target)&&n(!1)};return e&&document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b)}},[e]);const f=()=>t!=null&&t.current?t.current:document.querySelector(".court-canvas__svg"),m=async()=>{s("svg");try{const b=f();if(!b)throw new Error("Canvas not found");const k=a(),_=nm(b,k),S=Ia(k.name,"svg");UT(_,S)}catch(b){console.error("SVG export failed:",b),alert("Failed to export SVG: "+b.message)}finally{s(null),n(!1)}},y=async()=>{s("png");try{const b=f();if(!b)throw new Error("Canvas not found");const k=a(),_=Ia(k.name,"png");await WT(b,k,_,2)}catch(b){console.error("PNG export failed:",b),alert("Failed to export PNG: "+b.message)}finally{s(null),n(!1)}},v=async()=>{s("pdf"),n(!1);try{const b=f();if(!b)throw new Error("Canvas not found");const k=await Kr.getSession();if(!(k!=null&&k.access_token))throw new Error("Authentication required for PDF export");const _=a(),S=_.name||"TPV Design",E=b.cloneNode(!0);E.querySelectorAll('[class*="selected"], .transform-handles, .track-resize-handles, .court-canvas__selection-outline, [class*="selection"], [class*="handle"]').forEach($=>$.remove()),E.setAttribute("xmlns","http://www.w3.org/2000/svg"),E.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),Ty(E);const T=new XMLSerializer().serializeToString(E);console.log("[EXPORT] Courts in state:",Object.keys(_.courts).length),console.log("[EXPORT] SVG contains court elements:",T.includes("court-canvas__court")),console.log("[EXPORT] Generating PDF report via API...");const R=await o3(d);console.log("[EXPORT] Motifs for PDF:",R.length);const W=await fetch("/api/export-sports-pdf",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k.access_token}`},body:JSON.stringify({svgString:T,designName:S,surface:_.surface,courts:_.courts,tracks:_.tracks,shapes:u,texts:h,motifs:R,exclusionZones:p,dimensions:{widthMM:_.surface.width_mm,lengthMM:_.surface.length_mm}})});if(!W.ok){const $=await W.json().catch(()=>({error:"Unknown error"}));throw new Error($.error||`Server error: ${W.status}`)}const P=await W.blob(),I=Ia(S,"pdf"),C=document.createElement("a");C.href=URL.createObjectURL(P),C.download=I,document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(C.href),console.log("[EXPORT] PDF downloaded:",I)}catch(b){console.error("PDF export failed:",b),alert("Failed to export PDF: "+b.message)}finally{s(null)}},x=async()=>{s("tiles"),n(!1);try{const b=f();if(!b)throw new Error("Canvas not found");const _=new XMLSerializer().serializeToString(b),S={width:l.width_mm,length:l.length_mm},E=c||"sports-surface",T=await a_(_,S,E),R=`${E.replace(/[^a-zA-Z0-9-_]/g,"-")}-tiles-1mx1m.zip`;c_(T,R),console.log("[EXPORT] Tiles ZIP downloaded:",R)}catch(b){console.error("Tiles export failed:",b),alert("Failed to export tiles: "+b.message)}finally{s(null)}},g=async()=>{s("dxf"),n(!1);try{const b=f();if(!b)throw new Error("Canvas not found");const k=a(),_=i3(b),S=e3(_,{widthMm:k.surface.width_mm,lengthMm:k.surface.length_mm,designName:k.name||"Sports Surface",seed:k.seed,motifs:d}),E=Ia(k.name,"dxf");if(s3(S.dxfContent,E),console.log("[EXPORT] DXF downloaded:",E),S.warnings&&S.warnings.length>0){const T=`DXF Export Notes:

`+S.warnings.join(`

`);alert(T)}}catch(b){console.error("DXF export failed:",b),alert("Failed to export DXF: "+b.message)}finally{s(null)}},w=async()=>{s("canvas-pdf"),n(!1);try{const b=f();if(!b)throw new Error("Canvas not found");const k=await Kr.getSession();if(!(k!=null&&k.access_token))throw new Error("Authentication required for PDF export");const _=a(),S=_.name||"TPV Design",E=b.cloneNode(!0);E.querySelectorAll('[class*="selected"], .transform-handles, .track-resize-handles, .court-canvas__selection-outline, [class*="selection"], [class*="handle"]').forEach(C=>C.remove()),E.setAttribute("xmlns","http://www.w3.org/2000/svg"),E.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),Ty(E);const T=new XMLSerializer().serializeToString(E),R=await fetch("/api/export-canvas-pdf",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k.access_token}`},body:JSON.stringify({svgString:T,designName:S,widthMm:_.surface.width_mm,lengthMm:_.surface.length_mm,designType:"sports"})});if(!R.ok){const C=await R.json().catch(()=>({error:"Unknown error"}));throw new Error(C.error||`Server error: ${R.status}`)}const W=await R.blob(),P=Ia(S,"pdf").replace(".pdf","-canvas.pdf"),I=document.createElement("a");I.href=URL.createObjectURL(W),I.download=P,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(I.href),console.log("[EXPORT] Canvas PDF downloaded:",P)}catch(b){console.error("Canvas PDF export failed:",b),alert("Failed to export Canvas PDF: "+b.message)}finally{s(null)}};return o.jsxs("div",{className:"export-menu",ref:i,children:[o.jsxs("button",{className:"sports-toolbar__btn-export",onClick:()=>n(!e),title:"Export Design",children:["Export",o.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:e?"M18 15l-6-6-6 6":"M6 9l6 6 6-6"})})]}),e&&o.jsxs("div",{className:"export-menu__dropdown",children:[o.jsxs("button",{className:"export-menu__item",onClick:m,disabled:r!==null,children:[o.jsx("span",{className:"export-menu__icon",children:""}),o.jsxs("div",{className:"export-menu__item-content",children:[o.jsx("span",{className:"export-menu__item-title",children:r==="svg"?"Exporting...":"Download SVG"}),o.jsx("span",{className:"export-menu__item-desc",children:"Vector format for CAD/printing"})]})]}),o.jsxs("button",{className:"export-menu__item",onClick:y,disabled:r!==null,children:[o.jsx("span",{className:"export-menu__icon",children:""}),o.jsxs("div",{className:"export-menu__item-content",children:[o.jsx("span",{className:"export-menu__item-title",children:r==="png"?"Exporting...":"Download PNG"}),o.jsx("span",{className:"export-menu__item-desc",children:"High-res image for presentations"})]})]}),o.jsxs("button",{className:"export-menu__item",onClick:x,disabled:r!==null,children:[o.jsx("span",{className:"export-menu__icon",children:""}),o.jsxs("div",{className:"export-menu__item-content",children:[o.jsx("span",{className:"export-menu__item-title",children:r==="tiles"?"Generating...":"Download Tiles ZIP"}),o.jsx("span",{className:"export-menu__item-desc",children:"1m1m SVG tiles for large-format printing"})]})]}),o.jsx("div",{className:"export-menu__divider"}),o.jsxs("button",{className:"export-menu__item",onClick:v,disabled:r!==null,children:[o.jsx("span",{className:"export-menu__icon",children:""}),o.jsxs("div",{className:"export-menu__item-content",children:[o.jsx("span",{className:"export-menu__item-title",children:r==="pdf"?"Generating...":"Materials Report (PDF)"}),o.jsx("span",{className:"export-menu__item-desc",children:"TPV quantities & specifications"})]})]}),o.jsxs("button",{className:"export-menu__item",onClick:w,disabled:r!==null,children:[o.jsx("span",{className:"export-menu__icon",children:""}),o.jsxs("div",{className:"export-menu__item-content",children:[o.jsx("span",{className:"export-menu__item-title",children:r==="canvas-pdf"?"Generating...":"Canvas PDF (1:100)"}),o.jsx("span",{className:"export-menu__item-desc",children:"Scaled design with dimensions"})]})]}),o.jsx("div",{className:"export-menu__divider"}),o.jsxs("button",{className:"export-menu__item",onClick:g,disabled:r!==null,children:[o.jsx("span",{className:"export-menu__icon",children:""}),o.jsxs("div",{className:"export-menu__item-content",children:[o.jsx("span",{className:"export-menu__item-title",children:r==="dxf"?"Exporting...":"Download DXF"}),o.jsx("span",{className:"export-menu__item-desc",children:"CAD format for AutoCAD/Rhino"})]})]})]})]})}function a3({isOpen:t,onClose:e}){if(!t)return null;const n=[{category:"Selection",items:[{keys:["Delete"],description:"Remove selected element"},{keys:["Escape"],description:"Deselect / exit group edit"}]},{category:"Edit",items:[{keys:["Ctrl","Z"],description:"Undo"},{keys:["Ctrl","Shift","Z"],description:"Redo"},{keys:["Ctrl","D"],description:"Duplicate selected"},{keys:["Ctrl","C"],description:"Copy selection"},{keys:["Ctrl","V"],description:"Paste"}]},{category:"Groups",items:[{keys:["Ctrl","G"],description:"Group selected elements"},{keys:["Ctrl","Shift","G"],description:"Ungroup selected group"}]},{category:"Move",items:[{keys:["Arrow Keys"],description:"Nudge element (10mm)"},{keys:["Shift","Arrow Keys"],description:"Large nudge (100mm)"}]},{category:"Layers",items:[{keys:["["],description:"Send backward"},{keys:["]"],description:"Bring forward"}]},{category:"View",items:[{keys:["G"],description:"Toggle snap to grid"},{keys:["?"],description:"Show this help"}]}],s=navigator.platform.toUpperCase().indexOf("MAC")>=0?"":"Ctrl";return o.jsx("div",{className:"keyboard-shortcuts-overlay",onClick:e,style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},children:o.jsxs("div",{className:"keyboard-shortcuts-modal",onClick:i=>i.stopPropagation(),style:{background:"#fff",borderRadius:"8px",padding:"24px",maxWidth:"480px",width:"90%",maxHeight:"80vh",overflow:"auto",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.2)"},children:[o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[o.jsx("h2",{style:{margin:0,fontSize:"1.25rem",fontWeight:600},children:"Keyboard Shortcuts"}),o.jsx("button",{onClick:e,style:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer",padding:"4px 8px",color:"#666"},"aria-label":"Close",children:""})]}),n.map(i=>o.jsxs("div",{style:{marginBottom:"20px"},children:[o.jsx("h3",{style:{fontSize:"0.75rem",fontWeight:600,textTransform:"uppercase",color:"#666",marginBottom:"8px",letterSpacing:"0.5px"},children:i.category}),o.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:i.items.map((a,l)=>o.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"4px 0"},children:[o.jsx("span",{style:{color:"#333",fontSize:"0.9rem"},children:a.description}),o.jsx("div",{style:{display:"flex",gap:"4px"},children:a.keys.map((c,d)=>o.jsx("kbd",{style:{display:"inline-block",padding:"4px 8px",fontSize:"0.75rem",fontFamily:"system-ui, -apple-system, sans-serif",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:"4px",boxShadow:"0 1px 2px rgba(0,0,0,0.1)",minWidth:"24px",textAlign:"center"},children:c==="Ctrl"?s:c},d))})]},l))})]},i.category)),o.jsxs("p",{style:{fontSize:"0.8rem",color:"#888",marginTop:"16px",paddingTop:"16px",borderTop:"1px solid #eee",marginBottom:0},children:["Press ",o.jsx("kbd",{style:{padding:"2px 6px",background:"#f5f5f5",border:"1px solid #ddd",borderRadius:"3px",fontSize:"0.75rem"},children:"?"})," at any time to show this help"]})]})})}class l3{async _getAuthHeaders(){const e=await Kr.getSession(),n={"Content-Type":"application/json"};return e!=null&&e.access_token&&(n.Authorization=`Bearer ${e.access_token}`),n}async generateRecraft(e){const n={prompt:e.prompt,width_mm:e.widthMM||5e3,length_mm:e.lengthMM||5e3,max_colours:e.maxColours||6,seed:e.seed||null},r=await this._getAuthHeaders(),s=await fetch("/api/recraft-generate",{method:"POST",headers:r,body:JSON.stringify(n)});if(!s.ok){const i=await s.json();throw new Error(i.error||"Recraft generation failed")}return s.json()}async vectorizeImage(e){const n={image_url:e.image_url,width_mm:e.width_mm||5e3,length_mm:e.length_mm||5e3,seed:e.seed||null},r=await this._getAuthHeaders(),s=await fetch("/api/recraft-vectorize",{method:"POST",headers:r,body:JSON.stringify(n)});if(!s.ok){const i=await s.json();throw new Error(i.error||"Vectorization failed")}return s.json()}async processUploadedSVG(e){const n={svg_url:e.svg_url,width_mm:e.width_mm||5e3,length_mm:e.length_mm||5e3},r=await this._getAuthHeaders(),s=await fetch("/api/process-uploaded-svg",{method:"POST",headers:r,body:JSON.stringify(n)});if(!s.ok){const i=await s.json();throw new Error(i.error||"SVG processing failed")}return s.json()}async getRecraftStatus(e){const n=await this._getAuthHeaders(),r=await fetch(`/api/studio-job-status?jobId=${e}`,{headers:n});if(!r.ok){const s=await r.json();throw new Error(s.error||"Status fetch failed")}return r.json()}async waitForRecraftCompletion(e,n=null,r=2e3,s=null){return new Promise((i,a)=>{let l=null;s&&s.addEventListener("abort",()=>{l&&clearTimeout(l),a(new DOMException("Polling aborted","AbortError"))});const c=async()=>{var d,u;if(s!=null&&s.aborted){a(new DOMException("Polling aborted","AbortError"));return}try{const h=await this.getRecraftStatus(e);n&&n(h),h.status==="completed"?((d=h.result)==null?void 0:d.svg_url)?i(h):a(new Error("Job completed but no output received")):h.status==="failed"?(u=h.result)!=null&&u.svg_url?i(h):a(new Error(h.error||"Job failed")):(h.status==="retrying"||h.status==="pending"||h.status==="queued"||h.status,l=setTimeout(c,r))}catch(h){a(h)}};c()})}async matchColor(e,n=2){const r=await fetch("/api/match-color",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hex:e,max_components:n})});if(!r.ok){const s=await r.json();throw new Error(s.error||"Color matching failed")}return r.json()}async generateDesignName(e){const n={prompt:e.prompt,colors:e.colors||[],dimensions:e.dimensions||{}},r=await this._getAuthHeaders(),s=await fetch("/api/generate-design-name",{method:"POST",headers:r,body:JSON.stringify(n)});if(!s.ok){const i=await s.json();throw new Error(i.error||"Name generation failed")}return s.json()}async inspireSimpleCreateJob(e){const n={prompt:e.prompt,surface:{width_mm:e.lengthMM||5e3,height_mm:e.widthMM||5e3},max_colours:e.maxColours||6,try_simpler:e.trySimpler||!1};e.seed&&(n.seed=e.seed);const r=await fetch("/api/studio-inspire-simple",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok){const s=await r.json();throw new Error(s.message||"Unable to start design generation. Please check your connection and try again.")}return r.json()}async inspireSimpleGetStatus(e){const n=await this._getAuthHeaders(),r=await fetch(`/api/studio-job-status?jobId=${e}`,{headers:n});if(!r.ok){const s=await r.json();throw new Error(s.message||"Unable to check generation status. Please try again.")}return r.json()}async inspireSimpleWaitForCompletion(e,n=null,r=2e3){return new Promise((s,i)=>{const a=async()=>{var l;try{const c=await this.inspireSimpleGetStatus(e);n&&n(c),c.status==="completed"?((l=c.result)==null?void 0:l.final_url)?(console.log("[API] Job complete with JPG output, resolving"),s(c)):(console.log("[API] Job completed but no output received"),i(new Error("Job completed but no output received"))):c.status==="failed"?i(new Error(c.error||"Job failed")):setTimeout(a,r)}catch(c){i(c)}};a()})}async draftify(e){const n=await fetch(Z0.DRAFTIFY,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok){const r=await n.json();throw new Error(r.message||"Unable to convert image to vector format. Please try a different image.")}return n.json()}async generateGeometric(e){const n={brief:e.prompt||e.brief,canvas:{width_mm:e.lengthMM||5e3,height_mm:e.widthMM||5e3},options:{mood:e.mood||"playful",composition:e.composition||"mixed",colorCount:e.maxColours||e.colorCount||5,seed:e.seed},validate:!0},r=await fetch(Z0.GEOMETRIC_GENERATE,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok){const s=await r.json();throw new Error(s.message||"Unable to generate design. Please try a different prompt or settings.")}return r.json()}}const ki=new l3;function c3({recipes:t,onClose:e}){if(!t||t.length===0)return o.jsxs("div",{className:"solid-summary-empty",children:[o.jsx("p",{children:"No colours in design."}),o.jsx("button",{onClick:e,className:"close-button",children:"Close"})]});const n=t.reduce((r,s)=>r+s.targetColor.areaPct,0);return o.jsxs("div",{className:"solid-color-summary",children:[o.jsxs("div",{className:"summary-header",children:[o.jsx("h3",{children:"TPV Colours Used"}),o.jsx("button",{onClick:e,className:"close-button-icon",children:""})]}),o.jsx("div",{className:"summary-info",children:o.jsxs("p",{className:"summary-description",children:["This design uses ",o.jsx("strong",{children:t.length})," pure TPV colour",t.length!==1?"s":""," (no blending required)"]})}),o.jsx("div",{className:"colors-list",children:t.map((r,s)=>{const i=r.chosenRecipe.components[0],a=r.targetColor.areaPct;return o.jsxs("div",{className:"color-item",children:[o.jsx("div",{className:"color-swatch",style:{backgroundColor:r.blendColor.hex},title:`${i.code} - ${i.name}`}),o.jsxs("div",{className:"color-details",children:[o.jsxs("div",{className:"color-primary",children:[o.jsx("span",{className:"color-code",children:i.code}),o.jsx("span",{className:"color-name",children:i.name})]}),o.jsxs("div",{className:"color-secondary",children:[o.jsx("span",{className:"hex-value",children:r.blendColor.hex}),o.jsxs("span",{className:"coverage-badge",children:[a.toFixed(1),"%"]})]})]})]},s)})}),o.jsxs("div",{className:"summary-footer",children:[o.jsxs("div",{className:"footer-stat",children:[o.jsx("span",{className:"stat-label",children:"Total Coverage:"}),o.jsxs("span",{className:"stat-value",children:[n.toFixed(1),"%"]})]}),o.jsxs("div",{className:"footer-stat",children:[o.jsx("span",{className:"stat-label",children:"TPV Colours:"}),o.jsx("span",{className:"stat-value",children:t.length})]})]}),o.jsx("style",{jsx:!0,children:`
        .solid-color-summary {
          background: #fff;
          border-radius: 8px;
          border: 1px solid #ddd;
          padding: 2rem;
          max-width: 800px;
          margin: 2rem auto;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .solid-summary-empty {
          background: #fff;
          border-radius: 8px;
          padding: 2rem;
          text-align: center;
        }

        .summary-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1.5rem;
          padding-bottom: 1rem;
          border-bottom: 2px solid #1a365d;
        }

        .summary-header h3 {
          margin: 0;
          color: #1a365d;
          font-size: 1.8rem;
        }

        .close-button-icon {
          background: none;
          border: none;
          font-size: 2rem;
          color: #666;
          cursor: pointer;
          padding: 0;
          width: 32px;
          height: 32px;
          line-height: 1;
          transition: color 0.2s;
        }

        .close-button-icon:hover {
          color: #333;
        }

        .summary-info {
          background: #f9f9f9;
          padding: 1rem;
          border-radius: 6px;
          margin-bottom: 1.5rem;
        }

        .summary-description {
          margin: 0;
          color: #333;
          font-size: 1rem;
          line-height: 1.5;
        }

        /* Colors List */
        .colors-list {
          display: flex;
          flex-direction: column;
          gap: 1rem;
          margin-bottom: 1.5rem;
        }

        .color-item {
          display: flex;
          align-items: center;
          gap: 1rem;
          padding: 1rem;
          background: #f9f9f9;
          border-radius: 6px;
          border: 1px solid #e0e0e0;
          transition: all 0.2s;
        }

        .color-item:hover {
          border-color: #ff6b35;
          box-shadow: 0 2px 8px rgba(255, 107, 53, 0.15);
        }

        .color-swatch {
          width: 60px;
          height: 60px;
          border-radius: 8px;
          border: 2px solid #ddd;
          flex-shrink: 0;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .color-details {
          flex: 1;
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .color-primary {
          display: flex;
          align-items: baseline;
          gap: 0.5rem;
        }

        .color-code {
          font-family: 'Courier New', monospace;
          font-weight: 700;
          font-size: 1.2rem;
          color: #1a365d;
        }

        .color-name {
          font-size: 1.1rem;
          color: #333;
          font-weight: 500;
        }

        .color-secondary {
          display: flex;
          align-items: center;
          gap: 1rem;
        }

        .hex-value {
          font-family: 'Courier New', monospace;
          font-size: 0.9rem;
          color: #666;
        }

        .coverage-badge {
          background: #ff6b35;
          color: white;
          padding: 0.25rem 0.75rem;
          border-radius: 12px;
          font-weight: 600;
          font-size: 0.9rem;
        }

        /* Summary Footer */
        .summary-footer {
          display: flex;
          justify-content: space-around;
          padding: 1.5rem;
          background: #f9f9f9;
          border-radius: 6px;
          border: 2px solid #ff6b35;
        }

        .footer-stat {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 0.5rem;
        }

        .stat-label {
          font-size: 0.9rem;
          color: #666;
          font-weight: 500;
        }

        .stat-value {
          font-size: 1.5rem;
          font-weight: 700;
          color: #1a365d;
        }

        .close-button {
          padding: 0.75rem 1.5rem;
          background: #ff6b35;
          color: white;
          border: none;
          border-radius: 4px;
          font-weight: 600;
          cursor: pointer;
          transition: background 0.2s;
        }

        .close-button:hover {
          background: #e55a25;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
          .solid-color-summary {
            padding: 1rem;
          }

          .summary-header h3 {
            font-size: 1.4rem;
          }

          .color-item {
            flex-direction: column;
            align-items: flex-start;
          }

          .color-swatch {
            width: 100%;
            height: 50px;
          }

          .summary-footer {
            flex-direction: column;
            gap: 1rem;
          }
        }
      `})]})}function sm({content:t,position:e="top"}){const[n,r]=O.useState(!1);return o.jsxs("div",{className:"help-icon-container",children:[o.jsx("button",{className:"help-icon",onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),onClick:s=>{s.preventDefault(),s.stopPropagation(),r(!n)},type:"button","aria-label":"Help",children:"?"}),n&&o.jsx("div",{className:`help-tooltip help-tooltip-${e}`,children:t}),o.jsx("style",{children:`
        .help-icon-container {
          position: relative;
          display: inline-block;
        }

        .help-icon {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          width: 18px;
          height: 18px;
          border-radius: 50%;
          background: #6b7280;
          color: white;
          border: none;
          font-size: 12px;
          font-weight: 600;
          cursor: help;
          transition: all 0.2s;
          padding: 0;
          line-height: 1;
        }

        .help-icon:hover {
          background: #374151;
          transform: scale(1.1);
        }

        .help-tooltip {
          position: absolute;
          z-index: 1000;
          background: #1f2937;
          color: white;
          padding: 0.75rem 1rem;
          border-radius: 6px;
          font-size: 0.875rem;
          line-height: 1.5;
          max-width: 300px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
          pointer-events: none;
          white-space: normal;
        }

        .help-tooltip-top {
          bottom: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
        }

        .help-tooltip-top::after {
          content: '';
          position: absolute;
          top: 100%;
          left: 50%;
          transform: translateX(-50%);
          border: 6px solid transparent;
          border-top-color: #1f2937;
        }

        .help-tooltip-bottom {
          top: calc(100% + 8px);
          left: 50%;
          transform: translateX(-50%);
        }

        .help-tooltip-bottom::after {
          content: '';
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          border: 6px solid transparent;
          border-bottom-color: #1f2937;
        }

        .help-tooltip-right {
          left: calc(100% + 8px);
          top: 50%;
          transform: translateY(-50%);
        }

        .help-tooltip-right::after {
          content: '';
          position: absolute;
          right: 100%;
          top: 50%;
          transform: translateY(-50%);
          border: 6px solid transparent;
          border-right-color: #1f2937;
        }

        .help-tooltip-left {
          right: calc(100% + 8px);
          top: 50%;
          transform: translateY(-50%);
        }

        .help-tooltip-left::after {
          content: '';
          position: absolute;
          left: 100%;
          top: 50%;
          transform: translateY(-50%);
          border: 6px solid transparent;
          border-left-color: #1f2937;
        }

        @media (max-width: 768px) {
          .help-tooltip {
            max-width: 250px;
            font-size: 0.8125rem;
            padding: 0.625rem 0.875rem;
          }
        }
      `})]})}function d3({recipes:t,mode:e="blend",onColorClick:n,selectedColor:r,editedColors:s,onResetAll:i}){if(!t||t.length===0)return null;const a=p=>!s||s.size===0?!1:s.has(p.originalColor.hex.toLowerCase()),l=p=>{if(!s||s.size===0)return!1;const f=s.get(p.originalColor.hex.toLowerCase());return(f==null?void 0:f.newHex)==="transparent"||(f==null?void 0:f.newHex)==="none"},c=s&&s.size>0,d=p=>{const f=p.toLowerCase();return wn.find(m=>m.hex.toLowerCase()===f)},u=p=>{if(l(p))return"Transparent";if(e==="solid"){const f=d(p.blendColor.hex);if(f)return`${f.code} - ${f.name}`}return p.blendColor.hex},h=p=>{if(!r)return!1;const f=r.blendHex||r.hex;return p.blendColor.hex===f||p.targetColor.hex===f};return o.jsxs("div",{className:"color-legend",children:[o.jsxs("div",{className:"legend-header",children:[o.jsxs("div",{className:"legend-header-left",children:[o.jsx("span",{className:"legend-title",children:"Colours"}),o.jsx(sm,{content:"Click any colour to edit all instances of that colour across the design. Changes apply to every region using that colour.",position:"right"}),n&&o.jsx("span",{className:"edit-hint",children:"(click to edit)"})]}),c&&i&&o.jsx("button",{onClick:i,className:"reset-all-btn",title:"Reset all colours to original",children:"Reset All"})]}),o.jsx("div",{className:"legend-colors",children:t.map((p,f)=>o.jsxs("div",{className:`color-item ${n?"clickable":""} ${h(p)?"selected":""}`,onClick:()=>{n&&n({hex:p.targetColor.hex,originalHex:p.originalColor.hex,blendHex:p.blendColor.hex,areaPct:p.targetColor.areaPct,recipe:p.chosenRecipe,targetColor:p.targetColor,isAddedFromEdit:p.isAddedFromEdit||!1,chosenRecipe:p.chosenRecipe},"palette")},title:n?"Click to edit this colour":"",children:[o.jsxs("div",{className:"color-swatch-wrapper",children:[o.jsx("div",{className:`color-swatch ${l(p)?"transparent-swatch":""}`,style:l(p)?{}:{backgroundColor:p.blendColor.hex}}),l(p)&&o.jsx("span",{className:"transparent-indicator",title:"Made transparent",children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",width:"14",height:"14",children:[o.jsx("circle",{cx:"12",cy:"12",r:"10"}),o.jsx("line",{x1:"4",y1:"4",x2:"20",y2:"20"})]})}),a(p)&&!l(p)&&o.jsx("span",{className:"edit-indicator",title:"Colour has been modified",children:o.jsx("svg",{viewBox:"0 0 24 24",fill:"currentColor",width:"12",height:"12",children:o.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"})})})]}),o.jsxs("div",{className:"color-info",children:[o.jsx("span",{className:e==="solid"?"tpv-label":"hex-value",children:u(p)}),o.jsxs("span",{className:"coverage",children:[p.targetColor.areaPct.toFixed(1),"%"]})]})]},f))}),o.jsx("style",{jsx:!0,children:`
        .color-legend {
          background: rgba(255, 255, 255, 0.95);
          border: 1px solid #ddd;
          border-radius: 8px;
          padding: 1rem;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
          width: 100%;
        }

        .legend-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          gap: 0.5rem;
          margin-bottom: 0.75rem;
          padding-bottom: 0.5rem;
          border-bottom: 1px solid #e0e0e0;
        }

        .legend-header-left {
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .legend-title {
          font-weight: 600;
          color: #1a365d;
          font-size: 0.95rem;
        }

        .edit-hint {
          font-size: 0.75rem;
          color: #ff6b35;
          font-weight: normal;
        }

        .reset-all-btn {
          padding: 0.25rem 0.5rem;
          font-size: 0.7rem;
          font-weight: 600;
          color: #ff6b35;
          background: #fff5f0;
          border: 1px solid #ff6b35;
          border-radius: 4px;
          cursor: pointer;
          transition: all 0.2s;
        }

        .reset-all-btn:hover {
          background: #ff6b35;
          color: white;
        }

        .legend-colors {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
          gap: 0.75rem;
        }

        .color-item {
          display: flex;
          align-items: center;
          gap: 0.75rem;
          padding: 0.5rem;
          border-radius: 4px;
          background: white;
          border: 1px solid #e8e8e8;
          transition: all 0.2s;
        }

        .color-item.clickable {
          cursor: pointer;
        }

        .color-item.clickable:hover {
          border-color: #ff6b35;
          background: #fff9f7;
          box-shadow: 0 2px 4px rgba(255, 107, 53, 0.15);
          transform: translateY(-2px);
        }

        .color-item.selected {
          border-color: #ff6b35;
          border-width: 2px;
          background: #fff9f7;
          box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.2);
          transform: translateY(-2px);
        }

        .color-swatch-wrapper {
          position: relative;
          flex-shrink: 0;
        }

        .color-swatch {
          width: 40px;
          height: 40px;
          border-radius: 4px;
          border: 2px solid #ddd;
        }

        .color-swatch.transparent-swatch {
          background:
            linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%),
            linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%);
          background-size: 8px 8px;
          background-position: 0 0, 4px 4px;
          background-color: white;
          border-color: #999;
        }

        .transparent-indicator {
          position: absolute;
          top: -4px;
          right: -4px;
          width: 18px;
          height: 18px;
          background: #6b7280;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .transparent-indicator svg {
          width: 12px;
          height: 12px;
        }

        .edit-indicator {
          position: absolute;
          top: -4px;
          right: -4px;
          width: 16px;
          height: 16px;
          background: #ff6b35;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        .edit-indicator svg {
          width: 10px;
          height: 10px;
        }

        .color-info {
          display: flex;
          flex-direction: column;
          gap: 0.25rem;
          font-size: 0.85rem;
        }

        .hex-value {
          font-family: 'Courier New', monospace;
          font-weight: 600;
          color: #333;
        }

        .tpv-label {
          font-weight: 600;
          color: #1a365d;
          font-size: 0.9rem;
        }

        .coverage {
          color: #666;
          font-size: 0.8rem;
        }

        /* Mobile - compact horizontal grid of swatches */
        @media (max-width: 768px) {
          .color-legend {
            padding: 0.75rem;
          }

          .legend-header {
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
          }

          .legend-title {
            font-size: 0.85rem;
          }

          .edit-hint {
            font-size: 0.7rem;
          }

          .reset-all-btn {
            font-size: 0.65rem;
            padding: 0.2rem 0.4rem;
            min-height: 28px;
          }

          /* Horizontal scrolling grid of swatches */
          .legend-colors {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: flex-start;
          }

          .color-item {
            flex-direction: column;
            padding: 0.25rem;
            border-radius: 6px;
            width: auto;
            min-width: 44px;
          }

          /* Hide text info on mobile - just show swatches */
          .color-info {
            display: none;
          }

          .color-swatch {
            width: 44px;
            height: 44px;
            border-radius: 6px;
          }

          .color-item.selected {
            transform: none;
            box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.4);
          }

          .color-item.clickable:hover {
            transform: none;
          }

          .edit-indicator {
            top: -2px;
            right: -2px;
            width: 14px;
            height: 14px;
          }

          .edit-indicator svg {
            width: 8px;
            height: 8px;
          }
        }

        @media (max-width: 480px) {
          .color-legend {
            padding: 0.5rem;
          }

          .legend-colors {
            gap: 0.35rem;
          }

          .color-swatch {
            width: 40px;
            height: 40px;
          }

          .color-item {
            min-width: 40px;
          }
        }
      `})]})}const u3=[{code:"RH01",name:"Standard Red",hex:"#A5362F"},{code:"RH02",name:"Bright Red",hex:"#E21F2F"},{code:"RH10",name:"Standard Green",hex:"#609B63"},{code:"RH11",name:"Bright Green",hex:"#3BB44A"},{code:"RH12",name:"Dark Green",hex:"#006C55"},{code:"RH20",name:"Standard Blue",hex:"#0075BC"},{code:"RH21",name:"Purple",hex:"#493D8C"},{code:"RH22",name:"Light Blue",hex:"#47AFE3"},{code:"RH23",name:"Azure",hex:"#039DC4"},{code:"RH26",name:"Turquoise",hex:"#00A6A3"},{code:"RH30",name:"Standard Beige",hex:"#E4C4AA"},{code:"RH31",name:"Cream",hex:"#E8E3D8"},{code:"RH32",name:"Brown",hex:"#8B5F3C"},{code:"RH90",name:"Funky Pink",hex:"#E8457E"},{code:"RH40",name:"Mustard Yellow",hex:"#E5A144"},{code:"RH41",name:"Bright Yellow",hex:"#FFD833"},{code:"RH50",name:"Orange",hex:"#F15B32"},{code:"RH60",name:"Dark Grey",hex:"#59595B"},{code:"RH61",name:"Light Grey",hex:"#939598"},{code:"RH65",name:"Pale Grey",hex:"#D9D9D6"},{code:"RH70",name:"Black",hex:"#231F20"}];function h3({blendSvgUrl:t,recipes:e,mode:n="blend",onColorClick:r,onRegionClick:s,onEyedropperCancel:i,onMakeTransparent:a,onSelectTPVColor:l,selectedColor:c,editedColors:d,onResetAll:u,designName:h="",onNameChange:p,isNameLoading:f=!1,onInSituClick:m,eyedropperActive:y=!1,eyedropperRegion:v=null,onRegionUndo:x,onRegionRedo:g,canUndo:w=!1,canRedo:b=!1,regionOverridesCount:k=0}){const[_,S]=O.useState(null),[E,T]=O.useState(null),R=O.useRef(null),W=O.useRef(null);O.useRef(null);const[P,I]=O.useState(1),[C,$]=O.useState({x:0,y:0}),[fe,V]=O.useState(!1),[K,F]=O.useState({x:0,y:0}),Z=O.useRef(null),U=O.useRef(!1),[X,ge]=O.useState(()=>localStorage.getItem("tpv_color_editing_tip_dismissed")!=="true"),de=()=>{ge(!1),localStorage.setItem("tpv_color_editing_tip_dismissed","true")};O.useEffect(()=>{if(!t){T(null);return}(async()=>{try{const G=await(await fetch(t)).text();T(G);const ie=G.includes("data-region-id"),Y=(G.match(/data-region-id/g)||[]).length;console.log("[SVGPreview] Fetched inline SVG content - length:",G.length,"hasRegionTags:",ie,"regionCount:",Y)}catch(M){console.error("[SVGPreview] Failed to fetch SVG content:",M),T(null)}})()},[t]);const Q=O.useMemo(()=>{if(!E)return null;console.log("[SVGPreview] Sanitizing SVG content...");const A=Qf(E);return A?(console.log("[SVGPreview] SVG sanitization complete - length:",A.length),console.log("[SVGPreview] Sanitized content preview:",A.substring(0,200)),A.includes("<svg")?A.replace(/<svg([^>]*)>/i,(G,ie)=>(ie.includes("width=")||(ie+=' width="100%"'),ie.includes("height=")||(ie+=' height="100%"'),`<svg${ie}>`)):(console.error("[SVGPreview] Sanitized SVG does not contain <svg> tag!"),null)):(console.error("[SVGPreview] SVG sanitization failed - content rejected"),null)},[E]);O.useEffect(()=>{if(!c||!t){S(null);return}(async()=>{try{console.log("[SVGPreview] Creating highlight for color:",c);const M=new Image;M.crossOrigin="anonymous";const G=new Promise((Pe,te)=>{M.onload=()=>{console.log("[SVGPreview] Image loaded:",M.width,"x",M.height),Pe()},M.onerror=pe=>{console.error("[SVGPreview] Image load error:",pe),te(pe)}});M.src=t,await G;const ie=document.createElement("canvas");ie.width=M.naturalWidth||M.width||1e3,ie.height=M.naturalHeight||M.height||1e3;const Y=ie.getContext("2d");Y.drawImage(M,0,0);const we=Y.getImageData(0,0,ie.width,ie.height).data,ue=c.hex,q=ke(ue);console.log("[SVGPreview] Target color:",ue,q);const le=new Set;let be=0;for(let Pe=0;Pe<ie.height;Pe++)for(let te=0;te<ie.width;te++){const pe=(Pe*ie.width+te)*4,qe=we[pe],st=we[pe+1],rt=we[pe+2];we[pe+3]>0&&Oe(qe,st,rt,q)&&(le.add(`${te},${Pe}`),be++)}if(console.log("[SVGPreview] Matched pixels:",be),be===0){console.warn("[SVGPreview] No pixels matched the target color"),S(null);return}const Ne=Y.createImageData(ie.width,ie.height);for(let Pe=0;Pe<ie.height;Pe++)for(let te=0;te<ie.width;te++){const pe=(Pe*ie.width+te)*4;le.has(`${te},${Pe}`)&&(!le.has(`${te-1},${Pe}`)||!le.has(`${te+1},${Pe}`)||!le.has(`${te},${Pe-1}`)||!le.has(`${te},${Pe+1}`))&&(Ne.data[pe]=255,Ne.data[pe+1]=0,Ne.data[pe+2]=255,Ne.data[pe+3]=255)}Y.clearRect(0,0,ie.width,ie.height),Y.putImageData(Ne,0,0);const ze=ie.toDataURL();console.log("[SVGPreview] Highlight mask created"),S(ze)}catch(M){console.error("[SVGPreview] Failed to create highlight mask:",M),S(null)}})()},[c,t]);const ke=A=>{const M=A.replace("#","");return{r:parseInt(M.substring(0,2),16),g:parseInt(M.substring(2,4),16),b:parseInt(M.substring(4,6),16)}},Oe=(A,M,G,ie)=>Math.abs(A-ie.r)<=50&&Math.abs(M-ie.g)<=50&&Math.abs(G-ie.b)<=50,De=async(A,M)=>{try{if(!R.current||!t)return null;const G=new Image;G.crossOrigin="anonymous";const ie=new Promise((Pe,te)=>{G.onload=Pe,G.onerror=te});G.src=t,await ie;const Y=document.createElement("canvas");Y.width=G.naturalWidth||G.width||1e3,Y.height=G.naturalHeight||G.height||1e3;const se=Y.getContext("2d");se.drawImage(G,0,0);const we=R.current.getBoundingClientRect(),ue=Y.width/we.width,q=Y.height/we.height,le=Math.floor(A*ue),be=Math.floor(M*q),ze=se.getImageData(le,be,1,1).data;return{r:ze[0],g:ze[1],b:ze[2],a:ze[3]}}catch(G){return console.error("[SVGPreview] Failed to get color at position:",G),null}},Be=()=>{I(A=>Math.min(A*1.5,5))},Ge=()=>{I(A=>Math.max(A/1.5,.5))},He=()=>{I(1),$({x:0,y:0})},Xe=A=>{A.preventDefault();const M=A.deltaY*-.001;I(G=>Math.min(Math.max(G+M,.5),5))},nt=A=>{A.button===0&&(V(!0),F({x:A.clientX-C.x,y:A.clientY-C.y}),U.current=!1)},j=A=>{if(!fe)return;const M=Math.abs(A.clientX-(K.x+C.x)),G=Math.abs(A.clientY-(K.y+C.y));(M>5||G>5)&&(U.current=!0),$({x:A.clientX-K.x,y:A.clientY-K.y})},ne=()=>{V(!1)};O.useEffect(()=>{if(fe)return document.addEventListener("mousemove",j),document.addEventListener("mouseup",ne),()=>{document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",ne)}},[fe,K,C]);const oe=A=>{let M=A;for(;M&&M!==W.current;){if(M.hasAttribute&&M.hasAttribute("data-region-id"))return M;M=M.parentElement}return null},z=async A=>{var ue,q;if(U.current){console.log("[SVGPreview] Click ignored - was dragging");return}if(console.log("[SVGPreview] Click detected - onRegionClick:",!!s,"inlineSvgContent:",!!E,"target:",A.target.tagName),s&&E){console.log("[SVGPreview] Attempting region detection on target:",A.target);const le=oe(A.target);if(console.log("[SVGPreview] Found region element:",le),le){const be=le.getAttribute("data-region-id"),Ne=le.getAttribute("fill")||((q=(ue=le.getAttribute("style"))==null?void 0:ue.match(/fill:\s*([^;]+)/))==null?void 0:q[1]);console.log("[SVGPreview] Region clicked:",be,"fill:",Ne),s({regionId:be,sourceColor:Ne,element:le});return}else console.log("[SVGPreview] No region element found from target")}else console.log("[SVGPreview] Region detection skipped - onRegionClick:",!!s,"inlineSvgContent:",!!E);if(!r||!e||e.length===0)return;const M=A.currentTarget.getBoundingClientRect(),G=A.clientX-M.left,ie=A.clientY-M.top;console.log("[SVGPreview] Clicked at:",G,ie);const Y=await De(G,ie);if(!Y||Y.a===0){console.log("[SVGPreview] Clicked on transparent area");return}console.log("[SVGPreview] Clicked color:",Y);let se=null,we=1/0;for(const le of e){const be=le.targetColor.hex,Ne=ke(be);if(Oe(Y.r,Y.g,Y.b,Ne)){const ze=Math.sqrt(Math.pow(Y.r-Ne.r,2)+Math.pow(Y.g-Ne.g,2)+Math.pow(Y.b-Ne.b,2));ze<we&&(we=ze,se=le)}}se?(console.log("[SVGPreview] Matched recipe:",se.targetColor.hex),r({hex:se.targetColor.hex,originalHex:se.originalColor.hex,blendHex:se.blendColor.hex,areaPct:se.targetColor.areaPct,recipe:se.chosenRecipe,targetColor:se.targetColor,isAddedFromEdit:se.isAddedFromEdit||!1,chosenRecipe:se.chosenRecipe})):console.log("[SVGPreview] No matching recipe found for clicked color")};return t?o.jsxs("div",{className:"svg-preview",children:[o.jsxs("div",{className:"preview-header",children:[o.jsxs("div",{className:"design-name-container",children:[p?o.jsx("input",{type:"text",className:"design-name-input",value:h,onChange:A=>p(A.target.value),placeholder:f?"Generating name...":"Enter project name"}):o.jsx("h3",{children:h||"TPV Blend Design"}),f&&o.jsx("span",{className:"name-loading",children:"Generating..."})]}),c&&o.jsxs("span",{className:"editing-hint",children:["Editing: ",c.hex||c.blendHex]})]}),X&&r&&o.jsxs("div",{className:"color-editing-tip",children:[o.jsx("div",{className:"tip-icon",children:""}),o.jsxs("div",{className:"tip-content",children:[o.jsx("strong",{children:"Tip:"})," Click colours in the legend below to edit all instances, or click directly on the design to edit individual regions."]}),o.jsx("button",{onClick:de,className:"tip-close",title:"Dismiss tip",children:""})]}),o.jsxs("div",{className:"svg-display-container",children:[o.jsxs("div",{className:"svg-panel",children:[o.jsxs("div",{className:"zoom-controls",children:[o.jsx("button",{onClick:Be,className:"zoom-btn",title:"Zoom In",children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"11",cy:"11",r:"8"}),o.jsx("line",{x1:"11",y1:"8",x2:"11",y2:"14"}),o.jsx("line",{x1:"8",y1:"11",x2:"14",y2:"11"}),o.jsx("path",{d:"m21 21-4.35-4.35"})]})}),o.jsx("button",{onClick:Ge,className:"zoom-btn",title:"Zoom Out",children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"11",cy:"11",r:"8"}),o.jsx("line",{x1:"8",y1:"11",x2:"14",y2:"11"}),o.jsx("path",{d:"m21 21-4.35-4.35"})]})}),o.jsx("button",{onClick:He,className:"zoom-btn",title:"Reset View",children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M1 4v6h6"}),o.jsx("path",{d:"M23 20v-6h-6"}),o.jsx("path",{d:"M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"})]})}),o.jsxs("span",{className:"zoom-level",children:[Math.round(P*100),"%"]})]}),k>0&&o.jsxs("div",{className:"undo-redo-controls",children:[o.jsx("button",{onClick:x,className:"undo-redo-btn",title:"Undo (Ctrl+Z)",disabled:!w,children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M3 7v6h6"}),o.jsx("path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"})]})}),o.jsx("button",{onClick:g,className:"undo-redo-btn",title:"Redo (Ctrl+Y)",disabled:!b,children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M21 7v6h-6"}),o.jsx("path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7"})]})})]}),m&&o.jsxs("button",{onClick:m,className:"in-situ-btn",title:"Upload a photo of your installation site and see how this design will look in place with realistic perspective",children:[o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),o.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),o.jsx("path",{d:"m21 15-5-5L5 21"})]}),o.jsx("span",{children:"Preview In-Situ"})]}),o.jsx("div",{ref:Z,className:"svg-wrapper",onWheel:Xe,children:o.jsxs("div",{className:"svg-image-container",onClick:z,onMouseDown:nt,style:{transform:`translate(${C.x}px, ${C.y}px) scale(${P})`,cursor:fe?"grabbing":P>1?"grab":y?"crosshair":r?"pointer":"default"},children:[Q?o.jsx("div",{ref:W,className:"svg-inline-container",style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},dangerouslySetInnerHTML:{__html:Q}}):o.jsx("img",{ref:R,src:t,alt:"TPV blend design",className:"svg-image"}),_&&o.jsx("img",{src:_,alt:"Colour highlight",className:"svg-highlight-mask"})]})}),y&&v&&o.jsx("div",{className:"eyedropper-overlay",children:o.jsxs("div",{className:"eyedropper-content",children:[o.jsx("div",{className:"eyedropper-header",children:o.jsxs("div",{className:"eyedropper-color-indicator",children:[o.jsx("div",{className:"eyedropper-color-swatch",style:{backgroundColor:v.sourceColor}}),o.jsx("span",{children:"Click another area to copy its colour, or select a TPV colour:"})]})}),o.jsx("div",{className:"eyedropper-palette",children:o.jsx("div",{className:"palette-grid",children:u3.map(A=>o.jsx("button",{className:"palette-swatch",style:{backgroundColor:A.hex},onClick:M=>{M.stopPropagation(),l&&l({hex:A.hex,code:A.code,name:A.name})},title:`${A.name} (${A.code})`},A.code))})}),o.jsxs("div",{className:"eyedropper-actions",children:[o.jsxs("button",{className:"eyedropper-transparent",onClick:A=>{A.stopPropagation(),a&&a()},title:"Remove fill from this region",children:[o.jsx("span",{className:"transparent-icon",children:""}),"Make Transparent"]}),o.jsx("button",{className:"eyedropper-cancel",onClick:A=>{A.stopPropagation(),i&&i()},children:"Cancel (Esc)"})]})]})})]}),e&&e.length>0&&o.jsx("div",{className:"legend-sidebar",children:o.jsx(d3,{recipes:e,mode:n,onColorClick:r,selectedColor:c,editedColors:d,onResetAll:u})})]}),o.jsx("style",{jsx:!0,children:`
        .svg-preview {
          background: #fff;
          border-radius: 8px;
          border: 1px solid #ddd;
          padding: 1.5rem;
          margin-top: 1.5rem;
        }

        .preview-header {
          margin-bottom: 1.5rem;
          display: flex;
          align-items: center;
          justify-content: space-between;
          flex-wrap: wrap;
          gap: 0.5rem;
        }

        .design-name-container {
          display: flex;
          align-items: center;
          gap: 0.75rem;
          flex: 1;
        }

        .preview-header h3 {
          margin: 0;
          color: #1a365d;
          font-size: 1.5rem;
        }

        .design-name-input {
          font-family: var(--font-heading), 'Overpass', sans-serif;
          font-size: 1.5rem;
          font-weight: 600;
          color: #1a365d;
          border: none;
          border-bottom: 2px solid transparent;
          background: transparent;
          padding: 0.25rem 0;
          width: 100%;
          max-width: 400px;
          transition: border-color 0.2s;
        }

        .design-name-input:hover {
          border-bottom-color: #e5e7eb;
        }

        .design-name-input:focus {
          outline: none;
          border-bottom-color: #ff6b35;
        }

        .design-name-input::placeholder {
          color: #9ca3af;
          font-weight: normal;
        }

        .name-loading {
          font-size: 0.75rem;
          color: #9ca3af;
          font-style: italic;
        }

        /* Color Editing Tip Banner */
        .color-editing-tip {
          display: flex;
          align-items: center;
          gap: 0.75rem;
          padding: 0.875rem 1rem;
          background: linear-gradient(to right, #fff7ed, #fffbeb);
          border: 1px solid #fed7aa;
          border-radius: 6px;
          margin-bottom: 1rem;
          font-size: 0.875rem;
          line-height: 1.5;
        }

        .tip-icon {
          font-size: 1.25rem;
          flex-shrink: 0;
        }

        .tip-content {
          flex: 1;
          color: #78350f;
        }

        .tip-content strong {
          color: #92400e;
        }

        .tip-close {
          background: none;
          border: none;
          font-size: 1.5rem;
          color: #92400e;
          cursor: pointer;
          padding: 0;
          line-height: 1;
          opacity: 0.6;
          transition: opacity 0.2s;
          flex-shrink: 0;
        }

        .tip-close:hover {
          opacity: 1;
        }

        /* SVG Display */
        .svg-display-container {
          display: flex;
          flex-direction: column;
          gap: 1.5rem;
          align-items: stretch;
        }

        .svg-panel {
          position: relative;
          flex: 1;
          border: 1px solid #e0e0e0;
          border-radius: 6px;
          overflow: hidden;
          background: #fafafa;
        }

        /* Zoom Controls */
        .zoom-controls {
          position: absolute;
          top: 1rem;
          right: 1rem;
          display: flex;
          gap: 0.5rem;
          background: white;
          border-radius: 8px;
          padding: 0.5rem;
          box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
          z-index: 10;
          align-items: center;
        }

        .zoom-btn {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 36px;
          height: 36px;
          padding: 0;
          background: white;
          border: 1px solid #e0e0e0;
          border-radius: 6px;
          cursor: pointer;
          color: #1a365d;
          transition: all 0.2s ease;
        }

        .zoom-btn:hover {
          background: #f8fafc;
          border-color: #1e4a7a;
          transform: translateY(-1px);
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .zoom-btn:active {
          transform: translateY(0);
        }

        .zoom-btn svg {
          width: 20px;
          height: 20px;
        }

        .zoom-level {
          font-size: 0.875rem;
          font-weight: 600;
          color: #1a365d;
          min-width: 50px;
          text-align: center;
          padding: 0 0.5rem;
        }

        /* Undo/Redo Controls */
        .undo-redo-controls {
          position: absolute;
          top: 5rem;
          right: 1rem;
          display: flex;
          gap: 0.5rem;
          background: white;
          border-radius: 8px;
          padding: 0.5rem;
          box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
          z-index: 10;
        }

        .undo-redo-btn {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 36px;
          height: 36px;
          padding: 0;
          background: white;
          border: 1px solid #e0e0e0;
          border-radius: 6px;
          cursor: pointer;
          color: #1a365d;
          transition: all 0.2s ease;
        }

        .undo-redo-btn:hover:not(:disabled) {
          background: #f8fafc;
          border-color: #1e4a7a;
          transform: translateY(-1px);
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .undo-redo-btn:active:not(:disabled) {
          transform: translateY(0);
        }

        .undo-redo-btn:disabled {
          opacity: 0.4;
          cursor: not-allowed;
        }

        .undo-redo-btn svg {
          width: 20px;
          height: 20px;
        }

        .in-situ-btn {
          position: absolute;
          top: 1rem;
          left: 1rem;
          display: flex;
          align-items: center;
          gap: 0.5rem;
          padding: 0.5rem 1rem;
          background: #ff6b35;
          color: white;
          border: none;
          border-radius: 6px;
          font-size: 0.875rem;
          font-weight: 500;
          cursor: pointer;
          box-shadow: 0 2px 12px rgba(255, 107, 53, 0.3);
          z-index: 10;
          transition: all 0.2s ease;
        }

        .in-situ-btn:hover {
          background: #e55a2b;
          transform: translateY(-1px);
          box-shadow: 0 4px 16px rgba(255, 107, 53, 0.4);
        }

        .in-situ-btn:active {
          transform: translateY(0);
        }

        .in-situ-btn svg {
          width: 18px;
          height: 18px;
        }

        .svg-wrapper {
          padding: 2rem;
          background: white;
          min-height: 400px;
          display: flex;
          align-items: center;
          justify-content: center;
          overflow: hidden;
          position: relative;
        }

        .svg-image-container {
          position: relative;
          display: inline-block;
          user-select: none;
          transition: transform 0.1s ease-out;
          transform-origin: center center;
        }

        .svg-image {
          max-width: 100%;
          height: auto;
          display: block;
          border-radius: 4px;
          pointer-events: ${r?"auto":"none"};
        }

        .svg-inline-container {
          max-width: 100%;
          display: block;
          border-radius: 4px;
        }

        .svg-inline-container svg {
          max-width: 100%;
          height: auto;
          display: block;
        }

        .svg-highlight-mask {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          pointer-events: none;
          border-radius: 4px;
          filter: drop-shadow(0 0 3px rgba(255, 0, 255, 0.8)) drop-shadow(0 0 1px rgba(0, 0, 0, 0.6));
          animation: pulse 2s ease-in-out infinite;
        }

        .eyedropper-overlay {
          position: absolute;
          top: 20px;
          left: 50%;
          transform: translateX(-50%);
          z-index: 100;
        }

        .eyedropper-content {
          background: white;
          border-radius: 12px;
          padding: 16px 20px;
          box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
          display: flex;
          flex-direction: column;
          gap: 12px;
          border: 2px solid #3b82f6;
          max-width: 320px;
        }

        .eyedropper-header {
          display: flex;
          align-items: center;
          gap: 12px;
        }

        .eyedropper-color-indicator {
          display: flex;
          align-items: center;
          gap: 12px;
          font-size: 0.9rem;
          font-weight: 500;
          color: #111827;
        }

        .eyedropper-color-swatch {
          width: 28px;
          height: 28px;
          border-radius: 6px;
          border: 2px solid #d1d5db;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
          flex-shrink: 0;
        }

        .eyedropper-palette {
          padding: 10px;
          background: #f9fafb;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
        }

        .palette-grid {
          display: grid;
          grid-template-columns: repeat(7, 1fr);
          gap: 4px;
        }

        .palette-swatch {
          width: 32px;
          height: 32px;
          border: 2px solid rgba(0, 0, 0, 0.15);
          border-radius: 4px;
          cursor: pointer;
          padding: 0;
          transition: all 0.15s ease;
        }

        .palette-swatch:hover {
          transform: scale(1.15);
          z-index: 1;
          box-shadow: 0 3px 8px rgba(0, 0, 0, 0.25);
          border-color: #3b82f6;
        }

        .eyedropper-cancel {
          padding: 8px 16px;
          background: #ef4444;
          color: white;
          border: none;
          border-radius: 6px;
          font-size: 0.9rem;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.2s;
          white-space: nowrap;
        }

        .eyedropper-cancel:hover {
          background: #dc2626;
          box-shadow: 0 2px 6px rgba(239, 68, 68, 0.3);
        }

        .eyedropper-actions {
          display: flex;
          gap: 8px;
          align-items: center;
          justify-content: center;
        }

        .eyedropper-transparent {
          display: flex;
          align-items: center;
          gap: 6px;
          padding: 8px 14px;
          background: linear-gradient(135deg, #f3f4f6 25%, #d1d5db 25%, #d1d5db 50%, #f3f4f6 50%, #f3f4f6 75%, #d1d5db 75%);
          background-size: 8px 8px;
          color: #374151;
          border: 2px solid #6b7280;
          border-radius: 6px;
          font-size: 0.9rem;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.2s;
          white-space: nowrap;
        }

        .eyedropper-transparent:hover {
          border-color: #374151;
          box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
          transform: translateY(-1px);
        }

        .transparent-icon {
          width: 16px;
          height: 16px;
          background: linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%),
                      linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%);
          background-size: 8px 8px;
          background-position: 0 0, 4px 4px;
          background-color: white;
          border: 1px solid #999;
          border-radius: 2px;
          display: inline-block;
          font-size: 0;
        }

        @keyframes pulse {
          0%, 100% {
            opacity: 0.8;
          }
          50% {
            opacity: 1;
          }
        }

        .editing-hint {
          font-size: 0.9rem;
          color: #ff6b35;
          font-weight: 500;
          margin-left: 1rem;
        }

        .legend-sidebar {
          width: 100%;
        }

        @media (max-width: 768px) {
          .svg-preview {
            padding: 0.5rem;
            margin-top: 0.75rem;
            border-radius: 6px;
          }

          .preview-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.25rem;
            margin-bottom: 0.5rem;
          }

          .preview-header h3 {
            font-size: 1.1rem;
          }

          .design-name-input {
            font-size: 1.1rem;
            max-width: 100%;
          }

          .editing-hint {
            margin-left: 0;
            font-size: 0.75rem;
          }

          .svg-panel {
            border: none;
            border-radius: 0;
          }

          .svg-wrapper {
            padding: 0;
            min-height: auto;
          }

          /* Position zoom controls at bottom-right on mobile */
          .zoom-controls {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            top: auto;
            flex-direction: column;
            gap: 0.25rem;
            padding: 0.25rem;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            z-index: 50;
          }

          /* Position undo/redo controls above zoom on mobile */
          .undo-redo-controls {
            position: fixed;
            bottom: 12rem;
            right: 1rem;
            top: auto;
            gap: 0.25rem;
            padding: 0.25rem;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            z-index: 50;
          }

          /* Make buttons circular and compact on mobile */
          .zoom-btn,
          .undo-redo-btn {
            width: 44px;
            height: 44px;
            padding: 0;
            border-radius: 50%;
            min-width: unset;
            font-size: 1.1rem;
          }

          /* Hide text labels on mobile */
          .zoom-btn span {
            display: none;
          }

          /* In-situ button - compact on mobile */
          .in-situ-btn {
            padding: 0.4rem;
            font-size: 0;
            top: 0.5rem;
            left: 0.5rem;
            border-radius: 50%;
            width: 36px;
            height: 36px;
          }

          .in-situ-btn span {
            display: none;
          }

          .in-situ-btn svg {
            width: 18px;
            height: 18px;
          }

          .svg-image-container {
            /* Allow zoom on mobile via buttons */
            cursor: default !important;
          }
        }

        /* Extra small screens */
        @media (max-width: 480px) {
          .svg-preview {
            padding: 0.25rem;
            margin-top: 0.5rem;
          }

          .preview-header {
            padding: 0 0.25rem;
          }

          .preview-header h3 {
            font-size: 1rem;
          }

          .design-name-input {
            font-size: 1rem;
          }
        }
      `})]}):null}var Nr={},Ul={},p3=typeof Qs=="object"&&Qs&&Qs.Object===Object&&Qs,m_=p3,f3=m_,m3=typeof self=="object"&&self&&self.Object===Object&&self,g3=f3||m3||Function("return this")(),xs=g3,y3=xs,x3=y3.Symbol,Wl=x3,zy=Wl,g_=Object.prototype,v3=g_.hasOwnProperty,b3=g_.toString,za=zy?zy.toStringTag:void 0;function w3(t){var e=v3.call(t,za),n=t[za];try{t[za]=void 0;var r=!0}catch{}var s=b3.call(t);return r&&(e?t[za]=n:delete t[za]),s}var _3=w3,k3=Object.prototype,S3=k3.toString;function j3(t){return S3.call(t)}var C3=j3,Fy=Wl,E3=_3,T3=C3,N3="[object Null]",P3="[object Undefined]",By=Fy?Fy.toStringTag:void 0;function R3(t){return t==null?t===void 0?P3:N3:By&&By in Object(t)?E3(t):T3(t)}var qi=R3,O3=Array.isArray,ns=O3;function A3(t){return t!=null&&typeof t=="object"}var zs=A3,M3=qi,$3=ns,D3=zs,L3="[object String]";function I3(t){return typeof t=="string"||!$3(t)&&D3(t)&&M3(t)==L3}var z3=I3;function F3(t){return function(e,n,r){for(var s=-1,i=Object(e),a=r(e),l=a.length;l--;){var c=a[t?l:++s];if(n(i[c],c,i)===!1)break}return e}}var B3=F3,H3=B3,U3=H3(),W3=U3;function G3(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var V3=G3,Y3=qi,q3=zs,X3="[object Arguments]";function Z3(t){return q3(t)&&Y3(t)==X3}var K3=Z3,Hy=K3,J3=zs,y_=Object.prototype,Q3=y_.hasOwnProperty,eR=y_.propertyIsEnumerable,tR=Hy(function(){return arguments}())?Hy:function(t){return J3(t)&&Q3.call(t,"callee")&&!eR.call(t,"callee")},x_=tR,Md={exports:{}};function nR(){return!1}var rR=nR;Md.exports;(function(t,e){var n=xs,r=rR,s=e&&!e.nodeType&&e,i=s&&!0&&t&&!t.nodeType&&t,a=i&&i.exports===s,l=a?n.Buffer:void 0,c=l?l.isBuffer:void 0,d=c||r;t.exports=d})(Md,Md.exports);var im=Md.exports,sR=9007199254740991,iR=/^(?:0|[1-9]\d*)$/;function oR(t,e){var n=typeof t;return e=e??sR,!!e&&(n=="number"||n!="symbol"&&iR.test(t))&&t>-1&&t%1==0&&t<e}var v_=oR,aR=9007199254740991;function lR(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=aR}var om=lR,cR=qi,dR=om,uR=zs,hR="[object Arguments]",pR="[object Array]",fR="[object Boolean]",mR="[object Date]",gR="[object Error]",yR="[object Function]",xR="[object Map]",vR="[object Number]",bR="[object Object]",wR="[object RegExp]",_R="[object Set]",kR="[object String]",SR="[object WeakMap]",jR="[object ArrayBuffer]",CR="[object DataView]",ER="[object Float32Array]",TR="[object Float64Array]",NR="[object Int8Array]",PR="[object Int16Array]",RR="[object Int32Array]",OR="[object Uint8Array]",AR="[object Uint8ClampedArray]",MR="[object Uint16Array]",$R="[object Uint32Array]",Gt={};Gt[ER]=Gt[TR]=Gt[NR]=Gt[PR]=Gt[RR]=Gt[OR]=Gt[AR]=Gt[MR]=Gt[$R]=!0;Gt[hR]=Gt[pR]=Gt[jR]=Gt[fR]=Gt[CR]=Gt[mR]=Gt[gR]=Gt[yR]=Gt[xR]=Gt[vR]=Gt[bR]=Gt[wR]=Gt[_R]=Gt[kR]=Gt[SR]=!1;function DR(t){return uR(t)&&dR(t.length)&&!!Gt[cR(t)]}var LR=DR;function IR(t){return function(e){return t(e)}}var am=IR,$d={exports:{}};$d.exports;(function(t,e){var n=m_,r=e&&!e.nodeType&&e,s=r&&!0&&t&&!t.nodeType&&t,i=s&&s.exports===r,a=i&&n.process,l=function(){try{var c=s&&s.require&&s.require("util").types;return c||a&&a.binding&&a.binding("util")}catch{}}();t.exports=l})($d,$d.exports);var lm=$d.exports,zR=LR,FR=am,Uy=lm,Wy=Uy&&Uy.isTypedArray,BR=Wy?FR(Wy):zR,b_=BR,HR=V3,UR=x_,WR=ns,GR=im,VR=v_,YR=b_,qR=Object.prototype,XR=qR.hasOwnProperty;function ZR(t,e){var n=WR(t),r=!n&&UR(t),s=!n&&!r&&GR(t),i=!n&&!r&&!s&&YR(t),a=n||r||s||i,l=a?HR(t.length,String):[],c=l.length;for(var d in t)(e||XR.call(t,d))&&!(a&&(d=="length"||s&&(d=="offset"||d=="parent")||i&&(d=="buffer"||d=="byteLength"||d=="byteOffset")||VR(d,c)))&&l.push(d);return l}var w_=ZR,KR=Object.prototype;function JR(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||KR;return t===n}var cm=JR;function QR(t,e){return function(n){return t(e(n))}}var __=QR,eO=__,tO=eO(Object.keys,Object),nO=tO,rO=cm,sO=nO,iO=Object.prototype,oO=iO.hasOwnProperty;function aO(t){if(!rO(t))return sO(t);var e=[];for(var n in Object(t))oO.call(t,n)&&n!="constructor"&&e.push(n);return e}var lO=aO;function cO(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var ya=cO,dO=qi,uO=ya,hO="[object AsyncFunction]",pO="[object Function]",fO="[object GeneratorFunction]",mO="[object Proxy]";function gO(t){if(!uO(t))return!1;var e=dO(t);return e==pO||e==fO||e==hO||e==mO}var k_=gO,yO=k_,xO=om;function vO(t){return t!=null&&xO(t.length)&&!yO(t)}var cu=vO,bO=w_,wO=lO,_O=cu;function kO(t){return _O(t)?bO(t):wO(t)}var Gl=kO,SO=W3,jO=Gl;function CO(t,e){return t&&SO(t,e,jO)}var S_=CO;function EO(t){return t}var j_=EO,TO=j_;function NO(t){return typeof t=="function"?t:TO}var PO=NO,RO=S_,OO=PO;function AO(t,e){return t&&RO(t,OO(e))}var dm=AO,MO=__,$O=MO(Object.getPrototypeOf,Object),um=$O,DO=qi,LO=um,IO=zs,zO="[object Object]",FO=Function.prototype,BO=Object.prototype,C_=FO.toString,HO=BO.hasOwnProperty,UO=C_.call(Object);function WO(t){if(!IO(t)||DO(t)!=zO)return!1;var e=LO(t);if(e===null)return!0;var n=HO.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&C_.call(n)==UO}var GO=WO;function VO(t,e){for(var n=-1,r=t==null?0:t.length,s=Array(r);++n<r;)s[n]=e(t[n],n,t);return s}var E_=VO;function YO(){this.__data__=[],this.size=0}var qO=YO;function XO(t,e){return t===e||t!==t&&e!==e}var hm=XO,ZO=hm;function KO(t,e){for(var n=t.length;n--;)if(ZO(t[n][0],e))return n;return-1}var du=KO,JO=du,QO=Array.prototype,eA=QO.splice;function tA(t){var e=this.__data__,n=JO(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():eA.call(e,n,1),--this.size,!0}var nA=tA,rA=du;function sA(t){var e=this.__data__,n=rA(e,t);return n<0?void 0:e[n][1]}var iA=sA,oA=du;function aA(t){return oA(this.__data__,t)>-1}var lA=aA,cA=du;function dA(t,e){var n=this.__data__,r=cA(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}var uA=dA,hA=qO,pA=nA,fA=iA,mA=lA,gA=uA;function xa(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}xa.prototype.clear=hA;xa.prototype.delete=pA;xa.prototype.get=fA;xa.prototype.has=mA;xa.prototype.set=gA;var uu=xa,yA=uu;function xA(){this.__data__=new yA,this.size=0}var vA=xA;function bA(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}var wA=bA;function _A(t){return this.__data__.get(t)}var kA=_A;function SA(t){return this.__data__.has(t)}var jA=SA,CA=xs,EA=CA["__core-js_shared__"],TA=EA,mh=TA,Gy=function(){var t=/[^.]+$/.exec(mh&&mh.keys&&mh.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function NA(t){return!!Gy&&Gy in t}var PA=NA,RA=Function.prototype,OA=RA.toString;function AA(t){if(t!=null){try{return OA.call(t)}catch{}try{return t+""}catch{}}return""}var T_=AA,MA=k_,$A=PA,DA=ya,LA=T_,IA=/[\\^$.*+?()[\]{}|]/g,zA=/^\[object .+?Constructor\]$/,FA=Function.prototype,BA=Object.prototype,HA=FA.toString,UA=BA.hasOwnProperty,WA=RegExp("^"+HA.call(UA).replace(IA,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function GA(t){if(!DA(t)||$A(t))return!1;var e=MA(t)?WA:zA;return e.test(LA(t))}var VA=GA;function YA(t,e){return t==null?void 0:t[e]}var qA=YA,XA=VA,ZA=qA;function KA(t,e){var n=ZA(t,e);return XA(n)?n:void 0}var Xi=KA,JA=Xi,QA=xs,eM=JA(QA,"Map"),pm=eM,tM=Xi,nM=tM(Object,"create"),hu=nM,Vy=hu;function rM(){this.__data__=Vy?Vy(null):{},this.size=0}var sM=rM;function iM(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var oM=iM,aM=hu,lM="__lodash_hash_undefined__",cM=Object.prototype,dM=cM.hasOwnProperty;function uM(t){var e=this.__data__;if(aM){var n=e[t];return n===lM?void 0:n}return dM.call(e,t)?e[t]:void 0}var hM=uM,pM=hu,fM=Object.prototype,mM=fM.hasOwnProperty;function gM(t){var e=this.__data__;return pM?e[t]!==void 0:mM.call(e,t)}var yM=gM,xM=hu,vM="__lodash_hash_undefined__";function bM(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=xM&&e===void 0?vM:e,this}var wM=bM,_M=sM,kM=oM,SM=hM,jM=yM,CM=wM;function va(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}va.prototype.clear=_M;va.prototype.delete=kM;va.prototype.get=SM;va.prototype.has=jM;va.prototype.set=CM;var EM=va,Yy=EM,TM=uu,NM=pm;function PM(){this.size=0,this.__data__={hash:new Yy,map:new(NM||TM),string:new Yy}}var RM=PM;function OM(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var AM=OM,MM=AM;function $M(t,e){var n=t.__data__;return MM(e)?n[typeof e=="string"?"string":"hash"]:n.map}var pu=$M,DM=pu;function LM(t){var e=DM(this,t).delete(t);return this.size-=e?1:0,e}var IM=LM,zM=pu;function FM(t){return zM(this,t).get(t)}var BM=FM,HM=pu;function UM(t){return HM(this,t).has(t)}var WM=UM,GM=pu;function VM(t,e){var n=GM(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}var YM=VM,qM=RM,XM=IM,ZM=BM,KM=WM,JM=YM;function ba(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}ba.prototype.clear=qM;ba.prototype.delete=XM;ba.prototype.get=ZM;ba.prototype.has=KM;ba.prototype.set=JM;var fm=ba,QM=uu,e4=pm,t4=fm,n4=200;function r4(t,e){var n=this.__data__;if(n instanceof QM){var r=n.__data__;if(!e4||r.length<n4-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new t4(r)}return n.set(t,e),this.size=n.size,this}var s4=r4,i4=uu,o4=vA,a4=wA,l4=kA,c4=jA,d4=s4;function wa(t){var e=this.__data__=new i4(t);this.size=e.size}wa.prototype.clear=o4;wa.prototype.delete=a4;wa.prototype.get=l4;wa.prototype.has=c4;wa.prototype.set=d4;var mm=wa,u4="__lodash_hash_undefined__";function h4(t){return this.__data__.set(t,u4),this}var p4=h4;function f4(t){return this.__data__.has(t)}var m4=f4,g4=fm,y4=p4,x4=m4;function Dd(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new g4;++e<n;)this.add(t[e])}Dd.prototype.add=Dd.prototype.push=y4;Dd.prototype.has=x4;var v4=Dd;function b4(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}var w4=b4;function _4(t,e){return t.has(e)}var k4=_4,S4=v4,j4=w4,C4=k4,E4=1,T4=2;function N4(t,e,n,r,s,i){var a=n&E4,l=t.length,c=e.length;if(l!=c&&!(a&&c>l))return!1;var d=i.get(t),u=i.get(e);if(d&&u)return d==e&&u==t;var h=-1,p=!0,f=n&T4?new S4:void 0;for(i.set(t,e),i.set(e,t);++h<l;){var m=t[h],y=e[h];if(r)var v=a?r(y,m,h,e,t,i):r(m,y,h,t,e,i);if(v!==void 0){if(v)continue;p=!1;break}if(f){if(!j4(e,function(x,g){if(!C4(f,g)&&(m===x||s(m,x,n,r,i)))return f.push(g)})){p=!1;break}}else if(!(m===y||s(m,y,n,r,i))){p=!1;break}}return i.delete(t),i.delete(e),p}var N_=N4,P4=xs,R4=P4.Uint8Array,P_=R4;function O4(t){var e=-1,n=Array(t.size);return t.forEach(function(r,s){n[++e]=[s,r]}),n}var A4=O4;function M4(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var $4=M4,qy=Wl,Xy=P_,D4=hm,L4=N_,I4=A4,z4=$4,F4=1,B4=2,H4="[object Boolean]",U4="[object Date]",W4="[object Error]",G4="[object Map]",V4="[object Number]",Y4="[object RegExp]",q4="[object Set]",X4="[object String]",Z4="[object Symbol]",K4="[object ArrayBuffer]",J4="[object DataView]",Zy=qy?qy.prototype:void 0,gh=Zy?Zy.valueOf:void 0;function Q4(t,e,n,r,s,i,a){switch(n){case J4:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case K4:return!(t.byteLength!=e.byteLength||!i(new Xy(t),new Xy(e)));case H4:case U4:case V4:return D4(+t,+e);case W4:return t.name==e.name&&t.message==e.message;case Y4:case X4:return t==e+"";case G4:var l=I4;case q4:var c=r&F4;if(l||(l=z4),t.size!=e.size&&!c)return!1;var d=a.get(t);if(d)return d==e;r|=B4,a.set(t,e);var u=L4(l(t),l(e),r,s,i,a);return a.delete(t),u;case Z4:if(gh)return gh.call(t)==gh.call(e)}return!1}var e6=Q4;function t6(t,e){for(var n=-1,r=e.length,s=t.length;++n<r;)t[s+n]=e[n];return t}var R_=t6,n6=R_,r6=ns;function s6(t,e,n){var r=e(t);return r6(t)?r:n6(r,n(t))}var O_=s6;function i6(t,e){for(var n=-1,r=t==null?0:t.length,s=0,i=[];++n<r;){var a=t[n];e(a,n,t)&&(i[s++]=a)}return i}var o6=i6;function a6(){return[]}var A_=a6,l6=o6,c6=A_,d6=Object.prototype,u6=d6.propertyIsEnumerable,Ky=Object.getOwnPropertySymbols,h6=Ky?function(t){return t==null?[]:(t=Object(t),l6(Ky(t),function(e){return u6.call(t,e)}))}:c6,gm=h6,p6=O_,f6=gm,m6=Gl;function g6(t){return p6(t,m6,f6)}var M_=g6,Jy=M_,y6=1,x6=Object.prototype,v6=x6.hasOwnProperty;function b6(t,e,n,r,s,i){var a=n&y6,l=Jy(t),c=l.length,d=Jy(e),u=d.length;if(c!=u&&!a)return!1;for(var h=c;h--;){var p=l[h];if(!(a?p in e:v6.call(e,p)))return!1}var f=i.get(t),m=i.get(e);if(f&&m)return f==e&&m==t;var y=!0;i.set(t,e),i.set(e,t);for(var v=a;++h<c;){p=l[h];var x=t[p],g=e[p];if(r)var w=a?r(g,x,p,e,t,i):r(x,g,p,t,e,i);if(!(w===void 0?x===g||s(x,g,n,r,i):w)){y=!1;break}v||(v=p=="constructor")}if(y&&!v){var b=t.constructor,k=e.constructor;b!=k&&"constructor"in t&&"constructor"in e&&!(typeof b=="function"&&b instanceof b&&typeof k=="function"&&k instanceof k)&&(y=!1)}return i.delete(t),i.delete(e),y}var w6=b6,_6=Xi,k6=xs,S6=_6(k6,"DataView"),j6=S6,C6=Xi,E6=xs,T6=C6(E6,"Promise"),N6=T6,P6=Xi,R6=xs,O6=P6(R6,"Set"),A6=O6,M6=Xi,$6=xs,D6=M6($6,"WeakMap"),L6=D6,$p=j6,Dp=pm,Lp=N6,Ip=A6,zp=L6,$_=qi,_a=T_,Qy="[object Map]",I6="[object Object]",ex="[object Promise]",tx="[object Set]",nx="[object WeakMap]",rx="[object DataView]",z6=_a($p),F6=_a(Dp),B6=_a(Lp),H6=_a(Ip),U6=_a(zp),Ti=$_;($p&&Ti(new $p(new ArrayBuffer(1)))!=rx||Dp&&Ti(new Dp)!=Qy||Lp&&Ti(Lp.resolve())!=ex||Ip&&Ti(new Ip)!=tx||zp&&Ti(new zp)!=nx)&&(Ti=function(t){var e=$_(t),n=e==I6?t.constructor:void 0,r=n?_a(n):"";if(r)switch(r){case z6:return rx;case F6:return Qy;case B6:return ex;case H6:return tx;case U6:return nx}return e});var fu=Ti,yh=mm,W6=N_,G6=e6,V6=w6,sx=fu,ix=ns,ox=im,Y6=b_,q6=1,ax="[object Arguments]",lx="[object Array]",Ic="[object Object]",X6=Object.prototype,cx=X6.hasOwnProperty;function Z6(t,e,n,r,s,i){var a=ix(t),l=ix(e),c=a?lx:sx(t),d=l?lx:sx(e);c=c==ax?Ic:c,d=d==ax?Ic:d;var u=c==Ic,h=d==Ic,p=c==d;if(p&&ox(t)){if(!ox(e))return!1;a=!0,u=!1}if(p&&!u)return i||(i=new yh),a||Y6(t)?W6(t,e,n,r,s,i):G6(t,e,c,n,r,s,i);if(!(n&q6)){var f=u&&cx.call(t,"__wrapped__"),m=h&&cx.call(e,"__wrapped__");if(f||m){var y=f?t.value():t,v=m?e.value():e;return i||(i=new yh),s(y,v,n,r,i)}}return p?(i||(i=new yh),V6(t,e,n,r,s,i)):!1}var K6=Z6,J6=K6,dx=zs;function D_(t,e,n,r,s){return t===e?!0:t==null||e==null||!dx(t)&&!dx(e)?t!==t&&e!==e:J6(t,e,n,r,D_,s)}var L_=D_,Q6=mm,e$=L_,t$=1,n$=2;function r$(t,e,n,r){var s=n.length,i=s,a=!r;if(t==null)return!i;for(t=Object(t);s--;){var l=n[s];if(a&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++s<i;){l=n[s];var c=l[0],d=t[c],u=l[1];if(a&&l[2]){if(d===void 0&&!(c in t))return!1}else{var h=new Q6;if(r)var p=r(d,u,c,t,e,h);if(!(p===void 0?e$(u,d,t$|n$,r,h):p))return!1}}return!0}var s$=r$,i$=ya;function o$(t){return t===t&&!i$(t)}var I_=o$,a$=I_,l$=Gl;function c$(t){for(var e=l$(t),n=e.length;n--;){var r=e[n],s=t[r];e[n]=[r,s,a$(s)]}return e}var d$=c$;function u$(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}var z_=u$,h$=s$,p$=d$,f$=z_;function m$(t){var e=p$(t);return e.length==1&&e[0][2]?f$(e[0][0],e[0][1]):function(n){return n===t||h$(n,t,e)}}var g$=m$,y$=qi,x$=zs,v$="[object Symbol]";function b$(t){return typeof t=="symbol"||x$(t)&&y$(t)==v$}var ym=b$,w$=ns,_$=ym,k$=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,S$=/^\w*$/;function j$(t,e){if(w$(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||_$(t)?!0:S$.test(t)||!k$.test(t)||e!=null&&t in Object(e)}var xm=j$,F_=fm,C$="Expected a function";function vm(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(C$);var n=function(){var r=arguments,s=e?e.apply(this,r):r[0],i=n.cache;if(i.has(s))return i.get(s);var a=t.apply(this,r);return n.cache=i.set(s,a)||i,a};return n.cache=new(vm.Cache||F_),n}vm.Cache=F_;var E$=vm,T$=E$,N$=500;function P$(t){var e=T$(t,function(r){return n.size===N$&&n.clear(),r}),n=e.cache;return e}var R$=P$,O$=R$,A$=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,M$=/\\(\\)?/g,$$=O$(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(A$,function(n,r,s,i){e.push(s?i.replace(M$,"$1"):r||n)}),e}),D$=$$,ux=Wl,L$=E_,I$=ns,z$=ym,hx=ux?ux.prototype:void 0,px=hx?hx.toString:void 0;function B_(t){if(typeof t=="string")return t;if(I$(t))return L$(t,B_)+"";if(z$(t))return px?px.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}var F$=B_,B$=F$;function H$(t){return t==null?"":B$(t)}var U$=H$,W$=ns,G$=xm,V$=D$,Y$=U$;function q$(t,e){return W$(t)?t:G$(t,e)?[t]:V$(Y$(t))}var H_=q$,X$=ym;function Z$(t){if(typeof t=="string"||X$(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}var mu=Z$,K$=H_,J$=mu;function Q$(t,e){e=K$(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[J$(e[n++])];return n&&n==r?t:void 0}var U_=Q$,eD=U_;function tD(t,e,n){var r=t==null?void 0:eD(t,e);return r===void 0?n:r}var nD=tD;function rD(t,e){return t!=null&&e in Object(t)}var sD=rD,iD=H_,oD=x_,aD=ns,lD=v_,cD=om,dD=mu;function uD(t,e,n){e=iD(e,t);for(var r=-1,s=e.length,i=!1;++r<s;){var a=dD(e[r]);if(!(i=t!=null&&n(t,a)))break;t=t[a]}return i||++r!=s?i:(s=t==null?0:t.length,!!s&&cD(s)&&lD(a,s)&&(aD(t)||oD(t)))}var hD=uD,pD=sD,fD=hD;function mD(t,e){return t!=null&&fD(t,e,pD)}var gD=mD,yD=L_,xD=nD,vD=gD,bD=xm,wD=I_,_D=z_,kD=mu,SD=1,jD=2;function CD(t,e){return bD(t)&&wD(e)?_D(kD(t),e):function(n){var r=xD(n,t);return r===void 0&&r===e?vD(n,t):yD(e,r,SD|jD)}}var ED=CD;function TD(t){return function(e){return e==null?void 0:e[t]}}var ND=TD,PD=U_;function RD(t){return function(e){return PD(e,t)}}var OD=RD,AD=ND,MD=OD,$D=xm,DD=mu;function LD(t){return $D(t)?AD(DD(t)):MD(t)}var ID=LD,zD=g$,FD=ED,BD=j_,HD=ns,UD=ID;function WD(t){return typeof t=="function"?t:t==null?BD:typeof t=="object"?HD(t)?FD(t[0],t[1]):zD(t):UD(t)}var GD=WD,VD=cu;function YD(t,e){return function(n,r){if(n==null)return n;if(!VD(n))return t(n,r);for(var s=n.length,i=e?s:-1,a=Object(n);(e?i--:++i<s)&&r(a[i],i,a)!==!1;);return n}}var qD=YD,XD=S_,ZD=qD,KD=ZD(XD),JD=KD,QD=JD,eL=cu;function tL(t,e){var n=-1,r=eL(t)?Array(t.length):[];return QD(t,function(s,i,a){r[++n]=e(s,i,a)}),r}var nL=tL,rL=E_,sL=GD,iL=nL,oL=ns;function aL(t,e){var n=oL(t)?rL:iL;return n(t,sL(e))}var lL=aL;Object.defineProperty(Ul,"__esModule",{value:!0});Ul.flattenNames=void 0;var cL=z3,dL=gu(cL),uL=dm,hL=gu(uL),pL=GO,fL=gu(pL),mL=lL,gL=gu(mL);function gu(t){return t&&t.__esModule?t:{default:t}}var yL=Ul.flattenNames=function t(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n=[];return(0,gL.default)(e,function(r){Array.isArray(r)?t(r).map(function(s){return n.push(s)}):(0,fL.default)(r)?(0,hL.default)(r,function(s,i){s===!0&&n.push(i),n.push(i+"-"+s)}):(0,dL.default)(r)&&n.push(r)}),n};Ul.default=yL;var Vl={};function xL(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}var vL=xL,bL=Xi,wL=function(){try{var t=bL(Object,"defineProperty");return t({},"",{}),t}catch{}}(),_L=wL,fx=_L;function kL(t,e,n){e=="__proto__"&&fx?fx(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}var W_=kL,SL=W_,jL=hm,CL=Object.prototype,EL=CL.hasOwnProperty;function TL(t,e,n){var r=t[e];(!(EL.call(t,e)&&jL(r,n))||n===void 0&&!(e in t))&&SL(t,e,n)}var G_=TL,NL=G_,PL=W_;function RL(t,e,n,r){var s=!n;n||(n={});for(var i=-1,a=e.length;++i<a;){var l=e[i],c=r?r(n[l],t[l],l,n,t):void 0;c===void 0&&(c=t[l]),s?PL(n,l,c):NL(n,l,c)}return n}var yu=RL,OL=yu,AL=Gl;function ML(t,e){return t&&OL(e,AL(e),t)}var $L=ML;function DL(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var LL=DL,IL=ya,zL=cm,FL=LL,BL=Object.prototype,HL=BL.hasOwnProperty;function UL(t){if(!IL(t))return FL(t);var e=zL(t),n=[];for(var r in t)r=="constructor"&&(e||!HL.call(t,r))||n.push(r);return n}var WL=UL,GL=w_,VL=WL,YL=cu;function qL(t){return YL(t)?GL(t,!0):VL(t)}var bm=qL,XL=yu,ZL=bm;function KL(t,e){return t&&XL(e,ZL(e),t)}var JL=KL,Ld={exports:{}};Ld.exports;(function(t,e){var n=xs,r=e&&!e.nodeType&&e,s=r&&!0&&t&&!t.nodeType&&t,i=s&&s.exports===r,a=i?n.Buffer:void 0,l=a?a.allocUnsafe:void 0;function c(d,u){if(u)return d.slice();var h=d.length,p=l?l(h):new d.constructor(h);return d.copy(p),p}t.exports=c})(Ld,Ld.exports);var QL=Ld.exports;function e8(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var t8=e8,n8=yu,r8=gm;function s8(t,e){return n8(t,r8(t),e)}var i8=s8,o8=R_,a8=um,l8=gm,c8=A_,d8=Object.getOwnPropertySymbols,u8=d8?function(t){for(var e=[];t;)o8(e,l8(t)),t=a8(t);return e}:c8,V_=u8,h8=yu,p8=V_;function f8(t,e){return h8(t,p8(t),e)}var m8=f8,g8=O_,y8=V_,x8=bm;function v8(t){return g8(t,x8,y8)}var b8=v8,w8=Object.prototype,_8=w8.hasOwnProperty;function k8(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&_8.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var S8=k8,mx=P_;function j8(t){var e=new t.constructor(t.byteLength);return new mx(e).set(new mx(t)),e}var wm=j8,C8=wm;function E8(t,e){var n=e?C8(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var T8=E8,N8=/\w*$/;function P8(t){var e=new t.constructor(t.source,N8.exec(t));return e.lastIndex=t.lastIndex,e}var R8=P8,gx=Wl,yx=gx?gx.prototype:void 0,xx=yx?yx.valueOf:void 0;function O8(t){return xx?Object(xx.call(t)):{}}var A8=O8,M8=wm;function $8(t,e){var n=e?M8(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var D8=$8,L8=wm,I8=T8,z8=R8,F8=A8,B8=D8,H8="[object Boolean]",U8="[object Date]",W8="[object Map]",G8="[object Number]",V8="[object RegExp]",Y8="[object Set]",q8="[object String]",X8="[object Symbol]",Z8="[object ArrayBuffer]",K8="[object DataView]",J8="[object Float32Array]",Q8="[object Float64Array]",eI="[object Int8Array]",tI="[object Int16Array]",nI="[object Int32Array]",rI="[object Uint8Array]",sI="[object Uint8ClampedArray]",iI="[object Uint16Array]",oI="[object Uint32Array]";function aI(t,e,n){var r=t.constructor;switch(e){case Z8:return L8(t);case H8:case U8:return new r(+t);case K8:return I8(t,n);case J8:case Q8:case eI:case tI:case nI:case rI:case sI:case iI:case oI:return B8(t,n);case W8:return new r;case G8:case q8:return new r(t);case V8:return z8(t);case Y8:return new r;case X8:return F8(t)}}var lI=aI,cI=ya,vx=Object.create,dI=function(){function t(){}return function(e){if(!cI(e))return{};if(vx)return vx(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}(),uI=dI,hI=uI,pI=um,fI=cm;function mI(t){return typeof t.constructor=="function"&&!fI(t)?hI(pI(t)):{}}var gI=mI,yI=fu,xI=zs,vI="[object Map]";function bI(t){return xI(t)&&yI(t)==vI}var wI=bI,_I=wI,kI=am,bx=lm,wx=bx&&bx.isMap,SI=wx?kI(wx):_I,jI=SI,CI=fu,EI=zs,TI="[object Set]";function NI(t){return EI(t)&&CI(t)==TI}var PI=NI,RI=PI,OI=am,_x=lm,kx=_x&&_x.isSet,AI=kx?OI(kx):RI,MI=AI,$I=mm,DI=vL,LI=G_,II=$L,zI=JL,FI=QL,BI=t8,HI=i8,UI=m8,WI=M_,GI=b8,VI=fu,YI=S8,qI=lI,XI=gI,ZI=ns,KI=im,JI=jI,QI=ya,ez=MI,tz=Gl,nz=bm,rz=1,sz=2,iz=4,Y_="[object Arguments]",oz="[object Array]",az="[object Boolean]",lz="[object Date]",cz="[object Error]",q_="[object Function]",dz="[object GeneratorFunction]",uz="[object Map]",hz="[object Number]",X_="[object Object]",pz="[object RegExp]",fz="[object Set]",mz="[object String]",gz="[object Symbol]",yz="[object WeakMap]",xz="[object ArrayBuffer]",vz="[object DataView]",bz="[object Float32Array]",wz="[object Float64Array]",_z="[object Int8Array]",kz="[object Int16Array]",Sz="[object Int32Array]",jz="[object Uint8Array]",Cz="[object Uint8ClampedArray]",Ez="[object Uint16Array]",Tz="[object Uint32Array]",zt={};zt[Y_]=zt[oz]=zt[xz]=zt[vz]=zt[az]=zt[lz]=zt[bz]=zt[wz]=zt[_z]=zt[kz]=zt[Sz]=zt[uz]=zt[hz]=zt[X_]=zt[pz]=zt[fz]=zt[mz]=zt[gz]=zt[jz]=zt[Cz]=zt[Ez]=zt[Tz]=!0;zt[cz]=zt[q_]=zt[yz]=!1;function ed(t,e,n,r,s,i){var a,l=e&rz,c=e&sz,d=e&iz;if(n&&(a=s?n(t,r,s,i):n(t)),a!==void 0)return a;if(!QI(t))return t;var u=ZI(t);if(u){if(a=YI(t),!l)return BI(t,a)}else{var h=VI(t),p=h==q_||h==dz;if(KI(t))return FI(t,l);if(h==X_||h==Y_||p&&!s){if(a=c||p?{}:XI(t),!l)return c?UI(t,zI(a,t)):HI(t,II(a,t))}else{if(!zt[h])return s?t:{};a=qI(t,h,l)}}i||(i=new $I);var f=i.get(t);if(f)return f;i.set(t,a),ez(t)?t.forEach(function(v){a.add(ed(v,e,n,v,t,i))}):JI(t)&&t.forEach(function(v,x){a.set(x,ed(v,e,n,x,t,i))});var m=d?c?GI:WI:c?nz:tz,y=u?void 0:m(t);return DI(y||t,function(v,x){y&&(x=v,v=t[x]),LI(a,x,ed(v,e,n,x,t,i))}),a}var Nz=ed,Pz=Nz,Rz=1,Oz=4;function Az(t){return Pz(t,Rz|Oz)}var Mz=Az;Object.defineProperty(Vl,"__esModule",{value:!0});Vl.mergeClasses=void 0;var $z=dm,Dz=Z_($z),Lz=Mz,Iz=Z_(Lz),zz=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};function Z_(t){return t&&t.__esModule?t:{default:t}}var Fz=Vl.mergeClasses=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=e.default&&(0,Iz.default)(e.default)||{};return n.map(function(s){var i=e[s];return i&&(0,Dz.default)(i,function(a,l){r[l]||(r[l]={}),r[l]=zz({},r[l],i[l])}),s}),r};Vl.default=Fz;var Yl={};Object.defineProperty(Yl,"__esModule",{value:!0});Yl.autoprefix=void 0;var Bz=dm,Sx=Uz(Bz),Hz=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};function Uz(t){return t&&t.__esModule?t:{default:t}}var Wz={borderRadius:function(e){return{msBorderRadius:e,MozBorderRadius:e,OBorderRadius:e,WebkitBorderRadius:e,borderRadius:e}},boxShadow:function(e){return{msBoxShadow:e,MozBoxShadow:e,OBoxShadow:e,WebkitBoxShadow:e,boxShadow:e}},userSelect:function(e){return{WebkitTouchCallout:e,KhtmlUserSelect:e,MozUserSelect:e,msUserSelect:e,WebkitUserSelect:e,userSelect:e}},flex:function(e){return{WebkitBoxFlex:e,MozBoxFlex:e,WebkitFlex:e,msFlex:e,flex:e}},flexBasis:function(e){return{WebkitFlexBasis:e,flexBasis:e}},justifyContent:function(e){return{WebkitJustifyContent:e,justifyContent:e}},transition:function(e){return{msTransition:e,MozTransition:e,OTransition:e,WebkitTransition:e,transition:e}},transform:function(e){return{msTransform:e,MozTransform:e,OTransform:e,WebkitTransform:e,transform:e}},absolute:function(e){var n=e&&e.split(" ");return{position:"absolute",top:n&&n[0],right:n&&n[1],bottom:n&&n[2],left:n&&n[3]}},extend:function(e,n){var r=n[e];return r||{extend:e}}},Gz=Yl.autoprefix=function(e){var n={};return(0,Sx.default)(e,function(r,s){var i={};(0,Sx.default)(r,function(a,l){var c=Wz[l];c?i=Hz({},i,c(a)):i[l]=a}),n[s]=i}),n};Yl.default=Gz;var ql={};Object.defineProperty(ql,"__esModule",{value:!0});ql.hover=void 0;var Vz=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Yz=O,xh=qz(Yz);function qz(t){return t&&t.__esModule?t:{default:t}}function Xz(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function jx(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function Zz(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var Kz=ql.hover=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"span";return function(r){Zz(s,r);function s(){var i,a,l,c;Xz(this,s);for(var d=arguments.length,u=Array(d),h=0;h<d;h++)u[h]=arguments[h];return c=(a=(l=jx(this,(i=s.__proto__||Object.getPrototypeOf(s)).call.apply(i,[this].concat(u))),l),l.state={hover:!1},l.handleMouseOver=function(){return l.setState({hover:!0})},l.handleMouseOut=function(){return l.setState({hover:!1})},l.render=function(){return xh.default.createElement(n,{onMouseOver:l.handleMouseOver,onMouseOut:l.handleMouseOut},xh.default.createElement(e,Vz({},l.props,l.state)))},a),jx(l,c)}return s}(xh.default.Component)};ql.default=Kz;var Xl={};Object.defineProperty(Xl,"__esModule",{value:!0});Xl.active=void 0;var Jz=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Qz=O,vh=eF(Qz);function eF(t){return t&&t.__esModule?t:{default:t}}function tF(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Cx(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function nF(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var rF=Xl.active=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"span";return function(r){nF(s,r);function s(){var i,a,l,c;tF(this,s);for(var d=arguments.length,u=Array(d),h=0;h<d;h++)u[h]=arguments[h];return c=(a=(l=Cx(this,(i=s.__proto__||Object.getPrototypeOf(s)).call.apply(i,[this].concat(u))),l),l.state={active:!1},l.handleMouseDown=function(){return l.setState({active:!0})},l.handleMouseUp=function(){return l.setState({active:!1})},l.render=function(){return vh.default.createElement(n,{onMouseDown:l.handleMouseDown,onMouseUp:l.handleMouseUp},vh.default.createElement(e,Jz({},l.props,l.state)))},a),Cx(l,c)}return s}(vh.default.Component)};Xl.default=rF;var _m={};Object.defineProperty(_m,"__esModule",{value:!0});var sF=function(e,n){var r={},s=function(a){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;r[a]=l};return e===0&&s("first-child"),e===n-1&&s("last-child"),(e===0||e%2===0)&&s("even"),Math.abs(e%2)===1&&s("odd"),s("nth-child",e),r};_m.default=sF;Object.defineProperty(Nr,"__esModule",{value:!0});Nr.ReactCSS=Nr.loop=Nr.handleActive=km=Nr.handleHover=Nr.hover=void 0;var iF=Ul,oF=ka(iF),aF=Vl,lF=ka(aF),cF=Yl,dF=ka(cF),uF=ql,K_=ka(uF),hF=Xl,pF=ka(hF),fF=_m,mF=ka(fF);function ka(t){return t&&t.__esModule?t:{default:t}}Nr.hover=K_.default;var km=Nr.handleHover=K_.default;Nr.handleActive=pF.default;Nr.loop=mF.default;var gF=Nr.ReactCSS=function(e){for(var n=arguments.length,r=Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];var i=(0,oF.default)(r),a=(0,lF.default)(e,i);return(0,dF.default)(a)},pt=Nr.default=gF,yF=function(e,n,r,s,i){var a=i.clientWidth,l=i.clientHeight,c=typeof e.pageX=="number"?e.pageX:e.touches[0].pageX,d=typeof e.pageY=="number"?e.pageY:e.touches[0].pageY,u=c-(i.getBoundingClientRect().left+window.pageXOffset),h=d-(i.getBoundingClientRect().top+window.pageYOffset);if(r==="vertical"){var p=void 0;if(h<0?p=0:h>l?p=1:p=Math.round(h*100/l)/100,n.a!==p)return{h:n.h,s:n.s,l:n.l,a:p,source:"rgb"}}else{var f=void 0;if(u<0?f=0:u>a?f=1:f=Math.round(u*100/a)/100,s!==f)return{h:n.h,s:n.s,l:n.l,a:f,source:"rgb"}}return null},bh={},xF=function(e,n,r,s){if(typeof document>"u"&&!s)return null;var i=s?new s:document.createElement("canvas");i.width=r*2,i.height=r*2;var a=i.getContext("2d");return a?(a.fillStyle=e,a.fillRect(0,0,i.width,i.height),a.fillStyle=n,a.fillRect(0,0,r,r),a.translate(r,r),a.fillRect(0,0,r,r),i.toDataURL()):null},vF=function(e,n,r,s){var i=e+"-"+n+"-"+r+(s?"-server":"");if(bh[i])return bh[i];var a=xF(e,n,r,s);return bh[i]=a,a},Ex=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Sa=function(e){var n=e.white,r=e.grey,s=e.size,i=e.renderers,a=e.borderRadius,l=e.boxShadow,c=e.children,d=pt({default:{grid:{borderRadius:a,boxShadow:l,absolute:"0px 0px 0px 0px",background:"url("+vF(n,r,s,i.canvas)+") center left"}}});return O.isValidElement(c)?D.cloneElement(c,Ex({},c.props,{style:Ex({},c.props.style,d.grid)})):D.createElement("div",{style:d.grid})};Sa.defaultProps={size:8,white:"transparent",grey:"rgba(0,0,0,.08)",renderers:{}};var bF=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},wF=function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function _F(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Tx(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function kF(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var Sm=function(t){kF(e,t);function e(){var n,r,s,i;_F(this,e);for(var a=arguments.length,l=Array(a),c=0;c<a;c++)l[c]=arguments[c];return i=(r=(s=Tx(this,(n=e.__proto__||Object.getPrototypeOf(e)).call.apply(n,[this].concat(l))),s),s.handleChange=function(d){var u=yF(d,s.props.hsl,s.props.direction,s.props.a,s.container);u&&typeof s.props.onChange=="function"&&s.props.onChange(u,d)},s.handleMouseDown=function(d){s.handleChange(d),window.addEventListener("mousemove",s.handleChange),window.addEventListener("mouseup",s.handleMouseUp)},s.handleMouseUp=function(){s.unbindEventListeners()},s.unbindEventListeners=function(){window.removeEventListener("mousemove",s.handleChange),window.removeEventListener("mouseup",s.handleMouseUp)},r),Tx(s,i)}return wF(e,[{key:"componentWillUnmount",value:function(){this.unbindEventListeners()}},{key:"render",value:function(){var r=this,s=this.props.rgb,i=pt({default:{alpha:{absolute:"0px 0px 0px 0px",borderRadius:this.props.radius},checkboard:{absolute:"0px 0px 0px 0px",overflow:"hidden",borderRadius:this.props.radius},gradient:{absolute:"0px 0px 0px 0px",background:"linear-gradient(to right, rgba("+s.r+","+s.g+","+s.b+`, 0) 0%,
           rgba(`+s.r+","+s.g+","+s.b+", 1) 100%)",boxShadow:this.props.shadow,borderRadius:this.props.radius},container:{position:"relative",height:"100%",margin:"0 3px"},pointer:{position:"absolute",left:s.a*100+"%"},slider:{width:"4px",borderRadius:"1px",height:"8px",boxShadow:"0 0 2px rgba(0, 0, 0, .6)",background:"#fff",marginTop:"1px",transform:"translateX(-2px)"}},vertical:{gradient:{background:"linear-gradient(to bottom, rgba("+s.r+","+s.g+","+s.b+`, 0) 0%,
           rgba(`+s.r+","+s.g+","+s.b+", 1) 100%)"},pointer:{left:0,top:s.a*100+"%"}},overwrite:bF({},this.props.style)},{vertical:this.props.direction==="vertical",overwrite:!0});return D.createElement("div",{style:i.alpha},D.createElement("div",{style:i.checkboard},D.createElement(Sa,{renderers:this.props.renderers})),D.createElement("div",{style:i.gradient}),D.createElement("div",{style:i.container,ref:function(l){return r.container=l},onMouseDown:this.handleMouseDown,onTouchMove:this.handleChange,onTouchStart:this.handleChange},D.createElement("div",{style:i.pointer},this.props.pointer?D.createElement(this.props.pointer,this.props):D.createElement("div",{style:i.slider}))))}}]),e}(O.PureComponent||O.Component),SF=function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function jF(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function CF(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function EF(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function TF(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var NF=1,J_=38,PF=40,RF=[J_,PF],OF=function(e){return RF.indexOf(e)>-1},AF=function(e){return Number(String(e).replace(/%/g,""))},MF=1,kt=function(t){TF(e,t);function e(n){CF(this,e);var r=EF(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.handleBlur=function(){r.state.blurValue&&r.setState({value:r.state.blurValue,blurValue:null})},r.handleChange=function(s){r.setUpdatedValue(s.target.value,s)},r.handleKeyDown=function(s){var i=AF(s.target.value);if(!isNaN(i)&&OF(s.keyCode)){var a=r.getArrowOffset(),l=s.keyCode===J_?i+a:i-a;r.setUpdatedValue(l,s)}},r.handleDrag=function(s){if(r.props.dragLabel){var i=Math.round(r.props.value+s.movementX);i>=0&&i<=r.props.dragMax&&r.props.onChange&&r.props.onChange(r.getValueObjectWithLabel(i),s)}},r.handleMouseDown=function(s){r.props.dragLabel&&(s.preventDefault(),r.handleDrag(s),window.addEventListener("mousemove",r.handleDrag),window.addEventListener("mouseup",r.handleMouseUp))},r.handleMouseUp=function(){r.unbindEventListeners()},r.unbindEventListeners=function(){window.removeEventListener("mousemove",r.handleDrag),window.removeEventListener("mouseup",r.handleMouseUp)},r.state={value:String(n.value).toUpperCase(),blurValue:String(n.value).toUpperCase()},r.inputId="rc-editable-input-"+MF++,r}return SF(e,[{key:"componentDidUpdate",value:function(r,s){this.props.value!==this.state.value&&(r.value!==this.props.value||s.value!==this.state.value)&&(this.input===document.activeElement?this.setState({blurValue:String(this.props.value).toUpperCase()}):this.setState({value:String(this.props.value).toUpperCase(),blurValue:!this.state.blurValue&&String(this.props.value).toUpperCase()}))}},{key:"componentWillUnmount",value:function(){this.unbindEventListeners()}},{key:"getValueObjectWithLabel",value:function(r){return jF({},this.props.label,r)}},{key:"getArrowOffset",value:function(){return this.props.arrowOffset||NF}},{key:"setUpdatedValue",value:function(r,s){var i=this.props.label?this.getValueObjectWithLabel(r):r;this.props.onChange&&this.props.onChange(i,s),this.setState({value:r})}},{key:"render",value:function(){var r=this,s=pt({default:{wrap:{position:"relative"}},"user-override":{wrap:this.props.style&&this.props.style.wrap?this.props.style.wrap:{},input:this.props.style&&this.props.style.input?this.props.style.input:{},label:this.props.style&&this.props.style.label?this.props.style.label:{}},"dragLabel-true":{label:{cursor:"ew-resize"}}},{"user-override":!0},this.props);return D.createElement("div",{style:s.wrap},D.createElement("input",{id:this.inputId,style:s.input,ref:function(a){return r.input=a},value:this.state.value,onKeyDown:this.handleKeyDown,onChange:this.handleChange,onBlur:this.handleBlur,placeholder:this.props.placeholder,spellCheck:"false"}),this.props.label&&!this.props.hideLabel?D.createElement("label",{htmlFor:this.inputId,style:s.label,onMouseDown:this.handleMouseDown},this.props.label):null)}}]),e}(O.PureComponent||O.Component),$F=function(e,n,r,s){var i=s.clientWidth,a=s.clientHeight,l=typeof e.pageX=="number"?e.pageX:e.touches[0].pageX,c=typeof e.pageY=="number"?e.pageY:e.touches[0].pageY,d=l-(s.getBoundingClientRect().left+window.pageXOffset),u=c-(s.getBoundingClientRect().top+window.pageYOffset);if(n==="vertical"){var h=void 0;if(u<0)h=359;else if(u>a)h=0;else{var p=-(u*100/a)+100;h=360*p/100}if(r.h!==h)return{h,s:r.s,l:r.l,a:r.a,source:"hsl"}}else{var f=void 0;if(d<0)f=0;else if(d>i)f=359;else{var m=d*100/i;f=360*m/100}if(r.h!==f)return{h:f,s:r.s,l:r.l,a:r.a,source:"hsl"}}return null},DF=function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function LF(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Nx(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function IF(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var ja=function(t){IF(e,t);function e(){var n,r,s,i;LF(this,e);for(var a=arguments.length,l=Array(a),c=0;c<a;c++)l[c]=arguments[c];return i=(r=(s=Nx(this,(n=e.__proto__||Object.getPrototypeOf(e)).call.apply(n,[this].concat(l))),s),s.handleChange=function(d){var u=$F(d,s.props.direction,s.props.hsl,s.container);u&&typeof s.props.onChange=="function"&&s.props.onChange(u,d)},s.handleMouseDown=function(d){s.handleChange(d),window.addEventListener("mousemove",s.handleChange),window.addEventListener("mouseup",s.handleMouseUp)},s.handleMouseUp=function(){s.unbindEventListeners()},r),Nx(s,i)}return DF(e,[{key:"componentWillUnmount",value:function(){this.unbindEventListeners()}},{key:"unbindEventListeners",value:function(){window.removeEventListener("mousemove",this.handleChange),window.removeEventListener("mouseup",this.handleMouseUp)}},{key:"render",value:function(){var r=this,s=this.props.direction,i=s===void 0?"horizontal":s,a=pt({default:{hue:{absolute:"0px 0px 0px 0px",borderRadius:this.props.radius,boxShadow:this.props.shadow},container:{padding:"0 2px",position:"relative",height:"100%",borderRadius:this.props.radius},pointer:{position:"absolute",left:this.props.hsl.h*100/360+"%"},slider:{marginTop:"1px",width:"4px",borderRadius:"1px",height:"8px",boxShadow:"0 0 2px rgba(0, 0, 0, .6)",background:"#fff",transform:"translateX(-2px)"}},vertical:{pointer:{left:"0px",top:-(this.props.hsl.h*100/360)+100+"%"}}},{vertical:i==="vertical"});return D.createElement("div",{style:a.hue},D.createElement("div",{className:"hue-"+i,style:a.container,ref:function(c){return r.container=c},onMouseDown:this.handleMouseDown,onTouchMove:this.handleChange,onTouchStart:this.handleChange},D.createElement("style",null,`
            .hue-horizontal {
              background: linear-gradient(to right, #f00 0%, #ff0 17%, #0f0
                33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);
              background: -webkit-linear-gradient(to right, #f00 0%, #ff0
                17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);
            }

            .hue-vertical {
              background: linear-gradient(to top, #f00 0%, #ff0 17%, #0f0 33%,
                #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);
              background: -webkit-linear-gradient(to top, #f00 0%, #ff0 17%,
                #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);
            }
          `),D.createElement("div",{style:a.pointer},this.props.pointer?D.createElement(this.props.pointer,this.props):D.createElement("div",{style:a.slider}))))}}]),e}(O.PureComponent||O.Component),Q_={exports:{}},zF="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",FF=zF,BF=FF;function e2(){}function t2(){}t2.resetWarningCache=e2;var HF=function(){function t(r,s,i,a,l,c){if(c!==BF){var d=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw d.name="Invariant Violation",d}}t.isRequired=t;function e(){return t}var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:t2,resetWarningCache:e2};return n.PropTypes=n,n};Q_.exports=HF();var UF=Q_.exports;const Le=$l(UF);function WF(){this.__data__=[],this.size=0}function Zl(t,e){return t===e||t!==t&&e!==e}function xu(t,e){for(var n=t.length;n--;)if(Zl(t[n][0],e))return n;return-1}var GF=Array.prototype,VF=GF.splice;function YF(t){var e=this.__data__,n=xu(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():VF.call(e,n,1),--this.size,!0}function qF(t){var e=this.__data__,n=xu(e,t);return n<0?void 0:e[n][1]}function XF(t){return xu(this.__data__,t)>-1}function ZF(t,e){var n=this.__data__,r=xu(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function Fs(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Fs.prototype.clear=WF;Fs.prototype.delete=YF;Fs.prototype.get=qF;Fs.prototype.has=XF;Fs.prototype.set=ZF;function KF(){this.__data__=new Fs,this.size=0}function JF(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function QF(t){return this.__data__.get(t)}function eB(t){return this.__data__.has(t)}var n2=typeof global=="object"&&global&&global.Object===Object&&global,tB=typeof self=="object"&&self&&self.Object===Object&&self,rs=n2||tB||Function("return this")(),pi=rs.Symbol,r2=Object.prototype,nB=r2.hasOwnProperty,rB=r2.toString,Fa=pi?pi.toStringTag:void 0;function sB(t){var e=nB.call(t,Fa),n=t[Fa];try{t[Fa]=void 0;var r=!0}catch{}var s=rB.call(t);return r&&(e?t[Fa]=n:delete t[Fa]),s}var iB=Object.prototype,oB=iB.toString;function aB(t){return oB.call(t)}var lB="[object Null]",cB="[object Undefined]",Px=pi?pi.toStringTag:void 0;function Zi(t){return t==null?t===void 0?cB:lB:Px&&Px in Object(t)?sB(t):aB(t)}function Mr(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var dB="[object AsyncFunction]",uB="[object Function]",hB="[object GeneratorFunction]",pB="[object Proxy]";function jm(t){if(!Mr(t))return!1;var e=Zi(t);return e==uB||e==hB||e==dB||e==pB}var wh=rs["__core-js_shared__"],Rx=function(){var t=/[^.]+$/.exec(wh&&wh.keys&&wh.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function fB(t){return!!Rx&&Rx in t}var mB=Function.prototype,gB=mB.toString;function Ki(t){if(t!=null){try{return gB.call(t)}catch{}try{return t+""}catch{}}return""}var yB=/[\\^$.*+?()[\]{}|]/g,xB=/^\[object .+?Constructor\]$/,vB=Function.prototype,bB=Object.prototype,wB=vB.toString,_B=bB.hasOwnProperty,kB=RegExp("^"+wB.call(_B).replace(yB,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function SB(t){if(!Mr(t)||fB(t))return!1;var e=jm(t)?kB:xB;return e.test(Ki(t))}function jB(t,e){return t==null?void 0:t[e]}function Ji(t,e){var n=jB(t,e);return SB(n)?n:void 0}var Al=Ji(rs,"Map"),Ml=Ji(Object,"create");function CB(){this.__data__=Ml?Ml(null):{},this.size=0}function EB(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var TB="__lodash_hash_undefined__",NB=Object.prototype,PB=NB.hasOwnProperty;function RB(t){var e=this.__data__;if(Ml){var n=e[t];return n===TB?void 0:n}return PB.call(e,t)?e[t]:void 0}var OB=Object.prototype,AB=OB.hasOwnProperty;function MB(t){var e=this.__data__;return Ml?e[t]!==void 0:AB.call(e,t)}var $B="__lodash_hash_undefined__";function DB(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Ml&&e===void 0?$B:e,this}function Gi(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Gi.prototype.clear=CB;Gi.prototype.delete=EB;Gi.prototype.get=RB;Gi.prototype.has=MB;Gi.prototype.set=DB;function LB(){this.size=0,this.__data__={hash:new Gi,map:new(Al||Fs),string:new Gi}}function IB(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function vu(t,e){var n=t.__data__;return IB(e)?n[typeof e=="string"?"string":"hash"]:n.map}function zB(t){var e=vu(this,t).delete(t);return this.size-=e?1:0,e}function FB(t){return vu(this,t).get(t)}function BB(t){return vu(this,t).has(t)}function HB(t,e){var n=vu(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function Bs(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Bs.prototype.clear=LB;Bs.prototype.delete=zB;Bs.prototype.get=FB;Bs.prototype.has=BB;Bs.prototype.set=HB;var UB=200;function WB(t,e){var n=this.__data__;if(n instanceof Fs){var r=n.__data__;if(!Al||r.length<UB-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Bs(r)}return n.set(t,e),this.size=n.size,this}function ys(t){var e=this.__data__=new Fs(t);this.size=e.size}ys.prototype.clear=KF;ys.prototype.delete=JF;ys.prototype.get=QF;ys.prototype.has=eB;ys.prototype.set=WB;var Id=function(){try{var t=Ji(Object,"defineProperty");return t({},"",{}),t}catch{}}();function Cm(t,e,n){e=="__proto__"&&Id?Id(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Fp(t,e,n){(n!==void 0&&!Zl(t[e],n)||n===void 0&&!(e in t))&&Cm(t,e,n)}function GB(t){return function(e,n,r){for(var s=-1,i=Object(e),a=r(e),l=a.length;l--;){var c=a[++s];if(n(i[c],c,i)===!1)break}return e}}var s2=GB(),i2=typeof fr=="object"&&fr&&!fr.nodeType&&fr,Ox=i2&&typeof mr=="object"&&mr&&!mr.nodeType&&mr,VB=Ox&&Ox.exports===i2,Ax=VB?rs.Buffer:void 0;Ax&&Ax.allocUnsafe;function YB(t,e){return t.slice()}var zd=rs.Uint8Array;function qB(t){var e=new t.constructor(t.byteLength);return new zd(e).set(new zd(t)),e}function XB(t,e){var n=qB(t.buffer);return new t.constructor(n,t.byteOffset,t.length)}function ZB(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var Mx=Object.create,KB=function(){function t(){}return function(e){if(!Mr(e))return{};if(Mx)return Mx(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();function o2(t,e){return function(n){return t(e(n))}}var a2=o2(Object.getPrototypeOf,Object),JB=Object.prototype;function Em(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||JB;return t===n}function QB(t){return typeof t.constructor=="function"&&!Em(t)?KB(a2(t)):{}}function fi(t){return t!=null&&typeof t=="object"}var eH="[object Arguments]";function $x(t){return fi(t)&&Zi(t)==eH}var l2=Object.prototype,tH=l2.hasOwnProperty,nH=l2.propertyIsEnumerable,Fd=$x(function(){return arguments}())?$x:function(t){return fi(t)&&tH.call(t,"callee")&&!nH.call(t,"callee")},xr=Array.isArray,rH=9007199254740991;function Tm(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=rH}function Ca(t){return t!=null&&Tm(t.length)&&!jm(t)}function sH(t){return fi(t)&&Ca(t)}function iH(){return!1}var c2=typeof fr=="object"&&fr&&!fr.nodeType&&fr,Dx=c2&&typeof mr=="object"&&mr&&!mr.nodeType&&mr,oH=Dx&&Dx.exports===c2,Lx=oH?rs.Buffer:void 0,aH=Lx?Lx.isBuffer:void 0,Bd=aH||iH,lH="[object Object]",cH=Function.prototype,dH=Object.prototype,d2=cH.toString,uH=dH.hasOwnProperty,hH=d2.call(Object);function pH(t){if(!fi(t)||Zi(t)!=lH)return!1;var e=a2(t);if(e===null)return!0;var n=uH.call(e,"constructor")&&e.constructor;return typeof n=="function"&&n instanceof n&&d2.call(n)==hH}var fH="[object Arguments]",mH="[object Array]",gH="[object Boolean]",yH="[object Date]",xH="[object Error]",vH="[object Function]",bH="[object Map]",wH="[object Number]",_H="[object Object]",kH="[object RegExp]",SH="[object Set]",jH="[object String]",CH="[object WeakMap]",EH="[object ArrayBuffer]",TH="[object DataView]",NH="[object Float32Array]",PH="[object Float64Array]",RH="[object Int8Array]",OH="[object Int16Array]",AH="[object Int32Array]",MH="[object Uint8Array]",$H="[object Uint8ClampedArray]",DH="[object Uint16Array]",LH="[object Uint32Array]",Vt={};Vt[NH]=Vt[PH]=Vt[RH]=Vt[OH]=Vt[AH]=Vt[MH]=Vt[$H]=Vt[DH]=Vt[LH]=!0;Vt[fH]=Vt[mH]=Vt[EH]=Vt[gH]=Vt[TH]=Vt[yH]=Vt[xH]=Vt[vH]=Vt[bH]=Vt[wH]=Vt[_H]=Vt[kH]=Vt[SH]=Vt[jH]=Vt[CH]=!1;function IH(t){return fi(t)&&Tm(t.length)&&!!Vt[Zi(t)]}function zH(t){return function(e){return t(e)}}var u2=typeof fr=="object"&&fr&&!fr.nodeType&&fr,ul=u2&&typeof mr=="object"&&mr&&!mr.nodeType&&mr,FH=ul&&ul.exports===u2,_h=FH&&n2.process,Ix=function(){try{var t=ul&&ul.require&&ul.require("util").types;return t||_h&&_h.binding&&_h.binding("util")}catch{}}(),zx=Ix&&Ix.isTypedArray,Nm=zx?zH(zx):IH;function Bp(t,e){if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]}var BH=Object.prototype,HH=BH.hasOwnProperty;function UH(t,e,n){var r=t[e];(!(HH.call(t,e)&&Zl(r,n))||n===void 0&&!(e in t))&&Cm(t,e,n)}function WH(t,e,n,r){var s=!n;n||(n={});for(var i=-1,a=e.length;++i<a;){var l=e[i],c=void 0;c===void 0&&(c=t[l]),s?Cm(n,l,c):UH(n,l,c)}return n}function GH(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var VH=9007199254740991,YH=/^(?:0|[1-9]\d*)$/;function Pm(t,e){var n=typeof t;return e=e??VH,!!e&&(n=="number"||n!="symbol"&&YH.test(t))&&t>-1&&t%1==0&&t<e}var qH=Object.prototype,XH=qH.hasOwnProperty;function h2(t,e){var n=xr(t),r=!n&&Fd(t),s=!n&&!r&&Bd(t),i=!n&&!r&&!s&&Nm(t),a=n||r||s||i,l=a?GH(t.length,String):[],c=l.length;for(var d in t)(e||XH.call(t,d))&&!(a&&(d=="length"||s&&(d=="offset"||d=="parent")||i&&(d=="buffer"||d=="byteLength"||d=="byteOffset")||Pm(d,c)))&&l.push(d);return l}function ZH(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var KH=Object.prototype,JH=KH.hasOwnProperty;function QH(t){if(!Mr(t))return ZH(t);var e=Em(t),n=[];for(var r in t)r=="constructor"&&(e||!JH.call(t,r))||n.push(r);return n}function p2(t){return Ca(t)?h2(t,!0):QH(t)}function e7(t){return WH(t,p2(t))}function t7(t,e,n,r,s,i,a){var l=Bp(t,n),c=Bp(e,n),d=a.get(c);if(d){Fp(t,n,d);return}var u=i?i(l,c,n+"",t,e,a):void 0,h=u===void 0;if(h){var p=xr(c),f=!p&&Bd(c),m=!p&&!f&&Nm(c);u=c,p||f||m?xr(l)?u=l:sH(l)?u=ZB(l):f?(h=!1,u=YB(c)):m?(h=!1,u=XB(c)):u=[]:pH(c)||Fd(c)?(u=l,Fd(l)?u=e7(l):(!Mr(l)||jm(l))&&(u=QB(c))):h=!1}h&&(a.set(c,u),s(u,c,r,i,a),a.delete(c)),Fp(t,n,u)}function f2(t,e,n,r,s){t!==e&&s2(e,function(i,a){if(s||(s=new ys),Mr(i))t7(t,e,a,n,f2,r,s);else{var l=r?r(Bp(t,a),i,a+"",t,e,s):void 0;l===void 0&&(l=i),Fp(t,a,l)}},p2)}function bu(t){return t}function n7(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}var Fx=Math.max;function r7(t,e,n){return e=Fx(e===void 0?t.length-1:e,0),function(){for(var r=arguments,s=-1,i=Fx(r.length-e,0),a=Array(i);++s<i;)a[s]=r[e+s];s=-1;for(var l=Array(e+1);++s<e;)l[s]=r[s];return l[e]=n(a),n7(t,this,l)}}function s7(t){return function(){return t}}var i7=Id?function(t,e){return Id(t,"toString",{configurable:!0,enumerable:!1,value:s7(e),writable:!0})}:bu,o7=800,a7=16,l7=Date.now;function c7(t){var e=0,n=0;return function(){var r=l7(),s=a7-(r-n);if(n=r,s>0){if(++e>=o7)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var d7=c7(i7);function u7(t,e){return d7(r7(t,e,bu),t+"")}function h7(t,e,n){if(!Mr(n))return!1;var r=typeof e;return(r=="number"?Ca(n)&&Pm(e,n.length):r=="string"&&e in n)?Zl(n[e],t):!1}function p7(t){return u7(function(e,n){var r=-1,s=n.length,i=s>1?n[s-1]:void 0,a=s>2?n[2]:void 0;for(i=t.length>3&&typeof i=="function"?(s--,i):void 0,a&&h7(n[0],n[1],a)&&(i=s<3?void 0:i,s=1),e=Object(e);++r<s;){var l=n[r];l&&t(e,l,r,i)}return e})}var nr=p7(function(t,e,n){f2(t,e,n)}),Kl=function(e){var n=e.zDepth,r=e.radius,s=e.background,i=e.children,a=e.styles,l=a===void 0?{}:a,c=pt(nr({default:{wrap:{position:"relative",display:"inline-block"},content:{position:"relative"},bg:{absolute:"0px 0px 0px 0px",boxShadow:"0 "+n+"px "+n*4+"px rgba(0,0,0,.24)",borderRadius:r,background:s}},"zDepth-0":{bg:{boxShadow:"none"}},"zDepth-1":{bg:{boxShadow:"0 2px 10px rgba(0,0,0,.12), 0 2px 5px rgba(0,0,0,.16)"}},"zDepth-2":{bg:{boxShadow:"0 6px 20px rgba(0,0,0,.19), 0 8px 17px rgba(0,0,0,.2)"}},"zDepth-3":{bg:{boxShadow:"0 17px 50px rgba(0,0,0,.19), 0 12px 15px rgba(0,0,0,.24)"}},"zDepth-4":{bg:{boxShadow:"0 25px 55px rgba(0,0,0,.21), 0 16px 28px rgba(0,0,0,.22)"}},"zDepth-5":{bg:{boxShadow:"0 40px 77px rgba(0,0,0,.22), 0 27px 24px rgba(0,0,0,.2)"}},square:{bg:{borderRadius:"0"}},circle:{bg:{borderRadius:"50%"}}},l),{"zDepth-1":n===1});return D.createElement("div",{style:c.wrap},D.createElement("div",{style:c.bg}),D.createElement("div",{style:c.content},i))};Kl.propTypes={background:Le.string,zDepth:Le.oneOf([0,1,2,3,4,5]),radius:Le.number,styles:Le.object};Kl.defaultProps={background:"#fff",zDepth:1,radius:2,styles:{}};var kh=function(){return rs.Date.now()},f7=/\s/;function m7(t){for(var e=t.length;e--&&f7.test(t.charAt(e)););return e}var g7=/^\s+/;function y7(t){return t&&t.slice(0,m7(t)+1).replace(g7,"")}var x7="[object Symbol]";function wu(t){return typeof t=="symbol"||fi(t)&&Zi(t)==x7}var Bx=NaN,v7=/^[-+]0x[0-9a-f]+$/i,b7=/^0b[01]+$/i,w7=/^0o[0-7]+$/i,_7=parseInt;function Hx(t){if(typeof t=="number")return t;if(wu(t))return Bx;if(Mr(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Mr(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=y7(t);var n=b7.test(t);return n||w7.test(t)?_7(t.slice(2),n?2:8):v7.test(t)?Bx:+t}var k7="Expected a function",S7=Math.max,j7=Math.min;function m2(t,e,n){var r,s,i,a,l,c,d=0,u=!1,h=!1,p=!0;if(typeof t!="function")throw new TypeError(k7);e=Hx(e)||0,Mr(n)&&(u=!!n.leading,h="maxWait"in n,i=h?S7(Hx(n.maxWait)||0,e):i,p="trailing"in n?!!n.trailing:p);function f(_){var S=r,E=s;return r=s=void 0,d=_,a=t.apply(E,S),a}function m(_){return d=_,l=setTimeout(x,e),u?f(_):a}function y(_){var S=_-c,E=_-d,T=e-S;return h?j7(T,i-E):T}function v(_){var S=_-c,E=_-d;return c===void 0||S>=e||S<0||h&&E>=i}function x(){var _=kh();if(v(_))return g(_);l=setTimeout(x,y(_))}function g(_){return l=void 0,p&&r?f(_):(r=s=void 0,a)}function w(){l!==void 0&&clearTimeout(l),d=0,r=c=s=l=void 0}function b(){return l===void 0?a:g(kh())}function k(){var _=kh(),S=v(_);if(r=arguments,s=this,c=_,S){if(l===void 0)return m(c);if(h)return clearTimeout(l),l=setTimeout(x,e),f(c)}return l===void 0&&(l=setTimeout(x,e)),a}return k.cancel=w,k.flush=b,k}var C7="Expected a function";function E7(t,e,n){var r=!0,s=!0;if(typeof t!="function")throw new TypeError(C7);return Mr(n)&&(r="leading"in n?!!n.leading:r,s="trailing"in n?!!n.trailing:s),m2(t,e,{leading:r,maxWait:e,trailing:s})}var T7=function(e,n,r){var s=r.getBoundingClientRect(),i=s.width,a=s.height,l=typeof e.pageX=="number"?e.pageX:e.touches[0].pageX,c=typeof e.pageY=="number"?e.pageY:e.touches[0].pageY,d=l-(r.getBoundingClientRect().left+window.pageXOffset),u=c-(r.getBoundingClientRect().top+window.pageYOffset);d<0?d=0:d>i&&(d=i),u<0?u=0:u>a&&(u=a);var h=d/i,p=1-u/a;return{h:n.h,s:h,v:p,a:n.a,source:"hsv"}},N7=function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function P7(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function R7(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function O7(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _u=function(t){O7(e,t);function e(n){P7(this,e);var r=R7(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,n));return r.handleChange=function(s){typeof r.props.onChange=="function"&&r.throttle(r.props.onChange,T7(s,r.props.hsl,r.container),s)},r.handleMouseDown=function(s){r.handleChange(s);var i=r.getContainerRenderWindow();i.addEventListener("mousemove",r.handleChange),i.addEventListener("mouseup",r.handleMouseUp)},r.handleMouseUp=function(){r.unbindEventListeners()},r.throttle=E7(function(s,i,a){s(i,a)},50),r}return N7(e,[{key:"componentWillUnmount",value:function(){this.throttle.cancel(),this.unbindEventListeners()}},{key:"getContainerRenderWindow",value:function(){for(var r=this.container,s=window;!s.document.contains(r)&&s.parent!==s;)s=s.parent;return s}},{key:"unbindEventListeners",value:function(){var r=this.getContainerRenderWindow();r.removeEventListener("mousemove",this.handleChange),r.removeEventListener("mouseup",this.handleMouseUp)}},{key:"render",value:function(){var r=this,s=this.props.style||{},i=s.color,a=s.white,l=s.black,c=s.pointer,d=s.circle,u=pt({default:{color:{absolute:"0px 0px 0px 0px",background:"hsl("+this.props.hsl.h+",100%, 50%)",borderRadius:this.props.radius},white:{absolute:"0px 0px 0px 0px",borderRadius:this.props.radius},black:{absolute:"0px 0px 0px 0px",boxShadow:this.props.shadow,borderRadius:this.props.radius},pointer:{position:"absolute",top:-(this.props.hsv.v*100)+100+"%",left:this.props.hsv.s*100+"%",cursor:"default"},circle:{width:"4px",height:"4px",boxShadow:`0 0 0 1.5px #fff, inset 0 0 1px 1px rgba(0,0,0,.3),
            0 0 1px 2px rgba(0,0,0,.4)`,borderRadius:"50%",cursor:"hand",transform:"translate(-2px, -2px)"}},custom:{color:i,white:a,black:l,pointer:c,circle:d}},{custom:!!this.props.style});return D.createElement("div",{style:u.color,ref:function(p){return r.container=p},onMouseDown:this.handleMouseDown,onTouchMove:this.handleChange,onTouchStart:this.handleChange},D.createElement("style",null,`
          .saturation-white {
            background: -webkit-linear-gradient(to right, #fff, rgba(255,255,255,0));
            background: linear-gradient(to right, #fff, rgba(255,255,255,0));
          }
          .saturation-black {
            background: -webkit-linear-gradient(to top, #000, rgba(0,0,0,0));
            background: linear-gradient(to top, #000, rgba(0,0,0,0));
          }
        `),D.createElement("div",{style:u.white,className:"saturation-white"},D.createElement("div",{style:u.black,className:"saturation-black"}),D.createElement("div",{style:u.pointer},this.props.pointer?D.createElement(this.props.pointer,this.props):D.createElement("div",{style:u.circle}))))}}]),e}(O.PureComponent||O.Component);function A7(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}var M7=o2(Object.keys,Object),$7=Object.prototype,D7=$7.hasOwnProperty;function L7(t){if(!Em(t))return M7(t);var e=[];for(var n in Object(t))D7.call(t,n)&&n!="constructor"&&e.push(n);return e}function Rm(t){return Ca(t)?h2(t):L7(t)}function I7(t,e){return t&&s2(t,e,Rm)}function z7(t,e){return function(n,r){if(n==null)return n;if(!Ca(n))return t(n,r);for(var s=n.length,i=-1,a=Object(n);++i<s&&r(a[i],i,a)!==!1;);return n}}var g2=z7(I7);function F7(t){return typeof t=="function"?t:bu}function B7(t,e){var n=xr(t)?A7:g2;return n(t,F7(e))}function Hd(t){"@babel/helpers - typeof";return Hd=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hd(t)}var H7=/^\s+/,U7=/\s+$/;function et(t,e){if(t=t||"",e=e||{},t instanceof et)return t;if(!(this instanceof et))return new et(t,e);var n=W7(t);this._originalInput=t,this._r=n.r,this._g=n.g,this._b=n.b,this._a=n.a,this._roundA=Math.round(100*this._a)/100,this._format=e.format||n.format,this._gradientType=e.gradientType,this._r<1&&(this._r=Math.round(this._r)),this._g<1&&(this._g=Math.round(this._g)),this._b<1&&(this._b=Math.round(this._b)),this._ok=n.ok}et.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(e.r*299+e.g*587+e.b*114)/1e3},getLuminance:function(){var e=this.toRgb(),n,r,s,i,a,l;return n=e.r/255,r=e.g/255,s=e.b/255,n<=.03928?i=n/12.92:i=Math.pow((n+.055)/1.055,2.4),r<=.03928?a=r/12.92:a=Math.pow((r+.055)/1.055,2.4),s<=.03928?l=s/12.92:l=Math.pow((s+.055)/1.055,2.4),.2126*i+.7152*a+.0722*l},setAlpha:function(e){return this._a=y2(e),this._roundA=Math.round(100*this._a)/100,this},toHsv:function(){var e=Wx(this._r,this._g,this._b);return{h:e.h*360,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=Wx(this._r,this._g,this._b),n=Math.round(e.h*360),r=Math.round(e.s*100),s=Math.round(e.v*100);return this._a==1?"hsv("+n+", "+r+"%, "+s+"%)":"hsva("+n+", "+r+"%, "+s+"%, "+this._roundA+")"},toHsl:function(){var e=Ux(this._r,this._g,this._b);return{h:e.h*360,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=Ux(this._r,this._g,this._b),n=Math.round(e.h*360),r=Math.round(e.s*100),s=Math.round(e.l*100);return this._a==1?"hsl("+n+", "+r+"%, "+s+"%)":"hsla("+n+", "+r+"%, "+s+"%, "+this._roundA+")"},toHex:function(e){return Gx(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return q7(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:Math.round(this._r),g:Math.round(this._g),b:Math.round(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+")":"rgba("+Math.round(this._r)+", "+Math.round(this._g)+", "+Math.round(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:Math.round(Xt(this._r,255)*100)+"%",g:Math.round(Xt(this._g,255)*100)+"%",b:Math.round(Xt(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+Math.round(Xt(this._r,255)*100)+"%, "+Math.round(Xt(this._g,255)*100)+"%, "+Math.round(Xt(this._b,255)*100)+"%)":"rgba("+Math.round(Xt(this._r,255)*100)+"%, "+Math.round(Xt(this._g,255)*100)+"%, "+Math.round(Xt(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:oU[Gx(this._r,this._g,this._b,!0)]||!1},toFilter:function(e){var n="#"+Vx(this._r,this._g,this._b,this._a),r=n,s=this._gradientType?"GradientType = 1, ":"";if(e){var i=et(e);r="#"+Vx(i._r,i._g,i._b,i._a)}return"progid:DXImageTransform.Microsoft.gradient("+s+"startColorstr="+n+",endColorstr="+r+")"},toString:function(e){var n=!!e;e=e||this._format;var r=!1,s=this._a<1&&this._a>=0,i=!n&&s&&(e==="hex"||e==="hex6"||e==="hex3"||e==="hex4"||e==="hex8"||e==="name");return i?e==="name"&&this._a===0?this.toName():this.toRgbString():(e==="rgb"&&(r=this.toRgbString()),e==="prgb"&&(r=this.toPercentageRgbString()),(e==="hex"||e==="hex6")&&(r=this.toHexString()),e==="hex3"&&(r=this.toHexString(!0)),e==="hex4"&&(r=this.toHex8String(!0)),e==="hex8"&&(r=this.toHex8String()),e==="name"&&(r=this.toName()),e==="hsl"&&(r=this.toHslString()),e==="hsv"&&(r=this.toHsvString()),r||this.toHexString())},clone:function(){return et(this.toString())},_applyModification:function(e,n){var r=e.apply(null,[this].concat([].slice.call(n)));return this._r=r._r,this._g=r._g,this._b=r._b,this.setAlpha(r._a),this},lighten:function(){return this._applyModification(J7,arguments)},brighten:function(){return this._applyModification(Q7,arguments)},darken:function(){return this._applyModification(eU,arguments)},desaturate:function(){return this._applyModification(X7,arguments)},saturate:function(){return this._applyModification(Z7,arguments)},greyscale:function(){return this._applyModification(K7,arguments)},spin:function(){return this._applyModification(tU,arguments)},_applyCombination:function(e,n){return e.apply(null,[this].concat([].slice.call(n)))},analogous:function(){return this._applyCombination(sU,arguments)},complement:function(){return this._applyCombination(nU,arguments)},monochromatic:function(){return this._applyCombination(iU,arguments)},splitcomplement:function(){return this._applyCombination(rU,arguments)},triad:function(){return this._applyCombination(Yx,[3])},tetrad:function(){return this._applyCombination(Yx,[4])}};et.fromRatio=function(t,e){if(Hd(t)=="object"){var n={};for(var r in t)t.hasOwnProperty(r)&&(r==="a"?n[r]=t[r]:n[r]=Za(t[r]));t=n}return et(t,e)};function W7(t){var e={r:0,g:0,b:0},n=1,r=null,s=null,i=null,a=!1,l=!1;return typeof t=="string"&&(t=dU(t)),Hd(t)=="object"&&(Cs(t.r)&&Cs(t.g)&&Cs(t.b)?(e=G7(t.r,t.g,t.b),a=!0,l=String(t.r).substr(-1)==="%"?"prgb":"rgb"):Cs(t.h)&&Cs(t.s)&&Cs(t.v)?(r=Za(t.s),s=Za(t.v),e=Y7(t.h,r,s),a=!0,l="hsv"):Cs(t.h)&&Cs(t.s)&&Cs(t.l)&&(r=Za(t.s),i=Za(t.l),e=V7(t.h,r,i),a=!0,l="hsl"),t.hasOwnProperty("a")&&(n=t.a)),n=y2(n),{ok:a,format:t.format||l,r:Math.min(255,Math.max(e.r,0)),g:Math.min(255,Math.max(e.g,0)),b:Math.min(255,Math.max(e.b,0)),a:n}}function G7(t,e,n){return{r:Xt(t,255)*255,g:Xt(e,255)*255,b:Xt(n,255)*255}}function Ux(t,e,n){t=Xt(t,255),e=Xt(e,255),n=Xt(n,255);var r=Math.max(t,e,n),s=Math.min(t,e,n),i,a,l=(r+s)/2;if(r==s)i=a=0;else{var c=r-s;switch(a=l>.5?c/(2-r-s):c/(r+s),r){case t:i=(e-n)/c+(e<n?6:0);break;case e:i=(n-t)/c+2;break;case n:i=(t-e)/c+4;break}i/=6}return{h:i,s:a,l}}function V7(t,e,n){var r,s,i;t=Xt(t,360),e=Xt(e,100),n=Xt(n,100);function a(d,u,h){return h<0&&(h+=1),h>1&&(h-=1),h<1/6?d+(u-d)*6*h:h<1/2?u:h<2/3?d+(u-d)*(2/3-h)*6:d}if(e===0)r=s=i=n;else{var l=n<.5?n*(1+e):n+e-n*e,c=2*n-l;r=a(c,l,t+1/3),s=a(c,l,t),i=a(c,l,t-1/3)}return{r:r*255,g:s*255,b:i*255}}function Wx(t,e,n){t=Xt(t,255),e=Xt(e,255),n=Xt(n,255);var r=Math.max(t,e,n),s=Math.min(t,e,n),i,a,l=r,c=r-s;if(a=r===0?0:c/r,r==s)i=0;else{switch(r){case t:i=(e-n)/c+(e<n?6:0);break;case e:i=(n-t)/c+2;break;case n:i=(t-e)/c+4;break}i/=6}return{h:i,s:a,v:l}}function Y7(t,e,n){t=Xt(t,360)*6,e=Xt(e,100),n=Xt(n,100);var r=Math.floor(t),s=t-r,i=n*(1-e),a=n*(1-s*e),l=n*(1-(1-s)*e),c=r%6,d=[n,a,i,i,l,n][c],u=[l,n,n,a,i,i][c],h=[i,i,l,n,n,a][c];return{r:d*255,g:u*255,b:h*255}}function Gx(t,e,n,r){var s=[Jr(Math.round(t).toString(16)),Jr(Math.round(e).toString(16)),Jr(Math.round(n).toString(16))];return r&&s[0].charAt(0)==s[0].charAt(1)&&s[1].charAt(0)==s[1].charAt(1)&&s[2].charAt(0)==s[2].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0):s.join("")}function q7(t,e,n,r,s){var i=[Jr(Math.round(t).toString(16)),Jr(Math.round(e).toString(16)),Jr(Math.round(n).toString(16)),Jr(x2(r))];return s&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)&&i[3].charAt(0)==i[3].charAt(1)?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0)+i[3].charAt(0):i.join("")}function Vx(t,e,n,r){var s=[Jr(x2(r)),Jr(Math.round(t).toString(16)),Jr(Math.round(e).toString(16)),Jr(Math.round(n).toString(16))];return s.join("")}et.equals=function(t,e){return!t||!e?!1:et(t).toRgbString()==et(e).toRgbString()};et.random=function(){return et.fromRatio({r:Math.random(),g:Math.random(),b:Math.random()})};function X7(t,e){e=e===0?0:e||10;var n=et(t).toHsl();return n.s-=e/100,n.s=ku(n.s),et(n)}function Z7(t,e){e=e===0?0:e||10;var n=et(t).toHsl();return n.s+=e/100,n.s=ku(n.s),et(n)}function K7(t){return et(t).desaturate(100)}function J7(t,e){e=e===0?0:e||10;var n=et(t).toHsl();return n.l+=e/100,n.l=ku(n.l),et(n)}function Q7(t,e){e=e===0?0:e||10;var n=et(t).toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(255*-(e/100)))),n.g=Math.max(0,Math.min(255,n.g-Math.round(255*-(e/100)))),n.b=Math.max(0,Math.min(255,n.b-Math.round(255*-(e/100)))),et(n)}function eU(t,e){e=e===0?0:e||10;var n=et(t).toHsl();return n.l-=e/100,n.l=ku(n.l),et(n)}function tU(t,e){var n=et(t).toHsl(),r=(n.h+e)%360;return n.h=r<0?360+r:r,et(n)}function nU(t){var e=et(t).toHsl();return e.h=(e.h+180)%360,et(e)}function Yx(t,e){if(isNaN(e)||e<=0)throw new Error("Argument to polyad must be a positive number");for(var n=et(t).toHsl(),r=[et(t)],s=360/e,i=1;i<e;i++)r.push(et({h:(n.h+i*s)%360,s:n.s,l:n.l}));return r}function rU(t){var e=et(t).toHsl(),n=e.h;return[et(t),et({h:(n+72)%360,s:e.s,l:e.l}),et({h:(n+216)%360,s:e.s,l:e.l})]}function sU(t,e,n){e=e||6,n=n||30;var r=et(t).toHsl(),s=360/n,i=[et(t)];for(r.h=(r.h-(s*e>>1)+720)%360;--e;)r.h=(r.h+s)%360,i.push(et(r));return i}function iU(t,e){e=e||6;for(var n=et(t).toHsv(),r=n.h,s=n.s,i=n.v,a=[],l=1/e;e--;)a.push(et({h:r,s,v:i})),i=(i+l)%1;return a}et.mix=function(t,e,n){n=n===0?0:n||50;var r=et(t).toRgb(),s=et(e).toRgb(),i=n/100,a={r:(s.r-r.r)*i+r.r,g:(s.g-r.g)*i+r.g,b:(s.b-r.b)*i+r.b,a:(s.a-r.a)*i+r.a};return et(a)};et.readability=function(t,e){var n=et(t),r=et(e);return(Math.max(n.getLuminance(),r.getLuminance())+.05)/(Math.min(n.getLuminance(),r.getLuminance())+.05)};et.isReadable=function(t,e,n){var r=et.readability(t,e),s,i;switch(i=!1,s=uU(n),s.level+s.size){case"AAsmall":case"AAAlarge":i=r>=4.5;break;case"AAlarge":i=r>=3;break;case"AAAsmall":i=r>=7;break}return i};et.mostReadable=function(t,e,n){var r=null,s=0,i,a,l,c;n=n||{},a=n.includeFallbackColors,l=n.level,c=n.size;for(var d=0;d<e.length;d++)i=et.readability(t,e[d]),i>s&&(s=i,r=et(e[d]));return et.isReadable(t,r,{level:l,size:c})||!a?r:(n.includeFallbackColors=!1,et.mostReadable(t,["#fff","#000"],n))};var Hp=et.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},oU=et.hexNames=aU(Hp);function aU(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[t[n]]=n);return e}function y2(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function Xt(t,e){lU(t)&&(t="100%");var n=cU(t);return t=Math.min(e,Math.max(0,parseFloat(t))),n&&(t=parseInt(t*e,10)/100),Math.abs(t-e)<1e-6?1:t%e/parseFloat(e)}function ku(t){return Math.min(1,Math.max(0,t))}function cr(t){return parseInt(t,16)}function lU(t){return typeof t=="string"&&t.indexOf(".")!=-1&&parseFloat(t)===1}function cU(t){return typeof t=="string"&&t.indexOf("%")!=-1}function Jr(t){return t.length==1?"0"+t:""+t}function Za(t){return t<=1&&(t=t*100+"%"),t}function x2(t){return Math.round(parseFloat(t)*255).toString(16)}function qx(t){return cr(t)/255}var Gr=function(){var t="[-\\+]?\\d+%?",e="[-\\+]?\\d*\\.\\d+%?",n="(?:"+e+")|(?:"+t+")",r="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?",s="[\\s|\\(]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")[,|\\s]+("+n+")\\s*\\)?";return{CSS_UNIT:new RegExp(n),rgb:new RegExp("rgb"+r),rgba:new RegExp("rgba"+s),hsl:new RegExp("hsl"+r),hsla:new RegExp("hsla"+s),hsv:new RegExp("hsv"+r),hsva:new RegExp("hsva"+s),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function Cs(t){return!!Gr.CSS_UNIT.exec(t)}function dU(t){t=t.replace(H7,"").replace(U7,"").toLowerCase();var e=!1;if(Hp[t])t=Hp[t],e=!0;else if(t=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var n;return(n=Gr.rgb.exec(t))?{r:n[1],g:n[2],b:n[3]}:(n=Gr.rgba.exec(t))?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=Gr.hsl.exec(t))?{h:n[1],s:n[2],l:n[3]}:(n=Gr.hsla.exec(t))?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=Gr.hsv.exec(t))?{h:n[1],s:n[2],v:n[3]}:(n=Gr.hsva.exec(t))?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=Gr.hex8.exec(t))?{r:cr(n[1]),g:cr(n[2]),b:cr(n[3]),a:qx(n[4]),format:e?"name":"hex8"}:(n=Gr.hex6.exec(t))?{r:cr(n[1]),g:cr(n[2]),b:cr(n[3]),format:e?"name":"hex"}:(n=Gr.hex4.exec(t))?{r:cr(n[1]+""+n[1]),g:cr(n[2]+""+n[2]),b:cr(n[3]+""+n[3]),a:qx(n[4]+""+n[4]),format:e?"name":"hex8"}:(n=Gr.hex3.exec(t))?{r:cr(n[1]+""+n[1]),g:cr(n[2]+""+n[2]),b:cr(n[3]+""+n[3]),format:e?"name":"hex"}:!1}function uU(t){var e,n;return t=t||{level:"AA",size:"small"},e=(t.level||"AA").toUpperCase(),n=(t.size||"small").toLowerCase(),e!=="AA"&&e!=="AAA"&&(e="AA"),n!=="small"&&n!=="large"&&(n="small"),{level:e,size:n}}var Xx=function(e){var n=["r","g","b","a","h","s","l","v"],r=0,s=0;return B7(n,function(i){if(e[i]&&(r+=1,isNaN(e[i])||(s+=1),i==="s"||i==="l")){var a=/^\d+%$/;a.test(e[i])&&(s+=1)}}),r===s?e:!1},Ka=function(e,n){var r=e.hex?et(e.hex):et(e),s=r.toHsl(),i=r.toHsv(),a=r.toRgb(),l=r.toHex();s.s===0&&(s.h=n||0,i.h=n||0);var c=l==="000000"&&a.a===0;return{hsl:s,hex:c?"transparent":"#"+l,rgb:a,hsv:i,oldHue:e.h||n||s.h,source:e.source}},vi=function(e){if(e==="transparent")return!0;var n=String(e).charAt(0)==="#"?1:0;return e.length!==4+n&&e.length<7+n&&et(e).isValid()},Om=function(e){if(!e)return"#fff";var n=Ka(e);if(n.hex==="transparent")return"rgba(0,0,0,0.4)";var r=(n.rgb.r*299+n.rgb.g*587+n.rgb.b*114)/1e3;return r>=128?"#000":"#fff"},Sh=function(e,n){var r=e.replace("","");return et(n+" ("+r+")")._ok},Ba=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},hU=function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function pU(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function fU(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function mU(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var rr=function(e){var n=function(r){mU(s,r);function s(i){pU(this,s);var a=fU(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return a.handleChange=function(l,c){var d=Xx(l);if(d){var u=Ka(l,l.h||a.state.oldHue);a.setState(u),a.props.onChangeComplete&&a.debounce(a.props.onChangeComplete,u,c),a.props.onChange&&a.props.onChange(u,c)}},a.handleSwatchHover=function(l,c){var d=Xx(l);if(d){var u=Ka(l,l.h||a.state.oldHue);a.props.onSwatchHover&&a.props.onSwatchHover(u,c)}},a.state=Ba({},Ka(i.color,0)),a.debounce=m2(function(l,c,d){l(c,d)},100),a}return hU(s,[{key:"render",value:function(){var a={};return this.props.onSwatchHover&&(a.onSwatchHover=this.handleSwatchHover),D.createElement(e,Ba({},this.props,this.state,{onChange:this.handleChange},a))}}],[{key:"getDerivedStateFromProps",value:function(a,l){return Ba({},Ka(a.color,l.oldHue))}}]),s}(O.PureComponent||O.Component);return n.propTypes=Ba({},e.propTypes),n.defaultProps=Ba({},e.defaultProps,{color:{h:250,s:.5,l:.2,a:1}}),n},gU=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},yU=function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function xU(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Zx(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function vU(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var bU=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"span";return function(r){vU(s,r);function s(){var i,a,l,c;xU(this,s);for(var d=arguments.length,u=Array(d),h=0;h<d;h++)u[h]=arguments[h];return c=(a=(l=Zx(this,(i=s.__proto__||Object.getPrototypeOf(s)).call.apply(i,[this].concat(u))),l),l.state={focus:!1},l.handleFocus=function(){return l.setState({focus:!0})},l.handleBlur=function(){return l.setState({focus:!1})},a),Zx(l,c)}return yU(s,[{key:"render",value:function(){return D.createElement(n,{onFocus:this.handleFocus,onBlur:this.handleBlur},D.createElement(e,gU({},this.props,this.state)))}}]),s}(D.Component)},Kx=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},wU=13,_U=function(e){var n=e.color,r=e.style,s=e.onClick,i=s===void 0?function(){}:s,a=e.onHover,l=e.title,c=l===void 0?n:l,d=e.children,u=e.focus,h=e.focusStyle,p=h===void 0?{}:h,f=n==="transparent",m=pt({default:{swatch:Kx({background:n,height:"100%",width:"100%",cursor:"pointer",position:"relative",outline:"none"},r,u?p:{})}}),y=function(b){return i(n,b)},v=function(b){return b.keyCode===wU&&i(n,b)},x=function(b){return a(n,b)},g={};return a&&(g.onMouseOver=x),D.createElement("div",Kx({style:m.swatch,onClick:y,title:c,tabIndex:0,onKeyDown:v},g),d,f&&D.createElement(Sa,{borderRadius:m.swatch.borderRadius,boxShadow:"inset 0 0 0 1px rgba(0,0,0,0.1)"}))};const Qi=bU(_U);var kU=function(e){var n=e.direction,r=pt({default:{picker:{width:"18px",height:"18px",borderRadius:"50%",transform:"translate(-9px, -1px)",backgroundColor:"rgb(248, 248, 248)",boxShadow:"0 1px 4px 0 rgba(0, 0, 0, 0.37)"}},vertical:{picker:{transform:"translate(-3px, -9px)"}}},{vertical:n==="vertical"});return D.createElement("div",{style:r.picker})},SU=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},v2=function(e){var n=e.rgb,r=e.hsl,s=e.width,i=e.height,a=e.onChange,l=e.direction,c=e.style,d=e.renderers,u=e.pointer,h=e.className,p=h===void 0?"":h,f=pt({default:{picker:{position:"relative",width:s,height:i},alpha:{radius:"2px",style:c}}});return D.createElement("div",{style:f.picker,className:"alpha-picker "+p},D.createElement(Sm,SU({},f.alpha,{rgb:n,hsl:r,pointer:u,renderers:d,onChange:a,direction:l})))};v2.defaultProps={width:"316px",height:"16px",direction:"horizontal",pointer:kU};rr(v2);function b2(t,e){for(var n=-1,r=t==null?0:t.length,s=Array(r);++n<r;)s[n]=e(t[n],n,t);return s}var jU="__lodash_hash_undefined__";function CU(t){return this.__data__.set(t,jU),this}function EU(t){return this.__data__.has(t)}function Ud(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new Bs;++e<n;)this.add(t[e])}Ud.prototype.add=Ud.prototype.push=CU;Ud.prototype.has=EU;function TU(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function NU(t,e){return t.has(e)}var PU=1,RU=2;function w2(t,e,n,r,s,i){var a=n&PU,l=t.length,c=e.length;if(l!=c&&!(a&&c>l))return!1;var d=i.get(t),u=i.get(e);if(d&&u)return d==e&&u==t;var h=-1,p=!0,f=n&RU?new Ud:void 0;for(i.set(t,e),i.set(e,t);++h<l;){var m=t[h],y=e[h];if(r)var v=a?r(y,m,h,e,t,i):r(m,y,h,t,e,i);if(v!==void 0){if(v)continue;p=!1;break}if(f){if(!TU(e,function(x,g){if(!NU(f,g)&&(m===x||s(m,x,n,r,i)))return f.push(g)})){p=!1;break}}else if(!(m===y||s(m,y,n,r,i))){p=!1;break}}return i.delete(t),i.delete(e),p}function OU(t){var e=-1,n=Array(t.size);return t.forEach(function(r,s){n[++e]=[s,r]}),n}function AU(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var MU=1,$U=2,DU="[object Boolean]",LU="[object Date]",IU="[object Error]",zU="[object Map]",FU="[object Number]",BU="[object RegExp]",HU="[object Set]",UU="[object String]",WU="[object Symbol]",GU="[object ArrayBuffer]",VU="[object DataView]",Jx=pi?pi.prototype:void 0,jh=Jx?Jx.valueOf:void 0;function YU(t,e,n,r,s,i,a){switch(n){case VU:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case GU:return!(t.byteLength!=e.byteLength||!i(new zd(t),new zd(e)));case DU:case LU:case FU:return Zl(+t,+e);case IU:return t.name==e.name&&t.message==e.message;case BU:case UU:return t==e+"";case zU:var l=OU;case HU:var c=r&MU;if(l||(l=AU),t.size!=e.size&&!c)return!1;var d=a.get(t);if(d)return d==e;r|=$U,a.set(t,e);var u=w2(l(t),l(e),r,s,i,a);return a.delete(t),u;case WU:if(jh)return jh.call(t)==jh.call(e)}return!1}function qU(t,e){for(var n=-1,r=e.length,s=t.length;++n<r;)t[s+n]=e[n];return t}function XU(t,e,n){var r=e(t);return xr(t)?r:qU(r,n(t))}function ZU(t,e){for(var n=-1,r=t==null?0:t.length,s=0,i=[];++n<r;){var a=t[n];e(a,n,t)&&(i[s++]=a)}return i}function KU(){return[]}var JU=Object.prototype,QU=JU.propertyIsEnumerable,Qx=Object.getOwnPropertySymbols,eW=Qx?function(t){return t==null?[]:(t=Object(t),ZU(Qx(t),function(e){return QU.call(t,e)}))}:KU;function ev(t){return XU(t,Rm,eW)}var tW=1,nW=Object.prototype,rW=nW.hasOwnProperty;function sW(t,e,n,r,s,i){var a=n&tW,l=ev(t),c=l.length,d=ev(e),u=d.length;if(c!=u&&!a)return!1;for(var h=c;h--;){var p=l[h];if(!(a?p in e:rW.call(e,p)))return!1}var f=i.get(t),m=i.get(e);if(f&&m)return f==e&&m==t;var y=!0;i.set(t,e),i.set(e,t);for(var v=a;++h<c;){p=l[h];var x=t[p],g=e[p];if(r)var w=a?r(g,x,p,e,t,i):r(x,g,p,t,e,i);if(!(w===void 0?x===g||s(x,g,n,r,i):w)){y=!1;break}v||(v=p=="constructor")}if(y&&!v){var b=t.constructor,k=e.constructor;b!=k&&"constructor"in t&&"constructor"in e&&!(typeof b=="function"&&b instanceof b&&typeof k=="function"&&k instanceof k)&&(y=!1)}return i.delete(t),i.delete(e),y}var Up=Ji(rs,"DataView"),Wp=Ji(rs,"Promise"),Gp=Ji(rs,"Set"),Vp=Ji(rs,"WeakMap"),tv="[object Map]",iW="[object Object]",nv="[object Promise]",rv="[object Set]",sv="[object WeakMap]",iv="[object DataView]",oW=Ki(Up),aW=Ki(Al),lW=Ki(Wp),cW=Ki(Gp),dW=Ki(Vp),Xs=Zi;(Up&&Xs(new Up(new ArrayBuffer(1)))!=iv||Al&&Xs(new Al)!=tv||Wp&&Xs(Wp.resolve())!=nv||Gp&&Xs(new Gp)!=rv||Vp&&Xs(new Vp)!=sv)&&(Xs=function(t){var e=Zi(t),n=e==iW?t.constructor:void 0,r=n?Ki(n):"";if(r)switch(r){case oW:return iv;case aW:return tv;case lW:return nv;case cW:return rv;case dW:return sv}return e});var uW=1,ov="[object Arguments]",av="[object Array]",zc="[object Object]",hW=Object.prototype,lv=hW.hasOwnProperty;function pW(t,e,n,r,s,i){var a=xr(t),l=xr(e),c=a?av:Xs(t),d=l?av:Xs(e);c=c==ov?zc:c,d=d==ov?zc:d;var u=c==zc,h=d==zc,p=c==d;if(p&&Bd(t)){if(!Bd(e))return!1;a=!0,u=!1}if(p&&!u)return i||(i=new ys),a||Nm(t)?w2(t,e,n,r,s,i):YU(t,e,c,n,r,s,i);if(!(n&uW)){var f=u&&lv.call(t,"__wrapped__"),m=h&&lv.call(e,"__wrapped__");if(f||m){var y=f?t.value():t,v=m?e.value():e;return i||(i=new ys),s(y,v,n,r,i)}}return p?(i||(i=new ys),sW(t,e,n,r,s,i)):!1}function Am(t,e,n,r,s){return t===e?!0:t==null||e==null||!fi(t)&&!fi(e)?t!==t&&e!==e:pW(t,e,n,r,Am,s)}var fW=1,mW=2;function gW(t,e,n,r){var s=n.length,i=s;if(t==null)return!i;for(t=Object(t);s--;){var a=n[s];if(a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++s<i;){a=n[s];var l=a[0],c=t[l],d=a[1];if(a[2]){if(c===void 0&&!(l in t))return!1}else{var u=new ys,h;if(!(h===void 0?Am(d,c,fW|mW,r,u):h))return!1}}return!0}function _2(t){return t===t&&!Mr(t)}function yW(t){for(var e=Rm(t),n=e.length;n--;){var r=e[n],s=t[r];e[n]=[r,s,_2(s)]}return e}function k2(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function xW(t){var e=yW(t);return e.length==1&&e[0][2]?k2(e[0][0],e[0][1]):function(n){return n===t||gW(n,t,e)}}var vW=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,bW=/^\w*$/;function Mm(t,e){if(xr(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||wu(t)?!0:bW.test(t)||!vW.test(t)||e!=null&&t in Object(e)}var wW="Expected a function";function $m(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(wW);var n=function(){var r=arguments,s=e?e.apply(this,r):r[0],i=n.cache;if(i.has(s))return i.get(s);var a=t.apply(this,r);return n.cache=i.set(s,a)||i,a};return n.cache=new($m.Cache||Bs),n}$m.Cache=Bs;var _W=500;function kW(t){var e=$m(t,function(r){return n.size===_W&&n.clear(),r}),n=e.cache;return e}var SW=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,jW=/\\(\\)?/g,CW=kW(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(SW,function(n,r,s,i){e.push(s?i.replace(jW,"$1"):r||n)}),e}),cv=pi?pi.prototype:void 0,dv=cv?cv.toString:void 0;function S2(t){if(typeof t=="string")return t;if(xr(t))return b2(t,S2)+"";if(wu(t))return dv?dv.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function EW(t){return t==null?"":S2(t)}function j2(t,e){return xr(t)?t:Mm(t,e)?[t]:CW(EW(t))}function Su(t){if(typeof t=="string"||wu(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function C2(t,e){e=j2(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[Su(e[n++])];return n&&n==r?t:void 0}function TW(t,e,n){var r=t==null?void 0:C2(t,e);return r===void 0?n:r}function NW(t,e){return t!=null&&e in Object(t)}function PW(t,e,n){e=j2(e,t);for(var r=-1,s=e.length,i=!1;++r<s;){var a=Su(e[r]);if(!(i=t!=null&&n(t,a)))break;t=t[a]}return i||++r!=s?i:(s=t==null?0:t.length,!!s&&Tm(s)&&Pm(a,s)&&(xr(t)||Fd(t)))}function RW(t,e){return t!=null&&PW(t,e,NW)}var OW=1,AW=2;function MW(t,e){return Mm(t)&&_2(e)?k2(Su(t),e):function(n){var r=TW(n,t);return r===void 0&&r===e?RW(n,t):Am(e,r,OW|AW)}}function $W(t){return function(e){return e==null?void 0:e[t]}}function DW(t){return function(e){return C2(e,t)}}function LW(t){return Mm(t)?$W(Su(t)):DW(t)}function IW(t){return typeof t=="function"?t:t==null?bu:typeof t=="object"?xr(t)?MW(t[0],t[1]):xW(t):LW(t)}function zW(t,e){var n=-1,r=Ca(t)?Array(t.length):[];return g2(t,function(s,i,a){r[++n]=e(s,i,a)}),r}function eo(t,e){var n=xr(t)?b2:zW;return n(t,IW(e))}var FW=function(e){var n=e.colors,r=e.onClick,s=e.onSwatchHover,i=pt({default:{swatches:{marginRight:"-10px"},swatch:{width:"22px",height:"22px",float:"left",marginRight:"10px",marginBottom:"10px",borderRadius:"4px"},clear:{clear:"both"}}});return D.createElement("div",{style:i.swatches},eo(n,function(a){return D.createElement(Qi,{key:a,color:a,style:i.swatch,onClick:r,onHover:s,focusStyle:{boxShadow:"0 0 4px "+a}})}),D.createElement("div",{style:i.clear}))},Dm=function(e){var n=e.onChange,r=e.onSwatchHover,s=e.hex,i=e.colors,a=e.width,l=e.triangle,c=e.styles,d=c===void 0?{}:c,u=e.className,h=u===void 0?"":u,p=s==="transparent",f=function(v,x){vi(v)&&n({hex:v,source:"hex"},x)},m=pt(nr({default:{card:{width:a,background:"#fff",boxShadow:"0 1px rgba(0,0,0,.1)",borderRadius:"6px",position:"relative"},head:{height:"110px",background:s,borderRadius:"6px 6px 0 0",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},body:{padding:"10px"},label:{fontSize:"18px",color:Om(s),position:"relative"},triangle:{width:"0px",height:"0px",borderStyle:"solid",borderWidth:"0 10px 10px 10px",borderColor:"transparent transparent "+s+" transparent",position:"absolute",top:"-10px",left:"50%",marginLeft:"-10px"},input:{width:"100%",fontSize:"12px",color:"#666",border:"0px",outline:"none",height:"22px",boxShadow:"inset 0 0 0 1px #ddd",borderRadius:"4px",padding:"0 7px",boxSizing:"border-box"}},"hide-triangle":{triangle:{display:"none"}}},d),{"hide-triangle":l==="hide"});return D.createElement("div",{style:m.card,className:"block-picker "+h},D.createElement("div",{style:m.triangle}),D.createElement("div",{style:m.head},p&&D.createElement(Sa,{borderRadius:"6px 6px 0 0"}),D.createElement("div",{style:m.label},s)),D.createElement("div",{style:m.body},D.createElement(FW,{colors:i,onClick:f,onSwatchHover:r}),D.createElement(kt,{style:{input:m.input},value:s,onChange:f})))};Dm.propTypes={width:Le.oneOfType([Le.string,Le.number]),colors:Le.arrayOf(Le.string),triangle:Le.oneOf(["top","hide"]),styles:Le.object};Dm.defaultProps={width:170,colors:["#D9E3F0","#F47373","#697689","#37D67A","#2CCCE4","#555555","#dce775","#ff8a65","#ba68c8"],triangle:"top",styles:{}};rr(Dm);var mo={100:"#ffcdd2",300:"#e57373",500:"#f44336",700:"#d32f2f",900:"#b71c1c"},go={100:"#f8bbd0",300:"#f06292",500:"#e91e63",700:"#c2185b",900:"#880e4f"},yo={100:"#e1bee7",300:"#ba68c8",500:"#9c27b0",700:"#7b1fa2",900:"#4a148c"},xo={100:"#d1c4e9",300:"#9575cd",500:"#673ab7",700:"#512da8",900:"#311b92"},vo={100:"#c5cae9",300:"#7986cb",500:"#3f51b5",700:"#303f9f",900:"#1a237e"},bo={100:"#bbdefb",300:"#64b5f6",500:"#2196f3",700:"#1976d2",900:"#0d47a1"},wo={100:"#b3e5fc",300:"#4fc3f7",500:"#03a9f4",700:"#0288d1",900:"#01579b"},_o={100:"#b2ebf2",300:"#4dd0e1",500:"#00bcd4",700:"#0097a7",900:"#006064"},ko={100:"#b2dfdb",300:"#4db6ac",500:"#009688",700:"#00796b",900:"#004d40"},Ja={100:"#c8e6c9",300:"#81c784",500:"#4caf50",700:"#388e3c"},So={100:"#dcedc8",300:"#aed581",500:"#8bc34a",700:"#689f38",900:"#33691e"},jo={100:"#f0f4c3",300:"#dce775",500:"#cddc39",700:"#afb42b",900:"#827717"},Co={100:"#fff9c4",300:"#fff176",500:"#ffeb3b",700:"#fbc02d",900:"#f57f17"},Eo={100:"#ffecb3",300:"#ffd54f",500:"#ffc107",700:"#ffa000",900:"#ff6f00"},To={100:"#ffe0b2",300:"#ffb74d",500:"#ff9800",700:"#f57c00",900:"#e65100"},No={100:"#ffccbc",300:"#ff8a65",500:"#ff5722",700:"#e64a19",900:"#bf360c"},Po={100:"#d7ccc8",300:"#a1887f",500:"#795548",700:"#5d4037",900:"#3e2723"},Ro={100:"#cfd8dc",300:"#90a4ae",500:"#607d8b",700:"#455a64",900:"#263238"},E2=function(e){var n=e.color,r=e.onClick,s=e.onSwatchHover,i=e.hover,a=e.active,l=e.circleSize,c=e.circleSpacing,d=pt({default:{swatch:{width:l,height:l,marginRight:c,marginBottom:c,transform:"scale(1)",transition:"100ms transform ease"},Swatch:{borderRadius:"50%",background:"transparent",boxShadow:"inset 0 0 0 "+(l/2+1)+"px "+n,transition:"100ms box-shadow ease"}},hover:{swatch:{transform:"scale(1.2)"}},active:{Swatch:{boxShadow:"inset 0 0 0 3px "+n}}},{hover:i,active:a});return D.createElement("div",{style:d.swatch},D.createElement(Qi,{style:d.Swatch,color:n,onClick:r,onHover:s,focusStyle:{boxShadow:d.Swatch.boxShadow+", 0 0 5px "+n}}))};E2.defaultProps={circleSize:28,circleSpacing:14};const BW=km(E2);var Lm=function(e){var n=e.width,r=e.onChange,s=e.onSwatchHover,i=e.colors,a=e.hex,l=e.circleSize,c=e.styles,d=c===void 0?{}:c,u=e.circleSpacing,h=e.className,p=h===void 0?"":h,f=pt(nr({default:{card:{width:n,display:"flex",flexWrap:"wrap",marginRight:-u,marginBottom:-u}}},d)),m=function(v,x){return r({hex:v,source:"hex"},x)};return D.createElement("div",{style:f.card,className:"circle-picker "+p},eo(i,function(y){return D.createElement(BW,{key:y,color:y,onClick:m,onSwatchHover:s,active:a===y.toLowerCase(),circleSize:l,circleSpacing:u})}))};Lm.propTypes={width:Le.oneOfType([Le.string,Le.number]),circleSize:Le.number,circleSpacing:Le.number,styles:Le.object};Lm.defaultProps={width:252,circleSize:28,circleSpacing:14,colors:[mo[500],go[500],yo[500],xo[500],vo[500],bo[500],wo[500],_o[500],ko[500],Ja[500],So[500],jo[500],Co[500],Eo[500],To[500],No[500],Po[500],Ro[500]],styles:{}};rr(Lm);function uv(t){return t===void 0}var T2={};Object.defineProperty(T2,"__esModule",{value:!0});var hv=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},HW=O,pv=UW(HW);function UW(t){return t&&t.__esModule?t:{default:t}}function WW(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}var Fc=24,GW=T2.default=function(t){var e=t.fill,n=e===void 0?"currentColor":e,r=t.width,s=r===void 0?Fc:r,i=t.height,a=i===void 0?Fc:i,l=t.style,c=l===void 0?{}:l,d=WW(t,["fill","width","height","style"]);return pv.default.createElement("svg",hv({viewBox:"0 0 "+Fc+" "+Fc,style:hv({fill:n,width:s,height:a},c)},d),pv.default.createElement("path",{d:"M12,18.17L8.83,15L7.42,16.41L12,21L16.59,16.41L15.17,15M12,5.83L15.17,9L16.58,7.59L12,3L7.41,7.59L8.83,9L12,5.83Z"}))},VW=function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function YW(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function qW(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function XW(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var N2=function(t){XW(e,t);function e(n){YW(this,e);var r=qW(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.toggleViews=function(){r.state.view==="hex"?r.setState({view:"rgb"}):r.state.view==="rgb"?r.setState({view:"hsl"}):r.state.view==="hsl"&&(r.props.hsl.a===1?r.setState({view:"hex"}):r.setState({view:"rgb"}))},r.handleChange=function(s,i){s.hex?vi(s.hex)&&r.props.onChange({hex:s.hex,source:"hex"},i):s.r||s.g||s.b?r.props.onChange({r:s.r||r.props.rgb.r,g:s.g||r.props.rgb.g,b:s.b||r.props.rgb.b,source:"rgb"},i):s.a?(s.a<0?s.a=0:s.a>1&&(s.a=1),r.props.onChange({h:r.props.hsl.h,s:r.props.hsl.s,l:r.props.hsl.l,a:Math.round(s.a*100)/100,source:"rgb"},i)):(s.h||s.s||s.l)&&(typeof s.s=="string"&&s.s.includes("%")&&(s.s=s.s.replace("%","")),typeof s.l=="string"&&s.l.includes("%")&&(s.l=s.l.replace("%","")),s.s==1?s.s=.01:s.l==1&&(s.l=.01),r.props.onChange({h:s.h||r.props.hsl.h,s:Number(uv(s.s)?r.props.hsl.s:s.s),l:Number(uv(s.l)?r.props.hsl.l:s.l),source:"hsl"},i))},r.showHighlight=function(s){s.currentTarget.style.background="#eee"},r.hideHighlight=function(s){s.currentTarget.style.background="transparent"},n.hsl.a!==1&&n.view==="hex"?r.state={view:"rgb"}:r.state={view:n.view},r}return VW(e,[{key:"render",value:function(){var r=this,s=pt({default:{wrap:{paddingTop:"16px",display:"flex"},fields:{flex:"1",display:"flex",marginLeft:"-6px"},field:{paddingLeft:"6px",width:"100%"},alpha:{paddingLeft:"6px",width:"100%"},toggle:{width:"32px",textAlign:"right",position:"relative"},icon:{marginRight:"-4px",marginTop:"12px",cursor:"pointer",position:"relative"},iconHighlight:{position:"absolute",width:"24px",height:"28px",background:"#eee",borderRadius:"4px",top:"10px",left:"12px",display:"none"},input:{fontSize:"11px",color:"#333",width:"100%",borderRadius:"2px",border:"none",boxShadow:"inset 0 0 0 1px #dadada",height:"21px",textAlign:"center"},label:{textTransform:"uppercase",fontSize:"11px",lineHeight:"11px",color:"#969696",textAlign:"center",display:"block",marginTop:"12px"},svg:{fill:"#333",width:"24px",height:"24px",border:"1px transparent solid",borderRadius:"5px"}},disableAlpha:{alpha:{display:"none"}}},this.props,this.state),i=void 0;return this.state.view==="hex"?i=D.createElement("div",{style:s.fields,className:"flexbox-fix"},D.createElement("div",{style:s.field},D.createElement(kt,{style:{input:s.input,label:s.label},label:"hex",value:this.props.hex,onChange:this.handleChange}))):this.state.view==="rgb"?i=D.createElement("div",{style:s.fields,className:"flexbox-fix"},D.createElement("div",{style:s.field},D.createElement(kt,{style:{input:s.input,label:s.label},label:"r",value:this.props.rgb.r,onChange:this.handleChange})),D.createElement("div",{style:s.field},D.createElement(kt,{style:{input:s.input,label:s.label},label:"g",value:this.props.rgb.g,onChange:this.handleChange})),D.createElement("div",{style:s.field},D.createElement(kt,{style:{input:s.input,label:s.label},label:"b",value:this.props.rgb.b,onChange:this.handleChange})),D.createElement("div",{style:s.alpha},D.createElement(kt,{style:{input:s.input,label:s.label},label:"a",value:this.props.rgb.a,arrowOffset:.01,onChange:this.handleChange}))):this.state.view==="hsl"&&(i=D.createElement("div",{style:s.fields,className:"flexbox-fix"},D.createElement("div",{style:s.field},D.createElement(kt,{style:{input:s.input,label:s.label},label:"h",value:Math.round(this.props.hsl.h),onChange:this.handleChange})),D.createElement("div",{style:s.field},D.createElement(kt,{style:{input:s.input,label:s.label},label:"s",value:Math.round(this.props.hsl.s*100)+"%",onChange:this.handleChange})),D.createElement("div",{style:s.field},D.createElement(kt,{style:{input:s.input,label:s.label},label:"l",value:Math.round(this.props.hsl.l*100)+"%",onChange:this.handleChange})),D.createElement("div",{style:s.alpha},D.createElement(kt,{style:{input:s.input,label:s.label},label:"a",value:this.props.hsl.a,arrowOffset:.01,onChange:this.handleChange})))),D.createElement("div",{style:s.wrap,className:"flexbox-fix"},i,D.createElement("div",{style:s.toggle},D.createElement("div",{style:s.icon,onClick:this.toggleViews,ref:function(l){return r.icon=l}},D.createElement(GW,{style:s.svg,onMouseOver:this.showHighlight,onMouseEnter:this.showHighlight,onMouseOut:this.hideHighlight}))))}}],[{key:"getDerivedStateFromProps",value:function(r,s){return r.hsl.a!==1&&s.view==="hex"?{view:"rgb"}:null}}]),e}(D.Component);N2.defaultProps={view:"hex"};var fv=function(){var e=pt({default:{picker:{width:"12px",height:"12px",borderRadius:"6px",transform:"translate(-6px, -1px)",backgroundColor:"rgb(248, 248, 248)",boxShadow:"0 1px 4px 0 rgba(0, 0, 0, 0.37)"}}});return D.createElement("div",{style:e.picker})},ZW=function(){var e=pt({default:{picker:{width:"12px",height:"12px",borderRadius:"6px",boxShadow:"inset 0 0 0 1px #fff",transform:"translate(-6px, -6px)"}}});return D.createElement("div",{style:e.picker})},Im=function(e){var n=e.width,r=e.onChange,s=e.disableAlpha,i=e.rgb,a=e.hsl,l=e.hsv,c=e.hex,d=e.renderers,u=e.styles,h=u===void 0?{}:u,p=e.className,f=p===void 0?"":p,m=e.defaultView,y=pt(nr({default:{picker:{width:n,background:"#fff",borderRadius:"2px",boxShadow:"0 0 2px rgba(0,0,0,.3), 0 4px 8px rgba(0,0,0,.3)",boxSizing:"initial",fontFamily:"Menlo"},saturation:{width:"100%",paddingBottom:"55%",position:"relative",borderRadius:"2px 2px 0 0",overflow:"hidden"},Saturation:{radius:"2px 2px 0 0"},body:{padding:"16px 16px 12px"},controls:{display:"flex"},color:{width:"32px"},swatch:{marginTop:"6px",width:"16px",height:"16px",borderRadius:"8px",position:"relative",overflow:"hidden"},active:{absolute:"0px 0px 0px 0px",borderRadius:"8px",boxShadow:"inset 0 0 0 1px rgba(0,0,0,.1)",background:"rgba("+i.r+", "+i.g+", "+i.b+", "+i.a+")",zIndex:"2"},toggles:{flex:"1"},hue:{height:"10px",position:"relative",marginBottom:"8px"},Hue:{radius:"2px"},alpha:{height:"10px",position:"relative"},Alpha:{radius:"2px"}},disableAlpha:{color:{width:"22px"},alpha:{display:"none"},hue:{marginBottom:"0px"},swatch:{width:"10px",height:"10px",marginTop:"0px"}}},h),{disableAlpha:s});return D.createElement("div",{style:y.picker,className:"chrome-picker "+f},D.createElement("div",{style:y.saturation},D.createElement(_u,{style:y.Saturation,hsl:a,hsv:l,pointer:ZW,onChange:r})),D.createElement("div",{style:y.body},D.createElement("div",{style:y.controls,className:"flexbox-fix"},D.createElement("div",{style:y.color},D.createElement("div",{style:y.swatch},D.createElement("div",{style:y.active}),D.createElement(Sa,{renderers:d}))),D.createElement("div",{style:y.toggles},D.createElement("div",{style:y.hue},D.createElement(ja,{style:y.Hue,hsl:a,pointer:fv,onChange:r})),D.createElement("div",{style:y.alpha},D.createElement(Sm,{style:y.Alpha,rgb:i,hsl:a,pointer:fv,renderers:d,onChange:r})))),D.createElement(N2,{rgb:i,hsl:a,hex:c,view:m,onChange:r,disableAlpha:s})))};Im.propTypes={width:Le.oneOfType([Le.string,Le.number]),disableAlpha:Le.bool,styles:Le.object,defaultView:Le.oneOf(["hex","rgb","hsl"])};Im.defaultProps={width:225,disableAlpha:!1,styles:{}};rr(Im);var KW=function(e){var n=e.color,r=e.onClick,s=r===void 0?function(){}:r,i=e.onSwatchHover,a=e.active,l=pt({default:{color:{background:n,width:"15px",height:"15px",float:"left",marginRight:"5px",marginBottom:"5px",position:"relative",cursor:"pointer"},dot:{absolute:"5px 5px 5px 5px",background:Om(n),borderRadius:"50%",opacity:"0"}},active:{dot:{opacity:"1"}},"color-#FFFFFF":{color:{boxShadow:"inset 0 0 0 1px #ddd"},dot:{background:"#000"}},transparent:{dot:{background:"#000"}}},{active:a,"color-#FFFFFF":n==="#FFFFFF",transparent:n==="transparent"});return D.createElement(Qi,{style:l.color,color:n,onClick:s,onHover:i,focusStyle:{boxShadow:"0 0 4px "+n}},D.createElement("div",{style:l.dot}))},JW=function(e){var n=e.hex,r=e.rgb,s=e.onChange,i=pt({default:{fields:{display:"flex",paddingBottom:"6px",paddingRight:"5px",position:"relative"},active:{position:"absolute",top:"6px",left:"5px",height:"9px",width:"9px",background:n},HEXwrap:{flex:"6",position:"relative"},HEXinput:{width:"80%",padding:"0px",paddingLeft:"20%",border:"none",outline:"none",background:"none",fontSize:"12px",color:"#333",height:"16px"},HEXlabel:{display:"none"},RGBwrap:{flex:"3",position:"relative"},RGBinput:{width:"70%",padding:"0px",paddingLeft:"30%",border:"none",outline:"none",background:"none",fontSize:"12px",color:"#333",height:"16px"},RGBlabel:{position:"absolute",top:"3px",left:"0px",lineHeight:"16px",textTransform:"uppercase",fontSize:"12px",color:"#999"}}}),a=function(c,d){c.r||c.g||c.b?s({r:c.r||r.r,g:c.g||r.g,b:c.b||r.b,source:"rgb"},d):s({hex:c.hex,source:"hex"},d)};return D.createElement("div",{style:i.fields,className:"flexbox-fix"},D.createElement("div",{style:i.active}),D.createElement(kt,{style:{wrap:i.HEXwrap,input:i.HEXinput,label:i.HEXlabel},label:"hex",value:n,onChange:a}),D.createElement(kt,{style:{wrap:i.RGBwrap,input:i.RGBinput,label:i.RGBlabel},label:"r",value:r.r,onChange:a}),D.createElement(kt,{style:{wrap:i.RGBwrap,input:i.RGBinput,label:i.RGBlabel},label:"g",value:r.g,onChange:a}),D.createElement(kt,{style:{wrap:i.RGBwrap,input:i.RGBinput,label:i.RGBlabel},label:"b",value:r.b,onChange:a}))},zm=function(e){var n=e.onChange,r=e.onSwatchHover,s=e.colors,i=e.hex,a=e.rgb,l=e.styles,c=l===void 0?{}:l,d=e.className,u=d===void 0?"":d,h=pt(nr({default:{Compact:{background:"#f6f6f6",radius:"4px"},compact:{paddingTop:"5px",paddingLeft:"5px",boxSizing:"initial",width:"240px"},clear:{clear:"both"}}},c)),p=function(m,y){m.hex?vi(m.hex)&&n({hex:m.hex,source:"hex"},y):n(m,y)};return D.createElement(Kl,{style:h.Compact,styles:c},D.createElement("div",{style:h.compact,className:"compact-picker "+u},D.createElement("div",null,eo(s,function(f){return D.createElement(KW,{key:f,color:f,active:f.toLowerCase()===i,onClick:p,onSwatchHover:r})}),D.createElement("div",{style:h.clear})),D.createElement(JW,{hex:i,rgb:a,onChange:p})))};zm.propTypes={colors:Le.arrayOf(Le.string),styles:Le.object};zm.defaultProps={colors:["#4D4D4D","#999999","#FFFFFF","#F44E3B","#FE9200","#FCDC00","#DBDF00","#A4DD00","#68CCCA","#73D8FF","#AEA1FF","#FDA1FF","#333333","#808080","#cccccc","#D33115","#E27300","#FCC400","#B0BC00","#68BC00","#16A5A5","#009CE0","#7B64FF","#FA28FF","#000000","#666666","#B3B3B3","#9F0500","#C45100","#FB9E00","#808900","#194D33","#0C797D","#0062B1","#653294","#AB149E"],styles:{}};rr(zm);var QW=function(e){var n=e.hover,r=e.color,s=e.onClick,i=e.onSwatchHover,a={position:"relative",zIndex:"2",outline:"2px solid #fff",boxShadow:"0 0 5px 2px rgba(0,0,0,0.25)"},l=pt({default:{swatch:{width:"25px",height:"25px",fontSize:"0"}},hover:{swatch:a}},{hover:n});return D.createElement("div",{style:l.swatch},D.createElement(Qi,{color:r,onClick:s,onHover:i,focusStyle:a}))};const e9=km(QW);var Fm=function(e){var n=e.width,r=e.colors,s=e.onChange,i=e.onSwatchHover,a=e.triangle,l=e.styles,c=l===void 0?{}:l,d=e.className,u=d===void 0?"":d,h=pt(nr({default:{card:{width:n,background:"#fff",border:"1px solid rgba(0,0,0,0.2)",boxShadow:"0 3px 12px rgba(0,0,0,0.15)",borderRadius:"4px",position:"relative",padding:"5px",display:"flex",flexWrap:"wrap"},triangle:{position:"absolute",border:"7px solid transparent",borderBottomColor:"#fff"},triangleShadow:{position:"absolute",border:"8px solid transparent",borderBottomColor:"rgba(0,0,0,0.15)"}},"hide-triangle":{triangle:{display:"none"},triangleShadow:{display:"none"}},"top-left-triangle":{triangle:{top:"-14px",left:"10px"},triangleShadow:{top:"-16px",left:"9px"}},"top-right-triangle":{triangle:{top:"-14px",right:"10px"},triangleShadow:{top:"-16px",right:"9px"}},"bottom-left-triangle":{triangle:{top:"35px",left:"10px",transform:"rotate(180deg)"},triangleShadow:{top:"37px",left:"9px",transform:"rotate(180deg)"}},"bottom-right-triangle":{triangle:{top:"35px",right:"10px",transform:"rotate(180deg)"},triangleShadow:{top:"37px",right:"9px",transform:"rotate(180deg)"}}},c),{"hide-triangle":a==="hide","top-left-triangle":a==="top-left","top-right-triangle":a==="top-right","bottom-left-triangle":a==="bottom-left","bottom-right-triangle":a==="bottom-right"}),p=function(m,y){return s({hex:m,source:"hex"},y)};return D.createElement("div",{style:h.card,className:"github-picker "+u},D.createElement("div",{style:h.triangleShadow}),D.createElement("div",{style:h.triangle}),eo(r,function(f){return D.createElement(e9,{color:f,key:f,onClick:p,onSwatchHover:i})}))};Fm.propTypes={width:Le.oneOfType([Le.string,Le.number]),colors:Le.arrayOf(Le.string),triangle:Le.oneOf(["hide","top-left","top-right","bottom-left","bottom-right"]),styles:Le.object};Fm.defaultProps={width:200,colors:["#B80000","#DB3E00","#FCCB00","#008B02","#006B76","#1273DE","#004DCF","#5300EB","#EB9694","#FAD0C3","#FEF3BD","#C1E1C5","#BEDADC","#C4DEF6","#BED3F3","#D4C4FB"],triangle:"top-left",styles:{}};rr(Fm);var t9=function(e){var n=e.direction,r=pt({default:{picker:{width:"18px",height:"18px",borderRadius:"50%",transform:"translate(-9px, -1px)",backgroundColor:"rgb(248, 248, 248)",boxShadow:"0 1px 4px 0 rgba(0, 0, 0, 0.37)"}},vertical:{picker:{transform:"translate(-3px, -9px)"}}},{vertical:n==="vertical"});return D.createElement("div",{style:r.picker})},n9=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Bm=function(e){var n=e.width,r=e.height,s=e.onChange,i=e.hsl,a=e.direction,l=e.pointer,c=e.styles,d=c===void 0?{}:c,u=e.className,h=u===void 0?"":u,p=pt(nr({default:{picker:{position:"relative",width:n,height:r},hue:{radius:"2px"}}},d)),f=function(y){return s({a:1,h:y.h,l:.5,s:1})};return D.createElement("div",{style:p.picker,className:"hue-picker "+h},D.createElement(ja,n9({},p.hue,{hsl:i,pointer:l,onChange:f,direction:a})))};Bm.propTypes={styles:Le.object};Bm.defaultProps={width:"316px",height:"16px",direction:"horizontal",pointer:t9,styles:{}};rr(Bm);var r9=function(e){var n=e.onChange,r=e.hex,s=e.rgb,i=e.styles,a=i===void 0?{}:i,l=e.className,c=l===void 0?"":l,d=pt(nr({default:{material:{width:"98px",height:"98px",padding:"16px",fontFamily:"Roboto"},HEXwrap:{position:"relative"},HEXinput:{width:"100%",marginTop:"12px",fontSize:"15px",color:"#333",padding:"0px",border:"0px",borderBottom:"2px solid "+r,outline:"none",height:"30px"},HEXlabel:{position:"absolute",top:"0px",left:"0px",fontSize:"11px",color:"#999999",textTransform:"capitalize"},Hex:{style:{}},RGBwrap:{position:"relative"},RGBinput:{width:"100%",marginTop:"12px",fontSize:"15px",color:"#333",padding:"0px",border:"0px",borderBottom:"1px solid #eee",outline:"none",height:"30px"},RGBlabel:{position:"absolute",top:"0px",left:"0px",fontSize:"11px",color:"#999999",textTransform:"capitalize"},split:{display:"flex",marginRight:"-10px",paddingTop:"11px"},third:{flex:"1",paddingRight:"10px"}}},a)),u=function(p,f){p.hex?vi(p.hex)&&n({hex:p.hex,source:"hex"},f):(p.r||p.g||p.b)&&n({r:p.r||s.r,g:p.g||s.g,b:p.b||s.b,source:"rgb"},f)};return D.createElement(Kl,{styles:a},D.createElement("div",{style:d.material,className:"material-picker "+c},D.createElement(kt,{style:{wrap:d.HEXwrap,input:d.HEXinput,label:d.HEXlabel},label:"hex",value:r,onChange:u}),D.createElement("div",{style:d.split,className:"flexbox-fix"},D.createElement("div",{style:d.third},D.createElement(kt,{style:{wrap:d.RGBwrap,input:d.RGBinput,label:d.RGBlabel},label:"r",value:s.r,onChange:u})),D.createElement("div",{style:d.third},D.createElement(kt,{style:{wrap:d.RGBwrap,input:d.RGBinput,label:d.RGBlabel},label:"g",value:s.g,onChange:u})),D.createElement("div",{style:d.third},D.createElement(kt,{style:{wrap:d.RGBwrap,input:d.RGBinput,label:d.RGBlabel},label:"b",value:s.b,onChange:u})))))};rr(r9);var s9=function(e){var n=e.onChange,r=e.rgb,s=e.hsv,i=e.hex,a=pt({default:{fields:{paddingTop:"5px",paddingBottom:"9px",width:"80px",position:"relative"},divider:{height:"5px"},RGBwrap:{position:"relative"},RGBinput:{marginLeft:"40%",width:"40%",height:"18px",border:"1px solid #888888",boxShadow:"inset 0 1px 1px rgba(0,0,0,.1), 0 1px 0 0 #ECECEC",marginBottom:"5px",fontSize:"13px",paddingLeft:"3px",marginRight:"10px"},RGBlabel:{left:"0px",top:"0px",width:"34px",textTransform:"uppercase",fontSize:"13px",height:"18px",lineHeight:"22px",position:"absolute"},HEXwrap:{position:"relative"},HEXinput:{marginLeft:"20%",width:"80%",height:"18px",border:"1px solid #888888",boxShadow:"inset 0 1px 1px rgba(0,0,0,.1), 0 1px 0 0 #ECECEC",marginBottom:"6px",fontSize:"13px",paddingLeft:"3px"},HEXlabel:{position:"absolute",top:"0px",left:"0px",width:"14px",textTransform:"uppercase",fontSize:"13px",height:"18px",lineHeight:"22px"},fieldSymbols:{position:"absolute",top:"5px",right:"-7px",fontSize:"13px"},symbol:{height:"20px",lineHeight:"22px",paddingBottom:"7px"}}}),l=function(d,u){d["#"]?vi(d["#"])&&n({hex:d["#"],source:"hex"},u):d.r||d.g||d.b?n({r:d.r||r.r,g:d.g||r.g,b:d.b||r.b,source:"rgb"},u):(d.h||d.s||d.v)&&n({h:d.h||s.h,s:d.s||s.s,v:d.v||s.v,source:"hsv"},u)};return D.createElement("div",{style:a.fields},D.createElement(kt,{style:{wrap:a.RGBwrap,input:a.RGBinput,label:a.RGBlabel},label:"h",value:Math.round(s.h),onChange:l}),D.createElement(kt,{style:{wrap:a.RGBwrap,input:a.RGBinput,label:a.RGBlabel},label:"s",value:Math.round(s.s*100),onChange:l}),D.createElement(kt,{style:{wrap:a.RGBwrap,input:a.RGBinput,label:a.RGBlabel},label:"v",value:Math.round(s.v*100),onChange:l}),D.createElement("div",{style:a.divider}),D.createElement(kt,{style:{wrap:a.RGBwrap,input:a.RGBinput,label:a.RGBlabel},label:"r",value:r.r,onChange:l}),D.createElement(kt,{style:{wrap:a.RGBwrap,input:a.RGBinput,label:a.RGBlabel},label:"g",value:r.g,onChange:l}),D.createElement(kt,{style:{wrap:a.RGBwrap,input:a.RGBinput,label:a.RGBlabel},label:"b",value:r.b,onChange:l}),D.createElement("div",{style:a.divider}),D.createElement(kt,{style:{wrap:a.HEXwrap,input:a.HEXinput,label:a.HEXlabel},label:"#",value:i.replace("#",""),onChange:l}),D.createElement("div",{style:a.fieldSymbols},D.createElement("div",{style:a.symbol},""),D.createElement("div",{style:a.symbol},"%"),D.createElement("div",{style:a.symbol},"%")))},i9=function(e){var n=e.hsl,r=pt({default:{picker:{width:"12px",height:"12px",borderRadius:"6px",boxShadow:"inset 0 0 0 1px #fff",transform:"translate(-6px, -6px)"}},"black-outline":{picker:{boxShadow:"inset 0 0 0 1px #000"}}},{"black-outline":n.l>.5});return D.createElement("div",{style:r.picker})},o9=function(){var e=pt({default:{triangle:{width:0,height:0,borderStyle:"solid",borderWidth:"4px 0 4px 6px",borderColor:"transparent transparent transparent #fff",position:"absolute",top:"1px",left:"1px"},triangleBorder:{width:0,height:0,borderStyle:"solid",borderWidth:"5px 0 5px 8px",borderColor:"transparent transparent transparent #555"},left:{Extend:"triangleBorder",transform:"translate(-13px, -4px)"},leftInside:{Extend:"triangle",transform:"translate(-8px, -5px)"},right:{Extend:"triangleBorder",transform:"translate(20px, -14px) rotate(180deg)"},rightInside:{Extend:"triangle",transform:"translate(-8px, -5px)"}}});return D.createElement("div",{style:e.pointer},D.createElement("div",{style:e.left},D.createElement("div",{style:e.leftInside})),D.createElement("div",{style:e.right},D.createElement("div",{style:e.rightInside})))},mv=function(e){var n=e.onClick,r=e.label,s=e.children,i=e.active,a=pt({default:{button:{backgroundImage:"linear-gradient(-180deg, #FFFFFF 0%, #E6E6E6 100%)",border:"1px solid #878787",borderRadius:"2px",height:"20px",boxShadow:"0 1px 0 0 #EAEAEA",fontSize:"14px",color:"#000",lineHeight:"20px",textAlign:"center",marginBottom:"10px",cursor:"pointer"}},active:{button:{boxShadow:"0 0 0 1px #878787"}}},{active:i});return D.createElement("div",{style:a.button,onClick:n},r||s)},a9=function(e){var n=e.rgb,r=e.currentColor,s=pt({default:{swatches:{border:"1px solid #B3B3B3",borderBottom:"1px solid #F0F0F0",marginBottom:"2px",marginTop:"1px"},new:{height:"34px",background:"rgb("+n.r+","+n.g+", "+n.b+")",boxShadow:"inset 1px 0 0 #000, inset -1px 0 0 #000, inset 0 1px 0 #000"},current:{height:"34px",background:r,boxShadow:"inset 1px 0 0 #000, inset -1px 0 0 #000, inset 0 -1px 0 #000"},label:{fontSize:"14px",color:"#000",textAlign:"center"}}});return D.createElement("div",null,D.createElement("div",{style:s.label},"new"),D.createElement("div",{style:s.swatches},D.createElement("div",{style:s.new}),D.createElement("div",{style:s.current})),D.createElement("div",{style:s.label},"current"))},l9=function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function c9(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d9(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function u9(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var Hm=function(t){u9(e,t);function e(n){c9(this,e);var r=d9(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r.state={currentColor:n.hex},r}return l9(e,[{key:"render",value:function(){var r=this.props,s=r.styles,i=s===void 0?{}:s,a=r.className,l=a===void 0?"":a,c=pt(nr({default:{picker:{background:"#DCDCDC",borderRadius:"4px",boxShadow:"0 0 0 1px rgba(0,0,0,.25), 0 8px 16px rgba(0,0,0,.15)",boxSizing:"initial",width:"513px"},head:{backgroundImage:"linear-gradient(-180deg, #F0F0F0 0%, #D4D4D4 100%)",borderBottom:"1px solid #B1B1B1",boxShadow:"inset 0 1px 0 0 rgba(255,255,255,.2), inset 0 -1px 0 0 rgba(0,0,0,.02)",height:"23px",lineHeight:"24px",borderRadius:"4px 4px 0 0",fontSize:"13px",color:"#4D4D4D",textAlign:"center"},body:{padding:"15px 15px 0",display:"flex"},saturation:{width:"256px",height:"256px",position:"relative",border:"2px solid #B3B3B3",borderBottom:"2px solid #F0F0F0",overflow:"hidden"},hue:{position:"relative",height:"256px",width:"19px",marginLeft:"10px",border:"2px solid #B3B3B3",borderBottom:"2px solid #F0F0F0"},controls:{width:"180px",marginLeft:"10px"},top:{display:"flex"},previews:{width:"60px"},actions:{flex:"1",marginLeft:"20px"}}},i));return D.createElement("div",{style:c.picker,className:"photoshop-picker "+l},D.createElement("div",{style:c.head},this.props.header),D.createElement("div",{style:c.body,className:"flexbox-fix"},D.createElement("div",{style:c.saturation},D.createElement(_u,{hsl:this.props.hsl,hsv:this.props.hsv,pointer:i9,onChange:this.props.onChange})),D.createElement("div",{style:c.hue},D.createElement(ja,{direction:"vertical",hsl:this.props.hsl,pointer:o9,onChange:this.props.onChange})),D.createElement("div",{style:c.controls},D.createElement("div",{style:c.top,className:"flexbox-fix"},D.createElement("div",{style:c.previews},D.createElement(a9,{rgb:this.props.rgb,currentColor:this.state.currentColor})),D.createElement("div",{style:c.actions},D.createElement(mv,{label:"OK",onClick:this.props.onAccept,active:!0}),D.createElement(mv,{label:"Cancel",onClick:this.props.onCancel}),D.createElement(s9,{onChange:this.props.onChange,rgb:this.props.rgb,hsv:this.props.hsv,hex:this.props.hex}))))))}}]),e}(D.Component);Hm.propTypes={header:Le.string,styles:Le.object};Hm.defaultProps={header:"Color Picker",styles:{}};rr(Hm);var h9=function(e){var n=e.onChange,r=e.rgb,s=e.hsl,i=e.hex,a=e.disableAlpha,l=pt({default:{fields:{display:"flex",paddingTop:"4px"},single:{flex:"1",paddingLeft:"6px"},alpha:{flex:"1",paddingLeft:"6px"},double:{flex:"2"},input:{width:"80%",padding:"4px 10% 3px",border:"none",boxShadow:"inset 0 0 0 1px #ccc",fontSize:"11px"},label:{display:"block",textAlign:"center",fontSize:"11px",color:"#222",paddingTop:"3px",paddingBottom:"4px",textTransform:"capitalize"}},disableAlpha:{alpha:{display:"none"}}},{disableAlpha:a}),c=function(u,h){u.hex?vi(u.hex)&&n({hex:u.hex,source:"hex"},h):u.r||u.g||u.b?n({r:u.r||r.r,g:u.g||r.g,b:u.b||r.b,a:r.a,source:"rgb"},h):u.a&&(u.a<0?u.a=0:u.a>100&&(u.a=100),u.a/=100,n({h:s.h,s:s.s,l:s.l,a:u.a,source:"rgb"},h))};return D.createElement("div",{style:l.fields,className:"flexbox-fix"},D.createElement("div",{style:l.double},D.createElement(kt,{style:{input:l.input,label:l.label},label:"hex",value:i.replace("#",""),onChange:c})),D.createElement("div",{style:l.single},D.createElement(kt,{style:{input:l.input,label:l.label},label:"r",value:r.r,onChange:c,dragLabel:"true",dragMax:"255"})),D.createElement("div",{style:l.single},D.createElement(kt,{style:{input:l.input,label:l.label},label:"g",value:r.g,onChange:c,dragLabel:"true",dragMax:"255"})),D.createElement("div",{style:l.single},D.createElement(kt,{style:{input:l.input,label:l.label},label:"b",value:r.b,onChange:c,dragLabel:"true",dragMax:"255"})),D.createElement("div",{style:l.alpha},D.createElement(kt,{style:{input:l.input,label:l.label},label:"a",value:Math.round(r.a*100),onChange:c,dragLabel:"true",dragMax:"100"})))},p9=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},P2=function(e){var n=e.colors,r=e.onClick,s=r===void 0?function(){}:r,i=e.onSwatchHover,a=pt({default:{colors:{margin:"0 -10px",padding:"10px 0 0 10px",borderTop:"1px solid #eee",display:"flex",flexWrap:"wrap",position:"relative"},swatchWrap:{width:"16px",height:"16px",margin:"0 10px 10px 0"},swatch:{borderRadius:"3px",boxShadow:"inset 0 0 0 1px rgba(0,0,0,.15)"}},"no-presets":{colors:{display:"none"}}},{"no-presets":!n||!n.length}),l=function(d,u){s({hex:d,source:"hex"},u)};return D.createElement("div",{style:a.colors,className:"flexbox-fix"},n.map(function(c){var d=typeof c=="string"?{color:c}:c,u=""+d.color+(d.title||"");return D.createElement("div",{key:u,style:a.swatchWrap},D.createElement(Qi,p9({},d,{style:a.swatch,onClick:l,onHover:i,focusStyle:{boxShadow:"inset 0 0 0 1px rgba(0,0,0,.15), 0 0 4px "+d.color}})))}))};P2.propTypes={colors:Le.arrayOf(Le.oneOfType([Le.string,Le.shape({color:Le.string,title:Le.string})])).isRequired};var f9=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Um=function(e){var n=e.width,r=e.rgb,s=e.hex,i=e.hsv,a=e.hsl,l=e.onChange,c=e.onSwatchHover,d=e.disableAlpha,u=e.presetColors,h=e.renderers,p=e.styles,f=p===void 0?{}:p,m=e.className,y=m===void 0?"":m,v=pt(nr({default:f9({picker:{width:n,padding:"10px 10px 0",boxSizing:"initial",background:"#fff",borderRadius:"4px",boxShadow:"0 0 0 1px rgba(0,0,0,.15), 0 8px 16px rgba(0,0,0,.15)"},saturation:{width:"100%",paddingBottom:"75%",position:"relative",overflow:"hidden"},Saturation:{radius:"3px",shadow:"inset 0 0 0 1px rgba(0,0,0,.15), inset 0 0 4px rgba(0,0,0,.25)"},controls:{display:"flex"},sliders:{padding:"4px 0",flex:"1"},color:{width:"24px",height:"24px",position:"relative",marginTop:"4px",marginLeft:"4px",borderRadius:"3px"},activeColor:{absolute:"0px 0px 0px 0px",borderRadius:"2px",background:"rgba("+r.r+","+r.g+","+r.b+","+r.a+")",boxShadow:"inset 0 0 0 1px rgba(0,0,0,.15), inset 0 0 4px rgba(0,0,0,.25)"},hue:{position:"relative",height:"10px",overflow:"hidden"},Hue:{radius:"2px",shadow:"inset 0 0 0 1px rgba(0,0,0,.15), inset 0 0 4px rgba(0,0,0,.25)"},alpha:{position:"relative",height:"10px",marginTop:"4px",overflow:"hidden"},Alpha:{radius:"2px",shadow:"inset 0 0 0 1px rgba(0,0,0,.15), inset 0 0 4px rgba(0,0,0,.25)"}},f),disableAlpha:{color:{height:"10px"},hue:{height:"10px"},alpha:{display:"none"}}},f),{disableAlpha:d});return D.createElement("div",{style:v.picker,className:"sketch-picker "+y},D.createElement("div",{style:v.saturation},D.createElement(_u,{style:v.Saturation,hsl:a,hsv:i,onChange:l})),D.createElement("div",{style:v.controls,className:"flexbox-fix"},D.createElement("div",{style:v.sliders},D.createElement("div",{style:v.hue},D.createElement(ja,{style:v.Hue,hsl:a,onChange:l})),D.createElement("div",{style:v.alpha},D.createElement(Sm,{style:v.Alpha,rgb:r,hsl:a,renderers:h,onChange:l}))),D.createElement("div",{style:v.color},D.createElement(Sa,null),D.createElement("div",{style:v.activeColor}))),D.createElement(h9,{rgb:r,hsl:a,hex:s,onChange:l,disableAlpha:d}),D.createElement(P2,{colors:u,onClick:l,onSwatchHover:c}))};Um.propTypes={disableAlpha:Le.bool,width:Le.oneOfType([Le.string,Le.number]),styles:Le.object};Um.defaultProps={disableAlpha:!1,width:200,styles:{},presetColors:["#D0021B","#F5A623","#F8E71C","#8B572A","#7ED321","#417505","#BD10E0","#9013FE","#4A90E2","#50E3C2","#B8E986","#000000","#4A4A4A","#9B9B9B","#FFFFFF"]};rr(Um);var Ha=function(e){var n=e.hsl,r=e.offset,s=e.onClick,i=s===void 0?function(){}:s,a=e.active,l=e.first,c=e.last,d=pt({default:{swatch:{height:"12px",background:"hsl("+n.h+", 50%, "+r*100+"%)",cursor:"pointer"}},first:{swatch:{borderRadius:"2px 0 0 2px"}},last:{swatch:{borderRadius:"0 2px 2px 0"}},active:{swatch:{transform:"scaleY(1.8)",borderRadius:"3.6px/2px"}}},{active:a,first:l,last:c}),u=function(p){return i({h:n.h,s:.5,l:r,source:"hsl"},p)};return D.createElement("div",{style:d.swatch,onClick:u})},m9=function(e){var n=e.onClick,r=e.hsl,s=pt({default:{swatches:{marginTop:"20px"},swatch:{boxSizing:"border-box",width:"20%",paddingRight:"1px",float:"left"},clear:{clear:"both"}}}),i=.1;return D.createElement("div",{style:s.swatches},D.createElement("div",{style:s.swatch},D.createElement(Ha,{hsl:r,offset:".80",active:Math.abs(r.l-.8)<i&&Math.abs(r.s-.5)<i,onClick:n,first:!0})),D.createElement("div",{style:s.swatch},D.createElement(Ha,{hsl:r,offset:".65",active:Math.abs(r.l-.65)<i&&Math.abs(r.s-.5)<i,onClick:n})),D.createElement("div",{style:s.swatch},D.createElement(Ha,{hsl:r,offset:".50",active:Math.abs(r.l-.5)<i&&Math.abs(r.s-.5)<i,onClick:n})),D.createElement("div",{style:s.swatch},D.createElement(Ha,{hsl:r,offset:".35",active:Math.abs(r.l-.35)<i&&Math.abs(r.s-.5)<i,onClick:n})),D.createElement("div",{style:s.swatch},D.createElement(Ha,{hsl:r,offset:".20",active:Math.abs(r.l-.2)<i&&Math.abs(r.s-.5)<i,onClick:n,last:!0})),D.createElement("div",{style:s.clear}))},g9=function(){var e=pt({default:{picker:{width:"14px",height:"14px",borderRadius:"6px",transform:"translate(-7px, -1px)",backgroundColor:"rgb(248, 248, 248)",boxShadow:"0 1px 4px 0 rgba(0, 0, 0, 0.37)"}}});return D.createElement("div",{style:e.picker})},Wm=function(e){var n=e.hsl,r=e.onChange,s=e.pointer,i=e.styles,a=i===void 0?{}:i,l=e.className,c=l===void 0?"":l,d=pt(nr({default:{hue:{height:"12px",position:"relative"},Hue:{radius:"2px"}}},a));return D.createElement("div",{style:d.wrap||{},className:"slider-picker "+c},D.createElement("div",{style:d.hue},D.createElement(ja,{style:d.Hue,hsl:n,pointer:s,onChange:r})),D.createElement("div",{style:d.swatches},D.createElement(m9,{hsl:n,onClick:r})))};Wm.propTypes={styles:Le.object};Wm.defaultProps={pointer:g9,styles:{}};rr(Wm);var R2={};Object.defineProperty(R2,"__esModule",{value:!0});var gv=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},y9=O,yv=x9(y9);function x9(t){return t&&t.__esModule?t:{default:t}}function v9(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}var Bc=24,b9=R2.default=function(t){var e=t.fill,n=e===void 0?"currentColor":e,r=t.width,s=r===void 0?Bc:r,i=t.height,a=i===void 0?Bc:i,l=t.style,c=l===void 0?{}:l,d=v9(t,["fill","width","height","style"]);return yv.default.createElement("svg",gv({viewBox:"0 0 "+Bc+" "+Bc,style:gv({fill:n,width:s,height:a},c)},d),yv.default.createElement("path",{d:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"}))},w9=function(e){var n=e.color,r=e.onClick,s=r===void 0?function(){}:r,i=e.onSwatchHover,a=e.first,l=e.last,c=e.active,d=pt({default:{color:{width:"40px",height:"24px",cursor:"pointer",background:n,marginBottom:"1px"},check:{color:Om(n),marginLeft:"8px",display:"none"}},first:{color:{overflow:"hidden",borderRadius:"2px 2px 0 0"}},last:{color:{overflow:"hidden",borderRadius:"0 0 2px 2px"}},active:{check:{display:"block"}},"color-#FFFFFF":{color:{boxShadow:"inset 0 0 0 1px #ddd"},check:{color:"#333"}},transparent:{check:{color:"#333"}}},{first:a,last:l,active:c,"color-#FFFFFF":n==="#FFFFFF",transparent:n==="transparent"});return D.createElement(Qi,{color:n,style:d.color,onClick:s,onHover:i,focusStyle:{boxShadow:"0 0 4px "+n}},D.createElement("div",{style:d.check},D.createElement(b9,null)))},_9=function(e){var n=e.onClick,r=e.onSwatchHover,s=e.group,i=e.active,a=pt({default:{group:{paddingBottom:"10px",width:"40px",float:"left",marginRight:"10px"}}});return D.createElement("div",{style:a.group},eo(s,function(l,c){return D.createElement(w9,{key:l,color:l,active:l.toLowerCase()===i,first:c===0,last:c===s.length-1,onClick:n,onSwatchHover:r})}))},Gm=function(e){var n=e.width,r=e.height,s=e.onChange,i=e.onSwatchHover,a=e.colors,l=e.hex,c=e.styles,d=c===void 0?{}:c,u=e.className,h=u===void 0?"":u,p=pt(nr({default:{picker:{width:n,height:r},overflow:{height:r,overflowY:"scroll"},body:{padding:"16px 0 6px 16px"},clear:{clear:"both"}}},d)),f=function(y,v){return s({hex:y,source:"hex"},v)};return D.createElement("div",{style:p.picker,className:"swatches-picker "+h},D.createElement(Kl,null,D.createElement("div",{style:p.overflow},D.createElement("div",{style:p.body},eo(a,function(m){return D.createElement(_9,{key:m.toString(),group:m,active:l,onClick:f,onSwatchHover:i})}),D.createElement("div",{style:p.clear})))))};Gm.propTypes={width:Le.oneOfType([Le.string,Le.number]),height:Le.oneOfType([Le.string,Le.number]),colors:Le.arrayOf(Le.arrayOf(Le.string)),styles:Le.object};Gm.defaultProps={width:320,height:240,colors:[[mo[900],mo[700],mo[500],mo[300],mo[100]],[go[900],go[700],go[500],go[300],go[100]],[yo[900],yo[700],yo[500],yo[300],yo[100]],[xo[900],xo[700],xo[500],xo[300],xo[100]],[vo[900],vo[700],vo[500],vo[300],vo[100]],[bo[900],bo[700],bo[500],bo[300],bo[100]],[wo[900],wo[700],wo[500],wo[300],wo[100]],[_o[900],_o[700],_o[500],_o[300],_o[100]],[ko[900],ko[700],ko[500],ko[300],ko[100]],["#194D33",Ja[700],Ja[500],Ja[300],Ja[100]],[So[900],So[700],So[500],So[300],So[100]],[jo[900],jo[700],jo[500],jo[300],jo[100]],[Co[900],Co[700],Co[500],Co[300],Co[100]],[Eo[900],Eo[700],Eo[500],Eo[300],Eo[100]],[To[900],To[700],To[500],To[300],To[100]],[No[900],No[700],No[500],No[300],No[100]],[Po[900],Po[700],Po[500],Po[300],Po[100]],[Ro[900],Ro[700],Ro[500],Ro[300],Ro[100]],["#000000","#525252","#969696","#D9D9D9","#FFFFFF"]],styles:{}};rr(Gm);var Vm=function(e){var n=e.onChange,r=e.onSwatchHover,s=e.hex,i=e.colors,a=e.width,l=e.triangle,c=e.styles,d=c===void 0?{}:c,u=e.className,h=u===void 0?"":u,p=pt(nr({default:{card:{width:a,background:"#fff",border:"0 solid rgba(0,0,0,0.25)",boxShadow:"0 1px 4px rgba(0,0,0,0.25)",borderRadius:"4px",position:"relative"},body:{padding:"15px 9px 9px 15px"},label:{fontSize:"18px",color:"#fff"},triangle:{width:"0px",height:"0px",borderStyle:"solid",borderWidth:"0 9px 10px 9px",borderColor:"transparent transparent #fff transparent",position:"absolute"},triangleShadow:{width:"0px",height:"0px",borderStyle:"solid",borderWidth:"0 9px 10px 9px",borderColor:"transparent transparent rgba(0,0,0,.1) transparent",position:"absolute"},hash:{background:"#F0F0F0",height:"30px",width:"30px",borderRadius:"4px 0 0 4px",float:"left",color:"#98A1A4",display:"flex",alignItems:"center",justifyContent:"center"},input:{width:"100px",fontSize:"14px",color:"#666",border:"0px",outline:"none",height:"28px",boxShadow:"inset 0 0 0 1px #F0F0F0",boxSizing:"content-box",borderRadius:"0 4px 4px 0",float:"left",paddingLeft:"8px"},swatch:{width:"30px",height:"30px",float:"left",borderRadius:"4px",margin:"0 6px 6px 0"},clear:{clear:"both"}},"hide-triangle":{triangle:{display:"none"},triangleShadow:{display:"none"}},"top-left-triangle":{triangle:{top:"-10px",left:"12px"},triangleShadow:{top:"-11px",left:"12px"}},"top-right-triangle":{triangle:{top:"-10px",right:"12px"},triangleShadow:{top:"-11px",right:"12px"}}},d),{"hide-triangle":l==="hide","top-left-triangle":l==="top-left","top-right-triangle":l==="top-right"}),f=function(y,v){vi(y)&&n({hex:y,source:"hex"},v)};return D.createElement("div",{style:p.card,className:"twitter-picker "+h},D.createElement("div",{style:p.triangleShadow}),D.createElement("div",{style:p.triangle}),D.createElement("div",{style:p.body},eo(i,function(m,y){return D.createElement(Qi,{key:y,color:m,hex:m,style:p.swatch,onClick:f,onHover:r,focusStyle:{boxShadow:"0 0 4px "+m}})}),D.createElement("div",{style:p.hash},"#"),D.createElement(kt,{label:null,style:{input:p.input},value:s.replace("#",""),onChange:f}),D.createElement("div",{style:p.clear})))};Vm.propTypes={width:Le.oneOfType([Le.string,Le.number]),triangle:Le.oneOf(["hide","top-left","top-right"]),colors:Le.arrayOf(Le.string),styles:Le.object};Vm.defaultProps={width:276,colors:["#FF6900","#FCB900","#7BDCB5","#00D084","#8ED1FC","#0693E3","#ABB8C3","#EB144C","#F78DA7","#9900EF"],triangle:"top-left",styles:{}};rr(Vm);var Ym=function(e){var n=pt({default:{picker:{width:"20px",height:"20px",borderRadius:"22px",border:"2px #fff solid",transform:"translate(-12px, -13px)",background:"hsl("+Math.round(e.hsl.h)+", "+Math.round(e.hsl.s*100)+"%, "+Math.round(e.hsl.l*100)+"%)"}}});return D.createElement("div",{style:n.picker})};Ym.propTypes={hsl:Le.shape({h:Le.number,s:Le.number,l:Le.number,a:Le.number})};Ym.defaultProps={hsl:{a:1,h:249.94,l:.2,s:.5}};var qm=function(e){var n=pt({default:{picker:{width:"20px",height:"20px",borderRadius:"22px",transform:"translate(-10px, -7px)",background:"hsl("+Math.round(e.hsl.h)+", 100%, 50%)",border:"2px white solid"}}});return D.createElement("div",{style:n.picker})};qm.propTypes={hsl:Le.shape({h:Le.number,s:Le.number,l:Le.number,a:Le.number})};qm.defaultProps={hsl:{a:1,h:249.94,l:.2,s:.5}};var k9=function(e){var n=e.onChange,r=e.rgb,s=e.hsl,i=e.hex,a=e.hsv,l=function(f,m){if(f.hex)vi(f.hex)&&n({hex:f.hex,source:"hex"},m);else if(f.rgb){var y=f.rgb.split(",");Sh(f.rgb,"rgb")&&n({r:y[0],g:y[1],b:y[2],a:1,source:"rgb"},m)}else if(f.hsv){var v=f.hsv.split(",");Sh(f.hsv,"hsv")&&(v[2]=v[2].replace("%",""),v[1]=v[1].replace("%",""),v[0]=v[0].replace("",""),v[1]==1?v[1]=.01:v[2]==1&&(v[2]=.01),n({h:Number(v[0]),s:Number(v[1]),v:Number(v[2]),source:"hsv"},m))}else if(f.hsl){var x=f.hsl.split(",");Sh(f.hsl,"hsl")&&(x[2]=x[2].replace("%",""),x[1]=x[1].replace("%",""),x[0]=x[0].replace("",""),h[1]==1?h[1]=.01:h[2]==1&&(h[2]=.01),n({h:Number(x[0]),s:Number(x[1]),v:Number(x[2]),source:"hsl"},m))}},c=pt({default:{wrap:{display:"flex",height:"100px",marginTop:"4px"},fields:{width:"100%"},column:{paddingTop:"10px",display:"flex",justifyContent:"space-between"},double:{padding:"0px 4.4px",boxSizing:"border-box"},input:{width:"100%",height:"38px",boxSizing:"border-box",padding:"4px 10% 3px",textAlign:"center",border:"1px solid #dadce0",fontSize:"11px",textTransform:"lowercase",borderRadius:"5px",outline:"none",fontFamily:"Roboto,Arial,sans-serif"},input2:{height:"38px",width:"100%",border:"1px solid #dadce0",boxSizing:"border-box",fontSize:"11px",textTransform:"lowercase",borderRadius:"5px",outline:"none",paddingLeft:"10px",fontFamily:"Roboto,Arial,sans-serif"},label:{textAlign:"center",fontSize:"12px",background:"#fff",position:"absolute",textTransform:"uppercase",color:"#3c4043",width:"35px",top:"-6px",left:"0",right:"0",marginLeft:"auto",marginRight:"auto",fontFamily:"Roboto,Arial,sans-serif"},label2:{left:"10px",textAlign:"center",fontSize:"12px",background:"#fff",position:"absolute",textTransform:"uppercase",color:"#3c4043",width:"32px",top:"-6px",fontFamily:"Roboto,Arial,sans-serif"},single:{flexGrow:"1",margin:"0px 4.4px"}}}),d=r.r+", "+r.g+", "+r.b,u=Math.round(s.h)+", "+Math.round(s.s*100)+"%, "+Math.round(s.l*100)+"%",h=Math.round(a.h)+", "+Math.round(a.s*100)+"%, "+Math.round(a.v*100)+"%";return D.createElement("div",{style:c.wrap,className:"flexbox-fix"},D.createElement("div",{style:c.fields},D.createElement("div",{style:c.double},D.createElement(kt,{style:{input:c.input,label:c.label},label:"hex",value:i,onChange:l})),D.createElement("div",{style:c.column},D.createElement("div",{style:c.single},D.createElement(kt,{style:{input:c.input2,label:c.label2},label:"rgb",value:d,onChange:l})),D.createElement("div",{style:c.single},D.createElement(kt,{style:{input:c.input2,label:c.label2},label:"hsv",value:h,onChange:l})),D.createElement("div",{style:c.single},D.createElement(kt,{style:{input:c.input2,label:c.label2},label:"hsl",value:u,onChange:l})))))},Xm=function(e){var n=e.width,r=e.onChange,s=e.rgb,i=e.hsl,a=e.hsv,l=e.hex,c=e.header,d=e.styles,u=d===void 0?{}:d,h=e.className,p=h===void 0?"":h,f=pt(nr({default:{picker:{width:n,background:"#fff",border:"1px solid #dfe1e5",boxSizing:"initial",display:"flex",flexWrap:"wrap",borderRadius:"8px 8px 0px 0px"},head:{height:"57px",width:"100%",paddingTop:"16px",paddingBottom:"16px",paddingLeft:"16px",fontSize:"20px",boxSizing:"border-box",fontFamily:"Roboto-Regular,HelveticaNeue,Arial,sans-serif"},saturation:{width:"70%",padding:"0px",position:"relative",overflow:"hidden"},swatch:{width:"30%",height:"228px",padding:"0px",background:"rgba("+s.r+", "+s.g+", "+s.b+", 1)",position:"relative",overflow:"hidden"},body:{margin:"auto",width:"95%"},controls:{display:"flex",boxSizing:"border-box",height:"52px",paddingTop:"22px"},color:{width:"32px"},hue:{height:"8px",position:"relative",margin:"0px 16px 0px 16px",width:"100%"},Hue:{radius:"2px"}}},u));return D.createElement("div",{style:f.picker,className:"google-picker "+p},D.createElement("div",{style:f.head},c),D.createElement("div",{style:f.swatch}),D.createElement("div",{style:f.saturation},D.createElement(_u,{hsl:i,hsv:a,pointer:Ym,onChange:r})),D.createElement("div",{style:f.body},D.createElement("div",{style:f.controls,className:"flexbox-fix"},D.createElement("div",{style:f.hue},D.createElement(ja,{style:f.Hue,hsl:i,radius:"4px",pointer:qm,onChange:r}))),D.createElement(k9,{rgb:s,hsl:i,hex:l,hsv:a,onChange:r})))};Xm.propTypes={width:Le.oneOfType([Le.string,Le.number]),styles:Le.object,header:Le.string};Xm.defaultProps={width:652,styles:{},header:"Color picker"};rr(Xm);function S9({color:t,mode:e="blend",onColorChange:n,onClose:r}){var u;const[s,i]=O.useState((t==null?void 0:t.hex)||"#000000");O.useEffect(()=>{t!=null&&t.hex&&i(t.hex)},[t==null?void 0:t.hex]);const a=()=>{t!=null&&t.originalHex&&(i(t.originalHex),n&&n(t.originalHex))},l=h=>{const p=h.hex;i(p),n&&n(p)},c=()=>{i("transparent"),n&&n("transparent")},d=s==="transparent"||s==="none";return t?o.jsxs("div",{className:"color-editor-panel",children:[o.jsxs("div",{className:"editor-header",children:[o.jsx("h3",{children:"Edit Colour"}),o.jsx("button",{onClick:r,className:"close-button",children:""})]}),o.jsxs("div",{className:"editor-content",children:[o.jsxs("div",{className:"color-info-section",children:[o.jsx("div",{className:"color-display",children:o.jsxs("div",{className:"swatch-pair",children:[o.jsxs("div",{className:"swatch-group",children:[o.jsx("div",{className:"swatch original",style:{backgroundColor:t.originalHex||t.hex},title:"Original colour"}),o.jsx("span",{className:"swatch-label",children:"Original"})]}),o.jsx("span",{className:"arrow",children:""}),o.jsxs("div",{className:"swatch-group",children:[o.jsx("div",{className:`swatch current ${d?"transparent-preview":""}`,style:d?{}:{backgroundColor:s},title:"Current colour"}),o.jsx("span",{className:"swatch-label",children:d?"Transparent":"Current"})]})]})}),o.jsxs("div",{className:"color-details",children:[o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"label",children:"Hex:"}),o.jsx("span",{className:"value",children:s})]}),o.jsxs("div",{className:"detail-row",children:[o.jsx("span",{className:"label",children:"Coverage:"}),o.jsxs("span",{className:"value",children:[((u=t.areaPct)==null?void 0:u.toFixed(1))||0,"%"]})]})]})]}),o.jsxs("div",{className:"transparent-section",children:[o.jsx("h4",{children:"Remove Fill"}),o.jsxs("button",{className:`transparent-option ${d?"selected":""}`,onClick:c,title:"Make this area transparent (remove fill)",children:[o.jsx("div",{className:"transparent-swatch"}),o.jsx("span",{children:"Make Transparent"})]})]}),o.jsxs("div",{className:"tpv-palette-section",children:[o.jsx("h4",{children:"Standard TPV Colours"}),o.jsx("p",{className:"palette-description",children:"Select a pure TPV colour (no blending required)"}),o.jsx("div",{className:"tpv-color-grid",children:wn.map(h=>o.jsxs("div",{className:`tpv-color-item ${s.toLowerCase()===h.hex.toLowerCase()?"selected":""}`,onClick:()=>l(h),title:`${h.code} - ${h.name}`,children:[o.jsx("div",{className:"tpv-color-swatch",style:{backgroundColor:h.hex}}),o.jsx("span",{className:"tpv-color-code",children:h.code})]},h.code))})]}),Ri.BLEND_MODE_ENABLED,o.jsxs("div",{className:"solid-mode-info",children:[o.jsx("h4",{children:"Solid Mode Editing"}),o.jsx("p",{className:"info-description",children:"Select from the standard TPV colours above. Only solid TPV colours are available."}),o.jsx("button",{onClick:a,className:"reset-button",children:"Reset to Original Colour"})]})]}),o.jsx("style",{jsx:!0,children:`
        .color-editor-panel {
          position: fixed;
          top: 0;
          right: 0;
          width: 400px;
          height: 100vh;
          background: white;
          box-shadow: -4px 0 12px rgba(0, 0, 0, 0.15);
          z-index: 1000;
          display: flex;
          flex-direction: column;
          overflow: hidden;
        }

        .editor-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 1.5rem;
          border-bottom: 2px solid #1a365d;
          background: #f9f9f9;
        }

        .editor-header h3 {
          font-family: 'Overpass', sans-serif;
          margin: 0;
          color: #1e4a7a;
          font-size: 1.5rem;
          font-weight: 600;
        }

        .close-button {
          background: none;
          border: none;
          font-size: 2rem;
          color: #666;
          cursor: pointer;
          padding: 0;
          width: 32px;
          height: 32px;
          line-height: 1;
          transition: color 0.2s;
        }

        .close-button:hover {
          color: #333;
        }

        .editor-content {
          flex: 1;
          overflow-y: auto;
          padding: 1.5rem;
        }

        /* Color Info Section */
        .color-info-section {
          margin-bottom: 2rem;
          padding: 1rem;
          background: #f9f9f9;
          border-radius: 6px;
        }

        .color-display {
          margin-bottom: 1rem;
        }

        .swatch-pair {
          display: flex;
          align-items: center;
          gap: 1rem;
          justify-content: center;
        }

        .swatch-group {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 0.5rem;
        }

        .swatch {
          width: 60px;
          height: 60px;
          border-radius: 8px;
          border: 3px solid #ddd;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .swatch.original {
          border-color: #999;
        }

        .swatch.current {
          border-color: #ff6b35;
        }

        .swatch.transparent-preview {
          background:
            linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%),
            linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%);
          background-size: 10px 10px;
          background-position: 0 0, 5px 5px;
          background-color: white;
        }

        .swatch-label {
          font-size: 0.85rem;
          color: #666;
          font-weight: 500;
        }

        .arrow {
          font-size: 1.5rem;
          color: #666;
          font-weight: bold;
        }

        .color-details {
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .detail-row {
          display: flex;
          justify-content: space-between;
          align-items: center;
          font-size: 0.95rem;
        }

        .detail-row .label {
          font-weight: 600;
          color: #666;
        }

        .detail-row .value {
          font-family: 'Courier New', monospace;
          color: #333;
        }

        /* Transparent Section */
        .transparent-section {
          margin-bottom: 1.5rem;
          padding: 1rem;
          background: #f9f9f9;
          border-radius: 6px;
        }

        .transparent-section h4 {
          margin: 0 0 0.75rem 0;
          color: #1a365d;
          font-size: 1rem;
          font-weight: 600;
        }

        .transparent-option {
          display: flex;
          align-items: center;
          gap: 12px;
          width: 100%;
          padding: 12px 16px;
          background: white;
          border: 2px solid #d1d5db;
          border-radius: 8px;
          cursor: pointer;
          transition: all 0.2s;
          font-size: 0.95rem;
          font-weight: 500;
          color: #374151;
        }

        .transparent-option:hover {
          border-color: #6b7280;
          background: #fafafa;
        }

        .transparent-option.selected {
          border-color: #ff6b35;
          background: #fff5f0;
          box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.2);
        }

        .transparent-swatch {
          width: 32px;
          height: 32px;
          border-radius: 4px;
          border: 1px solid #999;
          background:
            linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%),
            linear-gradient(45deg, #ccc 25%, transparent 25%, transparent 75%, #ccc 75%);
          background-size: 8px 8px;
          background-position: 0 0, 4px 4px;
          background-color: white;
        }

        /* TPV Palette Section */
        .tpv-palette-section {
          margin-bottom: 2rem;
          padding: 1rem;
          background: #f9f9f9;
          border-radius: 6px;
        }

        .tpv-palette-section h4 {
          margin: 0 0 0.5rem 0;
          color: #1a365d;
          font-size: 1rem;
          font-weight: 600;
        }

        .palette-description {
          margin: 0 0 1rem 0;
          font-size: 0.85rem;
          color: #666;
        }

        .tpv-color-grid {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 0.75rem;
        }

        .tpv-color-item {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 0.4rem;
          padding: 0.5rem;
          border: 2px solid transparent;
          border-radius: 6px;
          cursor: pointer;
          transition: all 0.2s;
          background: white;
        }

        .tpv-color-item:hover {
          border-color: #ff6b35;
          transform: translateY(-2px);
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .tpv-color-item.selected {
          border-color: #ff6b35;
          background: #fff5f0;
          box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.2);
        }

        .tpv-color-swatch {
          width: 100%;
          height: 50px;
          border-radius: 4px;
          border: 1px solid rgba(0, 0, 0, 0.1);
          box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .tpv-color-code {
          font-size: 0.75rem;
          font-weight: 600;
          color: #1a365d;
          font-family: 'Courier New', monospace;
        }

        /* Picker Section */
        .picker-section {
          margin-bottom: 1rem;
          padding: 1rem;
          background: #f9f9f9;
          border-radius: 6px;
        }

        .picker-section h4 {
          margin: 0 0 0.5rem 0;
          color: #1a365d;
          font-size: 1rem;
          font-weight: 600;
        }

        .picker-description {
          margin: 0 0 1rem 0;
          font-size: 0.85rem;
          color: #666;
        }

        .picker-section :global(.chrome-picker) {
          box-shadow: none !important;
          width: 100% !important;
        }

        .reset-button {
          width: 100%;
          padding: 0.75rem;
          margin-top: 1rem;
          background: #e0e0e0;
          color: #333;
          border: none;
          border-radius: 4px;
          font-weight: 600;
          cursor: pointer;
          transition: background 0.2s;
        }

        .reset-button:hover {
          background: #d0d0d0;
        }

        /* Solid Mode Info */
        .solid-mode-info {
          margin-bottom: 1rem;
          padding: 1rem;
          background: #fff5f0;
          border: 2px solid #ff6b35;
          border-radius: 6px;
        }

        .solid-mode-info h4 {
          margin: 0 0 0.5rem 0;
          color: #1a365d;
          font-size: 1rem;
          font-weight: 600;
        }

        .info-description {
          margin: 0;
          font-size: 0.85rem;
          color: #666;
          line-height: 1.5;
        }

        /* Mobile Responsive - Fullscreen Modal */
        @media (max-width: 768px) {
          .color-editor-panel {
            width: 100%;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 0;
          }

          .editor-header {
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 10;
          }

          .editor-header h3 {
            font-size: 1.25rem;
          }

          /* Larger close button for touch */
          .close-button {
            width: 44px;
            height: 44px;
            font-size: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
          }

          .editor-content {
            padding: 1rem;
          }

          /* Color swatches - larger for touch */
          .swatch {
            width: 50px;
            height: 50px;
          }

          .color-info-section {
            padding: 0.75rem;
            margin-bottom: 1.5rem;
          }

          /* TPV color grid - better touch targets */
          .tpv-color-grid {
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
          }

          .tpv-color-item {
            padding: 0.4rem;
            min-height: 44px;
          }

          .tpv-color-swatch {
            height: 36px;
          }

          .tpv-color-code {
            font-size: 0.65rem;
          }

          .tpv-palette-section {
            padding: 0.75rem;
            margin-bottom: 1.5rem;
          }

          .tpv-palette-section h4 {
            font-size: 0.9rem;
          }

          .palette-description {
            font-size: 0.8rem;
          }

          /* Picker section */
          .picker-section {
            padding: 0.75rem;
          }

          .picker-section h4 {
            font-size: 0.9rem;
          }

          .picker-description {
            font-size: 0.8rem;
          }

          /* Larger reset button for touch */
          .reset-button {
            min-height: 44px;
            font-size: 0.9rem;
          }

          .solid-mode-info {
            padding: 0.75rem;
          }

          .solid-mode-info h4 {
            font-size: 0.9rem;
          }

          .info-description {
            font-size: 0.8rem;
          }
        }

        /* Extra small screens */
        @media (max-width: 400px) {
          .tpv-color-grid {
            grid-template-columns: repeat(3, 1fr);
          }

          .tpv-color-swatch {
            height: 44px;
          }

          .swatch {
            width: 44px;
            height: 44px;
          }

          .swatch-pair {
            gap: 0.5rem;
          }

          .arrow {
            font-size: 1.2rem;
          }
        }
      `})]}):null}const j9=wn;new Map(j9.map((t,e)=>[t.code,e]));function O2(t){const{inputMode:e,prompt:n,selectedFile:r,lengthMM:s,widthMM:i,result:a,viewMode:l,blendRecipes:c,solidRecipes:d,colorMapping:u,solidColorMapping:h,solidEditedColors:p,blendEditedColors:f,blendSvgUrl:m,solidSvgUrl:y,arMapping:v,jobId:x,inSituData:g,regionOverrides:w,originalTaggedSvg:b}=t,k=_=>_?_ instanceof Map?Object.fromEntries(_):_:null;return{input_mode:e,prompt:n||null,uploaded_file_url:(r==null?void 0:r.url)||null,dimensions:{widthMM:i,lengthMM:s},original_svg_url:(a==null?void 0:a.svg_url)||null,original_png_url:(a==null?void 0:a.png_url)||null,thumbnail_url:(a==null?void 0:a.thumb_url)||null,blend_recipes:c||null,solid_recipes:d||null,color_mapping:k(u),solid_color_mapping:k(h),solid_color_edits:k(p),blend_color_edits:k(f),final_blend_svg_url:m||null,final_solid_svg_url:y||null,preferred_view_mode:l||"solid",aspect_ratio_mapping:v||null,job_id:x||null,in_situ:g?{room_photo_url:g.room_photo_url||null,mask_url:g.mask_url||null,floor_dimensions_m:g.floor_dimensions_m||null,preview_url:g.preview_url||null,blend_opacity:g.blend_opacity||20,perspective_corners:g.perspective_corners||null}:null,region_overrides:k(w),original_tagged_svg:b||null}}function Yp(t){var i,a;const e=l=>l?l instanceof Map?l:new Map(Object.entries(l)):new Map,n=l=>{var c;return t[l]??((c=t.design_data)==null?void 0:c[l])},r=n("region_overrides"),s=n("original_tagged_svg");return{inputMode:t.input_mode||n("input_mode"),prompt:n("prompt")||"",selectedFile:n("uploaded_file_url")?{url:n("uploaded_file_url"),name:n("uploaded_file_url").split("/").pop()}:null,lengthMM:((i=n("dimensions"))==null?void 0:i.lengthMM)||0,widthMM:((a=n("dimensions"))==null?void 0:a.widthMM)||0,result:{svg_url:n("original_svg_url"),png_url:n("original_png_url"),thumbnail_url:n("thumbnail_url")},blendRecipes:n("blend_recipes")||null,solidRecipes:n("solid_recipes")||null,colorMapping:e(n("color_mapping")),solidColorMapping:e(n("solid_color_mapping")),solidEditedColors:e(n("solid_color_edits")),blendEditedColors:e(n("blend_color_edits")),blendSvgUrl:null,solidSvgUrl:null,viewMode:"solid",arMapping:n("aspect_ratio_mapping"),jobId:n("job_id"),inSituData:n("in_situ")||null,regionOverrides:e(r),originalTaggedSvg:s||null,generating:!1,generatingBlends:!1,showFinalRecipes:!!t.blend_recipes,showSolidSummary:!!t.solid_recipes,colorEditorOpen:!1,selectedColor:null}}function C9(t){var n;const e=[];return t.inputMode||e.push("Input mode is required"),(!(t.widthMM>0)||!(t.lengthMM>0))&&e.push("Surface dimensions are required"),(n=t.result)!=null&&n.svg_url||e.push("No design to save - generate a design first"),{valid:e.length===0,errors:e}}function E9({currentState:t,existingDesignId:e=null,initialName:n="",onClose:r,onSaved:s}){const[i,a]=O.useState(n),[l,c]=O.useState(""),[d,u]=O.useState(""),[h,p]=O.useState(""),[f,m]=O.useState(!1),[y,v]=O.useState([]),[x,g]=O.useState(!1),[w,b]=O.useState(""),[k,_]=O.useState("#1a365d"),[S,E]=O.useState(!1),[T,R]=O.useState(!1),[W,P]=O.useState(!1),[I,C]=O.useState(null);O.useEffect(()=>{$()},[]);const $=async()=>{try{const{projects:F}=await tm();v(F)}catch(F){console.error("Failed to load projects:",F),C("Failed to load projects")}},fe=async()=>{if(!w.trim()){C("Project name is required");return}P(!0),C(null);try{const{project:F}=await i_({name:w.trim(),color:k});v([F,...y]),u(F.id),g(!1),b(""),_("#1a365d")}catch(F){console.error("Failed to create project:",F),C(F.message)}finally{P(!1)}},V=async(F=!1)=>{if(!i.trim()){C("Design name is required");return}const Z=C9(t);if(!Z.valid){C(Z.errors.join(", "));return}F?R(!0):E(!0),C(null);try{const U=O2(t);console.log("[SAVE-MODAL] Serialized design data:",U),console.log("[SAVE-MODAL] SVG URL from serialized data:",U.original_svg_url);const X={name:i.trim(),description:l.trim()||null,project_id:d||null,tags:h.split(",").map(de=>de.trim()).filter(de=>de),is_public:f,design_data:U};console.log("[SAVE-MODAL] Full save payload:",X),e&&!F&&(X.id=e);const ge=await Jf(X);s&&s(ge,i.trim()),r()}catch(U){console.error("Failed to save design:",U),C(U.message)}finally{E(!1),R(!1)}},K=["#1a365d","#ff6b35","#4a90e2","#50c878","#9b59b6","#e74c3c"];return o.jsx("div",{className:"modal-overlay",onClick:r,children:o.jsxs("div",{className:"modal-content save-design-modal",onClick:F=>F.stopPropagation(),children:[o.jsxs("div",{className:"modal-header",children:[o.jsx("h2",{children:e?"Update Design":"Save Design"}),o.jsx("button",{onClick:r,className:"close-button",children:""})]}),o.jsxs("div",{className:"modal-body",children:[I&&o.jsx("div",{className:"error-message",children:I}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"design-name",children:"Design Name *"}),o.jsx("input",{id:"design-name",type:"text",value:i,onChange:F=>a(F.target.value),placeholder:"e.g., Playground Design A",autoFocus:!0,disabled:S||T})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"design-description",children:"Description"}),o.jsx("textarea",{id:"design-description",value:l,onChange:F=>c(F.target.value),placeholder:"Optional notes about this design...",rows:3,disabled:S||T})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"design-project",children:"Project"}),x?o.jsxs("div",{className:"new-project-form",children:[o.jsxs("div",{className:"input-row",children:[o.jsx("input",{type:"text",value:w,onChange:F=>b(F.target.value),placeholder:"Project name...",disabled:W}),o.jsx("div",{className:"color-picker-inline",children:K.map(F=>o.jsx("button",{type:"button",className:`color-swatch ${k===F?"active":""}`,style:{backgroundColor:F},onClick:()=>_(F),disabled:W},F))})]}),o.jsxs("div",{className:"button-row",children:[o.jsx("button",{type:"button",onClick:fe,className:"btn-primary btn-small",disabled:W,children:W?"Creating...":"Create"}),o.jsx("button",{type:"button",onClick:()=>g(!1),className:"btn-secondary btn-small",disabled:W,children:"Cancel"})]})]}):o.jsxs("div",{className:"project-selector",children:[o.jsxs("select",{id:"design-project",value:d,onChange:F=>u(F.target.value),disabled:S||T,children:[o.jsx("option",{value:"",children:"No Project"}),y.map(F=>o.jsxs("option",{value:F.id,children:[F.name," (",F.design_count," designs)"]},F.id))]}),o.jsx("button",{type:"button",onClick:()=>g(!0),className:"btn-secondary btn-small",disabled:S||T,children:"+ New Project"})]})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"design-tags",children:"Tags"}),o.jsx("input",{id:"design-tags",type:"text",value:h,onChange:F=>p(F.target.value),placeholder:"e.g., playground, vibrant, geometric (comma-separated)",disabled:S||T}),o.jsx("small",{className:"help-text",children:"Separate tags with commas"})]}),o.jsx("div",{className:"form-group checkbox-group",children:o.jsxs("label",{children:[o.jsx("input",{type:"checkbox",checked:f,onChange:F=>m(F.target.checked),disabled:S||T}),o.jsx("span",{children:"Make this design public (shareable link)"})]})})]}),o.jsxs("div",{className:"modal-footer",children:[o.jsx("button",{onClick:r,className:"btn-secondary",disabled:S||T,children:"Cancel"}),e&&o.jsx("button",{onClick:()=>V(!0),className:"btn-secondary",disabled:S||T,children:T?"Saving...":"Save as New"}),o.jsx("button",{onClick:()=>V(!1),className:"btn-primary",disabled:S||T,children:S?"Saving...":e?"Update":"Save Design"})]})]})})}const T9=10*1024*1024,N9=["image/jpeg","image/png","image/jpg"];function P9({onPhotoUploaded:t,disabled:e=!1}){const[n,r]=O.useState(!1),[s,i]=O.useState(!1),[a,l]=O.useState(null),[c,d]=O.useState(null),u=O.useRef(null),h=g=>{g.preventDefault(),e||r(!0)},p=g=>{g.preventDefault(),r(!1)},f=async g=>{if(g.preventDefault(),r(!1),e)return;const w=g.dataTransfer.files;w.length>0&&await v(w[0])},m=()=>{!e&&u.current&&u.current.click()},y=async g=>{g.target.files.length>0&&await v(g.target.files[0])},v=async g=>{if(l(null),!N9.includes(g.type)){l("Please upload a JPG or PNG image");return}if(g.size>T9){l("Image must be under 10MB");return}const w=URL.createObjectURL(g);d(w),console.log("[IN-SITU-UPLOADER] Loading local file to get dimensions...");const b=await new Promise((k,_)=>{const S=new Image;S.onload=()=>{console.log("[IN-SITU-UPLOADER] Local image loaded, dimensions:",S.naturalWidth,"x",S.naturalHeight),k({width:S.naturalWidth,height:S.naturalHeight})},S.onerror=E=>{console.error("[IN-SITU-UPLOADER] Failed to load local image:",E),_(new Error("Failed to read image dimensions"))},S.src=w});i(!0);try{const _=`in-situ-photos/${`${Date.now()}-${Math.random().toString(36).substr(2,9)}.${g.type.split("/")[1]}`}`,{data:S,error:E}=await gn.storage.from("tpv-studio-uploads").upload(_,g,{cacheControl:"3600",upsert:!1});if(E)throw E;const{data:{publicUrl:T}}=gn.storage.from("tpv-studio-uploads").getPublicUrl(_);console.log("[IN-SITU-UPLOADER] Photo uploaded:",T),console.log("[IN-SITU-UPLOADER] Using dimensions from local file:",b),console.log("[IN-SITU-UPLOADER] Passing local blob URL for fast preview"),console.log("[IN-SITU-UPLOADER] Calling onPhotoUploaded callback..."),t({url:w,supabaseUrl:T,width:b.width,height:b.height,filename:g.name})}catch(k){console.error("[IN-SITU-UPLOADER] Upload failed:",k),l(k.message||"Upload failed"),URL.revokeObjectURL(w),d(null)}finally{i(!1)}},x=()=>{c&&URL.revokeObjectURL(c),d(null),l(null)};return o.jsxs("div",{className:"in-situ-uploader",children:[c?o.jsxs("div",{className:"preview-container",children:[o.jsx("img",{src:c,alt:"Site preview",className:"preview-image"}),s&&o.jsxs("div",{className:"upload-overlay",children:[o.jsx("div",{className:"upload-spinner"}),o.jsx("p",{children:"Uploading..."})]}),!s&&o.jsx("button",{className:"clear-button",onClick:x,title:"Remove photo",children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}):o.jsxs("div",{className:`upload-zone ${n?"dragging":""} ${e?"disabled":""}`,onDragOver:h,onDragLeave:p,onDrop:f,onClick:m,children:[o.jsx("input",{ref:u,type:"file",accept:"image/jpeg,image/png",onChange:y,style:{display:"none"},disabled:e}),o.jsx("div",{className:"upload-icon",children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),o.jsx("polyline",{points:"17 8 12 3 7 8"}),o.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]})}),o.jsxs("div",{className:"upload-text",children:[o.jsx("p",{className:"primary",children:n?"Drop photo here":"Upload site photo"}),o.jsx("p",{className:"secondary",children:"Drag & drop or click to browse"}),o.jsx("p",{className:"hint",children:"JPG or PNG, max 10MB"})]})]}),a&&o.jsx("div",{className:"error-message",children:a}),o.jsx("style",{children:`
        .in-situ-uploader {
          width: 100%;
        }

        .upload-zone {
          border: 2px dashed #d1d5db;
          border-radius: 8px;
          padding: 2rem;
          text-align: center;
          cursor: pointer;
          transition: all 0.2s;
          background: #f9fafb;
        }

        .upload-zone:hover {
          border-color: #ff6b35;
          background: #fff7f5;
        }

        .upload-zone.dragging {
          border-color: #ff6b35;
          background: #fff7f5;
          border-style: solid;
        }

        .upload-zone.disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .upload-zone.disabled:hover {
          border-color: #d1d5db;
          background: #f9fafb;
        }

        .upload-icon {
          width: 48px;
          height: 48px;
          margin: 0 auto 1rem;
          color: #9ca3af;
        }

        .upload-zone:hover .upload-icon {
          color: #ff6b35;
        }

        .upload-text .primary {
          font-size: 1rem;
          font-weight: 600;
          color: #374151;
          margin: 0 0 0.25rem;
        }

        .upload-text .secondary {
          font-size: 0.875rem;
          color: #6b7280;
          margin: 0 0 0.5rem;
        }

        .upload-text .hint {
          font-size: 0.75rem;
          color: #9ca3af;
          margin: 0;
        }

        .preview-container {
          position: relative;
          border-radius: 8px;
          overflow: hidden;
        }

        .preview-image {
          width: 100%;
          display: block;
          border-radius: 8px;
        }

        .upload-overlay {
          position: absolute;
          inset: 0;
          background: rgba(0, 0, 0, 0.6);
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          color: white;
        }

        .upload-spinner {
          width: 32px;
          height: 32px;
          border: 3px solid rgba(255, 255, 255, 0.3);
          border-top-color: white;
          border-radius: 50%;
          animation: spin 0.8s linear infinite;
          margin-bottom: 0.5rem;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        .clear-button {
          position: absolute;
          top: 0.5rem;
          right: 0.5rem;
          width: 32px;
          height: 32px;
          border-radius: 50%;
          background: rgba(0, 0, 0, 0.6);
          border: none;
          cursor: pointer;
          color: white;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: background 0.2s;
        }

        .clear-button:hover {
          background: rgba(0, 0, 0, 0.8);
        }

        .clear-button svg {
          width: 16px;
          height: 16px;
        }

        .error-message {
          margin-top: 0.75rem;
          padding: 0.5rem 0.75rem;
          background: #fef2f2;
          border: 1px solid #fecaca;
          border-radius: 4px;
          color: #dc2626;
          font-size: 0.875rem;
        }
      `})]})}function R9(t,e){const[n,r,s,i,a,l,c,d]=t,[u,h,p,f,m,y,v,x]=e,g=[[n,r,1,0,0,0,-u*n,-u*r],[0,0,0,n,r,1,-h*n,-h*r],[s,i,1,0,0,0,-p*s,-p*i],[0,0,0,s,i,1,-f*s,-f*i],[a,l,1,0,0,0,-m*a,-m*l],[0,0,0,a,l,1,-y*a,-y*l],[c,d,1,0,0,0,-v*c,-v*d],[0,0,0,c,d,1,-x*c,-x*d]],b=O9(g,[u,h,p,f,m,y,v,x]);return function(_,S){const E=b[6]*_+b[7]*S+1,T=(b[0]*_+b[1]*S+b[2])/E,R=(b[3]*_+b[4]*S+b[5])/E;return[T,R]}}function O9(t,e){const n=t.length,r=t.map((i,a)=>[...i,e[a]]);for(let i=0;i<n;i++){let a=i;for(let l=i+1;l<n;l++)Math.abs(r[l][i])>Math.abs(r[a][i])&&(a=l);[r[i],r[a]]=[r[a],r[i]];for(let l=i+1;l<n;l++){const c=r[l][i]/r[i][i];for(let d=i;d<=n;d++)r[l][d]-=c*r[i][d]}}const s=new Array(n);for(let i=n-1;i>=0;i--){s[i]=r[i][n];for(let a=i+1;a<n;a++)s[i]-=r[i][a]*s[a];s[i]/=r[i][i]}return s}function Zm(t){return new Promise((e,n)=>{const r=new Image;!t.startsWith("blob:")&&!t.startsWith("data:")?(r.crossOrigin="anonymous",console.log("[LOAD-IMAGE] Loading external URL with CORS:",t.substring(0,50))):console.log("[LOAD-IMAGE] Loading local URL (blob/data):",t.substring(0,50)),r.onload=()=>{console.log("[LOAD-IMAGE] Successfully loaded image:",t.substring(0,50)),e(r)},r.onerror=()=>{console.error("[LOAD-IMAGE] Failed to load image:",t),n(new Error(`Failed to load image: ${t}`))},r.src=t})}async function A2(t,e=1536){console.log("[RASTERIZE-SVG] Starting SVG rasterization:",t.substring(0,50),"maxSize:",e);const n=await Zm(t),{naturalWidth:r,naturalHeight:s}=n;console.log("[RASTERIZE-SVG] SVG loaded with dimensions:",r,"x",s);const i=Math.min(1,e/Math.max(r,s)),a=Math.round(r*i),l=Math.round(s*i);console.log("[RASTERIZE-SVG] Scaling to:",a,"x",l,"(scale:",i.toFixed(2),")");const c=document.createElement("canvas");return c.width=a,c.height=l,c.getContext("2d").drawImage(n,0,0,a,l),console.log("[RASTERIZE-SVG] Drew SVG to canvas"),new Promise((u,h)=>{const p=new Image;p.onload=()=>{console.log("[RASTERIZE-SVG] Successfully rasterized SVG to PNG"),u(p)},p.onerror=f=>{console.error("[RASTERIZE-SVG] Failed to convert canvas to image:",f),h(f)},p.src=c.toDataURL("image/png")})}function M2({photoCtx:t,photoImg:e,designImg:n,quad:r,opacity:s,shape:i,lighting:a}){const l=t.canvas;t.clearRect(0,0,l.width,l.height),t.drawImage(e,0,0,l.width,l.height);const c=n.width,d=n.height,u=[0,0,c,0,c,d,0,d],h=[r[0].x,r[0].y,r[1].x,r[1].y,r[2].x,r[2].y,r[3].x,r[3].y],p=R9(u,h),f=10,m=c/f,y=d/f,v=document.createElement("canvas");if(v.width=c,v.height=d,v.getContext("2d").drawImage(n,0,0),t.save(),t.globalAlpha=s,a&&a.enabled){const w=a.strength||.6,b=1+(a.baseBrightness-1)*w,k=1+(a.baseContrast-1)*w;t.filter=`brightness(${b}) contrast(${k})`}const g=i&&i.length>=3?i:r;t.beginPath(),t.moveTo(g[0].x,g[0].y);for(let w=1;w<g.length;w++)t.lineTo(g[w].x,g[w].y);t.closePath(),t.clip();for(let w=0;w<f;w++)for(let b=0;b<f;b++){const k=w*m,_=b*y,S=(w+1)*m,E=(b+1)*y,T=p(k,_),R=p(S,_),W=p(S,E),P=p(k,E);xv(t,v,k,_,S,_,k,E,T[0],T[1],R[0],R[1],P[0],P[1]),xv(t,v,S,_,S,E,k,E,R[0],R[1],W[0],W[1],P[0],P[1])}t.restore()}function xv(t,e,n,r,s,i,a,l,c,d,u,h,p,f){t.save(),t.beginPath(),t.moveTo(c,d),t.lineTo(u,h),t.lineTo(p,f),t.closePath(),t.clip();const m=(n-a)*(i-l)-(s-a)*(r-l);if(Math.abs(m)<.001){t.restore();return}const y=((c-p)*(i-l)-(u-p)*(r-l))/m,v=((d-f)*(i-l)-(h-f)*(r-l))/m,x=((n-a)*(u-p)-(s-a)*(c-p))/m,g=((n-a)*(h-f)-(s-a)*(d-f))/m,w=c-y*n-x*r,b=d-v*n-g*r;t.setTransform(y,v,x,g,w,b),t.drawImage(e,0,0),t.restore()}function A9(t,e="tpv-in-situ-preview.png"){t.toBlob(n=>{const r=URL.createObjectURL(n),s=document.createElement("a");s.href=r,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)},"image/png")}function M9(t,e,n,r){const s=n/r,i=t*.6,a=e*.6;let l,c;s>i/a?(l=i,c=i/s):(c=a,l=a*s);const d=(t-l)/2,u=(e-c)/2;return[{x:d,y:u},{x:d+l,y:u},{x:d+l,y:u+c},{x:d,y:u+c}]}function $9(t,e,n){let r=!1;for(let s=0,i=n.length-1;s<n.length;i=s++){const a=n[s].x,l=n[s].y,c=n[i].x,d=n[i].y;l>e!=d>e&&t<(c-a)*(e-l)/(d-l)+a&&(r=!r)}return r}function D9(t,e,n){t/=255,e/=255,n/=255;const r=Math.max(t,e,n),s=Math.min(t,e,n),i=(r+s)/2;if(r===s)return{h:0,s:0,l:i};const a=r-s,l=i>.5?a/(2-r-s):a/(r+s);let c;switch(r){case t:c=((e-n)/a+(e<n?6:0))/6;break;case e:c=((n-t)/a+2)/6;break;case n:c=((t-e)/a+4)/6;break}return{h:c,s:l,l:i}}function L9(t,e,n=2e3){if(!t||!e||e.length<3)return{avgLightness:.5,avgContrastProxy:.5};const r=Math.floor(Math.min(...e.map(g=>g.x))),s=Math.ceil(Math.max(...e.map(g=>g.x))),i=Math.floor(Math.min(...e.map(g=>g.y))),a=Math.ceil(Math.max(...e.map(g=>g.y))),l=s-r,c=a-i;if(l<=0||c<=0)return{avgLightness:.5,avgContrastProxy:.5};let d;try{d=t.getImageData(r,i,l,c)}catch(g){return console.warn("[LIGHTING] Failed to get image data:",g),{avgLightness:.5,avgContrastProxy:.5}}const u=d.data,h=[];let p=0;const f=n*5;for(;h.length<n&&p<f;){p++;const g=r+Math.random()*l,w=i+Math.random()*c;if(!$9(g,w,e))continue;const b=Math.floor(g-r),_=(Math.floor(w-i)*l+b)*4;if(_<0||_>=u.length-3)continue;const S=u[_],E=u[_+1],T=u[_+2],{l:R}=D9(S,E,T);h.push(R)}if(h.length===0)return{avgLightness:.5,avgContrastProxy:.5};const m=h.reduce((g,w)=>g+w,0)/h.length,y=h.reduce((g,w)=>g+Math.pow(w-m,2),0)/h.length,v=Math.sqrt(y),x=Math.min(1,v/.25);return{avgLightness:m,avgContrastProxy:x}}function I9(t){let e=1,n=1;const s=t.avgLightness-.5;return e+=s*.6,n+=(t.avgContrastProxy-.5)*.4,e=Math.max(.7,Math.min(1.3,e)),n=Math.max(.8,Math.min(1.25,n)),{brightness:e,contrast:n}}const z9=100;function F9({photoUrl:t,svgUrl:e,designSizeMm:n,initialQuad:r,initialShape:s,initialOpacity:i=.8,initialLighting:a,onChange:l}){const[c,d]=O.useState(null),[u,h]=O.useState(null),[p,f]=O.useState(r||null),[m,y]=O.useState(s||null),[v,x]=O.useState(Math.max(.3,Math.min(1,i))),[g,w]=O.useState(a||{enabled:!1,strength:.6,baseBrightness:1,baseContrast:1}),[b,k]=O.useState(!0),[_,S]=O.useState(null),[E,T]=O.useState(1),[R,W]=O.useState("corners"),[P,I]=O.useState(null),[C,$]=O.useState(!1),[fe,V]=O.useState(null),[K,F]=O.useState(null),Z=O.useRef(null),U=O.useRef(null),X=O.useRef(null),[ge,de]=O.useState([]),Q=20;O.useEffect(()=>{ke()},[t,e]),O.useEffect(()=>{c&&u&&p&&Oe()},[c,u,p,m,v,g,R,P,C,K]),O.useEffect(()=>{if(!c||!p||p.length!==4)return;const q=document.createElement("canvas");q.width=c.naturalWidth,q.height=c.naturalHeight;const le=q.getContext("2d");le.drawImage(c,0,0);const be=L9(le,p),{brightness:Ne,contrast:ze}=I9(be);w(Pe=>({...Pe,baseBrightness:Ne,baseContrast:ze}))},[c,JSON.stringify(p)]),O.useEffect(()=>{const q=le=>{if(R==="shape"&&(le.key==="Delete"||le.key==="Backspace")&&K!==null&&m&&m.length>3){le.preventDefault();const be=m.filter((Ne,ze)=>ze!==K);y(be),F(null),Be(p,v,be)}};return window.addEventListener("keydown",q),()=>window.removeEventListener("keydown",q)},[R,K,m,p,v]);const ke=async()=>{var q;console.log("[FOUR-POINT] Starting to load images - photo:",t==null?void 0:t.substring(0,50),"svg:",e==null?void 0:e.substring(0,50)),k(!0),S(null);try{console.log("[FOUR-POINT] Loading photo and rasterizing SVG...");const[le,be]=await Promise.all([Zm(t),A2(e,1536)]);console.log("[FOUR-POINT] Both images loaded successfully - photo:",le.naturalWidth,"x",le.naturalHeight,"design:",be.naturalWidth,"x",be.naturalHeight),d(le),h(be);const Ne=((q=U.current)==null?void 0:q.clientWidth)||800,ze=500,Pe=Ne/le.naturalWidth,te=ze/le.naturalHeight,pe=Math.min(1,Pe,te);if(T(pe),console.log("[FOUR-POINT] Display scale set to:",pe.toFixed(3)),r)console.log("[FOUR-POINT] Using provided initial quad");else{const qe=M9(le.naturalWidth,le.naturalHeight,n.width_mm,n.length_mm);f(qe),console.log("[FOUR-POINT] Initialized default quad")}}catch(le){console.error("[FOUR-POINT] Failed to load images:",le),S(le.message)}finally{k(!1),console.log("[FOUR-POINT] Loading complete")}},Oe=()=>{const q=Z.current;if(!q||!c||!u||!p)return;q.width=c.naturalWidth,q.height=c.naturalHeight;const le=q.getContext("2d");M2({photoCtx:le,photoImg:c,designImg:u,quad:p,opacity:v,shape:m,lighting:g}),De(le)},De=q=>{if(!p)return;q.setTransform(1,0,0,1,0,0);const le=Math.max(8,Math.min(15,c.naturalWidth/80));if(R==="corners"){q.strokeStyle="rgba(255, 255, 255, 0.8)",q.lineWidth=2,q.setLineDash([5,5]),q.beginPath(),q.moveTo(p[0].x,p[0].y),q.lineTo(p[1].x,p[1].y),q.lineTo(p[2].x,p[2].y),q.lineTo(p[3].x,p[3].y),q.closePath(),q.stroke(),q.setLineDash([]);const be=["TL","TR","BR","BL"];p.forEach((Ne,ze)=>{q.beginPath(),q.arc(Ne.x,Ne.y,le,0,Math.PI*2),q.fillStyle=P===ze?"#ff6b35":"rgba(255, 107, 53, 0.9)",q.fill(),q.strokeStyle="white",q.lineWidth=2,q.stroke(),q.fillStyle="white",q.font="10px sans-serif",q.textAlign="center",q.textBaseline="middle",q.fillText(be[ze],Ne.x,Ne.y)})}else{const be=m||p;q.strokeStyle="rgba(34, 197, 94, 0.8)",q.lineWidth=2,q.setLineDash([]),q.beginPath(),q.moveTo(be[0].x,be[0].y);for(let Ne=1;Ne<be.length;Ne++)q.lineTo(be[Ne].x,be[Ne].y);q.closePath(),q.stroke(),be.forEach((Ne,ze)=>{q.beginPath(),q.arc(Ne.x,Ne.y,le*.8,0,Math.PI*2),K===ze?q.fillStyle="#22c55e":P===ze?q.fillStyle="#16a34a":q.fillStyle="rgba(34, 197, 94, 0.9)",q.fill(),q.strokeStyle="white",q.lineWidth=2,q.stroke()}),q.strokeStyle="rgba(255, 107, 53, 0.3)",q.lineWidth=1,q.setLineDash([3,3]),q.beginPath(),q.moveTo(p[0].x,p[0].y),q.lineTo(p[1].x,p[1].y),q.lineTo(p[2].x,p[2].y),q.lineTo(p[3].x,p[3].y),q.closePath(),q.stroke(),q.setLineDash([])}},Be=O.useCallback((q,le,be,Ne)=>{X.current&&clearTimeout(X.current),X.current=setTimeout(()=>{l&&l({quad:q,opacity:le,shape:be,lighting:Ne||g})},z9)},[l,g]),Ge=O.useCallback(()=>{de(q=>{const le=[...q,{quad:[...p],shape:m?[...m]:null,opacity:v,lighting:{...g}}];return le.length>Q?le.slice(-Q):le})},[p,m,v,g]),He=()=>{if(ge.length===0)return;const q=ge[ge.length-1];de(le=>le.slice(0,-1)),f(q.quad),y(q.shape),x(q.opacity),w(q.lighting),Be(q.quad,q.opacity,q.shape,q.lighting)},Xe=(q,le)=>({x:q/E,y:le/E}),nt=(q,le,be)=>{if(!be)return-1;const Ne=25/E;for(let ze=0;ze<be.length;ze++){const Pe=be[ze].x-q,te=be[ze].y-le;if(Math.sqrt(Pe*Pe+te*te)<Ne)return ze}return-1},j=(q,le,be)=>{if(!be||be.length<3)return!1;let Ne=!1;for(let ze=0,Pe=be.length-1;ze<be.length;Pe=ze++){const te=be[ze].x,pe=be[ze].y,qe=be[Pe].x,st=be[Pe].y;pe>le!=st>le&&q<(qe-te)*(le-pe)/(st-pe)+te&&(Ne=!Ne)}return Ne},ne=q=>{if(R!=="shape"||!m||m.length<=3)return;const le=Z.current;if(!le)return;const be=le.getBoundingClientRect(),Ne=q.clientX-be.left,ze=q.clientY-be.top,{x:Pe,y:te}=Xe(Ne,ze),pe=nt(Pe,te,m);if(pe>=0){Ge();const qe=m.filter((rt,wt)=>wt!==pe);y(qe),F(null);const st=M(p,qe);st!==p?(f(st),Be(st,v,qe)):Be(p,v,qe)}},oe=q=>{const le=Z.current;if(!le)return;const be=le.getBoundingClientRect(),Ne=q.clientX-be.left,ze=q.clientY-be.top,{x:Pe,y:te}=Xe(Ne,ze);if(R==="corners"){const pe=nt(Pe,te,p);pe>=0?(Ge(),I(pe),le.setPointerCapture(q.pointerId)):j(Pe,te,p)&&(Ge(),$(!0),V({x:Pe,y:te}),le.setPointerCapture(q.pointerId))}else{const pe=m||p,qe=nt(Pe,te,pe);if(qe>=0)Ge(),I(qe),F(qe),le.setPointerCapture(q.pointerId);else{Ge();let st=0,rt=1/0;for(let ce=0;ce<pe.length;ce++){const ee=(ce+1)%pe.length,ve=ie(Pe,te,pe[ce].x,pe[ce].y,pe[ee].x,pe[ee].y);ve<rt&&(rt=ve,st=ee)}const wt={x:Pe,y:te},ct=[...pe];ct.splice(st,0,wt),y(ct),F(st);const Ze=M(p,ct);Ze!==p?(f(Ze),Be(Ze,v,ct)):Be(p,v,ct)}}},z=q=>{if(P===null&&!C)return;const le=Z.current;if(!le)return;const be=le.getBoundingClientRect(),Ne=q.clientX-be.left,ze=q.clientY-be.top,{x:Pe,y:te}=Xe(Ne,ze),pe=Math.max(0,Math.min(c.naturalWidth,Pe)),qe=Math.max(0,Math.min(c.naturalHeight,te));if(R==="corners"){if(C&&fe){const st=pe-fe.x,rt=qe-fe.y,wt=p.map(Ze=>({x:Math.max(0,Math.min(c.naturalWidth,Ze.x+st)),y:Math.max(0,Math.min(c.naturalHeight,Ze.y+rt))}));let ct=m;m&&(ct=m.map(Ze=>({x:Math.max(0,Math.min(c.naturalWidth,Ze.x+st)),y:Math.max(0,Math.min(c.naturalHeight,Ze.y+rt))})),y(ct)),f(wt),V({x:pe,y:qe}),Be(wt,v,ct)}else if(P!==null){const st=[...p];st[P]={x:pe,y:qe},f(st),Be(st,v,m)}}else{const rt=[...m||p];rt[P]={x:pe,y:qe},y(rt),Be(p,v,rt)}},A=q=>{if(P!==null||C){const le=Z.current;if(le&&le.releasePointerCapture(q.pointerId),R==="shape"&&m&&P!==null){const be=M(p,m);be!==p&&(f(be),Be(be,v,m))}I(null),$(!1),V(null)}},M=(q,le)=>{if(!le||le.length<3||!q)return q;const be=q.reduce((Ze,ce)=>Ze+ce.x,0)/4,Ne=q.reduce((Ze,ce)=>Ze+ce.y,0)/4,ze=le.reduce((Ze,ce)=>Ze+ce.x,0)/le.length,Pe=le.reduce((Ze,ce)=>Ze+ce.y,0)/le.length;let te=1;for(const Ze of le){const ce=Ze.x-be,ee=Ze.y-Ne,ve=Math.sqrt(ce*ce+ee*ee);if(ve<1)continue;const Ve=G(be,Ne,ce,ee,q);if(Ve>0&&ve>Ve){const ot=ve/Ve;te=Math.max(te,ot)}}let pe=1/0;for(const Ze of le){const ce=Ze.x-be,ee=Ze.y-Ne,ve=Math.sqrt(ce*ce+ee*ee);if(ve<1)continue;const Ve=G(be,Ne,ce,ee,q);if(Ve>0){const ot=ve/Ve;pe=Math.min(pe,ot)}}let qe=te;if(te<=1&&pe<1/0&&(qe=pe),Math.abs(qe-1)<.01)return q;const st=q.map(Ze=>({x:be+(Ze.x-be)*qe,y:Ne+(Ze.y-Ne)*qe})),rt=ze-be,wt=Pe-Ne;return st.map(Ze=>({x:Ze.x+rt,y:Ze.y+wt}))},G=(q,le,be,Ne,ze)=>{let Pe=1/0;for(let te=0;te<4;te++){const pe=ze[te],qe=ze[(te+1)%4],st=qe.x-pe.x,rt=qe.y-pe.y,wt=be*rt-Ne*st;if(Math.abs(wt)<1e-4)continue;const ct=((pe.x-q)*rt-(pe.y-le)*st)/wt,Ze=((pe.x-q)*Ne-(pe.y-le)*be)/wt;ct>0&&Ze>=0&&Ze<=1&&(Pe=Math.min(Pe,ct*Math.sqrt(be*be+Ne*Ne)))}return Pe===1/0?0:Pe},ie=(q,le,be,Ne,ze,Pe)=>{const te=q-be,pe=le-Ne,qe=ze-be,st=Pe-Ne,rt=te*qe+pe*st,wt=qe*qe+st*st;let ct=wt!==0?rt/wt:-1,Ze,ce;return ct<0?(Ze=be,ce=Ne):ct>1?(Ze=ze,ce=Pe):(Ze=be+ct*qe,ce=Ne+ct*st),Math.sqrt((q-Ze)**2+(le-ce)**2)},Y=()=>{R==="corners"?(m||y([...p]),W("shape"),F(null)):(W("corners"),F(null))},se=q=>{const le=Math.max(.3,Math.min(1,parseFloat(q.target.value)/100));x(le),Be(p,le,m)},we=q=>{const le={...g,enabled:q.target.checked};w(le),Be(p,v,m,le)},ue=q=>{const le={...g,strength:parseFloat(q.target.value)/100};w(le),Be(p,v,m,le)};return b?o.jsxs("div",{className:"four-point-editor loading",children:[o.jsx("div",{className:"spinner"}),o.jsx("p",{children:"Loading preview..."})]}):_?o.jsx("div",{className:"four-point-editor error",children:o.jsxs("p",{children:["Failed to load: ",_]})}):o.jsxs("div",{className:"four-point-editor",ref:U,children:[o.jsxs("div",{className:"editor-header",children:[o.jsxs("div",{className:"header-title",children:[o.jsx("h3",{children:"Position Your Design"}),o.jsx(sm,{content:o.jsxs("div",{children:[o.jsxs("p",{children:[o.jsx("strong",{children:"Corners Mode:"})," Drag the 4 corner handles (TL, TR, BR, BL) to position your design with perspective. You can also drag inside the design to move all corners at once."]}),o.jsxs("p",{style:{marginTop:"0.5rem"},children:[o.jsx("strong",{children:"Refine Shape Mode:"})," Click anywhere to add new vertices for precise shape control. Drag existing vertices to adjust. Double-click or press Delete/Backspace on a vertex to remove it."]}),o.jsxs("p",{style:{marginTop:"0.5rem"},children:[o.jsx("strong",{children:"Overlay Opacity:"})," Adjust transparency to see how the design blends with your photo."]}),o.jsxs("p",{style:{marginTop:"0.5rem"},children:[o.jsx("strong",{children:"Match Floor Lighting:"})," Automatically adjusts design brightness to match your floor's lighting conditions."]})]}),position:"right"})]}),o.jsx("p",{className:"instructions",children:R==="corners"?"Drag the corner handles (TL, TR, BR, BL) to position the design. Drag inside to move all corners.":"Click to add vertices, drag to move them, double-click or press Delete to remove."})]}),o.jsx("div",{className:"canvas-container",children:o.jsx("canvas",{ref:Z,onPointerDown:oe,onPointerMove:z,onPointerUp:A,onPointerLeave:A,onDoubleClick:ne,style:{width:`${((c==null?void 0:c.naturalWidth)||800)*E}px`,height:`${((c==null?void 0:c.naturalHeight)||600)*E}px`,cursor:P!==null||C?"grabbing":R==="shape"?"crosshair":"move",touchAction:"none"}})}),o.jsxs("div",{className:"controls",children:[o.jsxs("div",{className:"mode-toggle",children:[o.jsx("button",{className:`toggle-btn ${R==="corners"?"active":""}`,onClick:()=>W("corners"),children:"Corners"}),o.jsx("button",{className:`toggle-btn ${R==="shape"?"active":""}`,onClick:Y,children:"Refine Shape"}),o.jsx("button",{className:"toggle-btn undo-btn",onClick:He,disabled:ge.length===0,title:"Undo last change",children:"Undo"})]}),o.jsxs("div",{className:"opacity-control",children:[o.jsxs("label",{children:["Overlay Opacity",o.jsxs("span",{className:"value",children:[Math.round(v*100),"%"]})]}),o.jsx("input",{type:"range",min:"30",max:"100",value:Math.round(v*100),onChange:se})]}),o.jsxs("div",{className:"lighting-control",children:[o.jsxs("label",{className:"checkbox-label",children:[o.jsx("input",{type:"checkbox",checked:g.enabled,onChange:we}),"Match floor lighting"]}),g.enabled&&o.jsxs("div",{className:"lighting-slider",children:[o.jsxs("label",{children:["Strength",o.jsxs("span",{className:"value",children:[Math.round(g.strength*100),"%"]})]}),o.jsx("input",{type:"range",min:"0",max:"100",value:Math.round(g.strength*100),onChange:ue})]})]})]}),o.jsx("style",{children:`
        .four-point-editor {
          display: flex;
          flex-direction: column;
          height: 100%;
        }

        .four-point-editor.loading,
        .four-point-editor.error {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          min-height: 400px;
          color: #6b7280;
        }

        .four-point-editor .spinner {
          width: 40px;
          height: 40px;
          border: 3px solid #e5e7eb;
          border-top-color: #ff6b35;
          border-radius: 50%;
          animation: spin 0.8s linear infinite;
          margin-bottom: 1rem;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }

        .editor-header {
          padding-bottom: 1rem;
          border-bottom: 1px solid #e5e7eb;
          margin-bottom: 1rem;
        }

        .editor-header .header-title {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          margin-bottom: 0.5rem;
        }

        .editor-header h3 {
          margin: 0;
          font-size: 1.125rem;
          color: #1e4a7a;
        }

        .editor-header .instructions {
          margin: 0;
          font-size: 0.875rem;
          color: #6b7280;
        }

        .canvas-container {
          flex: 1;
          display: flex;
          align-items: center;
          justify-content: center;
          background: #f3f4f6;
          border-radius: 8px;
          overflow: hidden;
          min-height: 400px;
        }

        .canvas-container canvas {
          display: block;
        }

        .controls {
          padding-top: 1rem;
          border-top: 1px solid #e5e7eb;
          margin-top: 1rem;
          display: flex;
          flex-direction: column;
          gap: 1rem;
        }

        .mode-toggle {
          display: flex;
          gap: 0.5rem;
        }

        .toggle-btn {
          padding: 0.5rem 1rem;
          border: 1px solid #d1d5db;
          background: white;
          border-radius: 4px;
          font-size: 0.875rem;
          cursor: pointer;
          transition: all 0.2s;
        }

        .toggle-btn:hover {
          background: #f9fafb;
        }

        .toggle-btn.active {
          background: #ff6b35;
          color: white;
          border-color: #ff6b35;
        }

        .toggle-btn:disabled {
          opacity: 0.4;
          cursor: not-allowed;
        }

        .toggle-btn:disabled:hover {
          background: white;
        }

        .opacity-control {
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .opacity-control label {
          display: flex;
          justify-content: space-between;
          font-size: 0.875rem;
          font-weight: 500;
          color: #374151;
        }

        .opacity-control .value {
          font-weight: 400;
          color: #6b7280;
        }

        .opacity-control input[type="range"] {
          width: 100%;
          height: 6px;
          border-radius: 3px;
          background: #e5e7eb;
          outline: none;
          -webkit-appearance: none;
        }

        .opacity-control input[type="range"]::-webkit-slider-thumb {
          -webkit-appearance: none;
          width: 16px;
          height: 16px;
          border-radius: 50%;
          background: #ff6b35;
          cursor: pointer;
        }

        .lighting-control {
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .checkbox-label {
          display: flex;
          align-items: center;
          gap: 0.5rem;
          font-size: 0.875rem;
          font-weight: 500;
          color: #374151;
          cursor: pointer;
        }

        .checkbox-label input[type="checkbox"] {
          width: 16px;
          height: 16px;
          cursor: pointer;
        }

        .lighting-slider {
          display: flex;
          flex-direction: column;
          gap: 0.25rem;
          padding-left: 1.5rem;
        }

        .lighting-slider label {
          display: flex;
          justify-content: space-between;
          font-size: 0.8rem;
          color: #6b7280;
        }

        .lighting-slider .value {
          font-weight: 400;
        }

        .lighting-slider input[type="range"] {
          width: 100%;
          height: 6px;
          border-radius: 3px;
          background: #e5e7eb;
          outline: none;
          -webkit-appearance: none;
        }

        .lighting-slider input[type="range"]::-webkit-slider-thumb {
          -webkit-appearance: none;
          width: 14px;
          height: 14px;
          border-radius: 50%;
          background: #22c55e;
          cursor: pointer;
        }
      `})]})}const ds={UPLOAD:"upload",POSITION:"position"};function $2({designUrl:t,designDimensions:e,onClose:n,onSaved:r}){const[s,i]=O.useState(ds.UPLOAD),[a,l]=O.useState(null),[c,d]=O.useState(null),[u,h]=O.useState(null),[p,f]=O.useState(.8),[m,y]=O.useState({enabled:!1,strength:.6,baseBrightness:1,baseContrast:1}),[v,x]=O.useState(!1),g=O.useRef(null);O.useEffect(()=>{if(t){console.log("[IN-SITU-MODAL] Design URL received:",t==null?void 0:t.substring(0,50));const T=new Image;!t.startsWith("blob:")&&!t.startsWith("data:")&&(T.crossOrigin="anonymous"),T.src=t}else console.warn("[IN-SITU-MODAL] No design URL provided")},[t]);const w=T=>{console.log("[IN-SITU-MODAL] Photo uploaded:",T),l(T),console.log("[IN-SITU-MODAL] Advancing to POSITION step, designUrl:",t==null?void 0:t.substring(0,50)),i(ds.POSITION)},b=({quad:T,opacity:R,shape:W,lighting:P})=>{d(T),f(R),h(W),P&&y(P)},k=async()=>{if(!a||!c)return null;try{console.log("[InSitu] Loading design from URL:",t);const[T,R]=await Promise.all([Zm(a.url),A2(t,1536)]);console.log("[InSitu] Successfully loaded design image");const W=document.createElement("canvas");W.width=T.naturalWidth,W.height=T.naturalHeight;const P=W.getContext("2d");return M2({photoCtx:P,photoImg:T,designImg:R,quad:c,opacity:p,shape:u,lighting:m}),W}catch(T){return console.error("[InSitu] Failed to generate canvas:",T),alert(`Failed to load design: ${T.message}`),null}},_=async()=>{const T=await k();T&&A9(T,"tpv-in-situ-preview.png")},S=async()=>{if(!(!c||!a)){x(!0);try{const T=await k();if(!T)throw new Error("Failed to generate preview");const R=await new Promise($=>T.toBlob($,"image/png")),P=`in-situ-previews/${`${Date.now()}-${Math.random().toString(36).substr(2,9)}.png`}`,{error:I}=await gn.storage.from("tpv-studio-uploads").upload(P,R,{contentType:"image/png",cacheControl:"3600"});if(I)throw I;const{data:{publicUrl:C}}=gn.storage.from("tpv-studio-uploads").getPublicUrl(P);r&&r({photo_url:a.supabaseUrl||a.url,quad:c,shape:u,opacity:p,lighting:m,preview_url:C}),n()}catch(T){console.error("[IN-SITU] Save failed:",T),alert("Failed to save preview: "+T.message)}finally{x(!1)}}},E=()=>{switch(s){case ds.UPLOAD:return"Upload Site Photo";case ds.POSITION:return"Position Your Design";default:return"In-Situ Preview"}};return o.jsxs("div",{className:"modal-overlay in-situ-modal-overlay",onClick:n,children:[o.jsxs("div",{className:"modal-content in-situ-modal",onClick:T=>T.stopPropagation(),children:[o.jsxs("div",{className:"modal-header",children:[o.jsxs("div",{className:"header-left",children:[o.jsx("h2",{children:E()}),o.jsxs("div",{className:"step-indicator",children:[o.jsx("span",{className:s===ds.UPLOAD?"active":"completed",children:"1. Upload"}),o.jsx("span",{className:s===ds.POSITION?"active":"",children:"2. Position"})]})]}),o.jsx("button",{onClick:n,className:"close-button",children:""})]}),o.jsxs("div",{className:"modal-body",children:[s===ds.UPLOAD&&o.jsxs("div",{className:"upload-step",children:[o.jsx("p",{className:"step-description",children:"Upload a photo of your site to see how your TPV design will look when installed. For best results, use a photo taken from above or at a slight angle showing the floor area clearly."}),o.jsx(P9,{onPhotoUploaded:w})]}),s===ds.POSITION&&a&&o.jsx(F9,{ref:g,photoUrl:a.url,svgUrl:t,designSizeMm:{width_mm:e.width,length_mm:e.length},initialOpacity:.8,onChange:b})]}),s===ds.POSITION&&o.jsxs("div",{className:"modal-footer",children:[o.jsx("button",{onClick:()=>i(ds.UPLOAD),className:"btn-secondary",children:"Back"}),o.jsxs("div",{className:"footer-actions",children:[o.jsx("button",{onClick:_,disabled:!c,className:"btn-secondary",children:"Download PNG"}),o.jsx("button",{onClick:S,disabled:!c||v,className:"btn-primary",children:v?"Saving...":"Save to Project"})]})]})]}),o.jsx("style",{children:`
        .in-situ-modal-overlay {
          position: fixed;
          inset: 0;
          background: rgba(0, 0, 0, 0.6);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 1000;
          padding: 1rem;
        }

        .in-situ-modal {
          background: white;
          border-radius: 12px;
          width: 100%;
          max-width: 1000px;
          max-height: 90vh;
          display: flex;
          flex-direction: column;
          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .in-situ-modal .modal-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          padding: 1.25rem 1.5rem;
          border-bottom: 1px solid #e5e7eb;
        }

        .header-left {
          display: flex;
          flex-direction: column;
          gap: 0.5rem;
        }

        .in-situ-modal .modal-header h2 {
          margin: 0;
          font-size: 1.25rem;
          color: #1e4a7a;
        }

        .step-indicator {
          display: flex;
          gap: 1rem;
          font-size: 0.75rem;
        }

        .step-indicator span {
          color: #9ca3af;
          padding: 0.25rem 0.5rem;
          border-radius: 4px;
        }

        .step-indicator span.active {
          background: #fff7f5;
          color: #ff6b35;
          font-weight: 500;
        }

        .step-indicator span.completed {
          color: #22c55e;
        }

        .close-button {
          background: none;
          border: none;
          font-size: 1.5rem;
          cursor: pointer;
          color: #9ca3af;
          padding: 0;
          line-height: 1;
        }

        .close-button:hover {
          color: #374151;
        }

        .modal-body {
          flex: 1;
          padding: 1.5rem;
          overflow-y: auto;
          min-height: 500px;
        }

        .upload-step {
          display: flex;
          flex-direction: column;
          gap: 1.5rem;
        }

        .step-description {
          margin: 0;
          font-size: 0.875rem;
          color: #6b7280;
          line-height: 1.6;
        }

        .modal-footer {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 1rem 1.5rem;
          border-top: 1px solid #e5e7eb;
          background: #f9fafb;
          border-radius: 0 0 12px 12px;
        }

        .footer-actions {
          display: flex;
          gap: 0.5rem;
        }

        .btn-primary,
        .btn-secondary {
          padding: 0.5rem 1rem;
          border-radius: 4px;
          font-size: 0.875rem;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.2s;
          border: none;
        }

        .btn-primary {
          background: #ff6b35;
          color: white;
        }

        .btn-primary:hover:not(:disabled) {
          background: #e55a2b;
        }

        .btn-primary:disabled {
          background: #d1d5db;
          cursor: not-allowed;
        }

        .btn-secondary {
          background: white;
          color: #374151;
          border: 1px solid #d1d5db;
        }

        .btn-secondary:hover:not(:disabled) {
          background: #f9fafb;
        }

        .btn-secondary:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
          .in-situ-modal {
            max-width: 100%;
            max-height: 100vh;
            border-radius: 0;
          }

          .modal-body {
            padding: 1rem;
          }

          .step-indicator {
            display: none;
          }

          .modal-footer {
            border-radius: 0;
          }
        }
      `})]})}function B9({isOpen:t,onClose:e,onConfirm:n,aspectRatio:r,defaultLongestSide:s=5e3}){const[i,a]=O.useState(s),[l,c]=O.useState(s/1e3),u=(y=>{if(!r||r<=0)return{width:y,length:y};if(r>=1){const v=y,x=Math.round(y/r);return{width:v,length:x}}else{const v=y;return{width:Math.round(y*r),length:v}}})(i),h=r>=1?"landscape":"portrait",p=r>=1?`${r.toFixed(1)}:1`:`1:${(1/r).toFixed(1)}`,f=y=>{const v=parseFloat(y.target.value)||0;c(v),a(Math.round(v*1e3))},m=()=>{n(u.width,u.length),e()};return t?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"dimension-modal-overlay",onClick:e,children:o.jsxs("div",{className:"dimension-modal",onClick:y=>y.stopPropagation(),children:[o.jsxs("div",{className:"dimension-modal-header",children:[o.jsxs("div",{className:"dimension-modal-title",children:[o.jsx("h2",{children:"Set Installation Size"}),o.jsx(sm,{content:o.jsxs("div",{children:[o.jsx("p",{children:o.jsx("strong",{children:"Why specify dimensions?"})}),o.jsx("p",{style:{marginTop:"0.5rem"},children:"Accurate dimensions are essential for:"}),o.jsxs("ul",{style:{marginTop:"0.5rem",marginBottom:0,paddingLeft:"1.25rem"},children:[o.jsx("li",{children:"Calculating exact material quantities"}),o.jsx("li",{children:"Generating PDF specifications for manufacturers"}),o.jsx("li",{children:"Slicing designs into 1m1m installation tiles"})]}),o.jsxs("p",{style:{marginTop:"0.5rem"},children:[o.jsx("strong",{children:"Tip:"})," Typical playground installations range from 3m to 20m on the longest side."]})]}),position:"bottom"})]}),o.jsx("button",{className:"dimension-modal-close",onClick:e,"aria-label":"Close",children:""})]}),o.jsxs("div",{className:"dimension-modal-body",children:[o.jsx("div",{className:"dimension-info",children:o.jsxs("p",{className:"dimension-aspect",children:["Your design has a ",o.jsxs("strong",{children:[p," ",h]})," aspect ratio"]})}),o.jsxs("div",{className:"dimension-input-group",children:[o.jsx("label",{htmlFor:"longest-dimension",children:"Installation Size (Longest Side)"}),o.jsxs("div",{className:"dimension-input-wrapper",children:[o.jsx("input",{id:"longest-dimension",type:"number",min:"0.1",max:"50",step:"0.1",value:l,onChange:f,className:"dimension-input"}),o.jsx("span",{className:"dimension-unit",children:"meters"})]}),o.jsx("p",{className:"dimension-help",children:"Enter the measurement of the longest side of your installation area. The other dimension will be calculated automatically based on your design's aspect ratio."})]}),o.jsxs("div",{className:"dimension-preview",children:[o.jsx("div",{className:"dimension-preview-title",children:"Calculated Dimensions:"}),o.jsxs("div",{className:"dimension-preview-values",children:[o.jsxs("div",{className:"dimension-preview-item",children:[o.jsx("span",{className:"dimension-preview-label",children:"Width:"}),o.jsxs("span",{className:"dimension-preview-value",children:[(u.width/1e3).toFixed(2),"m"]})]}),o.jsxs("div",{className:"dimension-preview-item",children:[o.jsx("span",{className:"dimension-preview-label",children:"Length:"}),o.jsxs("span",{className:"dimension-preview-value",children:[(u.length/1e3).toFixed(2),"m"]})]}),o.jsxs("div",{className:"dimension-preview-item",children:[o.jsx("span",{className:"dimension-preview-label",children:"Total Area:"}),o.jsxs("span",{className:"dimension-preview-value",children:[(u.width*u.length/1e6).toFixed(2),"m"]})]})]})]}),o.jsxs("div",{className:"dimension-note",children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"8",cy:"8",r:"7"}),o.jsx("line",{x1:"8",y1:"11",x2:"8",y2:"8"}),o.jsx("circle",{cx:"8",cy:"5",r:"0.5",fill:"currentColor"})]}),o.jsx("p",{children:"These dimensions will be used to calculate material quantities for your PDF specification and to slice your design into 1m1m installation tiles."})]})]}),o.jsxs("div",{className:"dimension-modal-footer",children:[o.jsx("button",{className:"dimension-btn dimension-btn-secondary",onClick:e,children:"Cancel"}),o.jsx("button",{className:"dimension-btn dimension-btn-primary",onClick:m,disabled:l<=0,children:"Confirm Size"})]})]})}),o.jsx("style",{children:`
        .dimension-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        padding: 20px;
        backdrop-filter: blur(4px);
      }

      .dimension-modal {
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        max-width: 500px;
        width: 100%;
        max-height: 90vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        animation: dimensionModalSlideIn 0.3s ease-out;
      }

      @keyframes dimensionModalSlideIn {
        from {
          opacity: 0;
          transform: translateY(-20px) scale(0.95);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .dimension-modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 24px;
        border-bottom: 1px solid #e5e7eb;
      }

      .dimension-modal-title {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .dimension-modal-header h2 {
        margin: 0;
        font-size: 1.5rem;
        font-weight: 600;
        color: #111827;
      }

      .dimension-modal-close {
        background: none;
        border: none;
        font-size: 2rem;
        line-height: 1;
        color: #9ca3af;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        transition: all 0.2s;
      }

      .dimension-modal-close:hover {
        background: #f3f4f6;
        color: #111827;
      }

      .dimension-modal-body {
        padding: 24px;
        overflow-y: auto;
        flex: 1;
      }

      .dimension-info {
        background: #f0f9ff;
        border: 1px solid #bae6fd;
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 24px;
      }

      .dimension-aspect {
        margin: 0;
        color: #0c4a6e;
        font-size: 0.95rem;
        line-height: 1.5;
      }

      .dimension-input-group {
        margin-bottom: 24px;
      }

      .dimension-input-group label {
        display: block;
        font-weight: 600;
        color: #374151;
        margin-bottom: 8px;
        font-size: 0.95rem;
      }

      .dimension-input-wrapper {
        position: relative;
        display: flex;
        align-items: center;
      }

      .dimension-input {
        width: 100%;
        padding: 12px 16px;
        padding-right: 70px;
        font-size: 1.1rem;
        border: 2px solid #d1d5db;
        border-radius: 10px;
        transition: all 0.2s;
        font-family: inherit;
      }

      .dimension-input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .dimension-unit {
        position: absolute;
        right: 16px;
        color: #6b7280;
        font-weight: 500;
        pointer-events: none;
      }

      .dimension-help {
        margin: 8px 0 0 0;
        font-size: 0.85rem;
        color: #6b7280;
      }

      .dimension-preview {
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 24px;
      }

      .dimension-preview-title {
        font-weight: 600;
        color: #374151;
        margin-bottom: 16px;
        font-size: 0.95rem;
      }

      .dimension-preview-values {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .dimension-preview-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 12px;
        background: white;
        border-radius: 8px;
      }

      .dimension-preview-label {
        color: #6b7280;
        font-size: 0.9rem;
      }

      .dimension-preview-value {
        font-weight: 600;
        color: #111827;
        font-size: 1.05rem;
      }

      .dimension-note {
        display: flex;
        gap: 12px;
        padding: 16px;
        background: #fffbeb;
        border: 1px solid #fde68a;
        border-radius: 10px;
      }

      .dimension-note svg {
        flex-shrink: 0;
        margin-top: 2px;
        color: #f59e0b;
      }

      .dimension-note p {
        margin: 0;
        font-size: 0.85rem;
        color: #78350f;
        line-height: 1.5;
      }

      .dimension-modal-footer {
        padding: 20px 24px;
        border-top: 1px solid #e5e7eb;
        display: flex;
        gap: 12px;
        justify-content: flex-end;
      }

      .dimension-btn {
        padding: 10px 24px;
        border-radius: 8px;
        font-weight: 600;
        font-size: 0.95rem;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
        font-family: inherit;
      }

      .dimension-btn-secondary {
        background: white;
        border: 1px solid #d1d5db;
        color: #374151;
      }

      .dimension-btn-secondary:hover {
        background: #f9fafb;
        border-color: #9ca3af;
      }

      .dimension-btn-primary {
        background: #3b82f6;
        color: white;
      }

      .dimension-btn-primary:hover {
        background: #2563eb;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
      }

      .dimension-btn-primary:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        box-shadow: none;
      }

      @media (max-width: 640px) {
        .dimension-modal {
          max-width: none;
          width: 100%;
          margin: 0;
          max-height: 100vh;
          border-radius: 0;
        }

        .dimension-modal-header {
          padding: 20px;
        }

        .dimension-modal-header h2 {
          font-size: 1.25rem;
        }

        .dimension-modal-body {
          padding: 20px;
        }

        .dimension-modal-footer {
          flex-direction: column-reverse;
          padding: 16px 20px;
        }

        .dimension-btn {
          width: 100%;
        }
      }
      `})]}):null}function H9(t,e,n){return"#"+[t,e,n].map(r=>r.toString(16).padStart(2,"0")).join("").toUpperCase()}async function U9(t,e={}){const{canvasSize:n=500,ignoreWhite:r=!0,ignoreTransparent:s=!0}=e;return new Promise((i,a)=>{const l=document.createElement("canvas");l.width=n,l.height=n;const c=l.getContext("2d",{willReadFrequently:!0}),d=new Image,u=new Blob([t],{type:"image/svg+xml"}),h=URL.createObjectURL(u);d.onload=()=>{try{c.clearRect(0,0,n,n);const p=Math.min(n/d.width,n/d.height),f=d.width*p,m=d.height*p,y=(n-f)/2,v=(n-m)/2;c.drawImage(d,y,v,f,m);const g=c.getImageData(0,0,n,n).data,w=new Map;let b=0;for(let _=0;_<g.length;_+=4){const S=g[_],E=g[_+1],T=g[_+2],R=g[_+3];if(s&&R<128||r&&S>250&&E>250&&T>250)continue;const W=H9(S,E,T),P=w.get(W)||0;w.set(W,P+1),b++}const k=new Map;for(const[_,S]of w)k.set(_,{coverage:b>0?S/b*100:0,pixelCount:S});URL.revokeObjectURL(h),i(k)}catch(p){URL.revokeObjectURL(h),a(p)}},d.onerror=p=>{URL.revokeObjectURL(h),a(new Error("Failed to load SVG for coverage analysis"))},d.src=h})}function zi(t){if(!t)return null;let e=t.replace("#","").toUpperCase();return e.length===3&&(e=e.split("").map(n=>n+n).join("")),"#"+e}function W9(t,e=10){const n=Array.from(t.entries()),r=new Map,s=new Set;for(const[i,a]of n){if(s.has(i))continue;let l=a.coverage,c=a.pixelCount;const d=vv(i);for(const[u,h]of n){if(i===u||s.has(u))continue;const p=vv(u);Math.max(Math.abs(d.r-p.r),Math.abs(d.g-p.g),Math.abs(d.b-p.b))<=e&&(l+=h.coverage,c+=h.pixelCount,s.add(u))}s.add(i),r.set(i,{coverage:l,pixelCount:c})}return r}function vv(t){const e=t.replace("#","");return{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}}async function G9(t,e={}){try{const r=await(await fetch(t)).text();return U9(r,e)}catch(n){throw console.error("[CoverageAnalyzer] Failed to fetch SVG from URL:",n),n}}const V9=[{code:"RH01",name:"Standard Red",hex:"#A5362F"},{code:"RH02",name:"Bright Red",hex:"#E21F2F"},{code:"RH10",name:"Standard Green",hex:"#609B63"},{code:"RH11",name:"Bright Green",hex:"#3BB44A"},{code:"RH12",name:"Dark Green",hex:"#006C55"},{code:"RH20",name:"Standard Blue",hex:"#0075BC"},{code:"RH21",name:"Purple",hex:"#493D8C"},{code:"RH22",name:"Light Blue",hex:"#47AFE3"},{code:"RH23",name:"Azure",hex:"#039DC4"},{code:"RH26",name:"Turquoise",hex:"#00A6A3"},{code:"RH30",name:"Standard Beige",hex:"#E4C4AA"},{code:"RH31",name:"Cream",hex:"#E8E3D8"},{code:"RH32",name:"Brown",hex:"#8B5F3C"},{code:"RH90",name:"Funky Pink",hex:"#E8457E"},{code:"RH40",name:"Mustard Yellow",hex:"#E5A144"},{code:"RH41",name:"Bright Yellow",hex:"#FFD833"},{code:"RH50",name:"Orange",hex:"#F15B32"},{code:"RH60",name:"Dark Grey",hex:"#59595B"},{code:"RH61",name:"Light Grey",hex:"#939598"},{code:"RH65",name:"Pale Grey",hex:"#D9D9D6"},{code:"RH70",name:"Black",hex:"#231F20"}];function Y9(t){if(!t)return null;const e=zi(t);return V9.find(n=>zi(n.hex)===e)||null}function bv(t){const e=t.replace("#","");return{r:parseInt(e.substring(0,2),16),g:parseInt(e.substring(2,4),16),b:parseInt(e.substring(4,6),16)}}function wv(t,e,n=10){const r=zi(e);if(!r)return 0;for(const[l,c]of t)if(zi(l)===r)return c.coverage;const s=bv(r);let i=null,a=1/0;for(const[l,c]of t){const d=bv(zi(l)),u=Math.max(Math.abs(s.r-d.r),Math.abs(s.g-d.g),Math.abs(s.b-d.b));u<=n&&u<a&&(a=u,i=c)}return i?i.coverage:0}async function _v(t,e,n,r="solid"){var s,i;if(!t||!e)return e||[];try{const a=await G9(t,{canvasSize:600,ignoreWhite:!0,ignoreTransparent:!0}),l=W9(a,5);console.log("[deriveCurrentColors] Coverage analysis:",l);const c=new Map;n&&n.size>0&&n.forEach(h=>{const p=typeof h=="string"?h:h.hex,f=zi(p);f&&p!=="transparent"&&p!=="none"&&(!c.has(f)||h.tpvCode)&&c.set(f,{hex:f,tpvCode:h.tpvCode||null,tpvName:h.tpvName||null,editType:h.editType||"unknown",blendComponents:h.blendComponents||null})});const d=new Map;for(const h of e){const p=zi(((s=h.blendColor)==null?void 0:s.hex)||((i=h.targetColor)==null?void 0:i.hex));if(!p)continue;const f=wv(l,p,10);f>.1&&d.set(p,{...h,targetColor:{...h.targetColor,areaPct:f}})}for(const[h,p]of c)if(!d.has(h)){const f=wv(l,h,10);if(f>.1){const m=p.tpvCode?{code:p.tpvCode,name:p.tpvName}:Y9(h);d.set(h,{originalColor:{hex:h},targetColor:{hex:h,areaPct:f},blendColor:{hex:h},chosenRecipe:p.blendComponents?{components:p.blendComponents,deltaE:0,quality:"Custom Blend"}:{components:m?[{code:m.code,name:m.name,percentage:100,parts:10}]:[{code:"CUSTOM",name:"Custom Color",percentage:100,parts:10}],deltaE:0,quality:m?"Pure TPV Colour":"Custom"},tpvCode:p.tpvCode||(m==null?void 0:m.code)||null,tpvName:p.tpvName||(m==null?void 0:m.name)||null,isAddedFromEdit:!0})}}const u=Array.from(d.values()).sort((h,p)=>{var f,m;return(((f=p.targetColor)==null?void 0:f.areaPct)||0)-(((m=h.targetColor)==null?void 0:m.areaPct)||0)});return console.log("[deriveCurrentColors] Derived colors:",u.length,"colors"),u}catch(a){return console.error("[deriveCurrentColors] Failed to analyze coverage:",a),e}}function q9(t){if(!t||t.size===0)return!1;for(const e of t.values()){const n=typeof e=="string"?e:e.hex;if(n&&n!=="transparent"&&n!=="none")return!0}return!1}const kv={landscape:[{name:"1:1",ratio:1,width:1024,height:1024},{name:"4:3",ratio:4/3,width:1024,height:768},{name:"3:2",ratio:3/2,width:1024,height:683},{name:"16:9",ratio:16/9,width:1024,height:576},{name:"2:1",ratio:2,width:1024,height:512},{name:"3:1",ratio:3,width:1024,height:341}],portrait:[{name:"1:1",ratio:1,width:1024,height:1024},{name:"3:4",ratio:3/4,width:768,height:1024},{name:"2:3",ratio:2/3,width:683,height:1024},{name:"9:16",ratio:9/16,width:576,height:1024},{name:"1:2",ratio:1/2,width:512,height:1024},{name:"1:3",ratio:1/3,width:341,height:1024}]},Ua={safeDifference:.3,tilingThreshold:3.5,framingThreshold:2.5};function X9(t,e){return t/e}function Z9(t){return t>=.95&&t<=1.05?"square":t>1?"landscape":"portrait"}function K9(t,e){const n=e==="portrait"?kv.portrait:kv.landscape;let r=n[0],s=Math.abs(t-r.ratio);for(const i of n){const a=Math.abs(t-i.ratio);a<s&&(s=a,r=i)}return{...r,difference:s}}function J9(t,e,n){return t>=Ua.tilingThreshold||t<=1/Ua.tilingThreshold?{mode:"tiling",reason:"Extreme aspect ratio - design will repeat along length",warning:!0}:n>=Ua.safeDifference||t>=Ua.framingThreshold||t<=1/Ua.framingThreshold?{mode:"framing",reason:"Design panel centered with base color surround",warning:!1}:{mode:"full",reason:"Design fills entire surface",warning:!1}}function Q9(t,e){const n=X9(t,e),r=Z9(n),s=K9(n,r),i=J9(n,s.ratio,s.difference);return{user:{widthMM:t,heightMM:e,aspectRatio:n,orientation:r,formatted:`${(t/1e3).toFixed(1)}m  ${(e/1e3).toFixed(1)}m`},canonical:{name:s.name,ratio:s.ratio,width:s.width,height:s.height,difference:s.difference},layout:i,recraft:{width:s.width,height:s.height,metadata:{targetWidthMM:t,targetHeightMM:e,layoutMode:i.mode}}}}function eG(t){return t.layout.warning||t.layout.mode!=="full"}async function tG(t,e="tpv-studio-uploads"){try{const n=Date.now(),r=Math.random().toString(36).substring(7),s=t.name.split(".").pop(),a=`uploads/${`${n}-${r}.${s}`}`;console.log("[Upload] Uploading file:",t.name,"",a);const{data:l,error:c}=await gn.storage.from(e).upload(a,t,{cacheControl:"3600",upsert:!1});if(c)return console.error("[Upload] Error:",c),{success:!1,error:c.message||"Failed to upload file"};const{data:{publicUrl:d}}=gn.storage.from(e).getPublicUrl(a);return console.log("[Upload] Success:",d),{success:!0,url:d,path:a}}catch(n){return console.error("[Upload] Unexpected error:",n),{success:!1,error:n.message||"Unexpected error during upload"}}}function Sv(t,e={}){const{maxSizeMB:n=10,allowedTypes:r=["image/png","image/jpeg","image/svg+xml"]}=e;if(!t)return{valid:!1,error:"No file selected"};if(!r.includes(t.type))return{valid:!1,error:`Invalid file type. Allowed: ${r.map(a=>a.split("/")[1].toUpperCase()).join(", ")}`};const s=n*1024*1024;return t.size>s?{valid:!1,error:`File too large. Maximum size: ${n}MB`}:{valid:!0}}function nG({onExportSVG:t,onExportPNG:e,onExportPDF:n,onExportTiles:r,onExportDXF:s,onExportCanvasPDF:i,viewMode:a,exporting:l,disabled:c}){const[d,u]=O.useState(!1),h=O.useRef(null);O.useEffect(()=>{const m=y=>{h.current&&!h.current.contains(y.target)&&u(!1)};return d&&document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[d]);const p=a==="solid"?"Solid":"Blend",f=m=>{u(!1),m()};return o.jsxs("div",{className:"playground-export-menu",ref:h,children:[o.jsxs("button",{className:"action-bar__btn action-bar__btn--export",onClick:()=>u(!d),disabled:c||l,children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"}),o.jsx("polyline",{points:"7 10 12 15 17 10"}),o.jsx("line",{x1:"12",y1:"15",x2:"12",y2:"3"})]}),l?"Exporting...":"Export",o.jsx("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{marginLeft:"0.25rem"},children:o.jsx("path",{d:d?"M18 15l-6-6-6 6":"M6 9l6 6 6-6"})})]}),d&&o.jsxs("div",{className:"playground-export-menu__dropdown",children:[o.jsxs("button",{className:"playground-export-menu__item",onClick:()=>f(t),children:[o.jsx("span",{className:"playground-export-menu__icon",children:""}),o.jsxs("div",{className:"playground-export-menu__content",children:[o.jsxs("span",{className:"playground-export-menu__title",children:["Download ",p," SVG"]}),o.jsx("span",{className:"playground-export-menu__desc",children:"Vector format for CAD/printing"})]})]}),o.jsxs("button",{className:"playground-export-menu__item",onClick:()=>f(e),children:[o.jsx("span",{className:"playground-export-menu__icon",children:""}),o.jsxs("div",{className:"playground-export-menu__content",children:[o.jsxs("span",{className:"playground-export-menu__title",children:["Download ",p," PNG"]}),o.jsx("span",{className:"playground-export-menu__desc",children:"High-res image for presentations"})]})]}),o.jsxs("button",{className:"playground-export-menu__item",onClick:()=>f(r),children:[o.jsx("span",{className:"playground-export-menu__icon",children:""}),o.jsxs("div",{className:"playground-export-menu__content",children:[o.jsx("span",{className:"playground-export-menu__title",children:"Download Tiles ZIP"}),o.jsx("span",{className:"playground-export-menu__desc",children:"1m1m SVG tiles for large printing"})]})]}),o.jsx("div",{className:"playground-export-menu__divider"}),o.jsxs("button",{className:"playground-export-menu__item",onClick:()=>f(n),children:[o.jsx("span",{className:"playground-export-menu__icon",children:""}),o.jsxs("div",{className:"playground-export-menu__content",children:[o.jsxs("span",{className:"playground-export-menu__title",children:[p," Recipe Report (PDF)"]}),o.jsx("span",{className:"playground-export-menu__desc",children:"TPV quantities & specifications"})]})]}),i&&o.jsxs("button",{className:"playground-export-menu__item",onClick:()=>f(i),children:[o.jsx("span",{className:"playground-export-menu__icon",children:""}),o.jsxs("div",{className:"playground-export-menu__content",children:[o.jsx("span",{className:"playground-export-menu__title",children:"Canvas PDF (1:100)"}),o.jsx("span",{className:"playground-export-menu__desc",children:"Scaled design with dimensions"})]})]}),s&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"playground-export-menu__divider"}),o.jsxs("button",{className:"playground-export-menu__item",onClick:()=>f(s),children:[o.jsx("span",{className:"playground-export-menu__icon",children:""}),o.jsxs("div",{className:"playground-export-menu__content",children:[o.jsx("span",{className:"playground-export-menu__title",children:"Download DXF"}),o.jsx("span",{className:"playground-export-menu__desc",children:"CAD format for AutoCAD/Rhino"})]})]})]})]})]})}function Wa(t){var n;if(!t)return null;if(t.type==="image/svg+xml")return"svg";if(t.type==="image/png"||t.type==="image/jpeg")return"image";const e=(n=t.name.split(".").pop())==null?void 0:n.toLowerCase();return e==="svg"?"svg":["png","jpg","jpeg"].includes(e)?"image":null}function rG({loadedDesign:t,onDesignSaved:e,isEmbedded:n=!1}){const r=Od(),{inputMode:s,prompt:i,lengthMM:a,widthMM:l,arMapping:c,uploadedFileUrl:d,result:u,jobId:h,blendRecipes:p,colorMapping:f,blendSvgUrl:m,blendEditedColors:y,solidRecipes:v,solidColorMapping:x,solidSvgUrl:g,solidEditedColors:w,viewMode:b,showFinalRecipes:k,showSolidSummary:_,regionOverrides:S,originalTaggedSvg:E,regionOverridesHistory:T,historyIndex:R,designName:W,currentDesignId:P,hasUnsavedChanges:I,resetDesign:C}=r,$=r.setInputMode,fe=r.setPrompt,V=r.setDimensions,K=r.setArMapping;r.setGenerationResult;const F=r.setResult,Z=r.setJobId;r.setBlendState;const U=r.setBlendRecipes,X=r.setColorMapping,ge=r.setBlendSvgUrl;r.setSolidState;const de=r.setSolidRecipes,Q=r.setSolidColorMapping,ke=r.setSolidSvgUrl;r.updateBlendSvgUrl,r.updateSolidSvgUrl;const Oe=r.setBlendEditedColors,De=r.setSolidEditedColors;r.setViewMode;const Be=r.setShowFinalRecipes,Ge=r.setShowSolidSummary,He=r.setRegionOverrides;r.addRegionOverride;const Xe=r.setOriginalTaggedSvg,nt=r.setRegionOverridesHistory,j=r.setHistoryIndex;r.canUndo,r.canRedo,r.undo,r.redo;const ne=r.setDesignName,oe=r.setCurrentDesignId,z=r.loadDesign,A=re=>V(re,a),M=re=>V(l,re),[G,ie]=O.useState(null),[Y,se]=O.useState(null),[we,ue]=O.useState(!1),[q,le]=O.useState(!1),[be,Ne]=O.useState(null),[ze,Pe]=O.useState(null),[te,pe]=O.useState(""),[qe,st]=O.useState(null),[rt,wt]=O.useState(!1),[ct,Ze]=O.useState(null),[ce,ee]=O.useState(!1),[ve,Ve]=O.useState(null),[ot,Ee]=O.useState([]),[St,ht]=O.useState(!1),[Pt,Ke]=O.useState(!1),[Kt,zn]=O.useState(null),[$r,wr]=O.useState(!1),[Dr,ss]=O.useState(!1),[Lr,_r]=O.useState(!1),[is,$t]=O.useState(null),[kr,jt]=O.useState(!1),[Ir,_t]=O.useState(null),[he,Ie]=O.useState(null),[Ct,Cn]=O.useState(null),[Bt,En]=O.useState(null),[vt,Dt]=O.useState(null),[an,Rt]=O.useState(!1),[Ot,Mt]=O.useState(null),sn=O.useRef(null),Vn=O.useRef(null);O.useEffect(()=>{(g||m)&&sn.current&&!Pt&&!rt&&setTimeout(()=>{var re;(re=sn.current)==null||re.scrollIntoView({behavior:"smooth",block:"start"})},300)},[g,m,Pt,rt]),O.useEffect(()=>{(async()=>{try{const Te=await Pd({limit:1,offset:0});Mt(Te.designs.length>0)}catch(Te){console.error("[INSPIRE] Failed to check for existing designs:",Te),Mt(!0)}})()},[]),O.useEffect(()=>{s==="upload"?V(null,null):s==="prompt"&&(l===null||a===null)&&V(5e3,5e3)},[s,V]),O.useEffect(()=>()=>{Vn.current&&Vn.current.abort(),m&&m.startsWith("blob:")&&URL.revokeObjectURL(m),g&&g.startsWith("blob:")&&URL.revokeObjectURL(g)},[]),O.useEffect(()=>{const re=Te=>{Te.key==="Escape"&&ce&&(ee(!1),Ve(null))};return window.addEventListener("keydown",re),()=>window.removeEventListener("keydown",re)},[ce]),O.useEffect(()=>{ot.length>0&&!St&&Ht()},[ot,St]),O.useEffect(()=>{(async()=>{if(!m&&!g){En(null),Dt(null);return}if(!q9(S)){En(p),Dt(v);return}Rt(!0);try{if(m&&p){const Te=await _v(m,p,S,"blend");En(Te)}if(g&&v){const Te=await _v(g,v,S,"solid");Dt(Te)}}catch(Te){console.error("[INSPIRE] Failed to recalculate recipes:",Te),En(p),Dt(v)}finally{Rt(!1)}})()},[m,g,S,p,v]),O.useEffect(()=>{if(t){const re=Yp(t);z(re),t.name&&ne(t.name),t.id&&oe(t.id),setTimeout(async()=>{var Te;if((Te=re.result)!=null&&Te.svg_url){let je=re.originalTaggedSvg||null;if(je)Xe(je);else try{const ft=await(await fetch(re.result.svg_url)).text();je=Jo(ft),Xe(je)}catch(Me){console.error("[INSPIRE] Failed to tag SVG regions:",Me)}try{re.blendRecipes&&re.colorMapping&&await js(re.result.svg_url,re.colorMapping,re.blendRecipes,re.blendEditedColors,je,re.regionOverrides),re.solidRecipes&&re.solidColorMapping&&await On(re.result.svg_url,re.solidColorMapping,re.solidRecipes,re.solidEditedColors,je,re.regionOverrides)}catch(Me){console.error("[INSPIRE] Failed to regenerate SVGs:",Me),Pe("Failed to restore design preview. Please try reloading.")}}},100)}},[t,z,ne,oe,Xe]);const sr=O.useRef(!1);O.useEffect(()=>{if(t||sr.current||!((u==null?void 0:u.svg_url)&&!m&&!g&&(p||v)))return;sr.current=!0,(async()=>{let je=E||null;if(!je)try{const ft=await(await fetch(u.svg_url)).text();je=Jo(ft),Xe(je)}catch(Me){console.error("[INSPIRE] Failed to tag SVG regions:",Me)}try{p&&f&&await js(u.svg_url,f,p,y,je,S),v&&x&&await On(u.svg_url,x,v,w,je,S)}catch(Me){console.error("[INSPIRE] Failed to regenerate SVGs:",Me),Pe("Failed to restore design preview. Please try reloading.")}})()},[u,m,g,p,v,f,x,t,S,E]),O.useEffect(()=>{u||(sr.current=!1)},[u]);const vs=re=>{var Me;const Te=(Me=re.target.files)==null?void 0:Me[0];if(!Te){ie(null);return}const je=Sv(Te,{maxSizeMB:10,allowedTypes:["image/png","image/jpeg","image/svg+xml"]});if(!je.valid){Pe(je.error),ie(null);return}ie(Te),Pe(null)},bs=re=>{re.preventDefault(),re.stopPropagation(),ue(!0)},Tn=re=>{re.preventDefault(),re.stopPropagation(),re.currentTarget===re.target&&ue(!1)},os=re=>{re.preventDefault(),re.stopPropagation()},zr=re=>{re.preventDefault(),re.stopPropagation(),ue(!1);const Te=re.dataTransfer.files;if(Te&&Te.length>0){const je=Te[0],Me=Sv(je,{maxSizeMB:10,allowedTypes:["image/png","image/jpeg","image/svg+xml"]});if(!Me.valid){Pe(Me.error),ie(null);return}ie(je),Pe(null)}},Yn=async()=>{var re,Te;if(s==="prompt"&&!i.trim()){Pe("Please enter a design description");return}if(s==="upload"&&!G){Pe("Please select a file to upload");return}if(s==="upload"&&G&&!Wa(G)){Pe("Unsupported file type. Please upload PNG, JPG, or SVG.");return}Pe(null),le(!0),Ne(null),F(null),Z(null),pe("Initialising..."),st(null);try{let je;if(s==="upload"&&G){const Se=Wa(G);pe(Se==="svg"?"Uploading SVG file...":"Uploading image..."),se("Uploading...");const H=await tG(G);if(!H.success)throw new Error(H.error||"Failed to upload file");if(se(null),Se==="svg"){if(pe("Processing SVG..."),je=await ki.processUploadedSVG({svg_url:H.url}),!je.success)throw new Error(je.error||"Failed to process SVG");Z(je.jobId),pe(" SVG uploaded successfully!"),le(!1);const xe=await ki.getRecraftStatus(je.jobId);Ne(xe),F(xe.result),(re=xe.result)!=null&&re.svg_url&&await ln(xe.result.svg_url,je.jobId);return}else{if(pe("Starting vectorisation..."),je=await ki.vectorizeImage({image_url:H.url}),!je.success)throw new Error(je.error||"Failed to start vectorisation");pe(" AI is vectorising your image...")}}else if(s==="prompt"){const Se=Q9(a,l);if(K(Se),eG(Se)?pe(`Generating ${Se.canonical.name} design panel...`):pe("Initialising..."),je=await ki.generateRecraft({prompt:i.trim(),lengthMM:Se.recraft.height,widthMM:Se.recraft.width}),!je.success)throw new Error(je.error||"Failed to start generation");pe(" AI is creating your design...")}Z(je.jobId),pe("Request submitted, waiting for processing...");let Me=null,ft=Date.now();Vn.current=new AbortController,await ki.waitForRecraftCompletion(je.jobId,Se=>{var xe,$e;Ne(Se);const H=Math.floor((Date.now()-ft)/1e3);if(Se.status==="queued"){const Ue=[` Preparing your canvas... (${H}s)`,` Warming up the AI brushes... (${H}s)`,` Queueing your masterpiece... (${H}s)`,` Mixing digital paints... (${H}s)`,` AI is contemplating your vision... (${H}s)`,` Selecting the perfect colours... (${H}s)`,` Calculating vector paths... (${H}s)`,` Almost ready to create... (${H}s)`],yt=Math.floor(H/4)%Ue.length;pe(Ue[yt])}else if(Se.status==="running")if(Me!=="running")pe(" AI is creating your design..."),Me="running";else{const Ue=[` Creating vector shapes... (${H}s)`,` Applying colours and patterns... (${H}s)`,` Refining design details... (${H}s)`,` Finalising artwork... (${H}s)`],yt=Math.floor(H/5)%Ue.length;pe(Ue[yt])}else if(Se.status==="retrying"){const Ue=((xe=Se.recraft)==null?void 0:xe.attempt_current)||0,yt=(($e=Se.recraft)==null?void 0:$e.attempt_max)||3;pe(` Retrying generation (attempt ${Ue}/${yt})...`)}},2e3,Vn.current.signal);const Ye=await ki.getRecraftStatus(je.jobId);Ne(Ye),F(Ye.result),Ye.status==="completed"&&(pe(" Design ready!"),le(!1),(Te=Ye.result)!=null&&Te.svg_url&&await ln(Ye.result.svg_url,je.jobId))}catch(je){if(je.name==="AbortError")return;console.error("Generation failed:",je),Pe(je.message),pe(""),le(!1)}},qn=()=>{const re=b==="solid"?g:m,Te=b==="solid"?"tpv-solid":"tpv-blend";if(re){const je=document.createElement("a");je.href=re,je.download=`${Te}-${Date.now()}.svg`,document.body.appendChild(je),je.click(),document.body.removeChild(je)}},Sr=async re=>{try{const je=await(await fetch(re)).text(),Ye=new DOMParser().parseFromString(je,"image/svg+xml").querySelector("svg");if(!Ye)return null;let Se,H;const xe=Ye.getAttribute("viewBox");if(xe){const Ue=xe.split(/\s+/).map(Number);Se=Ue[2],H=Ue[3]}else Se=parseFloat(Ye.getAttribute("width"))||1024,H=parseFloat(Ye.getAttribute("height"))||1024;return Se/H}catch(Te){return console.error("[DIMENSION] Failed to detect aspect ratio:",Te),null}},Hs=(re,Te)=>{A(re),M(Te),Cn({width:re,height:Te}),he==="pdf"?setTimeout(()=>ls(re,Te),100):he==="tiles"?setTimeout(()=>Pn(re,Te),100):he==="insitu"?setTimeout(()=>_r(!0),100):he==="save"&&wr(!0),Ie(null)},ws=async()=>{const re=b==="solid"?g:m;if(s==="upload"&&(!l||!a)){const Te=await Sr(re);if(Te){_t(Te),Ie("insitu"),jt(!0);return}else{_t(1),Ie("insitu"),jt(!0);return}}_r(!0)},_s=()=>{const re=b==="solid"?g:m,Te=b==="solid"?"tpv-solid":"tpv-blend";if(re){const je=new Image;je.onload=()=>{const Me=document.createElement("canvas");Me.width=je.naturalWidth||1e3,Me.height=je.naturalHeight||1e3,Me.getContext("2d").drawImage(je,0,0),Me.toBlob(Ye=>{const Se=URL.createObjectURL(Ye),H=document.createElement("a");H.href=Se,H.download=`${Te}-${Date.now()}.png`,document.body.appendChild(H),H.click(),document.body.removeChild(H),URL.revokeObjectURL(Se)})},je.src=re}},ks=()=>{I()&&!window.confirm(`Start a new design?

You have unsaved changes that will be lost.`)||(C(),ie(null),le(!1),Ne(null),Pe(null),pe(""),st(null),wt(!1),Ze(null),ee(!1),Ve(null),Ke(!1),zn(null))},as=async()=>{const re=b==="solid"?g:m,Te=l>0&&a>0;if(s==="upload"&&!Te){const Me=await Sr(re);if(Me){_t(Me),Ie("save"),jt(!0);return}else{_t(1),Ie("save"),jt(!0);return}}wr(!0)},[Fr,Nn]=O.useState(!1),ir=async()=>{const re=b==="solid"?g:m;if(s==="upload"&&(!l||!a)){const Te=await Sr(re);if(Te){_t(Te),Ie("pdf"),jt(!0);return}else{_t(1),Ie("pdf"),jt(!0);return}}await ls(l,a)},ls=async(re,Te)=>{const je=b==="solid"?g:m,Me=b==="solid"?vt||v:Bt||p,ft=b==="solid"?"tpv-solid":"tpv-blend";if(!je||!Me){Pe("Cannot generate PDF: missing SVG or recipes");return}Nn(!0),Pe(null);try{const Se=await(await fetch(je)).text(),H=new AbortController,xe=setTimeout(()=>H.abort(),3e4),$e=await Kr.getSession(),Ue={"Content-Type":"application/json"};$e!=null&&$e.access_token&&(Ue.Authorization=`Bearer ${$e.access_token}`);const yt=await fetch("/api/export-pdf",{method:"POST",headers:Ue,signal:H.signal,body:JSON.stringify({svgString:Se,designName:W||i||"TPV Design",projectName:"TPV Studio",dimensions:{widthMM:re,lengthMM:Te},recipes:Me,mode:b,designId:h||""})});if(clearTimeout(xe),!yt.ok){const Zn=yt.headers.get("content-type");if(Zn&&Zn.includes("application/json")){const ar=await yt.json();throw new Error(ar.message||"PDF generation failed")}else{const ar=await yt.text();throw console.error("PDF API error response:",ar),new Error(`Server error: ${yt.status}`)}}const lt=await yt.blob(),mt=URL.createObjectURL(lt),gt=document.createElement("a");gt.href=mt,gt.download=`${ft}-${Date.now()}.pdf`,document.body.appendChild(gt),gt.click(),document.body.removeChild(gt),URL.revokeObjectURL(mt)}catch(Ye){console.error("PDF download error:",Ye),Ye.name==="AbortError"?Pe("PDF generation timed out. Please try again."):Pe(`PDF generation failed: ${Ye.message}`)}finally{Nn(!1)}},xn=async()=>{const re=b==="solid"?g:m;if(!re){Pe("No SVG available to slice");return}if(s==="upload"&&(!l||!a)){const Te=await Sr(re);if(Te){_t(Te),Ie("tiles"),jt(!0);return}else{_t(1),Ie("tiles"),jt(!0);return}}await Pn(l,a)},Pn=async(re,Te)=>{const je=b==="solid"?g:m;try{await ZT(je,{width:re,length:Te},W||"tpv-design")}catch(Me){console.error("Tile download error:",Me),Pe(`Failed to download tiles: ${Me.message}`)}},ln=async(re=null,Te=null)=>{const je=re||(u==null?void 0:u.svg_url),Me=Te||h;if(!je){Pe("No SVG available to analyse");return}{Pe(null),pe(" Processing design colours...");let ft=null;try{const Se=await(await fetch(je)).text();ft=Jo(Se),Xe(ft)}catch(Ye){console.error("[TPV-STUDIO] Failed to tag SVG regions:",Ye)}await Us(je,Me,ft);return}},or=async()=>{wt(!1),Ze(null),Ke(!1),zn(null),b==="solid"?De(new Map):Oe(new Map),u!=null&&u.svg_url&&await ln(u.svg_url,h)},jr=async re=>{var Te;if(!W){if(!i||s!=="prompt"){G&&ne(`TPV Design  ${G.name.replace(/\.[^/.]+$/,"")}`);return}ss(!0);try{const je=(re==null?void 0:re.slice(0,6).map(ft=>{var Se,H;const Ye=(H=(Se=ft.chosenRecipe)==null?void 0:Se.components)==null?void 0:H[0];return(Ye==null?void 0:Ye.name)||null}).filter(Boolean))||[],Me=await ki.generateDesignName({prompt:i,colors:je,dimensions:{widthMM:l,lengthMM:a}});Me.success&&((Te=Me.names)==null?void 0:Te.length)>0?ne(Me.names[0]):ne(Xn(i))}catch(je){console.error("[TPV-STUDIO] Name generation failed:",je),ne(Xn(i))}finally{ss(!1)}}},Xn=re=>re?`TPV Design  ${re.split(/[,.]/)[0].trim().slice(0,40)}`:"TPV Playground Design",Us=async(re=null,Te=null,je=null)=>{const Me=re||(u==null?void 0:u.svg_url),ft=Te||h,Ye=je||E;if(Me)try{const Se=await fetch("/api/solid-recipes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({svg_url:Me,job_id:ft,max_colors:15})}),H=await Se.json();if(!Se.ok)throw new Error(H.error||"Failed to generate solid recipes");if(H.success){de(H.recipes);const xe=new Map(Object.entries(H.colorMapping||{}));Q(xe);try{const{dataUrl:$e,stats:Ue}=await Oi(Me,xe,Ye);ke($e),Ue.colorsNotMapped&&Ue.colorsNotMapped.size>0&&console.warn("[TPV-STUDIO] Unmapped colors in solid mode:",Array.from(Ue.colorsNotMapped)),jr(H.recipes)}catch($e){console.error("[TPV-STUDIO] Failed to generate solid SVG:",$e)}}}catch(Se){console.error("[TPV-STUDIO] Solid generation failed:",Se)}},Ss=(re,Te="palette")=>{if(ce&&ve&&Te==="palette"){cn(ve.regionId,re.hex),ee(!1),Ve(null);return}Te==="palette"&&(b==="blend"?(zn(re),Ke(!0),Be(!1)):(Ze(re),wt(!0),Ge(!1)))},Nt=re=>{ce?(cn(ve.regionId,re.sourceColor),ee(!1),Ve(null)):(ee(!0),Ve(re))},cn=(re,Te)=>{const je=typeof Te=="string"?{hex:Te,editType:"eyedrop"}:Te;Ee(Me=>[...Me,{regionId:re,colorData:{...je,hex:je.hex.toLowerCase()},viewMode:b}])},Ht=async()=>{if(St||ot.length===0)return;ht(!0);const re=ot[0],Te=re.colorData;try{const je=new Map(S);je.set(re.regionId,Te),re.viewMode==="blend"?await _n(null,null,je):await Br(null,null,je),He(je);const Me=r.historyIndex,Ye=r.regionOverridesHistory.slice(0,Me+1);Ye.push(new Map(je)),Ye.length>50&&Ye.shift(),nt(Ye),j(Ye.length-1)}catch(je){console.error("[TPV-STUDIO] Failed to process region recolor:",je)}finally{Ee(je=>je.slice(1)),ht(!1)}},Lt=()=>{ee(!1),Ve(null)},Rn=()=>{ve&&(cn(ve.regionId,"transparent"),ee(!1),Ve(null))},Ut=re=>{if(!ve)return;const Te={hex:re.hex,tpvCode:re.code,tpvName:re.name,originalHex:ve.sourceColor,editType:"solid"};cn(ve.regionId,Te),ee(!1),Ve(null)},to=async()=>{if(R<=0)return;const re=R-1,Te=T[re];He(new Map(Te)),j(re),b==="blend"?await _n(null,null,Te):await Br(null,null,Te)},Ws=async()=>{if(R>=T.length-1)return;const re=R+1,Te=T[re];He(new Map(Te)),j(re),b==="blend"?await _n(null,null,Te):await Br(null,null,Te)},Fn=async re=>{if(ct)if(b==="solid"){const je=(vt||v).find(Me=>Me.targetColor.hex.toLowerCase()===ct.hex.toLowerCase());if(je!=null&&je.isAddedFromEdit){const Me=ct.hex.toLowerCase(),ft=new Map(S),Ye=wn.find(H=>H.hex.toLowerCase()===re.toLowerCase());S.forEach((H,xe)=>{(typeof H=="string"?H:H.hex).toLowerCase()===Me&&ft.set(xe,{hex:re,tpvCode:(Ye==null?void 0:Ye.code)||null,tpvName:(Ye==null?void 0:Ye.name)||null,originalHex:H.originalHex||Me,editType:"solid"})});const Se=T.slice(0,R+1);Se.push(new Map(ft)),Se.length>50&&Se.shift(),He(ft),nt(Se),j(Se.length-1),Ze({...ct,hex:re,blendHex:re}),await Br(w,re,ft)}else{const Me=new Map(w);((je==null?void 0:je.mergedOriginalColors)||[ct.originalHex.toLowerCase()]).forEach(Ye=>{Me.set(Ye,{newHex:re.toLowerCase()})}),De(Me),Ze({...ct,hex:re,blendHex:re}),await Br(Me,re)}}else{const Te=new Map(y);Te.set(ct.originalHex.toLowerCase(),{newHex:re.toLowerCase()}),Oe(Te),Ze({...ct,hex:re,blendHex:re}),await _n(Te,re)}};O.useCallback(async({blendHex:re,parts:Te,recipe:je})=>{if(Kt)if(Kt.isAddedFromEdit){const Me=Kt.hex.toLowerCase(),ft=new Map(S);S.forEach((Se,H)=>{(typeof Se=="string"?Se:Se.hex).toLowerCase()===Me&&ft.set(H,{hex:re,originalHex:Se.originalHex||Me,editType:"blend",blendComponents:(je==null?void 0:je.components)||null})}),zn({...Kt,hex:re,blendHex:re}),await _n(y,re,ft);const Ye=T.slice(0,R+1);Ye.push(new Map(ft)),Ye.length>50&&Ye.shift(),He(ft),nt(Ye),j(Ye.length-1)}else{const Me=new Map(y);Me.set(Kt.originalHex.toLowerCase(),{newHex:re.toLowerCase(),recipe:je,parts:Te}),Oe(Me),zn({...Kt,hex:re,blendHex:re}),await _n(Me,re)}},[Kt,y,S,T,R,u,f]);const _n=async(re=null,Te=null,je=null)=>{if(!(!(u!=null&&u.svg_url)||!f||!p))try{const Me=new Map(f),ft=re||y;ft.forEach((lt,mt)=>{if(lt.newHex){const gt=mt.toLowerCase();Me.set(gt,{...Me.get(gt),blendHex:lt.newHex})}});const Ye=p.map(lt=>{const mt=ft.get(lt.originalColor.hex.toLowerCase());if(mt!=null&&mt.newHex){const gt={...lt,targetColor:{...lt.targetColor,hex:mt.newHex},blendColor:{...lt.blendColor,hex:mt.newHex}};return mt.recipe&&mt.recipe.components&&(gt.chosenRecipe={...lt.chosenRecipe,components:mt.recipe.components,deltaE:0,quality:"Excellent"}),gt}return lt}),{svgText:Se,stats:H}=await Oi(u.svg_url,Me,E),xe=je!==null?je:S,$e=Wo(Se,xe);m&&m.startsWith("blob:")&&URL.revokeObjectURL(m);const Ue=new Blob([$e],{type:"image/svg+xml"}),yt=URL.createObjectURL(Ue);ge(yt),X(Me),U(Ye),xe.size>0}catch(Me){console.error("[TPV-STUDIO] Failed to regenerate blend SVG:",Me)}},Br=async(re=null,Te=null,je=null)=>{if(!(!(u!=null&&u.svg_url)||!x||!v))try{const Me=new Map(x),ft=re||w;ft.forEach((lt,mt)=>{if(lt.newHex){const gt=mt.toLowerCase();Me.set(gt,{...Me.get(gt),blendHex:lt.newHex})}});const Ye=v.map(lt=>{const mt=ft.get(lt.originalColor.hex.toLowerCase());if(mt!=null&&mt.newHex){const gt=wn.find(Zn=>Zn.hex.toLowerCase()===mt.newHex.toLowerCase());return gt?{...lt,targetColor:{...lt.targetColor,hex:mt.newHex},blendColor:{hex:mt.newHex,rgb:gt.rgb,lab:gt.lab},chosenRecipe:{components:[{code:gt.code,name:gt.name,hex:gt.hex,rgb:gt.rgb,lab:gt.lab,ratio:1}],blendColor:{hex:gt.hex,rgb:gt.rgb,lab:gt.lab},deltaE:0,quality:"Perfect"}}:{...lt,targetColor:{...lt.targetColor,hex:mt.newHex},blendColor:{...lt.blendColor,hex:mt.newHex}}}return lt}),{svgText:Se,stats:H}=await Oi(u.svg_url,Me,E),xe=je!==null?je:S,$e=Wo(Se,xe);g&&g.startsWith("blob:")&&URL.revokeObjectURL(g);const Ue=new Blob([$e],{type:"image/svg+xml"}),yt=URL.createObjectURL(Ue);ke(yt),Q(Me),de(Ye),xe.size>0}catch(Me){console.error("[TPV-STUDIO] Failed to regenerate solid SVG:",Me)}},bi=re=>{if(!(re!=null&&re.components))return null;const Te={};return re.components.forEach(je=>{je.code&&je.parts&&(Te[je.code]=je.parts)}),Object.keys(Te).length>0?{parts:Te}:null};O.useCallback(re=>{var je;if(!re)return null;const Te=y.get((je=re.originalHex)==null?void 0:je.toLowerCase());return Te!=null&&Te.recipe?Te.recipe:re.isAddedFromEdit&&re.chosenRecipe?bi(re.chosenRecipe):re.recipe||null},[y]);const js=async(re,Te,je,Me,ft=null,Ye=null)=>{try{const Se=new Map(Te);Me&&Me.size>0&&Me.forEach((lt,mt)=>{const gt=mt.toLowerCase();Se.has(gt)&&Se.set(gt,{...Se.get(gt),blendHex:lt.newHex})});const{dataUrl:H,svgText:xe}=await Oi(re,Se,ft);let $e=xe;Ye&&Ye.size>0&&($e=Wo(xe,Ye));const Ue=new Blob([$e],{type:"image/svg+xml"}),yt=URL.createObjectURL(Ue);ge(yt)}catch(Se){console.error("[INSPIRE] Failed to regenerate blend SVG:",Se)}},On=async(re,Te,je,Me,ft=null,Ye=null)=>{try{const Se=new Map(Te);Me&&Me.size>0&&Me.forEach((lt,mt)=>{const gt=mt.toLowerCase();Se.has(gt)&&Se.set(gt,{...Se.get(gt),blendHex:lt.newHex})});const{dataUrl:H,svgText:xe}=await Oi(re,Se,ft);let $e=xe;Ye&&Ye.size>0&&($e=Wo(xe,Ye));const Ue=new Blob([$e],{type:"image/svg+xml"}),yt=URL.createObjectURL(Ue);ke(yt)}catch(Se){console.error("[INSPIRE] Failed to regenerate solid SVG:",Se)}};return o.jsxs("div",{className:`inspire-panel-recraft${n?" inspire-panel-recraft--embedded":""}`,children:[!n&&o.jsxs("div",{className:"panel-header",children:[o.jsx("h2",{children:"TPV Studio - Vector AI"}),o.jsx("p",{className:"subtitle",children:"AI-powered vector designs for playground surfacing"})]}),!u&&!q&&Ot===!1&&o.jsxs("div",{className:"welcome-guidance",children:[o.jsx("div",{className:"welcome-icon",children:""}),o.jsx("h3",{children:"Create Your First Design"}),o.jsx("p",{children:"Choose how you'd like to create your TPV design below. You can describe what you want, upload an image to convert, or process an existing SVG file. Once generated, you'll be able to edit colours, export PDFs with specifications, and preview designs on-site."})]}),o.jsxs("div",{className:"input-mode-tabs",children:[o.jsxs("button",{className:`input-mode-tab ${s==="prompt"?"active":""}`,onClick:()=>{$("prompt"),ie(null),Pe(null)},disabled:q,children:[o.jsxs("svg",{className:"mode-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M12 3l1.545 4.635L18.18 9.18l-4.635 1.545L12 15.36l-1.545-4.635L5.82 9.18l4.635-1.545L12 3z"}),o.jsx("path",{d:"M5 21l1.5-4.5L2 15l4.5-1.5L8 9l1.5 4.5L14 15l-4.5 1.5L8 21z",opacity:"0.5"})]}),o.jsx("span",{className:"mode-title",children:"Text Prompt"}),o.jsx("span",{className:"mode-description",children:"Describe your design"})]}),o.jsxs("button",{className:`input-mode-tab ${s==="upload"?"active":""}`,onClick:()=>{$("upload"),fe(""),Pe(null)},disabled:q,children:[o.jsxs("svg",{className:"mode-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),o.jsx("polyline",{points:"17 8 12 3 7 8"}),o.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),o.jsx("span",{className:"mode-title",children:"Upload Design"}),o.jsx("span",{className:"mode-description",children:"PNG, JPG, or SVG"})]})]}),o.jsxs("div",{className:"form-section",children:[s==="prompt"&&o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"prompt",children:"Design Description"}),o.jsx("textarea",{id:"prompt",value:i,onChange:re=>fe(re.target.value),placeholder:"e.g., calm ocean theme with big fish silhouettes and waves",rows:4,disabled:q,className:"prompt-input"}),o.jsx("p",{className:"helper-text",children:"Describe the design you want to generate. The AI will create a vector illustration based on your description. Perfect for creating completely new designs from scratch - just describe colors, themes, and elements you want."})]}),s==="upload"&&o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"design-upload",children:"Upload Design File"}),o.jsxs("div",{className:`drop-zone ${we?"dragging":""} ${G?"has-file":""}`,onDragEnter:bs,onDragLeave:Tn,onDragOver:os,onDrop:zr,children:[o.jsx("input",{id:"design-upload",type:"file",accept:".png,.jpg,.jpeg,.svg,image/png,image/jpeg,image/svg+xml",onChange:vs,disabled:q,className:"file-input-hidden"}),o.jsx("label",{htmlFor:"design-upload",className:"drop-zone-content",children:G?o.jsxs(o.Fragment,{children:[o.jsxs("svg",{className:"upload-icon success",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),o.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),o.jsx("span",{className:"file-name",children:G.name}),o.jsx("span",{className:"file-type-badge",children:Wa(G)==="svg"?"SVG - will process immediately":"Image - will vectorise with AI"}),o.jsx("span",{className:"drop-hint",children:"Click to change file"})]}):o.jsxs(o.Fragment,{children:[o.jsxs("svg",{className:"upload-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),o.jsx("polyline",{points:"17 8 12 3 7 8"}),o.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),o.jsx("span",{className:"drop-text",children:"Drag & drop your design here"}),o.jsx("span",{className:"drop-hint",children:"or click to browse"}),o.jsx("span",{className:"supported-formats",children:"PNG, JPG, or SVG"})]})})]}),o.jsxs("p",{className:"helper-text",children:["Upload your design file. ",o.jsx("strong",{children:"PNG/JPG"})," images will be vectorised with AI (~30 seconds). ",o.jsx("strong",{children:"SVG"})," files are processed immediately for TPV colour matching."]})]}),s==="prompt"&&o.jsxs("div",{className:"form-row",children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"length",children:"Length (mm)"}),o.jsx("input",{id:"length",type:"number",value:a,onChange:re=>M(parseInt(re.target.value,10)),min:1e3,max:2e4,step:100,disabled:q})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{htmlFor:"width",children:"Width (mm)"}),o.jsx("input",{id:"width",type:"number",value:l,onChange:re=>A(parseInt(re.target.value,10)),min:1e3,max:2e4,step:100,disabled:q})]})]}),ze&&o.jsxs("div",{className:"error-message",children:[o.jsx("strong",{children:"Error:"})," ",ze]}),Y&&o.jsx("div",{className:"upload-progress",children:o.jsx("p",{children:Y})}),o.jsx("button",{onClick:Yn,disabled:q||s==="prompt"&&!i.trim()||s==="upload"&&!G,className:"generate-button",children:q?s==="upload"&&G&&Wa(G)==="svg"?"Processing...":"Generating...":s==="prompt"?"Generate Vector Design":G&&Wa(G)==="svg"?"Process SVG":"Vectorise & Process"})]}),q&&o.jsxs("div",{className:"progress-section",children:[o.jsx("div",{className:"progress-bar",children:o.jsx("div",{className:"progress-bar-fill"})}),o.jsx("p",{className:"progress-message",children:te})]}),u&&!q&&o.jsxs("div",{className:"results-section",children:[c&&o.jsxs("div",{className:`ar-info ${c.layout.mode}`,children:[o.jsxs("div",{className:"ar-info-header",children:[o.jsx("strong",{children:"Layout:"})," ",c.layout.reason]}),o.jsxs("div",{className:"ar-info-details",children:[o.jsxs("span",{children:["Requested: ",c.user.formatted]}),o.jsx("span",{children:""}),o.jsxs("span",{children:["Generated: ",c.canonical.name," panel"]}),c.layout.mode==="framing"&&o.jsxs(o.Fragment,{children:[o.jsx("span",{children:""}),o.jsx("span",{className:"layout-note",children:"Panel centred with base colour surround"})]}),c.layout.mode==="tiling"&&o.jsxs(o.Fragment,{children:[o.jsx("span",{children:""}),o.jsx("span",{className:"layout-note",children:"Pattern will repeat along length"})]})]})]}),Ri.BLEND_MODE_ENABLED,Ri.BLEND_MODE_ENABLED,b==="solid"&&g&&v&&o.jsx("div",{ref:sn,children:o.jsx(h3,{blendSvgUrl:g,recipes:vt||v,mode:"solid",onColorClick:Ss,onRegionClick:Nt,onEyedropperCancel:Lt,onMakeTransparent:Rn,onSelectTPVColor:Ut,selectedColor:ct,editedColors:w,onResetAll:or,designName:W,onNameChange:ne,isNameLoading:Dr,onInSituClick:ws,eyedropperActive:ce,eyedropperRegion:ve,onRegionUndo:to,onRegionRedo:Ws,canUndo:R>0,canRedo:R<T.length-1,regionOverridesCount:S.size})}),Ri.BLEND_MODE_ENABLED,(m||g)&&o.jsxs("div",{className:"action-bar",children:[o.jsxs("button",{className:"action-bar__btn action-bar__btn--secondary",onClick:ks,title:"Start a new design",children:[o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M12 5v14M5 12h14"})}),"New"]}),o.jsxs("button",{className:"action-bar__btn action-bar__btn--primary",onClick:as,title:"Save this design to your gallery",children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"}),o.jsx("polyline",{points:"17 21 17 13 7 13 7 21"}),o.jsx("polyline",{points:"7 3 7 8 15 8"})]}),"Save"]}),o.jsx(nG,{onExportSVG:qn,onExportPNG:_s,onExportPDF:ir,onExportTiles:xn,viewMode:b,exporting:Fr,disabled:!(m||g)})]})]}),Ri.BLEND_MODE_ENABLED,b==="solid"&&g&&v&&!_&&o.jsxs("div",{className:"finalize-section",children:[o.jsx("button",{onClick:()=>Ge(!0),className:"finalize-button",children:"View TPV Colours Used"}),o.jsx("p",{className:"finalize-hint",children:"See which pure TPV colours are used in this design"})]}),Ri.BLEND_MODE_ENABLED,_&&v&&o.jsx(c3,{recipes:vt||v,onClose:()=>{Ge(!1)},isRecalculating:an}),rt&&ct&&o.jsx(S9,{color:ct,mode:b,onColorChange:Fn,onClose:()=>{wt(!1),Ze(null)}}),$r&&o.jsx(E9,{currentState:{inputMode:s,prompt:i,selectedFile:G,lengthMM:(Ct==null?void 0:Ct.height)||a,widthMM:(Ct==null?void 0:Ct.width)||l,result:u,viewMode:b,blendRecipes:p,solidRecipes:v,colorMapping:f,solidColorMapping:x,solidEditedColors:w,blendEditedColors:y,blendSvgUrl:m,solidSvgUrl:g,arMapping:c,jobId:h,inSituData:is,regionOverrides:S,originalTaggedSvg:E},existingDesignId:P,initialName:W,onClose:()=>{wr(!1),Cn(null)},onSaved:(re,Te)=>{wr(!1),Cn(null),Mt(!0),Te&&ne(Te),e&&e(Te)}}),Lr&&o.jsx($2,{designUrl:b==="solid"?g:m,designDimensions:{width:l,length:a},onClose:()=>_r(!1),onSaved:re=>{$t(re),_r(!1)}}),o.jsx(B9,{isOpen:kr,onClose:()=>{jt(!1),Ie(null)},onConfirm:Hs,aspectRatio:Ir,defaultLongestSide:5e3}),o.jsx("style",{jsx:!0,children:`
        .inspire-panel-recraft {
          max-width: var(--max-width-xl);
          margin: 0 auto;
          padding: var(--space-4);
        }

        .panel-header {
          text-align: center;
          margin-bottom: var(--space-6);
        }

        .panel-header h2 {
          font-family: var(--font-heading);
          font-size: var(--text-3xl);
          margin: 0 0 var(--space-2) 0;
          color: var(--color-primary);
          font-weight: var(--font-bold);
          letter-spacing: var(--tracking-tight);
        }

        .subtitle {
          color: var(--color-text-secondary);
          font-size: var(--text-base);
          line-height: var(--leading-relaxed);
        }

        /* Welcome Guidance */
        .welcome-guidance {
          background: linear-gradient(135deg, #fff5f0 0%, #fff9f7 100%);
          border: 2px solid #ff6b35;
          border-radius: var(--radius-lg);
          padding: var(--space-6);
          margin-bottom: var(--space-6);
          text-align: center;
        }

        .welcome-icon {
          font-size: 3rem;
          margin-bottom: var(--space-2);
        }

        .welcome-guidance h3 {
          margin: 0 0 var(--space-3);
          font-size: var(--text-xl);
          font-weight: var(--font-bold);
          color: var(--color-primary);
        }

        .welcome-guidance p {
          margin: 0;
          color: var(--color-text-secondary);
          font-size: var(--text-base);
          line-height: var(--leading-relaxed);
          max-width: 600px;
          margin-left: auto;
          margin-right: auto;
        }

        /* Input Mode Tabs - Enhanced cards */
        .input-mode-tabs {
          display: flex;
          gap: var(--space-2);
          margin-bottom: var(--space-3);
          background: var(--color-bg-subtle);
          padding: var(--space-1);
          border-radius: var(--radius-lg);
        }

        .input-mode-tab {
          flex: 1;
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: var(--space-1);
          padding: var(--space-3);
          background: var(--color-bg-card);
          border: 1px solid var(--color-border);
          border-radius: var(--radius-md);
          cursor: pointer;
          transition: all var(--transition-base);
        }

        .input-mode-tab:hover:not(:disabled) {
          border-color: var(--color-primary);
          transform: translateY(-2px);
          box-shadow: var(--shadow-md);
        }

        .input-mode-tab.active {
          background: linear-gradient(135deg, var(--color-bg-subtle) 0%, var(--color-bg-card) 100%);
          border-color: var(--color-primary);
          box-shadow: var(--shadow-glow);
        }

        .input-mode-tab:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .mode-icon {
          width: 28px;
          height: 28px;
          color: var(--color-text-secondary);
          transition: all var(--transition-base);
        }

        .input-mode-tab:hover:not(:disabled) .mode-icon {
          color: var(--color-primary);
          transform: scale(1.1);
        }

        .input-mode-tab.active .mode-icon {
          color: var(--color-primary);
        }

        .input-mode-tab .mode-title {
          font-family: var(--font-heading);
          font-size: var(--text-sm);
          font-weight: var(--font-semibold);
          color: var(--color-text-primary);
          margin-top: 0;
        }

        .input-mode-tab .mode-description {
          display: none; /* Hidden to save space */
        }

        .input-mode-tab.active .mode-title {
          color: var(--color-primary);
          font-weight: var(--font-bold);
        }

        /* Helper text */
        .helper-text {
          margin-top: var(--space-1);
          font-size: var(--text-sm);
          color: var(--color-text-tertiary);
          font-style: normal;
          line-height: var(--leading-snug);
        }

        /* Drag & Drop File Upload */
        .file-input-hidden {
          position: absolute;
          width: 1px;
          height: 1px;
          padding: 0;
          margin: -1px;
          overflow: hidden;
          clip: rect(0, 0, 0, 0);
          white-space: nowrap;
          border: 0;
        }

        .drop-zone {
          position: relative;
          width: 100%;
          min-height: 120px;
          border: 2px dashed var(--color-border);
          border-radius: var(--radius-lg);
          background: var(--color-bg-subtle);
          transition: all var(--transition-base);
        }

        .drop-zone.dragging {
          border-color: var(--color-primary);
          background: var(--color-primary-light);
          background: linear-gradient(135deg, rgba(30, 74, 122, 0.05) 0%, rgba(30, 74, 122, 0.1) 100%);
          box-shadow: var(--shadow-glow);
        }

        .drop-zone.has-file {
          border-color: var(--color-success);
          background: var(--color-success-light);
        }

        .drop-zone-content {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          gap: var(--space-1);
          padding: var(--space-4);
          cursor: pointer;
          min-height: 120px;
        }

        .upload-icon {
          width: 36px;
          height: 36px;
          color: var(--color-text-secondary);
          transition: all var(--transition-base);
        }

        .upload-icon.success {
          color: var(--color-success);
        }

        .drop-zone:hover .upload-icon {
          color: var(--color-primary);
          transform: scale(1.1);
        }

        .drop-zone.has-file:hover .upload-icon.success {
          color: var(--color-success);
        }

        .drop-text {
          font-size: var(--text-base);
          font-weight: var(--font-semibold);
          color: var(--color-text-primary);
        }

        .file-name {
          font-size: var(--text-base);
          font-weight: var(--font-semibold);
          color: var(--color-success);
          max-width: 100%;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
        }

        .drop-hint {
          font-size: var(--text-sm);
          color: var(--color-text-tertiary);
        }

        .file-type-badge {
          display: inline-block;
          font-size: var(--text-xs);
          color: var(--color-text-secondary);
          background: var(--color-bg-tertiary);
          padding: var(--space-1) var(--space-2);
          border-radius: var(--radius-sm);
          margin-top: var(--space-1);
        }

        .supported-formats {
          display: block;
          font-size: var(--text-xs);
          color: var(--color-text-tertiary);
          margin-top: var(--space-2);
          font-weight: var(--font-medium);
        }

        .drop-zone.dragging .drop-text,
        .drop-zone.dragging .drop-hint {
          color: var(--color-primary);
        }

        .upload-progress {
          padding: var(--space-2);
          background: var(--color-info-light);
          border: 1px solid var(--color-info);
          border-radius: var(--radius-md);
          color: var(--color-info);
          margin-bottom: var(--space-2);
          text-align: center;
          font-size: var(--text-sm);
        }

        .form-section {
          background: var(--color-bg-card);
          padding: var(--space-3);
          border-radius: var(--radius-lg);
          margin-bottom: var(--space-3);
          border: 1px solid var(--color-border);
          box-shadow: var(--shadow-xs);
        }

        .form-group {
          margin-bottom: var(--space-3);
        }

        .form-group label {
          display: block;
          margin-bottom: var(--space-2);
          font-weight: var(--font-semibold);
          color: var(--color-text-primary);
          font-size: var(--text-sm);
        }

        .prompt-input {
          width: 100%;
          padding: var(--space-3);
          border: 1px solid var(--color-border);
          border-radius: var(--radius-md);
          font-family: inherit;
          font-size: var(--text-base);
          background: var(--color-bg-card);
          color: var(--color-text-primary);
          transition: border-color var(--transition-base);
        }

        .prompt-input:focus {
          outline: none;
          border-color: var(--color-primary);
          box-shadow: var(--shadow-glow);
        }

        .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: var(--space-3);
        }

        input[type="number"] {
          width: 100%;
          padding: var(--space-2);
          border: 1px solid var(--color-border);
          border-radius: var(--radius-md);
          background: var(--color-bg-card);
          color: var(--color-text-primary);
          font-size: var(--text-base);
          transition: border-color var(--transition-base);
        }

        input[type="number"]:focus {
          outline: none;
          border-color: var(--color-primary);
          box-shadow: var(--shadow-glow);
        }

        .error-message {
          padding: var(--space-3);
          background: var(--color-error-light);
          border: 1px solid var(--color-error);
          border-radius: var(--radius-md);
          color: var(--color-error);
          margin-bottom: var(--space-4);
          font-size: var(--text-sm);
        }

        .generate-button {
          width: 100%;
          padding: var(--space-4);
          background: var(--color-accent);
          color: white;
          border: none;
          border-radius: var(--radius-md);
          font-size: var(--text-lg);
          font-weight: var(--font-semibold);
          cursor: pointer;
          transition: all var(--transition-base);
          box-shadow: var(--shadow-sm);
        }

        .generate-button:hover:not(:disabled) {
          background: var(--color-accent-hover);
          transform: translateY(-2px);
          box-shadow: 0 8px 24px rgba(255, 107, 53, 0.3);
        }

        .generate-button:disabled {
          background: var(--color-bg-subtle);
          color: var(--color-text-tertiary);
          cursor: not-allowed;
          transform: none;
          box-shadow: none;
        }

        .progress-section {
          padding: var(--space-4);
          background: var(--color-info-light);
          border-radius: var(--radius-lg);
          margin-bottom: var(--space-4);
          border: 1px solid var(--color-info);
        }

        .progress-bar {
          height: 4px;
          background: var(--color-border);
          border-radius: var(--radius-full);
          overflow: hidden;
          margin-bottom: var(--space-3);
        }

        .progress-bar-fill {
          height: 100%;
          background: var(--color-accent);
          animation: progress 2s ease-in-out infinite;
        }

        @keyframes progress {
          0% { transform: translateX(-100%); }
          100% { transform: translateX(100%); }
        }

        .progress-message {
          text-align: center;
          color: var(--color-text-secondary);
          font-weight: var(--font-medium);
          font-size: var(--text-base);
        }

        .results-section {
          background: var(--color-bg-card);
          padding: var(--space-4);
          border-radius: var(--radius-lg);
          border: 1px solid var(--color-border);
          box-shadow: var(--shadow-sm);
        }

        .results-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: var(--space-3);
        }

        .results-header h3 {
          font-family: var(--font-heading);
          margin: 0;
          color: var(--color-primary);
          font-size: var(--text-xl);
          font-weight: var(--font-bold);
        }

        /* Aspect Ratio Info */
        .ar-info {
          padding: var(--space-3) var(--space-4);
          border-radius: var(--radius-md);
          margin-bottom: var(--space-3);
          font-size: var(--text-sm);
        }

        .ar-info.full {
          background: var(--color-success-light);
          border: 1px solid var(--color-success);
        }

        .ar-info.framing {
          background: var(--color-warning-light);
          border: 1px solid var(--color-warning);
        }

        .ar-info.tiling {
          background: var(--color-info-light);
          border: 1px solid var(--color-info);
        }

        .ar-info-header {
          color: var(--color-text-primary);
          margin-bottom: var(--space-2);
          font-weight: var(--font-semibold);
        }

        .ar-info-details {
          display: flex;
          flex-wrap: wrap;
          gap: var(--space-2);
          align-items: center;
          color: var(--color-text-secondary);
          font-size: var(--text-sm);
        }

        .ar-info-details span {
          white-space: nowrap;
        }

        .layout-note {
          color: var(--color-accent);
          font-weight: var(--font-medium);
        }

        /* Mode Toggle Tabs */
        .mode-tabs {
          display: flex;
          gap: var(--space-2);
          margin-bottom: var(--space-3);
          background: var(--color-bg-subtle);
          padding: var(--space-1);
          border-radius: var(--radius-lg);
        }

        .mode-tab {
          flex: 1;
          display: flex;
          flex-direction: row;
          align-items: center;
          justify-content: center;
          gap: var(--space-2);
          padding: var(--space-2);
          background: var(--color-bg-card);
          border: 1px solid var(--color-border);
          border-radius: var(--radius-md);
          cursor: pointer;
          transition: all var(--transition-base);
        }

        .mode-tab:hover:not(:disabled) {
          border-color: var(--color-accent);
          transform: translateY(-2px);
          box-shadow: var(--shadow-md);
        }

        .mode-tab.active {
          background: var(--color-accent);
          border-color: var(--color-accent);
          box-shadow: var(--shadow-glow-accent);
        }

        .mode-tab:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }

        .mode-title {
          font-family: var(--font-heading);
          font-size: var(--text-base);
          font-weight: var(--font-semibold);
          color: var(--color-primary);
        }

        .mode-description {
          display: none; /* Hidden to save space */
        }

        .mode-tab.active .mode-title {
          color: white;
          font-weight: var(--font-bold);
        }

        .svg-preview {
          margin: var(--space-2) 0;
          border: 1px solid var(--color-border);
          border-radius: var(--radius-md);
          background: var(--color-bg-subtle);
          padding: var(--space-2);
        }

        .design-preview {
          width: 100%;
          height: auto;
          display: block;
        }

        /* Finalize Section */
        .finalize-section {
          background: var(--color-accent-light);
          border: 2px solid var(--color-accent);
          border-radius: var(--radius-lg);
          padding: var(--space-3);
          margin-top: var(--space-3);
          text-align: center;
        }

        .finalize-button {
          width: 100%;
          max-width: 400px;
          padding: var(--space-3);
          background: var(--color-accent);
          color: white;
          border: none;
          border-radius: var(--radius-md);
          font-size: var(--text-base);
          font-weight: var(--font-semibold);
          cursor: pointer;
          transition: all var(--transition-base);
          box-shadow: var(--shadow-sm);
        }

        .finalize-button:hover {
          background: var(--color-accent-hover);
          transform: translateY(-1px);
          box-shadow: var(--shadow-md);
        }

        .finalize-hint {
          margin: var(--space-2) 0 0 0;
          color: var(--color-text-secondary);
          font-size: var(--text-xs);
        }

        /* Mixer Widget Container Styles */
        .mixer-widget-container {
          margin-top: var(--space-3);
          background: white;
          border-radius: 12px;
          padding: var(--space-3);
          box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .mixer-widget-header {
          display: flex;
          justify-content: flex-end;
          margin-bottom: var(--space-2);
          padding-bottom: var(--space-2);
          border-bottom: 2px solid var(--color-border);
        }

        .mixer-close-btn {
          padding: var(--space-2) var(--space-4);
          background: var(--color-primary);
          color: white;
          border: none;
          border-radius: 8px;
          font-weight: 600;
          font-size: var(--text-sm);
          cursor: pointer;
          transition: all 0.2s;
        }

        .mixer-close-btn:hover {
          background: #2563eb;
          box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
          transform: translateY(-1px);
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
          .inspire-panel-recraft {
            padding: var(--space-2);
          }

          .panel-header {
            margin-bottom: var(--space-4);
          }

          .panel-header h2 {
            font-size: var(--text-xl);
          }

          .subtitle {
            font-size: var(--text-sm);
          }

          .welcome-guidance {
            padding: var(--space-4);
            margin-bottom: var(--space-4);
          }

          .welcome-icon {
            font-size: 2rem;
          }

          .welcome-guidance h3 {
            font-size: var(--text-lg);
          }

          .welcome-guidance p {
            font-size: var(--text-sm);
          }

          /* Stack input mode tabs vertically on mobile */
          .input-mode-tabs {
            flex-direction: column;
            gap: var(--space-1);
          }

          .input-mode-tab {
            flex-direction: row;
            justify-content: flex-start;
            padding: var(--space-3);
            min-height: 44px;
          }

          .mode-icon {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
          }

          .input-mode-tab .mode-title {
            font-size: var(--text-sm);
            margin-top: 0;
          }

          .input-mode-tab .mode-description {
            display: none;
          }

          /* Form sections */
          .form-section {
            padding: var(--space-3);
          }

          .form-group label {
            font-size: var(--text-xs);
          }

          /* Stack form rows on mobile */
          .form-row {
            grid-template-columns: 1fr;
            gap: var(--space-2);
          }

          /* Drop zone adjustments */
          .drop-zone {
            min-height: 140px;
          }

          .drop-zone-content {
            padding: var(--space-4);
            min-height: 140px;
          }

          .upload-icon {
            width: 36px;
            height: 36px;
          }

          .drop-text {
            font-size: var(--text-sm);
          }

          /* Generate button */
          .generate-button {
            padding: var(--space-3);
            font-size: var(--text-base);
            min-height: 44px;
          }

          /* Results section - minimal padding for max image width */
          .results-section {
            padding: var(--space-2);
            border-radius: var(--radius-md);
          }

          .results-header h3 {
            font-size: var(--text-lg);
          }

          /* Mode tabs */
          .mode-tabs {
            flex-direction: column;
            gap: var(--space-1);
          }

          .mode-tab {
            flex-direction: row;
            justify-content: flex-start;
            padding: var(--space-3);
            min-height: 44px;
          }

          .mode-title {
            font-size: var(--text-sm);
          }

          .mode-description {
            display: none;
          }

          /* AR info */
          .ar-info {
            padding: var(--space-2) var(--space-3);
          }

          .ar-info-details {
            flex-direction: column;
            align-items: flex-start;
            gap: var(--space-1);
          }

          /* Finalize section */
          .finalize-section {
            padding: var(--space-3);
          }

          .finalize-button {
            padding: var(--space-3);
            font-size: var(--text-base);
          }
        }

        /* Extra small screens */
        @media (max-width: 480px) {
          .inspire-panel-recraft {
            padding: var(--space-1);
          }

          .panel-header h2 {
            font-size: var(--text-lg);
          }

          /* Results section - even less padding */
          .results-section {
            padding: var(--space-1);
            margin: 0 calc(-1 * var(--space-1));
            border-radius: 0;
          }

          .input-mode-tab {
            padding: var(--space-2);
          }

          .mode-tab {
            padding: var(--space-2);
          }
        }
      `})]})}function sG({isOpen:t,onClose:e}){const[n,r]=O.useState(!1),[s,i]=O.useState(!1),[a,l]=O.useState(!1),{addMotif:c}=at(),d=Od(),{currentDesignId:u,blendSvgUrl:h,solidSvgUrl:p,designName:f}=d,m=h||p,y=!!u;O.useEffect(()=>{if(!t)return;const g=w=>{w.key==="Escape"&&e()};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[t,e]),O.useEffect(()=>{t||(l(!1),r(!1),i(!1))},[t]);const v=O.useCallback((g,w)=>{console.log("[EDITOR] Design saved:",g,w),l(!1)},[]),x=async()=>{var g,w;if(!(!m||n)){r(!0);try{const{blendSvgUrl:b,solidSvgUrl:k,widthMM:_,lengthMM:S}=d;let E=null,T=null;if(k)try{E=await(await fetch(k)).text(),console.log("[EDITOR] Fetched solid SVG from blob:",E.length,"chars")}catch(F){console.error("[EDITOR] Failed to fetch solid SVG:",F)}if(b)try{T=await(await fetch(b)).text(),console.log("[EDITOR] Fetched blend SVG from blob:",T.length,"chars")}catch(F){console.error("[EDITOR] Failed to fetch blend SVG:",F)}if(!E&&!T)throw new Error("No SVG content available. Please ensure a design has been generated.");const W=em(E||T);let P=_||5e3,I=S||5e3;if(W){const F=W.width/W.height;F>1?(P=Math.max(_||5e3,5e3),I=P/F):(I=Math.max(S||5e3,5e3),P=I*F),console.log("[EDITOR] Using SVG aspect ratio:",F,"",P,"x",I,"mm")}i(!0);let C=u;const $=f||`Design ${new Date().toLocaleString("en-GB",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})}`,fe=O2(d);C=(await Jf({id:C||void 0,name:$,description:"",tags:[],design_data:fe,input_mode:d.inputMode})).design_id,d.setCurrentDesignId(C),d.setDesignName($),i(!1);const K=((g=d.result)==null?void 0:g.thumb_url)||((w=d.result)==null?void 0:w.png_url)||null;c(C,$,E||T,P,I,K,{solidSvgContent:E,blendSvgContent:T,hasBothVersions:!!(E&&T)}),l(!0),setTimeout(()=>{e()},600)}catch(b){console.error("[EDITOR] Failed to add to canvas:",b),alert("Failed to add design to canvas: "+b.message),i(!1)}finally{r(!1)}}};return t?o.jsx("div",{className:"design-editor-overlay",children:o.jsxs("div",{className:"design-editor-modal",children:[o.jsxs("div",{className:"design-editor__header",children:[o.jsx("div",{className:"design-editor__title",children:o.jsx("h2",{children:"Design Editor"})}),o.jsx("div",{className:"design-editor__hint",children:"Generate a design with AI or upload your own SVG"}),o.jsx("button",{className:"design-editor__close",onClick:e,title:"Close (Esc)",children:o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),o.jsx("div",{className:"design-editor__content",children:o.jsx(rG,{onDesignSaved:v,isEmbedded:!0})}),o.jsx("div",{className:`design-editor__footer ${a?"design-editor__footer--success":""}`,children:a?o.jsxs("div",{className:"design-editor__success",children:[o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M20 6L9 17l-5-5"})}),o.jsx("span",{children:"Added to canvas!"})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"design-editor__status",children:m?y?o.jsxs("span",{className:"design-editor__saved-indicator",children:[o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M20 6L9 17l-5-5"})}),"Saved to library"]}):o.jsx("span",{className:"design-editor__unsaved-indicator",children:"Design ready  Will auto-save when added"}):o.jsx("span",{className:"design-editor__no-design",children:"Generate or upload a design to continue"})}),o.jsxs("div",{className:"design-editor__actions",children:[o.jsx("button",{className:"design-editor__btn design-editor__btn--secondary",onClick:e,children:"Cancel"}),o.jsx("button",{className:"design-editor__btn design-editor__btn--primary",onClick:x,disabled:!m||n,children:n?o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"design-editor__spinner"}),s?"Saving...":"Adding..."]}):o.jsxs(o.Fragment,{children:[o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),o.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"16"}),o.jsx("line",{x1:"8",y1:"12",x2:"16",y2:"12"})]}),"Add to Canvas"]})})]})]})})]})}):null}function iG(){const{addShape:t,addText:e,addExclusionZone:n,standaloneMode:r,startPathDrawing:s}=at(),[i,a]=O.useState(!1);if(r)return null;const l=[{preset:"rectangle",icon:"",label:"Shape"},{preset:"blob",icon:"",label:"Blob"},{preset:"path",icon:"",label:"Pen"}],c=h=>{h==="path"?(s(),a(!1)):t(h)},d=()=>{e(),a(!1)},u=()=>{n("rectangle")};return o.jsxs("div",{className:`shape-toolbar ${i?"shape-toolbar--expanded":""}`,children:[o.jsxs("button",{className:"shape-toolbar__toggle",onClick:()=>a(!i),title:i?"Collapse elements panel":"Add elements",children:[o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("polygon",{points:"12 2 2 7 12 12 22 7 12 2"}),o.jsx("polyline",{points:"2 17 12 22 22 17"}),o.jsx("polyline",{points:"2 12 12 17 22 12"})]}),!i&&o.jsx("span",{className:"shape-toolbar__label",children:"Elements"})]}),i&&o.jsxs("div",{className:"shape-toolbar__shapes",children:[o.jsxs("button",{className:"shape-toolbar__btn shape-toolbar__btn--text",onClick:d,title:"Add Text Label",children:[o.jsx("span",{className:"shape-toolbar__icon",children:"T"}),o.jsx("span",{className:"shape-toolbar__name",children:"Text"})]}),o.jsx("div",{className:"shape-toolbar__divider"}),l.map(h=>o.jsxs("button",{className:"shape-toolbar__btn",onClick:()=>c(h.preset),title:`Add ${h.label}`,children:[o.jsx("span",{className:"shape-toolbar__icon",children:h.icon}),o.jsx("span",{className:"shape-toolbar__name",children:h.label})]},h.preset)),o.jsx("div",{className:"shape-toolbar__divider"}),o.jsxs("button",{className:"shape-toolbar__btn shape-toolbar__btn--exclusion",onClick:u,title:"Add Exclusion Zone (building, planter, obstacle)",children:[o.jsx("span",{className:"shape-toolbar__icon",style:{fontSize:"1rem"},children:""}),o.jsx("span",{className:"shape-toolbar__name",children:"Exclusion"})]})]})]})}function oG({loadedDesign:t}){var Ve,ot,Ee,St,ht,Pt,Ke,Kt,zn,$r,wr,Dr,ss,Lr,_r,is,$t,kr,jt,Ir,_t;const[e,n]=O.useState(!1),[r,s]=O.useState(()=>{const he=at.getState().surface;return he!=null&&he.width_mm?String(he.width_mm/1e3):"50"}),[i,a]=O.useState(()=>{const he=at.getState().surface;return he!=null&&he.length_mm?String(he.length_mm/1e3):"50"}),[l,c]=O.useState(!1),[d,u]=O.useState(!1),[h,p]=O.useState(!1),[f,m]=O.useState(!1),[y,v]=O.useState(!1),[x,g]=O.useState(null),[w,b]=O.useState(!1),[k,_]=O.useState(null),[S,E]=O.useState(""),[T,R]=O.useState(!1),[W,P]=O.useState(!1),I=O.useRef(null);O.useEffect(()=>{if(t){const he=t.design_data||{},Ie=t.input_mode||he.input_mode||he.blend_recipes||he.solid_recipes,Ct=he.courts||he.surface||he.tracks;if(console.log("[TPV] Design detection:",{id:t.id,name:t.name,hasDesignData:!!t.design_data,topLevelInputMode:t.input_mode,isPlaygroundDesign:Ie,isSportsDesign:Ct}),Ie&&!Ct){console.log("[TPV] Loading playground design into editor:",t.id,t.name);const Cn=Yp(t),Bt=Od.getState();Bt.loadDesign(Cn),t.name&&Bt.setDesignName(t.name),Bt.setCurrentDesignId(t.id),m(!0)}else t.design_data?(console.log("[SPORTS] Loading design from prop:",t.id,t.name),at.getState().loadDesign(he),_(t.id),E(t.name||""),n(!1)):console.warn("[TPV] Design has no design_data and is not a playground design:",t.id,t.name)}},[t]);const{surface:C,courts:$,tracks:fe,selectedCourtId:V,selectedTrackId:K,selectedMotifId:F,selectedShapeId:Z,selectedTextId:U,selectedGroupId:X,selectedElementIds:ge,showCourtLibrary:de,showPropertiesPanel:Q,toggleCourtLibrary:ke,togglePropertiesPanel:Oe,setSurfaceDimensions:De,setSurfaceColor:Be,setSurfaceBoundaryPreset:Ge,resetSurfaceBoundary:He,updateBoundaryParams:Xe,resetDesign:nt,hasUnsavedChanges:j,standaloneMode:ne,toggleStandaloneMode:oe,groupSelected:z,ungroup:A,alignElements:M,distributeElements:G,addShape:ie,addText:Y,addExclusionZone:se,startPathDrawing:we,pathDrawingMode:ue,mobileLibraryOpen:q,mobilePropertiesOpen:le,mobileColoursOpen:be,mobileActiveTab:Ne,setMobileLibraryOpen:ze,setMobilePropertiesOpen:Pe,setMobileColoursOpen:te,setMobileActiveTab:pe,closeMobileSheets:qe,isDirty:st,clearAutosaveTimer:rt}=at(),wt=he=>{he.preventDefault();const Ie=parseFloat(r)*1e3,Ct=parseFloat(i)*1e3;Ie>0&&Ct>0&&(De(Ie,Ct),n(!1))},ct=he=>{Be({tpv_code:he.code,hex:he.hex,name:he.name}),c(!1)},Ze=()=>{j()&&!window.confirm(`Start a new design?

You have unsaved changes that will be lost.`)||(nt(),_(null),E(""),s("50"),a("50"))},ce=()=>{const he=I.current||document.querySelector(".court-canvas__svg");if(!he){alert("Canvas not ready");return}const Ie=at.getState().exportDesignData(),Ct=nm(he,Ie),Cn=new Blob([Ct],{type:"image/svg+xml"}),Bt=URL.createObjectURL(Cn);x&&URL.revokeObjectURL(x),g(Bt),v(!0)},ee=()=>{v(!1),x&&(URL.revokeObjectURL(x),g(null))},ve=async he=>{if(!he){alert("Source design ID not found");return}try{const Ie=await Hl(he),Ct=(Ie==null?void 0:Ie.design)||Ie;if(!Ct)throw new Error("Design not found");const Cn=Yp(Ct),Bt=Od.getState();Bt.loadDesign(Cn),Ct.name&&Bt.setDesignName(Ct.name),Bt.setCurrentDesignId(he),m(!0),console.log("[TPV] Loaded source design for editing:",Ct.name)}catch(Ie){console.error("[TPV] Failed to load source design:",Ie),alert("Failed to load design: "+Ie.message)}};return O.useEffect(()=>{if(!T)return;const he=()=>{R(!1),P(!1)};return document.addEventListener("click",he),()=>document.removeEventListener("click",he)},[T]),O.useEffect(()=>{if(!W)return;const he=()=>P(!1);return document.addEventListener("click",he),()=>document.removeEventListener("click",he)},[W]),O.useEffect(()=>{const he=Ie=>{if(st)return Ie.preventDefault(),Ie.returnValue="You have unsaved changes.",Ie.returnValue};return window.addEventListener("beforeunload",he),()=>window.removeEventListener("beforeunload",he)},[st]),O.useEffect(()=>()=>rt(),[rt]),O.useEffect(()=>{const he=Ie=>{const Ct=Ie.target.tagName.toLowerCase();if(Ct==="input"||Ct==="textarea"||Ct==="select")return;const{removeCourt:Cn,removeTrack:Bt,removeMotif:En,removeShape:vt,removeText:Dt,deselectCourt:an,deselectTrack:Rt,deselectMotif:Ot,deselectShape:Mt,deselectText:sn,stopEditingText:Vn,undo:sr,redo:vs,canUndo:bs,canRedo:Tn,duplicateCourt:os,duplicateMotif:zr,duplicateShape:Yn,duplicateText:qn,updateCourtPosition:Sr,updateTrackPosition:Hs,updateMotifPosition:ws,updateShapePosition:_s,updateTextPosition:ks,courts:as,tracks:Fr,motifs:Nn,shapes:ir,texts:ls,selectedMotifId:xn,selectedShapeId:Pn,selectedTextId:ln,editingTextId:or,elementOrder:jr,setElementOrder:Xn,toggleSnapToGrid:Us,snapToGrid:Ss,addToHistory:Nt}=at.getState(),cn=V||K||xn||Pn||ln;if(Ie.key==="Delete"&&cn&&!or&&(Ie.preventDefault(),V?Cn(V):K?Bt(K):xn?En(xn):Pn?vt(Pn):ln&&Dt(ln)),Ie.key==="Escape"&&(or?Vn():cn&&(V?an():K?Rt():xn?Ot():Pn?Mt():ln&&sn())),(Ie.ctrlKey||Ie.metaKey)&&Ie.key==="z"&&!Ie.shiftKey&&(Ie.preventDefault(),bs()&&sr()),(Ie.ctrlKey||Ie.metaKey)&&Ie.key==="z"&&Ie.shiftKey&&(Ie.preventDefault(),Tn()&&vs()),(Ie.ctrlKey||Ie.metaKey)&&Ie.key==="d"&&cn&&(Ie.preventDefault(),V?os(V):xn?zr(xn):Pn?Yn(Pn):ln&&qn(ln)),cn&&!or&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(Ie.key)){Ie.preventDefault();const Ht=Ie.shiftKey?10:100;let Lt=0,Rn=0;if(Ie.key==="ArrowLeft"&&(Lt=-Ht),Ie.key==="ArrowRight"&&(Lt=Ht),Ie.key==="ArrowUp"&&(Rn=-Ht),Ie.key==="ArrowDown"&&(Rn=Ht),V){const Ut=as[V];Ut&&(Sr(V,{x:Ut.position.x+Lt,y:Ut.position.y+Rn}),Nt())}else if(K){const Ut=Fr[K];Ut&&(Hs(K,{x:Ut.position.x+Lt,y:Ut.position.y+Rn}),Nt())}else if(xn){const Ut=Nn[xn];Ut&&(ws(xn,{x:Ut.position.x+Lt,y:Ut.position.y+Rn}),Nt())}else if(Pn){const Ut=ir[Pn];Ut&&(_s(Pn,{x:Ut.position.x+Lt,y:Ut.position.y+Rn}),Nt())}else if(ln){const Ut=ls[ln];Ut&&(ks(ln,{x:Ut.position.x+Lt,y:Ut.position.y+Rn}),Nt())}}if(cn&&(Ie.key==="["||Ie.key==="]")){Ie.preventDefault();const Ht=jr.indexOf(cn);if(Ht===-1)return;const Lt=[...jr];Ie.key==="["&&Ht>0?([Lt[Ht],Lt[Ht-1]]=[Lt[Ht-1],Lt[Ht]],Xn(Lt),Nt()):Ie.key==="]"&&Ht<jr.length-1&&([Lt[Ht],Lt[Ht+1]]=[Lt[Ht+1],Lt[Ht]],Xn(Lt),Nt())}(Ie.key==="g"||Ie.key==="G")&&(Ie.preventDefault(),Us()),(Ie.key==="?"||Ie.shiftKey&&Ie.key==="/")&&(Ie.preventDefault(),p(!0))};return window.addEventListener("keydown",he),()=>window.removeEventListener("keydown",he)},[V,K,F,Z,U]),o.jsxs("div",{className:"sports-designer",children:[e&&o.jsx("div",{className:"sports-designer__modal-overlay",onClick:()=>n(!1),children:o.jsxs("div",{className:"sports-designer__modal",onClick:he=>he.stopPropagation(),children:[o.jsx("h2",{children:"Edit Surface Size"}),o.jsx("p",{children:"Adjust the dimensions of your sports surface"}),o.jsxs("form",{onSubmit:wt,children:[o.jsxs("div",{className:"sports-designer__dimension-inputs",children:[o.jsxs("div",{className:"sports-designer__input-group",children:[o.jsx("label",{htmlFor:"width",children:"Width (metres)"}),o.jsx("input",{id:"width",type:"number",min:"5",max:"100",step:"0.5",value:r,onChange:he=>s(he.target.value),required:!0,autoFocus:!0})]}),o.jsx("span",{className:"sports-designer__dimension-separator",children:""}),o.jsxs("div",{className:"sports-designer__input-group",children:[o.jsx("label",{htmlFor:"length",children:"Length (metres)"}),o.jsx("input",{id:"length",type:"number",min:"5",max:"100",step:"0.5",value:i,onChange:he=>a(he.target.value),required:!0})]})]}),o.jsx("p",{className:"sports-designer__dimension-hint",children:"Common sizes: 37m  34m (tennis), 40m  20m (futsal), 50m  50m (multi-sport)"}),o.jsxs("div",{className:"sports-designer__boundary-section",children:[o.jsx("label",{htmlFor:"boundary-shape",children:"Surface Shape"}),o.jsxs("div",{className:"sports-designer__boundary-options",children:[o.jsxs("select",{id:"boundary-shape",value:((Ve=C.boundary)==null?void 0:Ve.type)||"rectangle",onChange:he=>{const Ie=he.target.value;Ie==="rectangle"?He():Ge(Ie)},className:"sports-designer__select",children:[o.jsx("option",{value:"rectangle",children:"Rectangle (default)"}),o.jsx("option",{value:"l-shape",children:"L-Shape"}),o.jsx("option",{value:"u-shape",children:"U-Shape"}),o.jsx("option",{value:"t-shape",children:"T-Shape"})]}),((ot=C.boundary)==null?void 0:ot.type)&&C.boundary.type!=="rectangle"&&o.jsx("button",{type:"button",className:"sports-designer__btn-secondary",onClick:He,title:"Reset to rectangle",children:"Reset"})]}),((Ee=C.boundary)==null?void 0:Ee.type)==="l-shape"&&o.jsxs("div",{className:"sports-designer__boundary-params",children:[o.jsxs("div",{className:"sports-designer__param-row",children:[o.jsxs("label",{children:["Cut Width: ",Math.round((((St=C.boundary.params)==null?void 0:St.cutWidth)||.6)*100),"%"]}),o.jsx("input",{type:"range",min:"20",max:"80",value:(((ht=C.boundary.params)==null?void 0:ht.cutWidth)||.6)*100,onChange:he=>Xe({cutWidth:parseInt(he.target.value)/100})})]}),o.jsxs("div",{className:"sports-designer__param-row",children:[o.jsxs("label",{children:["Cut Height: ",Math.round((((Pt=C.boundary.params)==null?void 0:Pt.cutHeight)||.4)*100),"%"]}),o.jsx("input",{type:"range",min:"20",max:"80",value:(((Ke=C.boundary.params)==null?void 0:Ke.cutHeight)||.4)*100,onChange:he=>Xe({cutHeight:parseInt(he.target.value)/100})})]})]}),((Kt=C.boundary)==null?void 0:Kt.type)==="u-shape"&&o.jsxs("div",{className:"sports-designer__boundary-params",children:[o.jsxs("div",{className:"sports-designer__param-row",children:[o.jsxs("label",{children:["Cut Start: ",Math.round((((zn=C.boundary.params)==null?void 0:zn.cutStart)||.35)*100),"%"]}),o.jsx("input",{type:"range",min:"10",max:"45",value:((($r=C.boundary.params)==null?void 0:$r.cutStart)||.35)*100,onChange:he=>Xe({cutStart:parseInt(he.target.value)/100})})]}),o.jsxs("div",{className:"sports-designer__param-row",children:[o.jsxs("label",{children:["Cut End: ",Math.round((((wr=C.boundary.params)==null?void 0:wr.cutEnd)||.65)*100),"%"]}),o.jsx("input",{type:"range",min:"55",max:"90",value:(((Dr=C.boundary.params)==null?void 0:Dr.cutEnd)||.65)*100,onChange:he=>Xe({cutEnd:parseInt(he.target.value)/100})})]}),o.jsxs("div",{className:"sports-designer__param-row",children:[o.jsxs("label",{children:["Cut Height: ",Math.round((((ss=C.boundary.params)==null?void 0:ss.cutHeight)||.4)*100),"%"]}),o.jsx("input",{type:"range",min:"20",max:"80",value:(((Lr=C.boundary.params)==null?void 0:Lr.cutHeight)||.4)*100,onChange:he=>Xe({cutHeight:parseInt(he.target.value)/100})})]})]}),((_r=C.boundary)==null?void 0:_r.type)==="t-shape"&&o.jsxs("div",{className:"sports-designer__boundary-params",children:[o.jsxs("div",{className:"sports-designer__param-row",children:[o.jsxs("label",{children:["Stem Start: ",Math.round((((is=C.boundary.params)==null?void 0:is.stemStart)||.3)*100),"%"]}),o.jsx("input",{type:"range",min:"10",max:"45",value:((($t=C.boundary.params)==null?void 0:$t.stemStart)||.3)*100,onChange:he=>Xe({stemStart:parseInt(he.target.value)/100})})]}),o.jsxs("div",{className:"sports-designer__param-row",children:[o.jsxs("label",{children:["Stem End: ",Math.round((((kr=C.boundary.params)==null?void 0:kr.stemEnd)||.7)*100),"%"]}),o.jsx("input",{type:"range",min:"55",max:"90",value:(((jt=C.boundary.params)==null?void 0:jt.stemEnd)||.7)*100,onChange:he=>Xe({stemEnd:parseInt(he.target.value)/100})})]}),o.jsxs("div",{className:"sports-designer__param-row",children:[o.jsxs("label",{children:["Bar Height: ",Math.round((((Ir=C.boundary.params)==null?void 0:Ir.stemHeight)||.4)*100),"%"]}),o.jsx("input",{type:"range",min:"20",max:"80",value:(((_t=C.boundary.params)==null?void 0:_t.stemHeight)||.4)*100,onChange:he=>Xe({stemHeight:parseInt(he.target.value)/100})})]})]}),o.jsx("p",{className:"sports-designer__boundary-hint",children:"Non-rectangular shapes are useful for L-shaped buildings or irregular sites"})]}),o.jsx("button",{type:"submit",className:"sports-designer__btn-primary",children:"Update Surface"})]})]})}),o.jsxs(o.Fragment,{children:[o.jsxs("header",{className:"sports-designer__mobile-header",children:[o.jsx("span",{className:"sports-designer__mobile-header-title",children:"TPV Designer"}),o.jsxs("div",{className:"sports-designer__mobile-header-actions",children:[o.jsx("button",{className:"sports-designer__mobile-header-btn",onClick:()=>{s(String(C.width_mm/1e3)),a(String(C.length_mm/1e3)),n(!0)},title:"Surface settings",children:o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"12",cy:"12",r:"3"}),o.jsx("path",{d:"M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"})]})}),o.jsx(Iy,{svgRef:I,mobileMode:!0})]})]}),o.jsxs("nav",{className:"sports-designer__mobile-action-bar",children:[o.jsxs("button",{className:`sports-designer__mobile-action-btn ${q?"sports-designer__mobile-action-btn--active":""}`,onClick:()=>{qe(),ze(!0)},children:[o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"12",cy:"12",r:"10"}),o.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"16"}),o.jsx("line",{x1:"8",y1:"12",x2:"16",y2:"12"})]}),o.jsx("span",{children:"Add"})]}),o.jsxs("button",{className:"sports-designer__mobile-action-btn",onClick:()=>{qe(),te(!0)},children:[o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"13.5",cy:"6.5",r:"2.5"}),o.jsx("circle",{cx:"17.5",cy:"10.5",r:"2.5"}),o.jsx("circle",{cx:"8.5",cy:"7.5",r:"2.5"}),o.jsx("circle",{cx:"6.5",cy:"12.5",r:"2.5"})]}),o.jsx("span",{children:"Colours"})]}),o.jsxs("button",{className:`sports-designer__mobile-action-btn ${V||K||F||Z||U?"":"sports-designer__mobile-action-btn--disabled"}`,onClick:()=>{(V||K||F||Z||U)&&(qe(),Pe(!0))},disabled:!V&&!K&&!F&&!Z&&!U,children:[o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"4",y1:"21",x2:"4",y2:"14"}),o.jsx("line",{x1:"4",y1:"10",x2:"4",y2:"3"}),o.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"12"}),o.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"3"}),o.jsx("line",{x1:"20",y1:"21",x2:"20",y2:"16"}),o.jsx("line",{x1:"20",y1:"12",x2:"20",y2:"3"}),o.jsx("line",{x1:"1",y1:"14",x2:"7",y2:"14"}),o.jsx("line",{x1:"9",y1:"8",x2:"15",y2:"8"}),o.jsx("line",{x1:"17",y1:"16",x2:"23",y2:"16"})]}),o.jsx("span",{children:"Properties"})]}),o.jsxs("button",{className:"sports-designer__mobile-action-btn",onClick:()=>u(!0),children:[o.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"}),o.jsx("polyline",{points:"17 21 17 13 7 13 7 21"}),o.jsx("polyline",{points:"7 3 7 8 15 8"})]}),o.jsx("span",{children:"Save"})]})]}),o.jsx("div",{className:`sports-designer__bottom-sheet-overlay ${q?"sports-designer__bottom-sheet-overlay--open":""}`,onClick:()=>ze(!1)}),o.jsxs("div",{className:`sports-designer__bottom-sheet ${q?"sports-designer__bottom-sheet--open":""}`,children:[o.jsx("div",{className:"sports-designer__bottom-sheet-handle"}),o.jsxs("div",{className:"sports-designer__bottom-sheet-header",children:[o.jsx("h3",{children:"Add Element"}),o.jsx("button",{className:"sports-designer__bottom-sheet-close",onClick:()=>ze(!1),children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),o.jsxs("div",{className:"sports-designer__mobile-tabs",children:[o.jsx("button",{className:`sports-designer__mobile-tab ${Ne==="courts"?"sports-designer__mobile-tab--active":""}`,onClick:()=>pe("courts"),children:"Courts"}),o.jsx("button",{className:`sports-designer__mobile-tab ${Ne==="tracks"?"sports-designer__mobile-tab--active":""}`,onClick:()=>pe("tracks"),children:"Tracks"}),o.jsx("button",{className:`sports-designer__mobile-tab ${Ne==="shapes"?"sports-designer__mobile-tab--active":""}`,onClick:()=>pe("shapes"),children:"Shapes"}),o.jsx("button",{className:`sports-designer__mobile-tab ${Ne==="designs"?"sports-designer__mobile-tab--active":""}`,onClick:()=>pe("designs"),children:"Designs"})]}),o.jsx("div",{className:"sports-designer__bottom-sheet-content",children:o.jsx(r_,{mobileMode:!0,activeTab:Ne,onItemAdded:()=>ze(!1),onOpenGenerator:()=>{ze(!1),m(!0)}})})]}),o.jsx("div",{className:`sports-designer__bottom-sheet-overlay ${be?"sports-designer__bottom-sheet-overlay--open":""}`,onClick:()=>te(!1)}),o.jsxs("div",{className:`sports-designer__bottom-sheet ${be?"sports-designer__bottom-sheet--open":""}`,children:[o.jsx("div",{className:"sports-designer__bottom-sheet-handle"}),o.jsxs("div",{className:"sports-designer__bottom-sheet-header",children:[o.jsx("h3",{children:"Surface Colour"}),o.jsx("button",{className:"sports-designer__bottom-sheet-close",onClick:()=>te(!1),children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),o.jsx("div",{className:"sports-designer__bottom-sheet-content",children:o.jsx("div",{className:"sports-designer__color-grid",children:wn.map(he=>o.jsx("button",{className:`sports-designer__color-swatch ${C.color.tpv_code===he.code?"sports-designer__color-swatch--selected":""}`,style:{backgroundColor:he.hex},onClick:()=>{ct(he),te(!1)},title:`${he.code} - ${he.name}`,children:o.jsx("span",{className:"sports-designer__color-code",children:he.code})},he.code))})})]}),o.jsx("div",{className:`sports-designer__bottom-sheet-overlay ${le?"sports-designer__bottom-sheet-overlay--open":""}`,onClick:()=>Pe(!1)}),o.jsxs("div",{className:`sports-designer__bottom-sheet ${le?"sports-designer__bottom-sheet--open":""}`,children:[o.jsx("div",{className:"sports-designer__bottom-sheet-handle"}),o.jsxs("div",{className:"sports-designer__bottom-sheet-header",children:[o.jsx("h3",{children:"Properties"}),o.jsx("button",{className:"sports-designer__bottom-sheet-close",onClick:()=>Pe(!1),children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),o.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),o.jsx("div",{className:"sports-designer__bottom-sheet-content",children:(V||K||F||Z||U)&&o.jsx(Ey,{mobileMode:!0,onEditSourceDesign:ve})})]}),o.jsxs("div",{className:"sports-designer__content",children:[!ne&&o.jsxs("aside",{className:`sports-designer__sidebar ${de?"":"sports-designer__sidebar--collapsed"}`,children:[o.jsxs("div",{className:"sidebar-content",children:[o.jsx("div",{className:"sidebar-add-element",children:o.jsxs("button",{className:"sidebar-add-element__btn",onClick:()=>b(!0),children:[o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("circle",{cx:"12",cy:"12",r:"10"}),o.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"16"}),o.jsx("line",{x1:"8",y1:"12",x2:"16",y2:"12"})]}),"Add Courts & Designs"]})}),o.jsx(RT,{})]}),o.jsx("button",{className:"sidebar-toggle sidebar-toggle--left",onClick:ke,title:de?"Collapse panel":"Expand panel",children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:de?o.jsx("polyline",{points:"15 18 9 12 15 6"}):o.jsx("polyline",{points:"9 18 15 12 9 6"})})})]}),o.jsxs("main",{className:"sports-designer__canvas-container",children:[o.jsxs("div",{className:"sports-toolbar",children:[o.jsxs("div",{className:"sports-toolbar__group",children:[o.jsx("button",{className:`sports-toolbar__btn ${de?"sports-toolbar__btn--active":""}`,onClick:ke,title:"Element Library",disabled:ne,children:o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),o.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),o.jsx("rect",{x:"3",y:"14",width:"7",height:"7"}),o.jsx("rect",{x:"14",y:"14",width:"7",height:"7"})]})}),o.jsx("button",{className:`sports-toolbar__btn ${Q&&(V||K||F||Z||U)?"sports-toolbar__btn--active":""}`,onClick:Oe,title:"Properties",disabled:!V&&!K&&!F&&!Z&&!U||ne,children:o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("line",{x1:"4",y1:"21",x2:"4",y2:"14"}),o.jsx("line",{x1:"4",y1:"10",x2:"4",y2:"3"}),o.jsx("line",{x1:"12",y1:"21",x2:"12",y2:"12"}),o.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"3"}),o.jsx("line",{x1:"20",y1:"21",x2:"20",y2:"16"}),o.jsx("line",{x1:"20",y1:"12",x2:"20",y2:"3"}),o.jsx("line",{x1:"1",y1:"14",x2:"7",y2:"14"}),o.jsx("line",{x1:"9",y1:"8",x2:"15",y2:"8"}),o.jsx("line",{x1:"17",y1:"16",x2:"23",y2:"16"})]})})]}),o.jsx("div",{className:"sports-toolbar__divider"}),o.jsxs("div",{className:"sports-toolbar__group",style:{position:"relative"},children:[o.jsxs("button",{className:`sports-toolbar__btn sports-toolbar__btn--with-label ${W?"sports-toolbar__btn--active":""}`,onClick:he=>{he.stopPropagation(),P(!W)},title:"Add Elements",children:[o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("polygon",{points:"12 2 2 7 12 12 22 7 12 2"}),o.jsx("polyline",{points:"2 17 12 22 22 17"}),o.jsx("polyline",{points:"2 12 12 17 22 12"})]}),o.jsx("span",{children:"Elements"}),o.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:o.jsx("path",{d:"M6 9l6 6 6-6"})})]}),W&&o.jsxs("div",{className:"sports-toolbar__dropdown-menu",onClick:he=>he.stopPropagation(),children:[o.jsxs("button",{className:"sports-toolbar__dropdown-item",onClick:()=>{Y(),P(!1)},children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("path",{d:"M4 7V4h16v3"}),o.jsx("path",{d:"M12 4v16"}),o.jsx("path",{d:"M8 20h8"})]}),o.jsx("span",{children:"Text"}),o.jsx("span",{className:"sports-toolbar__dropdown-shortcut",children:"T"})]}),o.jsxs("button",{className:"sports-toolbar__dropdown-item",onClick:()=>{ie("rectangle"),P(!1)},children:[o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"})}),o.jsx("span",{children:"Shape"}),o.jsx("span",{className:"sports-toolbar__dropdown-shortcut",children:"S"})]}),o.jsxs("button",{className:"sports-toolbar__dropdown-item",onClick:()=>{ie("blob"),P(!1)},children:[o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:o.jsx("path",{d:"M12 3c-4 0-7 3-8 6s0 6 2 8c2 2 5 3 8 2s5-3 6-6-1-6-3-8c-1-1-3-2-5-2z"})}),o.jsx("span",{children:"Blob"}),o.jsx("span",{className:"sports-toolbar__dropdown-shortcut",children:"B"})]}),o.jsxs("button",{className:`sports-toolbar__dropdown-item ${ue?"sports-toolbar__dropdown-item--active":""}`,onClick:()=>{we(),P(!1)},children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("path",{d:"M12 19l7-7 3 3-7 7-3-3z"}),o.jsx("path",{d:"M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"}),o.jsx("path",{d:"M2 2l7.586 7.586"})]}),o.jsx("span",{children:"Pen"}),o.jsx("span",{className:"sports-toolbar__dropdown-shortcut",children:"P"})]}),o.jsx("div",{className:"sports-toolbar__dropdown-divider"}),o.jsxs("button",{className:"sports-toolbar__dropdown-item sports-toolbar__dropdown-item--exclusion",onClick:()=>{se("rectangle"),P(!1)},children:[o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("circle",{cx:"12",cy:"12",r:"10"}),o.jsx("line",{x1:"4.93",y1:"4.93",x2:"19.07",y2:"19.07"})]}),o.jsx("span",{children:"Exclusion Zone"}),o.jsx("span",{className:"sports-toolbar__dropdown-shortcut",children:"E"})]})]})]}),o.jsx("div",{className:"sports-toolbar__divider"}),o.jsxs("div",{className:"sports-toolbar__group",children:[o.jsxs("button",{className:"sports-toolbar__dimensions",onClick:()=>{s(String(C.width_mm/1e3)),a(String(C.length_mm/1e3)),n(!0)},title:"Click to edit surface size",children:[(C.width_mm/1e3).toFixed(0),"m  ",(C.length_mm/1e3).toFixed(0),"m"]}),o.jsx("button",{className:"sports-toolbar__color-swatch",style:{backgroundColor:C.color.hex},onClick:()=>c(!0),title:`${C.color.name} (${C.color.tpv_code}) - Click to change`})]}),o.jsx("div",{className:"sports-toolbar__divider"}),o.jsxs("div",{className:"sports-toolbar__group",children:[o.jsx("button",{className:"sports-toolbar__btn",disabled:!at.getState().canUndo(),onClick:()=>at.getState().undo(),title:"Undo (Ctrl+Z)",children:o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("path",{d:"M3 7v6h6"}),o.jsx("path",{d:"M21 17a9 9 0 00-9-9 9 9 0 00-6 2.3L3 13"})]})}),o.jsx("button",{className:"sports-toolbar__btn",disabled:!at.getState().canRedo(),onClick:()=>at.getState().redo(),title:"Redo (Ctrl+Shift+Z)",children:o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("path",{d:"M21 7v6h-6"}),o.jsx("path",{d:"M3 17a9 9 0 019-9 9 9 0 016 2.3l3 2.7"})]})})]}),(ge.length>=2||X)&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"sports-toolbar__divider"}),o.jsxs("div",{className:"sports-toolbar__group",children:[ge.length>=2&&o.jsx("button",{className:"sports-toolbar__btn",onClick:z,title:"Group selected elements (Cmd+G)",children:o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1"}),o.jsx("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1"}),o.jsx("path",{d:"M10 7h4"}),o.jsx("path",{d:"M10 17h4"}),o.jsx("path",{d:"M7 10v4"}),o.jsx("path",{d:"M17 10v4"})]})}),X&&o.jsx("button",{className:"sports-toolbar__btn",onClick:()=>A(X),title:"Ungroup (Cmd+Shift+G)",children:o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1"}),o.jsx("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1"}),o.jsx("path",{d:"M10 7h4",strokeDasharray:"2 2"}),o.jsx("path",{d:"M10 17h4",strokeDasharray:"2 2"}),o.jsx("path",{d:"M7 10v4",strokeDasharray:"2 2"}),o.jsx("path",{d:"M17 10v4",strokeDasharray:"2 2"})]})})]}),ge.length>=2&&o.jsxs("div",{className:"sports-toolbar__align-dropdown",style:{position:"relative"},children:[o.jsx("button",{className:`sports-toolbar__btn ${T?"sports-toolbar__btn--active":""}`,onClick:he=>{he.stopPropagation(),R(!T)},title:"Align elements",children:o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("line",{x1:"21",y1:"10",x2:"3",y2:"10"}),o.jsx("line",{x1:"21",y1:"6",x2:"3",y2:"6"}),o.jsx("line",{x1:"21",y1:"14",x2:"3",y2:"14"}),o.jsx("line",{x1:"21",y1:"18",x2:"3",y2:"18"})]})}),T&&o.jsxs("div",{className:"sports-toolbar__align-menu",style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"4px",background:"white",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",padding:"8px",zIndex:100,minWidth:"120px"},onClick:he=>he.stopPropagation(),children:[o.jsx("div",{style:{fontSize:"10px",color:"#666",padding:"4px 8px",textTransform:"uppercase",fontWeight:600},children:"Align"}),o.jsx("button",{style:{display:"flex",alignItems:"center",gap:"8px",width:"100%",padding:"6px 8px",border:"none",background:"transparent",cursor:"pointer",borderRadius:"4px",fontSize:"12px"},onClick:()=>{M("left"),R(!1)},onMouseOver:he=>he.currentTarget.style.background="#f1f5f9",onMouseOut:he=>he.currentTarget.style.background="transparent",children:" Left"}),o.jsx("button",{style:{display:"flex",alignItems:"center",gap:"8px",width:"100%",padding:"6px 8px",border:"none",background:"transparent",cursor:"pointer",borderRadius:"4px",fontSize:"12px"},onClick:()=>{M("center"),R(!1)},onMouseOver:he=>he.currentTarget.style.background="#f1f5f9",onMouseOut:he=>he.currentTarget.style.background="transparent",children:" Center"}),o.jsx("button",{style:{display:"flex",alignItems:"center",gap:"8px",width:"100%",padding:"6px 8px",border:"none",background:"transparent",cursor:"pointer",borderRadius:"4px",fontSize:"12px"},onClick:()=>{M("right"),R(!1)},onMouseOver:he=>he.currentTarget.style.background="#f1f5f9",onMouseOut:he=>he.currentTarget.style.background="transparent",children:" Right"}),o.jsx("div",{style:{height:"1px",background:"#e5e7eb",margin:"4px 0"}}),o.jsx("button",{style:{display:"flex",alignItems:"center",gap:"8px",width:"100%",padding:"6px 8px",border:"none",background:"transparent",cursor:"pointer",borderRadius:"4px",fontSize:"12px"},onClick:()=>{M("top"),R(!1)},onMouseOver:he=>he.currentTarget.style.background="#f1f5f9",onMouseOut:he=>he.currentTarget.style.background="transparent",children:" Top"}),o.jsx("button",{style:{display:"flex",alignItems:"center",gap:"8px",width:"100%",padding:"6px 8px",border:"none",background:"transparent",cursor:"pointer",borderRadius:"4px",fontSize:"12px"},onClick:()=>{M("middle"),R(!1)},onMouseOver:he=>he.currentTarget.style.background="#f1f5f9",onMouseOut:he=>he.currentTarget.style.background="transparent",children:" Middle"}),o.jsx("button",{style:{display:"flex",alignItems:"center",gap:"8px",width:"100%",padding:"6px 8px",border:"none",background:"transparent",cursor:"pointer",borderRadius:"4px",fontSize:"12px"},onClick:()=>{M("bottom"),R(!1)},onMouseOver:he=>he.currentTarget.style.background="#f1f5f9",onMouseOut:he=>he.currentTarget.style.background="transparent",children:" Bottom"}),ge.length>=3&&o.jsxs(o.Fragment,{children:[o.jsx("div",{style:{height:"1px",background:"#e5e7eb",margin:"4px 0"}}),o.jsx("div",{style:{fontSize:"10px",color:"#666",padding:"4px 8px",textTransform:"uppercase",fontWeight:600},children:"Distribute"}),o.jsx("button",{style:{display:"flex",alignItems:"center",gap:"8px",width:"100%",padding:"6px 8px",border:"none",background:"transparent",cursor:"pointer",borderRadius:"4px",fontSize:"12px"},onClick:()=>{G("horizontal"),R(!1)},onMouseOver:he=>he.currentTarget.style.background="#f1f5f9",onMouseOut:he=>he.currentTarget.style.background="transparent",children:" Horizontal"}),o.jsx("button",{style:{display:"flex",alignItems:"center",gap:"8px",width:"100%",padding:"6px 8px",border:"none",background:"transparent",cursor:"pointer",borderRadius:"4px",fontSize:"12px"},onClick:()=>{G("vertical"),R(!1)},onMouseOver:he=>he.currentTarget.style.background="#f1f5f9",onMouseOut:he=>he.currentTarget.style.background="transparent",children:" Vertical"}),o.jsx("div",{style:{height:"1px",background:"#e5e7eb",margin:"4px 0"}}),o.jsx("div",{style:{fontSize:"10px",color:"#666",padding:"4px 8px",textTransform:"uppercase",fontWeight:600},children:"Distribute Centres"}),o.jsx("button",{style:{display:"flex",alignItems:"center",gap:"8px",width:"100%",padding:"6px 8px",border:"none",background:"transparent",cursor:"pointer",borderRadius:"4px",fontSize:"12px"},onClick:()=>{G("center-horizontal"),R(!1)},onMouseOver:he=>he.currentTarget.style.background="#f1f5f9",onMouseOut:he=>he.currentTarget.style.background="transparent",children:" Centres H"}),o.jsx("button",{style:{display:"flex",alignItems:"center",gap:"8px",width:"100%",padding:"6px 8px",border:"none",background:"transparent",cursor:"pointer",borderRadius:"4px",fontSize:"12px"},onClick:()=>{G("center-vertical"),R(!1)},onMouseOver:he=>he.currentTarget.style.background="#f1f5f9",onMouseOut:he=>he.currentTarget.style.background="transparent",children:" Centres V"})]})]})]})]}),o.jsx("div",{className:"sports-toolbar__divider"}),o.jsxs("div",{className:"sports-toolbar__group",children:[o.jsx("button",{className:"sports-toolbar__btn",onClick:Ze,title:"Start new design",children:o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),o.jsx("polyline",{points:"14 2 14 8 20 8"}),o.jsx("line",{x1:"12",y1:"18",x2:"12",y2:"12"}),o.jsx("line",{x1:"9",y1:"15",x2:"15",y2:"15"})]})}),o.jsx("button",{className:"sports-toolbar__btn",onClick:ce,title:"View In-Situ Preview",children:o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),o.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),o.jsx("polyline",{points:"21 15 16 10 5 21"})]})}),o.jsx("button",{className:"sports-toolbar__btn",onClick:()=>p(!0),title:"Keyboard shortcuts (?)",children:o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[o.jsx("circle",{cx:"12",cy:"12",r:"10"}),o.jsx("path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}),o.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]})}),o.jsx("button",{className:"sports-toolbar__btn-primary",onClick:()=>u(!0),children:"Save"}),o.jsx(Iy,{svgRef:I})]})]}),o.jsx(rT,{ref:I}),o.jsx(iG,{})]}),(V||K||F||Z||U)&&!ne&&o.jsxs("aside",{className:`sports-designer__properties ${Q?"":"sports-designer__properties--collapsed"}`,children:[o.jsx("button",{className:"sidebar-toggle sidebar-toggle--right",onClick:Oe,title:Q?"Collapse properties":"Expand properties",children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:Q?o.jsx("polyline",{points:"9 18 15 12 9 6"}):o.jsx("polyline",{points:"15 18 9 12 15 6"})})}),o.jsx("div",{className:"sidebar-content",children:o.jsx(Ey,{onEditSourceDesign:ve})})]})]}),l&&o.jsx("div",{className:"sports-designer__color-modal-overlay",onClick:()=>c(!1),children:o.jsxs("div",{className:"sports-designer__color-modal",onClick:he=>he.stopPropagation(),children:[o.jsxs("div",{className:"sports-designer__color-modal-header",children:[o.jsx("h4",{children:"Select Surface Colour"}),o.jsx("button",{onClick:()=>c(!1),children:""})]}),o.jsx("div",{className:"sports-designer__color-grid",children:wn.map(he=>o.jsx("button",{className:`sports-designer__color-swatch ${C.color.tpv_code===he.code?"sports-designer__color-swatch--selected":""}`,style:{backgroundColor:he.hex},onClick:()=>ct(he),title:`${he.code} - ${he.name}`,children:o.jsx("span",{className:"sports-designer__color-code",children:he.code})},he.code))})]})}),d&&o.jsx(HT,{existingDesignId:k,initialName:S,svgRef:I,onClose:()=>u(!1),onSaved:(he,Ie)=>{_(he.design_id),E(Ie),console.log("[SPORTS] Design saved:",he.design_id)}}),o.jsx(a3,{isOpen:h,onClose:()=>p(!1)}),o.jsx(ST,{isOpen:w,onClose:()=>b(!1),onOpenGenerator:()=>m(!0)}),o.jsx(sG,{isOpen:f,onClose:()=>m(!1)}),y&&x&&o.jsx($2,{designUrl:x,designDimensions:{width:C.width_mm,length:C.length_mm},onClose:ee,onSaved:he=>{console.log("[TPV] In-situ preview saved:",he),ee()}})]})]})}function aG({onShowDesigns:t,onShowAdmin:e,isAdmin:n,currentDesignName:r}){const[s,i]=O.useState(!1),a=async()=>{confirm("Sign out?")&&(await Kr.signOut(),window.location.reload())};return o.jsx("header",{className:"studio-header",children:o.jsxs("div",{className:"header-content",children:[o.jsxs("div",{className:"header-left",children:[o.jsx("h1",{className:"studio-title",children:"TPV Designer"}),r&&o.jsxs("span",{className:"current-design-indicator",children:[o.jsx("svg",{width:"4",height:"4",viewBox:"0 0 4 4",children:o.jsx("circle",{cx:"2",cy:"2",r:"2",fill:"currentColor"})}),r]})]}),o.jsxs("div",{className:"header-right",children:[o.jsxs("button",{onClick:t,className:"btn-my-designs",children:[o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"}),o.jsx("path",{d:"M9 22V12h6v10"})]}),"My Designs"]}),n&&o.jsxs("button",{onClick:e,className:"btn-admin",children:[o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M12 15a3 3 0 100-6 3 3 0 000 6z"}),o.jsx("path",{d:"M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"})]}),"Admin"]}),o.jsxs("div",{className:"user-menu",children:[o.jsx("button",{onClick:()=>i(!s),className:"user-menu-button",children:o.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"}),o.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}),s&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"user-menu-backdrop",onClick:()=>i(!1)}),o.jsx("div",{className:"user-menu-dropdown",children:o.jsxs("button",{onClick:a,className:"menu-item sign-out",children:[o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9"})}),"Sign Out"]})})]})]})]})]})})}function lG({design:t,onLoad:e,onDelete:n,onUpdateMetadata:r}){var m;const[s,i]=O.useState(!1),[a,l]=O.useState(!1),c=async()=>{if(confirm(`Delete "${t.name}"? This cannot be undone.`)){l(!0);try{await n(t.id)}catch(y){console.error("Failed to delete design:",y),alert(`Failed to delete: ${y.message}`),l(!1)}}},d=y=>{const v=new Date(y),x=new Date,g=x-v,w=Math.floor(g/(1e3*60*60*24));return w===0?"Today":w===1?"Yesterday":w<7?`${w} days ago`:w<30?`${Math.floor(w/7)} weeks ago`:v.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:v.getFullYear()!==x.getFullYear()?"numeric":void 0})},u=t.input_mode==="sports_surface"||((m=t.design_data)==null?void 0:m.type)==="sports_surface",h=t.thumbnail_url||t.original_png_url||t.original_svg_url,f=u?{label:"Surface",icon:"",className:"type-surface"}:{label:"Motif",icon:"",className:"type-motif"};return o.jsxs("div",{className:`design-card ${a?"deleting":""}`,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:[o.jsxs("div",{className:`design-type-badge ${f.className}`,children:[o.jsx("span",{className:"type-icon",children:f.icon}),o.jsx("span",{className:"type-label",children:f.label})]}),o.jsxs("div",{className:"card-thumbnail",onClick:()=>e(t.id),children:[h?o.jsx("img",{src:h,alt:t.name}):o.jsx("div",{className:"no-thumbnail",children:o.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),o.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),o.jsx("polyline",{points:"21 15 16 10 5 21"})]})}),s&&o.jsx("div",{className:"thumbnail-overlay",children:o.jsx("button",{className:"btn-load",children:"Open"})})]}),o.jsxs("div",{className:"card-info",children:[o.jsx("h3",{className:"design-name",title:t.name,children:t.name}),t.description&&o.jsx("p",{className:"design-description",title:t.description,children:t.description}),o.jsxs("div",{className:"card-meta",children:[t.projects&&o.jsx("span",{className:"project-badge",style:{backgroundColor:t.projects.color||"#1a365d"},title:t.projects.name,children:t.projects.name}),o.jsx("span",{className:"design-date",title:new Date(t.updated_at).toLocaleString(),children:d(t.updated_at)})]}),t.tags&&t.tags.length>0&&o.jsxs("div",{className:"design-tags",children:[t.tags.slice(0,3).map((y,v)=>o.jsx("span",{className:"tag",children:y},v)),t.tags.length>3&&o.jsxs("span",{className:"tag more",children:["+",t.tags.length-3]})]})]}),s&&!a&&o.jsxs("div",{className:"card-actions",children:[o.jsx("button",{onClick:()=>e(t.id),className:"action-btn load-btn",title:"Load design",children:o.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[o.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),o.jsx("circle",{cx:"12",cy:"12",r:"3"})]})}),o.jsx("button",{onClick:c,className:"action-btn delete-btn",title:"Delete design",children:o.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"})})})]}),a&&o.jsx("div",{className:"deleting-overlay",children:o.jsx("div",{className:"spinner"})})]})}function cG({onClose:t,onLoadDesign:e}){const[n,r]=O.useState([]),[s,i]=O.useState([]),[a,l]=O.useState(!0),[c,d]=O.useState(null),[u,h]=O.useState(""),[p,f]=O.useState(""),[m,y]=O.useState(!1),[v,x]=O.useState(!1);O.useEffect(()=>{g()},[u,p]);const g=async()=>{l(!0),d(null);try{const[_,S]=await Promise.all([tm(),Pd({project_id:u||void 0,search:p||void 0,limit:12,offset:0})]);i(_.projects),r(S.designs),y(S.pagination.has_more)}catch(_){console.error("Failed to load designs:",_),d(_.message)}finally{l(!1)}},w=async()=>{if(!(v||!m)){x(!0);try{const _=await Pd({project_id:u||void 0,search:p||void 0,limit:12,offset:n.length});r([...n,..._.designs]),y(_.pagination.has_more)}catch(_){console.error("Failed to load more designs:",_),d(_.message)}finally{x(!1)}}},b=async _=>{try{const{design:S}=await Hl(_);e(S),t()}catch(S){console.error("Failed to load design:",S),alert(`Failed to load design: ${S.message}`)}},k=async _=>{try{await YE(_),r(n.filter(S=>S.id!==_))}catch(S){throw console.error("Failed to delete design:",S),S}};return o.jsx("div",{className:"modal-overlay",onClick:t,children:o.jsxs("div",{className:"modal-content design-gallery-modal",onClick:_=>_.stopPropagation(),children:[o.jsxs("div",{className:"modal-header",children:[o.jsx("h2",{children:"My Designs"}),o.jsx("button",{onClick:t,className:"close-button",children:""})]}),o.jsxs("div",{className:"gallery-filters",children:[o.jsx("div",{className:"filter-group",children:o.jsx("input",{type:"text",placeholder:"Search designs...",value:p,onChange:_=>f(_.target.value),className:"search-input"})}),o.jsx("div",{className:"filter-group",children:o.jsxs("select",{value:u,onChange:_=>h(_.target.value),className:"project-filter",children:[o.jsx("option",{value:"",children:"All Projects"}),s.map(_=>o.jsxs("option",{value:_.id,children:[_.name," (",_.design_count,")"]},_.id))]})})]}),o.jsxs("div",{className:"modal-body",children:[c&&o.jsxs("div",{className:"error-message",children:[c,o.jsx("button",{onClick:g,className:"btn-retry",children:"Retry"})]}),a?o.jsxs("div",{className:"loading-state",children:[o.jsx("div",{className:"spinner-large"}),o.jsx("p",{children:"Loading your designs..."})]}):n.length===0?o.jsxs("div",{className:"empty-state",children:[o.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{d:"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"}),o.jsx("path",{d:"M17 21v-8H7v8M7 3v5h8"})]}),o.jsx("h3",{children:"No designs yet"}),o.jsx("p",{children:p||u?"No designs match your filters. Try adjusting your search.":"Create your first design to see it here!"})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"designs-grid",children:n.map(_=>o.jsx(lG,{design:_,onLoad:b,onDelete:k},_.id))}),m&&o.jsx("div",{className:"load-more-section",children:o.jsx("button",{onClick:w,className:"btn-load-more",disabled:v,children:v?"Loading...":"Load More"})})]})]})]})})}function dG(){const[t,e]=O.useState([]),[n,r]=O.useState(0),[s,i]=O.useState(!1),[a,l]=O.useState(null),[c,d]=O.useState("all"),[u,h]=O.useState("all"),[p,f]=O.useState(""),[m,y]=O.useState(0),v=50,x=async()=>{var E,T;const _=await gn.auth.getSession();return{"Content-Type":"application/json",Authorization:`Bearer ${(T=(E=_==null?void 0:_.data)==null?void 0:E.session)==null?void 0:T.access_token}`}},g=async()=>{i(!0),l(null);try{const _=await x(),S=new URLSearchParams({limit:v.toString(),offset:m.toString()});c!=="all"&&S.append("status",c),u!=="all"&&S.append("saved_status",u),p&&S.append("search",p);const E=await fetch(`/api/admin/jobs?${S.toString()}`,{headers:_}),T=await E.json();if(!E.ok)throw new Error(T.error||"Failed to fetch jobs");e(T.jobs),r(T.total)}catch(_){console.error("Failed to fetch jobs:",_),l(_.message)}finally{i(!1)}};O.useEffect(()=>{g()},[c,u,p,m]);const w=t.filter(_=>_.status==="completed").length,b=t.filter(_=>!_.is_saved&&_.status==="completed").length,k=t.filter(_=>_.is_saved).length;return o.jsxs("div",{className:"generations-tab",children:[o.jsxs("div",{className:"admin-stats-grid",children:[o.jsxs("div",{className:"admin-stat-card",children:[o.jsx("h3",{children:"Total Generations"}),o.jsx("p",{className:"stat-value",children:n}),o.jsx("span",{className:"stat-label",children:"All time"})]}),o.jsxs("div",{className:"admin-stat-card",children:[o.jsx("h3",{children:"Completed"}),o.jsx("p",{className:"stat-value",children:w}),o.jsx("span",{className:"stat-label",children:"Current page"})]}),o.jsxs("div",{className:"admin-stat-card success",children:[o.jsx("h3",{children:"Saved"}),o.jsx("p",{className:"stat-value",children:k}),o.jsx("span",{className:"stat-label",children:" Linked to designs"})]}),o.jsxs("div",{className:"admin-stat-card warning",children:[o.jsx("h3",{children:"Orphaned"}),o.jsx("p",{className:"stat-value",children:b}),o.jsx("span",{className:"stat-label",children:" Not saved"})]})]}),o.jsxs("div",{className:"admin-filters",children:[o.jsxs("div",{className:"filter-group",children:[o.jsx("label",{children:"Status:"}),o.jsxs("select",{value:c,onChange:_=>d(_.target.value),children:[o.jsx("option",{value:"all",children:"All"}),o.jsx("option",{value:"completed",children:"Completed"}),o.jsx("option",{value:"failed",children:"Failed"}),o.jsx("option",{value:"running",children:"Running"}),o.jsx("option",{value:"queued",children:"Queued"})]})]}),o.jsxs("div",{className:"filter-group",children:[o.jsx("label",{children:"Saved:"}),o.jsxs("select",{value:u,onChange:_=>h(_.target.value),children:[o.jsx("option",{value:"all",children:"All"}),o.jsx("option",{value:"saved",children:"Saved only"}),o.jsx("option",{value:"orphaned",children:"Orphaned only"})]})]}),o.jsxs("div",{className:"filter-group search",children:[o.jsx("label",{children:"Search prompt:"}),o.jsx("input",{type:"text",placeholder:"Search in prompts...",value:p,onChange:_=>f(_.target.value)})]})]}),s&&o.jsxs("div",{className:"admin-loading",children:[o.jsx("div",{className:"spinner"}),o.jsx("p",{children:"Loading jobs..."})]}),a&&o.jsx("div",{className:"admin-error",children:o.jsxs("p",{children:["Error: ",a]})}),!s&&t.length>0&&o.jsx("div",{className:"jobs-table-container",children:o.jsxs("table",{className:"jobs-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Thumbnail"}),o.jsx("th",{children:"Prompt"}),o.jsx("th",{children:"Dimensions"}),o.jsx("th",{children:"Status"}),o.jsx("th",{children:"Saved"}),o.jsx("th",{children:"User"}),o.jsx("th",{children:"Created"})]})}),o.jsx("tbody",{children:t.map(_=>o.jsxs("tr",{className:`job-row ${_.is_saved?"saved":"orphaned"} ${_.status}`,children:[o.jsx("td",{className:"thumbnail-cell",children:_.thumbnail_url?o.jsx("img",{src:_.thumbnail_url,alt:"Design",className:"job-thumbnail"}):o.jsx("div",{className:"thumbnail-placeholder",children:"No image"})}),o.jsx("td",{className:"prompt-cell",children:o.jsx("div",{className:"prompt-text",title:_.prompt,children:_.prompt||o.jsx("em",{children:"No prompt"})})}),o.jsx("td",{className:"dimensions-cell",children:_.width_mm&&_.length_mm?o.jsxs("span",{children:[_.width_mm,"  ",_.length_mm," mm"]}):o.jsx("em",{children:"N/A"})}),o.jsx("td",{className:"status-cell",children:o.jsx("span",{className:`status-badge ${_.status}`,children:_.status})}),o.jsx("td",{className:"saved-cell",children:_.is_saved?o.jsx("span",{className:"saved-badge",children:" Saved"}):o.jsx("span",{className:"orphaned-badge",children:" Orphaned"})}),o.jsx("td",{className:"user-cell",children:_.user_email}),o.jsx("td",{className:"date-cell",children:new Date(_.created_at).toLocaleDateString()})]},_.id))})]})}),!s&&t.length===0&&o.jsx("div",{className:"admin-empty",children:o.jsx("p",{children:"No jobs found matching your filters."})}),n>v&&o.jsxs("div",{className:"admin-pagination",children:[o.jsx("button",{onClick:()=>y(Math.max(0,m-v)),disabled:m===0,children:"Previous"}),o.jsxs("span",{children:["Showing ",m+1," to ",Math.min(m+v,n)," of ",n]}),o.jsx("button",{onClick:()=>y(m+v),disabled:m+v>=n,children:"Next"})]}),o.jsx("style",{children:`
        .jobs-table-container {
          overflow-x: auto;
          background: white;
          border-radius: 8px;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .jobs-table {
          width: 100%;
          border-collapse: collapse;
        }

        .jobs-table th {
          background: #f9fafb;
          padding: 1rem;
          text-align: left;
          font-weight: 600;
          font-size: 0.875rem;
          color: #374151;
          border-bottom: 1px solid #e5e7eb;
        }

        .jobs-table td {
          padding: 1rem;
          border-bottom: 1px solid #e5e7eb;
        }

        .job-row.saved {
          background: rgba(16, 185, 129, 0.03);
        }

        .job-row.orphaned {
          background: rgba(245, 158, 11, 0.03);
        }

        .thumbnail-cell {
          width: 80px;
        }

        .job-thumbnail {
          width: 64px;
          height: 64px;
          object-fit: cover;
          border-radius: 4px;
        }

        .thumbnail-placeholder {
          width: 64px;
          height: 64px;
          background: #f3f4f6;
          border-radius: 4px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 0.75rem;
          color: #9ca3af;
        }

        .prompt-cell {
          max-width: 300px;
        }

        .prompt-text {
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }

        .status-badge {
          display: inline-block;
          padding: 0.25rem 0.75rem;
          border-radius: 9999px;
          font-size: 0.75rem;
          font-weight: 500;
        }

        .status-badge.completed {
          background: #d1fae5;
          color: #065f46;
        }

        .status-badge.failed {
          background: #fee2e2;
          color: #991b1b;
        }

        .status-badge.running {
          background: #dbeafe;
          color: #1e40af;
        }

        .status-badge.queued {
          background: #e0e7ff;
          color: #3730a3;
        }

        .saved-badge {
          color: #059669;
          font-weight: 500;
        }

        .orphaned-badge {
          color: #d97706;
          font-weight: 500;
        }

        .user-cell {
          font-size: 0.875rem;
          color: #6b7280;
        }

        .date-cell {
          font-size: 0.875rem;
          color: #6b7280;
          white-space: nowrap;
        }

        .admin-stat-card.success {
          border-left: 4px solid #10b981;
        }

        .admin-stat-card.warning {
          border-left: 4px solid #f59e0b;
        }
      `})]})}function uG(){const[t,e]=O.useState([]),[n,r]=O.useState(null),[s,i]=O.useState(!1),[a,l]=O.useState(null),[c,d]=O.useState(!1),[u,h]=O.useState(new Set),[p,f]=O.useState("all"),m=async()=>{var _,S;const b=await gn.auth.getSession();return{"Content-Type":"application/json",Authorization:`Bearer ${(S=(_=b==null?void 0:b.data)==null?void 0:_.session)==null?void 0:S.access_token}`}},y=async()=>{i(!0),l(null);try{const b=await m(),k=new URLSearchParams;p!=="all"&&k.append("age_filter",p);const _=await fetch(`/api/admin/recovery/orphaned?${k.toString()}`,{headers:b}),S=await _.json();if(!_.ok)throw new Error(S.error||"Failed to fetch orphaned jobs");e(S.orphaned_jobs),r(S.age_buckets)}catch(b){console.error("Failed to fetch orphaned jobs:",b),l(b.message)}finally{i(!1)}};O.useEffect(()=>{y()},[p]);const v=b=>{const k=new Set(u);k.has(b)?k.delete(b):k.add(b),h(k)},x=()=>{h(new Set(t.map(b=>b.id)))},g=()=>{h(new Set)},w=async()=>{if(u.size===0){alert("Please select at least one job to recover");return}if(confirm(`Recover ${u.size} orphaned ${u.size===1?"design":"designs"}?`)){d(!0),l(null);try{const b=await m(),k=await fetch("/api/admin/recovery/create",{method:"POST",headers:b,body:JSON.stringify({job_ids:Array.from(u)})}),_=await k.json();if(!k.ok)throw new Error(_.error||"Failed to recover designs");alert(`Successfully recovered ${_.recovered_count} ${_.recovered_count===1?"design":"designs"}!`),g(),await y()}catch(b){console.error("Failed to recover designs:",b),l(b.message),alert(`Recovery failed: ${b.message}`)}finally{d(!1)}}};return o.jsxs("div",{className:"recovery-tab",children:[o.jsxs("div",{className:"admin-stats-grid",children:[o.jsxs("div",{className:"admin-stat-card warning",children:[o.jsx("h3",{children:"Total Orphaned"}),o.jsx("p",{className:"stat-value",children:t.length}),o.jsx("span",{className:"stat-label",children:"Designs not saved"})]}),n&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"admin-stat-card",children:[o.jsx("h3",{children:"<24 hours"}),o.jsx("p",{className:"stat-value",children:n["<24h"]}),o.jsx("span",{className:"stat-label",children:"Recent"})]}),o.jsxs("div",{className:"admin-stat-card",children:[o.jsx("h3",{children:"1-7 days"}),o.jsx("p",{className:"stat-value",children:n["1-7d"]}),o.jsx("span",{className:"stat-label",children:"This week"})]}),o.jsxs("div",{className:"admin-stat-card",children:[o.jsx("h3",{children:">7 days"}),o.jsx("p",{className:"stat-value",children:n["7-30d"]+n[">30d"]}),o.jsx("span",{className:"stat-label",children:"Older"})]})]})]}),o.jsxs("div",{className:"recovery-controls",children:[o.jsx("div",{className:"admin-filters",children:o.jsxs("div",{className:"filter-group",children:[o.jsx("label",{children:"Age:"}),o.jsxs("select",{value:p,onChange:b=>f(b.target.value),children:[o.jsx("option",{value:"all",children:"All"}),o.jsx("option",{value:"24h",children:"<24 hours"}),o.jsx("option",{value:"7d",children:"<7 days"}),o.jsx("option",{value:"30d",children:"<30 days"})]})]})}),o.jsxs("div",{className:"bulk-actions",children:[o.jsx("button",{onClick:x,className:"btn-secondary",children:"Select All"}),o.jsxs("button",{onClick:g,className:"btn-secondary",children:["Clear (",u.size,")"]}),o.jsx("button",{onClick:w,disabled:u.size===0||c,className:"btn-primary",children:c?"Recovering...":`Recover Selected (${u.size})`})]})]}),s&&o.jsxs("div",{className:"admin-loading",children:[o.jsx("div",{className:"spinner"}),o.jsx("p",{children:"Loading orphaned jobs..."})]}),a&&o.jsx("div",{className:"admin-error",children:o.jsxs("p",{children:["Error: ",a]})}),!s&&t.length>0&&o.jsx("div",{className:"recovery-table-container",children:o.jsxs("table",{className:"recovery-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{style:{width:"40px"},children:o.jsx("input",{type:"checkbox",checked:u.size===t.length,onChange:b=>b.target.checked?x():g()})}),o.jsx("th",{children:"Thumbnail"}),o.jsx("th",{children:"Prompt / Auto-name"}),o.jsx("th",{children:"Dimensions"}),o.jsx("th",{children:"Age"}),o.jsx("th",{children:"User"})]})}),o.jsx("tbody",{children:t.map(b=>o.jsxs("tr",{className:u.has(b.id)?"selected":"",onClick:()=>v(b.id),children:[o.jsx("td",{onClick:k=>k.stopPropagation(),children:o.jsx("input",{type:"checkbox",checked:u.has(b.id),onChange:()=>v(b.id)})}),o.jsx("td",{className:"thumbnail-cell",children:b.thumbnail_url?o.jsx("img",{src:b.thumbnail_url,alt:"Design",className:"job-thumbnail"}):o.jsx("div",{className:"thumbnail-placeholder",children:"No image"})}),o.jsxs("td",{className:"prompt-cell",children:[o.jsx("div",{className:"prompt-text",title:b.prompt,children:b.auto_name}),b.prompt&&b.prompt.length>50&&o.jsx("div",{className:"prompt-full",children:b.prompt})]}),o.jsx("td",{className:"dimensions-cell",children:b.width_mm&&b.length_mm?o.jsxs("span",{children:[b.width_mm,"  ",b.length_mm," mm"]}):o.jsx("em",{children:"N/A"})}),o.jsx("td",{className:"age-cell",children:o.jsxs("span",{className:`age-badge ${b.age_bucket.replace(/[<>]/g,"")}`,children:[b.age_days," ",b.age_days===1?"day":"days"]})}),o.jsx("td",{className:"user-cell",children:b.user_email})]},b.id))})]})}),!s&&t.length===0&&o.jsx("div",{className:"admin-empty",children:o.jsx("p",{children:"No orphaned jobs found. All designs have been saved!"})}),o.jsx("style",{children:`
        .recovery-controls {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 1.5rem;
          flex-wrap: wrap;
          gap: 1rem;
        }

        .bulk-actions {
          display: flex;
          gap: 0.5rem;
        }

        .btn-primary {
          padding: 0.5rem 1rem;
          background: #ff6b35;
          color: white;
          border: none;
          border-radius: 4px;
          font-weight: 500;
          cursor: pointer;
        }

        .btn-primary:hover:not(:disabled) {
          background: #e55a2b;
        }

        .btn-primary:disabled {
          background: #d1d5db;
          cursor: not-allowed;
        }

        .btn-secondary {
          padding: 0.5rem 1rem;
          background: white;
          color: #374151;
          border: 1px solid #d1d5db;
          border-radius: 4px;
          font-weight: 500;
          cursor: pointer;
        }

        .btn-secondary:hover {
          background: #f9fafb;
        }

        .recovery-table-container {
          overflow-x: auto;
          background: white;
          border-radius: 8px;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .recovery-table {
          width: 100%;
          border-collapse: collapse;
        }

        .recovery-table th {
          background: #f9fafb;
          padding: 1rem;
          text-align: left;
          font-weight: 600;
          font-size: 0.875rem;
          color: #374151;
          border-bottom: 1px solid #e5e7eb;
        }

        .recovery-table td {
          padding: 1rem;
          border-bottom: 1px solid #e5e7eb;
        }

        .recovery-table tbody tr {
          cursor: pointer;
          transition: background 0.15s;
        }

        .recovery-table tbody tr:hover {
          background: #f9fafb;
        }

        .recovery-table tbody tr.selected {
          background: #eff6ff;
        }

        .age-badge {
          display: inline-block;
          padding: 0.25rem 0.75rem;
          border-radius: 9999px;
          font-size: 0.75rem;
          font-weight: 500;
        }

        .age-badge.24h {
          background: #fee2e2;
          color: #991b1b;
        }

        .age-badge.1-7d {
          background: #fed7aa;
          color: #92400e;
        }

        .age-badge.7-30d {
          background: #fef3c7;
          color: #78350f;
        }

        .age-badge.30d {
          background: #e5e7eb;
          color: #374151;
        }

        .prompt-full {
          font-size: 0.75rem;
          color: #6b7280;
          margin-top: 0.25rem;
          display: none;
        }

        .recovery-table tbody tr:hover .prompt-full {
          display: block;
        }
      `})]})}function hG({onClose:t}){const[e,n]=O.useState("overview"),[r,s]=O.useState(!0),[i,a]=O.useState(null),[l,c]=O.useState(null),[d,u]=O.useState([]),[h,p]=O.useState([]),[f,m]=O.useState(0),[y,v]=O.useState(null),x=async()=>{var E,T;const _=await gn.auth.getSession();return{"Content-Type":"application/json",Authorization:`Bearer ${(T=(E=_==null?void 0:_.data)==null?void 0:E.session)==null?void 0:T.access_token}`}},g=async()=>{try{const _=await x(),S=await fetch("/api/admin/analytics/overview",{headers:_}),E=await S.json();if(!S.ok)throw new Error(E.error||"Failed to fetch overview");c(E.stats)}catch(_){console.error("Failed to fetch overview:",_),a(_.message)}},w=async()=>{try{const _=await x(),S=await fetch("/api/admin/users",{headers:_}),E=await S.json();if(!S.ok)throw new Error(E.error||"Failed to fetch users");u(E.users)}catch(_){console.error("Failed to fetch users:",_),a(_.message)}},b=async()=>{try{const _=await x(),S=await fetch("/api/admin/designs?limit=50",{headers:_}),E=await S.json();if(!S.ok)throw new Error(E.error||"Failed to fetch designs");p(E.designs),m(E.total)}catch(_){console.error("Failed to fetch designs:",_),a(_.message)}},k=async()=>{try{const _=await x(),S=await fetch("/api/admin/analytics/colours",{headers:_}),E=await S.json();if(!S.ok)throw new Error(E.error||"Failed to fetch colour analytics");v(E.analytics)}catch(_){console.error("Failed to fetch colours:",_),a(_.message)}};return O.useEffect(()=>{(async()=>{s(!0),await g(),s(!1)})()},[]),O.useEffect(()=>{e==="users"&&d.length===0?w():e==="designs"&&h.length===0?b():e==="colours"&&!y&&k()},[e]),r?o.jsxs("div",{className:"admin-loading",children:[o.jsx("div",{className:"spinner"}),o.jsx("p",{children:"Loading admin dashboard..."})]}):i?o.jsxs("div",{className:"admin-error",children:[o.jsx("h2",{children:"Access Denied"}),o.jsx("p",{children:i}),o.jsx("p",{children:"You need admin privileges to view this page."})]}):o.jsxs("div",{className:"admin-dashboard",children:[o.jsxs("header",{className:"admin-header",children:[o.jsxs("div",{className:"admin-header-left",children:[o.jsxs("button",{onClick:t,className:"btn-back",children:[o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M19 12H5M12 19l-7-7 7-7"})}),"Back to Studio"]}),o.jsx("h1",{children:"TPV Studio Admin"})]}),o.jsxs("nav",{className:"admin-nav",children:[o.jsx("button",{className:e==="overview"?"active":"",onClick:()=>n("overview"),children:"Overview"}),o.jsx("button",{className:e==="generations"?"active":"",onClick:()=>n("generations"),children:"Generations"}),o.jsx("button",{className:e==="recovery"?"active":"",onClick:()=>n("recovery"),children:"Recovery"}),o.jsx("button",{className:e==="users"?"active":"",onClick:()=>n("users"),children:"Users"}),o.jsx("button",{className:e==="designs"?"active":"",onClick:()=>n("designs"),children:"Designs"}),o.jsx("button",{className:e==="colours"?"active":"",onClick:()=>n("colours"),children:"Colour Analytics"})]})]}),o.jsxs("main",{className:"admin-content",children:[e==="overview"&&l&&o.jsx(pG,{stats:l}),e==="generations"&&o.jsx(dG,{}),e==="recovery"&&o.jsx(uG,{}),e==="users"&&o.jsx(fG,{users:d}),e==="designs"&&o.jsx(mG,{designs:h,total:f}),e==="colours"&&y&&o.jsx(gG,{analytics:y})]}),o.jsx("style",{jsx:!0,children:`
        .admin-dashboard {
          min-height: 100vh;
          background: #f8fafc;
        }

        .admin-header {
          background: white;
          border-bottom: 1px solid #e5e7eb;
          padding: 20px 40px;
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
        }

        .admin-header-left {
          display: flex;
          flex-direction: column;
          gap: 8px;
        }

        .btn-back {
          display: inline-flex;
          align-items: center;
          gap: 6px;
          padding: 6px 12px;
          background: #f3f4f6;
          border: 1px solid #e5e7eb;
          border-radius: 6px;
          font-size: 13px;
          color: #6b7280;
          cursor: pointer;
          transition: all 0.2s;
          width: fit-content;
        }

        .btn-back:hover {
          background: #e5e7eb;
          color: #374151;
        }

        .admin-header h1 {
          margin: 0;
          font-size: 24px;
          color: #1e4a7a;
        }

        .admin-nav {
          display: flex;
          gap: 8px;
        }

        .admin-nav button {
          padding: 8px 16px;
          border: 1px solid #e5e7eb;
          background: white;
          border-radius: 6px;
          cursor: pointer;
          font-size: 14px;
          color: #64748b;
          transition: all 0.2s;
        }

        .admin-nav button:hover {
          background: #f8fafc;
          color: #1e4a7a;
        }

        .admin-nav button.active {
          background: #1e4a7a;
          color: white;
          border-color: #1e4a7a;
        }

        .admin-content {
          padding: 24px 40px;
        }

        .admin-loading,
        .admin-error {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          min-height: 50vh;
          text-align: center;
        }

        .admin-error h2 {
          color: #dc2626;
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 3px solid #e5e7eb;
          border-top-color: #1e4a7a;
          border-radius: 50%;
          animation: spin 0.8s linear infinite;
          margin-bottom: 16px;
        }

        @keyframes spin {
          to { transform: rotate(360deg); }
        }
      `})]})}function pG({stats:t}){return o.jsxs("div",{className:"overview-panel",children:[o.jsx("h2",{children:"Dashboard Overview"}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-card",children:[o.jsx("div",{className:"stat-value",children:t.totals.users}),o.jsx("div",{className:"stat-label",children:"Total Users"})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("div",{className:"stat-value",children:t.totals.designs}),o.jsx("div",{className:"stat-label",children:"Total Designs"})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("div",{className:"stat-value",children:t.totals.projects}),o.jsx("div",{className:"stat-label",children:"Total Projects"})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("div",{className:"stat-value",children:t.totals.jobs}),o.jsx("div",{className:"stat-label",children:"AI Jobs Run"})]})]}),o.jsxs("div",{className:"stats-grid",children:[o.jsxs("div",{className:"stat-card highlight",children:[o.jsx("div",{className:"stat-value",children:t.activity.active_users_30d}),o.jsx("div",{className:"stat-label",children:"Active Users (30d)"})]}),o.jsxs("div",{className:"stat-card highlight",children:[o.jsx("div",{className:"stat-value",children:t.activity.designs_7d}),o.jsx("div",{className:"stat-label",children:"Designs This Week"})]}),o.jsxs("div",{className:"stat-card highlight",children:[o.jsx("div",{className:"stat-value",children:t.activity.designs_30d}),o.jsx("div",{className:"stat-label",children:"Designs This Month"})]}),o.jsxs("div",{className:"stat-card highlight",children:[o.jsxs("div",{className:"stat-value",children:[t.activity.job_success_rate,"%"]}),o.jsx("div",{className:"stat-label",children:"Job Success Rate"})]})]}),o.jsx("h3",{children:"Activity Timeline (14 Days)"}),o.jsx("div",{className:"activity-chart",children:t.timeline.map((e,n)=>o.jsxs("div",{className:"bar-container",children:[o.jsx("div",{className:"bar",style:{height:`${Math.max(4,e.count*20)}px`},title:`${e.date}: ${e.count} designs`}),o.jsx("div",{className:"bar-label",children:e.date.split("-")[2]})]},n))}),o.jsxs("div",{className:"breakdowns",children:[o.jsxs("div",{className:"breakdown-card",children:[o.jsx("h4",{children:"Input Mode"}),o.jsxs("div",{className:"breakdown-items",children:[o.jsxs("div",{className:"breakdown-item",children:[o.jsx("span",{children:"Prompt"}),o.jsx("strong",{children:t.breakdowns.input_mode.prompt})]}),o.jsxs("div",{className:"breakdown-item",children:[o.jsx("span",{children:"Image Upload"}),o.jsx("strong",{children:t.breakdowns.input_mode.image})]}),o.jsxs("div",{className:"breakdown-item",children:[o.jsx("span",{children:"SVG Upload"}),o.jsx("strong",{children:t.breakdowns.input_mode.svg})]})]})]}),o.jsxs("div",{className:"breakdown-card",children:[o.jsx("h4",{children:"View Mode Preference"}),o.jsxs("div",{className:"breakdown-items",children:[o.jsxs("div",{className:"breakdown-item",children:[o.jsx("span",{children:"Solid TPV"}),o.jsx("strong",{children:t.breakdowns.view_mode.solid})]}),o.jsxs("div",{className:"breakdown-item",children:[o.jsx("span",{children:"Blend TPV"}),o.jsx("strong",{children:t.breakdowns.view_mode.blend})]})]})]})]}),o.jsx("style",{jsx:!0,children:`
        .overview-panel h2 {
          margin: 0 0 24px 0;
          color: #1a202c;
        }

        .overview-panel h3 {
          margin: 32px 0 16px 0;
          color: #1a202c;
        }

        .stats-grid {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          gap: 16px;
          margin-bottom: 16px;
        }

        .stat-card {
          background: white;
          padding: 20px;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
        }

        .stat-card.highlight {
          border-color: #1e4a7a;
          border-width: 2px;
        }

        .stat-value {
          font-size: 32px;
          font-weight: 700;
          color: #1e4a7a;
        }

        .stat-label {
          font-size: 14px;
          color: #64748b;
          margin-top: 4px;
        }

        .activity-chart {
          display: flex;
          align-items: flex-end;
          gap: 8px;
          height: 120px;
          padding: 16px;
          background: white;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
        }

        .bar-container {
          flex: 1;
          display: flex;
          flex-direction: column;
          align-items: center;
        }

        .bar {
          width: 100%;
          background: #1e4a7a;
          border-radius: 4px 4px 0 0;
          min-height: 4px;
        }

        .bar-label {
          font-size: 10px;
          color: #64748b;
          margin-top: 4px;
        }

        .breakdowns {
          display: grid;
          grid-template-columns: repeat(2, 1fr);
          gap: 16px;
          margin-top: 24px;
        }

        .breakdown-card {
          background: white;
          padding: 20px;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
        }

        .breakdown-card h4 {
          margin: 0 0 12px 0;
          color: #1a202c;
        }

        .breakdown-item {
          display: flex;
          justify-content: space-between;
          padding: 8px 0;
          border-bottom: 1px solid #f3f4f6;
        }

        .breakdown-item:last-child {
          border-bottom: none;
        }

        .breakdown-item span {
          color: #64748b;
        }

        .breakdown-item strong {
          color: #1a202c;
        }
      `})]})}function fG({users:t}){return o.jsxs("div",{className:"users-panel",children:[o.jsxs("h2",{children:["User Management (",t.length," users)"]}),o.jsxs("table",{className:"users-table",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Email"}),o.jsx("th",{children:"Role"}),o.jsx("th",{children:"Designs"}),o.jsx("th",{children:"Projects"}),o.jsx("th",{children:"Jobs"}),o.jsx("th",{children:"Last Design"}),o.jsx("th",{children:"Joined"})]})}),o.jsx("tbody",{children:t.map(e=>o.jsxs("tr",{children:[o.jsx("td",{children:e.email}),o.jsx("td",{children:o.jsx("span",{className:`role-badge ${e.role}`,children:e.role})}),o.jsx("td",{children:e.design_count}),o.jsx("td",{children:e.project_count}),o.jsx("td",{children:e.job_count}),o.jsx("td",{children:e.last_design_at?new Date(e.last_design_at).toLocaleDateString():"-"}),o.jsx("td",{children:new Date(e.created_at).toLocaleDateString()})]},e.id))})]}),o.jsx("style",{jsx:!0,children:`
        .users-panel h2 {
          margin: 0 0 24px 0;
          color: #1a202c;
        }

        .users-table {
          width: 100%;
          background: white;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
          border-collapse: collapse;
        }

        .users-table th,
        .users-table td {
          padding: 12px 16px;
          text-align: left;
          border-bottom: 1px solid #e5e7eb;
        }

        .users-table th {
          background: #f8fafc;
          font-weight: 600;
          color: #64748b;
          font-size: 12px;
          text-transform: uppercase;
        }

        .users-table td {
          font-size: 14px;
          color: #1a202c;
        }

        .role-badge {
          padding: 4px 8px;
          border-radius: 4px;
          font-size: 12px;
          font-weight: 500;
        }

        .role-badge.user {
          background: #f3f4f6;
          color: #64748b;
        }

        .role-badge.admin {
          background: #dbeafe;
          color: #1e40af;
        }

        .role-badge.superadmin {
          background: #fef3c7;
          color: #92400e;
        }
      `})]})}function mG({designs:t,total:e}){return o.jsxs("div",{className:"designs-panel",children:[o.jsxs("h2",{children:["All Designs (",e," total)"]}),o.jsx("div",{className:"designs-grid",children:t.map(n=>o.jsxs("div",{className:"design-card",children:[o.jsx("div",{className:"design-thumbnail",children:n.thumbnail_url||n.original_png_url?o.jsx("img",{src:n.thumbnail_url||n.original_png_url,alt:n.name}):o.jsx("div",{className:"no-image",children:"No preview"})}),o.jsxs("div",{className:"design-info",children:[o.jsx("h4",{children:n.name}),o.jsx("p",{className:"design-user",children:n.user_email}),o.jsx("p",{className:"design-date",children:new Date(n.created_at).toLocaleDateString()}),n.project&&o.jsx("span",{className:"project-badge",style:{backgroundColor:n.project.color||"#64748b"},children:n.project.name})]})]},n.id))}),o.jsx("style",{jsx:!0,children:`
        .designs-panel h2 {
          margin: 0 0 24px 0;
          color: #1a202c;
        }

        .designs-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
          gap: 16px;
        }

        .design-card {
          background: white;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
          overflow: hidden;
        }

        .design-thumbnail {
          aspect-ratio: 1;
          background: #f3f4f6;
          overflow: hidden;
        }

        .design-thumbnail img {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }

        .no-image {
          width: 100%;
          height: 100%;
          display: flex;
          align-items: center;
          justify-content: center;
          color: #9ca3af;
          font-size: 14px;
        }

        .design-info {
          padding: 12px;
        }

        .design-info h4 {
          margin: 0 0 4px 0;
          font-size: 14px;
          color: #1a202c;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }

        .design-user {
          margin: 0;
          font-size: 12px;
          color: #64748b;
        }

        .design-date {
          margin: 4px 0;
          font-size: 12px;
          color: #9ca3af;
        }

        .project-badge {
          display: inline-block;
          padding: 2px 8px;
          border-radius: 10px;
          font-size: 10px;
          color: white;
        }
      `})]})}function gG({analytics:t}){return o.jsxs("div",{className:"colours-panel",children:[o.jsx("h2",{children:"Colour Usage Analytics"}),o.jsxs("div",{className:"colour-stats",children:[o.jsxs("div",{className:"stat-card",children:[o.jsx("div",{className:"stat-value",children:t.totals.designs_analysed}),o.jsx("div",{className:"stat-label",children:"Designs Analysed"})]}),o.jsxs("div",{className:"stat-card",children:[o.jsx("div",{className:"stat-value",children:t.totals.colour_usages}),o.jsx("div",{className:"stat-label",children:"Total Colour Uses"})]})]}),o.jsx("h3",{children:"Top 10 TPV Colours"}),o.jsx("div",{className:"colour-list",children:t.top_colours.map((e,n)=>o.jsxs("div",{className:"colour-item",children:[o.jsxs("span",{className:"colour-rank",children:["#",n+1]}),o.jsx("div",{className:"colour-swatch",style:{backgroundColor:e.hex}}),o.jsxs("div",{className:"colour-info",children:[o.jsx("strong",{children:e.code}),o.jsx("span",{children:e.name})]}),o.jsxs("div",{className:"colour-count",children:[e.count," uses"]})]},e.code))}),o.jsx("h3",{children:"Colour Family Breakdown"}),o.jsx("div",{className:"family-bars",children:Object.entries(t.families).map(([e,n])=>o.jsxs("div",{className:"family-bar",children:[o.jsx("span",{className:"family-name",children:e}),o.jsx("div",{className:"bar-bg",children:o.jsx("div",{className:"bar-fill",style:{width:`${n/t.totals.colour_usages*100}%`,backgroundColor:yG(e)}})}),o.jsx("span",{className:"family-count",children:n})]},e))}),t.top_blends.length>0&&o.jsxs(o.Fragment,{children:[o.jsx("h3",{children:"Top Blend Combinations"}),o.jsx("div",{className:"blend-list",children:t.top_blends.map((e,n)=>o.jsxs("div",{className:"blend-item",children:[o.jsx("div",{className:"blend-swatches",children:e.components.map((r,s)=>o.jsx("div",{className:"blend-swatch",style:{backgroundColor:r.hex},title:`${r.code} - ${r.name}`},s))}),o.jsx("div",{className:"blend-codes",children:e.components.map(r=>r.code).join(" + ")}),o.jsxs("div",{className:"blend-count",children:[e.count," uses"]})]},n))})]}),o.jsx("style",{jsx:!0,children:`
        .colours-panel h2 {
          margin: 0 0 24px 0;
          color: #1a202c;
        }

        .colours-panel h3 {
          margin: 32px 0 16px 0;
          color: #1a202c;
        }

        .colour-stats {
          display: grid;
          grid-template-columns: repeat(2, 1fr);
          gap: 16px;
          margin-bottom: 24px;
        }

        .stat-card {
          background: white;
          padding: 20px;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
        }

        .stat-value {
          font-size: 32px;
          font-weight: 700;
          color: #1e4a7a;
        }

        .stat-label {
          font-size: 14px;
          color: #64748b;
          margin-top: 4px;
        }

        .colour-list {
          background: white;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
          overflow: hidden;
        }

        .colour-item {
          display: flex;
          align-items: center;
          gap: 12px;
          padding: 12px 16px;
          border-bottom: 1px solid #f3f4f6;
        }

        .colour-item:last-child {
          border-bottom: none;
        }

        .colour-rank {
          width: 30px;
          font-size: 12px;
          color: #9ca3af;
        }

        .colour-swatch {
          width: 32px;
          height: 32px;
          border-radius: 6px;
          border: 1px solid #e5e7eb;
        }

        .colour-info {
          flex: 1;
        }

        .colour-info strong {
          display: block;
          color: #1a202c;
        }

        .colour-info span {
          font-size: 12px;
          color: #64748b;
        }

        .colour-count {
          font-weight: 600;
          color: #1e4a7a;
        }

        .family-bars {
          background: white;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
          padding: 16px;
        }

        .family-bar {
          display: flex;
          align-items: center;
          gap: 12px;
          margin-bottom: 12px;
        }

        .family-bar:last-child {
          margin-bottom: 0;
        }

        .family-name {
          width: 80px;
          font-size: 14px;
          color: #64748b;
          text-transform: capitalize;
        }

        .bar-bg {
          flex: 1;
          height: 20px;
          background: #f3f4f6;
          border-radius: 4px;
          overflow: hidden;
        }

        .bar-fill {
          height: 100%;
          border-radius: 4px;
        }

        .family-count {
          width: 50px;
          text-align: right;
          font-weight: 600;
          color: #1a202c;
        }

        .blend-list {
          background: white;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
          overflow: hidden;
        }

        .blend-item {
          display: flex;
          align-items: center;
          gap: 12px;
          padding: 12px 16px;
          border-bottom: 1px solid #f3f4f6;
        }

        .blend-item:last-child {
          border-bottom: none;
        }

        .blend-swatches {
          display: flex;
          gap: 4px;
        }

        .blend-swatch {
          width: 24px;
          height: 24px;
          border-radius: 4px;
          border: 1px solid #e5e7eb;
        }

        .blend-codes {
          flex: 1;
          font-size: 14px;
          color: #1a202c;
        }

        .blend-count {
          font-weight: 600;
          color: #1e4a7a;
        }
      `})]})}function yG(t){return{reds:"#dc2626",greens:"#16a34a",blues:"#2563eb",yellows:"#ca8a04",neutrals:"#6b7280"}[t]||"#6b7280"}const Ch=[{code:"RH30",name:"Beige",hex:"#E4C4AA"},{code:"RH31",name:"Cream",hex:"#E8E3D8"},{code:"RH41",name:"Bright Yellow",hex:"#FFD833"},{code:"RH40",name:"Mustard",hex:"#E5A144"},{code:"RH50",name:"Orange",hex:"#F15B32"},{code:"RH01",name:"Standard Red",hex:"#A5362F"},{code:"RH02",name:"Bright Red",hex:"#E21F2F"},{code:"RH90",name:"Funky Pink",hex:"#E8457E"},{code:"RH21",name:"Purple",hex:"#493D8C"},{code:"RH20",name:"Standard Blue",hex:"#0075BC"},{code:"RH22",name:"Light Blue",hex:"#47AFE3"},{code:"RH23",name:"Azure",hex:"#039DC4"},{code:"RH26",name:"Turquoise",hex:"#00A6A3"},{code:"RH12",name:"Dark Green",hex:"#006C55"},{code:"RH10",name:"Standard Green",hex:"#609B63"},{code:"RH11",name:"Bright Green",hex:"#3BB44A"},{code:"RH32",name:"Brown",hex:"#8B5F3C"},{code:"RH65",name:"Pale Grey",hex:"#D9D9D6"},{code:"RH61",name:"Light Grey",hex:"#939598"},{code:"RH60",name:"Dark Grey",hex:"#59595B"},{code:"RH70",name:"Black",hex:"#231F20"}],jv=["ocean theme with dolphins and waves","jungle adventure with parrots","solar system with planets","garden with butterflies and flowers","racing track with cars","underwater coral reef scene","dinosaur footprints trail","rainbow with clouds"],xG=[...Array(60)].map(t=>({delay:`${Math.random()*3}s`,x:`${Math.random()*100}%`,y:`${Math.random()*100}%`,size:`${8+Math.random()*12}px`}));function vG(){const[t,e]=O.useState(""),[n,r]=O.useState(""),[s,i]=O.useState(""),[a,l]=O.useState(!1),[c,d]=O.useState(!1),[u,h]=O.useState(0);O.useEffect(()=>{const m=setInterval(()=>{h(y=>(y+1)%jv.length)},5e3);return()=>clearInterval(m)},[]);const p=async m=>{m.preventDefault(),i(""),l(!0);try{await Kr.signIn(t,n)}catch(y){i(y.message||"Sign in failed")}finally{l(!1)}},f=m=>{var y;(y=document.getElementById(m))==null||y.scrollIntoView({behavior:"smooth"})};return o.jsxs("div",{className:"landing-page",children:[o.jsxs("nav",{className:"landing-nav",children:[o.jsxs("div",{className:"nav-logo",children:[o.jsxs("div",{className:"logo-main",children:[o.jsxs("span",{className:"logo-text",children:["Rosehill TPV",o.jsx("sup",{children:""})]}),o.jsx("span",{className:"logo-accent",children:"Studio"})]}),o.jsx("span",{className:"logo-byline",children:"by Rosehill Sports & Play"})]}),o.jsxs("div",{className:"nav-links",children:[o.jsx("button",{onClick:()=>f("features"),children:"Features"}),o.jsx("button",{onClick:()=>f("palette"),children:"Colours"}),o.jsx("button",{onClick:()=>d(!0),className:"nav-cta",children:"Sign In"})]})]}),o.jsxs("section",{className:"hero",children:[o.jsx("div",{className:"hero-background",children:o.jsx("div",{className:"granule-field",children:xG.map((m,y)=>o.jsx("div",{className:"granule",style:{"--delay":m.delay,"--x":m.x,"--y":m.y,"--color":Ch[y%Ch.length].hex,"--size":m.size}},y))})}),o.jsxs("div",{className:"hero-content",children:[o.jsxs("div",{className:"hero-badge",children:["Rosehill TPV",o.jsx("sup",{children:""})," Surface Design Platform"]}),o.jsxs("h1",{children:[o.jsx("span",{className:"hero-line-1",children:"Design Any"}),o.jsxs("span",{className:"hero-line-2",children:["Rosehill TPV",o.jsx("sup",{children:""})," Surface"]})]}),o.jsxs("p",{className:"hero-subtitle",children:["From AI-generated playground art to professional sports courts  one powerful design platform for all your Rosehill TPV",o.jsx("sup",{children:""})," surfaces."]}),o.jsxs("div",{className:"hero-ctas",children:[o.jsxs("button",{onClick:()=>d(!0),className:"cta-primary",children:["Start Designing",o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M5 12h14M12 5l7 7-7 7"})})]}),o.jsx("button",{onClick:()=>f("how-it-works"),className:"cta-secondary",children:"See How It Works"})]})]}),o.jsx("div",{className:"hero-visual",children:o.jsx("div",{className:"mockup-container",children:o.jsxs("div",{className:"mockup-screen",children:[o.jsx("div",{className:"mockup-header",children:o.jsxs("div",{className:"mockup-dots",children:[o.jsx("span",{}),o.jsx("span",{}),o.jsx("span",{})]})}),o.jsxs("div",{className:"mockup-content",children:[o.jsx("div",{className:"mockup-input",children:o.jsx("span",{className:"typing-text",children:jv[u]},u)}),o.jsxs("div",{className:"mockup-preview",children:[o.jsx("div",{className:"preview-shape shape-1"}),o.jsx("div",{className:"preview-shape shape-2"}),o.jsx("div",{className:"preview-shape shape-3"})]})]})]})})})]}),o.jsxs("section",{className:"unified-showcase",children:[o.jsxs("div",{className:"section-header",children:[o.jsx("span",{className:"section-tag",children:"One Powerful Tool"}),o.jsx("h2",{children:"Design Any Surface"}),o.jsx("p",{className:"section-subtitle",children:"Courts, tracks, playgrounds, and custom graphics  all in one canvas"})]}),o.jsx("div",{className:"showcase-container",children:o.jsxs("div",{className:"showcase-card",children:[o.jsxs("div",{className:"showcase-canvas",children:[o.jsxs("div",{className:"canvas-preview",children:[o.jsx("div",{className:"canvas-grid"}),o.jsxs("div",{className:"canvas-surface",children:[o.jsx("div",{className:"surface-court"}),o.jsx("div",{className:"surface-motif"})]})]}),o.jsxs("div",{className:"capability-pill pill-courts",children:[o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("rect",{x:"2",y:"4",width:"20",height:"16",rx:"2"}),o.jsx("circle",{cx:"12",cy:"12",r:"3"}),o.jsx("path",{d:"M2 12h4M18 12h4"})]}),o.jsx("span",{children:"Courts & Tracks"})]}),o.jsxs("div",{className:"capability-pill pill-ai",children:[o.jsx("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2z"})}),o.jsx("span",{children:"AI Artwork"})]}),o.jsxs("div",{className:"capability-pill pill-upload",children:[o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),o.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),o.jsx("path",{d:"M21 15l-5-5L5 21"})]}),o.jsx("span",{children:"Custom Images"})]}),o.jsxs("div",{className:"capability-pill pill-layers",children:[o.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),o.jsx("path",{d:"M2 17l10 5 10-5"}),o.jsx("path",{d:"M2 12l10 5 10-5"})]}),o.jsx("span",{children:"Layer & Combine"})]})]}),o.jsx("div",{className:"showcase-tagline",children:"One canvas. Unlimited possibilities."}),o.jsxs("div",{className:"showcase-features",children:[o.jsxs("div",{className:"showcase-feature",children:[o.jsx("div",{className:"feature-badge ai-badge",children:"AI-POWERED"}),o.jsx("span",{children:"Generate motifs from text descriptions"})]}),o.jsxs("div",{className:"showcase-feature",children:[o.jsx("div",{className:"feature-badge template-badge",children:"TEMPLATES"}),o.jsx("span",{children:"15+ professional court layouts"})]}),o.jsxs("div",{className:"showcase-feature",children:[o.jsx("div",{className:"feature-badge compose-badge",children:"COMPOSE"}),o.jsx("span",{children:"Mix courts, tracks & artwork freely"})]})]}),o.jsxs("button",{onClick:()=>d(!0),className:"cta-primary showcase-cta",children:["Start Designing",o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M5 12h14M12 5l7 7-7 7"})})]})]})})]}),o.jsxs("section",{id:"how-it-works",className:"how-it-works",children:[o.jsxs("div",{className:"section-header",children:[o.jsx("span",{className:"section-tag",children:"Process"}),o.jsx("h2",{children:"Three Steps to Production-Ready Designs"})]}),o.jsxs("div",{className:"steps-container",children:[o.jsxs("div",{className:"step",children:[o.jsx("div",{className:"step-number",children:"01"}),o.jsx("div",{className:"step-icon",children:o.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),o.jsx("path",{d:"M3 9h18M9 21V9"})]})}),o.jsx("h3",{children:"Set Up Your Surface"}),o.jsx("p",{children:"Define your dimensions and choose your base colour. Start with any size from small playgrounds to full athletic facilities."})]}),o.jsx("div",{className:"step-connector",children:o.jsx("svg",{viewBox:"0 0 100 20",preserveAspectRatio:"none",children:o.jsx("path",{d:"M0 10 Q50 10 100 10",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeDasharray:"4 4"})})}),o.jsxs("div",{className:"step",children:[o.jsx("div",{className:"step-number",children:"02"}),o.jsx("div",{className:"step-icon",children:o.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),o.jsx("path",{d:"M2 17l10 5 10-5"}),o.jsx("path",{d:"M2 12l10 5 10-5"})]})}),o.jsx("h3",{children:"Add Elements"}),o.jsx("p",{children:"Drop in courts and tracks from the library, generate AI artwork, upload your own designs  layer and combine freely."})]}),o.jsx("div",{className:"step-connector",children:o.jsx("svg",{viewBox:"0 0 100 20",preserveAspectRatio:"none",children:o.jsx("path",{d:"M0 10 Q50 10 100 10",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeDasharray:"4 4"})})}),o.jsxs("div",{className:"step",children:[o.jsx("div",{className:"step-number",children:"03"}),o.jsx("div",{className:"step-icon",children:o.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),o.jsx("path",{d:"M14 2v6h6M12 18v-6M9 15l3 3 3-3"})]})}),o.jsx("h3",{children:"Export & Build"}),o.jsx("p",{children:"Generate professional PDFs with material specifications, colour recipes, and exact quantities for installation."})]})]})]}),o.jsxs("section",{id:"features",className:"features",children:[o.jsxs("div",{className:"section-header",children:[o.jsx("span",{className:"section-tag",children:"Capabilities"}),o.jsxs("h2",{children:["Everything You Need to Design Rosehill TPV",o.jsx("sup",{children:""})," Surfaces"]})]}),o.jsxs("div",{className:"features-grid unified-features",children:[o.jsxs("div",{className:"feature-card feature-highlight",children:[o.jsx("div",{className:"feature-icon",children:o.jsx("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:o.jsx("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2z"})})}),o.jsx("h3",{children:"AI Text-to-Vector"}),o.jsxs("p",{children:["Describe any concept in natural language. Our AI transforms your words into production-ready vector designs optimised for Rosehill TPV",o.jsx("sup",{children:""})," surfaces."]}),o.jsx("div",{className:"feature-example",children:'"vibrant underwater scene with coral reef"'})]}),o.jsxs("div",{className:"feature-card",children:[o.jsx("div",{className:"feature-icon",children:o.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("rect",{x:"2",y:"4",width:"20",height:"16",rx:"2"}),o.jsx("circle",{cx:"12",cy:"12",r:"3"}),o.jsx("path",{d:"M2 12h4M18 12h4"})]})}),o.jsx("h3",{children:"Court & Track Library"}),o.jsx("p",{children:"15+ professional templates including basketball, tennis, netball, futsal, and running tracks."})]}),o.jsxs("div",{className:"feature-card",children:[o.jsx("div",{className:"feature-icon",children:o.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),o.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),o.jsx("path",{d:"M21 15l-5-5L5 21"})]})}),o.jsx("h3",{children:"Image Vectorisation"}),o.jsxs("p",{children:["Upload any image and convert it to clean vectors optimised for Rosehill TPV",o.jsx("sup",{children:""})," production."]})]}),o.jsxs("div",{className:"feature-card",children:[o.jsx("div",{className:"feature-icon",children:o.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("circle",{cx:"13.5",cy:"6.5",r:"2.5"}),o.jsx("circle",{cx:"17.5",cy:"10.5",r:"2.5"}),o.jsx("circle",{cx:"8.5",cy:"7.5",r:"2.5"}),o.jsx("circle",{cx:"6.5",cy:"12.5",r:"2.5"})]})}),o.jsx("h3",{children:"Colour Matching"}),o.jsxs("p",{children:["Automatic colour matching to the Rosehill TPV",o.jsx("sup",{children:""})," palette with precise specifications."]})]}),o.jsxs("div",{className:"feature-card",children:[o.jsx("div",{className:"feature-icon",children:o.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{d:"M12 2L2 7l10 5 10-5-10-5z"}),o.jsx("path",{d:"M2 17l10 5 10-5"}),o.jsx("path",{d:"M2 12l10 5 10-5"})]})}),o.jsx("h3",{children:"Layer Management"}),o.jsx("p",{children:"Combine courts, tracks, and motifs freely. Drag, rotate, and layer with precision controls."})]}),o.jsxs("div",{className:"feature-card",children:[o.jsx("div",{className:"feature-icon",children:o.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[o.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),o.jsx("path",{d:"M14 2v6h6M12 18v-6M9 15l3 3 3-3"})]})}),o.jsx("h3",{children:"PDF Specifications"}),o.jsx("p",{children:"Export production-ready material specs with colour specifications and installation guides."})]})]})]}),o.jsxs("section",{id:"palette",className:"palette-section",children:[o.jsxs("div",{className:"section-header light",children:[o.jsx("span",{className:"section-tag",children:"Palette"}),o.jsxs("h2",{children:["21 Standard Rosehill TPV",o.jsx("sup",{children:""})," Colours"]}),o.jsxs("p",{className:"section-subtitle",children:["The complete Rosehill TPV",o.jsx("sup",{children:""})," granule palette at your fingertips"]})]}),o.jsx("div",{className:"palette-grid",children:Ch.map((m,y)=>o.jsxs("div",{className:"palette-swatch",style:{"--swatch-color":m.hex,"--delay":`${y*.03}s`},children:[o.jsx("div",{className:"swatch-color"}),o.jsxs("div",{className:"swatch-info",children:[o.jsx("span",{className:"swatch-name",children:m.name}),o.jsx("span",{className:"swatch-code",children:m.code})]})]},m.code))})]}),o.jsx("section",{className:"benefits",children:o.jsxs("div",{className:"benefits-grid benefits-grid-4",children:[o.jsxs("div",{className:"benefit",children:[o.jsx("div",{className:"benefit-metric",children:"10x"}),o.jsx("div",{className:"benefit-label",children:"Faster Design"}),o.jsx("p",{children:"What took hours now takes minutes with AI and templates."})]}),o.jsxs("div",{className:"benefit",children:[o.jsx("div",{className:"benefit-metric",children:"100%"}),o.jsx("div",{className:"benefit-label",children:"Production Accurate"}),o.jsxs("p",{children:["Exact Rosehill TPV",o.jsx("sup",{children:""})," granule specs with precise specifications."]})]}),o.jsxs("div",{className:"benefit",children:[o.jsx("div",{className:"benefit-metric infinite-symbol",children:""}),o.jsx("div",{className:"benefit-label",children:"Combinations"}),o.jsx("p",{children:"Mix courts, tracks, and artwork in unlimited configurations."})]}),o.jsxs("div",{className:"benefit",children:[o.jsx("div",{className:"benefit-metric",children:"21"}),o.jsx("div",{className:"benefit-label",children:"Standard Colours"}),o.jsxs("p",{children:["Complete Rosehill TPV",o.jsx("sup",{children:""})," standard colour palette."]})]})]})}),o.jsx("footer",{className:"landing-footer",children:o.jsxs("div",{className:"footer-content",children:[o.jsxs("div",{className:"footer-brand",children:[o.jsxs("span",{className:"footer-logo",children:["Rosehill TPV",o.jsx("sup",{children:""})," Studio"]}),o.jsx("span",{className:"footer-tagline",children:"A web app by Rosehill Sports & Play"}),o.jsx("span",{className:"footer-division",children:"A Division of Rosehill Group"})]}),o.jsxs("div",{className:"footer-links",children:[o.jsx("a",{href:"https://rosehilltpv.com",target:"_blank",rel:"noopener noreferrer",children:"rosehilltpv.com"}),o.jsx("a",{href:"mailto:info@rosehill.group",children:"info@rosehill.group"})]})]})}),o.jsx("section",{className:"cta-footer",children:o.jsxs("div",{className:"cta-content",children:[o.jsx("h2",{children:"Ready to Design Your Surface?"}),o.jsxs("p",{children:["Create playgrounds or sports facilities with production-ready Rosehill TPV",o.jsx("sup",{children:""})," specifications."]}),o.jsxs("button",{onClick:()=>d(!0),className:"cta-primary large",children:["Sign In to Rosehill TPV",o.jsx("sup",{children:""})," Studio",o.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M5 12h14M12 5l7 7-7 7"})})]}),o.jsxs("p",{className:"cta-note",children:["Need an account? Contact ",o.jsx("a",{href:"mailto:info@rosehill.group",children:"info@rosehill.group"})]})]})}),c&&o.jsx("div",{className:"modal-overlay",onClick:()=>d(!1),children:o.jsxs("div",{className:"sign-in-modal",onClick:m=>m.stopPropagation(),children:[o.jsx("button",{className:"modal-close",onClick:()=>d(!1),children:o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:o.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})}),o.jsxs("div",{className:"modal-header",children:[o.jsx("h2",{children:"Sign In"}),o.jsxs("p",{children:["Access your Rosehill TPV",o.jsx("sup",{children:""})," Studio account"]})]}),s&&o.jsx("div",{className:"form-error",children:s}),o.jsxs("form",{onSubmit:p,children:[o.jsxs("div",{className:"form-group",children:[o.jsx("label",{children:"Email"}),o.jsx("input",{type:"email",value:t,onChange:m=>e(m.target.value),placeholder:"your.email@company.com",required:!0})]}),o.jsxs("div",{className:"form-group",children:[o.jsx("label",{children:"Password"}),o.jsx("input",{type:"password",value:n,onChange:m=>r(m.target.value),required:!0})]}),o.jsx("button",{type:"submit",disabled:a,className:"submit-btn",children:a?"Signing in...":"Sign In"})]}),o.jsx("p",{className:"modal-footer-text",children:"Don't have an account? Contact your administrator."})]})}),o.jsx("style",{jsx:!0,children:`
        /* ============================================
           TPV STUDIO LANDING PAGE
           Aesthetic: Sophisticated Industrial-Creative
           ============================================ */

        @import url('https://fonts.googleapis.com/css2?family=Overpass:wght@300;400;500;600;700&family=Source+Sans+Pro:wght@300;400;600;700&display=swap');

        .landing-page {
          --primary: #1a365d;
          --primary-light: #2a4a73;
          --accent: #ff6b35;
          --accent-hover: #e55a2a;
          --text: #1a202c;
          --text-secondary: #64748b;
          --text-light: #94a3b8;
          --bg: #fafbfc;
          --bg-dark: #0f172a;
          --card: #ffffff;
          --border: #e2e8f0;

          font-family: 'Source Sans Pro', sans-serif;
          background: var(--bg);
          color: var(--text);
          overflow-x: hidden;
        }

        /* Navigation */
        .landing-nav {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          z-index: 1000;
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 1rem 3rem;
          background: rgba(255, 255, 255, 0.9);
          backdrop-filter: blur(12px);
          border-bottom: 1px solid var(--border);
        }

        .nav-logo {
          font-family: 'Overpass', sans-serif;
          font-size: 1.5rem;
          font-weight: 700;
        }

        .logo-text {
          color: var(--primary);
        }

        .logo-accent {
          color: var(--accent);
        }

        .nav-links {
          display: flex;
          align-items: center;
          gap: 2rem;
        }

        .nav-links button {
          background: none;
          border: none;
          font-family: inherit;
          font-size: 0.875rem;
          font-weight: 500;
          color: var(--text-secondary);
          cursor: pointer;
          transition: color 0.2s;
        }

        .nav-links button:hover {
          color: var(--text);
        }

        .nav-cta {
          background: var(--primary) !important;
          color: white !important;
          padding: 0.5rem 1.25rem !important;
          border-radius: 6px !important;
        }

        .nav-cta:hover {
          background: var(--primary-light) !important;
        }

        .logo-main {
          display: flex;
          align-items: baseline;
          gap: 0.25rem;
        }

        .logo-byline {
          display: block;
          font-size: 0.625rem;
          font-weight: 400;
          color: var(--text-light);
          margin-top: 2px;
          letter-spacing: 0.02em;
        }

        .landing-page sup {
          font-size: 0.6em;
          vertical-align: super;
          line-height: 0;
        }

        /* Hero Section */
        .hero {
          min-height: 100vh;
          display: grid;
          grid-template-columns: 1fr 1fr;
          align-items: center;
          padding: 8rem 4rem 4rem;
          position: relative;
          overflow: hidden;
        }

        .hero-background {
          position: absolute;
          inset: 0;
          pointer-events: none;
        }

        .granule-field {
          position: absolute;
          inset: 0;
        }

        .granule {
          position: absolute;
          left: var(--x);
          top: var(--y);
          width: var(--size);
          height: var(--size);
          background: var(--color);
          border-radius: 50%;
          opacity: 0.15;
          animation: float 8s ease-in-out infinite;
          animation-delay: var(--delay);
        }

        @keyframes float {
          0%, 100% { transform: translateY(0) scale(1); }
          50% { transform: translateY(-20px) scale(1.1); }
        }

        .hero-content {
          position: relative;
          z-index: 10;
        }

        .hero-badge {
          display: inline-block;
          padding: 0.5rem 1rem;
          background: rgba(30, 74, 122, 0.1);
          color: var(--primary);
          font-size: 0.75rem;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.1em;
          border-radius: 50px;
          margin-bottom: 1.5rem;
        }

        .hero h1 {
          font-family: 'Overpass', sans-serif;
          font-size: 3.5rem;
          font-weight: 700;
          line-height: 1.1;
          margin: 0 0 1.5rem;
        }

        .hero-line-1 {
          display: block;
          color: var(--text-secondary);
        }

        .hero-line-2 {
          display: block;
          color: var(--primary);
        }

        .hero-subtitle {
          font-size: 1.125rem;
          color: var(--text-secondary);
          line-height: 1.7;
          max-width: 480px;
          margin-bottom: 2rem;
        }

        .hero-ctas {
          display: flex;
          gap: 1rem;
        }

        .cta-primary {
          display: inline-flex;
          align-items: center;
          gap: 0.5rem;
          padding: 0.875rem 1.5rem;
          background: var(--accent);
          color: white;
          border: none;
          border-radius: 8px;
          font-family: inherit;
          font-size: 0.9375rem;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.2s;
        }

        .cta-primary:hover {
          background: var(--accent-hover);
          transform: translateY(-2px);
          box-shadow: 0 8px 24px rgba(255, 107, 53, 0.3);
        }

        .cta-primary.large {
          padding: 1rem 2rem;
          font-size: 1rem;
        }

        .cta-secondary {
          padding: 0.875rem 1.5rem;
          background: white;
          color: var(--text);
          border: 2px solid var(--border);
          border-radius: 8px;
          font-family: inherit;
          font-size: 0.9375rem;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.2s;
        }

        .cta-secondary:hover {
          border-color: var(--primary);
          color: var(--primary);
        }

        /* Hero Visual / Mockup */
        .hero-visual {
          position: relative;
          z-index: 10;
          display: flex;
          justify-content: center;
        }

        .mockup-container {
          perspective: 1000px;
        }

        .mockup-screen {
          width: 400px;
          background: white;
          border-radius: 12px;
          box-shadow: 0 24px 80px rgba(0, 0, 0, 0.15);
          overflow: hidden;
          transform: rotateY(-5deg) rotateX(2deg);
          animation: mockupFloat 6s ease-in-out infinite;
        }

        @keyframes mockupFloat {
          0%, 100% { transform: rotateY(-5deg) rotateX(2deg) translateY(0); }
          50% { transform: rotateY(-5deg) rotateX(2deg) translateY(-10px); }
        }

        .mockup-header {
          padding: 0.75rem 1rem;
          background: #f8f8f8;
          border-bottom: 1px solid #eee;
        }

        .mockup-dots {
          display: flex;
          gap: 6px;
        }

        .mockup-dots span {
          width: 10px;
          height: 10px;
          border-radius: 50%;
          background: #ddd;
        }

        .mockup-dots span:nth-child(1) { background: #ff5f56; }
        .mockup-dots span:nth-child(2) { background: #ffbd2e; }
        .mockup-dots span:nth-child(3) { background: #27ca41; }

        .mockup-content {
          padding: 1.5rem;
        }

        .mockup-input {
          background: #f5f5f5;
          padding: 1rem;
          border-radius: 8px;
          font-size: 0.875rem;
          color: var(--text-secondary);
          margin-bottom: 1.5rem;
          display: flex;
          align-items: center;
        }

        .typing-text {
          display: inline-block;
          overflow: hidden;
          white-space: nowrap;
          border-right: 2px solid var(--primary);
          animation: typing 5s steps(40, end) forwards, blink 0.7s step-end infinite;
        }

        @keyframes typing {
          0% { max-width: 0; }
          35% { max-width: 500px; }
          65% { max-width: 500px; }
          100% { max-width: 0; }
        }

        @keyframes blink {
          50% { border-color: transparent; }
        }

        .mockup-preview {
          height: 180px;
          background: linear-gradient(135deg, #e8f4f8, #f0f4ff);
          border-radius: 8px;
          position: relative;
          overflow: hidden;
        }

        .preview-shape {
          position: absolute;
          border-radius: 50%;
          animation: shapeReveal 4s ease-out infinite;
        }

        .shape-1 {
          width: 80px;
          height: 80px;
          background: var(--accent);
          opacity: 0.8;
          top: 20%;
          left: 15%;
          animation-delay: 0s;
        }

        .shape-2 {
          width: 60px;
          height: 60px;
          background: #30D5C8;
          opacity: 0.8;
          top: 40%;
          left: 50%;
          animation-delay: 0.3s;
        }

        .shape-3 {
          width: 100px;
          height: 100px;
          background: var(--primary);
          opacity: 0.8;
          top: 50%;
          right: 10%;
          animation-delay: 0.6s;
        }

        @keyframes shapeReveal {
          0%, 100% { transform: scale(0.8); opacity: 0.4; }
          50% { transform: scale(1); opacity: 0.8; }
        }

        /* Section Headers */
        .section-header {
          text-align: center;
          margin-bottom: 4rem;
        }

        .section-header.light h2,
        .section-header.light .section-subtitle {
          color: white;
        }

        .section-header.light .section-tag {
          background: rgba(255, 255, 255, 0.1);
          color: rgba(255, 255, 255, 0.9);
        }

        .section-tag {
          display: inline-block;
          padding: 0.375rem 0.875rem;
          background: rgba(30, 74, 122, 0.1);
          color: var(--primary);
          font-size: 0.6875rem;
          font-weight: 600;
          text-transform: uppercase;
          letter-spacing: 0.15em;
          border-radius: 50px;
          margin-bottom: 1rem;
        }

        .section-header h2 {
          font-family: 'Overpass', sans-serif;
          font-size: 2.5rem;
          font-weight: 700;
          color: var(--text);
          margin: 0;
        }

        .section-subtitle {
          margin-top: 1rem;
          font-size: 1.125rem;
          color: var(--text-secondary);
        }

        /* How It Works */
        .how-it-works {
          padding: 6rem 4rem;
          background: white;
        }

        .steps-container {
          display: flex;
          align-items: flex-start;
          justify-content: center;
          gap: 1rem;
        }

        .step {
          flex: 1;
          max-width: 280px;
          text-align: center;
          padding: 2rem 1.5rem;
        }

        .step-number {
          font-family: 'Overpass', sans-serif;
          font-size: 3rem;
          font-weight: 700;
          color: rgba(30, 74, 122, 0.1);
          margin-bottom: 1rem;
        }

        .step-icon {
          width: 64px;
          height: 64px;
          margin: 0 auto 1.5rem;
          display: flex;
          align-items: center;
          justify-content: center;
          background: rgba(255, 107, 53, 0.1);
          border-radius: 16px;
          color: var(--accent);
        }

        .step h3 {
          font-family: 'Overpass', sans-serif;
          font-size: 1.25rem;
          font-weight: 600;
          margin: 0 0 0.75rem;
          color: var(--text);
        }

        .step p {
          font-size: 0.9375rem;
          color: var(--text-secondary);
          line-height: 1.6;
          margin: 0;
        }

        .step-connector {
          width: 100px;
          padding-top: 5rem;
          color: var(--border);
        }

        /* Features */
        .features {
          padding: 6rem 4rem;
          background: var(--bg);
        }

        .features-grid {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 1.5rem;
          max-width: 1200px;
          margin: 0 auto;
        }

        .feature-card {
          background: white;
          padding: 2rem;
          border-radius: 12px;
          border: 1px solid var(--border);
          transition: all 0.3s;
        }

        .feature-card:hover {
          transform: translateY(-4px);
          box-shadow: 0 12px 40px rgba(0, 0, 0, 0.08);
        }

        .feature-highlight {
          grid-column: span 2;
          background: linear-gradient(135deg, var(--primary), var(--primary-light));
          color: white;
          border: none;
        }

        .feature-highlight .feature-icon {
          background: rgba(255, 255, 255, 0.2);
          color: white;
        }

        .feature-highlight h3 {
          color: white;
        }

        .feature-highlight p {
          color: rgba(255, 255, 255, 0.9);
        }

        .feature-icon {
          width: 56px;
          height: 56px;
          display: flex;
          align-items: center;
          justify-content: center;
          background: rgba(30, 74, 122, 0.1);
          border-radius: 12px;
          color: var(--primary);
          margin-bottom: 1.25rem;
        }

        .feature-card h3 {
          font-family: 'Overpass', sans-serif;
          font-size: 1.125rem;
          font-weight: 600;
          margin: 0 0 0.5rem;
        }

        .feature-card p {
          font-size: 0.875rem;
          color: var(--text-secondary);
          line-height: 1.6;
          margin: 0;
        }

        .feature-example {
          margin-top: 1.5rem;
          padding: 0.875rem 1rem;
          background: rgba(255, 255, 255, 0.1);
          border-radius: 8px;
          font-size: 0.8125rem;
          font-style: italic;
          opacity: 0.9;
        }

        /* Unified Showcase Section */
        .unified-showcase {
          padding: 6rem 4rem;
          background: white;
        }

        .showcase-container {
          max-width: 900px;
          margin: 0 auto;
        }

        .showcase-card {
          background: linear-gradient(135deg, #f8fafc, #f1f5f9);
          border-radius: 24px;
          padding: 3rem;
          border: 1px solid var(--border);
          text-align: center;
        }

        .showcase-canvas {
          position: relative;
          height: 280px;
          margin-bottom: 2rem;
        }

        .canvas-preview {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 240px;
          height: 160px;
          background: white;
          border-radius: 12px;
          border: 2px solid var(--border);
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
          overflow: hidden;
        }

        .canvas-grid {
          position: absolute;
          inset: 0;
          background-image:
            linear-gradient(rgba(30, 74, 122, 0.05) 1px, transparent 1px),
            linear-gradient(90deg, rgba(30, 74, 122, 0.05) 1px, transparent 1px);
          background-size: 20px 20px;
        }

        .canvas-surface {
          position: absolute;
          inset: 10px;
          background: #e8f4f8;
          border-radius: 4px;
        }

        .surface-court {
          position: absolute;
          top: 20%;
          left: 15%;
          width: 70%;
          height: 60%;
          border: 2px solid #00a6a3;
          border-radius: 4px;
          opacity: 0.8;
        }

        .surface-court::before {
          content: '';
          position: absolute;
          top: 50%;
          left: 0;
          right: 0;
          height: 2px;
          background: #00a6a3;
        }

        .surface-court::after {
          content: '';
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 20px;
          height: 20px;
          border: 2px solid #00a6a3;
          border-radius: 50%;
        }

        .surface-motif {
          position: absolute;
          bottom: 10%;
          right: 10%;
          width: 35px;
          height: 35px;
          background: var(--accent);
          border-radius: 50%;
          opacity: 0.8;
          animation: motifPulse 3s ease-in-out infinite;
        }

        @keyframes motifPulse {
          0%, 100% { transform: scale(1); opacity: 0.8; }
          50% { transform: scale(1.1); opacity: 1; }
        }

        .capability-pill {
          position: absolute;
          display: flex;
          align-items: center;
          gap: 0.5rem;
          padding: 0.625rem 1rem;
          background: white;
          border-radius: 50px;
          box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
          font-size: 0.8125rem;
          font-weight: 500;
          color: var(--text);
          animation: pillFloat 4s ease-in-out infinite;
        }

        .pill-courts {
          top: 10%;
          left: 5%;
          animation-delay: 0s;
        }

        .pill-courts svg {
          color: #00a6a3;
        }

        .pill-ai {
          top: 5%;
          right: 10%;
          animation-delay: 0.5s;
        }

        .pill-ai svg {
          color: var(--accent);
        }

        .pill-upload {
          bottom: 15%;
          left: 8%;
          animation-delay: 1s;
        }

        .pill-upload svg {
          color: var(--primary);
        }

        .pill-layers {
          bottom: 10%;
          right: 5%;
          animation-delay: 1.5s;
        }

        .pill-layers svg {
          color: #30D5C8;
        }

        @keyframes pillFloat {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-8px); }
        }

        .showcase-tagline {
          font-family: 'Overpass', sans-serif;
          font-size: 1.5rem;
          font-weight: 600;
          color: var(--text);
          margin-bottom: 2rem;
        }

        .showcase-features {
          display: flex;
          justify-content: center;
          gap: 2rem;
          flex-wrap: wrap;
          margin-bottom: 2rem;
        }

        .showcase-feature {
          display: flex;
          align-items: center;
          gap: 0.625rem;
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        .feature-badge {
          padding: 0.25rem 0.625rem;
          border-radius: 50px;
          font-size: 0.625rem;
          font-weight: 700;
          letter-spacing: 0.05em;
        }

        .ai-badge {
          background: rgba(255, 107, 53, 0.1);
          color: var(--accent);
        }

        .template-badge {
          background: rgba(0, 166, 163, 0.1);
          color: #00a6a3;
        }

        .compose-badge {
          background: rgba(30, 74, 122, 0.1);
          color: var(--primary);
        }

        .showcase-cta {
          margin: 0 auto;
        }

        /* Unified Features Grid */
        .unified-features {
          grid-template-columns: repeat(3, 1fr);
        }

        /* Infinite symbol styling */
        .infinite-symbol {
          font-size: 3.5rem;
          line-height: 1;
        }

        /* Benefits Grid 4 columns */
        .benefits-grid-4 {
          grid-template-columns: repeat(4, 1fr);
        }

        /* Palette Section */
        .palette-section {
          padding: 6rem 4rem;
          background: var(--bg-dark);
        }

        .palette-grid {
          display: grid;
          grid-template-columns: repeat(7, 1fr);
          gap: 1rem;
          max-width: 1000px;
          margin: 0 auto;
        }

        .palette-swatch {
          animation: swatchReveal 0.5s ease-out forwards;
          animation-delay: var(--delay);
          opacity: 0;
          transform: translateY(20px);
        }

        @keyframes swatchReveal {
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .swatch-color {
          aspect-ratio: 1;
          background: var(--swatch-color);
          border-radius: 8px;
          margin-bottom: 0.5rem;
          transition: transform 0.2s;
        }

        .palette-swatch:hover .swatch-color {
          transform: scale(1.1);
        }

        .swatch-info {
          text-align: center;
        }

        .swatch-name {
          display: block;
          font-size: 0.6875rem;
          font-weight: 500;
          color: white;
        }

        .swatch-code {
          display: block;
          font-size: 0.625rem;
          color: rgba(255, 255, 255, 0.5);
        }

        /* Benefits */
        .benefits {
          padding: 6rem 4rem;
          background: white;
        }

        .benefits-grid {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 3rem;
          max-width: 1000px;
          margin: 0 auto;
          text-align: center;
        }

        .benefit-metric {
          font-family: 'Overpass', sans-serif;
          font-size: 4rem;
          font-weight: 700;
          color: var(--accent);
          line-height: 1;
        }

        .benefit-label {
          font-family: 'Overpass', sans-serif;
          font-size: 1.125rem;
          font-weight: 600;
          color: var(--text);
          margin: 0.5rem 0 1rem;
        }

        .benefit p {
          font-size: 0.875rem;
          color: var(--text-secondary);
          line-height: 1.6;
          margin: 0;
        }

        /* Company Footer */
        .landing-footer {
          padding: 3rem 4rem;
          background: var(--bg-dark);
          border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-content {
          max-width: 1200px;
          margin: 0 auto;
          display: flex;
          justify-content: space-between;
          align-items: center;
          flex-wrap: wrap;
          gap: 2rem;
        }

        .footer-brand {
          display: flex;
          flex-direction: column;
          gap: 0.25rem;
        }

        .footer-logo {
          font-family: 'Overpass', sans-serif;
          font-size: 1.25rem;
          font-weight: 600;
          color: white;
        }

        .footer-tagline {
          font-size: 0.875rem;
          color: rgba(255, 255, 255, 0.8);
        }

        .footer-division {
          font-size: 0.75rem;
          color: rgba(255, 255, 255, 0.5);
        }

        .footer-links {
          display: flex;
          gap: 2rem;
        }

        .footer-links a {
          font-size: 0.875rem;
          color: rgba(255, 255, 255, 0.7);
          text-decoration: none;
          transition: color 0.2s;
        }

        .footer-links a:hover {
          color: var(--accent);
        }

        /* CTA Footer */
        .cta-footer {
          padding: 6rem 4rem;
          background: var(--bg);
          text-align: center;
        }

        .cta-content h2 {
          font-family: 'Overpass', sans-serif;
          font-size: 2.5rem;
          font-weight: 700;
          color: var(--text);
          margin: 0 0 1rem;
        }

        .cta-content > p {
          font-size: 1.125rem;
          color: var(--text-secondary);
          margin-bottom: 2rem;
        }

        .cta-note {
          margin-top: 1.5rem;
          font-size: 0.875rem;
          color: var(--text-light);
        }

        .cta-note a {
          color: var(--primary);
          text-decoration: none;
        }

        .cta-note a:hover {
          text-decoration: underline;
        }

        /* Modal */
        .modal-overlay {
          position: fixed;
          inset: 0;
          background: rgba(0, 0, 0, 0.5);
          backdrop-filter: blur(4px);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 2000;
          padding: 2rem;
        }

        .sign-in-modal {
          background: white;
          border-radius: 16px;
          padding: 2.5rem;
          width: 100%;
          max-width: 400px;
          position: relative;
          animation: modalSlide 0.3s ease-out;
        }

        @keyframes modalSlide {
          from {
            opacity: 0;
            transform: translateY(-20px);
          }
        }

        .modal-close {
          position: absolute;
          top: 1rem;
          right: 1rem;
          width: 32px;
          height: 32px;
          display: flex;
          align-items: center;
          justify-content: center;
          background: none;
          border: none;
          color: var(--text-light);
          cursor: pointer;
          border-radius: 6px;
          transition: all 0.2s;
        }

        .modal-close:hover {
          background: var(--bg);
          color: var(--text);
        }

        .modal-header {
          text-align: center;
          margin-bottom: 1.5rem;
        }

        .modal-header h2 {
          font-family: 'Overpass', sans-serif;
          font-size: 1.5rem;
          font-weight: 600;
          margin: 0 0 0.25rem;
        }

        .modal-header p {
          font-size: 0.875rem;
          color: var(--text-secondary);
          margin: 0;
        }

        .form-error {
          padding: 0.75rem 1rem;
          background: #fef2f2;
          color: #dc2626;
          border-radius: 8px;
          font-size: 0.875rem;
          margin-bottom: 1rem;
        }

        .form-group {
          margin-bottom: 1rem;
        }

        .form-group label {
          display: block;
          font-size: 0.875rem;
          font-weight: 500;
          margin-bottom: 0.5rem;
        }

        .form-group input {
          width: 100%;
          padding: 0.75rem 1rem;
          border: 1px solid var(--border);
          border-radius: 8px;
          font-family: inherit;
          font-size: 0.9375rem;
          transition: all 0.2s;
        }

        .form-group input:focus {
          outline: none;
          border-color: var(--primary);
          box-shadow: 0 0 0 3px rgba(30, 74, 122, 0.1);
        }

        .submit-btn {
          width: 100%;
          padding: 0.875rem;
          background: var(--accent);
          color: white;
          border: none;
          border-radius: 8px;
          font-family: inherit;
          font-size: 0.9375rem;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.2s;
        }

        .submit-btn:hover:not(:disabled) {
          background: var(--accent-hover);
        }

        .submit-btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }

        .modal-footer-text {
          text-align: center;
          font-size: 0.8125rem;
          color: var(--text-light);
          margin: 1.5rem 0 0;
        }

        /* Responsive */
        @media (max-width: 1024px) {
          .hero {
            grid-template-columns: 1fr;
            text-align: center;
          }

          .hero-content {
            max-width: 600px;
            margin: 0 auto;
          }

          .hero-subtitle {
            margin-left: auto;
            margin-right: auto;
          }

          .hero-ctas {
            justify-content: center;
          }

          .hero-visual {
            display: none;
          }

          .showcase-canvas {
            height: 240px;
          }

          .capability-pill {
            padding: 0.5rem 0.75rem;
            font-size: 0.75rem;
          }

          .features-grid {
            grid-template-columns: repeat(2, 1fr);
          }

          .unified-features {
            grid-template-columns: repeat(2, 1fr);
          }

          .feature-highlight {
            grid-column: span 2;
          }

          .benefits-grid-4 {
            grid-template-columns: repeat(2, 1fr);
          }

          .palette-grid {
            grid-template-columns: repeat(5, 1fr);
          }
        }

        @media (max-width: 768px) {
          .landing-nav {
            padding: 1rem 1.5rem;
          }

          .nav-links {
            gap: 1rem;
          }

          .hero {
            padding: 6rem 1.5rem 3rem;
          }

          .hero h1 {
            font-size: 2.5rem;
          }

          .steps-container {
            flex-direction: column;
            gap: 0;
          }

          .step-connector {
            display: none;
          }

          .features-grid,
          .unified-features {
            grid-template-columns: 1fr;
          }

          .feature-highlight {
            grid-column: span 1;
          }

          .section-header h2 {
            font-size: 2rem;
          }

          .how-it-works,
          .features,
          .palette-section,
          .benefits,
          .cta-footer,
          .unified-showcase,
          .landing-footer {
            padding: 4rem 1.5rem;
          }

          .footer-content {
            flex-direction: column;
            text-align: center;
          }

          .footer-links {
            flex-direction: column;
            gap: 1rem;
          }

          .logo-byline {
            display: none;
          }

          .showcase-card {
            padding: 2rem 1.5rem;
          }

          .showcase-canvas {
            height: 200px;
          }

          .canvas-preview {
            width: 180px;
            height: 120px;
          }

          .capability-pill {
            display: none;
          }

          .showcase-features {
            flex-direction: column;
            gap: 1rem;
          }

          .showcase-tagline {
            font-size: 1.25rem;
          }

          .benefits-grid,
          .benefits-grid-4 {
            grid-template-columns: 1fr;
            gap: 2rem;
          }

          .palette-grid {
            grid-template-columns: repeat(4, 1fr);
          }
        }

        @media (max-width: 480px) {
          .nav-links button:not(.nav-cta) {
            display: none;
          }

          .hero h1 {
            font-size: 2rem;
          }

          .cta-content h2 {
            font-size: 1.75rem;
          }

          .palette-grid {
            grid-template-columns: repeat(3, 1fr);
          }
        }
      `})]})}function bG({user:t,onPasswordSet:e}){const[n,r]=O.useState(""),[s,i]=O.useState(""),[a,l]=O.useState(!1),[c,d]=O.useState(""),u=async h=>{if(h.preventDefault(),d(""),n.length<8){d("Password must be at least 8 characters long");return}if(!/[A-Z]/.test(n)){d("Password must contain at least one uppercase letter");return}if(!/[a-z]/.test(n)){d("Password must contain at least one lowercase letter");return}if(!/[0-9]/.test(n)){d("Password must contain at least one number");return}if(n!==s){d("Passwords do not match");return}l(!0);try{await Kr.updatePassword(n),e()}catch(p){d(p.message||"Failed to set password. Please try again.")}finally{l(!1)}};return o.jsx("div",{className:"tpv-studio",children:o.jsx("div",{className:"tpv-studio__container",style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100vh"},children:o.jsxs("div",{style:{maxWidth:"400px",width:"100%",padding:"2rem",background:"#fff",borderRadius:"8px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[o.jsx("h2",{style:{marginBottom:"0.5rem",fontSize:"1.5rem"},children:"Welcome to TPV Studio"}),o.jsxs("p",{style:{marginBottom:"1.5rem",color:"#666",fontSize:"0.9rem"},children:["Please set a password for your account: ",o.jsx("strong",{children:t.email})]}),o.jsxs("form",{onSubmit:u,children:[o.jsxs("div",{style:{marginBottom:"1rem"},children:[o.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",fontWeight:"500"},children:"New Password"}),o.jsx("input",{type:"password",value:n,onChange:h=>r(h.target.value),placeholder:"Enter your password",required:!0,minLength:8,style:{width:"100%",padding:"0.75rem",border:"1px solid #ddd",borderRadius:"4px",fontSize:"1rem"}}),o.jsx("small",{style:{display:"block",marginTop:"0.25rem",color:"#666"},children:"At least 8 characters with uppercase, lowercase, and a number"})]}),o.jsxs("div",{style:{marginBottom:"1.5rem"},children:[o.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",fontWeight:"500"},children:"Confirm Password"}),o.jsx("input",{type:"password",value:s,onChange:h=>i(h.target.value),placeholder:"Confirm your password",required:!0,minLength:8,style:{width:"100%",padding:"0.75rem",border:"1px solid #ddd",borderRadius:"4px",fontSize:"1rem"}})]}),c&&o.jsx("div",{style:{padding:"0.75rem",marginBottom:"1rem",background:"#fee",border:"1px solid #fcc",borderRadius:"4px",color:"#c00",fontSize:"0.9rem"},children:c}),o.jsx("button",{type:"submit",disabled:a,style:{width:"100%",padding:"0.75rem",background:a?"#ccc":"#007bff",color:"#fff",border:"none",borderRadius:"4px",fontSize:"1rem",fontWeight:"500",cursor:a?"not-allowed":"pointer"},children:a?"Setting Password...":"Set Password"})]})]})})})}function wG(){const[t,e]=O.useState(null),[n,r]=O.useState(!0),[s,i]=O.useState(!1),[a,l]=O.useState(!1),[c,d]=O.useState(!1),[u,h]=O.useState(!1),[p,f]=O.useState(null),[m,y]=O.useState(null),v=async()=>{try{const b=await Kr.getSession();if(!(b!=null&&b.access_token)){d(!1);return}const k=await fetch("/api/admin/users",{headers:{Authorization:`Bearer ${b.access_token}`}});d(k.ok)}catch{console.error("[APP] Admin check failed"),d(!1)}},x=async b=>{try{console.log("[APP] Loading design from URL:",b);const{design:k}=await Hl(b);if(k){g(k);const _=new URL(window.location);_.searchParams.delete("design"),window.history.replaceState({},"",_)}}catch(k){console.error("[APP] Failed to load design from URL:",k)}};O.useEffect(()=>{Kr.getSession().then(k=>{var S;const _=(k==null?void 0:k.user)||null;if(e(_),r(!1),_){const E=(S=_.user_metadata)==null?void 0:S.password_setup_complete;h(!E),v();const R=new URLSearchParams(window.location.search).get("design");R&&x(R)}});const{data:b}=Kr.onAuthStateChange((k,_)=>{var E;const S=(_==null?void 0:_.user)||null;if(e(S),S){const T=(E=S.user_metadata)==null?void 0:E.password_setup_complete;h(!T),v()}else d(!1),h(!1)});return()=>b==null?void 0:b.unsubscribe()},[]);const g=b=>{f(b),y(b.name)},w=async()=>{h(!1);const b=await Kr.getSession();e((b==null?void 0:b.user)||null)};return n?o.jsx("div",{className:"tpv-studio",children:o.jsx("div",{className:"tpv-studio__container",children:o.jsxs("div",{className:"tpv-studio__empty",children:[o.jsx("div",{className:"tpv-studio__spinner"}),o.jsx("p",{children:"Loading..."})]})})}):t?u?o.jsx(bG,{user:t,onPasswordSet:w}):a?o.jsx("div",{className:"tpv-studio",children:o.jsx(hG,{onClose:()=>l(!1)})}):o.jsx(qE,{children:o.jsxs("div",{className:"tpv-studio",children:[o.jsx(aG,{onShowDesigns:()=>i(!0),onShowAdmin:()=>l(!0),isAdmin:c,currentDesignName:m}),o.jsx("main",{className:"tpv-studio__container tpv-studio__container--full",children:o.jsx(oG,{loadedDesign:p})}),s&&o.jsx(cG,{onClose:()=>i(!1),onLoadDesign:g})]})}):o.jsx(vG,{})}Eh.createRoot(document.getElementById("root")).render(o.jsx(D.StrictMode,{children:o.jsx(wG,{})}))});export default _G();
//# sourceMappingURL=index-D0iiBOLI.js.map
