<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Installations - Rosehill TPV Admin (Sanity)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #f8fafc;
            color: #1e293b;
            line-height: 1.6;
        }

        .admin-header {
            background: linear-gradient(135deg, #1a365d, #2d4a71);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .admin-header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .admin-header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .admin-nav {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-button {
            padding: 10px 20px;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            text-decoration: none;
            color: #64748b;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .nav-button:hover {
            border-color: #ff6b35;
            color: #ff6b35;
        }

        .nav-button.active {
            background: #ff6b35;
            border-color: #ff6b35;
            color: white;
        }

        /* Filters Section */
        .filters-section {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
            margin-bottom: 30px;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            align-items: end;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 8px;
        }

        .filter-input {
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .filter-input:focus {
            outline: none;
            border-color: #ff6b35;
        }

        .filter-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: #ff6b35;
            color: white;
        }

        .btn-primary:hover {
            background: #e55a2b;
        }

        .btn-secondary {
            background: #f8fafc;
            color: #64748b;
            border: 1px solid #e2e8f0;
        }

        .btn-secondary:hover {
            background: #f1f5f9;
        }

        .btn-sm {
            padding: 6px 10px;
            font-size: 12px;
        }

        /* Statistics Cards */
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #ff6b35;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #64748b;
        }

        /* Table Section */
        .table-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
            overflow: hidden;
        }

        .table-header {
            padding: 20px 25px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h3 {
            font-size: 18px;
            font-weight: 600;
            color: #1a365d;
        }

        .table-container {
            overflow-x: auto;
        }

        .installations-table {
            width: 100%;
            border-collapse: collapse;
        }

        .installations-table th {
            background: #f8fafc;
            padding: 15px 20px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: #374151;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
            border-bottom: 1px solid #e2e8f0;
        }

        .installations-table td {
            padding: 15px 20px;
            border-bottom: 1px solid #f1f5f9;
            vertical-align: middle;
        }

        .installations-table tr:hover {
            background: #fafbfc;
        }

        .installation-title {
            font-weight: 600;
            color: #1a365d;
            margin-bottom: 3px;
        }

        .installation-subtitle {
            font-size: 13px;
            color: #64748b;
        }

        .location-text {
            color: #374151;
            font-size: 14px;
        }

        .date-text {
            color: #64748b;
            font-size: 14px;
        }

        .application-badge {
            display: inline-block;
            padding: 4px 8px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-radius: 4px;
            white-space: nowrap;
        }

        .badge-playground { background: #dbeafe; color: #1e40af; }
        .badge-sports-court { background: #dcfce7; color: #166534; }
        .badge-fitness { background: #fef3c7; color: #92400e; }
        .badge-water-park { background: #e0f2fe; color: #0f4c75; }
        .badge-track-field { background: #f3e8ff; color: #7c2d12; }
        .badge-pool-surround { background: #fce7f3; color: #be185d; }

        .image-count {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #64748b;
            font-size: 14px;
        }

        .image-thumbnails {
            display: flex;
            gap: 4px;
        }

        .image-thumb {
            width: 32px;
            height: 24px;
            border-radius: 3px;
            object-fit: cover;
            border: 1px solid #e2e8f0;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-edit {
            background: #10b981;
            color: white;
        }

        .btn-edit:hover {
            background: #059669;
        }

        .btn-translate {
            background: #3b82f6;
            color: white;
        }

        .btn-translate:hover {
            background: #2563eb;
        }

        .btn-delete {
            background: #ef4444;
            color: white;
        }

        .btn-delete:hover {
            background: #dc2626;
        }

        /* Translation Status */
        .translation-status {
            display: flex;
            gap: 4px;
        }

        .translation-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-published { background: #10b981; }
        .status-machine-translated { background: #f59e0b; }
        .status-human-reviewed { background: #3b82f6; }
        .status-not-started { background: #d1d5db; }

        /* Loading State */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ff6b35;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #64748b;
        }

        .empty-state svg {
            width: 48px;
            height: 48px;
            color: #d1d5db;
            margin-bottom: 16px;
        }

        .empty-state h3 {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 8px;
            color: #374151;
        }

        .empty-state p {
            font-size: 14px;
            margin-bottom: 20px;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 20px;
            border-top: 1px solid #e2e8f0;
        }

        .pagination-btn {
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            background: white;
            color: #64748b;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .pagination-btn:hover:not(:disabled) {
            border-color: #ff6b35;
            color: #ff6b35;
        }

        .pagination-btn.active {
            background: #ff6b35;
            border-color: #ff6b35;
            color: white;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-info {
            font-size: 14px;
            color: #64748b;
            margin: 0 15px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .admin-container {
                padding: 20px 15px;
            }

            .filters-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .stats-section {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .installations-table {
                font-size: 13px;
            }

            .installations-table th,
            .installations-table td {
                padding: 10px 12px;
            }

            .action-buttons {
                flex-direction: column;
                gap: 4px;
            }

            .btn-sm {
                padding: 4px 8px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <header class="admin-header">
        <h1>Manage Installations</h1>
        <p>View, edit, and manage installation showcases using Sanity CMS</p>
    </header>

    <main class="admin-container">
        <!-- Navigation -->
        <nav class="admin-nav">
            <a href="add-installation.html" class="nav-button">Add Installation</a>
            <a href="manage-installations.html" class="nav-button active">Manage Installations</a>
            <a href="translations.html" class="nav-button">Translations</a>
            <a href="../../installations.html" class="nav-button" target="_blank">View Live</a>
        </nav>

        <!-- Statistics -->
        <section class="stats-section" id="stats-section">
            <div class="stat-card">
                <div class="stat-value" id="total-count">-</div>
                <div class="stat-label">Total Installations</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="published-count">-</div>
                <div class="stat-label">Published</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="recent-count">-</div>
                <div class="stat-label">This Month</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="translated-count">-</div>
                <div class="stat-label">Multi-Language</div>
            </div>
        </section>

        <!-- Filters -->
        <section class="filters-section">
            <div class="filters-grid">
                <div class="filter-group">
                    <label for="search">Search</label>
                    <input type="text" id="search" class="filter-input" placeholder="Title, location...">
                </div>
                <div class="filter-group">
                    <label for="application-filter">Application</label>
                    <select id="application-filter" class="filter-input">
                        <option value="">All Applications</option>
                        <option value="playground">Playground</option>
                        <option value="sports-court">Sports Court</option>
                        <option value="fitness">Fitness Area</option>
                        <option value="water-park">Water Park</option>
                        <option value="track-field">Track & Field</option>
                        <option value="pool-surround">Pool Surround</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="sort-by">Sort By</label>
                    <select id="sort-by" class="filter-input">
                        <option value="date-desc">Newest First</option>
                        <option value="date-asc">Oldest First</option>
                        <option value="title-asc">Title A-Z</option>
                        <option value="title-desc">Title Z-A</option>
                        <option value="location-asc">Location A-Z</option>
                    </select>
                </div>
                <div class="filter-actions">
                    <button type="button" id="apply-filters" class="btn btn-primary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" />
                        </svg>
                        Search
                    </button>
                    <button type="button" id="clear-filters" class="btn btn-secondary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" />
                        </svg>
                        Clear
                    </button>
                </div>
            </div>
        </section>

        <!-- Installations Table -->
        <section class="table-section">
            <div class="table-header">
                <h3>Installations</h3>
                <a href="add-installation.html" class="btn btn-primary">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" />
                    </svg>
                    Add New
                </a>
            </div>

            <div class="table-container">
                <table class="installations-table" id="installations-table">
                    <thead>
                        <tr>
                            <th>Installation</th>
                            <th>Location</th>
                            <th>Date</th>
                            <th>Application</th>
                            <th>Images</th>
                            <th>Languages</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="installations-tbody">
                        <!-- Table rows will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="pagination" id="pagination">
                <button class="pagination-btn" id="prev-btn" disabled>Previous</button>
                <span class="pagination-info" id="page-info">Page 1 of 1</span>
                <button class="pagination-btn" id="next-btn" disabled>Next</button>
            </div>
        </section>
    </main>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <!-- Scripts -->
    <script src="js/sanity-client.js"></script>
    <script>
        // Global variables
        let currentPage = 1;
        let itemsPerPage = 20;
        let totalInstallations = 0;
        let installations = [];
        let filters = {
            search: '',
            application: '',
            sortBy: 'date-desc'
        };

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', async function() {
            await checkAndSetupAuth();
            await loadStatistics();
            await loadInstallations();
            setupEventListeners();
        });

        // Check for authentication
        async function checkAndSetupAuth() {
            let token = localStorage.getItem('sanity_token');
            
            if (!token) {
                token = prompt('Please enter your Sanity API token:');
                if (!token) {
                    alert('API token is required to use the admin interface.');
                    return;
                }
                localStorage.setItem('sanity_token', token);
            }

            sanityClient.setToken(token);

            // Test the token
            try {
                await sanityClient.query('*[_type == "installation"][0]._id');
            } catch (error) {
                localStorage.removeItem('sanity_token');
                alert('Invalid API token. Please refresh and try again.');
                throw error;
            }
        }

        // Load statistics
        async function loadStatistics() {
            try {
                const stats = await sanityClient.getStatistics();
                
                document.getElementById('total-count').textContent = stats.total || 0;
                document.getElementById('published-count').textContent = stats.translationStats?.english || 0;
                document.getElementById('translated-count').textContent = 
                    (stats.translationStats?.french || 0) + 
                    (stats.translationStats?.german || 0) + 
                    (stats.translationStats?.spanish || 0);

                // Calculate recent count (installations this month)
                const currentMonth = new Date().toISOString().substring(0, 7);
                const recentCount = stats.recentInstallations?.filter(inst => 
                    inst.installationDate?.startsWith(currentMonth)
                ).length || 0;
                document.getElementById('recent-count').textContent = recentCount;

            } catch (error) {
                console.error('Error loading statistics:', error);
            }
        }

        // Load installations with filters
        async function loadInstallations() {
            showLoading(true);
            
            try {
                const [sortBy, sortOrder] = filters.sortBy.split('-');
                
                installations = await sanityClient.getInstallations({
                    search: filters.search,
                    application: filters.application,
                    sortBy: sortBy,
                    sortOrder: sortOrder,
                    limit: itemsPerPage,
                    offset: (currentPage - 1) * itemsPerPage
                });

                // Get total count for pagination
                const totalQuery = await sanityClient.query(`count(*[_type == "installation"
                    ${filters.search ? ` && (title.en match "${filters.search}*" || location.city.en match "${filters.search}*" || location.country.en match "${filters.search}*")` : ''}
                    ${filters.application ? ` && application == "${filters.application}"` : ''}
                ])`);
                totalInstallations = totalQuery;

                renderInstallationsTable();
                updatePagination();

            } catch (error) {
                console.error('Error loading installations:', error);
                showError('Error loading installations');
            } finally {
                showLoading(false);
            }
        }

        // Render installations table
        function renderInstallationsTable() {
            const tbody = document.getElementById('installations-tbody');
            
            if (installations.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M9,12C9,13.38 10.22,14.5 11.75,14.5C13.28,14.5 14.5,13.38 14.5,12C14.5,10.62 13.28,9.5 11.75,9.5C10.22,9.5 9,10.62 9,12M20,4H16.83L15,2H9L7.17,4H4A2,2 0 0,0 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6A2,2 0 0,0 20,4Z" />
                            </svg>
                            <h3>No installations found</h3>
                            <p>Try adjusting your search criteria or add a new installation.</p>
                            <a href="add-installation.html" class="btn btn-primary">Add New Installation</a>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = installations.map(installation => {
                const title = installation.title?.en || 'Untitled';
                const city = installation.location?.city?.en || 'Unknown';
                const country = installation.location?.country?.en || 'Location';
                const date = installation.installationDate ? 
                    new Date(installation.installationDate).toLocaleDateString() : 'No date';
                
                const imageCount = (installation.gallery && installation.gallery.length ? installation.gallery.length : 0) + (installation.coverImage ? 1 : 0);
                const imageThumbs = getImageThumbnails(installation);
                
                const publishedLocales = installation.publishedLocales || ['en'];
                const translationDots = getTranslationDots(installation.translationStatus);

                return `
                    <tr>
                        <td>
                            <div class="installation-title">${title}</div>
                            <div class="installation-subtitle">ID: ${installation._id.substring(0, 8)}...</div>
                        </td>
                        <td>
                            <div class="location-text">${city}, ${country}</div>
                        </td>
                        <td>
                            <div class="date-text">${date}</div>
                        </td>
                        <td>
                            <span class="application-badge badge-${installation.application || 'playground'}">
                                ${(installation.application || 'playground').replace('-', ' ')}
                            </span>
                        </td>
                        <td>
                            <div class="image-count">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M9,12C9,13.38 10.22,14.5 11.75,14.5C13.28,14.5 14.5,13.38 14.5,12C14.5,10.62 13.28,9.5 11.75,9.5C10.22,9.5 9,10.62 9,12M20,4H16.83L15,2H9L7.17,4H4A2,2 0 0,0 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6A2,2 0 0,0 20,4Z" />
                                </svg>
                                ${imageCount}
                            </div>
                            ${imageThumbs}
                        </td>
                        <td>
                            <div class="translation-status" title="Languages: ${publishedLocales.join(', ')}">
                                ${translationDots}
                            </div>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-edit" onclick="editInstallation('${installation._id}')" title="Edit">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" />
                                    </svg>
                                    Edit
                                </button>
                                <button class="btn btn-sm btn-translate" onclick="translateInstallation('${installation._id}')" title="Translate">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M12.87,15.07L15.27,12.67L16.68,14.08L17.39,13.37L15.27,11.25L15.27,11.25L12.87,13.65L10.47,11.25L9.06,12.66L12.87,16.47L16.68,12.66L15.27,11.25L12.87,13.65L12.87,15.07Z" />
                                    </svg>
                                    Translate
                                </button>
                                <button class="btn btn-sm btn-delete" onclick="deleteInstallation('${installation._id}', '${title}')" title="Delete">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z M8,9H16V19H8V9Z M15.5,4L14.5,3H9.5L8.5,4H5V6H19V4H15.5Z" />
                                    </svg>
                                    Delete
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Get image thumbnails HTML
        function getImageThumbnails(installation) {
            const images = [];
            if (installation.coverImage) {
                images.push(installation.coverImage);
            }
            if (installation.gallery) {
                images.push(...installation.gallery.slice(0, 2)); // Show max 3 thumbnails
            }

            return images.length > 0 ? `
                <div class="image-thumbnails">
                    ${images.map(img => {
                        const url = sanityClient.getImageUrl(img.asset, { width: 64, height: 48 });
                        return url ? `<img src="${url}" alt="Thumbnail" class="image-thumb">` : '';
                    }).join('')}
                </div>
            ` : '';
        }

        // Get translation status dots
        function getTranslationDots(translationStatus = {}) {
            const languages = ['en', 'fr', 'de', 'es'];
            return languages.map(lang => {
                const status = translationStatus[lang] || 'not-started';
                return `<div class="translation-dot status-${status}" title="${lang.toUpperCase()}: ${status}"></div>`;
            }).join('');
        }

        // Update pagination controls
        function updatePagination() {
            const totalPages = Math.ceil(totalInstallations / itemsPerPage);
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const pageInfo = document.getElementById('page-info');

            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages || totalPages === 0;
            
            pageInfo.textContent = `Page ${currentPage} of ${totalPages} (${totalInstallations} total)`;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Filter controls
            document.getElementById('apply-filters').addEventListener('click', applyFilters);
            document.getElementById('clear-filters').addEventListener('click', clearFilters);

            // Search on enter
            document.getElementById('search').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    applyFilters();
                }
            });

            // Pagination
            document.getElementById('prev-btn').addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    loadInstallations();
                }
            });

            document.getElementById('next-btn').addEventListener('click', () => {
                const totalPages = Math.ceil(totalInstallations / itemsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    loadInstallations();
                }
            });
        }

        // Apply filters
        function applyFilters() {
            filters.search = document.getElementById('search').value.trim();
            filters.application = document.getElementById('application-filter').value;
            filters.sortBy = document.getElementById('sort-by').value;
            currentPage = 1; // Reset to first page
            loadInstallations();
        }

        // Clear filters
        function clearFilters() {
            document.getElementById('search').value = '';
            document.getElementById('application-filter').value = '';
            document.getElementById('sort-by').value = 'date-desc';
            filters = { search: '', application: '', sortBy: 'date-desc' };
            currentPage = 1;
            loadInstallations();
        }

        // Edit installation
        function editInstallation(installationId) {
            window.location.href = `add-installation.html?id=${installationId}`;
        }

        // Translate installation
        function translateInstallation(installationId) {
            window.location.href = `translations.html?id=${installationId}`;
        }

        // Delete installation
        async function deleteInstallation(installationId, title) {
            if (!confirm(`Are you sure you want to delete "${title}"?\n\nThis action cannot be undone.`)) {
                return;
            }

            if (!confirm(`Please confirm deletion of "${title}". This will permanently remove the installation and all its data.`)) {
                return;
            }

            try {
                showLoading(true);
                await sanityClient.deleteInstallation(installationId);
                
                // Reload data
                await loadStatistics();
                await loadInstallations();
                
                alert('Installation deleted successfully');

            } catch (error) {
                console.error('Error deleting installation:', error);
                alert('Error deleting installation: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // Show/hide loading
        function showLoading(show) {
            const overlay = document.getElementById('loading-overlay');
            overlay.style.display = show ? 'flex' : 'none';
        }

        // Show error
        function showError(message) {
            alert(message); // Simple error display - could be enhanced with a toast system
        }
    </script>
</body>
</html>