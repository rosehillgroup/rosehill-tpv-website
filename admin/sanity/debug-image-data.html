<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Image Data</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            margin: 20px; 
            background: #f8fafc; 
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .installation { 
            background: #f8fafc; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }
        .title { font-weight: 600; color: #1a365d; }
        .field { margin: 5px 0; font-size: 14px; }
        .field-name { font-weight: 500; color: #64748b; }
        .field-value { color: #374151; }
        button { 
            background: #ff6b35; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 6px; 
            cursor: pointer; 
            margin: 10px 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üêõ Debug Image Data</h1>
        <button onclick="checkImageData()">Check Image Data</button>
        <div id="results"></div>
    </div>

    <script src="js/sanity-client.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const token = localStorage.getItem('sanity_token');
            if (token) {
                sanityClient.setToken(token);
            } else {
                const newToken = prompt('Enter your Sanity API token:');
                if (newToken) {
                    sanityClient.setToken(newToken);
                    localStorage.setItem('sanity_token', newToken);
                }
            }
        });

        async function checkImageData() {
            const results = document.getElementById('results');
            results.innerHTML = 'Loading...';
            
            try {
                const installations = await sanityClient.query(`
                    *[_type == "installation"][0...10] {
                        _id,
                        title,
                        coverImage,
                        gallery,
                        imageReferences,
                        imageCount,
                        coverImagePath
                    }
                `);
                
                results.innerHTML = installations.map(installation => {
                    const title = installation.title?.en || 'Untitled';
                    
                    return `
                        <div class="installation">
                            <div class="title">${title}</div>
                            <div class="field">
                                <span class="field-name">coverImage:</span> 
                                <span class="field-value">${installation.coverImage ? '‚úÖ Present' : '‚ùå null'}</span>
                            </div>
                            <div class="field">
                                <span class="field-name">gallery:</span> 
                                <span class="field-value">${installation.gallery ? `‚úÖ ${installation.gallery.length} items` : '‚ùå null'}</span>
                            </div>
                            <div class="field">
                                <span class="field-name">imageReferences:</span> 
                                <span class="field-value">${installation.imageReferences ? `‚úÖ [${installation.imageReferences.slice(0, 2).join(', ')}${installation.imageReferences.length > 2 ? '...' : ''}]` : '‚ùå null'}</span>
                            </div>
                            <div class="field">
                                <span class="field-name">imageCount:</span> 
                                <span class="field-value">${installation.imageCount !== undefined ? `‚úÖ ${installation.imageCount}` : '‚ùå undefined'}</span>
                            </div>
                            <div class="field">
                                <span class="field-name">coverImagePath:</span> 
                                <span class="field-value">${installation.coverImagePath ? `‚úÖ ${installation.coverImagePath}` : '‚ùå null'}</span>
                            </div>
                            <div class="field">
                                <span class="field-name">Calculated Count:</span> 
                                <span class="field-value">${
                                    installation.imageCount !== undefined ? installation.imageCount :
                                    (installation.gallery ? installation.gallery.length : 0) + (installation.coverImage ? 1 : 0) ||
                                    (installation.imageReferences ? installation.imageReferences.length : 0)
                                }</span>
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                results.innerHTML = `<div style="color: red;">Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>