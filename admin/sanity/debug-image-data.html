<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Image Data</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            margin: 20px; 
            background: #f8fafc; 
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .installation { 
            background: #f8fafc; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }
        .title { font-weight: 600; color: #1a365d; }
        .field { margin: 5px 0; font-size: 14px; }
        .field-name { font-weight: 500; color: #64748b; }
        .field-value { color: #374151; }
        button { 
            background: #ff6b35; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 6px; 
            cursor: pointer; 
            margin: 10px 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üêõ Debug Image Data</h1>
        <button onclick="checkImageData()">Check Image Data</button>
        <div id="results"></div>
    </div>

    <script src="js/sanity-client.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const token = localStorage.getItem('sanity_token');
            if (token) {
                sanityClient.setToken(token);
            } else {
                const newToken = prompt('Enter your Sanity API token:');
                if (newToken) {
                    sanityClient.setToken(newToken);
                    localStorage.setItem('sanity_token', newToken);
                }
            }
        });

        async function checkImageData() {
            const results = document.getElementById('results');
            results.innerHTML = 'Loading...';
            
            try {
                const installations = await sanityClient.query(`
                    *[_type == "installation"][0...10] {
                        _id,
                        title,
                        coverImage,
                        gallery,
                        imageReferences,
                        imageCount,
                        coverImagePath
                    }
                `);
                
                // Calculate summary statistics
                let withOldImages = 0;
                let withNewImages = 0;
                let withBothImages = 0;
                let withNoImages = 0;
                
                installations.forEach(installation => {
                    const hasOld = installation.coverImage || (installation.gallery && installation.gallery.length > 0);
                    const hasNew = installation.imageReferences && installation.imageReferences.length > 0;
                    
                    if (hasOld && hasNew) withBothImages++;
                    else if (hasOld) withOldImages++;
                    else if (hasNew) withNewImages++;
                    else withNoImages++;
                });
                
                results.innerHTML = `
                    <div style="background: #e3f2fd; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 10px 0; color: #1565c0;">üìä Image Data Summary</h3>
                        <div><strong>Total Installations:</strong> ${installations.length}</div>
                        <div><strong>With Legacy Images Only (coverImage/gallery):</strong> ${withOldImages}</div>
                        <div><strong>With New Images Only (imageReferences):</strong> ${withNewImages}</div>
                        <div><strong>With Both Image Types:</strong> ${withBothImages}</div>
                        <div><strong>With No Images:</strong> ${withNoImages}</div>
                        <div style="margin-top: 10px; color: ${withNewImages > 0 ? '#2e7d32' : '#d32f2f'};">
                            <strong>Migration Status:</strong> ${withNewImages > 0 ? '‚úÖ Images migrated successfully!' : '‚ùå No migrated images found'}
                        </div>
                    </div>
                ` + installations.map(installation => {
                    const title = installation.title?.en || 'Untitled';
                    const hasOld = installation.coverImage || (installation.gallery && installation.gallery.length > 0);
                    const hasNew = installation.imageReferences && installation.imageReferences.length > 0;
                    const className = hasNew ? 'has-images' : hasOld ? 'no-images' : 'no-images';
                    
                    return `
                        <div class="installation ${className}">
                            <div class="title">${title} ${hasNew ? '‚úÖ' : hasOld ? '‚ö†Ô∏è' : '‚ùå'}</div>
                            <div class="field">
                                <span class="field-name">coverImage:</span> 
                                <span class="field-value">${installation.coverImage ? '‚úÖ Present' : '‚ùå null'}</span>
                            </div>
                            <div class="field">
                                <span class="field-name">gallery:</span> 
                                <span class="field-value">${installation.gallery ? `‚úÖ ${installation.gallery.length} items` : '‚ùå null'}</span>
                            </div>
                            <div class="field">
                                <span class="field-name">imageReferences:</span> 
                                <span class="field-value">${installation.imageReferences ? `‚úÖ [${installation.imageReferences.slice(0, 2).join(', ')}${installation.imageReferences.length > 2 ? '...' : ''}]` : '‚ùå null'}</span>
                            </div>
                            <div class="field">
                                <span class="field-name">imageCount:</span> 
                                <span class="field-value">${installation.imageCount !== undefined ? `‚úÖ ${installation.imageCount}` : '‚ùå undefined'}</span>
                            </div>
                            <div class="field">
                                <span class="field-name">coverImagePath:</span> 
                                <span class="field-value">${installation.coverImagePath ? `‚úÖ ${installation.coverImagePath}` : '‚ùå null'}</span>
                            </div>
                            <div class="field">
                                <span class="field-name">Status:</span> 
                                <span class="field-value" style="font-weight: bold; color: ${hasNew ? '#2e7d32' : hasOld ? '#ef6c00' : '#d32f2f'};">
                                    ${hasNew ? 'Migrated ‚úÖ' : hasOld ? 'Needs Migration ‚ö†Ô∏è' : 'No Images ‚ùå'}
                                </span>
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                results.innerHTML = `<div style="color: red;">Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>